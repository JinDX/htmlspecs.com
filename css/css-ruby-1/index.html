<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>CSS Ruby 注释布局模块 1 级</title>
    <meta content="WD" name="w3c-status">
    <!-- <meta content="Bikeshed version 0fe3edbd9, updated Fri Dec 2 11:39:45 2022 -0800" name="generator"> -->
    <link href="https://www.w3.org/TR/css-ruby-1/" rel="canonical">
    <!-- <meta content="2bddbdfe4aa2630648d1988fc8453018b0b060ca" name="document-revision"> -->
    <script defer src="https://test.csswg.org/harness/annotate.js#!css-ruby-1_dev/css-ruby-1"></script>
    <style>
        /* ASCII diagram colors */
        .base {
            color: blue;
        }

        .annot {
            color: red;
        }

        .column {
            color: gray;
        }

        .flagtxt1 {
            color: green;
        }

        .flagtxt2 {
            color: #ae4a00;
        }

        .flagbg1 {
            background: green;
            opacity: 0.3;
        }

        .flagbg2 {
            background: orange;
            opacity: 0.3;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSS Ruby 注释布局模块 1 级</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C 工作草案</a>, <time class="dt-updated"
                datetime="2022-12-31">2022年12月31日</time></p>
        <details open>
            <summary>关于本文档的更多信息</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>本版本：
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2022/WD-css-ruby-1-20221231/">https://www.w3.org/TR/2022/WD-css-ruby-1-20221231/</a>
                    <dt>最新发布版本：
                    <dd><a href="https://www.w3.org/TR/css-ruby-1/">https://www.w3.org/TR/css-ruby-1/</a>
                    <dt>编辑草稿：
                    <dd><a href="https://drafts.csswg.org/css-ruby-1/">https://drafts.csswg.org/css-ruby-1/</a>
                    <dt>历史版本：
                    <dd><a href="https://www.w3.org/TR/2021/WD-css-ruby-1-20211202/"
                            rel="prev">https://www.w3.org/TR/2021/WD-css-ruby-1-20211202/</a>
                    <dd><a href="https://www.w3.org/TR/2021/WD-css-ruby-1-20210310/"
                            rel="prev">https://www.w3.org/TR/2021/WD-css-ruby-1-20210310/</a>
                    <dd><a href="https://www.w3.org/TR/2020/WD-css-ruby-1-20200429/"
                            rel="prev">https://www.w3.org/TR/2020/WD-css-ruby-1-20200429/</a>
                    <dd><a href="https://www.w3.org/TR/2014/WD-css-ruby-1-20140805/"
                            rel="prev">https://www.w3.org/TR/2014/WD-css-ruby-1-20140805/</a>
                    <dd><a href="https://www.w3.org/TR/2013/WD-css3-ruby-20130919/"
                            rel="prev">https://www.w3.org/TR/2013/WD-css3-ruby-20130919/</a>
                    <dt>历史记录：
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/css-ruby-1">https://www.w3.org/standards/history/css-ruby-1</a>
                    <dt>测试套件：
                    <dd><a
                            href="https://www.w3.org/International/tests/repo/results/css-ruby">https://www.w3.org/International/tests/repo/results/css-ruby</a>
                    <dt>反馈：
                    <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-ruby-1">CSSWG 问题仓库</a>
                    <dd><a href="#issues-index">文档内反馈</a>
                    <dt class="editor">编辑者：
                    <dd class="editor p-author h-card vcard" data-editor-id="35400"><a class="p-name fn u-url url"
                            href="http://fantasai.inkedblade.net/contact">Elika J. Etemad / fantasai</a> (<span
                            class="p-org org">特邀专家</span>)
                    <dd class="editor p-author h-card vcard" data-editor-id="45369"><a class="p-name fn u-email email"
                            href="mailto:kojiishi@gmail.com">Koji Ishii</a> (<span class="p-org org">Google</span>)
                    <dd class="editor p-author h-card vcard" data-editor-id="73936"><a class="p-name fn u-url url"
                            href="https://www.upsuper.org/">Xidorn Quan</a> (<a class="p-org org"
                            href="https://www.mozilla.org/">Mozilla</a>)
                    <dd class="editor p-author h-card vcard" data-editor-id="43241"><a class="p-name fn u-url url"
                            href="https://florian.rivoal.net/">Florian Rivoal</a> (<span class="p-org org">特邀专家</span>)
                    <dt>为本规范建议修改：
                    <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-ruby-1/Overview.bs">GitHub 编辑器</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive
                document license</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>“Ruby”是一种行间注释的形式，即在主文本旁显示简短的文本。

            它们通常用于东亚文档中，用于标注发音或提供简短说明。
            本模块描述了与在CSS中显示ruby注释有关的渲染模型和格式控制。</p>
        <a href="https://www.w3.org/TR/CSS/">CSS</a> 是一种用于描述结构化文档（如HTML和XML）在屏幕、纸张等上的渲染语言。
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">本文档状态</span></h2>
    <div data-fill-with="status">
        <p><em>本节描述了本文档在发布时的状态。
                当前W3C出版物列表
                以及本技术报告的最新版本
                可在 <a href="https://www.w3.org/TR/">W3C技术报告索引 https://www.w3.org/TR/</a> 找到。</em> </p>
        <p> 本文档由 <a href="https://www.w3.org/groups/wg/css">CSS工作组</a> 作为<a
                href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">推荐标准流程</a>下的 <strong>工作草案</strong> 发布。
            作为工作草案发布
            并不代表 <abbr title="World Wide Web Consortium">W3C</abbr> 及其成员的认可。 </p>
        <p> 本文档为草稿文档
            可能会随时被更新、替换或废弃。
            除了作为在研工作外，不应引用本文档。 </p>
        <p>如有反馈，请优先通过<a href="https://github.com/w3c/csswg-drafts/issues">在GitHub提交issue</a>，
            并在标题中包含规范代码“css-ruby”，格式如下：
            “[css-ruby] <i>…评论摘要…</i>”。
            所有问题和评论都会被<a href="https://lists.w3.org/Archives/Public/public-css-archive/">归档</a>。
            或者，也可以发送至（<a href="https://lists.w3.org/Archives/Public/www-style/">归档</a>）公共邮件列表 <a
                href="mailto:www-style@w3.org?Subject=%5Bcss-ruby%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>。 </p>
        <p>本文件受 <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2021年11月2日W3C流程文件</a> 管辖。
        </p>
        <p>本文件由遵循<a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C专利政策</a>的工作组产生。
            W3C 保持一份<a href="https://www.w3.org/groups/wg/css/ipr" rel="disclosure">与本工作组成果相关的专利披露公开列表</a>；
            该页面还包含专利披露的说明。
            任何实际知晓某项专利、且认为其包含<a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">必要声明</a>的个人，必须按照<a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">W3C专利政策第6节</a>的要求披露相关信息。</p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content"> 引言</span></a>
                <ol class="toc">
                    <li><a href="#ruby-def"><span class="secno">1.1</span> <span class="content"> 什么是 ruby？</span></a>
                    <li><a href="#placement"><span class="secno">1.2</span> <span class="content"> 模块交互</span></a>
                    <li><a href="#values"><span class="secno">1.3</span> <span class="content"> 值定义</span></a>
                    <li><a href="#diagram-conventions"><span class="secno">1.4</span> <span class="content">
                                图例约定</span></a>
                </ol>
            <li>
                <a href="#ruby-model"><span class="secno">2</span> <span class="content"> Ruby盒模型</span></a>
                <ol class="toc">
                    <li>
                        <a href="#ruby-display"><span class="secno">2.1</span> <span class="content"> Ruby专用<span
                                    class="property">display</span>值</span></a>
                        <ol class="toc">
                            <li><a href="#formatting-context"><span class="secno">2.1.1</span> <span class="content">
                                        Ruby格式化上下文</span></a>
                            <li><a href="#block-ruby"><span class="secno">2.1.2</span> <span class="content">
                                        非行内ruby</span></a>
                        </ol>
                    <li><a href="#box-fixup"><span class="secno">2.2</span> <span class="content"> 匿名ruby盒生成</span></a>
                    <li>
                        <a href="#ruby-pairing"><span class="secno">2.3</span> <span class="content"> 注释配对</span></a>
                        <ol class="toc">
                            <li><a href="#segment-pairing"><span class="secno">2.3.1</span> <span class="content">
                                        片段配对与注释层级</span></a>
                            <li><a href="#base-annotation-pairing"><span class="secno">2.3.2</span> <span
                                        class="content"> 单元配对与跨基底注释</span></a>
                        </ol>
                    <li><a href="#hiding"><span class="secno">2.4</span> <span class="content"> 隐藏注释：<span
                                    class="css">visibility: collapse</span> 和自动隐藏ruby</span></a>
                    <li><a href="#white-space"><span class="secno">2.5</span> <span class="content"> 空白折叠</span></a>
                </ol>
            <li>
                <a href="#ruby-layout"><span class="secno">3</span> <span class="content"> Ruby布局</span></a>
                <ol class="toc">
                    <li>
                        <a href="#interlinear-layout"><span class="secno">3.1</span> <span class="content">
                                行间ruby布局</span></a>
                        <ol class="toc">
                            <li><a href="#interlinear-inline"><span class="secno">3.1.1</span> <span class="content">
                                        行内轴上的行间布局</span></a>
                            <li><a href="#interlinear-block"><span class="secno">3.1.2</span> <span class="content">
                                        块轴上的行间布局</span></a>
                        </ol>
                    <li><a href="#inter-character-layout"><span class="secno">3.2</span> <span class="content">
                                字间ruby布局</span></a>
                    <li><a href="#box-style"><span class="secno">3.3</span> <span class="content"> Ruby盒样式</span></a>
                    <li>
                        <a href="#line-breaks"><span class="secno">3.4</span> <span class="content"> 跨行断开</span></a>
                        <ol class="toc">
                            <li><a href="#break-between"><span class="secno">3.4.1</span> <span class="content">
                                        基底间断开</span></a>
                            <li><a href="#break-within"><span class="secno">3.4.2</span> <span class="content">
                                        基底内断开</span></a>
                        </ol>
                    <li><a href="#bidi"><span class="secno">3.5</span> <span class="content"> 双向重排</span></a>
                    <li><a href="#line-height"><span class="secno">3.6</span> <span class="content"> 行间距</span></a>
                </ol>
            <li>
                <a href="#ruby-props"><span class="secno">4</span> <span class="content"> Ruby格式属性</span></a>
                <ol class="toc">
                    <li><a href="#rubypos"><span class="secno">4.1</span> <span class="content"> Ruby定位：<span
                                    class="property">ruby-position</span> 属性</span></a>
                    <li><a href="#collapsed-ruby"><span class="secno">4.2</span> <span class="content"> 共享注释空间：<span
                                    class="property">ruby-merge</span> 属性</span></a>
                    <li><a href="#ruby-align-property"><span class="secno">4.3</span> <span class="content">
                                Ruby文本分布：<span class="property">ruby-align</span> 属性</span></a>
                    <li><a href="#ruby-text-decoration"><span class="secno">4.4</span> <span class="content">
                                Ruby文本装饰</span></a>
                </ol>
            <li>
                <a href="#edge-effects"><span class="secno">5</span> <span class="content"> 边缘效果</span></a>
                <ol class="toc">
                    <li><a href="#ruby-overhang"><span class="secno">5.1</span> <span class="content"> 悬挂ruby：<span
                                    class="property">ruby-overhang</span> 属性</span></a>
                    <li><a href="#line-edge"><span class="secno">5.2</span> <span class="content"> 行边对齐</span></a>
                </ol>
            <li>
                <a href="#default-stylesheet"><span class="secno"></span> <span class="content"> 附录A：示例样式表</span></a>
                <ol class="toc">
                    <li><a href="#default-ua-ruby"><span class="secno"></span> <span class="content"> <span
                                    class="secno">A.1</span> 默认UA样式表</span></a>
                    <li><a href="#default-inline"><span class="secno"></span> <span class="content"> <span
                                    class="secno">A.2</span> 行内ruby注释</span></a>
                    <li><a href="#default-parens"><span class="secno"></span> <span class="content"> <span
                                    class="secno">A.3</span> 生成括号</span></a>
                </ol>
            <li><a href="#glossary"><span class="secno">6</span> <span class="content">术语表</span></a>
            <li><a href="#acknowledgments"><span class="secno"></span> <span class="content">致谢</span></a>
            <li>
                <a href="#changes"><span class="secno"></span> <span class="content">变更记录</span></a>
                <ol class="toc">
                    <li><a href="#changes-20211202"><span class="secno"></span> <span
                                class="content">自2021年12月2日WD之后的变更</span></a>
                    <li><a href="#changes-20200429"><span class="secno"></span> <span
                                class="content">自2020年4月29日WD之后的变更</span></a>
                    <li><a href="#changes-20140805"><span class="secno"></span> <span
                                class="content">自2014年8月5日WD之后的变更</span></a>
                    <li><a href="#changes-20130919"><span class="secno"></span> <span
                                class="content">自2013年9月19日WD之后的变更</span></a>
                    <li><a href="#changes-20110630"><span class="secno"></span> <span
                                class="content">自2011年6月30日WD之后的变更</span></a>
                </ol>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span
                                class="content">一致性类别</span></a>
                    <li>
                        <a href="#w3c-partial"><span class="secno"></span> <span class="content">部分实现</span></a>
                        <ol class="toc">
                            <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span
                                        class="content">不稳定和专有特性的实现</span></a>
                        </ol>
                    <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">非实验性实现</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">补充性引用</span></a>
                </ol>
            <li><a href="#property-index"><span class="secno"></span> <span class="content">属性索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">
                引言</span><a class="self-link" href="#intro"></a></h2>
        <h3 class="heading settled" data-level="1.1" id="ruby-def"><span class="secno">1.1. </span><span
                class="content"> 什么是 ruby？</span><a class="self-link" href="#ruby-def"></a></h3>
        <p><em>本小节不具规范性。</em></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ruby">Ruby</dfn> 是指一段与另一段文本（称为“基底”）并排出现的文本，
            用作该文本的注释或发音标注的通用名称。</p>
        <figure>
            <img alt="日文文本中每个汉字上方带有平假名注音的ruby示例" height="64"
                src="https://www.w3.org/TR/css-ruby-1/images/ruby-context.png" width="324">
            <figcaption>一段日文文本，每个汉字上方有注音ruby，标明每个字的发音。</figcaption>
        </figure>
        <p>下列插图展示了两种 Ruby 的例子，
            一个简单情况和一个结构更复杂的情况。</p>
        <div class="example" id="example-43e96817">
            <a class="self-link" href="#example-43e96817"></a> 在此示例中，单个注释用于标注由多个字符组成的基底文本。
            <div class="figure">
                <img alt="在日文短语上方应用ruby的示例" height="66" src="https://www.w3.org/TR/css-ruby-1/images/licence.png"
                    width="260">
                <p class="caption">日文中使用ruby的示例（简单情况）</p>
            </div>
            <p>在日文排版中，这种情况有时被称为
                taigo ruby（日文：<span lang="ja">対語ルビ</span>，即按词注音）或组ruby，
                因为注释整体与多字符单词（作为整体）关联。</p>
        </div>
        <div class="example" id="example-a47d36ef">
            <a class="self-link" href="#example-a47d36ef"></a> 在第二个示例中，
            有两层注释附加在基底文本上：
            上方的平假名用于标注每个基底汉字的发音，
            下方的“Keio”和“University”则给出了英文翻译。
            <div class="figure">
                <img alt="复杂ruby示例，基底字符上下均有注释文本" height="108"
                    src="https://www.w3.org/TR/css-ruby-1/images/ruby-univ.gif" width="277">
                <p class="caption">复杂ruby，基底字符的上方和下方均有注释文本</p>
            </div>
            <p>注意，为了正确对应
                平假名与其相应的汉字基底字符，
                基底文本中的间距会做相应调整。
                （如上图中第四个汉字，其注音为三个字符。）
                为避免上述示例中基底文本间距变化，
                可以将平假名注释设为<a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation">合并注释</a>，
                这样效果会更接近前面的组ruby示例。
                但由于基底-注释<a data-link-type="dfn" href="#pairing" id="ref-for-pairing">配对</a>关系已记录在ruby结构中，
                若文本换行，注释字符仍会与其基底字符正确配对。</p>
        </div>
        <p>在 HTML 中，ruby 结构及其标记描述见 Ruby Markup Extension 规范。
            本模块描述与这种标记的 ruby 布局相关的 CSS 渲染模型及格式控制。</p>
        <p>关于 <a data-link-type="dfn" href="#ruby" id="ref-for-ruby">Ruby</a> 及其格式的更深入介绍，
            可参见文章“什么是 Ruby” <a data-link-type="biblio" href="#biblio-qa-ruby" title="What is ruby?">[QA-RUBY]</a>。
            关于 ruby 在日文中主要传统排版方式的详细信息，
            见 JIS X-4051 <a data-link-type="biblio" href="#biblio-jis4051"
                title="Formatting rules for Japanese documents (『日本語文書の組版方法』).">[JIS4051]</a>（日文），
            以及 <a href="https://www.w3.org/TR/jlreq/#ruby_and_emphasis_dots">《Ruby和着重点》</a>一节，
            载于 <cite>日本语排版需求</cite> <a data-link-type="biblio" href="#biblio-jlreq"
                title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>（英文和日文）；
            <cite>日文ruby简单定位规则</cite> <a data-link-type="biblio" href="#biblio-simple-ruby"
                title="Rules for Simple Placement of Japanese Ruby">[SIMPLE-RUBY]</a> 亦以英文介绍了一种日文ruby排版的方式。
            <a href="https://www.w3.org/TR/clreq/#interlinear_annotations">《行间注释》</a>一节载于
            <cite>中文排版需求</cite> <a data-link-type="biblio" href="#biblio-clreq"
                title="Requirements for Chinese Text Layout - 中文排版需求">[CLREQ]</a>，介绍了中文排版中的相关实践（中英文）。
        </p>
        <h3 class="heading settled" data-level="1.2" id="placement"><span class="secno">1.2. </span><span
                class="content"> 模块交互</span><a class="self-link" href="#placement"></a></h3>
        <p>本模块扩展了 CSS Level 2 <a data-link-type="biblio" href="#biblio-css2"
                title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 的行内盒模型，以支持 ruby。
        </p>
        <p>本模块中的属性均不适用于 <a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-line"
                id="ref-for-selectordef-first-line">::first-line</a> 或 <a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-letter"
                id="ref-for-selectordef-first-letter">::first-letter</a> 伪元素；
            但 <a class="property css" data-link-type="property" href="#propdef-ruby-position"
                id="ref-for-propdef-ruby-position">ruby-position</a> 可通过 <span class="css"
                id="ref-for-selectordef-first-line①">::first-line</span> 继承，影响首行上的 ruby 注释。</p>
        <h3 class="heading settled" data-level="1.3" id="values"><span class="secno">1.3. </span><span class="content">
                值定义</span><a class="self-link" href="#values"></a></h3>
        <p>本规范遵循 <a href="https://www.w3.org/TR/CSS2/about.html#property-defs">CSS属性定义约定</a>（见 <a
                data-link-type="biblio" href="#biblio-css2"
                title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>），并采用 <a
                href="https://www.w3.org/TR/css-values-3/#value-defs">值定义语法</a>（见 <a data-link-type="biblio"
                href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>）。
            未在本规范中定义的值类型，可参见 CSS Values &amp; Units <span
                title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</span>。
            与其他CSS模块结合时，这些值类型的定义可能会被扩展。</p>
        <p>除各自定义中列出的属性特定值外，
            本规范定义的所有属性
            还接受 <a data-link-type="dfn" href="https://www.w3.org/TR/css-values-4/#css-wide-keywords"
                id="ref-for-css-wide-keywords">CSS通用关键字</a> 作为属性值。
            为了可读性，这里未一一重复列出。</p>
        <h3 class="heading settled" data-level="1.4" id="diagram-conventions"><span class="secno">1.4. </span><span
                class="content"> 图例约定</span><a class="self-link" href="#diagram-conventions"></a></h3>
        <p><em>本小节不具规范性。</em></p>
        <p>东亚排版的许多习惯
            都取决于所渲染字符是宽字符（CJK）还是窄字符（非CJK）。
            本文档中有多处插图采用如下图例：</p>
        <dl>
            <dt><img alt="宽单元格字形示意" height="39" src="https://www.w3.org/TR/css-ruby-1/images/fullwidth.gif" width="39">
            <dd> 宽单元格字形（如汉字），为文本流中的第 <var>n</var> 个字符。
                作为注释时通常缩放为50%大小。
            <dt><img alt="窄单元格字形示意" height="39" src="https://www.w3.org/TR/css-ruby-1/images/halfwidth.gif" width="19">
            <dd>窄单元格字形（如拉丁字母），为文本流中的第 <var>n</var> 个字形。
        </dl>
        <p>上述符号在图中的方向
            与其实际渲染时的字形方向一致。
            图中这些字符之间的间距一般无实际意义，
            除非特意调整以便说明。</p>
        <h2 class="heading settled" data-level="2" id="ruby-model"><span class="secno">2. </span><span class="content">
                Ruby盒模型</span><a class="self-link" href="#ruby-model"></a></h2>
        <p>CSS的ruby模型基于
            <a href="https://www.w3.org/TR/html5/text-level-semantics.html#the-ruby-element">W3C HTML5 Ruby 标记</a>
            模型
            以及 <a href="https://www.w3.org/TR/ruby/">XHTML Ruby 注释推荐规范</a> <a data-link-type="biblio"
                href="#biblio-ruby" title="Ruby Annotation">[RUBY]</a>。
            在该模型中，ruby结构由
            一个或多个 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box">ruby基底</a> 元素（表示被注释的基底文本）组成，
            并与一个或多个层级的 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box">ruby注释</a>
            元素（表示注释内容）关联。
            其结构类似于表格：
            有“行”（即 <a data-link-type="dfn" href="#base-level" id="ref-for-base-level">基底文本层</a>、每个 <a
                data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level">注释层</a>）
            也有“<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns">列</a>”（每个 <span
                id="ref-for-ruby-base-box①">ruby基底</span> 及其对应的 <span id="ref-for-ruby-annotation-box①">ruby注释</span>）。
        </p>
        <figure>
            <img alt="Ruby结构如表格排布，
		          第一“列”包含一个基底盒的‘上’，下方注释盒居中显示‘じょう’，
		          第二“列”包含另一个基底盒的‘手’，下方注释盒居中显示‘ず’。" height="94"
                src="https://www.w3.org/TR/css-ruby-1/images/ruby-boxes-simple.png" width="314">
            <figcaption>日语复合词“上手”带有注音“じょうず”。每个音节都与其基底字符单独关联。</figcaption>
        </figure>
        <p>一组连续的基底及其连续的注释会被归为一个 <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments">ruby段</a>。
            在一个 <span id="ref-for-ruby-segments①">ruby段</span>内，<a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box②">ruby注释</a>可以跨多个 <a data-link-type="dfn" href="#ruby-base-box"
                id="ref-for-ruby-base-box②">ruby基底</a>。</p>
        <figure>
            <img alt="Ruby结构如表格排布，
		          第一“列”包含基底盒‘旧’，上方注释盒居中‘jiù’，
		          第二“列”包含基底盒‘金’，上方注释盒居中‘jīn’，
		          第三“列”包含基底盒‘山’，上方注释盒居中‘shān’，
		          下方注释盒‘San Francisco’横跨三列。" height="128"
                src="https://www.w3.org/TR/css-ruby-1/images/ruby-boxes-complex.png" width="350">
            <figcaption>中国城市名“旧金山”带有拼音“jiùjīnshān”及英文名“San Francisco”。每个拼音音节与其基底字符分别关联，而英文名则与整体关联。</figcaption>
        </figure>
        <p class="note" role="note"><span>注：</span> 在 HTML 中，单个 <code>&lt;ruby></code> 元素可包含多个 <a data-link-type="dfn"
                href="#ruby-segments" id="ref-for-ruby-segments②">ruby段</a>。
            （而在 XHTML Ruby 模型中，一个 <code>&lt;ruby></code> 元素只能包含一个 <span id="ref-for-ruby-segments③">ruby段</span>。）</p>
        <h3 class="heading settled" data-level="2.1" id="ruby-display"><span class="secno">2.1. </span><span
                class="content"> Ruby专用 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display">display</a>
                值</span><a class="self-link" href="#ruby-display"></a></h3>
        <p>对于没有预定义ruby元素的文档语言（如某些XML应用），
            作者需将文档语言元素映射为ruby元素；
            这可通过 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display①">display</a>
            属性实现。</p>
        <div class="informative">
            <table class="def propdef partial" data-link-for-hint="display">
                <tbody>
                    <tr>
                        <th>名称:
                        <td><a class="css" data-link-type="property"
                                href="https://www.w3.org/TR/css-display-3/#propdef-display"
                                id="ref-for-propdef-display②">display</a>
                    <tr class="value">
                        <th><a href="https://www.w3.org/TR/css-values/#value-defs">新增值：</a>
                        <td class="prod">ruby <a data-link-type="grammar"
                                href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one">|</a>
                            ruby-base <span id="ref-for-comb-one①">|</span> ruby-text <span
                                id="ref-for-comb-one②">|</span> ruby-base-container <span
                                id="ref-for-comb-one③">|</span> ruby-text-container
            </table>
        </div>
        <p>以下新的 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display③">display</a>
            值可为任意元素分配ruby布局角色：</p>
        <dl>
            <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export
                    id="valdef-display-ruby">ruby</dfn>
            <dd> 指定元素生成一个 <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export
                    data-lt="ruby container | ruby container box" id="ruby-container">ruby容器盒</dfn>。
                （对应HTML/XHTML中的 <code>&lt;ruby></code> 元素。）
            <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export
                    id="valdef-display-ruby-base">ruby-base</dfn>
            <dd> 指定元素生成一个 <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export
                    data-lt="ruby base box | ruby base | base | base box" id="ruby-base-box">ruby基底盒</dfn>。
                （对应HTML/XHTML中的 <code>&lt;rb></code> 元素。）
            <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export
                    id="valdef-display-ruby-text">ruby-text</dfn>
            <dd> 指定元素生成一个 <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export
                    data-lt="ruby annotation box | ruby annotation | annotation | annotation box"
                    id="ruby-annotation-box">ruby注释盒</dfn>。
                （对应HTML/XHTML中的 <code>&lt;rt></code> 元素。）
            <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export
                    id="valdef-display-ruby-base-container">ruby-base-container</dfn>
            <dd> 指定元素生成一个 <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export
                    data-local-lt="base container" data-lt="ruby base container box | ruby base container"
                    id="ruby-base-container-box">ruby基底容器盒</dfn>。
                （对应XHTML中的 <code>&lt;rbc></code> 元素；在HTML中生成匿名盒。）
            <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export
                    id="valdef-display-ruby-text-container">ruby-text-container</dfn>
            <dd> 指定元素生成一个 <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export
                    data-local-lt="annotation container"
                    data-lt="ruby annotation container box | ruby annotation container"
                    id="ruby-annotation-container-box">ruby注释容器盒</dfn>。
                （对应HTML/XHTML中的 <code>&lt;rtc></code> 元素。）
        </dl>
        <p class="advisement">如使用支持专用ruby标记的语言（如HTML），
            应优先使用该标记，
            而非仅对任意元素（如 <code>&lt;span></code>）应用ruby <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display④">display</a> 值。
            正确使用标记可保证屏幕阅读器
            及非CSS渲染器能正确识别ruby结构。</p>
        <p class="note" role="note"><span>注：</span> <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#replaced-element" id="ref-for-replaced-element">替换元素</a> 设置为
            <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display⑤">display</a>
            为 <a class="css" data-link-type="maybe" href="#valdef-display-ruby-base"
                id="ref-for-valdef-display-ruby-base">ruby-base</a>、<a class="css" data-link-type="maybe"
                href="#valdef-display-ruby-text" id="ref-for-valdef-display-ruby-text">ruby-text</a>、<a class="css"
                data-link-type="maybe" href="#valdef-display-ruby-base-container"
                id="ref-for-valdef-display-ruby-base-container">ruby-base-container</a>、
            <a class="css" data-link-type="maybe" href="#valdef-display-ruby-text-container"
                id="ref-for-valdef-display-ruby-text-container">ruby-text-container</a> 时，均视为 <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#inline-level-box" id="ref-for-inline-level-box">行内级盒</a>，
            详见 <a href="https://www.w3.org/TR/css-display-3/#layout-specific-display"><cite>CSS Display 3</cite> § 2.4
                布局内部display类型：table-*与ruby-*关键字</a>；<span id="ref-for-replaced-element①">替换元素</span> 的 <span
                class="property" id="ref-for-propdef-display⑥">display</span> 值为 <a class="css" data-link-type="maybe"
                href="#valdef-display-ruby" id="ref-for-valdef-display-ruby">ruby</a> 或 <span class="css">inline
                ruby</span> 时，根据其 <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#outer-display-type"
                id="ref-for-outer-display-type">外部display类型</a> 行为，
            详见 <a href="https://www.w3.org/TR/css-display-3/#outer-role"><cite>CSS Display 3</cite> § 2.1
                流式布局的外部display角色：block、inline和run-in关键字</a>。
            （参见 <a href="#block-ruby">§ 2.1.2 非行内ruby</a>。）
        </p>
        <h4 class="heading settled" data-level="2.1.1" id="formatting-context"><span class="secno">2.1.1. </span><span
                class="content"> Ruby格式化上下文</span><a class="self-link" href="#formatting-context"></a>
        </h4>
        <p><a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container">Ruby容器</a>是非原子的
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-level"
                id="ref-for-inline-level">行内级</a>盒。
            与普通的<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box">行内盒</a>类似（参见<a href="https://www.w3.org/TR/css-inline-3/#model"><cite>CSS Inline
                    Layout 3</cite> 第2节 行内布局模型</a>），
            它们可以跨行断开，
            且其<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#containing-block"
                id="ref-for-containing-block">包含块</a>是最近的<a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#block-container" id="ref-for-block-container">块级容器</a>祖先。
            就像<span id="ref-for-inline-box①">行内盒</span>的内容参与包含该<span id="ref-for-inline-box②">行内盒</span>自身的同一个
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-formatting-context"
                id="ref-for-inline-formatting-context">行内格式化上下文</a>一样，
            <span id="ref-for-ruby-container①">ruby容器</span>及其基底层内容
            也参与包含该<span id="ref-for-ruby-container②">ruby容器</span>自身的同一个<span
                id="ref-for-inline-formatting-context①">行内格式化上下文</span>。
        </p>
        <p>然而，<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③">ruby容器</a>还会建立一个<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-export id="ruby-formatting-context">ruby格式化上下文</dfn>，在其所处的
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-formatting-context"
                id="ref-for-inline-formatting-context②">行内格式化上下文</a>的片段基础上构建更多结构，以承载其注释。
            <span class="note">注意：此<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-display-3/#formatting-context"
                    id="ref-for-formatting-context">格式化上下文</a><em>不是</em><a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-display-3/#independent-formatting-context"
                    id="ref-for-independent-formatting-context">独立格式化上下文</a>。</span>
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③">Ruby基底</a>、<a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③">ruby注释</a>、
            <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box">ruby基底容器</a>和
            <a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box">ruby注释容器</a>是<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-export data-lt="internal ruby boxes|internal ruby display types"
                id="internal-ruby-boxes">内部ruby盒</dfn>：
            类似于<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#internal-table-element"
                id="ref-for-internal-table-element">内部表格元素</a>，
            它们在ruby布局中有特定的作用，
            并参与其<span id="ref-for-ruby-container④">ruby容器</span>的<a data-link-type="dfn" href="#ruby-formatting-context"
                id="ref-for-ruby-formatting-context">ruby格式化上下文</a>。
            除了在<span id="ref-for-ruby-formatting-context①">ruby格式化上下文</span>中的角色之外，
            <span id="ref-for-ruby-base-box④">ruby基底</span>还同时参与与<span id="ref-for-ruby-container⑤">ruby容器</span>同级的基底层
            <span id="ref-for-inline-formatting-context③">行内格式化上下文</span>，
            而<span id="ref-for-ruby-annotation-box④">ruby注释</span>则参与由<span
                id="ref-for-ruby-container⑥">ruby容器</span>建立的独立注释层
            <span id="ref-for-inline-formatting-context④">行内格式化上下文</span>。
        </p>
        <p>如同<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box③">行内盒</a>的内容一样，
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#containing-block"
                id="ref-for-containing-block①">包含块</a>对于<a data-link-type="dfn" href="#ruby-container"
                id="ref-for-ruby-container⑦">ruby容器</a>及其所有<a data-link-type="dfn" href="#internal-ruby-boxes"
                id="ref-for-internal-ruby-boxes">内部ruby盒</a>的内容
            都是<span id="ref-for-containing-block②">ruby容器</span>的包含块。
            因此，例如浮动会被<span id="ref-for-ruby-container⑨">ruby容器</span>的<span
                id="ref-for-containing-block③">包含块</span>所限制，
            而不是被任何ruby盒类型所限制。
        </p>
        <h4 class="heading settled" data-level="2.1.2" id="block-ruby"><span class="secno">2.1.2. </span><span
                class="content"> 非行内ruby</span><a class="self-link" href="#block-ruby"></a></h4>
        <p>如果一个元素的<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inner-display-type"
                id="ref-for-inner-display-type">内部display类型</a>为<a class="css" data-link-type="maybe"
                href="#valdef-display-ruby" id="ref-for-valdef-display-ruby①">ruby</a>，而<a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#outer-display-type"
                id="ref-for-outer-display-type①">外部display类型</a>不是
            <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-display-3/#valdef-display-inline"
                id="ref-for-valdef-display-inline">inline</a>，
            则会生成两个盒：
            一个指定的<span id="ref-for-outer-display-type②">外部display类型</span>的主盒，
            以及一个行内级的<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⓪">ruby容器</a>。
            元素上指定的所有属性应用于主盒
            （可继承的属性则会继承到<span id="ref-for-ruby-container①①">ruby容器盒</span>）。
            这样可以将元素样式化为块级，
            同时仍能正确维护内部的ruby结构。
        </p>
        <p class="note" role="note"><span>注意：</span> 绝对定位或浮动元素会导致其<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display⑦">display</a>
            值
            计算为块级等价值。（参见<a data-link-type="biblio" href="#biblio-css-display-3"
                title="CSS Display Module Level 3">[CSS-DISPLAY-3]</a> 或 <a data-link-type="biblio" href="#biblio-css2"
                title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 第9.7节。）
            对于<a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes①">内部ruby显示类型</a>，
            这会使它们的<span class="property" id="ref-for-propdef-display⑧">display</span>值计算为<a class="css"
                data-link-type="maybe" href="https://www.w3.org/TR/css-display-3/#valdef-display-block"
                id="ref-for-valdef-display-block">block</a>。</p>
        <h3 class="heading settled" data-level="2.2" id="box-fixup"><span class="secno">2.2. </span><span
                class="content"> 匿名ruby盒生成</span><a class="self-link" href="#box-fixup"></a></h3>
        <p>CSS模型不要求文档语言
            必须包含与每个组件对应的元素。
            缺失的结构部分通过匿名盒生成规则隐式推断，<a href="https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes">类似于表格的归一化处理</a>。（见<a
                data-link-type="biblio" href="#biblio-css2"
                title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>）</p>
        <ol>
            <li id="anon-gen-inlinize"><a class="self-link" href="#anon-gen-inlinize"></a><strong><a
                        data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inlinify"
                        id="ref-for-inlinify">行内化</a>块级盒：</strong> 任何由<a data-link-type="dfn" href="#ruby-container"
                    id="ref-for-ruby-container①②">ruby容器</a>、
                <a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box①">ruby基底容器</a>、
                <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box①">ruby注释容器</a>、
                <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤">ruby基底盒</a>或
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤">ruby注释盒</a>
                直接包含的流内盒，
                必须按照<a data-link-type="biblio" href="#biblio-css-display-3"
                    title="CSS Display Module Level 3">[CSS-DISPLAY-3]</a>的
                <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inlinify"
                    id="ref-for-inlinify①">行内化</a>规则行内化，
                并相应计算其<a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-display-3/#propdef-display"
                    id="ref-for-propdef-display⑨">display</a>值，
                以便它们仅包含行内级内容。
                例如，
                被一个<span class="property" id="ref-for-propdef-display①⓪">display</span>为<span class="css"
                    id="ref-for-propdef-display①①">display: block</span>的父元素包裹、且本身在流内的元素，
                如果其父元素的<span class="css" id="ref-for-propdef-display①②">display: ruby-text</span>，
                则其display属性会计算为<a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-display-3/#valdef-display-inline-block"
                    id="ref-for-valdef-display-inline-block">inline-block</a>。
            <li id="anon-gen-anon-ruby">
                <a class="self-link" href="#anon-gen-anon-ruby"></a><strong>生成匿名ruby容器：</strong>
                任何<a href="https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes">连续</a>的未正确包含的
                <a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box②">ruby基底容器</a>、
                <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box②">ruby注释容器</a>、
                <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥">ruby基底盒</a>和/或
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥">ruby注释盒</a>（及其间的<a
                    data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#white-space"
                    id="ref-for-white-space">空白</a>）
                会被包裹在一个匿名<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①③">ruby容器</a>中。
                本步骤中：
                <ul>
                    <li>未正确包含的<a data-link-type="dfn" href="#ruby-base-box"
                            id="ref-for-ruby-base-box⑦">ruby基底盒</a>，指没有被<a data-link-type="dfn"
                            href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③">ruby基底容器</a>或<a
                            data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①④">ruby容器</a>包裹的基底盒
                    <li>未正确包含的<a data-link-type="dfn" href="#ruby-annotation-box"
                            id="ref-for-ruby-annotation-box⑦">ruby注释盒</a>，指没有被<a data-link-type="dfn"
                            href="#ruby-annotation-container-box"
                            id="ref-for-ruby-annotation-container-box③">ruby注释容器</a>或<a data-link-type="dfn"
                            href="#ruby-container" id="ref-for-ruby-container①⑤">ruby容器</a>包裹的注释盒
                    <li>未正确包含的<a data-link-type="dfn" href="#ruby-base-container-box"
                            id="ref-for-ruby-base-container-box④">ruby基底容器</a>或<a data-link-type="dfn"
                            href="#ruby-annotation-container-box"
                            id="ref-for-ruby-annotation-container-box④">ruby注释容器</a>，指没有被<a data-link-type="dfn"
                            href="#ruby-container" id="ref-for-ruby-container①⑥">ruby容器</a>包裹的容器
                </ul>
            <li id="anon-gen-bare-inlines">
                <a class="self-link" href="#anon-gen-bare-inlines"></a><strong>包裹父级错误的行内级内容：</strong> 任何由<a
                    data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑦">ruby容器</a>或
                <a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box⑤">ruby基底容器</a>直接包含的文本和行内级盒的连续序列，
                会被包裹在一个匿名<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧">ruby基底</a>中。
                类似地，任何由<a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑤">ruby注释容器</a>直接包含的文本和行内级盒的连续序列，
                会被包裹在一个匿名<a data-link-type="dfn" href="#ruby-annotation-box"
                    id="ref-for-ruby-annotation-box⑧">ruby注释</a>中。
                （为此目的，被视为<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#internal-table-element"
                    id="ref-for-internal-table-element①">内部表格元素</a>的错误父级元素，
                也被视为<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-level"
                    id="ref-for-inline-level①">行内级内容</a>，因为它们最终会被ruby盒包裹成
                <span id="ref-for-inline-level②">行内级</span><a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-tables-3/#table-wrapper-box"
                    id="ref-for-table-wrapper-box">表包装盒</a>。）
                <p>但如果这样构建的匿名盒只包含<a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#white-space"
                        id="ref-for-white-space①">空白</a>，
                    则该盒被视为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="intra-ruby-white-space">ruby内部空白</dfn>，其是否丢弃
                    或保留见下文说明。</p>
            <li id="anon-gen-trim-space"><a class="self-link" href="#anon-gen-trim-space"></a><strong>移除首尾空白：</strong>
                任何<a data-link-type="dfn" href="#intra-ruby-white-space"
                    id="ref-for-intra-ruby-white-space">ruby内部空白</a>，如果不是父元素唯一的<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-display-3/#in-flow" id="ref-for-in-flow">流内</a>子元素，并且是
                <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑧">ruby容器</a>、
                <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑥">ruby注释容器</a>或
                <a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box⑥">ruby基底容器</a>的第一个或最后一个
                <span id="ref-for-in-flow①">流内</span>子元素，则移除它，如同其有<a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display①③">display:
                    none</a>
            <li id="anon-gen-discard-space">
                <a class="self-link" href="#anon-gen-discard-space"></a><strong>移除层间空白：</strong>
                任何<a data-link-type="dfn" href="#intra-ruby-white-space"
                    id="ref-for-intra-ruby-white-space①">ruby内部空白</a>，其紧邻的<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-display-3/#in-flow" id="ref-for-in-flow②">流内</a>兄弟元素匹配下列模式之一，
                就是<dfn data-dfn-type="dfn" data-noexport id="inter-level-white-space">层间空白<a class="self-link"
                        href="#inter-level-white-space"></a></dfn>，并被移除，如同其有<a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-display" id="ref-for-propdef-display①④">display:
                    none</a>。
                <table class="data">
                    <thead>
                        <tr>
                            <th>前一个盒
                            <th>后一个盒
                    <tbody>
                        <tr>
                            <td>任意
                            <td><a data-link-type="dfn" href="#ruby-annotation-container-box"
                                    id="ref-for-ruby-annotation-container-box⑦">ruby注释容器</a>
                        <tr>
                            <td>不是<a data-link-type="dfn" href="#ruby-annotation-box"
                                    id="ref-for-ruby-annotation-box⑨">ruby注释</a>
                            <td><a data-link-type="dfn" href="#ruby-annotation-box"
                                    id="ref-for-ruby-annotation-box①⓪">ruby注释</a>
                </table>
            <li id="anon-gen-interpret-space">
                <a class="self-link" href="#anon-gen-interpret-space"></a><strong>解释层内空白：</strong> 任何<a
                    data-link-type="dfn" href="#intra-ruby-white-space"
                    id="ref-for-intra-ruby-white-space②">ruby内部空白</a>盒，
                其紧邻的<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#in-flow"
                    id="ref-for-in-flow③">流内</a>兄弟元素
                匹配下表之一时，
                赋予该盒相应类型及子类型：
                <table class="data">
                    <colgroup span="2">
                        <colgroup span="2">
                        <thead>
                    <tr>
                        <th>前一个盒
                        <th>后一个盒
                        <th>盒类型
                        <th>子类型
                            <tbody>
                                <tr>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box⑨">ruby基底</a>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①⓪">ruby基底</a>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①①">ruby基底</a>
                                    <td><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                                            id="inter-base-white-space">基底间空白</dfn>
                                <tr>
                                    <td><a data-link-type="dfn" href="#ruby-annotation-box"
                                            id="ref-for-ruby-annotation-box①①">ruby注释</a>
                                    <td><a data-link-type="dfn" href="#ruby-annotation-box"
                                            id="ref-for-ruby-annotation-box①②">ruby注释</a>
                                    <td><a data-link-type="dfn" href="#ruby-annotation-box"
                                            id="ref-for-ruby-annotation-box①③">ruby注释</a>
                                    <td><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                                            id="inter-annotation-white-space">注释间空白</dfn>
                                <tr>
                                    <td><a data-link-type="dfn" href="#ruby-annotation-box"
                                            id="ref-for-ruby-annotation-box①④">ruby注释</a> 或 <a data-link-type="dfn"
                                            href="#ruby-annotation-container-box"
                                            id="ref-for-ruby-annotation-container-box⑧">ruby注释容器</a>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①②">ruby基底</a> 或 <a data-link-type="dfn"
                                            href="#ruby-base-container-box"
                                            id="ref-for-ruby-base-container-box⑦">ruby基底容器</a>
                                    <td rowspan="3"><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①③">ruby基底</a>
                                    <td rowspan="3"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                                            id="inter-segment-white-space">段间空白</dfn>
                                <tr>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①④">ruby基底</a> 或 <a data-link-type="dfn"
                                            href="#ruby-base-container-box"
                                            id="ref-for-ruby-base-container-box⑧">ruby基底容器</a>
                                    <td><a data-link-type="dfn" href="#ruby-base-container-box"
                                            id="ref-for-ruby-base-container-box⑨">ruby基底容器</a>
                                <tr>
                                    <td><a data-link-type="dfn" href="#ruby-base-container-box"
                                            id="ref-for-ruby-base-container-box①⓪">ruby基底容器</a>
                                    <td><a data-link-type="dfn" href="#ruby-base-box"
                                            id="ref-for-ruby-base-box①⑤">ruby基底</a> 或 <a data-link-type="dfn"
                                            href="#ruby-base-container-box"
                                            id="ref-for-ruby-base-container-box①①">ruby基底容器</a>
                </table>
                上述定义的<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="intra-level-white-space">层内空白</dfn>盒
                在<a data-link-type="dfn" href="#pairing" id="ref-for-pairing①">配对</a>和布局时有特殊处理。
                见下文。
            <li id="anon-gen-unbreak">
                <a class="self-link" href="#anon-gen-unbreak"></a><strong>抑制换行：</strong> 转换所有<a data-link-type="dfn"
                    href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑤">ruby注释</a>内部的强制换行（无论<a
                    class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-text-3/#propdef-white-space"
                    id="ref-for-propdef-white-space">white-space</a>值如何），
                按照<a href="https://www.w3.org/TR/css-text-3/#line-break-transform">CSS Text Level 3 §
                    4.1.2</a>中的可折叠段落断点处理。
                <p class="issue" id="issue-f0987196"><a class="self-link" href="#issue-f0987196"></a>
                    这样做的目的是通过抑制ruby注释中的换行简化布局模型。
                    也可以尝试对其定义某种可接受的行为。</p>
            <li id="anon-gen-anon-containers"><a class="self-link"
                    href="#anon-gen-anon-containers"></a><strong>生成匿名层级容器：</strong> 任何没有被<a data-link-type="dfn"
                    href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①②">ruby基底容器</a>包裹的
                <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑥">ruby基底</a>和
                <a data-link-type="dfn" href="#inter-base-white-space"
                    id="ref-for-inter-base-white-space">基底间空白</a>的连续序列
                （且不是<a data-link-type="dfn" href="#inter-segment-white-space"
                    id="ref-for-inter-segment-white-space">段间空白</a>），
                会被包裹在匿名<span id="ref-for-ruby-base-container-box①③">ruby基底容器</span>中。
                类似地，任何没有被<a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑨">ruby注释容器</a>包裹的
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑥">ruby注释</a>和
                <a data-link-type="dfn" href="#inter-annotation-white-space"
                    id="ref-for-inter-annotation-white-space">注释间空白</a>的连续序列，
                会被包裹在匿名<span id="ref-for-ruby-annotation-container-box①⓪">ruby注释容器</span>中。
        </ol>
        <p>一旦所有ruby布局结构都正确包裹，
            UA即可开始将基底与注释关联。</p>
        <p class="note" role="note"><span>注意：</span> UA无需在内部结构中实际创建这些匿名盒
            （或<a data-link-type="dfn" href="#intra-level-white-space"
                id="ref-for-intra-level-white-space">层内空白</a>匿名空盒，见<a href="#ruby-pairing">§ 2.3 注释配对</a>），
            只要<a data-link-type="dfn" href="#pairing" id="ref-for-pairing②">配对</a>和布局行为如同这些盒存在即可。</p>
        <div class="example" id="example-4b85d1ff">
            <a class="self-link" href="#example-4b85d1ff"></a> 下图展示了表示各种盒子的标记图，
            展示了<a data-link-type="dfn" href="#intra-ruby-white-space"
                id="ref-for-intra-ruby-white-space③">ruby内部空白</a>被保留或丢弃的位置：
            <pre class="highlight" style="white-space: normal; overflow-wrap: break-word"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rbc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->⬕<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>rbc</c-><c- p>></c->☒<c- p>&lt;</c-><c- f>rtc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rt</c-><c- p>></c->⬔<c- p>&lt;</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rt</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>rtc</c-><c- p>></c->◼<c- p>&lt;</c-><c- f>rbc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->…<c- p>&lt;/</c-><c- f>rtc</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</pre>
            <p>其中</p>
            <ul>
                <li data-md>
                    <p>× 表示<a href="#anon-gen-trim-space">丢弃的首尾空白</a></p>
                <li data-md>
                    <p>☒ 表示<a href="#anon-gen-discard-space">丢弃的层间空白</a></p>
                <li data-md>
                    <p>⬕ 表示<a data-link-type="dfn" href="#inter-base-white-space"
                            id="ref-for-inter-base-white-space①">基底间空白</a></p>
                <li data-md>
                    <p>⬔ 表示<a data-link-type="dfn" href="#inter-annotation-white-space"
                            id="ref-for-inter-annotation-white-space①">注释间空白</a></p>
                <li data-md>
                    <p>◼ 表示<a data-link-type="dfn" href="#inter-segment-white-space"
                            id="ref-for-inter-segment-white-space①">段间空白</a></p>
            </ul>
        </div>
        <h3 class="heading settled" data-level="2.3" id="ruby-pairing"><span class="secno">2.3. </span><span
                class="content"> 注释配对</span><a class="self-link" href="#ruby-pairing"></a></h3>
        <p>注释<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pairing">配对</dfn>是将<a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑦">ruby注释</a>与<a data-link-type="dfn"
                href="#ruby-base-box" id="ref-for-ruby-base-box①⑦">ruby基底</a>关联的过程。
            每个<span id="ref-for-ruby-annotation-box①⑧">ruby注释</span>关联一个或多个<span
                id="ref-for-ruby-base-box①⑧">ruby基底</span>，
            称为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="span">跨基底</dfn>。
            （<span id="ref-for-ruby-annotation-box①⑨">ruby注释</span>如果<a data-link-type="dfn" href="#span"
                id="ref-for-span">跨</a>多个基底，
            则称为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="spanning-annotation">跨基底注释</dfn>。）</p>
        <p>一个<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑨">ruby基底</a>在每个<a
                data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level①">注释层</a>只能关联一个<a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②⓪">ruby注释</a>。
            但如果有多个<span id="ref-for-annotation-level②">注释层</span>，
            则可关联多个<span id="ref-for-ruby-annotation-box②①">ruby注释</span>。</p>
        <p>一旦<a data-link-type="dfn" href="#pairing" id="ref-for-pairing③">配对</a>完成，定义<dfn class="dfn-paneled"
                data-dfn-type="dfn" data-local-lt="column" data-noexport id="ruby-columns">ruby列</dfn>，
            每列由一个<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⓪">ruby基底</a>和每个
            <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations">行内注释</a><a
                data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level③">注释层</a>中的一个<a
                data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box②②">ruby注释</a>（可能是匿名空注释）组成，均来自其<a data-link-type="dfn"
                href="#ruby-segments" id="ref-for-ruby-segments④">ruby段</a>。
        </p>
        <h4 class="heading settled" data-level="2.3.1" id="segment-pairing"><span class="secno">2.3.1. </span><span
                class="content"> 段配对与注释层级</span><a class="self-link" href="#segment-pairing"></a></h4>
        <p>ruby结构被划分为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="ruby-segments">ruby段</dfn>，
            每个段由单个<a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box①④">ruby基底容器</a>和一个或多个<a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①①">ruby注释容器</a>组成。
            每个<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box①②">ruby注释容器</a>代表一个<dfn class="dfn-paneled"
                data-dfn-type="dfn" data-lt="annotation level | level" data-noexport id="annotation-level">注释层</dfn>：
            第一个代表第一层注释，
            第二个代表第二层，
            以此类推。
            <span id="ref-for-ruby-base-container-box①⑤">ruby基底容器</span>则代表<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-lt="base level | base text level" data-noexport id="base-level">基底层</dfn>。
            每个段中的<span id="ref-for-ruby-base-container-box①⑥">ruby基底容器</span>因此与该段下的每个
            <span id="ref-for-ruby-annotation-container-box①③">ruby注释容器</span>配对。
        </p>
        <p>为处理退化情况，假定有若干匿名空容器：</p>
        <ul>
            <li> 若某<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑨">ruby容器</a>的首个子元素是<a
                    data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box①④">ruby注释容器</a>，
                则假定其前存在一个匿名、空的<a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box①⑦">ruby基底容器</a>。
            <li> 同样，如果<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⓪">ruby容器</a>包含连续的
                <a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box①⑧">ruby基底容器</a>，
                则假定它们之间存在匿名、空的<a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box①⑤">ruby注释容器</a>。
        </ul>
        <p><a data-link-type="dfn" href="#inter-segment-white-space"
                id="ref-for-inter-segment-white-space②">段间空白</a>实质上是一个独立的<a data-link-type="dfn" href="#ruby-segments"
                id="ref-for-ruby-segments⑥">ruby段</a>。</p>
        <h4 class="heading settled" data-level="2.3.2" id="base-annotation-pairing"><span class="secno">2.3.2.
            </span><span class="content"> 单元配对与跨基底注释</span><a class="self-link" href="#base-annotation-pairing"></a>
        </h4>
        <p>在一个<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments⑦">ruby段</a>内，
            <a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box①⑨">ruby基底容器</a>中的每个<a data-link-type="dfn" href="#ruby-base-box"
                id="ref-for-ruby-base-box②①">ruby基底</a>
            与该段下每个<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box①⑥">ruby注释容器</a>中的一个
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②③">ruby注释</a>配对。
        </p>
        <p>如果一个<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box①⑦">ruby注释容器</a>只包含
            一个匿名<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②④">ruby注释</a>，
            则该<span id="ref-for-ruby-annotation-box②⑤">ruby注释</span>与其<a data-link-type="dfn" href="#ruby-segments"
                id="ref-for-ruby-segments⑨">ruby段</a>中的所有
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②②">ruby基底</a>配对（即<a
                data-link-type="dfn" href="#span" id="ref-for-span①">跨越</a>所有基底）。
        </p>
        <p>否则，每个<a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box②⑥">ruby注释</a>按照文档顺序与该段内对应的
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②③">ruby基底</a>配对。
            如果某<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box①⑧">ruby注释容器</a>中的<span
                id="ref-for-ruby-annotation-box②⑦">ruby注释</span>数不够，
            剩余的<span id="ref-for-ruby-base-box②④">ruby基底</span>会与匿名空注释配对，
            匿名注释插入到<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box①⑨">ruby注释容器</a>末尾。
            如果<span id="ref-for-ruby-base-box②⑤">ruby基底</span>数不够，
            剩余的<span id="ref-for-ruby-annotation-box②⑧">ruby注释</span>会与匿名空基底配对，
            匿名基底插入到<a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box②⓪">ruby基底容器</a>末尾。
        </p>
        <p>如果实现支持带显式跨越的ruby标记
            （如XHTML复杂ruby注释），
            必须调整<a data-link-type="dfn" href="#pairing" id="ref-for-pairing④">配对</a>规则，使
            <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation">跨基底注释</a>能正确配对到其基底。
        </p>
        <p><a data-link-type="dfn" href="#intra-level-white-space"
                id="ref-for-intra-level-white-space①">层内空白</a>不参与标准注释<a data-link-type="dfn" href="#pairing"
                id="ref-for-pairing⑤">配对</a>。
            但若其直接相邻的<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑥">ruby基底</a>或
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②⑨">ruby注释</a>已配对
        </p>
        <ul>
            <li> 若两个<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑦">ruby基底</a>或
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⓪">注释</a>
                在另一层内包围了对应的<a data-link-type="dfn" href="#intra-level-white-space"
                    id="ref-for-intra-level-white-space②">层内空白</a>，
                则这些对应的<span id="ref-for-intra-level-white-space③">层内空白</span>盒也配对。
            <li> 若与单个跨基底<a data-link-type="dfn" href="#ruby-annotation-box"
                    id="ref-for-ruby-annotation-box③①">ruby注释</a>配对，
                则<a data-link-type="dfn" href="#intra-level-white-space"
                    id="ref-for-intra-level-white-space④">层内空白</a>也与该<span
                    id="ref-for-ruby-annotation-box③②">ruby注释</span>配对
            <li> 若与两个<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑧">ruby基底</a>或
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③③">注释</a>
                且二者间无<a data-link-type="dfn" href="#intra-level-white-space"
                    id="ref-for-intra-level-white-space⑤">层内空白</a>，
                则该<span id="ref-for-intra-level-white-space⑥">层内空白</span>盒与假定存在于其间的匿名空<span
                    id="ref-for-intra-level-white-space⑦">层内空白</span>盒配对。
        </ul>
        <div class="example" id="example-e7c0375d">
            <a class="self-link" href="#example-e7c0375d"></a> 下图展示了普通<a data-link-type="dfn" href="#ruby-base-box"
                id="ref-for-ruby-base-box②⑨">基底</a>与
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③④">注释</a>盒的配对，以及
            <a data-link-type="dfn" href="#intra-ruby-white-space"
                id="ref-for-intra-ruby-white-space④">ruby内部空白</a>（以<samp>ws</samp>表示）的配对：
            <pre class="highlight"><span class="column">|</span><span class="annot">[</span>  s p a n n i n g   a n n o t a t i o n <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span> a1 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>ws<span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a3 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>ws<span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a4 <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span> b1 <span class="base">]</span><span class="column">|</span><span class="base">[</span>ws<span class="base">]</span><span class="column">|</span><span class="base">[</span> b2 <span class="base">]</span><span class="column">|</span><span class="base">[</span>ws<span class="base">]</span><span class="column">|</span><span class="base">[</span> b3 <span class="base">]</span><span class="column">|</span><span class="base">[</span>  <span class="base">]</span><span class="column">|</span><span class="base">[</span> b4 <span class="base">]</span><span class="column">|</span>
</pre>
            <p>蓝色方括号（<samp class="base">[ ]</samp>）表示<a data-link-type="dfn" href="#ruby-base-box"
                    id="ref-for-ruby-base-box③⓪">基底盒</a>，
                红色方括号（<samp class="annot">[ ]</samp>）表示<a data-link-type="dfn" href="#ruby-annotation-box"
                    id="ref-for-ruby-annotation-box③⑤">注释盒</a>，
                灰色竖线（<samp class="column">|</samp>）表示<a data-link-type="dfn" href="#ruby-columns"
                    id="ref-for-ruby-columns①">ruby列</a>的边界，
                <samp class="ws">[ws]</samp>表示<a data-link-type="dfn" href="#intra-ruby-white-space"
                    id="ref-for-intra-ruby-white-space⑤">ruby内部空白</a>，
                而<samp>[]</samp>表示自动生成与另一层的<span id="ref-for-intra-ruby-white-space⑥">层内空白</span>配对的匿名空基底或注释。
                <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②①">ruby容器</a>、<a
                    data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box②①">基底容器</a>和
                <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box②⓪">注释容器</a>省略不画。
            </p>
        </div>
        <h3 class="heading settled" data-level="2.4" id="hiding"><span class="secno">2.4. </span><span class="content">
                隐藏注释：<a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                    id="ref-for-propdef-visibility">visibility: collapse</a> 和自动隐藏ruby</span><span
                id="autohide"></span><a class="self-link" href="#hiding"></a></h3>
        <p>若<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⑥">ruby注释</a>的<a
                class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                id="ref-for-propdef-visibility①">visibility</a>为<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-display-3/#valdef-visibility-collapse"
                id="ref-for-valdef-visibility-collapse">collapse</a>，则该注释为<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-local-lt="hidden" data-lt="hidden annotation | hidden ruby annotation | hide" data-noexport
                id="hidden-annotation">隐藏注释</dfn>。
            此外，
            若某<span id="ref-for-ruby-annotation-box③⑦">ruby注释</span>与其基底文本内容完全相同，
            UA会自动将其<a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation">隐藏</a>（<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-lt="auto-hidden | auto-hide" data-noexport
                id="auto-hidden">自动隐藏</dfn>）。
        </p>
        <p><a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation①">隐藏</a><a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⑧">ruby注释</a>
            不影响注释<a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑥">配对</a>。
            但该<span id="ref-for-hidden-annotation②">隐藏注释</span>不可见，
            除了在其层内将相邻的<span id="ref-for-ruby-annotation-box③⑨">ruby注释盒</span>序列分开、仿佛属于不同段落、并且其基底视为中间行内内容而非
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③①">ruby基底</a>外，对布局无影响。
        </p>
        <div class="example" id="example-ed46b94b">
            <a class="self-link" href="#example-ed46b94b"></a> 自动隐藏机制可以正确内联显示包含汉字和平假名混合的日文词汇的注释。
            例如，单词<span lang="ja">振り仮名</span>应内联显示为：
            <p class="figure">振り仮名(ふりがな) </p>
            <p>因此其标记如下：</p>
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->振<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->り<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->仮<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->名<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rp</c-><c- p>></c->(<c- p>&lt;/</c-><c- f>rp</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->ふ<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->り<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->が<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->な<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rp</c-><c- p>></c->)<c- p>&lt;/</c-><c- f>rp</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
            <p>但以ruby显示时，“り”应被隐藏：</p>
            <div class="figure">
                <img alt="振り仮名的平假名注音显示，每个汉字上方有对应发音，但‘り’上方无注音。" height="73"
                    src="https://www.w3.org/TR/css-ruby-1/images/furigana-separate.png" width="160">
                <p class="caption">振り仮名的平假名ruby。注意‘り’已经是平假名，因此其上方没有注释。</p>
            </div>
        </div>
        <div class="example" id="example-18291435">
            <a class="self-link" href="#example-18291435"></a> 此例中的日文单词由三个汉字组成，
            其中一个为一年级常用字，
            另两个较难。
            （字符用颜色区分基底配对关系。）
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->昆<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->虫<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->记<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->こん<c- p>&lt;/</c-><c- f>rt</c-> <c- e>class</c-><c- o>=</c-><c- s>easy</c-><c- p>></c->ちゅう<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->き<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</pre>
            <figure>
                <img alt="昆虫记三个汉字均带有注音，中间注音较宽，基底字符间有空隙避免注音重叠。"
                    src="https://www.w3.org/TR/css-ruby-1/images/ruby-pairing-full.png" width="122">
                <figcaption>完整注音的三字词</figcaption>
            </figure>
            <p>虽然有些读者需要全部字的发音，
                但对其他人来说，隐藏简单字符的注音更合适。
                应用<a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                    id="ref-for-propdef-visibility②">visibility: collapse</a>即可隐藏：</p>
            <figure>
                <img alt="昆虫记仅首尾汉字带有注音，居中注音已隐藏。" src="https://www.w3.org/TR/css-ruby-1/images/ruby-pairing-collapse.png"
                    width="105">
                <figcaption>中间注音设置为<a class="css" data-link-type="propdesc"
                        href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                        id="ref-for-propdef-visibility③">visibility: collapse</a></figcaption>
            </figure>
            <p><a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation④">visibility:
                    collapse</a>的隐藏效果
                不同于<span class="css" id="ref-for-propdef-visibility⑤">visibility: hidden</span>——后者使注释不可见，
                但仍会保留其占位空间：</p>
            <figure>
                <img alt="昆虫记，首尾注音正常，中间注音虽不可见但仍占空间，导致基底字符间距扩大。"
                    src="https://www.w3.org/TR/css-ruby-1/images/ruby-pairing-invisible.png" width="122">
                <figcaption>中间注音设置为<a class="css" data-link-type="propdesc"
                        href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                        id="ref-for-propdef-visibility⑥">visibility: hidden</a></figcaption>
            </figure>
            <p>这也不同于<a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-display-3/#propdef-display"
                    id="ref-for-propdef-display①⑤">display:
                    none</a>，因为<a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                    id="ref-for-propdef-visibility⑦">visibility: collapse</a>会保留配对关系，
                而<span class="css" id="ref-for-propdef-display①⑥">display: none</span>会完全移除盒，
                导致后续注释配对错乱：</p>
            <figure>
                <img alt="昆虫记，注音错位：第二字符注音被移除后，第三字符注音显示在第二上方。"
                    src="https://www.w3.org/TR/css-ruby-1/images/ruby-pairing-discard.png" width="107">
                <figcaption>中间注音设置为<a class="css" data-link-type="propdesc"
                        href="https://www.w3.org/TR/css-display-3/#propdef-display"
                        id="ref-for-propdef-display①⑦">display: none</a></figcaption>
            </figure>
        </div>
        <p>当<a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#computed-value"
                id="ref-for-computed-value">计算值</a>为<a class="property css" data-link-type="property"
                href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge">ruby-merge</a>的<a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②①">注释容器</a>为
            <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge"
                id="ref-for-valdef-ruby-merge-merge">merge</a>时，将禁用<a data-link-type="dfn" href="#hidden-annotation"
                id="ref-for-hidden-annotation⑤">隐藏</a>。
            若为<a class="css" data-link-type="maybe" href="#valdef-ruby-merge-auto"
                id="ref-for-valdef-ruby-merge-auto">auto</a>，
            UA可决定是否禁用其注释的<span id="ref-for-hidden-annotation⑥">隐藏</span>，
            推荐在UA布局算法生成类似<a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate"
                id="ref-for-valdef-ruby-merge-separate">separate</a>效果时启用<span
                id="ref-for-hidden-annotation⑦">隐藏</span>。
        </p>
        <p><a data-link-type="dfn" href="#auto-hidden" id="ref-for-auto-hidden">自动隐藏</a>时的内容比较在空白折叠（<a
                class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-text-3/#propdef-white-space"
                id="ref-for-propdef-white-space①">white-space</a>）和文本转换（<a class="property css"
                data-link-type="property" href="https://www.w3.org/TR/css-text-3/#propdef-text-transform"
                id="ref-for-propdef-text-transform">text-transform</a>）之前，
            并忽略元素（仅比较盒的<code>textContent</code>）。</p>
        <p class="note" role="note"><span>注：</span>后续CSS Ruby级别可能会增加<a data-link-type="dfn" href="#auto-hidden"
                id="ref-for-auto-hidden①">自动隐藏</a>的控制，
            但在本级别中始终强制自动隐藏。</p>
        <h3 class="heading settled" data-level="2.5" id="white-space"><span class="secno">2.5. </span><span
                class="content"> 空白折叠</span><a class="self-link" href="#white-space"></a></h3>
        <p>如<a href="#box-fixup">§ 2.2 匿名ruby盒生成</a>所述，
            ruby结构内的空白会被<a href="#anon-gen-discard-space">丢弃</a>：</p>
        <ul>
            <li>在<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②②">ruby容器</a>、<a
                    data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box②②">注释容器</a>或<a data-link-type="dfn"
                    href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②②">基底容器</a>的开头和结尾，
            <li>在<a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box②③">基底容器</a>与其后<a data-link-type="dfn"
                    href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②③">注释容器</a>之间，
            <li>在<a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box②④">注释容器</a>之间。
        </ul>
        <div class="example" id="example-6fc7b45d">
            <a class="self-link" href="#example-6fc7b45d"></a> 例如，下列标记不会显示任何空白：
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->東<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->京<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->とう<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->きょう<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->Tō<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->kyō<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rtc</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
        </div>
        <p>但在<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⓪">ruby段</a>之间、<a
                data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③②">ruby基底</a>之间、<a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⓪">ruby注释</a>之间，
            空白不会被丢弃，
            会作为<a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space②">基底间空白</a>、
            <a data-link-type="dfn" href="#inter-annotation-white-space"
                id="ref-for-inter-annotation-white-space②">注释间空白</a>
            或<a data-link-type="dfn" href="#inter-segment-white-space"
                id="ref-for-inter-segment-white-space③">段间空白</a>保留渲染。
            （见上文<a href="#anon-gen-interpret-space">层内空白解释</a>。）
        </p>
        <div class="example" id="example-7bca862a">
            <a class="self-link" href="#example-7bca862a"></a> 空白保留规则允许ruby用于如拉丁文等以空格分隔的书写系统。
            例如：
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->World<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Wide<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Web<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
            <p>同时也保证带注释的空白被保留。例如：</p>
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->Aerith<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->Gainsborough<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->エアリス<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->・<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->ゲインズブール<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
        </div>
        <p>若未丢弃的空白为<a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#collapsible-white-space"
                id="ref-for-collapsible-white-space">可折叠空白</a>，
            则在每个行盒内会按照标准<a href="https://www.w3.org/TR/css3-text/#white-space-rules">空白处理规则</a>
            <a data-link-type="biblio" href="#biblio-css-text-3" title="CSS Text Module Level 3">[CSS-TEXT-3]</a>跨相邻盒折叠。
            不同<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①①">ruby段</a>的注释
            或被<a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation⑧">隐藏注释</a>分隔的注释不视为相邻；
            但所有基底层内容
            （包括被视为<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#atomic-inline"
                id="ref-for-atomic-inline">原子行内</a>的<a data-link-type="dfn"
                href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation">字间注释</a>）
            均视为相邻。
            对于<span id="ref-for-collapsible-white-space①">可折叠空白</span>在<span
                id="ref-for-ruby-segments①②">ruby段</span>之间（<a data-link-type="dfn" href="#inter-segment-white-space"
                id="ref-for-inter-segment-white-space④">段间空白</a>），
            用于确定<a href="https://www.w3.org/TR/css-text-3/#line-break-transform">分段断点转换</a>的上下文文本
            为两侧的<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③③">ruby基底</a>，
            而非文档顺序上空白两侧的文本（可能包含<a data-link-type="dfn" href="#interlinear-annotations"
                id="ref-for-interlinear-annotations①">行内注释</a>）。
        </p>
        <div class="note" role="note">
            注：空白处理规则
            使得包含<a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#segment-break"
                id="ref-for-segment-break">分段断点</a>
            （如换行符）的空白序列
            会在汉字与假名之间<a href="https://www.w3.org/TR/css3-text/#line-break-transform">折叠为无内容</a>。
            这意味着中日文ruby可以安全用空白缩进ruby标记。
            例如下例不会显示任何空白：
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  屋<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->おく<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->内<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ない<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  禁<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->煙<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->えん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
            <p>但若空白中不含<a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#segment-break"
                    id="ref-for-segment-break①">分段断点</a>，
                则不会完全折叠，因此下例首对与次对ruby之间会显示空格：</p>
            <pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  屋<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->おく<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->  内<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ない<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  禁<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->  煙<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->えん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
        </div>
        <h2 class="heading settled" data-level="3" id="ruby-layout"><span class="secno">3. </span><span class="content">
                Ruby布局</span><a class="self-link" href="#ruby-layout"></a></h2>
        <p>当ruby结构进行布局时，
            其<a data-link-type="dfn" href="#base-level" id="ref-for-base-level①">基底层</a>首先在线上布局，
            就像其<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③④">ruby基底</a>是一串普通<a
                data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box④">行内盒</a>，
            <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②③">ruby容器</a>是包裹其中的普通<span
                id="ref-for-inline-box⑤">行内盒</span>一样。
        </p>
        <p>如果<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②④">ruby容器</a>包含
            <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①">字间注释</a>，
            则如<a href="#inter-character-layout">§ 3.2 字间ruby布局</a>所述，将其布局进<a data-link-type="dfn" href="#base-level"
                id="ref-for-base-level②">基底层</a>。
            然后，对<a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box②④">基底容器</a>定尺寸，
            并按<a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations②">行内注释</a>
            以<a href="#interlinear-layout">§ 3.1 行间ruby布局</a>的方法布局注释。
        </p>
        <p>与其他CSS布局模型一样，
            相对定位、变换等图形效果会在盒布局后应用。</p>
        <h3 class="heading settled" data-level="3.1" id="interlinear-layout"><span class="secno">3.1. </span><span
                class="content"> 行间ruby布局</span><a class="self-link" href="#interlinear-layout"></a></h3>
        <p><a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations③">行间</a>
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④①">ruby注释</a>
            在同一层内，
            初始布局与<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box⑥">行内盒</a>相同，
            参与同一个<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-formatting-context"
                id="ref-for-inline-formatting-context⑤">行内格式化上下文</a>，
            为该<a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level④">注释层</a>在<a
                data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑤">ruby容器</a>中建立一个<a
                data-link-type="dfn" href="https://www.w3.org/TR/css-inline-3/#line-box"
                id="ref-for-line-box">行盒</a>。<span id="ref-for-ruby-annotation-box④②">注释</span>与<a data-link-type="dfn"
                href="#ruby-base-box" id="ref-for-ruby-base-box③⑤">基底</a>的对齐方式如下文调整间距所述。
        </p>
        <h4 class="heading settled" data-level="3.1.1" id="interlinear-inline"><span class="secno">3.1.1. </span><span
                class="content"> 行内轴上的行间布局</span><a class="self-link" href="#interlinear-inline"></a></h4>
        <p>在行内轴上，<a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations④">行间</a><a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④③">ruby注释</a>
            按其<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑥">基底盒</a>与<a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑤">注释容器</a>的<a
                class="property css" data-link-type="property" href="#propdef-ruby-merge"
                id="ref-for-propdef-ruby-merge①">ruby-merge</a>
            值对齐。</p>
        <p>当<a class="property css" data-link-type="property" href="#propdef-ruby-merge"
                id="ref-for-propdef-ruby-merge②">ruby-merge</a>为<a class="css" data-link-type="maybe"
                href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate①">separate</a>时，
            每个<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns②">ruby列</a>以该<span
                id="ref-for-ruby-columns③">列</span>中内容最大宽度
            （<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑦">ruby基底</a>或<a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④④">ruby注释</a>）定宽。
            如<a data-link-type="dfn" href="#spanning-annotation"
                id="ref-for-spanning-annotation①">跨基底注释</a>（无论实际跨越，还是根据<span class="css"
                id="ref-for-propdef-ruby-merge③">ruby-merge: merge</span>假定跨越），
            其内容宽于所跨<span id="ref-for-ruby-columns④">列</span>总宽时，
            超出宽度在所跨<span id="ref-for-ruby-columns⑤">列</span>间平均分配。
            若一<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①③">ruby段</a>有多个<span
                id="ref-for-spanning-annotation③">跨基底注释</span>，
            则先分配跨度小的注释，再按跨度递增处理。
            每个<span id="ref-for-ruby-base-box③⑧">ruby基底</span>和<span
                id="ref-for-ruby-annotation-box④⑤">ruby注释</span>最终正好覆盖其列。</p>
        <p class="note" role="note"><span>注：</span> 若多个不同层级的注释跨相同数量基底且重叠但不重合，
            空间分配未定义。
            注意这在HTML标记中不可能，
            但在如<a data-link-type="biblio" href="#biblio-ruby" title="Ruby Annotation">[RUBY]</a>中支持显式跨越的标记语言中可能出现。</p>
        <p>若某<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑥">ruby注释</a>位于<a
                data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box②⑥">注释容器</a>且<a class="css" data-link-type="propdesc"
                href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge④">ruby-merge:
                auto</a>，且其宽度大于<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑨">基底</a>宽度，
            该<span id="ref-for-ruby-annotation-box④⑦">ruby注释</span>可超出其<span
                id="ref-for-ruby-annotation-container-box②⑦">注释容器</span>的<span id="ref-for-ruby-columns⑥">列</span>范围。
            UA可自行决定其对<span id="ref-for-ruby-segments①④">ruby段</span>宽度的影响，
            但要保证该段能容纳全部内容。</p>
        <p><a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation②">字间注释</a>穿插于列之间：
            它们计入跨列注释的测量，
            但不属于任何一列，
            也不会被<a data-link-type="dfn" href="#interlinear-annotations"
                id="ref-for-interlinear-annotations⑤">行间注释</a>的尺寸或定位影响。</p>
        <p>每个<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⓪">基底</a>及<a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑧">注释</a>盒内，
            当内容宽度小于盒宽时，
            多余空间如何分配由<a class="property css" data-link-type="property" href="#propdef-ruby-align"
                id="ref-for-propdef-ruby-align">ruby-align</a>属性指定。</p>
        <div class="example" id="example-476e6a05">
            <a class="self-link" href="#example-476e6a05"></a> 下列图示演示了这些规则，
            包括常见情况及部分复杂情况。
            每种情况下，<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④①">基底盒</a>和
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑨">注释盒</a>
            假定都设置<a class="css" data-link-type="propdesc" href="#propdef-ruby-align"
                id="ref-for-propdef-ruby-align①">ruby-align: center</a>，
            而<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box②⑧">注释容器</a>假定为<span class="css"
                id="ref-for-propdef-ruby-align②">ruby-align: space-between</span>。
            <p>蓝色方括号（<samp class="base">[ ]</samp>）表示<a data-link-type="dfn" href="#ruby-base-box"
                    id="ref-for-ruby-base-box④②">基底盒</a>，
                红色方括号（<samp class="annot">[ ]</samp>）表示<a data-link-type="dfn" href="#ruby-annotation-box"
                    id="ref-for-ruby-annotation-box⑤⓪">注释盒</a>，
                灰色竖线（<samp class="column">|</samp>）表示<a data-link-type="dfn" href="#ruby-columns"
                    id="ref-for-ruby-columns⑧">ruby列</a>的边界。<a data-link-type="dfn" href="#ruby-container"
                    id="ref-for-ruby-container②⑥">ruby容器</a>、<a data-link-type="dfn" href="#ruby-base-container-box"
                    id="ref-for-ruby-base-container-box②⑤">基底容器</a>、<a data-link-type="dfn"
                    href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑨">注释容器</a>省略不画。</p>
            <dl>
                <dt id="ex-separate"><a class="self-link" href="#ex-separate"></a>分列/非跨越：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>  a2  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>annotation-3<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>   base 3   <span class="base">]</span><span class="column">|</span>
</pre>
                    <p>每个<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns⑨">列</a>内的盒宽以本<span
                            id="ref-for-ruby-columns①⓪">列</span>中最宽盒为准。
                        每个<a class="property css" data-link-type="property" href="#propdef-ruby-align"
                            id="ref-for-propdef-ruby-align③">ruby-align</a>在<a data-link-type="dfn"
                            href="#ruby-base-box" id="ref-for-ruby-base-box④③">基底盒</a>和<a data-link-type="dfn"
                            href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤①">注释盒</a>上决定盒内多余空间分布。</p>
                <dt id="ex-short-span"><a class="self-link" href="#ex-short-span"></a>跨越（短）：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   short span  <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 3<span class="base">]</span><span class="column">|</span>
</pre>
                    <p>当<a data-link-type="dfn" href="#spanning-annotation"
                            id="ref-for-spanning-annotation⑤">跨基底注释</a>短于所跨<a data-link-type="dfn" href="#ruby-base-box"
                            id="ref-for-ruby-base-box④④">基底</a>，
                        多余空间无需在这些<span id="ref-for-ruby-base-box④⑤">基底</span>间分配。
                        <span id="ref-for-spanning-annotation⑥">跨基底注释</span>自身多余空间按其<a class="property css"
                            data-link-type="property" href="#propdef-ruby-align"
                            id="ref-for-propdef-ruby-align④">ruby-align</a>分配，与非跨越情况相同。
                    </p>
                <dt id="ex-long-span"><a class="self-link" href="#ex-long-span"></a>跨越（长）：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>spanning annotation<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span> base 2 <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
                    <p>当<a data-link-type="dfn" href="#spanning-annotation"
                            id="ref-for-spanning-annotation⑦">跨基底注释</a>长于所跨<a data-link-type="dfn" href="#ruby-base-box"
                            id="ref-for-ruby-base-box④⑥">基底盒</a>时，
                        多余空间在它们之间平均分配。</p>
                <dt id="ex-short-merge"><a class="self-link" href="#ex-short-merge"></a>合并（短）：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>merged        annotation<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 3<span class="base">]</span><span class="column">|</span>
</pre>
                    <p><a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation①">合并注释</a>
                        行为类似<a data-link-type="dfn" href="#span" id="ref-for-span②">跨基底注释</a>，
                        但多余空间分配由<a class="property css" data-link-type="property" href="#propdef-ruby-align"
                            id="ref-for-propdef-ruby-align⑤">ruby-align</a>决定，
                        应用在<a data-link-type="dfn" href="#ruby-annotation-container-box"
                            id="ref-for-ruby-annotation-container-box③⓪">注释容器</a>上，
                        而非其<a data-link-type="dfn" href="#ruby-annotation-box"
                            id="ref-for-ruby-annotation-box⑤③">注释盒</a>。</p>
                <dt id="ex-multi-level-span"><a class="self-link" href="#ex-multi-level-span"></a>多层级、带跨越注释：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>   a1   <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> annotation-2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   a3   <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span>long annotation spanning all content<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span> base 1 <span class="base">]</span><span class="column">|</span><span class="base">[</span>    base 2    <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span>  xx  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>annotation spanning bases<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> annotation-2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   a3   <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>    base 2    <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
                    <p>如这两个多层级示例，
                        每个<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①①">列</a>按最大内容定宽，
                        若<a data-link-type="dfn" href="#spanning-annotation"
                            id="ref-for-spanning-annotation⑧">跨基底注释</a>仍长于其所跨<span
                            id="ref-for-ruby-columns①②">列</span>总宽，
                        则仍等比分配到各列。</p>
                <dt id="ex-multi-level-mutli-span"><a class="self-link" href="#ex-multi-level-mutli-span"></a>多层级、多跨越注释：
                <dd>
                    <pre class="highlight"><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span>  xx  <span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2">  </span><span class="flagtxt1">annotation spanning bases</span><span class="flagbg2">  </span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span>  a1  <span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>annotation-2<span class="flagbg1"> </span><span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>  a3  <span class="flagbg1"> </span><span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span><span class="flagtxt2">lengthy annotation spanning base content</span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span>base 1<span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>   base 2   <span class="flagbg1"> </span><span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>base 3<span class="flagbg1"> </span><span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span>
</pre>
                    <p>当存在多个<a data-link-type="dfn" href="#spanning-annotation"
                            id="ref-for-spanning-annotation⑨">跨基底注释</a>时，
                        跨基底数最少的先处理。
                        如本例中，绿色跨两基底，橙色跨三基底，
                        顺序不同会导致空间分配不同。</p>
                    <p>为方便识别每个<a data-link-type="dfn" href="#spanning-annotation"
                            id="ref-for-spanning-annotation①⓪">跨基底注释</a>负责的空间分配，
                        本图各<span id="ref-for-spanning-annotation①①">跨基底注释</span>的文本颜色与其分配空间的背景色一致。</p>
            </dl>
        </div>
        <h4 class="heading settled" data-level="3.1.2" id="interlinear-block"><span class="secno">3.1.2. </span><span
                class="content"> 块轴上的行间布局</span><a class="self-link" href="#interlinear-block"></a>
        </h4>
        <p class="issue" id="issue-e7399eec"><a class="self-link" href="#issue-e7399eec"></a> 需要定义 <a
                class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align"
                id="ref-for-propdef-vertical-align">vertical-align</a> 对这些 ruby 盒的影响范围。
            参见 <a href="https://github.com/w3c/csswg-drafts/issues/4987">Issue 4987</a>。
        </p>
        <p>然后，每个 <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⑥">基底容器</a>
            会被定尺寸和定位，
            以精确包含其所有 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⑧">ruby 基底</a>的 margin 盒 ——
            以及所有关联的 <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation③">字间</a> <a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤④">ruby 注释</a> margin 盒（如有）—— 以及所有参与本 <a
                data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑦">ruby 容器</a>、属于其后代的 <span
                id="ref-for-ruby-base-container-box②⑦">基底</span> 和 <a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③①">注释容器</a>。
            （若 <span id="ref-for-ruby-base-container-box②⑧">基底容器</span> 没有 <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#in-flow" id="ref-for-in-flow④">流内</a>内容，
            则其定尺寸和定位仿佛包含一个空的 <span id="ref-for-ruby-base-box④⑨">ruby 基底</span>。）</p>
        <p>每个 <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑥">行间</a> <a
                data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box③②">注释容器</a> 会被定尺寸和定位，
            以精确包含其所有 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤⑤">ruby 注释</a>的
            margin 盒，
            以及所有参与该<a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑥">注释层</a>的后代 <a
                data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑧">ruby 容器</a>中的 <a
                data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⑨">基底</a> 和
            <span id="ref-for-ruby-annotation-container-box③③">注释容器</span>。
            （若 <span id="ref-for-ruby-annotation-container-box③④">注释容器</span> 没有 <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#in-flow" id="ref-for-in-flow⑤">流内</a>内容，
            则其定尺寸和定位仿佛包含一个空的 <span id="ref-for-ruby-annotation-box⑤⑥">ruby 注释</span>。）
            这些 <span id="ref-for-ruby-annotation-container-box③⑤">注释容器</span> 会依次向外堆叠，
            位于其对应 <span id="ref-for-ruby-base-container-box③⓪">基底容器</span> 的上方或下方（取决于 <a class="property css"
                data-link-type="property" href="#propdef-ruby-position"
                id="ref-for-propdef-ruby-position①">ruby-position</a>），
            之间不留空隙，
            从而确定 <span id="ref-for-ruby-annotation-box⑤⑦">ruby 注释</span> 与其 <a data-link-type="dfn"
                href="#ruby-base-box" id="ref-for-ruby-base-box⑤⓪">ruby 基底</a> 的块轴定位。
        </p>
        <p class="issue" id="issue-ea5c17b0"><a class="self-link" href="#issue-ea5c17b0"></a> 块轴上的 margin 是否应折叠？
            这样可增强布局健壮性，
            但与行内轴的 inline 行为不一致。</p>
        <h3 class="heading settled" data-level="3.2" id="inter-character-layout"><span class="secno">3.2. </span><span
                class="content"> 字间 ruby 布局</span><a class="self-link" href="#inter-character-layout"></a></h3>
        <p><a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation④">字间注释</a>有特殊布局。
            <span id="ref-for-ruby-position-inter-character-annotation⑤">字间</span> <a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤⑧">ruby 注释盒</a>
            会被插入到 <a data-link-type="dfn" href="#base-level" id="ref-for-base-level③">基底层</a>的布局流程中并参与测量。
            每个 <span id="ref-for-ruby-annotation-box⑤⑨">ruby 注释</span> 被插入到其配对 <a data-link-type="dfn"
                href="#ruby-base-box" id="ref-for-ruby-base-box⑤①">ruby 基底</a>的右侧；
            <a data-link-type="dfn" href="#span" id="ref-for-span③">跨越</a>的 <span
                id="ref-for-ruby-position-inter-character-annotation⑥">字间注释</span> 则放在其所跨所有基底最右侧之后。
            <span id="ref-for-ruby-position-inter-character-annotation⑦">字间</span> <span
                id="ref-for-ruby-annotation-box⑥⓪">ruby 注释</span>的布局方式与 <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-display-3/#inline-block" id="ref-for-inline-block">inline block</a>
            几乎一致，除非下文另有说明。
        </p>
        <p class="note" role="note"><span>注：</span> 根据 <a class="css" data-link-type="maybe"
                href="#valdef-ruby-position-inter-character"
                id="ref-for-valdef-ruby-position-inter-character">inter-character</a> 的定义，<a data-link-type="dfn"
                href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation⑧">字间注释</a>总是采用 <a class="css"
                data-link-type="maybe" href="https://www.w3.org/TR/css-writing-modes-4/#valdef-writing-mode-vertical-rl"
                id="ref-for-valdef-writing-mode-vertical-rl">vertical-rl</a> 的 <a class="property css"
                data-link-type="property" href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                id="ref-for-propdef-writing-mode">writing-mode</a>，
            且只存在于 <a data-link-type="dfn" href="https://www.w3.org/TR/css-writing-modes-4/#horizontal-writing-mode"
                id="ref-for-horizontal-writing-mode">横排</a>的 <a data-link-type="dfn" href="#ruby-container"
                id="ref-for-ruby-container②⑨">ruby 容器</a>中。</p>
        <p>每个 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥①">ruby 注释</a> 紧跟在相关
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤②">ruby 基底</a>的右侧，
            位于所有 <a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space③">基底间空白</a>（或
            <a data-link-type="dfn" href="#inter-segment-white-space"
                id="ref-for-inter-segment-white-space⑤">段间空白</a>）之前。
            若多个 <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation⑨">字间</a> <span
                id="ref-for-ruby-annotation-box⑥②">ruby 注释盒</span> 紧邻同一个 <span id="ref-for-ruby-base-box⑤③">ruby
                基底</span>，
            它们的 <a data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#margin-box"
                id="ref-for-margin-box">margin 盒</a> 依次向右堆叠，无间隔，顺序按 <a data-link-type="dfn" href="#annotation-level"
                id="ref-for-annotation-level⑦">层级</a>递增。
        </p>
        <p>如果 <a data-link-type="dfn" href="https://www.w3.org/TR/css-sizing-3/#automatic-size"
                id="ref-for-automatic-size">自动高度</a> 计算下，<a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box⑥③">ruby 注释盒</a>的 <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-box-4/#content-area" id="ref-for-content-area">内容区</a> 比其后插入的 <a
                data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#content-box" id="ref-for-content-box">ruby
                基底</a>的 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤④">内容盒</a>矮，则其 <span
                id="ref-for-content-box①">内容盒</span>高度会被提升至与基底内容盒相同。</p>
        <p><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥④">ruby 注释盒</a>的对齐方式取决于其
            <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                id="ref-for-propdef-ruby-align⑥">ruby-align</a>
            属性：
        </p>
        <ul>
            <li> 若 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                    id="ref-for-propdef-ruby-align⑦">ruby-align</a> 为 <a class="css" data-link-type="maybe"
                    href="#valdef-ruby-align-start" id="ref-for-valdef-ruby-align-start">start</a>，
                则 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑥">ruby 注释</a>的 <a
                    data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#content-box"
                    id="ref-for-content-box②">内容盒</a>上边缘
                与 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑤">ruby 基底</a>的 <span
                    id="ref-for-content-box③">内容盒</span>上边缘对齐。
            <li> 否则，
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑦">ruby 注释</a>的 <a
                    data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#content-box"
                    id="ref-for-content-box④">内容盒</a>中心
                与 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑥">ruby 基底</a>的 <span
                    id="ref-for-content-box⑤">内容盒</span>中心垂直对齐。
        </ul>
        <p>某 <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①⓪">字间注释</a> 的 <a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⑥">ruby 注释容器盒</a>
            定尺寸和定位时，其内容盒应与 <a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box③①">ruby 基底容器盒</a>内容盒完全重合。</p>
        <p class="note" role="note"><span>注：</span> <a data-link-type="dfn"
                href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①①">字间</a> <a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⑦">ruby 注释容器盒</a>
            的尺寸与位置对布局无影响。
            如此定义仅为确保代码查询这些盒时结果确定。</p>
        <p>对于<a href="#ruby-align-property">对齐</a>与列尺寸（见<a href="#ruby-layout">§ 3 Ruby 布局</a>）的计算，<a
                data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①②">字间</a><a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑧">ruby 注释</a>不视为附着基底的同一<a
                data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①③">列</a>，
            它们实际上自成一<span id="ref-for-ruby-columns①④">列</span>。</p>
        <h3 class="heading settled" data-level="3.3" id="box-style"><span class="secno">3.3. </span><span
                class="content"> ruby盒样式</span><a class="self-link" href="#box-style"></a></h3>
        <p><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑦">ruby 基底</a>和<a
                data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⓪">ruby 容器</a>视为<a
                data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box⑦">行内盒</a>，
            所有适用于<span id="ref-for-inline-box⑧">行内盒</span>的属性（除非另有说明）同样适用于它们。
            但<a data-link-type="dfn" href="https://www.w3.org/TR/css-inline-3/#line-relative-shift-values"
                id="ref-for-line-relative-shift-values">行内相对偏移值</a>的<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align"
                id="ref-for-propdef-vertical-align①">vertical-align</a>（<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-top"
                id="ref-for-valdef-baseline-shift-top">top</a>，<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-bottom"
                id="ref-for-valdef-baseline-shift-bottom">bottom</a>）
            必须忽略（视为0）。</p>
        <p>所有适用于<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box⑨">行内盒</a>的属性（除非另有说明），
            同样适用于<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑨">ruby 注释</a>，
            但<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height">line-height</a>不适用。
            同时，<a data-link-type="dfn" href="https://www.w3.org/TR/css-inline-3/#line-relative-shift-values"
                id="ref-for-line-relative-shift-values①">行内相对偏移值</a>的<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align"
                id="ref-for-propdef-vertical-align②">vertical-align</a>（<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-top"
                id="ref-for-valdef-baseline-shift-top①">top</a>，<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-bottom"
                id="ref-for-valdef-baseline-shift-bottom①">bottom</a>）
            也需忽略（视为0）。</p>
        <p><a data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#margin" id="ref-for-margin">margin</a>、
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#padding" id="ref-for-padding">padding</a>、
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-box-4/#border" id="ref-for-border">border</a>属性
            以及所有不适用于<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                id="ref-for-inline-box①⓪">行内盒</a>的属性，
            均不适用于<a data-link-type="dfn" href="#ruby-base-container-box"
                id="ref-for-ruby-base-container-box③②">基底容器</a>或
            <a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box③⑧">注释容器</a>。
            此外，<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height①">line-height</a> 不适用于 <span
                id="ref-for-ruby-annotation-container-box③⑨">注释容器</span>。
        </p>
        <p>UA 不要求支持
            任何 background 属性或 outline 属性，
            也不要求在 <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③③">ruby
                基底容器盒</a>
            或 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box④⓪">ruby 注释容器盒</a>上支持任何显示盒边界的属性。
            UA 可仅将这些盒作为继承和布局内容控制的抽象实现。</p>
        <h3 class="heading settled" data-level="3.4" id="line-breaks"><span class="secno">3.4. </span><span
                class="content"> 跨行断开</span><a class="self-link" href="#line-breaks"></a></h3>
        <p>若一行无法容纳整个<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③①">ruby 容器</a>，
            则只要所有层级同时允许断开处，ruby 可在该处断开。
            （关于断行的详细内容，参见 <a href="https://www.w3.org/TR/css-text-3/#line-breaking"><cite>CSS Text 3</cite> § 5
                断行和词边界</a>。）
            ruby 通常在基底-注释对之间断开，
            但若断行规则允许，也可在<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑧">ruby 基底</a>内部（及其关联的
            <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⓪">ruby 注释盒</a>）断开。
        </p>
        <p>每当 ruby 跨行断开时，<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦①">ruby
                注释</a>必须和它们各自的<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑨">ruby
                基底</a>保持在一起。
            <em>不能</em>在 <span id="ref-for-ruby-base-box⑥⓪">ruby 基底</span>与其<span
                id="ref-for-ruby-annotation-box⑦②">注释</span>之间断开，
            即使是 <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①③">字间注释</a> 也如此。
        </p>
        <div class="figure">
            <img alt="图示“注音”ruby的断行机会" height="90" src="https://www.w3.org/TR/css-ruby-1/images/r-break-b.gif"
                width="300">
            <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-position-inter-character"
                    id="ref-for-valdef-ruby-position-inter-character①">字间</a> ruby 的断行机会 </p>
        </div>
        <p>断行后，
            每个片段会<a href="#ruby-layout">独立布局</a>，
            <a href="#ruby-align-property">ruby 对齐</a>在每个片段内分别进行。
        </p>
        <h4 class="heading settled" data-level="3.4.1" id="break-between"><span class="secno">3.4.1. </span><span
                class="content"> 基底间断开</span><a class="self-link" href="#break-between"></a></h4>
        <p>通常情况下，<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥①">ruby 基底盒</a>和<a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦③">ruby
                注释盒</a>都会避免内部换行且不包含强制断点。
            （见<a href="#default-stylesheet">附录A</a>。）
            这时<a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③②">ruby 容器</a>只能在相邻<span
                id="ref-for-ruby-base-box⑥②">ruby 基底</span>间断开，
            且只有当没有<span id="ref-for-ruby-annotation-box⑦④">ruby 注释</span>跨越这些<span
                id="ref-for-ruby-base-box⑥③">基底</span>时才可断开。</p>
        <div class="figure">
            <img alt="复杂ruby的断行机会示意图" height="201" src="https://www.w3.org/TR/css-ruby-1/images/r-break-a.gif"
                width="408">
            <p class="caption">ruby 的断行机会 </p>
        </div>
        <p>是否能在两个相邻的<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥④">ruby
                基底</a>间断开由基底文本的常规断行规则控制，
            就像<span id="ref-for-ruby-base-box⑥⑤">ruby 基底</span>是相邻的行内盒一样。
            （确定 <a data-link-type="dfn" href="#base-level" id="ref-for-base-level④">基底层</a> 软断点时会忽略注释。）</p>
        <div class="example" id="example-9780a5d8">
            <a class="self-link" href="#example-9780a5d8"></a> 例如，若相邻两个 ruby 基底是“蝴”和“蝶”，
            行可在它们之间断开，
            因为汉字间通常允许断行。
            但若<a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-text-3/#propdef-word-break"
                id="ref-for-propdef-word-break">word-break</a>为<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-text-3/#valdef-word-break-keep-all"
                id="ref-for-valdef-word-break-keep-all">keep-all</a>，则此断行被禁止。
            <pre
                class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->蝴<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->hú<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->蝶<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->dié<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-></pre>
        </div>
        <p>基底间空白对判断<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥⑥">ruby 基底</a>间的断行机会很重要。
            如同行内空白，
            断行时会被折叠，
            规则见<a href="https://www.w3.org/TR/css-text-3/#white-space-rules"><cite>CSS Text 3</cite> § 4.1 空白处理规则</a>。
            注释间空白在断行时也会被裁剪。</p>
        <div class="example" id="example-070966be">
            <a class="self-link" href="#example-070966be"></a> 例如，以下标记：
            <pre
                class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->one<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->two<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
            <p>由于存在空格，行可在“one”和“two”之间断开。
                若断行于此，空格（及“1”和“2”之间的空格）会消失，符合 CSS 标准空白处理规则。</p>
        </div>
        <h4 class="heading settled" data-level="3.4.2" id="break-within"><span class="secno">3.4.2. </span><span
                class="content"> 基底内断开</span><a class="self-link" href="#break-within"></a></h4>
        <p>对于较长的基底文本，有时可以允许在基底-注释对内断行。
            例如，用日文翻译为注解的英文句子，
            允许文本换行能让段落获得合理的断行效果。</p>
        <p class="issue" id="issue-14d7c6b1"><a class="self-link" href="#issue-14d7c6b1"></a>
            需要插入实际扫描样例，避免让人以为这只是规范作者的胡思乱想。</p>
        <p>只有在 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥⑦">ruby 基底</a> 及其所有并行 <a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑤">注释</a> 的 <a
                class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-text-3/#propdef-white-space"
                id="ref-for-propdef-white-space②">white-space</a> 属性允许，
            且每个基底/注释盒内容内（不是开头或结尾）存在<a data-link-type="dfn"
                href="https://www.w3.org/TR/css-text-3/#soft-wrap-opportunity"
                id="ref-for-soft-wrap-opportunity">软断点</a>时，才允许在基底内断行。
            由于 <span id="ref-for-ruby-base-box⑥⑨">ruby 基底</span>与<span
                id="ref-for-ruby-annotation-box⑦⑥">注释</span>内容片段之间无结构对应关系，
            UA 可在任意机会断行；
            但推荐 UA 尽可能平衡每个片段内的内容量。</p>
        <p><a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①④">字间注释</a>内部不允许断行。</p>
        <h3 class="heading settled" data-level="3.5" id="bidi"><span class="secno">3.5. </span><span class="content">
                双向重排</span><a class="self-link" href="#bidi"></a></h3>
        <p>Unicode 双向算法会在单段落内混用不同方向书写体系的字符时，
            按视觉展示重排逻辑存储的文本。</p>
        <p>为保持<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑦">ruby 注释</a>与各自<a
                data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⓪">ruby 基底</a>的对应关系，
            必须施加如下限制：</p>
        <ul>
            <li><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦①">ruby 基底</a>或<a
                    data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑧">ruby
                    注释</a>的内容必须保持连续。
            <li><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑨">ruby 注释</a>必须与其<a
                    data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦②">ruby 基底</a>一起重排。
            <li>所有被同一<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⓪">ruby
                    注释</a>跨越的<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦③">ruby
                    基底</a>必须保持连续。
        </ul>
        <p>为此，</p>
        <ul>
            <li>
                所有<a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes②">内部 ruby 盒</a>及<a
                    data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③③">ruby 容器</a>都强制 bidi 隔离：
                <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-normal"
                    id="ref-for-valdef-unicode-bidi-normal">normal</a> 和 <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-embed"
                    id="ref-for-valdef-unicode-bidi-embed">embed</a> 的 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-writing-modes-3/#propdef-unicode-bidi"
                    id="ref-for-propdef-unicode-bidi">unicode-bidi</a> 计算为 <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate"
                    id="ref-for-valdef-unicode-bidi-isolate">isolate</a>，
                <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-bidi-override"
                    id="ref-for-valdef-unicode-bidi-bidi-override">bidi-override</a> 计算为 <a class="css"
                    data-link-type="maybe"
                    href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate-override"
                    id="ref-for-valdef-unicode-bidi-isolate-override">isolate-override</a>。
                <p class="note" role="note"><span>注：</span> 这意味着隐式 bidi 重排不会跨 ruby 基底生效，
                    作者应确保 <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③④">ruby 容器</a>
                    的声明方向与其内容一致。</p>
            <li> 布局时，<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑤">ruby 段</a> 在 <a
                    data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⑤">ruby 容器</a> 内的顺序由其 <a
                    class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-writing-modes-3/#propdef-direction"
                    id="ref-for-propdef-direction">direction</a> 属性决定。
            <li>
                在段内，未<a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation②">合并</a>的<a
                    data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦④">ruby 基底</a>和<a
                    data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧①">ruby
                    注释</a>在各自容器中的顺序由该段 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-writing-modes-3/#propdef-direction"
                    id="ref-for-propdef-direction①">direction</a> 属性决定。
                <span id="ref-for-merged-annotation③">合并注释</span>在其<a data-link-type="dfn"
                    href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④①">注释容器</a>上按 <span
                    class="property" id="ref-for-propdef-direction②">direction</span> 排序，
                就像它们是该 <span id="ref-for-ruby-annotation-container-box④②">注释容器</span> 内的行内盒序列一样。
                <p class="note" role="note"><span>注：</span> 这意味着 <a class="property css" data-link-type="property"
                        href="https://www.w3.org/TR/css-writing-modes-3/#propdef-direction"
                        id="ref-for-propdef-direction③">direction</a> 属性对非<a data-link-type="dfn"
                        href="#merged-annotation" id="ref-for-merged-annotation④">合并</a>注释的布局无效。
                    但它依然可以继承给容器的子元素，
                    从而影响其中任何<a data-link-type="dfn"
                        href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction"
                        id="ref-for-inline-base-direction">行内基方向</a>的<a data-link-type="dfn" href="#ruby-annotation-box"
                        id="ref-for-ruby-annotation-box⑧②">ruby 注释</a>。</p>
        </ul>
        <p>如同其它行内级内容，
            <a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes③">内部 ruby 盒</a>的 bidi
            重排在断行后进行，
            以保证内容按逻辑顺序分行。
        </p>
        <p class="note" role="note"><span>注：</span> 若在某 <a class="property css" data-link-type="property"
                href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑤">ruby-merge</a> 为 <a class="css"
                data-link-type="maybe" href="#valdef-ruby-merge-merge" id="ref-for-valdef-ruby-merge-merge①">merge</a>
            的<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box④④">注释容器</a>上，不强制各注释的 bidi 隔离，
            允许一起处理，或许会有用。
            但这会增加实现复杂性，目前没有需求。
            有实际需求者请联系 CSS 工作组。</p>
        <p>关于 CSS 中双向文本的更深入讨论，参见<a data-link-type="biblio" href="#biblio-css3-writing-modes"
                title="CSS Writing Modes Level 3">[CSS3-WRITING-MODES]</a>。</p>
        <h3 class="heading settled" data-level="3.6" id="line-height"><span class="secno">3.6. </span><span
                class="content"> 行间距</span><a class="self-link" href="#line-height"></a></h3>
        <p><a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height②">line-height</a> 属性控制 CSS 中的行间距。
            当一行中的行内内容高度小于 <span class="property" id="ref-for-propdef-line-height③">line-height</span> 时，
            会在内容上下各添加一半行距（half-leading），
            具体见 <a href="https://www.w3.org/TR/css-inline-3/#line-height"><cite>CSS Inline Layout 3</cite>
                § 5 逻辑高度与行间距</a>。</p>
        <p>为了确保行距一致，
            含 ruby 的文档通常会确保 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height④">line-height</a> 足够大，
            能容纳行间 ruby。
            因此，通常 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box④⑤">ruby 注释容器</a>和 <a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧③">ruby 注释盒</a>不会影响该行行内内容的高度测量；
            对齐（见 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align"
                id="ref-for-propdef-vertical-align③">vertical-align</a>）和行高计算
            仅以 <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑤">ruby
                基底容器</a>为准，
            就像它是普通行内元素一样。</p>
        <p>但如果 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height⑤">line-height</a> 设置在 <a data-link-type="dfn" href="#ruby-container"
                id="ref-for-ruby-container③⑦">ruby 容器</a>上且小于
            最上方 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box④⑥">ruby 注释容器</a>顶部到最下方
            <span id="ref-for-ruby-annotation-container-box④⑦">ruby 注释容器</span>底部的距离，
            就会在 <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑥">ruby
                基底容器</a> 上适当一侧添加额外的行距，
            这样如果一个块包含三行内容且每行 ruby 都一样，
            则各 <span id="ref-for-ruby-container③⑧">ruby 容器</span>不会重叠。
        </p>
        <p class="note" role="note"><span>注：</span> 这不能确保 <a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box⑧④">ruby 注释</a>始终保留在行盒内。
            它只是保证<em>如果所有行间距相等</em>且 ruby 注释数量和位置等价，
            就不会重叠。
        </p>
        <p>作者应确保 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height"
                id="ref-for-propdef-line-height⑥">line-height</a> 和 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-box-4/#propdef-padding" id="ref-for-propdef-padding">padding</a> 足够容纳
            ruby，
            并在块级开头、结尾以及某行包含高度大于段落默认字号的行内内容（如图片、inline-block、或用 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align"
                id="ref-for-propdef-vertical-align④">vertical-align</a> 上移的元素）时特别注意。</p>
        <div class="figure">
            <img alt="每行内容位于其 line-height 中部；上下额外空间为 half-leading。如果 ruby 小于两倍 half-leading，则能容纳于行间，但它会占据上一行 half-leading 空间。"
                height="138" src="https://www.w3.org/TR/css-ruby-1/images/rlh-a.gif" width="210">
            <p class="caption">Ruby 注释常常溢出行盒；
                作者应确保 ruby 注释行上下内容有足够空间留给 ruby。</p>
        </div>
        <p class="note" role="note"><span>注：</span> 更细粒度的 ruby 对齐和行布局控制将在 CSS Line Layout Module Level 3 实现。
            目前尚处于探索阶段，
            新特性说明尚不可靠。</p>
        <h2 class="heading settled" data-level="4" id="ruby-props"><span class="secno">4. </span><span class="content">
                Ruby 格式属性</span><a class="self-link" href="#ruby-props"></a></h2>
        <p>下列属性用于控制 ruby 的<a href="#rubypos">定位</a>、<a href="#collapsed-ruby">文本分布</a>与<a href="#rubyalign">对齐</a>。</p>
        <h3 class="heading settled" data-level="4.1" id="rubypos"><span class="secno">4.1. </span><span class="content">
                Ruby 定位：<a class="property css" data-link-type="property" href="#propdef-ruby-position"
                    id="ref-for-propdef-ruby-position②">ruby-position</a> 属性</span><a class="self-link"
                href="#rubypos"></a></h3>
        <table class="def propdef" data-link-for-hint="ruby-position">
            <tbody>
                <tr>
                    <th>名称:
                    <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export
                            id="propdef-ruby-position">ruby-position</dfn>
                <tr class="value">
                    <th><a href="https://www.w3.org/TR/css-values/#value-defs">值:</a>
                    <td class="prod">[ alternate <a data-link-type="grammar"
                            href="https://www.w3.org/TR/css-values-4/#comb-any" id="ref-for-comb-any">||</a> [ over <a
                            data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one"
                            id="ref-for-comb-one④">|</a> under ] ] <span id="ref-for-comb-one⑤">|</span> inter-character
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">初始值:</a>
                    <td>alternate
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">适用元素:</a>
                    <td>ruby 注释容器
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">可继承:</a>
                    <td>是
                <tr>
                    <th><a href="https://www.w3.org/TR/css-values/#percentages">百分比:</a>
                    <td>n/a
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#computed">计算值:</a>
                    <td>指定关键字
                <tr>
                    <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">规范顺序:</a>
                    <td>依语法
                <tr>
                    <th><a href="https://www.w3.org/TR/web-animations/#animation-type">动画类型:</a>
                    <td>离散
        </table>
        <p>该属性控制 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⑥">ruby
                注释</a>相对于基底的位置。
            各值含义如下：</p>
        <dl>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export
                    id="valdef-ruby-position-alternate">alternate</dfn>
            <dd>
                不同<a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑧">层级</a>的注释在 <a
                    class="css" data-link-type="maybe" href="#valdef-ruby-position-over"
                    id="ref-for-valdef-ruby-position-over">上方</a> 和 <a class="css" data-link-type="maybe"
                    href="#valdef-ruby-position-under" id="ref-for-valdef-ruby-position-under">下方</a>交替排列。
                <p>如果 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                        id="ref-for-ruby-annotation-container-box④⑧">注释容器</a>是其 <a data-link-type="dfn"
                        href="#ruby-segments" id="ref-for-ruby-segments①⑥">ruby 段</a>的第一<a data-link-type="dfn"
                        href="#annotation-level" id="ref-for-annotation-level⑨">层级</a>，
                    或之前所有 <span id="ref-for-annotation-level①⓪">层级</span>都是 <a data-link-type="dfn"
                        href="#ruby-position-inter-character-annotation"
                        id="ref-for-ruby-position-inter-character-annotation①⑤">字间</a>注释，
                    那么 <a class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate"
                        id="ref-for-valdef-ruby-position-alternate">alternate</a>，无论单独还是与 <a class="css"
                        data-link-type="maybe" href="#valdef-ruby-position-over"
                        id="ref-for-valdef-ruby-position-over①">over</a> 组合，
                    行为都等同于 <span class="css" id="ref-for-valdef-ruby-position-over②">over</span>，
                    而与 <a class="css" data-link-type="maybe" href="#valdef-ruby-position-under"
                        id="ref-for-valdef-ruby-position-under①">under</a> 组合时等同于 <span class="css"
                        id="ref-for-valdef-ruby-position-under②">under</span>。</p>
                <p>否则，
                    如果前一个<a data-link-type="dfn" href="#interlinear-annotations"
                        id="ref-for-interlinear-annotations⑦">行间</a>注释层为 <a class="css" data-link-type="maybe"
                        href="#valdef-ruby-position-over" id="ref-for-valdef-ruby-position-over③">over</a>，则 <a
                        class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate"
                        id="ref-for-valdef-ruby-position-alternate②">alternate</a> 等同于 <a class="css"
                        data-link-type="maybe" href="#valdef-ruby-position-under"
                        id="ref-for-valdef-ruby-position-under③">under</a>，
                    反之亦然。
                    （此时 <span class="css" id="ref-for-valdef-ruby-position-alternate③">alternate</span> 单独指定还是与 <span
                        class="css" id="ref-for-valdef-ruby-position-over④">over</span> 或
                    <span class="css" id="ref-for-valdef-ruby-position-under④">under</span> 组合无差别。）
                </p>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export
                    id="valdef-ruby-position-over">over</dfn>
            <dd>
                注释显示在基底<a data-link-type="dfn" href="https://www.w3.org/TR/css-writing-modes-4/#line-over"
                    id="ref-for-line-over">上方</a>。
                <div class="figure">
                    <img alt="横排模式下 ruby 注释显示在基底上方的图示" height="33"
                        src="https://www.w3.org/TR/css-ruby-1/images/shinkansen-top.gif" width="140">
                    <p class="caption">横排日文基底上方的 ruby 注释 </p>
                </div>
                <div class="figure">
                    <img alt="竖排模式下 ruby 注释显示在基底右侧的图示"
                        src="https://www.w3.org/TR/css-ruby-1/images/shinkansen-right.gif" width="33">
                    <p class="caption">竖排日文基底右侧的 ruby 注释 </p>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export
                    id="valdef-ruby-position-under">under</dfn>
            <dd>
                注释显示在基底<a data-link-type="dfn" href="https://www.w3.org/TR/css-writing-modes-4/#line-under"
                    id="ref-for-line-under">下方</a>。
                该设置在东亚表意文字系统中较少见，
                最常用于教科书等。
                <div class="figure">
                    <img alt="横排模式下 ruby 注释显示在基底下方的图示" height="36"
                        src="https://www.w3.org/TR/css-ruby-1/images/shinkansen-bottom.gif" width="142">
                    <p class="caption">横排日文基底下方的 ruby 注释 </p>
                </div>
                <div class="figure">
                    <img alt="竖排模式下 ruby 注释显示在基底左侧的图示" height="141"
                        src="https://www.w3.org/TR/css-ruby-1/images/shinkansen-left.gif" width="37">
                    <p class="caption">竖排日文基底左侧的 ruby 注释 </p>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export
                    id="valdef-ruby-position-inter-character">inter-character</dfn>
            <dd>
                若外层<a data-link-type="dfn" href="https://www.w3.org/TR/css-writing-modes-4/#writing-mode"
                    id="ref-for-writing-mode">writing-mode</a>为<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-writing-modes-4/#vertical-writing-mode"
                    id="ref-for-vertical-writing-mode">竖排</a>，
                则效果等同于 <a class="css" data-link-type="maybe" href="#valdef-ruby-position-over"
                    id="ref-for-valdef-ruby-position-over⑤">over</a>。
                <p>否则，ruby 注释会成为<dfn class="dfn-paneled" data-dfn-for="ruby-position" data-dfn-type="dfn"
                        data-local-lt="inter-character" data-noexport
                        id="ruby-position-inter-character-annotation">字间注释</dfn>，
                    注释显示在基底右侧（横排文本）。
                    这会强制该 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                        id="ref-for-ruby-annotation-container-box④⑨">ruby 注释容器</a>下 <a data-link-type="dfn"
                        href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⑦">ruby 注释</a>子元素的 <a
                        class="property css" data-link-type="property"
                        href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                        id="ref-for-propdef-writing-mode①">writing-mode</a> 计算值为 <a class="css" data-link-type="maybe"
                        href="https://www.w3.org/TR/css-writing-modes-4/#valdef-writing-mode-vertical-rl"
                        id="ref-for-valdef-writing-mode-vertical-rl①">vertical-rl</a>。</p>
                <p class="note" role="note"><span>注：</span> <a class="property css" data-link-type="property"
                        href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                        id="ref-for-propdef-writing-mode②">writing-mode</a> 在 <a data-link-type="dfn"
                        href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⓪">ruby 注释容器</a>
                    本身的计算值不受影响。
                    这样可以避免 <span class="property" id="ref-for-propdef-writing-mode③">writing-mode</span>、
                    <a class="property css" data-link-type="property"
                        href="https://www.w3.org/TR/css-display-3/#propdef-display"
                        id="ref-for-propdef-display①⑧">display</a>、
                    <a class="property css" data-link-type="property" href="#propdef-ruby-position"
                        id="ref-for-propdef-ruby-position③">ruby-position</a> 之间的循环依赖。
                </p>
                <p>此值用于台湾等地传统中文的特殊情况：
                    ruby（多为 <a href="#g-bopomofo">注音符号</a>）在这种情况下
                    即使主文为横排也总是出现在基字右侧竖排：</p>
                <div class="figure">
                    <img alt="台湾风格 ruby 示例" height="42" src="https://www.w3.org/TR/css-ruby-1/images/bopomofo.gif"
                        width="138">
                    <p class="caption">传统中文“注音”ruby（蓝色为清晰起见）横排布局</p>
                </div>
                <div class="note" role="note">
                    注：继承作用于元素树，不考虑 ruby 布局生成的匿名盒，
                    使用 <a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                        id="ref-for-ruby-position-inter-character-annotation①⑥">字间注释</a> 时，
                    作者需避免如下标记结构：
                    元素式 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                        id="ref-for-ruby-annotation-container-box⑤①">ruby 注释容器</a>，
                    匿名 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⑧">ruby
                        注释</a>，
                    以及更深层后代元素，
                    因为这些后代会继承 <span id="ref-for-ruby-annotation-container-box⑤②">ruby 注释容器</span>的 writing-mode，
                    而不是 <span id="ref-for-ruby-annotation-box⑧⑨">ruby 注释</span>的 <a class="property css"
                        data-link-type="property" href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                        id="ref-for-propdef-writing-mode④">writing-mode</a>（已被强制为 vertical-rl）。
                    <div class="example" id="example-af80289a">
                        <a class="self-link" href="#example-af80289a"></a>
                        <pre
                            class="highlight">ruby <c- p>{</c-> <c- k>ruby-position</c-><c- p>:</c-> inter-character<c- p>;</c-> <c- p>}</c-></pre>
                        <pre
                            class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->base<c- p>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>em</c-><c- p>></c->problematic<c- p>&lt;/</c-><c- f>em</c-><c- p>></c-> annotation<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
                        <p>如上例，匿名 <a data-link-type="dfn" href="#ruby-annotation-box"
                                id="ref-for-ruby-annotation-box⑨⓪">ruby 注释</a>盒作为 <code>&lt;rtc></code>
                            的子盒包裹“problematic annotation”。
                            它作为<a data-link-type="dfn" href="#ruby-annotation-container-box"
                                id="ref-for-ruby-annotation-container-box⑤③">注释容器</a>的子元素，<a class="property css"
                                data-link-type="property" href="#propdef-ruby-position"
                                id="ref-for-propdef-ruby-position④">ruby-position</a>为 <a class="css"
                                data-link-type="maybe" href="#valdef-ruby-position-inter-character"
                                id="ref-for-valdef-ruby-position-inter-character②">inter-character</a>，
                            因此其 <a class="property css" data-link-type="property"
                                href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                                id="ref-for-propdef-writing-mode⑤">writing-mode</a> 被强制为 <a class="css"
                                data-link-type="maybe"
                                href="https://www.w3.org/TR/css-writing-modes-4/#valdef-writing-mode-vertical-rl"
                                id="ref-for-valdef-writing-mode-vertical-rl③">vertical-rl</a>，这没问题。
                            但 <code>&lt;em></code> 元素直接继承 <code>&lt;rtc></code> 的 <span class="property"
                                id="ref-for-propdef-writing-mode⑥">writing-mode</span>，并非 ruby 注释的 vertical-rl。
                        </p>
                        <p>若不需要显式 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                                id="ref-for-ruby-annotation-container-box⑤④">ruby 注释容器</a> 元素，
                            用 <a data-link-type="dfn" href="#ruby-annotation-box"
                                id="ref-for-ruby-annotation-box⑨①">ruby 注释</a> 元素可避免此问题：</p>
                        <pre
                            class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->base<c- p>&lt;</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>em</c-><c- p>></c->problematic<c- p>&lt;/</c-><c- f>em</c-><c- p>></c-> annotation<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
                        <p>如需显式 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                                id="ref-for-ruby-annotation-container-box⑤⑤">ruby 注释容器</a>，
                            也应配合 <a data-link-type="dfn" href="#ruby-annotation-box"
                                id="ref-for-ruby-annotation-box⑨②">ruby 注释</a> 元素：</p>
                        <pre
                            class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->base<c- p>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>em</c-><c- p>></c->problematic<c- p>&lt;/</c-><c- f>em</c-><c- p>></c-> annotation<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
                    </div>
                </div>
        </dl>
        <p>不是<a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①⑦">字间注释</a>的<a data-link-type="dfn"
                href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⑥">注释容器</a>被称为<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-local-lt="interlinear" data-noexport
                id="interlinear-annotations">行间注释</dfn>。</p>
        <p>若多个<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box⑤⑦">ruby 注释容器</a>具有相同的 <a class="property css"
                data-link-type="property" href="#propdef-ruby-position"
                id="ref-for-propdef-ruby-position⑤">ruby-position</a>，
            它们会自基底文本向外堆叠。</p>
        <h3 class="heading settled" data-level="4.2" id="collapsed-ruby"><span class="secno">4.2. </span><span
                class="content"> 共享注释空间：<a class="property css" data-link-type="property" href="#propdef-ruby-merge"
                    id="ref-for-propdef-ruby-merge⑥">ruby-merge</a> 属性</span><a class="self-link"
                href="#collapsed-ruby"></a></h3>
        <table class="def propdef" data-link-for-hint="ruby-merge">
            <tbody>
                <tr>
                    <th>名称:
                    <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export
                            id="propdef-ruby-merge">ruby-merge</dfn>
                <tr class="value">
                    <th><a href="https://www.w3.org/TR/css-values/#value-defs">值:</a>
                    <td class="prod">separate <a data-link-type="grammar"
                            href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> merge <span
                            id="ref-for-comb-one⑦">|</span> auto
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">初始值:</a>
                    <td>separate
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">适用元素:</a>
                    <td><a data-link-type="dfn" href="#interlinear-annotations"
                            id="ref-for-interlinear-annotations⑧">行间</a> ruby 注释容器
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">可继承:</a>
                    <td>是
                <tr>
                    <th><a href="https://www.w3.org/TR/css-values/#percentages">百分比:</a>
                    <td>n/a
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#computed">计算值:</a>
                    <td>指定关键字
                <tr>
                    <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">规范顺序:</a>
                    <td>依语法
                <tr>
                    <th><a href="https://www.w3.org/TR/web-animations/#animation-type">动画类型:</a>
                    <td>按计算值类型
        </table>
        <p>该属性控制当一个 ruby 容器盒内有多个 ruby 注释盒时，
            应如何渲染：
            是每对独立分隔，
            还是将注释<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="merged annotation | merged" data-noexport
                id="merged-annotation">合并</dfn>为一组渲染，
            或根据空间自动决定分隔方式。</p>
        <p class="note" role="note"><span>注：</span> <a data-link-type="dfn"
                href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①⑧">字间注释</a>始终分隔，该属性无效。</p>
        <p>可能的取值：</p>
        <dl>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export
                    id="valdef-ruby-merge-separate">separate</dfn>
            <dd>
                每个 ruby 注释盒均在其对应的 <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①⑤">列</a>中渲染，
                即不会与相邻基底重叠。
                这种风格在 <a data-link-type="biblio" href="#biblio-jlreq"
                    title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a> 中称为“单 ruby”。
                <figure>
                    <img alt="如“上手”配对注释，若注释比基底长，则额外空间分配在该基底周围，短注释则直接与基底对齐。" height="57"
                        src="https://www.w3.org/TR/css-ruby-1/images/ruby-mono.png" width="207">
                    <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge"
                            id="ref-for-propdef-ruby-merge⑦">ruby-merge: separate</a> 居中对齐示意</figcaption>
                </figure>
                <div class="example" id="example-4b06efaa">
                    <a class="self-link" href="#example-4b06efaa"></a> 例如，下列两行渲染一致：
                    <pre
                        class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->無<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
<c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-> <c- e>style</c-><c- o>=</c-><c- s>"ruby-merge:separate"</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->無<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->常<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-><c- f>ruby</c-><c- p>></c-></pre>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export
                    id="valdef-ruby-merge-merge">merge</dfn>
            <dd>
                同一行内同一<a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑦">ruby 段</a>内所有 <a
                    data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨③">ruby 注释盒</a>
                会作为<a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-box"
                    id="ref-for-inline-box①①">行内盒</a>拼接进其 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑤⑧">注释容器</a>，
                并以单一匿名 <span id="ref-for-ruby-annotation-box⑨④">ruby 注释盒</span>跨越所有 <a data-link-type="dfn"
                    href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑤">ruby 基底盒</a>布局。
                单行时这种风格类似于 <a data-link-type="biblio" href="#biblio-jlreq"
                    title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a> 的“组 ruby”。
                跨行时，<span id="ref-for-ruby-annotation-box⑨⑤">ruby 注释</span>仍与各自 <span id="ref-for-ruby-base-box⑦⑥">ruby
                    基底</span>保持配对。
                <figure>
                    <img alt="合并注释会整体居中于合并基底，即使注释已超出各自基底范围。" height="57"
                        src="https://www.w3.org/TR/css-ruby-1/images/ruby-merge.png" width="189">
                    <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge"
                            id="ref-for-propdef-ruby-merge⑧">ruby-merge: merge</a> 居中对齐示意</figcaption>
                </figure>
                <div class="example" id="example-eeb77956">
                    <a class="self-link" href="#example-eeb77956"></a> 若两字符同在一行，以下两行渲染一致：
                    <pre
                        class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->無常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->むじょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
<c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-> <c- e>style</c-><c- o>=</c-><c- s>"ruby-merge:merge"</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->無<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->常<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-><c- f>ruby</c-><c- p>></c-></pre>
                    <p>但当基底跨行时，后者表现同 <a class="css" data-link-type="propdesc" href="#propdef-ruby-position"
                            id="ref-for-propdef-ruby-position⑥">ruby-position:
                            separate</a>。</p>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export
                    id="valdef-ruby-merge-auto">auto</dfn>
            <dd>
                UA 可采用任意算法决定每个 ruby 注释盒如何与其基底盒配对渲染，
                但应尽量保证所有注释能对齐各自基底时效果等同于 <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate"
                    id="ref-for-valdef-ruby-merge-separate②">separate</a>，
                若部分注释宽于基底，则空间会被合适分配，避免基底间出现空隙。
                <figure>
                    <img alt="有足够空间时注释对齐各自基底，否则跨基底共享空间。" height="57"
                        src="https://www.w3.org/TR/css-ruby-1/images/ruby-jukugo.png" width="189">
                    <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge"
                            id="ref-for-propdef-ruby-merge⑨">ruby-merge: auto</a> 居中对齐示意</figcaption>
                </figure>
                <div class="note" role="note">
                    注：此行为用于复合词，
                    见 <a href="https://www.w3.org/International/questions/qa-ruby#jukugo">“Jukugo Ruby” in “What is
                        ruby?”</a>。<a data-link-type="biblio" href="#biblio-qa-ruby" title="What is ruby?">[QA-RUBY]</a>
                    <p>各种实现方式见 <a href="https://www.w3.org/TR/simple-ruby/#placement-of-jukugo-ruby">Placement of
                            Jukugo-ruby</a> (<a data-link-type="biblio" href="#biblio-simple-ruby"
                            title="Rules for Simple Placement of Japanese Ruby">[SIMPLE-RUBY]</a>)、<a
                            href="https://www.w3.org/TR/jlreq/#positioning_of_jukugoruby_with_respect_to_base_characters">JLREQ</a>
                        及
                        <cite>4.12.3(c) 熟语 ruby 的处理</cite>（<a data-link-type="biblio" href="#biblio-jisx4051"
                            title="Line composition rules for Japanese documents.">[JISX4051]</a>）等。
                    </p>
                    <p>最简单实现是：
                        若所有 ruby 注释盒能容纳于各自基底宽度内则渲染为 <a class="css" data-link-type="maybe"
                            href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate③">separate</a>，
                        否则渲染为 <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge"
                            id="ref-for-valdef-ruby-merge-merge②">merge</a>。
                    </p>
                </div>
        </dl>
        <p class="note" role="note"><span>注：</span> 文本不会跨 <a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box⑨⑥">ruby 注释</a>或
            <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑦">基底</a>（即使合并的）自动连写或形成连字，
            因为有 <a data-link-type="dfn" href="https://www.w3.org/TR/css-writing-modes-4/#bidi-isolate"
                id="ref-for-bidi-isolate">bidi 隔离</a>。
            见 <a href="#bidi">§ 3.5 双向重排</a> 和 <a href="https://www.w3.org/TR/css-text-3/#boundary-shaping"><cite>CSS
                    Text 3</cite> § 7.3 跨元素边界的字形处理</a>。
        </p>
        <h3 class="heading settled" data-level="4.3" id="ruby-align-property"><span class="secno">4.3. </span><span
                class="content"><span id="rubyalign"></span> Ruby 文本分布：<a class="property css" data-link-type="property"
                    href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑧">ruby-align</a>
                属性</span><a class="self-link" href="#ruby-align-property"></a></h3>
        <table class="def propdef" data-link-for-hint="ruby-align">
            <tbody>
                <tr>
                    <th>名称:
                    <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export
                            id="propdef-ruby-align">ruby-align</dfn>
                <tr class="value">
                    <th><a href="https://www.w3.org/TR/css-values/#value-defs">值:</a>
                    <td class="prod">start <a data-link-type="grammar"
                            href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> center
                        <span id="ref-for-comb-one⑨">|</span> space-between <span id="ref-for-comb-one①⓪">|</span>
                        space-around
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">初始值:</a>
                    <td>space-around
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">适用元素:</a>
                    <td>ruby 基底、ruby 注释、ruby 基底容器、ruby 注释容器
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">可继承:</a>
                    <td>是
                <tr>
                    <th><a href="https://www.w3.org/TR/css-values/#percentages">百分比:</a>
                    <td>n/a
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#computed">计算值:</a>
                    <td>指定关键字
                <tr>
                    <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">规范顺序:</a>
                    <td>依语法
                <tr>
                    <th><a href="https://www.w3.org/TR/web-animations/#animation-type">动画类型:</a>
                    <td>按计算值类型
        </table>
        <p>该属性指定当 ruby 盒内容未完全填满各自盒子时，文本在盒内如何分布。
            注意 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                id="ref-for-propdef-ruby-align⑨">ruby-align</a> 分布的空白与两端对齐分布的空白无关且互不影响。</p>
        <p>对于<a data-link-type="dfn" href="#ruby-position-inter-character-annotation"
                id="ref-for-ruby-position-inter-character-annotation①⑨">字间注释</a>，
            该属性也可影响盒本身的对齐（见<a href="#inter-character-layout">§ 3.2 字间 Ruby 布局</a>）。
            其它情况下只影响盒内内容对齐，不影响盒本身尺寸或位置。</p>
        <p>各值含义如下：</p>
        <dl>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export
                    id="valdef-ruby-align-start">start</dfn>
            <dd>
                ruby 内容与盒起始边对齐。
                <div class="figure">
                    <img alt="ruby 文本短于基底时左对齐排布图示" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ra-l.gif"
                        width="145"> <img alt="ruby 文本长于基底时左对齐排布图示" height="91"
                        src="https://www.w3.org/TR/css-ruby-1/images/ra-l-rb.gif" width="145">
                    <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-start"
                            id="ref-for-valdef-ruby-align-start①">start</a> ruby 文本分布 </p>
                </div>
                <p class="issue" id="issue-41435749"><a class="self-link" href="#issue-41435749"></a> “肩付きルビ”(Katatsuki
                    ruby) 与
                    此 <a class="css" data-link-type="maybe" href="#valdef-ruby-align-start"
                        id="ref-for-valdef-ruby-align-start②">start</a> 值类似但不完全相同。
                    特别是在超出基底时，
                    其行为可能随上下文与 start 对齐不同，
                    见 <a
                        href="https://www.w3.org/TR/jlreq/#positioning_of_monoruby_with_respect_to_base_characters">JLREQ</a>。
                    此风格仅用于竖排，且 JLTF 认为其重要性不高，
                    是否值得为 katatsuki ruby 优化存疑。
                    若 <span class="css" id="ref-for-valdef-ruby-align-start③">start</span> 另有用途可保留，否则可考虑移除。</p>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export
                    id="valdef-ruby-align-center">center</dfn>
            <dd>
                ruby 内容在盒内居中。
                <div class="figure">
                    <img alt="ruby 文本短于基底时居中排布图示" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ra-c.gif"
                        width="145"> <img alt="ruby 文本长于基底时居中排布图示" height="91"
                        src="https://www.w3.org/TR/css-ruby-1/images/ra-c-rb.gif" width="145">
                    <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-center"
                            id="ref-for-valdef-ruby-align-center">center</a> ruby 文本分布 </p>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export
                    id="valdef-ruby-align-space-between">space-between</dfn>
            <dd>
                ruby 内容按常规文本两端对齐方式扩展分布
                （由 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-text-3/#propdef-text-justify"
                    id="ref-for-propdef-text-justify">text-justify</a> 定义），
                但若无<a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#justification-opportunity"
                    id="ref-for-justification-opportunity">对齐机会</a>则居中显示。
                <div class="figure">
                    <img alt="ruby 文本短于基底时两端分布图示" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ra-dl.gif"
                        width="145"> <img alt="ruby 文本长于基底时两端分布图示" height="91"
                        src="https://www.w3.org/TR/css-ruby-1/images/ra-dl-rb.gif" width="145">
                    <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between"
                            id="ref-for-valdef-ruby-align-space-between">space-between</a> ruby 文本分布 </p>
                </div>
            <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export
                    id="valdef-ruby-align-space-around">space-around</dfn>
            <dd>
                类似 <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between"
                    id="ref-for-valdef-ruby-align-space-between①">space-between</a>，但多一个<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-text-3/#justification-opportunity"
                    id="ref-for-justification-opportunity①">对齐机会</a>，空白在 ruby 内容前后各分一半。
                <div class="figure">
                    <img alt="ruby 文本短于基底时自动分布图示" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ra-ds.gif"
                        width="145"> <img alt="ruby 文本长于基底时自动分布图示" height="91"
                        src="https://www.w3.org/TR/css-ruby-1/images/ra-ds-rb.gif" width="145">
                    <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around"
                            id="ref-for-valdef-ruby-align-space-around">space-around</a> ruby 文本分布 </p>
                </div>
        </dl>
        <div class="example" id="example-e170976f">
            <a class="self-link" href="#example-e170976f"></a> <a href="#default-ua-ruby">默认 UA 样式表</a>
            对 <a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-text-3/#propdef-text-justify"
                id="ref-for-propdef-text-justify①">text-justify: ruby</a> 应用于 <a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⑦">ruby 注释</a>，
            定义每对相邻 CJK <a data-link-type="dfn" href="https://www.w3.org/TR/css-text-3/#character"
                id="ref-for-character">字符</a>之间有<a data-link-type="dfn"
                href="https://www.w3.org/TR/css-text-3/#justification-opportunity"
                id="ref-for-justification-opportunity②">对齐机会</a>，而拉丁或注音符号 <span id="ref-for-character①">字符</span>之间则无。
            因此 <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around"
                id="ref-for-valdef-ruby-align-space-around①">space-around</a> 和 <a class="css" data-link-type="maybe"
                href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between②">space-between</a>
            在拉丁或注音符号 ruby 上也会居中分布：
            <div class="figure">
                <img alt="半角 ruby 文本短于基底时自动分布图示" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ra-c-h.gif"
                    width="145"> <img alt="半角 ruby 文本长于基底时自动分布图示" height="91"
                    src="https://www.w3.org/TR/css-ruby-1/images/ra-c-rb-h.gif" width="145">
                <p class="caption">非CJK ruby 文本在 <a class="css" data-link-type="maybe"
                        href="#valdef-ruby-align-space-around"
                        id="ref-for-valdef-ruby-align-space-around②">space-around</a> 和 <a class="css"
                        data-link-type="maybe" href="#valdef-ruby-align-space-between"
                        id="ref-for-valdef-ruby-align-space-between③">space-between</a> 下居中分布
                </p>
            </div>
            <p>可用 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-text-3/#propdef-text-justify"
                    id="ref-for-propdef-text-justify②">text-justify</a> 控制空白分布。<a data-link-type="biblio"
                    href="#biblio-css-text-3" title="CSS Text Module Level 3">[CSS-TEXT-3]</a></p>
        </div>
        <p><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑧">ruby 基底</a>和<a
                data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⑧">ruby 注释</a>中的内容，
            除因 <a class="css" data-link-type="propdesc" href="#propdef-ruby-merge"
                id="ref-for-propdef-ruby-merge①⓪">ruby-merge: merge</a> 跨越的，均按本盒的 <a class="property css"
                data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⓪">ruby-align</a>
            对齐。
            <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation⑤">合并注释</a>内容按 <a
                data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box⑤⑨">ruby 注释容器</a>的 <span class="property"
                id="ref-for-propdef-ruby-align①①">ruby-align</span> 对齐，
            忽略单独 <span class="property" id="ref-for-propdef-ruby-align①②">ruby-align</span> 的值。
        </p>
        <p class="issue" id="issue-70e7253c"><a class="self-link" href="#issue-70e7253c"></a> 如果<a data-link-type="dfn"
                href="#merged-annotation" id="ref-for-merged-annotation⑥">合并注释</a>导致<a data-link-type="dfn"
                href="#ruby-segments" id="ref-for-ruby-segments①⑧">ruby 段</a>变宽，会怎样？
            是否如当前规范让每个基底也等比变宽（如跨越注释），这导致多基底容器不能居中对齐合并注释。
            或许应允许 ruby-merge 也应用于基底容器，但这又要求基底跨多个注释（如基底合并但部分注释层未合并），
            或要求基底合并时所有注释层也必须合并。</p>
        <p>当 <a class="property css" data-link-type="property" href="#propdef-ruby-merge"
                id="ref-for-propdef-ruby-merge①①">ruby-merge</a> 为 <a class="css" data-link-type="maybe"
                href="#valdef-ruby-merge-auto" id="ref-for-valdef-ruby-merge-auto①">auto</a> 时，实际对齐方式由 UA 决定，
            但所有注释能完全覆盖各自基底时，效果必须与 <span class="css" id="ref-for-propdef-ruby-merge①②">ruby-merge: separate</span> 相同。
        </p>
        <h3 class="heading settled" data-level="4.4" id="ruby-text-decoration"><span class="secno">4.4. </span><span
                class="content"> Ruby 文本装饰</span><a class="self-link" href="#ruby-text-decoration"></a></h3>
        <p>文本装饰不会从基底文本继承到注释。</p>
        <p>当文本装饰应用于 ruby 祖先时，
            会横跨 ruby 基底容器的整个内容区绘制，
            包括为容纳长注释而在基底内容两侧添加的额外空间。
            当文本装饰直接应用于 ruby 基底时，
            这些额外空间不被装饰，
            类似于盒自身 padding 区不被装饰。<a data-link-type="biblio" href="#biblio-css3-text-decor"
                title="CSS Text Decoration Module Level 3">[CSS3-TEXT-DECOR]</a>
        </p>
        <p>文本装饰也可直接应用于 ruby 基底容器和注释容器：
            此时会传递到容器内所有基底或注释，并在它们之间连续绘制。</p>
        <p>ruby 注释的位置可以调整，
            以避免与基底文本的上划线（overline）和下划线（underline）冲突。
            在字体大小和基线一致的基本情况下，
            下划线或上划线会绘制在 <a data-link-type="dfn" href="#base-level" id="ref-for-base-level⑤">基底层</a>与该侧注释之间。</p>
        <p class="issue" id="issue-c8497783"><a class="self-link" href="#issue-c8497783"></a> 本节需补充说明
            邻接基底/注释内容间装饰的绘制方式，
            取决于这些盒是否与其<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①⑥">列</a>等宽。</p>
        <h2 class="heading settled" data-level="5" id="edge-effects"><span class="secno">5. </span><span
                class="content"> 边缘效果</span><a class="self-link" href="#edge-effects"></a></h2>
        <h3 class="heading settled" data-level="5.1" id="ruby-overhang"><span class="secno">5.1. </span><span
                class="content"> 悬挂 Ruby：<a class="property css" data-link-type="property" href="#propdef-ruby-overhang"
                    id="ref-for-propdef-ruby-overhang">ruby-overhang</a> 属性</span><a class="self-link"
                href="#ruby-overhang"></a></h3>
        <table class="def propdef" data-link-for-hint="ruby-overhang">
            <tbody>
                <tr>
                    <th>名称:
                    <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export
                            id="propdef-ruby-overhang">ruby-overhang</dfn>
                <tr class="value">
                    <th><a href="https://www.w3.org/TR/css-values/#value-defs">值:</a>
                    <td class="prod">auto <a data-link-type="grammar"
                            href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a> none
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">初始值:</a>
                    <td>auto
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">适用元素:</a>
                    <td>ruby 注释容器
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">可继承:</a>
                    <td>是
                <tr>
                    <th><a href="https://www.w3.org/TR/css-values/#percentages">百分比:</a>
                    <td>n/a
                <tr>
                    <th><a href="https://www.w3.org/TR/css-cascade/#computed">计算值:</a>
                    <td>指定关键字
                <tr>
                    <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">规范顺序:</a>
                    <td>依语法
                <tr>
                    <th><a href="https://www.w3.org/TR/web-animations/#animation-type">动画类型:</a>
                    <td>按计算值类型
        </table>
        <p><a class="property css" data-link-type="property" href="#propdef-ruby-overhang"
                id="ref-for-propdef-ruby-overhang①">ruby-overhang</a> 属性控制 <a data-link-type="dfn"
                href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪⓪">ruby 注释</a>是否可超出 <a data-link-type="dfn"
                href="#ruby-container" id="ref-for-ruby-container④⓪">ruby 容器</a>与相邻文本重叠。
            各值含义如下：</p>
        <dl>
            <dt><dfn class="css" data-dfn-for="ruby-overhang" data-dfn-type="value" data-export
                    id="valdef-ruby-overhang-auto">auto<a class="self-link" href="#valdef-ruby-overhang-auto"></a></dfn>
            <dd>
                当 <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑥①">ruby 注释容器</a>长于其对应的 <a data-link-type="dfn"
                    href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑦">ruby 基底容器</a> 时，
                <span id="ref-for-ruby-annotation-container-box⑥②">ruby 注释容器</span>可部分悬挂重叠相邻盒。
                <p>允许悬挂的条件、范围和规则由 UA 决定。</p>
            <dt><dfn class="css" data-dfn-for="ruby-overhang" data-dfn-type="value" data-export
                    id="valdef-ruby-overhang-none">none<a class="self-link" href="#valdef-ruby-overhang-none"></a></dfn>
            <dd> <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑥③">ruby 注释容器</a>绝不允许超出自身范围。
        </dl>
        <p>若不允许<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪①">ruby 注释</a>悬挂，
            <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container④①">ruby 容器</a>表现如普通行内盒，
            即只有自身内容渲染在边界内，相邻元素不会跨越盒边界：
        </p>
        <div class="figure">
            <img alt="ruby 盒与相邻文本的交互示意图" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ro-n.gif" width="220">
            <p class="caption">不允许悬挂相邻文本的简单 ruby </p>
        </div>
        <p>若<a data-link-type="dfn" href="#ruby-annotation-container-box"
                id="ref-for-ruby-annotation-container-box⑥⑤">ruby 注释容器</a>允许悬挂，
            相邻内容可与 <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container④②">ruby 容器盒</a>重叠，
            允许其 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪②">ruby
                注释</a>部分覆盖上下文的行内内容。
            悬挂仅在不会导致相邻内容与 ruby 容器的 <span id="ref-for-ruby-annotation-box①⓪③">注释盒</span>或其下的 <a data-link-type="dfn"
                href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑨">基底</a>内容冲突时允许。
        </p>
        <div class="figure">
            <img alt="ruby 盒与相邻文本的交互示意图" height="91" src="https://www.w3.org/TR/css-ruby-1/images/ro-a.gif" width="177">
            <p class="caption">允许悬挂相邻文本的简单 ruby </p>
        </div>
        <p class="note" role="note"><span>注：</span> 某 <a data-link-type="dfn" href="#ruby-annotation-box"
                id="ref-for-ruby-annotation-box①⓪④">ruby 注释</a>是否可跨越其他 <a data-link-type="dfn" href="#ruby-base-box"
                id="ref-for-ruby-base-box⑧⓪">ruby 基底</a>由 <a class="property css" data-link-type="property"
                href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①③">ruby-merge</a> 控制。
        </p>
        <p>通常，基底或注释内容的对齐不受悬挂行为影响：
            对齐与空间分配（见 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                id="ref-for-propdef-ruby-align①③">ruby-align</a>）
            的方式与是否允许悬挂无关，且在计算可用悬挂空间前已确定。
            但 UA 可在分配空间和/或对齐时考虑允许悬挂的情况。</p>
        <p class="issue" id="issue-adc9f0e4"><a class="self-link" href="#issue-adc9f0e4"></a> 怀疑悬挂行为某些场景会影响对齐，需后续探讨。</p>
        <div class="example" id="example-a7292220"><a class="self-link" href="#example-a7292220"></a> UA 可采用 <a
                data-link-type="biblio" href="#biblio-jis4051"
                title="Formatting rules for Japanese documents (『日本語文書の組版方法』).">[JIS4051]</a> 推荐的注释字体 <a
                href="https://www.w3.org/TR/css-values-4/#ic"><span class="css">0.5ic</span></a>（半个全角）为最大悬挂长度。
            日文 ruby 悬挂相邻字符的详细规则见 <a data-link-type="biblio" href="#biblio-jlreq"
                title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>。 </div>
        <h3 class="heading settled" data-level="5.2" id="line-edge"><span class="secno">5.2. </span><span
                class="content"> 行边对齐</span><a class="self-link" href="#line-edge"></a></h3>
        <p>当一侧超出基底的<a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪⑤">ruby
                注释盒</a>在行首或行末时，
            UA <em>可以</em>强制该 <span id="ref-for-ruby-annotation-box①⓪⑥">ruby 注释</span>贴边对齐其基底。
            该对齐方式见 <a data-link-type="biblio" href="#biblio-jlreq"
                title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>。</p>
        <p>本级规范未提供控制此行为的机制。</p>
        <div class="figure">
            <img alt="行边对齐 ruby 文本短于基底时的排布图示" height="109" src="https://www.w3.org/TR/css-ruby-1/images/ra-le-l.gif"
                width="146"> <img alt="行边对齐 ruby 文本长于基底时的排布图示" height="110"
                src="https://www.w3.org/TR/css-ruby-1/images/ra-le-r.gif" width="146">
            <p class="caption">行边对齐 </p>
        </div>
        <h2 class="no-num heading settled" id="default-stylesheet"><span class="content">附录 A：示例样式表</span><a
                class="self-link" href="#default-stylesheet"></a></h2>
        <p><em>本节为补充说明。</em></p>
        <h3 class="no-num heading settled" id="default-ua-ruby"><span class="content"> <span class="secno">A.1</span>
                默认 UA 样式表</span><a class="self-link" href="#default-ua-ruby"></a></h3>
        <p>以下为 HTML 和 XHTML ruby 标记渲染为 ruby 布局的默认 UA 样式表：</p>
        <pre class="highlight">ruby <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby<c- p>;</c-> <c- p>}</c->
rp   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> none<c- p>;</c-> <c- p>}</c->
rbc  <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base-container<c- p>;</c-> <c- p>}</c->
rtc  <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text-container<c- p>;</c-> <c- p>}</c->
rb   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base<c- p>;</c-> <c- k>white-space</c-><c- p>:</c-> nowrap<c- p>;</c-> <c- p>}</c->
rt   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text<c- p>;</c-> <c- p>}</c->
ruby<c- p>,</c-> rb<c- p>,</c-> rt<c- p>,</c-> rbc<c- p>,</c-> rtc <c- p>{</c-> <c- k>unicode-bidi</c-><c- p>:</c-> isolate<c- p>;</c-> <c- p>}</c->

rtc<c- p>,</c-> rt <c- p>{</c->
  <c- k>font-variant-east-asian</c-><c- p>:</c-> ruby<c- p>;</c->  <c- c>/* 见 [[CSS-FONTS-3]] */</c->
  text-justify: ruby<c- p>;</c->             <c- c>/* 见 [[CSS-TEXT-4]] */</c->
  text-emphasis: none<c- p>;</c->            <c- c>/* 见 [[CSS-TEXT-DECOR-3]] */</c->
  white-space: nowrap<c- p>;</c->
  <c- k>line-height</c-><c- p>:</c-> <c- m>1</c-><c- p>;</c-> <c- p>}</c->

rtc<c- p>,</c-> <c- nf>:not</c-><c- p>(</c->rtc<c- p>)</c-> > rt <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>50</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->
rtc<c- nf>:lang</c-><c- p>(</c->zh-TW<c- p>),</c-> <c- nf>:not</c-><c- p>(</c->rtc<c- p>)</c-> > rt<c- nf>:lang</c-><c- p>(</c->zh-TW<c- p>),</c->
rtc<c- nf>:lang</c-><c- p>(</c->zh-Hanb<c- p>),</c-> <c- nf>:not</c-><c- p>(</c->rtc<c- p>)</c-> > rt<c- nf>:lang</c-><c- p>(</c->zh-Hanb<c- p>),</c-> <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>30</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->               <c- c>/* 注音符号 */</c->
</pre>
        <p class="note" role="note"><span>注：</span> 作者不应自行使用以上规则，支持 ruby 布局的 UA 应默认提供这些样式。</p>
        <p>实现“最小字体大小”功能的 UA 应考虑对 ruby 注释适当缩小该最小值。</p>
        <h3 class="no-num heading settled" id="default-inline"><span class="content"> <span class="secno">A.2</span>
                行内 ruby 注释</span><a class="self-link" href="#default-inline"></a></h3>
        <p>以下为 HTML 和 XHTML ruby 标记渲染为行内注释的样式表示例：</p>
        <pre
            class="highlight">ruby<c- p>,</c-> rb<c- p>,</c-> rt<c- p>,</c-> rbc<c- p>,</c-> rtc<c- p>,</c-> rp <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline<c- p>;</c-> <c- k>white-space</c-><c- p>:</c-> inherit<c- p>;</c->
  <c- k>font</c-><c- p>:</c-> inherit<c- p>;</c-> <c- k>text-emphasis</c-><c- p>:</c-> inherit<c- p>;</c-> <c- p>}</c-></pre>
        <h3 class="no-num heading settled" id="default-parens"><span class="content"> <span class="secno">A.3</span>
                生成括号</span><a class="self-link" href="#default-parens"></a></h3>
        <p>遗憾的是，由于选择器无法匹配文本节点，
            CSS 无法针对所有 HTML ruby 标记模式自动正确地
            给未加括号的 ruby 注释加上括号。
            （因为 HTML ruby 允许直接用文本推断 <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧③">ruby
                基底</a>，而没有对应元素。）</p>
        <p>但在严格使用 <code>&lt;rb></code> 或 <code>&lt;rtc></code> 的情况下，以下规则可为每段注释加括号：</p>
        <pre class="highlight"><c- c>/* 给 &lt;rtc> 加括号 */</c->
rtc::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->
rtc::after  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->

<c- c>/* 给首个不在 &lt;rtc> 内的 &lt;rt> 前加括号 */</c->
rb  + rt::before<c- p>,</c->
rtc + rt::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->

<c- c>/* 给不在 &lt;rtc> 内的 &lt;rt> 后加括号 */</c->
rb ~ rt:last-child::after<c- p>,</c->
rt + rb::before  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->
rt + rtc::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）（"</c-><c- p>;</c-> <c- p>}</c-></pre>
        <p>若已知只用交替标记法
            (<code
                class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->A<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->a<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->B<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->b<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->C<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->c<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c-></code>)
            不会出现相邻 ruby 注释，
            以下规则可为每个注释加括号：</p>
        <pre class="highlight"><c- c>/* 给每个 &lt;rt> 加括号 */</c->
rt::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->
rt::after  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->
</pre>
        <h2 class="heading settled" data-level="6" id="glossary"><span class="secno">6. </span><span class="content">
                术语表</span><a class="self-link" href="#glossary"></a></h2>
        <dl>
            <dt id="g-bopomofo"><a class="self-link" href="#g-bopomofo"></a><dfn data-dfn-type="dfn" data-noexport
                    id="bopomofo">注音符号<a class="self-link" href="#bopomofo"></a></dfn> 或 <dfn data-dfn-type="dfn"
                    data-noexport id="zhuyin-fuhao">注音符号<a class="self-link" href="#zhuyin-fuhao"></a></dfn>
                （中文：<span lang="zh-Bopo">ㄅㄆㄇㄈ</span>，<span lang="zh-Hant">注音符號</span>，或 <span
                    lang="zh-Hans">注音符号</span>）
            <dd>
                <p>为中文语音（尤其是普通话标准音）设计的字符和声调符号。
                    这些通常（但并非专用于）用于 ruby 注音。</p>
                <div class="figure">
                    <img alt="注音符号字符（蓝色）沿着每个汉字右侧竖排出现在横排文本中。" height="132"
                        src="https://www.w3.org/TR/css-ruby-1/images/zhuyin-example.png" width="349">
                    <p class="caption">注音符号作为中文字间注释的例子</p>
                </div>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="bopomofo-tone-marks">注音符号声调符号</dfn>是空格型字符，
                    （在内存中）出现在每个注音音节的末尾。
                    它们通常显示在注音符号字母的右侧或上方的独立轨道中，
                    声调符号的位置依赖于音节中字符的数量。
                    但轻声符号则位于注音符号前面（与注音字母对齐），而不是在旁边。</p>
                <p class="note" role="note"><span>注：</span> 浏览器和字体子系统负责在显示文本时确保字形的正确相对对齐和定位，包括<a data-link-type="dfn"
                        href="#bopomofo-tone-marks" id="ref-for-bopomofo-tone-marks">注音符号声调符号</a>，无论这些文本出现于 ruby
                    注释还是普通行内内容。
                    这样的字形布局不是 CSS ruby 布局的功能。</p>
                <p>注音符号<a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#letter"
                        id="ref-for-letter">字母</a>属于 <code>Bopomofo</code> <a data-link-type="dfn"
                        href="https://www.w3.org/TR/css-text-3/#unicode-script" id="ref-for-unicode-script">Unicode
                        脚本</a>（当前位于 U+3100–312F 和 U+31A0–31BF 区段）；
                    <a data-link-type="dfn" href="#bopomofo-tone-marks" id="ref-for-bopomofo-tone-marks①">注音符号声调符号</a>为
                    U+02C9 (ˉ), U+02CA (ˊ), U+02C7 (ˇ), U+02CB (ˋ), U+02EA (˪), U+02EB (˫), U+02D9 (˙)。
                    这些统称为 <dfn data-dfn-type="dfn" data-export id="bopomofo-characters">注音符号字符<a class="self-link"
                            href="#bopomofo-characters"></a></dfn>，用于 CSS 处理。
                </p>
            <dt id="g-hanja"><a class="self-link" href="#g-hanja"></a>韩文汉字（朝鲜语：<span lang="ko">漢字</span>）
            <dd> 韩文书写体系的一个子集，使用自中文书写体系借用或改编的表意字符。
                另见 <a href="#g-kanji">日文汉字</a>。
            <dt id="g-hiragana"><a class="self-link" href="#g-hiragana"></a>平假名（日本语：<span lang="ja">平仮名</span>）
            <dd> 日语音节文字或该文字的字符。外形圆润、草书。
                是日语书写体系的子集，与汉字和片假名共同使用。
                近年来主要用于在无法或不适合用汉字时书写日语词汇，以及词尾和助词。
                另见 <a href="#g-katakana">片假名</a>。
            <dt id="g-ideogram"><a class="self-link" href="#g-ideogram"></a>表意文字
            <dd> 一种用来表示思想、词或词素的字符，与字母或音节文字的字符不同。
                最著名的表意文字体系在东亚（中国、日本、韩国等）使用（有一定差异）。
            <dt id="g-kana"><a class="self-link" href="#g-kana"></a>假名（日本语：<span lang="ja">仮名</span>）
            <dd> 平假名和片假名的统称。
            <dt id="g-kanji"><a class="self-link" href="#g-kanji"></a>汉字（日语：<span lang="ja">漢字</span>）
            <dd> 日语中对表意文字的称呼；日语中使用的汉字。
                是日语书写体系的子集，与平假名和片假名共同使用。
                另见 <a href="#g-hanja">韩文汉字</a>。
            <dt id="g-katakana"><a class="self-link" href="#g-katakana"></a>片假名（日语：<span lang="ja">片仮名</span>）
            <dd> 日语音节文字或该文字的字符。外形棱角分明。
                是日语书写体系的子集，与汉字和平假名共同使用。
                近年来主要用于书写外来词。
                另见 <a href="#g-hiragana">平假名</a>。
        </dl>
        <h2 class="no-num heading settled" id="acknowledgments"><span class="content"> 致谢</span><a class="self-link"
                href="#acknowledgments"></a></h2>
        <p>没有以下人士的帮助，本规范无法完成：</p>
        <p>David Baron，
            Robin Berjon，
            Susanna Bowen，
            Stephen Deach，
            Martin Dürst，
            Hideki Hiura（<span lang="ja">樋浦 秀樹</span>），
            Masayasu Ishikawa（<span lang="ja">石川雅康</span>），
            Taichi Kawabata，
            Chris Pratley，
            Xidorn Quan，
            Takao Suzuki（<span lang="ja">鈴木 孝雄</span>），
            Frank Yung-Fong Tang，
            Chris Thrasher，
            Masafumi Yabe（<span lang="ja">家辺勝文</span>），
            Boris Zbarsky，
            Steve Zilles。</p>
        <p>特别感谢前任编辑：
            Microsoft 的 Michel Suignard 和 Marcin Sawicki，
            以及 W3C 的 Richard Ishida。</p>
        <h2 class="no-num heading settled" id="changes"><span class="content"> 变更记录</span><a class="self-link"
                href="#changes"></a></h2>
        <p>本节记录了自前一版发布以来的变更。</p>
        <h3 class="heading settled" id="changes-20211202"><span class="content"> 自 2021 年 12 月 2 日 WD 之后的变更</span><a
                class="self-link" href="#changes-20211202"></a></h3>
        <ul>
            <li>将 <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode"
                    id="ref-for-propdef-writing-mode⑦">writing-mode</a> 在<a data-link-type="dfn"
                    href="#ruby-position-inter-character-annotation"
                    id="ref-for-ruby-position-inter-character-annotation②⓪">字间注释</a>上的计算值调整为作用于
                <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪⑦">ruby 注释盒</a>，而非
                <a data-link-type="dfn" href="#ruby-annotation-container-box"
                    id="ref-for-ruby-annotation-container-box⑥⑥">ruby 注释容器盒</a>。
            <li>为 HTML 中的 <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪⑧">ruby
                    注释</a> 增加 <code>zh-Hant</code> 规则，应用 <a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-fonts-5/#descdef-font-face-font-size"
                    id="ref-for-descdef-font-face-font-size">font-size: 30%</a>。
            <li>为 UA 默认样式表添加 <code>text-justify: ruby</code>。
                （<a href="https://github.com/w3c/csswg-drafts/issues/771">问题771</a> <a
                    href="https://github.com/w3c/csswg-drafts/issues/779">问题779</a>）
        </ul>
        <h3 class="heading settled" id="changes-20200429"><span class="content"> 自 2020 年 4 月 29 日 WD 之后的变更</span><a
                class="self-link" href="#changes-20200429"></a></h3>
        <ul>
            <li>为 <a class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate"
                    id="ref-for-valdef-ruby-position-alternate④">alternate</a> 关键字加入 <a class="property css"
                    data-link-type="property" href="#propdef-ruby-position"
                    id="ref-for-propdef-ruby-position⑦">ruby-position</a>，并设为<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-cascade-5/#initial-value" id="ref-for-initial-value">初始值</a>。
            <li>将 <span class="css">collapse</span> 从 <a class="property css" data-link-type="property"
                    href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①④">ruby-merge</a> 的可选值重命名为 <a class="css"
                    data-link-type="maybe" href="#valdef-ruby-merge-merge"
                    id="ref-for-valdef-ruby-merge-merge③">merge</a>。
                （<a href="https://github.com/w3c/csswg-drafts/issues/5004">问题5004</a>）
            <li>定义 <a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-display-3/#propdef-visibility"
                    id="ref-for-propdef-visibility⑧">visibility: collapse</a> 显式<a data-link-type="dfn"
                    href="#hidden-annotation" id="ref-for-hidden-annotation⑨">隐藏</a>注释，
                与<a data-link-type="dfn" href="#auto-hidden" id="ref-for-auto-hidden②">自动隐藏</a>一致。
                （<a href="https://github.com/w3c/csswg-drafts/issues/5927">问题5927</a>）
            <li>更精确地规定了各 ruby 显示类型适用的属性
                （<a href="#box-style">§ 3.3 ruby 盒样式</a>），
                定义 ruby、ruby 基底、ruby 注释盒除特殊规定外与普通<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-display-3/#inline-box" id="ref-for-inline-box①②">行内盒</a>一致。
                （<a href="https://github.com/w3c/csswg-drafts/issues/4935">问题4935</a>, <a
                    href="https://github.com/w3c/csswg-drafts/issues/4936">问题4936</a>, <a
                    href="https://github.com/w3c/csswg-drafts/issues/4976">问题4976</a>, <a
                    href="https://github.com/w3c/csswg-drafts/issues/4979">问题4979</a>）
            <li>大幅重写 <a href="#ruby-layout">§ 3 Ruby 布局</a>，更清晰定义了<a data-link-type="dfn"
                    href="#interlinear-annotations" id="ref-for-interlinear-annotations⑨">行间</a>和<a data-link-type="dfn"
                    href="#ruby-position-inter-character-annotation"
                    id="ref-for-ruby-position-inter-character-annotation②①">字间</a> ruby 布局，
                以及它们与 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                    id="ref-for-propdef-ruby-align①④">ruby-align</a> 的交互。<span
                    id="ref-for-ruby-position-inter-character-annotation②②">字间</span> ruby 现在基于
                <a data-link-type="dfn" href="https://www.w3.org/TR/css-display-3/#inline-block"
                    id="ref-for-inline-block①">inline block</a> 布局，
                并明确了其与 <span id="ref-for-interlinear-annotations①⓪">行间</span> ruby 的关系。
                行内轴上的空间分布也更精确定义了跨越注释的行为
                （以 <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-grid-2/#valdef-grid-template-columns-max-content"
                    id="ref-for-valdef-grid-template-columns-max-content">max-content</a> 网格轨道为模型）。
            <li>定义嵌套 ruby 的处理，
                块轴尺寸需考虑其基底和注释容器。
                （<a href="https://github.com/w3c/csswg-drafts/issues/4986">问题4986</a>, <a
                    href="https://github.com/w3c/csswg-drafts/issues/4980">问题4980</a>）
            <li>更精确地规范了 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                    id="ref-for-propdef-ruby-align①⑤">ruby-align</a> 的行为。
            <li>放宽 ruby 悬挂不影响内容对齐的要求，增加不能与相邻内容碰撞的新要求。
            <li>澄清了 bidi 重排与<a data-link-type="dfn" href="#merged-annotation"
                    id="ref-for-merged-annotation⑦">合并注释</a>的交互。
                （见<a href="#bidi">§ 3.5 双向重排</a>）
            <li>规范全篇加强。
            <li>完善了<a href="#intro">简介</a>、示例和其它补充内容。
        </ul>
        <p class="note" role="note"><span>注：</span> 仍有许多未解决问题，见 <a
                href="https://drafts.csswg.org/css-ruby-1/issues-wd-2020">意见处理</a> 和 <a
                href="https://github.com/w3c/csswg-drafts/issues?q=is%3Aissue+label%3Acss-ruby-1">GitHub 跟踪的新问题</a>
            。</p>
        <h3 class="heading settled" id="changes-20140805"><span class="content">自 2014 年 8 月 5 日 WD 之后的变更</span><a
                class="self-link" href="#changes-20140805"></a></h3>
        <ul>
            <li>恢复 <a class="css" data-link-type="propdesc" href="#propdef-ruby-overhang"
                    id="ref-for-propdef-ruby-overhang②">ruby-overhang: auto | none</a>，用于基本控制 ruby 悬挂行为。
            <li>使行内化与 <a href="https://www.w3.org/TR/css-display-3/">CSS Display 模块</a>保持一致。
            <li>允许 UA 在 ruby/着重号与下划线/上划线冲突时进行位置调整。
            <li>当 <a class="property css" data-link-type="property" href="#propdef-ruby-merge"
                    id="ref-for-propdef-ruby-merge①⑤">ruby-merge</a> 的计算值为
                <code>collapse</code> 时禁用自动隐藏。
            <li>调整 <a href="#default-stylesheet">默认样式表</a>。
            <li>新增章节，定义与 <a href="#ruby-text-decoration">文本装饰</a> 的交互。
            <li>将 <span class="css">right</span> 和 <span class="css">left</span> 这两个 <a class="property css"
                    data-link-type="property" href="#propdef-ruby-position"
                    id="ref-for-propdef-ruby-position⑧">ruby-position</a> 的值延后到下一级规范。
            <li>修改 ruby <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑦">配对</a>规则，仅对匿名注释（即直接包含在
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/obsolete.html#rtc" id="ref-for-rtc">rtc</a></code>
                的内容）应用跨越。
            <li>多余的基底/注释与自动生成的空匿名基底/注释配对。
            <li>将 <a class="property css" data-link-type="property" href="#propdef-ruby-position"
                    id="ref-for-propdef-ruby-position⑨">ruby-position</a> 应用于 <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-line"
                    id="ref-for-selectordef-first-line②">::first-line</a>。
                （<a href="https://github.com/w3c/csswg-drafts/issues/2998">Issue 2998</a>）
            <li>明确 ruby 盒及其内容的包含块与其他行内盒一样，是最近的块级容器。
            <li>明确对于被错误放置父级的内部表格元素的处理方式。
            <li>修剪 ruby 容器、基底容器和注释容器的首尾空白，防止干扰配对。
            <li>定义空基底和注释容器的布局效果。
            <li>禁用 ruby 基底容器和注释容器上的 margin、padding 和 border（但 ruby 基底和注释本身不受影响）。
        </ul>
        <h3 class="heading settled" id="changes-20130919"><span class="content"> 自 2013 年 9 月 19 日 WD 之后的变更</span><a
                class="self-link" href="#changes-20130919"></a></h3>
        <ul>
            <li> 重写匿名盒生成规则和空白处理规则，
                明确定义匿名空白盒的<a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑧">配对</a>。
            <li> 嵌套 ruby 处理移出<a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑨">配对</a>逻辑。
                （将通过尺寸/布局处理。）
            <li> 定义 ruby 结构的双向布局。
        </ul>
        <h3 class="heading settled" id="changes-20110630"><span class="content"> 自 2011 年 6 月 30 日 WD 之后的变更</span><a
                class="self-link" href="#changes-20110630"></a></h3>
        <dl>
            <dt>移除 <code>ruby-span</code> 和 <code>rbspan</code> 的相关内容。
            <dd> HTML ruby 不使用显式跨越，而采用隐式跨越。
                这不能处理某些极端双向跨越，但目前无实际需求。
                （支持完整复杂 XHTML Ruby 的实现可通过标记隐式推断跨越，类似表格单元格跨越的处理方式。
                Level 1 无需包含此控制。）
            <dt>延后 <code>ruby-overhang</code> 和 <code>ruby-align: line-end</code> 到 Level 2。
            <dd> 属于较复杂的高级特性。
                提议将此行为定义为 UA 自定，并提供可接受选项示例。
            <dt>关闭 <code>display: rp</code> 相关问题：用 <code>display: none</code> 代替。
            <dd> 国际化工作组提出 issue，
                希望
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element" id="ref-for-the-rp-element">rp</a></code>
                元素有 display 值。
                实际上 ruby 显示为 ruby 时应隐藏该元素，
                但 <code>display: none</code> 已能实现。
            <dt>将 <a class="property css" data-link-type="property" href="#propdef-ruby-position"
                    id="ref-for-propdef-ruby-position①⓪">ruby-position</a> 的值对齐到 <a class="property css"
                    data-link-type="property"
                    href="https://www.w3.org/TR/css-text-decor-3/#propdef-text-emphasis-position"
                    id="ref-for-propdef-text-emphasis-position">text-emphasis-position</a>。
            <dd> 除 <a class="css" data-link-type="maybe" href="#valdef-ruby-position-inter-character"
                    id="ref-for-valdef-ruby-position-inter-character③">inter-character</a>，其它值与 text-emphasis-position
                对齐更合理，
                可正确处理横竖排组合。
            <dt>移除 <a class="property css" data-link-type="property" href="#propdef-ruby-align"
                    id="ref-for-propdef-ruby-align①⑥">ruby-align</a> 的未用值。
            <dd> <span class="css">left</span>、<span class="css">right</span>、<span class="css">end</span> 不再需要。
            <dt> 用 <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around"
                    id="ref-for-valdef-ruby-align-space-around④">space-around</a>
                和标准对齐规则代替 <span class="css">auto</span>，<span class="css">distribute-letter</span>，<span
                    class="css">distribute-space</span>；
                以 <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between"
                    id="ref-for-valdef-ruby-align-space-between⑤">space-between</a>、
                <span class="css" id="ref-for-valdef-ruby-align-space-around⑤">space-around</span> 与
                <a data-link-type="biblio" href="#biblio-css-flexbox-1"
                    title="CSS Flexible Box Layout Module Level 1">[CSS-FLEXBOX-1]</a> 和
                <a data-link-type="biblio" href="#biblio-css-align-3"
                    title="CSS Box Alignment Module Level 3">[CSS-ALIGN-3]</a> 的分布关键字一致，避免和
                <code>text-justify: distribute</code> 的混淆。
            <dt>增加 <a class="property css" data-link-type="property" href="#propdef-ruby-merge"
                    id="ref-for-propdef-ruby-merge①⑥">ruby-merge</a> 属性以控制熟语 ruby 显示。
            <dd> 这属于样式效果而非结构，
                旧模型假设为结构，并建议通过更改标记实现，已废弃。
            <dt>移除 <span class="css">inline</span> 作为 <a class="property css" data-link-type="property"
                    href="#propdef-ruby-position" id="ref-for-propdef-ruby-position①①">ruby-position</a> 的值。
            <dd> 用 <code>display: inline</code> 实现，见<a href="#default-inline">附录A</a>。
            <dt>加入 <a href="#default-stylesheet">默认样式</a> 规则
            <dd>应国际化工作组要求。
            <dt>重写匿名盒生成规则
            <dd> 并定义了基底和注释的<a data-link-type="dfn" href="#pairing" id="ref-for-pairing①⓪">配对</a>。
                现在应能处理所有 HTML ruby 标记的组合情况。
            <dt>定义 ruby 布局
            <dd> 详细定义了空间分布、空白处理、断行、行叠加等。
                双向处理留作未解决问题。
        </dl>
    </main>
    <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> 一致性</span><a class="self-link"
            href="#w3c-conformance"></a></h2>
    <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> 文档约定</span><a class="self-link"
            href="#w3c-conventions"></a></h3>
    <p>一致性要求由描述性断言和 RFC 2119 术语共同表达。规范性部分中的关键词 “MUST”（必须）、“MUST NOT”（不得）、“REQUIRED”（要求）、“SHALL”（应）、“SHALL
        NOT”（不应）、“SHOULD”（建议）、“SHOULD NOT”（不建议）、“RECOMMENDED”（推荐）、“MAY”（可以）、“OPTIONAL”（可选）应按 RFC 2119 解释。
        为便于阅读，本规范未对这些词全部大写。</p>
    <p>本规范所有文本均为规范性内容，除非明确标注为非规范性、示例、或注释。<a data-link-type="biblio" href="#biblio-rfc2119"
            title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
    <p>本规范中的示例以“For example”开头，
        或用 <code>class="example"</code> 单独排版，如下所示：</p>
    <div class="example" id="w3c-example">
        <a class="self-link" href="#w3c-example"></a>
        <p>这是一个说明性示例。</p>
    </div>
    <p>说明性注释以“Note”开头，并用 <code>class="note"</code> 单独排版，如下：</p>
    <p class="note" role="note">注：这是一个说明性注释。</p>
    <p>警示性内容为规范性部分，样式突出，用 <code>&lt;strong class="advisement"></code> 标记，如：
        <strong class="advisement"> UA 必须提供可访问性替代方案。 </strong>
    </p>
    <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> 一致性类别</span><a
            class="self-link" href="#w3c-conformance-classes"></a></h3>
    <p>本规范定义了三类一致性：</p>
    <dl>
        <dt>样式表
        <dd>一份<a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
                样式表</a>。
        <dt>渲染器
        <dd>一个<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>，解释样式表语义并渲染
            使用它们的文档。
        <dt>创作工具
        <dd>一个<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>，用于编写样式表。
    </dl>
    <p>只要样式表中所有使用本模块定义语法的语句都根据通用 CSS 语法和本模块各特性的语法有效，则样式表即合规。</p>
    <p>渲染器若能按照相关规范解释样式表，并能解析本规范定义的所有特性并相应渲染文档，即为合规。
        但 UA 因设备限制无法正确渲染文档不视为不合规。（例如，UA 不要求在单色显示器上渲染颜色。）</p>
    <p>创作工具若其生成的样式表在语法上符合通用 CSS 语法和本模块各特性的语法，且符合本模块描述的样式表一致性要求，则为合规。</p>
    <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> 部分实现</span><a class="self-link"
            href="#w3c-partial"></a></h3>
    <p>为了让作者利用向前兼容的解析规则设置回退值，CSS 渲染器<strong>必须</strong>将任何其不支持的 at-rule、属性、属性值、关键字和其它语法结构视为无效（并<a
            href="https://www.w3.org/TR/CSS21/conform.html#ignore">按需忽略</a>）。尤其是，用户代理<strong>不得</strong>有选择地忽略声明中的部分不支持值而只使用支持的值：如有任何值无效（如不支持），则整个声明都应被忽略。
    </p>
    <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> 不稳定和专有特性的实现</span><a
            class="self-link" href="#w3c-conform-future-proofing"></a></h4>
    <p>为避免与未来稳定 CSS 特性冲突，CSSWG 建议<a href="https://www.w3.org/TR/CSS/#future-proofing">遵循最佳实践</a>实现<a
            href="https://www.w3.org/TR/CSS/#unstable">不稳定功能</a>和<a
            href="https://www.w3.org/TR/CSS/#proprietary-extension">专有扩展</a>。</p>
    <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> 非实验性实现</span><a class="self-link"
            href="#w3c-testing"></a></h3>
    <p>一旦规范进入候选推荐（CR）阶段，
        就可以进行非实验性实现，开发者应当在能够证明按规范正确实现 CR 级特性时发布无前缀实现。</p>
    <p>为确保 CSS 在各实现间的互操作性，CSS 工作组要求非实验性 CSS 渲染器在发布任何 CSS 特性的无前缀实现前，向 W3C 提交实现报告（必要时还包括用于该报告的测试用例）。
        提交给 W3C 的测试用例由 CSS 工作组审核和修订。</p>
    <p>有关提交测试用例和实现报告的更多信息，请参见 CSS 工作组网站 <a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>。
        问题可发送至 <a href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> 邮件列表。
    </p>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#valdef-ruby-position-alternate">alternate</a><span>，见 § 4.1</span>
        <li><a href="#ruby-annotation-box">annotation</a><span>，见 § 2.1</span>
        <li><a href="#ruby-annotation-box">annotation box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-annotation-container-box">annotation container</a><span>，见 § 2.1</span>
        <li><a href="#annotation-level">annotation level</a><span>，见 § 2.3.1</span>
        <li>
            auto
            <ul>
                <li><a href="#valdef-ruby-merge-auto">ruby-merge 的值</a><span>，见 § 4.2</span>
                <li><a href="#valdef-ruby-overhang-auto">ruby-overhang 的值</a><span>，见 § 5.1</span>
            </ul>
        <li><a href="#auto-hidden">auto-hidden</a><span>，见 § 2.4</span>
        <li><a href="#auto-hidden">auto-hide</a><span>，见 § 2.4</span>
        <li><a href="#ruby-base-box">base</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-box">base box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-container-box">base container</a><span>，见 § 2.1</span>
        <li><a href="#base-level">base level</a><span>，见 § 2.3.1</span>
        <li><a href="#base-level">base text level</a><span>，见 § 2.3.1</span>
        <li><a href="#bopomofo">注音符号（Bopomofo）</a><span>，见 § 6</span>
        <li><a href="#bopomofo-characters">注音符号字符（Bopomofo characters）</a><span>，见 § 6</span>
        <li><a href="#bopomofo-tone-marks">注音符号声调符号（Bopomofo tone marks）</a><span>，见 § 6</span>
        <li><a href="#valdef-ruby-align-center">center</a><span>，见 § 4.3</span>
        <li><a href="#ruby-columns">column</a><span>，见 § 2.3</span>
        <li><a href="#hidden-annotation">hidden</a><span>，见 § 2.4</span>
        <li><a href="#hidden-annotation">hidden annotation</a><span>，见 § 2.4</span>
        <li><a href="#hidden-annotation">hidden ruby annotation</a><span>，见 § 2.4</span>
        <li><a href="#hidden-annotation">hide</a><span>，见 § 2.4</span>
        <li><a href="#inter-annotation-white-space">inter-annotation white space</a><span>，见 § 2.2</span>
        <li><a href="#inter-base-white-space">inter-base white space</a><span>，见 § 2.2</span>
        <li>
            inter-character
            <ul>
                <li><a href="#ruby-position-inter-character-annotation">ruby-position 的 dfn</a><span>，见 § 4.1</span>
                <li><a href="#valdef-ruby-position-inter-character">ruby-position 的值</a><span>，见 § 4.1</span>
            </ul>
        <li><a href="#ruby-position-inter-character-annotation">inter-character annotation</a><span>，见 § 4.1</span>
        <li><a href="#inter-level-white-space">inter-level white space</a><span>，见 § 2.2</span>
        <li><a href="#interlinear-annotations">interlinear</a><span>，见 § 4.1</span>
        <li><a href="#interlinear-annotations">interlinear annotations</a><span>，见 § 4.1</span>
        <li><a href="#internal-ruby-boxes">internal ruby boxes</a><span>，见 § 2.1.1</span>
        <li><a href="#internal-ruby-boxes">internal ruby display types</a><span>，见 § 2.1.1</span>
        <li><a href="#inter-segment-white-space">inter-segment white space</a><span>，见 § 2.2</span>
        <li><a href="#intra-level-white-space">intra-level white space</a><span>，见 § 2.2</span>
        <li><a href="#intra-ruby-white-space">intra-ruby white space</a><span>，见 § 2.2</span>
        <li><a href="#annotation-level">level</a><span>，见 § 2.3.1</span>
        <li><a href="#valdef-ruby-merge-merge">merge</a><span>，见 § 4.2</span>
        <li><a href="#merged-annotation">merged</a><span>，见 § 4.2</span>
        <li><a href="#merged-annotation">merged annotation</a><span>，见 § 4.2</span>
        <li><a href="#valdef-ruby-overhang-none">none</a><span>，见 § 5.1</span>
        <li><a href="#valdef-ruby-position-over">over</a><span>，见 § 4.1</span>
        <li><a href="#pairing">pairing</a><span>，见 § 2.3</span>
        <li><a href="#ruby">Ruby</a><span>，见 § 1.1</span>
        <li><a href="#valdef-display-ruby">ruby</a><span>，见 § 2.1</span>
        <li><a href="#propdef-ruby-align">ruby-align</a><span>，见 § 4.3</span>
        <li><a href="#ruby-annotation-box">ruby annotation</a><span>，见 § 2.1</span>
        <li><a href="#ruby-annotation-box">ruby annotation box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-annotation-container-box">ruby annotation container</a><span>，见 § 2.1</span>
        <li><a href="#ruby-annotation-container-box">ruby annotation container box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-box">ruby base</a><span>，见 § 2.1</span>
        <li><a href="#valdef-display-ruby-base">ruby-base</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-box">ruby base box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-container-box">ruby base container</a><span>，见 § 2.1</span>
        <li><a href="#valdef-display-ruby-base-container">ruby-base-container</a><span>，见 § 2.1</span>
        <li><a href="#ruby-base-container-box">ruby base container box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-columns">ruby columns</a><span>，见 § 2.3</span>
        <li><a href="#ruby-container">ruby container</a><span>，见 § 2.1</span>
        <li><a href="#ruby-container">ruby container box</a><span>，见 § 2.1</span>
        <li><a href="#ruby-formatting-context">ruby formatting context</a><span>，见 § 2.1.1</span>
        <li><a href="#propdef-ruby-merge">ruby-merge</a><span>，见 § 4.2</span>
        <li><a href="#propdef-ruby-overhang">ruby-overhang</a><span>，见 § 5.1</span>
        <li><a href="#propdef-ruby-position">ruby-position</a><span>，见 § 4.1</span>
        <li><a href="#ruby-segments">ruby segments</a><span>，见 § 2.3.1</span>
        <li><a href="#valdef-display-ruby-text">ruby-text</a><span>，见 § 2.1</span>
        <li><a href="#valdef-display-ruby-text-container">ruby-text-container</a><span>，见 § 2.1</span>
        <li><a href="#valdef-ruby-merge-separate">separate</a><span>，见 § 4.2</span>
        <li><a href="#valdef-ruby-align-space-around">space-around</a><span>，见 § 4.3</span>
        <li><a href="#valdef-ruby-align-space-between">space-between</a><span>，见 § 4.3</span>
        <li><a href="#span">span</a><span>，见 § 2.3</span>
        <li><a href="#spanning-annotation">spanning annotation</a><span>，见 § 2.3</span>
        <li><a href="#valdef-ruby-align-start">start</a><span>，见 § 4.3</span>
        <li><a href="#valdef-ruby-position-under">under</a><span>，见 § 4.1</span>
        <li><a href="#zhuyin-fuhao">注音符号（Zhuyin Fuhao）</a><span>，见 § 6</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-border">
        <a href="https://www.w3.org/TR/css-box-4/#border">https://www.w3.org/TR/css-box-4/#border</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-border">3.3.
                    Styling Ruby Boxes</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-content-area">
        <a href="https://www.w3.org/TR/css-box-4/#content-area">https://www.w3.org/TR/css-box-4/#content-area</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-content-area">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-content-box">
        <a href="https://www.w3.org/TR/css-box-4/#content-box">https://www.w3.org/TR/css-box-4/#content-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-content-box">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-content-box①">(2)</a> <a
                    href="#ref-for-content-box②">(3)</a> <a href="#ref-for-content-box③">(4)</a> <a
                    href="#ref-for-content-box④">(5)</a> <a href="#ref-for-content-box⑤">(6)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-margin">
        <a href="https://www.w3.org/TR/css-box-4/#margin">https://www.w3.org/TR/css-box-4/#margin</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-margin">3.3.
                    Styling Ruby Boxes</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-margin-box">
        <a href="https://www.w3.org/TR/css-box-4/#margin-box">https://www.w3.org/TR/css-box-4/#margin-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-margin-box">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-padding">
        <a
            href="https://www.w3.org/TR/css-box-4/#propdef-padding">https://www.w3.org/TR/css-box-4/#propdef-padding</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-padding">3.6.
                    Line Spacing</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-computed-value">
        <a
            href="https://www.w3.org/TR/css-cascade-5/#computed-value">https://www.w3.org/TR/css-cascade-5/#computed-value</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-computed-value">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-initial-value">
        <a
            href="https://www.w3.org/TR/css-cascade-5/#initial-value">https://www.w3.org/TR/css-cascade-5/#initial-value</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-initial-value"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-atomic-inline">
        <a
            href="https://www.w3.org/TR/css-display-3/#atomic-inline">https://www.w3.org/TR/css-display-3/#atomic-inline</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-atomic-inline">2.5.
                    White Space Collapsing</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-display-block">
        <a
            href="https://www.w3.org/TR/css-display-3/#valdef-display-block">https://www.w3.org/TR/css-display-3/#valdef-display-block</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-block">2.1.2.
                    Non-Inline Ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-block-container">
        <a
            href="https://www.w3.org/TR/css-display-3/#block-container">https://www.w3.org/TR/css-display-3/#block-container</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-block-container">2.1.1.
                    The Ruby Formatting Context</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-visibility-collapse">
        <a
            href="https://www.w3.org/TR/css-display-3/#valdef-visibility-collapse">https://www.w3.org/TR/css-display-3/#valdef-visibility-collapse</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-visibility-collapse">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-containing-block">
        <a
            href="https://www.w3.org/TR/css-display-3/#containing-block">https://www.w3.org/TR/css-display-3/#containing-block</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-containing-block">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-containing-block①">(2)</a> <a
                    href="#ref-for-containing-block②">(3)</a> <a href="#ref-for-containing-block③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-display">
        <a
            href="https://www.w3.org/TR/css-display-3/#propdef-display">https://www.w3.org/TR/css-display-3/#propdef-display</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-display">2.1.
                    Ruby-specific display Values</a> <a href="#ref-for-propdef-display①">(2)</a> <a
                    href="#ref-for-propdef-display②">(3)</a> <a href="#ref-for-propdef-display③">(4)</a> <a
                    href="#ref-for-propdef-display④">(5)</a> <a href="#ref-for-propdef-display⑤">(6)</a> <a
                    href="#ref-for-propdef-display⑥">(7)</a>
            <li><a href="#ref-for-propdef-display⑦">2.1.2.
                    Non-Inline Ruby</a> <a href="#ref-for-propdef-display⑧">(2)</a>
            <li><a href="#ref-for-propdef-display⑨">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-propdef-display①⓪">(2)</a> <a
                    href="#ref-for-propdef-display①①">(3)</a> <a href="#ref-for-propdef-display①②">(4)</a> <a
                    href="#ref-for-propdef-display①③">(5)</a> <a href="#ref-for-propdef-display①④">(6)</a>
            <li><a href="#ref-for-propdef-display①⑤">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a> <a
                    href="#ref-for-propdef-display①⑥">(2)</a> <a href="#ref-for-propdef-display①⑦">(3)</a>
            <li><a href="#ref-for-propdef-display①⑧">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-formatting-context">
        <a
            href="https://www.w3.org/TR/css-display-3/#formatting-context">https://www.w3.org/TR/css-display-3/#formatting-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-formatting-context">2.1.1.
                    The Ruby Formatting Context</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-in-flow">
        <a href="https://www.w3.org/TR/css-display-3/#in-flow">https://www.w3.org/TR/css-display-3/#in-flow</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-in-flow">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-in-flow①">(2)</a> <a
                    href="#ref-for-in-flow②">(3)</a> <a href="#ref-for-in-flow③">(4)</a>
            <li><a href="#ref-for-in-flow④">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-in-flow⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-independent-formatting-context">
        <a
            href="https://www.w3.org/TR/css-display-3/#independent-formatting-context">https://www.w3.org/TR/css-display-3/#independent-formatting-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-independent-formatting-context">2.1.1.
                    The Ruby Formatting Context</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-display-inline">
        <a
            href="https://www.w3.org/TR/css-display-3/#valdef-display-inline">https://www.w3.org/TR/css-display-3/#valdef-display-inline</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-inline">2.1.2.
                    Non-Inline Ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-block">
        <a
            href="https://www.w3.org/TR/css-display-3/#inline-block">https://www.w3.org/TR/css-display-3/#inline-block</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-block">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-inline-block①"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-box">
        <a href="https://www.w3.org/TR/css-display-3/#inline-box">https://www.w3.org/TR/css-display-3/#inline-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-box">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-inline-box①">(2)</a> <a
                    href="#ref-for-inline-box②">(3)</a> <a href="#ref-for-inline-box③">(4)</a>
            <li><a href="#ref-for-inline-box④">3.
                    Ruby Layout</a> <a href="#ref-for-inline-box⑤">(2)</a>
            <li><a href="#ref-for-inline-box⑥">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-inline-box⑦">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-inline-box⑧">(2)</a> <a href="#ref-for-inline-box⑨">(3)</a>
                <a href="#ref-for-inline-box①⓪">(4)</a>
            <li><a href="#ref-for-inline-box①①">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-inline-box①②"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-formatting-context">
        <a
            href="https://www.w3.org/TR/css-display-3/#inline-formatting-context">https://www.w3.org/TR/css-display-3/#inline-formatting-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-formatting-context">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-inline-formatting-context①">(2)</a> <a
                    href="#ref-for-inline-formatting-context②">(3)</a> <a
                    href="#ref-for-inline-formatting-context③">(4)</a> <a
                    href="#ref-for-inline-formatting-context④">(5)</a>
            <li><a href="#ref-for-inline-formatting-context⑤">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-inline-formatting-context⑥">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-inline-formatting-context⑦">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-display-inline-block">
        <a
            href="https://www.w3.org/TR/css-display-3/#valdef-display-inline-block">https://www.w3.org/TR/css-display-3/#valdef-display-inline-block</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-inline-block">2.2.
                    Anonymous Ruby Box Generation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-level">
        <a
            href="https://www.w3.org/TR/css-display-3/#inline-level">https://www.w3.org/TR/css-display-3/#inline-level</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-level">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-inline-level①">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inline-level②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-level-box">
        <a
            href="https://www.w3.org/TR/css-display-3/#inline-level-box">https://www.w3.org/TR/css-display-3/#inline-level-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-level-box">2.1.
                    Ruby-specific display Values</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-level">
        <a
            href="https://www.w3.org/TR/css-display-3/#inline-level">https://www.w3.org/TR/css-display-3/#inline-level</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-level">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-inline-level①">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inline-level②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inlinify">
        <a href="https://www.w3.org/TR/css-display-3/#inlinify">https://www.w3.org/TR/css-display-3/#inlinify</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inlinify">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inlinify①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inner-display-type">
        <a
            href="https://www.w3.org/TR/css-display-3/#inner-display-type">https://www.w3.org/TR/css-display-3/#inner-display-type</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inner-display-type">2.1.2.
                    Non-Inline Ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-internal-table-element">
        <a
            href="https://www.w3.org/TR/css-display-3/#internal-table-element">https://www.w3.org/TR/css-display-3/#internal-table-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-internal-table-element">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-internal-table-element①">2.2.
                    Anonymous Ruby Box Generation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-outer-display-type">
        <a
            href="https://www.w3.org/TR/css-display-3/#outer-display-type">https://www.w3.org/TR/css-display-3/#outer-display-type</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-outer-display-type">2.1.
                    Ruby-specific display Values</a>
            <li><a href="#ref-for-outer-display-type①">2.1.2.
                    Non-Inline Ruby</a> <a href="#ref-for-outer-display-type②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-replaced-element">
        <a
            href="https://www.w3.org/TR/css-display-3/#replaced-element">https://www.w3.org/TR/css-display-3/#replaced-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-replaced-element">2.1.
                    Ruby-specific display Values</a> <a href="#ref-for-replaced-element①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-visibility">
        <a
            href="https://www.w3.org/TR/css-display-3/#propdef-visibility">https://www.w3.org/TR/css-display-3/#propdef-visibility</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-visibility">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a> <a
                    href="#ref-for-propdef-visibility①">(2)</a> <a href="#ref-for-propdef-visibility②">(3)</a> <a
                    href="#ref-for-propdef-visibility③">(4)</a> <a href="#ref-for-propdef-visibility④">(5)</a> <a
                    href="#ref-for-propdef-visibility⑤">(6)</a> <a href="#ref-for-propdef-visibility⑥">(7)</a> <a
                    href="#ref-for-propdef-visibility⑦">(8)</a>
            <li><a href="#ref-for-propdef-visibility⑧"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-descdef-font-face-font-size">
        <a
            href="https://www.w3.org/TR/css-fonts-5/#descdef-font-face-font-size">https://www.w3.org/TR/css-fonts-5/#descdef-font-face-font-size</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-descdef-font-face-font-size"> Changes since the 2 December 2021 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-grid-template-columns-max-content">
        <a
            href="https://www.w3.org/TR/css-grid-2/#valdef-grid-template-columns-max-content">https://www.w3.org/TR/css-grid-2/#valdef-grid-template-columns-max-content</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-grid-template-columns-max-content"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-baseline-shift-bottom">
        <a
            href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-bottom">https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-bottom</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-baseline-shift-bottom">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-valdef-baseline-shift-bottom①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-line-box">
        <a href="https://www.w3.org/TR/css-inline-3/#line-box">https://www.w3.org/TR/css-inline-3/#line-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-line-box">3.1.
                    Interlinear Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-line-relative-shift-values">
        <a
            href="https://www.w3.org/TR/css-inline-3/#line-relative-shift-values">https://www.w3.org/TR/css-inline-3/#line-relative-shift-values</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-line-relative-shift-values">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-line-relative-shift-values①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-baseline-shift-top">
        <a
            href="https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-top">https://www.w3.org/TR/css-inline-3/#valdef-baseline-shift-top</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-baseline-shift-top">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-valdef-baseline-shift-top①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-vertical-align">
        <a
            href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align">https://www.w3.org/TR/css-inline-3/#propdef-vertical-align</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-vertical-align">3.1.2.
                    Block-axis Interlinear Layout</a>
            <li><a href="#ref-for-propdef-vertical-align①">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-propdef-vertical-align②">(2)</a>
            <li><a href="#ref-for-propdef-vertical-align③">3.6.
                    Line Spacing</a> <a href="#ref-for-propdef-vertical-align④">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-first-letter">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-letter">https://www.w3.org/TR/css-pseudo-4/#selectordef-first-letter</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-first-letter">1.2.
                    Module interactions</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-first-line">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-line">https://www.w3.org/TR/css-pseudo-4/#selectordef-first-line</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-first-line">1.2.
                    Module interactions</a> <a href="#ref-for-selectordef-first-line①">(2)</a>
            <li><a href="#ref-for-selectordef-first-line②"> Changes since the 5 August 2014 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-automatic-size">
        <a
            href="https://www.w3.org/TR/css-sizing-3/#automatic-size">https://www.w3.org/TR/css-sizing-3/#automatic-size</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-automatic-size">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-letter">
        <a href="https://www.w3.org/TR/css-syntax-3/#letter">https://www.w3.org/TR/css-syntax-3/#letter</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-letter">6.
                    Glossary</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-table-wrapper-box">
        <a
            href="https://www.w3.org/TR/css-tables-3/#table-wrapper-box">https://www.w3.org/TR/css-tables-3/#table-wrapper-box</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-table-wrapper-box">2.2.
                    Anonymous Ruby Box Generation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-character">
        <a href="https://www.w3.org/TR/css-text-3/#character">https://www.w3.org/TR/css-text-3/#character</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-character">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-character①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-collapsible-white-space">
        <a
            href="https://www.w3.org/TR/css-text-3/#collapsible-white-space">https://www.w3.org/TR/css-text-3/#collapsible-white-space</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-collapsible-white-space">2.5.
                    White Space Collapsing</a> <a href="#ref-for-collapsible-white-space①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-justification-opportunity">
        <a
            href="https://www.w3.org/TR/css-text-3/#justification-opportunity">https://www.w3.org/TR/css-text-3/#justification-opportunity</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-justification-opportunity">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a
                    href="#ref-for-justification-opportunity①">(2)</a> <a
                    href="#ref-for-justification-opportunity②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-word-break-keep-all">
        <a
            href="https://www.w3.org/TR/css-text-3/#valdef-word-break-keep-all">https://www.w3.org/TR/css-text-3/#valdef-word-break-keep-all</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-word-break-keep-all">3.4.1.
                    Breaking Between Bases</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-segment-break">
        <a href="https://www.w3.org/TR/css-text-3/#segment-break">https://www.w3.org/TR/css-text-3/#segment-break</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-segment-break">2.5.
                    White Space Collapsing</a> <a href="#ref-for-segment-break①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-soft-wrap-opportunity">
        <a
            href="https://www.w3.org/TR/css-text-3/#soft-wrap-opportunity">https://www.w3.org/TR/css-text-3/#soft-wrap-opportunity</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-soft-wrap-opportunity">3.4.2.
                    Breaking Within Bases</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-text-justify">
        <a
            href="https://www.w3.org/TR/css-text-3/#propdef-text-justify">https://www.w3.org/TR/css-text-3/#propdef-text-justify</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-text-justify">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-propdef-text-justify①">(2)</a>
                <a href="#ref-for-propdef-text-justify②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-text-transform">
        <a
            href="https://www.w3.org/TR/css-text-3/#propdef-text-transform">https://www.w3.org/TR/css-text-3/#propdef-text-transform</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-text-transform">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-unicode-script">
        <a
            href="https://www.w3.org/TR/css-text-3/#unicode-script">https://www.w3.org/TR/css-text-3/#unicode-script</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-unicode-script">6.
                    Glossary</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-white-space">
        <a href="https://www.w3.org/TR/css-text-3/#white-space">https://www.w3.org/TR/css-text-3/#white-space</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-white-space">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-white-space①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-white-space">
        <a
            href="https://www.w3.org/TR/css-text-3/#propdef-white-space">https://www.w3.org/TR/css-text-3/#propdef-white-space</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-white-space">2.2.
                    Anonymous Ruby Box Generation</a>
            <li><a href="#ref-for-propdef-white-space①">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-propdef-white-space②">3.4.2.
                    Breaking Within Bases</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-word-break">
        <a
            href="https://www.w3.org/TR/css-text-3/#propdef-word-break">https://www.w3.org/TR/css-text-3/#propdef-word-break</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-word-break">3.4.1.
                    Breaking Between Bases</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-css-wide-keywords">
        <a
            href="https://www.w3.org/TR/css-values-4/#css-wide-keywords">https://www.w3.org/TR/css-values-4/#css-wide-keywords</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-css-wide-keywords">1.3.
                    Value Definitions</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-comb-one">
        <a href="https://www.w3.org/TR/css-values-4/#comb-one">https://www.w3.org/TR/css-values-4/#comb-one</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-comb-one">2.1.
                    Ruby-specific display Values</a> <a href="#ref-for-comb-one①">(2)</a> <a
                    href="#ref-for-comb-one②">(3)</a> <a href="#ref-for-comb-one③">(4)</a>
            <li><a href="#ref-for-comb-one④">4.1.
                    Ruby Positioning: the ruby-position property</a> <a href="#ref-for-comb-one⑤">(2)</a>
            <li><a href="#ref-for-comb-one⑥">4.2.
                    Sharing Annotation Space: the ruby-merge property</a> <a href="#ref-for-comb-one⑦">(2)</a>
            <li><a href="#ref-for-comb-one⑧">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-comb-one⑨">(2)</a> <a
                    href="#ref-for-comb-one①⓪">(3)</a>
            <li><a href="#ref-for-comb-one①①">5.1.
                    Overhanging Ruby: the ruby-overhang property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-comb-any">
        <a href="https://www.w3.org/TR/css-values-4/#comb-any">https://www.w3.org/TR/css-values-4/#comb-any</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-comb-any">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-bidi-isolate">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#bidi-isolate">https://www.w3.org/TR/css-writing-modes-4/#bidi-isolate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-bidi-isolate">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-unicode-bidi-bidi-override">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-bidi-override">https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-bidi-override</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-unicode-bidi-bidi-override">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-unicode-bidi-embed">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-embed">https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-embed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-unicode-bidi-embed">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-horizontal-writing-mode">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#horizontal-writing-mode">https://www.w3.org/TR/css-writing-modes-4/#horizontal-writing-mode</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-horizontal-writing-mode">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inline-base-direction">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction">https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inline-base-direction">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-unicode-bidi-isolate">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate">https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-unicode-bidi-isolate">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-unicode-bidi-isolate-override">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate-override">https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-isolate-override</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-unicode-bidi-isolate-override">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-line-over">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#line-over">https://www.w3.org/TR/css-writing-modes-4/#line-over</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-line-over">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-line-under">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#line-under">https://www.w3.org/TR/css-writing-modes-4/#line-under</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-line-under">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-unicode-bidi-normal">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-normal">https://www.w3.org/TR/css-writing-modes-4/#valdef-unicode-bidi-normal</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-unicode-bidi-normal">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-vertical-writing-mode">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#vertical-writing-mode">https://www.w3.org/TR/css-writing-modes-4/#vertical-writing-mode</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-vertical-writing-mode">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-valdef-writing-mode-vertical-rl">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-writing-mode-vertical-rl">https://www.w3.org/TR/css-writing-modes-4/#valdef-writing-mode-vertical-rl</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-writing-mode-vertical-rl">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-valdef-writing-mode-vertical-rl①">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-valdef-writing-mode-vertical-rl②">(2)</a> <a
                    href="#ref-for-valdef-writing-mode-vertical-rl③">(3)</a> <a
                    href="#ref-for-valdef-writing-mode-vertical-rl④">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-writing-mode">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#writing-mode">https://www.w3.org/TR/css-writing-modes-4/#writing-mode</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-writing-mode">4.1.
                    Ruby Positioning: the ruby-position property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-writing-mode">
        <a
            href="https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode">https://www.w3.org/TR/css-writing-modes-4/#propdef-writing-mode</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-writing-mode">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-propdef-writing-mode①">4.1.
                    Ruby Positioning: the ruby-position property</a> <a href="#ref-for-propdef-writing-mode②">(2)</a> <a
                    href="#ref-for-propdef-writing-mode③">(3)</a> <a href="#ref-for-propdef-writing-mode④">(4)</a> <a
                    href="#ref-for-propdef-writing-mode⑤">(5)</a> <a href="#ref-for-propdef-writing-mode⑥">(6)</a>
            <li><a href="#ref-for-propdef-writing-mode⑦"> Changes since the 2 December 2021 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-line-height">
        <a
            href="https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height">https://www.w3.org/TR/CSS2/visudet.html#propdef-line-height</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-line-height">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-propdef-line-height①">(2)</a>
            <li><a href="#ref-for-propdef-line-height②">3.6.
                    Line Spacing</a> <a href="#ref-for-propdef-line-height③">(2)</a> <a
                    href="#ref-for-propdef-line-height④">(3)</a> <a href="#ref-for-propdef-line-height⑤">(4)</a> <a
                    href="#ref-for-propdef-line-height⑥">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-text-emphasis-position">
        <a
            href="https://www.w3.org/TR/css-text-decor-3/#propdef-text-emphasis-position">https://www.w3.org/TR/css-text-decor-3/#propdef-text-emphasis-position</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-text-emphasis-position"> Changes since the 30 June 2011 WD</a> <a
                    href="#ref-for-propdef-text-emphasis-position①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-direction">
        <a
            href="https://www.w3.org/TR/css-writing-modes-3/#propdef-direction">https://www.w3.org/TR/css-writing-modes-3/#propdef-direction</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-direction">3.5.
                    Bidi Reordering</a> <a href="#ref-for-propdef-direction①">(2)</a> <a
                    href="#ref-for-propdef-direction②">(3)</a> <a href="#ref-for-propdef-direction③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-propdef-unicode-bidi">
        <a
            href="https://www.w3.org/TR/css-writing-modes-3/#propdef-unicode-bidi">https://www.w3.org/TR/css-writing-modes-3/#propdef-unicode-bidi</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-propdef-unicode-bidi">3.5.
                    Bidi Reordering</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-the-rp-element">
        <a
            href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element">https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-the-rp-element"> Changes since the 30 June 2011 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-rtc">
        <a
            href="https://html.spec.whatwg.org/multipage/obsolete.html#rtc">https://html.spec.whatwg.org/multipage/obsolete.html#rtc</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-rtc"> Changes since the 5 August 2014 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-the-ruby-element">
        <a
            href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element">https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-the-ruby-element"> Changes since the 30 June 2011 WD</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CSS-BOX-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-border">border（边框）</span>
                <li><span class="dfn-paneled" id="term-for-content-area">content area（内容区）</span>
                <li><span class="dfn-paneled" id="term-for-content-box">content box（内容盒）</span>
                <li><span class="dfn-paneled" id="term-for-margin">margin（外边距）</span>
                <li><span class="dfn-paneled" id="term-for-margin-box">margin box（外边距盒）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-padding">padding（内边距）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-CASCADE-5]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-computed-value">computed value（计算值）</span>
                <li><span class="dfn-paneled" id="term-for-initial-value">initial value（初始值）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-DISPLAY-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-atomic-inline">atomic inline（原子行内）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-display-block">block（块）</span>
                <li><span class="dfn-paneled" id="term-for-block-container">block container（块容器）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-visibility-collapse">collapse（折叠）</span>
                <li><span class="dfn-paneled" id="term-for-containing-block">containing block（包含块）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-display">display（显示）</span>
                <li><span class="dfn-paneled" id="term-for-formatting-context">formatting context（格式化上下文）</span>
                <li><span class="dfn-paneled" id="term-for-in-flow">in-flow（流内）</span>
                <li><span class="dfn-paneled" id="term-for-independent-formatting-context">independent formatting
                        context（独立格式化上下文）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-display-inline">inline（行内）</span>
                <li><span class="dfn-paneled" id="term-for-inline-block">inline block（行内块）</span>
                <li><span class="dfn-paneled" id="term-for-inline-box">inline box（行内盒）</span>
                <li><span class="dfn-paneled" id="term-for-inline-formatting-context">inline formatting
                        context（行内格式化上下文）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-display-inline-block">inline-block（行内块）</span>
                <li><span class="dfn-paneled" id="term-for-inline-level">inline-level（行内级别）</span>
                <li><span class="dfn-paneled" id="term-for-inline-level-box">inline-level box（行内级盒）</span>
                <li><span class="dfn-paneled" id="term-for-inline-level①">inline-level content（行内级内容）</span>
                <li><span class="dfn-paneled" id="term-for-inlinify">inlinify（行内化）</span>
                <li><span class="dfn-paneled" id="term-for-inner-display-type">inner display type（内部显示类型）</span>
                <li><span class="dfn-paneled" id="term-for-internal-table-element">internal table element（内部表元素）</span>
                <li><span class="dfn-paneled" id="term-for-outer-display-type">outer display type（外部显示类型）</span>
                <li><span class="dfn-paneled" id="term-for-replaced-element">replaced element（替换元素）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-visibility">visibility（可见性）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-FONTS-5]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-descdef-font-face-font-size">font-size（字体大小）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-GRID-2]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled"
                        id="term-for-valdef-grid-template-columns-max-content">max-content（最大内容）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-INLINE-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-valdef-baseline-shift-bottom">bottom（底部）</span>
                <li><span class="dfn-paneled" id="term-for-line-box">line box（行盒）</span>
                <li><span class="dfn-paneled" id="term-for-line-relative-shift-values">line-relative shift
                        values（行相对偏移值）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-baseline-shift-top">top（顶部）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-vertical-align">vertical-align（垂直对齐）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-PSEUDO-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-selectordef-first-letter">::first-letter</span>
                <li><span class="dfn-paneled" id="term-for-selectordef-first-line">::first-line</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-SIZING-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-automatic-size">automatic size（自动尺寸）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-SYNTAX-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-letter">letter（字母）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-TABLES-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-table-wrapper-box">table wrapper box（表包装盒）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-TEXT-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-character">character（字符）</span>
                <li><span class="dfn-paneled" id="term-for-collapsible-white-space">collapsible white
                        space（可折叠空白）</span>
                <li><span class="dfn-paneled" id="term-for-justification-opportunity">justification
                        opportunity（对齐机会）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-word-break-keep-all">keep-all</span>
                <li><span class="dfn-paneled" id="term-for-segment-break">segment break（段落断点）</span>
                <li><span class="dfn-paneled" id="term-for-soft-wrap-opportunity">soft wrap opportunity（软换行机会）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-text-justify">text-justify（文本对齐）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-text-transform">text-transform（文本转换）</span>
                <li><span class="dfn-paneled" id="term-for-unicode-script">unicode script（Unicode 脚本）</span>
                <li><span class="dfn-paneled" id="term-for-white-space">white space（空白）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-white-space">white-space（空白属性）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-word-break">word-break（断词）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-VALUES-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-css-wide-keywords">css-wide keywords（全局关键字）</span>
                <li><span class="dfn-paneled" id="term-for-comb-one">|</span>
                <li><span class="dfn-paneled" id="term-for-comb-any">||</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-WRITING-MODES-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-bidi-isolate">bidi isolation（双向隔离）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-unicode-bidi-bidi-override">bidi-override</span>
                <li><span class="dfn-paneled" id="term-for-valdef-unicode-bidi-embed">embed（嵌入）</span>
                <li><span class="dfn-paneled" id="term-for-horizontal-writing-mode">horizontal writing mode（横排模式）</span>
                <li><span class="dfn-paneled" id="term-for-inline-base-direction">inline base direction（行内基方向）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-unicode-bidi-isolate">isolate（隔离）</span>
                <li><span class="dfn-paneled"
                        id="term-for-valdef-unicode-bidi-isolate-override">isolate-override（隔离覆盖）</span>
                <li><span class="dfn-paneled" id="term-for-line-over">line-over（行上方）</span>
                <li><span class="dfn-paneled" id="term-for-line-under">line-under（行下方）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-unicode-bidi-normal">normal（正常）</span>
                <li><span class="dfn-paneled" id="term-for-vertical-writing-mode">vertical writing mode（竖排模式）</span>
                <li><span class="dfn-paneled" id="term-for-valdef-writing-mode-vertical-rl">vertical-rl</span>
                <li><span class="dfn-paneled" id="term-for-writing-mode">writing mode（书写模式）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-writing-mode">writing-mode</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS2]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-propdef-line-height">line-height（行高）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS3-TEXT-DECOR]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled"
                        id="term-for-propdef-text-emphasis-position">text-emphasis-position（着重号位置）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS3-WRITING-MODES]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-propdef-direction">direction（书写方向）</span>
                <li><span class="dfn-paneled" id="term-for-propdef-unicode-bidi">unicode-bidi</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-the-rp-element">rp</span>
                <li><span class="dfn-paneled" id="term-for-rtc">rtc</span>
                <li><span class="dfn-paneled" id="term-for-the-ruby-element">ruby</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-box-4">[CSS-BOX-4]
        <dd>Elika Etemad. <a href="https://www.w3.org/TR/css-box-4/"><cite>CSS Box Model Module Level
                    4</cite></a>。2022年11月3日。WD。URL：<a
                href="https://www.w3.org/TR/css-box-4/">https://www.w3.org/TR/css-box-4/</a>
        <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.。<a href="https://www.w3.org/TR/css-cascade-5/"><cite>CSS
                    Cascading and Inheritance Level 5</cite></a>。2022年1月13日。CR。URL：<a
                href="https://www.w3.org/TR/css-cascade-5/">https://www.w3.org/TR/css-cascade-5/</a>
        <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
        <dd>Tab Atkins Jr.; Elika Etemad。<a href="https://www.w3.org/TR/css-display-3/"><cite>CSS Display Module Level
                    3</cite></a>。2022年11月18日。CR。URL：<a
                href="https://www.w3.org/TR/css-display-3/">https://www.w3.org/TR/css-display-3/</a>
        <dt id="biblio-css-fonts-5">[CSS-FONTS-5]
        <dd>Myles Maxfield; Chris Lilley。<a href="https://www.w3.org/TR/css-fonts-5/"><cite>CSS Fonts Module Level
                    5</cite></a>。2021年12月21日。WD。URL：<a
                href="https://www.w3.org/TR/css-fonts-5/">https://www.w3.org/TR/css-fonts-5/</a>
        <dt id="biblio-css-grid-2">[CSS-GRID-2]
        <dd>Tab Atkins Jr.; Elika Etemad; Rossen Atanassov。<a href="https://www.w3.org/TR/css-grid-2/"><cite>CSS Grid
                    Layout Module Level 2</cite></a>。2020年12月18日。CR。URL：<a
                href="https://www.w3.org/TR/css-grid-2/">https://www.w3.org/TR/css-grid-2/</a>
        <dt id="biblio-css-inline-3">[CSS-INLINE-3]
        <dd>Dave Cramer; Elika Etemad。<a href="https://www.w3.org/TR/css-inline-3/"><cite>CSS Inline Layout Module
                    Level 3</cite></a>。2022年11月14日。WD。URL：<a
                href="https://www.w3.org/TR/css-inline-3/">https://www.w3.org/TR/css-inline-3/</a>
        <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
        <dd>Daniel Glazman; Elika Etemad; Alan Stearns。<a href="https://www.w3.org/TR/css-pseudo-4/"><cite>CSS
                    Pseudo-Elements Module Level 4</cite></a>。2022年12月30日。WD。URL：<a
                href="https://www.w3.org/TR/css-pseudo-4/">https://www.w3.org/TR/css-pseudo-4/</a>
        <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
        <dd>Tab Atkins Jr.; Elika Etemad。<a href="https://www.w3.org/TR/css-sizing-3/"><cite>CSS Box Sizing Module
                    Level 3</cite></a>。2021年12月17日。WD。URL：<a
                href="https://www.w3.org/TR/css-sizing-3/">https://www.w3.org/TR/css-sizing-3/</a>
        <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
        <dd>Tab Atkins Jr.; Simon Sapin。<a href="https://www.w3.org/TR/css-syntax-3/"><cite>CSS Syntax Module Level
                    3</cite></a>。2021年12月24日。CR。URL：<a
                href="https://www.w3.org/TR/css-syntax-3/">https://www.w3.org/TR/css-syntax-3/</a>
        <dt id="biblio-css-tables-3">[CSS-TABLES-3]
        <dd>François Remy; Greg Whitworth; David Baron。<a href="https://www.w3.org/TR/css-tables-3/"><cite>CSS Table
                    Module Level 3</cite></a>。2019年7月27日。WD。URL：<a
                href="https://www.w3.org/TR/css-tables-3/">https://www.w3.org/TR/css-tables-3/</a>
        <dt id="biblio-css-text-3">[CSS-TEXT-3]
        <dd>Elika Etemad; Koji Ishii; Florian Rivoal。<a href="https://www.w3.org/TR/css-text-3/"><cite>CSS Text Module
                    Level 3</cite></a>。2022年5月5日。CR。URL：<a
                href="https://www.w3.org/TR/css-text-3/">https://www.w3.org/TR/css-text-3/</a>
        <dt id="biblio-css-values-3">[CSS-VALUES-3]
        <dd>Tab Atkins Jr.; Elika Etemad。<a href="https://www.w3.org/TR/css-values-3/"><cite>CSS Values and Units
                    Module Level 3</cite></a>。2022年12月1日。CR。URL：<a
                href="https://www.w3.org/TR/css-values-3/">https://www.w3.org/TR/css-values-3/</a>
        <dt id="biblio-css-values-4">[CSS-VALUES-4]
        <dd>Tab Atkins Jr.; Elika Etemad。<a href="https://www.w3.org/TR/css-values-4/"><cite>CSS Values and Units
                    Module Level 4</cite></a>。2022年10月19日。WD。URL：<a
                href="https://www.w3.org/TR/css-values-4/">https://www.w3.org/TR/css-values-4/</a>
        <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
        <dd>Elika Etemad; Koji Ishii。<a href="https://www.w3.org/TR/css-writing-modes-4/"><cite>CSS Writing Modes Level
                    4</cite></a>。2019年7月30日。CR。URL：<a
                href="https://www.w3.org/TR/css-writing-modes-4/">https://www.w3.org/TR/css-writing-modes-4/</a>
        <dt id="biblio-css2">[CSS2]
        <dd>Bert Bos; 等。<a href="https://www.w3.org/TR/CSS21/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS
                    2.1) Specification</cite></a>。2011年6月7日。REC。URL：<a
                href="https://www.w3.org/TR/CSS21/">https://www.w3.org/TR/CSS21/</a>
        <dt id="biblio-css3-text-decor">[CSS3-TEXT-DECOR]
        <dd>Elika Etemad; Koji Ishii。<a href="https://www.w3.org/TR/css-text-decor-3/"><cite>CSS Text Decoration Module
                    Level 3</cite></a>。2022年5月5日。CR。URL：<a
                href="https://www.w3.org/TR/css-text-decor-3/">https://www.w3.org/TR/css-text-decor-3/</a>
        <dt id="biblio-css3-writing-modes">[CSS3-WRITING-MODES]
        <dd>Elika Etemad; Koji Ishii。<a href="https://www.w3.org/TR/css-writing-modes-3/"><cite>CSS Writing Modes Level
                    3</cite></a>。2019年12月10日。REC。URL：<a
                href="https://www.w3.org/TR/css-writing-modes-3/">https://www.w3.org/TR/css-writing-modes-3/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 等。<a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>。Living
            Standard。URL：<a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner。<a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>。1997年3月。最佳现行实践。URL：<a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">补充性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-clreq">[CLREQ]
        <dd>Bobby Tung; 等。<a href="https://www.w3.org/TR/clreq/"><cite>Requirements for Chinese Text Layout -
                    中文排版需求</cite></a>。2022年10月9日。NOTE。URL：<a
                href="https://www.w3.org/TR/clreq/">https://www.w3.org/TR/clreq/</a>
        <dt id="biblio-css-align-3">[CSS-ALIGN-3]
        <dd>Elika Etemad; Tab Atkins Jr.。<a href="https://www.w3.org/TR/css-align-3/"><cite>CSS Box Alignment Module
                    Level 3</cite></a>。2021年12月24日。WD。URL：<a
                href="https://www.w3.org/TR/css-align-3/">https://www.w3.org/TR/css-align-3/</a>
        <dt id="biblio-css-flexbox-1">[CSS-FLEXBOX-1]
        <dd>Tab Atkins Jr.; 等。<a href="https://www.w3.org/TR/css-flexbox-1/"><cite>CSS Flexible Box Layout Module
                    Level 1</cite></a>。2018年11月19日。CR。URL：<a
                href="https://www.w3.org/TR/css-flexbox-1/">https://www.w3.org/TR/css-flexbox-1/</a>
        <dt id="biblio-jis4051">[JIS4051]
        <dd><cite>Formatting rules for Japanese documents (『日本語文書の組版方法』)。</cite> 日本标准协会。2004年。JIS X 4051:2004。日文
        <dt id="biblio-jisx4051">[JISX4051]
        <dd><cite>Line composition rules for Japanese documents。</cite> 日本标准协会。1995年。JIS X 4051-1995。日文
        <dt id="biblio-jlreq">[JLREQ]
        <dd>Hiroyuki Chiba; 等。<a href="https://www.w3.org/TR/jlreq/"><cite>Requirements for Japanese Text Layout
                    日本語組版処理の要件(日本語版)</cite></a>。2020年8月11日。NOTE。URL：<a
                href="https://www.w3.org/TR/jlreq/">https://www.w3.org/TR/jlreq/</a>
        <dt id="biblio-qa-ruby">[QA-RUBY]
        <dd>Richard Ishida。<a href="https://www.w3.org/International/questions/qa-ruby"><cite>What is ruby?</cite></a>。
            URL：<a
                href="https://www.w3.org/International/questions/qa-ruby">https://www.w3.org/International/questions/qa-ruby</a>
        <dt id="biblio-ruby">[RUBY]
        <dd>Marcin Sawicki; 等。<a href="https://www.w3.org/TR/ruby/"><cite>Ruby
                    Annotation</cite></a>。2001年5月31日。REC。URL：<a
                href="https://www.w3.org/TR/ruby/">https://www.w3.org/TR/ruby/</a>
        <dt id="biblio-simple-ruby">[SIMPLE-RUBY]
        <dd>Florian Rivoal; Atsushi Shimono; Richard Ishida。<a href="https://www.w3.org/TR/simple-ruby/"><cite>Rules
                    for Simple Placement of Japanese Ruby</cite></a>。2020年6月9日。WD。URL：<a
                href="https://www.w3.org/TR/simple-ruby/">https://www.w3.org/TR/simple-ruby/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">属性索引</span><a class="self-link"
            href="#property-index"></a></h2>
    <div class="big-element-wrapper">
        <table class="index">
            <thead>
                <tr>
                    <th scope="col">名称
                    <th scope="col">值
                    <th scope="col">初始值
                    <th scope="col">适用元素
                    <th scope="col">继承
                    <th scope="col">%百分比
                    <th scope="col">动画类型
                    <th scope="col">规范顺序
                    <th scope="col">计算值
            <tbody>
                <tr>
                    <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-align"
                            id="ref-for-propdef-ruby-align①⑧">ruby-align</a>
                    <td>start | center | space-between | space-around
                    <td>space-around
                    <td>ruby 基底、ruby 注释、ruby 基底容器、ruby 注释容器
                    <td>是
                    <td>n/a
                    <td>按计算值类型
                    <td>依语法
                    <td>指定关键字
                <tr>
                    <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-merge"
                            id="ref-for-propdef-ruby-merge①⑦">ruby-merge</a>
                    <td>separate | merge | auto
                    <td>separate
                    <td>行间 ruby 注释容器
                    <td>是
                    <td>n/a
                    <td>按计算值类型
                    <td>依语法
                    <td>指定关键字
                <tr>
                    <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-overhang"
                            id="ref-for-propdef-ruby-overhang③">ruby-overhang</a>
                    <td>auto | none
                    <td>auto
                    <td>ruby 注释容器
                    <td>是
                    <td>n/a
                    <td>按计算值类型
                    <td>依语法
                    <td>指定关键字
                <tr>
                    <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-position"
                            id="ref-for-propdef-ruby-position①②">ruby-position</a>
                    <td>[ alternate || [ over | under ] ] | inter-character
                    <td>alternate
                    <td>ruby 注释容器
                    <td>是
                    <td>n/a
                    <td>离散
                    <td>依语法
                    <td>指定关键字
        </table>
    </div>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 本规范的目标是通过抑制 ruby 注释内部的所有换行，简化布局模型。
            或者我们也可以尝试定义一些可接受的行为。<a class="issue-return" href="#issue-f0987196" title="跳转到章节">↵</a></div>
        <div class="issue"> 需要定义 <a class="property css" data-link-type="property"
                href="https://www.w3.org/TR/css-inline-3/#propdef-vertical-align">vertical-align</a> 对这些 ruby 盒的影响范围。
            见 <a href="https://github.com/w3c/csswg-drafts/issues/4987">Issue 4987</a>。<a class="issue-return"
                href="#issue-e7399eec" title="跳转到章节">↵</a></div>
        <div class="issue"> 块轴上的 margin 是否应折叠？
            这样可增强布局鲁棒性，
            但与行内轴的 inline 行为不一致。<a class="issue-return" href="#issue-ea5c17b0" title="跳转到章节">↵</a></div>
        <div class="issue"> 需插入实际扫描样例，避免让人以为这只是规范作者的胡思乱想。<a class="issue-return" href="#issue-14d7c6b1"
                title="跳转到章节">↵</a></div>
        <div class="issue"> “肩付きルビ” (Katatsuki ruby) 与 <a class="css" data-link-type="maybe"
                href="#valdef-ruby-align-start">start</a> 值类似，
            但并不完全相同。
            特别是当注释悬挂超出基底时，其行为可能与 start 对齐不同，
            具体取决于上下文，
            见 <a href="https://www.w3.org/TR/jlreq/#positioning_of_monoruby_with_respect_to_base_characters">JLREQ</a>。
            此外，它只用于竖排，
            JLTF 认为其重要性不高，
            因此未必值得为 katatsuki ruby 智能化处理投入努力。
            若 <span class="css">start</span> 有其他用途可以保留，
            否则也许应移除？<a class="issue-return" href="#issue-41435749" title="跳转到章节">↵</a>
        </div>
        <div class="issue"> 如果<a data-link-type="dfn" href="#merged-annotation">合并注释</a>导致
            <a data-link-type="dfn" href="#ruby-segments">ruby 段</a>变宽，会怎样？
            是否如当前规范所述让每个基底也等比变宽（如跨越注释）？
            这导致多基底容器内的合并注释无法居中。
            或许应允许 ruby-merge 也应用于基底容器，
            但这就需要允许基底跨多个注释
            （如果基底合并但部分注释层未合并），
            或要求基底合并时所有注释层也必须合并。<a class="issue-return" href="#issue-70e7253c" title="跳转到章节">↵</a>
        </div>
        <div class="issue"> 本节需补充说明
            邻接基底/注释内容间装饰的绘制方式，
            取决于这些盒是否与其<a data-link-type="dfn" href="#ruby-columns">列</a>等宽。<a class="issue-return"
                href="#issue-c8497783" title="跳转到章节">↵</a></div>
        <div class="issue"> 怀疑悬挂行为某些场景会影响对齐，需后续探讨。<a class="issue-return" href="#issue-adc9f0e4" title="跳转到章节">↵</a>
        </div>
    </div>
    <aside class="dfn-panel" data-for="ruby">
        <b><a href="#ruby">#ruby</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby">1.1.
                    What is ruby?</a> <a href="#ref-for-ruby①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-display-ruby">
        <b><a href="#valdef-display-ruby">#valdef-display-ruby</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-ruby">2.1.
                    Ruby-specific display Values</a>
            <li><a href="#ref-for-valdef-display-ruby①">2.1.2.
                    Non-Inline Ruby</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-container">
        <b><a href="#ruby-container">#ruby-container</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-container">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-ruby-container①">(2)</a> <a
                    href="#ref-for-ruby-container②">(3)</a> <a href="#ref-for-ruby-container③">(4)</a> <a
                    href="#ref-for-ruby-container④">(5)</a> <a href="#ref-for-ruby-container⑤">(6)</a> <a
                    href="#ref-for-ruby-container⑥">(7)</a> <a href="#ref-for-ruby-container⑦">(8)</a> <a
                    href="#ref-for-ruby-container⑧">(9)</a> <a href="#ref-for-ruby-container⑨">(10)</a>
            <li><a href="#ref-for-ruby-container①⓪">2.1.2.
                    Non-Inline Ruby</a> <a href="#ref-for-ruby-container①①">(2)</a>
            <li><a href="#ref-for-ruby-container①②">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-ruby-container①③">(2)</a> <a
                    href="#ref-for-ruby-container①④">(3)</a> <a href="#ref-for-ruby-container①⑤">(4)</a> <a
                    href="#ref-for-ruby-container①⑥">(5)</a> <a href="#ref-for-ruby-container①⑦">(6)</a> <a
                    href="#ref-for-ruby-container①⑧">(7)</a>
            <li><a href="#ref-for-ruby-container①⑨">2.3.1.
                    Segment Pairing and Annotation Levels</a> <a href="#ref-for-ruby-container②⓪">(2)</a>
            <li><a href="#ref-for-ruby-container②①">2.3.2.
                    Unit Pairing and Spanning Annotations</a>
            <li><a href="#ref-for-ruby-container②②">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-ruby-container②③">3.
                    Ruby Layout</a> <a href="#ref-for-ruby-container②④">(2)</a>
            <li><a href="#ref-for-ruby-container②⑤">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-ruby-container②⑥">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-ruby-container②⑦">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-ruby-container②⑧">(2)</a>
            <li><a href="#ref-for-ruby-container②⑨">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-ruby-container③⓪">3.3.
                    Styling Ruby Boxes</a>
            <li><a href="#ref-for-ruby-container③①">3.4.
                    Breaking Across Lines</a>
            <li><a href="#ref-for-ruby-container③②">3.4.1.
                    Breaking Between Bases</a>
            <li><a href="#ref-for-ruby-container③③">3.5.
                    Bidi Reordering</a> <a href="#ref-for-ruby-container③④">(2)</a> <a
                    href="#ref-for-ruby-container③⑤">(3)</a> <a href="#ref-for-ruby-container③⑥">(4)</a>
            <li><a href="#ref-for-ruby-container③⑦">3.6.
                    Line Spacing</a> <a href="#ref-for-ruby-container③⑧">(2)</a>
            <li><a href="#ref-for-ruby-container③⑨">4.1.
                    Ruby Positioning: the ruby-position property</a>
            <li><a href="#ref-for-ruby-container④⓪">5.1.
                    Overhanging Ruby: the ruby-overhang property</a> <a href="#ref-for-ruby-container④①">(2)</a> <a
                    href="#ref-for-ruby-container④②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-display-ruby-base">
        <b><a href="#valdef-display-ruby-base">#valdef-display-ruby-base</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-ruby-base">2.1.
                    Ruby-specific display Values</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-base-box">
        <b><a href="#ruby-base-box">#ruby-base-box</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-base-box">2.
                    Ruby Box Model</a> <a href="#ref-for-ruby-base-box①">(2)</a> <a
                    href="#ref-for-ruby-base-box②">(3)</a>
            <li><a href="#ref-for-ruby-base-box③">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-ruby-base-box④">(2)</a>
            <li><a href="#ref-for-ruby-base-box⑤">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-ruby-base-box⑥">(2)</a> <a
                    href="#ref-for-ruby-base-box⑦">(3)</a> <a href="#ref-for-ruby-base-box⑧">(4)</a> <a
                    href="#ref-for-ruby-base-box⑨">(5)</a> <a href="#ref-for-ruby-base-box①⓪">(6)</a> <a
                    href="#ref-for-ruby-base-box①①">(7)</a> <a href="#ref-for-ruby-base-box①②">(8)</a> <a
                    href="#ref-for-ruby-base-box①③">(9)</a> <a href="#ref-for-ruby-base-box①④">(10)</a> <a
                    href="#ref-for-ruby-base-box①⑤">(11)</a> <a href="#ref-for-ruby-base-box①⑥">(12)</a>
            <li><a href="#ref-for-ruby-base-box①⑦">2.3.
                    Annotation Pairing</a> <a href="#ref-for-ruby-base-box①⑧">(2)</a> <a
                    href="#ref-for-ruby-base-box①⑨">(3)</a> <a href="#ref-for-ruby-base-box②⓪">(4)</a>
            <li><a href="#ref-for-ruby-base-box②①">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-ruby-base-box②②">(2)</a> <a
                    href="#ref-for-ruby-base-box②③">(3)</a> <a href="#ref-for-ruby-base-box②④">(4)</a> <a
                    href="#ref-for-ruby-base-box②⑤">(5)</a> <a href="#ref-for-ruby-base-box②⑥">(6)</a> <a
                    href="#ref-for-ruby-base-box②⑦">(7)</a> <a href="#ref-for-ruby-base-box②⑧">(8)</a> <a
                    href="#ref-for-ruby-base-box②⑨">(9)</a> <a href="#ref-for-ruby-base-box③⓪">(10)</a>
            <li><a href="#ref-for-ruby-base-box③①">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-ruby-base-box③②">2.5.
                    White Space Collapsing</a> <a href="#ref-for-ruby-base-box③③">(2)</a>
            <li><a href="#ref-for-ruby-base-box③④">3.
                    Ruby Layout</a>
            <li><a href="#ref-for-ruby-base-box③⑤">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-ruby-base-box③⑥">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-ruby-base-box③⑦">(2)</a> <a
                    href="#ref-for-ruby-base-box③⑧">(3)</a> <a href="#ref-for-ruby-base-box③⑨">(4)</a> <a
                    href="#ref-for-ruby-base-box④⓪">(5)</a> <a href="#ref-for-ruby-base-box④①">(6)</a> <a
                    href="#ref-for-ruby-base-box④②">(7)</a> <a href="#ref-for-ruby-base-box④③">(8)</a> <a
                    href="#ref-for-ruby-base-box④④">(9)</a> <a href="#ref-for-ruby-base-box④⑤">(10)</a> <a
                    href="#ref-for-ruby-base-box④⑥">(11)</a> <a href="#ref-for-ruby-base-box④⑦">(12)</a>
            <li><a href="#ref-for-ruby-base-box④⑧">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-ruby-base-box④⑨">(2)</a> <a
                    href="#ref-for-ruby-base-box⑤⓪">(3)</a>
            <li><a href="#ref-for-ruby-base-box⑤①">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-ruby-base-box⑤②">(2)</a> <a
                    href="#ref-for-ruby-base-box⑤③">(3)</a> <a href="#ref-for-ruby-base-box⑤④">(4)</a> <a
                    href="#ref-for-ruby-base-box⑤⑤">(5)</a> <a href="#ref-for-ruby-base-box⑤⑥">(6)</a>
            <li><a href="#ref-for-ruby-base-box⑤⑦">3.3.
                    Styling Ruby Boxes</a>
            <li><a href="#ref-for-ruby-base-box⑤⑧">3.4.
                    Breaking Across Lines</a> <a href="#ref-for-ruby-base-box⑤⑨">(2)</a> <a
                    href="#ref-for-ruby-base-box⑥⓪">(3)</a>
            <li><a href="#ref-for-ruby-base-box⑥①">3.4.1.
                    Breaking Between Bases</a> <a href="#ref-for-ruby-base-box⑥②">(2)</a> <a
                    href="#ref-for-ruby-base-box⑥③">(3)</a> <a href="#ref-for-ruby-base-box⑥④">(4)</a> <a
                    href="#ref-for-ruby-base-box⑥⑤">(5)</a> <a href="#ref-for-ruby-base-box⑥⑥">(6)</a>
            <li><a href="#ref-for-ruby-base-box⑥⑦">3.4.2.
                    Breaking Within Bases</a> <a href="#ref-for-ruby-base-box⑥⑧">(2)</a> <a
                    href="#ref-for-ruby-base-box⑥⑨">(3)</a>
            <li><a href="#ref-for-ruby-base-box⑦⓪">3.5.
                    Bidi Reordering</a> <a href="#ref-for-ruby-base-box⑦①">(2)</a> <a
                    href="#ref-for-ruby-base-box⑦②">(3)</a> <a href="#ref-for-ruby-base-box⑦③">(4)</a> <a
                    href="#ref-for-ruby-base-box⑦④">(5)</a>
            <li><a href="#ref-for-ruby-base-box⑦⑤">4.2.
                    Sharing Annotation Space: the ruby-merge property</a> <a href="#ref-for-ruby-base-box⑦⑥">(2)</a> <a
                    href="#ref-for-ruby-base-box⑦⑦">(3)</a>
            <li><a href="#ref-for-ruby-base-box⑦⑧">4.3.
                    Ruby Text Distribution: the ruby-align property</a>
            <li><a href="#ref-for-ruby-base-box⑦⑨">5.1.
                    Overhanging Ruby: the ruby-overhang property</a> <a href="#ref-for-ruby-base-box⑧⓪">(2)</a> <a
                    href="#ref-for-ruby-base-box⑧①">(3)</a>
            <li><a href="#ref-for-ruby-base-box⑧②">5.2.
                    Line-edge Alignment</a>
            <li><a href="#ref-for-ruby-base-box⑧③"> A.3 Generating Parentheses</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-display-ruby-text">
        <b><a href="#valdef-display-ruby-text">#valdef-display-ruby-text</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-ruby-text">2.1.
                    Ruby-specific display Values</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-annotation-box">
        <b><a href="#ruby-annotation-box">#ruby-annotation-box</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-annotation-box">2.
                    Ruby Box Model</a> <a href="#ref-for-ruby-annotation-box①">(2)</a> <a
                    href="#ref-for-ruby-annotation-box②">(3)</a>
            <li><a href="#ref-for-ruby-annotation-box③">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-ruby-annotation-box④">(2)</a>
            <li><a href="#ref-for-ruby-annotation-box⑤">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-ruby-annotation-box⑥">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑦">(3)</a> <a href="#ref-for-ruby-annotation-box⑧">(4)</a> <a
                    href="#ref-for-ruby-annotation-box⑨">(5)</a> <a href="#ref-for-ruby-annotation-box①⓪">(6)</a> <a
                    href="#ref-for-ruby-annotation-box①①">(7)</a> <a href="#ref-for-ruby-annotation-box①②">(8)</a> <a
                    href="#ref-for-ruby-annotation-box①③">(9)</a> <a href="#ref-for-ruby-annotation-box①④">(10)</a> <a
                    href="#ref-for-ruby-annotation-box①⑤">(11)</a> <a href="#ref-for-ruby-annotation-box①⑥">(12)</a>
            <li><a href="#ref-for-ruby-annotation-box①⑦">2.3.
                    Annotation Pairing</a> <a href="#ref-for-ruby-annotation-box①⑧">(2)</a> <a
                    href="#ref-for-ruby-annotation-box①⑨">(3)</a> <a href="#ref-for-ruby-annotation-box②⓪">(4)</a> <a
                    href="#ref-for-ruby-annotation-box②①">(5)</a> <a href="#ref-for-ruby-annotation-box②②">(6)</a>
            <li><a href="#ref-for-ruby-annotation-box②③">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-ruby-annotation-box②④">(2)</a> <a
                    href="#ref-for-ruby-annotation-box②⑤">(3)</a> <a href="#ref-for-ruby-annotation-box②⑥">(4)</a> <a
                    href="#ref-for-ruby-annotation-box②⑦">(5)</a> <a href="#ref-for-ruby-annotation-box②⑧">(6)</a> <a
                    href="#ref-for-ruby-annotation-box②⑨">(7)</a> <a href="#ref-for-ruby-annotation-box③⓪">(8)</a> <a
                    href="#ref-for-ruby-annotation-box③①">(9)</a> <a href="#ref-for-ruby-annotation-box③②">(10)</a> <a
                    href="#ref-for-ruby-annotation-box③③">(11)</a> <a href="#ref-for-ruby-annotation-box③④">(12)</a> <a
                    href="#ref-for-ruby-annotation-box③⑤">(13)</a>
            <li><a href="#ref-for-ruby-annotation-box③⑥">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a> <a
                    href="#ref-for-ruby-annotation-box③⑦">(2)</a> <a href="#ref-for-ruby-annotation-box③⑧">(3)</a> <a
                    href="#ref-for-ruby-annotation-box③⑨">(4)</a>
            <li><a href="#ref-for-ruby-annotation-box④⓪">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-ruby-annotation-box④①">3.1.
                    Interlinear Ruby Layout</a> <a href="#ref-for-ruby-annotation-box④②">(2)</a>
            <li><a href="#ref-for-ruby-annotation-box④③">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-ruby-annotation-box④④">(2)</a> <a
                    href="#ref-for-ruby-annotation-box④⑤">(3)</a> <a href="#ref-for-ruby-annotation-box④⑥">(4)</a> <a
                    href="#ref-for-ruby-annotation-box④⑦">(5)</a> <a href="#ref-for-ruby-annotation-box④⑧">(6)</a> <a
                    href="#ref-for-ruby-annotation-box④⑨">(7)</a> <a href="#ref-for-ruby-annotation-box⑤⓪">(8)</a> <a
                    href="#ref-for-ruby-annotation-box⑤①">(9)</a> <a href="#ref-for-ruby-annotation-box⑤②">(10)</a> <a
                    href="#ref-for-ruby-annotation-box⑤③">(11)</a>
            <li><a href="#ref-for-ruby-annotation-box⑤④">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-ruby-annotation-box⑤⑤">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑤⑥">(3)</a> <a href="#ref-for-ruby-annotation-box⑤⑦">(4)</a>
            <li><a href="#ref-for-ruby-annotation-box⑤⑧">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-ruby-annotation-box⑤⑨">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑥⓪">(3)</a> <a href="#ref-for-ruby-annotation-box⑥①">(4)</a> <a
                    href="#ref-for-ruby-annotation-box⑥②">(5)</a> <a href="#ref-for-ruby-annotation-box⑥③">(6)</a> <a
                    href="#ref-for-ruby-annotation-box⑥④">(7)</a> <a href="#ref-for-ruby-annotation-box⑥⑤">(8)</a> <a
                    href="#ref-for-ruby-annotation-box⑥⑥">(9)</a> <a href="#ref-for-ruby-annotation-box⑥⑦">(10)</a> <a
                    href="#ref-for-ruby-annotation-box⑥⑧">(11)</a>
            <li><a href="#ref-for-ruby-annotation-box⑥⑨">3.3.
                    Styling Ruby Boxes</a>
            <li><a href="#ref-for-ruby-annotation-box⑦⓪">3.4.
                    Breaking Across Lines</a> <a href="#ref-for-ruby-annotation-box⑦①">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑦②">(3)</a>
            <li><a href="#ref-for-ruby-annotation-box⑦③">3.4.1.
                    Breaking Between Bases</a> <a href="#ref-for-ruby-annotation-box⑦④">(2)</a>
            <li><a href="#ref-for-ruby-annotation-box⑦⑤">3.4.2.
                    Breaking Within Bases</a> <a href="#ref-for-ruby-annotation-box⑦⑥">(2)</a>
            <li><a href="#ref-for-ruby-annotation-box⑦⑦">3.5.
                    Bidi Reordering</a> <a href="#ref-for-ruby-annotation-box⑦⑧">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑦⑨">(3)</a> <a href="#ref-for-ruby-annotation-box⑧⓪">(4)</a> <a
                    href="#ref-for-ruby-annotation-box⑧①">(5)</a> <a href="#ref-for-ruby-annotation-box⑧②">(6)</a>
            <li><a href="#ref-for-ruby-annotation-box⑧③">3.6.
                    Line Spacing</a> <a href="#ref-for-ruby-annotation-box⑧④">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑧⑤">(3)</a>
            <li><a href="#ref-for-ruby-annotation-box⑧⑥">4.1.
                    Ruby Positioning: the ruby-position property</a> <a href="#ref-for-ruby-annotation-box⑧⑦">(2)</a> <a
                    href="#ref-for-ruby-annotation-box⑧⑧">(3)</a> <a href="#ref-for-ruby-annotation-box⑧⑨">(4)</a> <a
                    href="#ref-for-ruby-annotation-box⑨⓪">(5)</a> <a href="#ref-for-ruby-annotation-box⑨①">(6)</a> <a
                    href="#ref-for-ruby-annotation-box⑨②">(7)</a>
            <li><a href="#ref-for-ruby-annotation-box⑨③">4.2.
                    Sharing Annotation Space: the ruby-merge property</a> <a
                    href="#ref-for-ruby-annotation-box⑨④">(2)</a> <a href="#ref-for-ruby-annotation-box⑨⑤">(3)</a> <a
                    href="#ref-for-ruby-annotation-box⑨⑥">(4)</a>
            <li><a href="#ref-for-ruby-annotation-box⑨⑦">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-ruby-annotation-box⑨⑧">(2)</a>
                <a href="#ref-for-ruby-annotation-box⑨⑨">(3)</a>
            <li><a href="#ref-for-ruby-annotation-box①⓪⓪">5.1.
                    Overhanging Ruby: the ruby-overhang property</a> <a href="#ref-for-ruby-annotation-box①⓪①">(2)</a>
                <a href="#ref-for-ruby-annotation-box①⓪②">(3)</a> <a href="#ref-for-ruby-annotation-box①⓪③">(4)</a> <a
                    href="#ref-for-ruby-annotation-box①⓪④">(5)</a>
            <li><a href="#ref-for-ruby-annotation-box①⓪⑤">5.2.
                    Line-edge Alignment</a> <a href="#ref-for-ruby-annotation-box①⓪⑥">(2)</a>
            <li><a href="#ref-for-ruby-annotation-box①⓪⑦"> Changes since the 2 December 2021 WD</a> <a
                    href="#ref-for-ruby-annotation-box①⓪⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-display-ruby-base-container">
        <b><a href="#valdef-display-ruby-base-container">#valdef-display-ruby-base-container</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-ruby-base-container">2.1.
                    Ruby-specific display Values</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-base-container-box">
        <b><a href="#ruby-base-container-box">#ruby-base-container-box</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-base-container-box">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-ruby-base-container-box①">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-ruby-base-container-box②">(2)</a> <a
                    href="#ref-for-ruby-base-container-box③">(3)</a> <a href="#ref-for-ruby-base-container-box④">(4)</a>
                <a href="#ref-for-ruby-base-container-box⑤">(5)</a> <a href="#ref-for-ruby-base-container-box⑥">(6)</a>
                <a href="#ref-for-ruby-base-container-box⑦">(7)</a> <a href="#ref-for-ruby-base-container-box⑧">(8)</a>
                <a href="#ref-for-ruby-base-container-box⑨">(9)</a> <a
                    href="#ref-for-ruby-base-container-box①⓪">(10)</a> <a
                    href="#ref-for-ruby-base-container-box①①">(11)</a> <a
                    href="#ref-for-ruby-base-container-box①②">(12)</a> <a
                    href="#ref-for-ruby-base-container-box①③">(13)</a>
            <li><a href="#ref-for-ruby-base-container-box①④">2.3.1.
                    Segment Pairing and Annotation Levels</a> <a href="#ref-for-ruby-base-container-box①⑤">(2)</a> <a
                    href="#ref-for-ruby-base-container-box①⑥">(3)</a> <a
                    href="#ref-for-ruby-base-container-box①⑦">(4)</a> <a
                    href="#ref-for-ruby-base-container-box①⑧">(5)</a>
            <li><a href="#ref-for-ruby-base-container-box①⑨">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-ruby-base-container-box②⓪">(2)</a> <a
                    href="#ref-for-ruby-base-container-box②①">(3)</a>
            <li><a href="#ref-for-ruby-base-container-box②②">2.5.
                    White Space Collapsing</a> <a href="#ref-for-ruby-base-container-box②③">(2)</a>
            <li><a href="#ref-for-ruby-base-container-box②④">3.
                    Ruby Layout</a>
            <li><a href="#ref-for-ruby-base-container-box②⑤">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-ruby-base-container-box②⑥">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-ruby-base-container-box②⑦">(2)</a> <a
                    href="#ref-for-ruby-base-container-box②⑧">(3)</a> <a
                    href="#ref-for-ruby-base-container-box②⑨">(4)</a> <a
                    href="#ref-for-ruby-base-container-box③⓪">(5)</a>
            <li><a href="#ref-for-ruby-base-container-box③①">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-ruby-base-container-box③②">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-ruby-base-container-box③③">(2)</a>
            <li><a href="#ref-for-ruby-base-container-box③④">3.5.
                    Bidi Reordering</a>
            <li><a href="#ref-for-ruby-base-container-box③⑤">3.6.
                    Line Spacing</a> <a href="#ref-for-ruby-base-container-box③⑥">(2)</a>
            <li><a href="#ref-for-ruby-base-container-box③⑦">5.1.
                    Overhanging Ruby: the ruby-overhang property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-display-ruby-text-container">
        <b><a href="#valdef-display-ruby-text-container">#valdef-display-ruby-text-container</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-display-ruby-text-container">2.1.
                    Ruby-specific display Values</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-annotation-container-box">
        <b><a href="#ruby-annotation-container-box">#ruby-annotation-container-box</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-annotation-container-box">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-ruby-annotation-container-box①">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-ruby-annotation-container-box②">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box③">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box④">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤">(5)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥">(6)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑦">(7)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑧">(8)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑨">(9)</a> <a
                    href="#ref-for-ruby-annotation-container-box①⓪">(10)</a>
            <li><a href="#ref-for-ruby-annotation-container-box①①">2.3.1.
                    Segment Pairing and Annotation Levels</a> <a href="#ref-for-ruby-annotation-container-box①②">(2)</a>
                <a href="#ref-for-ruby-annotation-container-box①③">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box①④">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box①⑤">(5)</a>
            <li><a href="#ref-for-ruby-annotation-container-box①⑥">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-ruby-annotation-container-box①⑦">(2)</a>
                <a href="#ref-for-ruby-annotation-container-box①⑧">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box①⑨">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box②⓪">(5)</a>
            <li><a href="#ref-for-ruby-annotation-container-box②①">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-ruby-annotation-container-box②②">2.5.
                    White Space Collapsing</a> <a href="#ref-for-ruby-annotation-container-box②③">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box②④">(3)</a>
            <li><a href="#ref-for-ruby-annotation-container-box②⑤">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-ruby-annotation-container-box②⑥">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box②⑦">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box②⑧">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box②⑨">(5)</a> <a
                    href="#ref-for-ruby-annotation-container-box③⓪">(6)</a>
            <li><a href="#ref-for-ruby-annotation-container-box③①">3.1.2.
                    Block-axis Interlinear Layout</a> <a href="#ref-for-ruby-annotation-container-box③②">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box③③">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box③④">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box③⑤">(5)</a>
            <li><a href="#ref-for-ruby-annotation-container-box③⑥">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-ruby-annotation-container-box③⑦">(2)</a>
            <li><a href="#ref-for-ruby-annotation-container-box③⑧">3.3.
                    Styling Ruby Boxes</a> <a href="#ref-for-ruby-annotation-container-box③⑨">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box④⓪">(3)</a>
            <li><a href="#ref-for-ruby-annotation-container-box④①">3.5.
                    Bidi Reordering</a> <a href="#ref-for-ruby-annotation-container-box④②">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box④③">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box④④">(4)</a>
            <li><a href="#ref-for-ruby-annotation-container-box④⑤">3.6.
                    Line Spacing</a> <a href="#ref-for-ruby-annotation-container-box④⑥">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box④⑦">(3)</a>
            <li><a href="#ref-for-ruby-annotation-container-box④⑧">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-ruby-annotation-container-box④⑨">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤⓪">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤①">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤②">(5)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤③">(6)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤④">(7)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤⑤">(8)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤⑥">(9)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑤⑦">(10)</a>
            <li><a href="#ref-for-ruby-annotation-container-box⑤⑧">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-ruby-annotation-container-box⑤⑨">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥⓪">(2)</a>
            <li><a href="#ref-for-ruby-annotation-container-box⑥①">5.1.
                    Overhanging Ruby: the ruby-overhang property</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥②">(2)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥③">(3)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥④">(4)</a> <a
                    href="#ref-for-ruby-annotation-container-box⑥⑤">(5)</a>
            <li><a href="#ref-for-ruby-annotation-container-box⑥⑥"> Changes since the 2 December 2021 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-formatting-context">
        <b><a href="#ruby-formatting-context">#ruby-formatting-context</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-formatting-context">2.1.1.
                    The Ruby Formatting Context</a> <a href="#ref-for-ruby-formatting-context①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="internal-ruby-boxes">
        <b><a href="#internal-ruby-boxes">#internal-ruby-boxes</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-internal-ruby-boxes">2.1.1.
                    The Ruby Formatting Context</a>
            <li><a href="#ref-for-internal-ruby-boxes①">2.1.2.
                    Non-Inline Ruby</a>
            <li><a href="#ref-for-internal-ruby-boxes②">3.5.
                    Bidi Reordering</a> <a href="#ref-for-internal-ruby-boxes③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="intra-ruby-white-space">
        <b><a href="#intra-ruby-white-space">#intra-ruby-white-space</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-intra-ruby-white-space">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-intra-ruby-white-space①">(2)</a> <a
                    href="#ref-for-intra-ruby-white-space②">(3)</a> <a href="#ref-for-intra-ruby-white-space③">(4)</a>
            <li><a href="#ref-for-intra-ruby-white-space④">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-intra-ruby-white-space⑤">(2)</a> <a
                    href="#ref-for-intra-ruby-white-space⑥">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="inter-base-white-space">
        <b><a href="#inter-base-white-space">#inter-base-white-space</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-inter-base-white-space">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inter-base-white-space①">(2)</a>
            <li><a href="#ref-for-inter-base-white-space②">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-inter-base-white-space③">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="inter-annotation-white-space">
        <b><a href="#inter-annotation-white-space">#inter-annotation-white-space</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-inter-annotation-white-space">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inter-annotation-white-space①">(2)</a>
            <li><a href="#ref-for-inter-annotation-white-space②">2.5.
                    White Space Collapsing</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="inter-segment-white-space">
        <b><a href="#inter-segment-white-space">#inter-segment-white-space</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-inter-segment-white-space">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-inter-segment-white-space①">(2)</a>
            <li><a href="#ref-for-inter-segment-white-space②">2.3.1.
                    Segment Pairing and Annotation Levels</a>
            <li><a href="#ref-for-inter-segment-white-space③">2.5.
                    White Space Collapsing</a> <a href="#ref-for-inter-segment-white-space④">(2)</a>
            <li><a href="#ref-for-inter-segment-white-space⑤">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="intra-level-white-space">
        <b><a href="#intra-level-white-space">#intra-level-white-space</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-intra-level-white-space">2.2.
                    Anonymous Ruby Box Generation</a>
            <li><a href="#ref-for-intra-level-white-space①">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-intra-level-white-space②">(2)</a> <a
                    href="#ref-for-intra-level-white-space③">(3)</a> <a href="#ref-for-intra-level-white-space④">(4)</a>
                <a href="#ref-for-intra-level-white-space⑤">(5)</a> <a href="#ref-for-intra-level-white-space⑥">(6)</a>
                <a href="#ref-for-intra-level-white-space⑦">(7)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="pairing">
        <b><a href="#pairing">#pairing</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-pairing">1.1.
                    What is ruby?</a>
            <li><a href="#ref-for-pairing①">2.2.
                    Anonymous Ruby Box Generation</a> <a href="#ref-for-pairing②">(2)</a>
            <li><a href="#ref-for-pairing③">2.3.
                    Annotation Pairing</a>
            <li><a href="#ref-for-pairing④">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-pairing⑤">(2)</a>
            <li><a href="#ref-for-pairing⑥">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-pairing⑦"> Changes since the 5 August 2014 WD</a>
            <li><a href="#ref-for-pairing⑧"> Changes since the 19 September 2013 WD</a> <a
                    href="#ref-for-pairing⑨">(2)</a>
            <li><a href="#ref-for-pairing①⓪"> Changes since the 30 June 2011 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="span">
        <b><a href="#span">#span</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-span">2.3.
                    Annotation Pairing</a>
            <li><a href="#ref-for-span①">2.3.2.
                    Unit Pairing and Spanning Annotations</a>
            <li><a href="#ref-for-span②">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-span③">3.2.
                    Inter-character Ruby Layout</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="spanning-annotation">
        <b><a href="#spanning-annotation">#spanning-annotation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-spanning-annotation">2.3.2.
                    Unit Pairing and Spanning Annotations</a>
            <li><a href="#ref-for-spanning-annotation①">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-spanning-annotation②">(2)</a> <a
                    href="#ref-for-spanning-annotation③">(3)</a> <a href="#ref-for-spanning-annotation④">(4)</a> <a
                    href="#ref-for-spanning-annotation⑤">(5)</a> <a href="#ref-for-spanning-annotation⑥">(6)</a> <a
                    href="#ref-for-spanning-annotation⑦">(7)</a> <a href="#ref-for-spanning-annotation⑧">(8)</a> <a
                    href="#ref-for-spanning-annotation⑨">(9)</a> <a href="#ref-for-spanning-annotation①⓪">(10)</a> <a
                    href="#ref-for-spanning-annotation①①">(11)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-columns">
        <b><a href="#ruby-columns">#ruby-columns</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-columns">2.
                    Ruby Box Model</a>
            <li><a href="#ref-for-ruby-columns①">2.3.2.
                    Unit Pairing and Spanning Annotations</a>
            <li><a href="#ref-for-ruby-columns②">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-ruby-columns③">(2)</a> <a
                    href="#ref-for-ruby-columns④">(3)</a> <a href="#ref-for-ruby-columns⑤">(4)</a> <a
                    href="#ref-for-ruby-columns⑥">(5)</a> <a href="#ref-for-ruby-columns⑦">(6)</a> <a
                    href="#ref-for-ruby-columns⑧">(7)</a> <a href="#ref-for-ruby-columns⑨">(8)</a> <a
                    href="#ref-for-ruby-columns①⓪">(9)</a> <a href="#ref-for-ruby-columns①①">(10)</a> <a
                    href="#ref-for-ruby-columns①②">(11)</a>
            <li><a href="#ref-for-ruby-columns①③">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-ruby-columns①④">(2)</a>
            <li><a href="#ref-for-ruby-columns①⑤">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-ruby-columns①⑥">4.4.
                    Ruby Text Decoration</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-segments">
        <b><a href="#ruby-segments">#ruby-segments</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-ruby-segments">2.
                    Ruby Box Model</a> <a href="#ref-for-ruby-segments①">(2)</a> <a
                    href="#ref-for-ruby-segments②">(3)</a> <a href="#ref-for-ruby-segments③">(4)</a>
            <li><a href="#ref-for-ruby-segments④">2.3.
                    Annotation Pairing</a>
            <li><a href="#ref-for-ruby-segments⑤">2.3.1.
                    Segment Pairing and Annotation Levels</a> <a href="#ref-for-ruby-segments⑥">(2)</a>
            <li><a href="#ref-for-ruby-segments⑦">2.3.2.
                    Unit Pairing and Spanning Annotations</a> <a href="#ref-for-ruby-segments⑧">(2)</a> <a
                    href="#ref-for-ruby-segments⑨">(3)</a>
            <li><a href="#ref-for-ruby-segments①⓪">2.5.
                    White Space Collapsing</a> <a href="#ref-for-ruby-segments①①">(2)</a> <a
                    href="#ref-for-ruby-segments①②">(3)</a>
            <li><a href="#ref-for-ruby-segments①③">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-ruby-segments①④">(2)</a>
            <li><a href="#ref-for-ruby-segments①⑤">3.5.
                    Bidi Reordering</a>
            <li><a href="#ref-for-ruby-segments①⑥">4.1.
                    Ruby Positioning: the ruby-position property</a>
            <li><a href="#ref-for-ruby-segments①⑦">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-ruby-segments①⑧">4.3.
                    Ruby Text Distribution: the ruby-align property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="annotation-level">
        <b><a href="#annotation-level">#annotation-level</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-annotation-level">2.
                    Ruby Box Model</a>
            <li><a href="#ref-for-annotation-level①">2.3.
                    Annotation Pairing</a> <a href="#ref-for-annotation-level②">(2)</a> <a
                    href="#ref-for-annotation-level③">(3)</a>
            <li><a href="#ref-for-annotation-level④">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-annotation-level⑤">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-annotation-level⑥">3.1.2.
                    Block-axis Interlinear Layout</a>
            <li><a href="#ref-for-annotation-level⑦">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-annotation-level⑧">4.1.
                    Ruby Positioning: the ruby-position property</a> <a href="#ref-for-annotation-level⑨">(2)</a> <a
                    href="#ref-for-annotation-level①⓪">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="base-level">
        <b><a href="#base-level">#base-level</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-base-level">2.
                    Ruby Box Model</a>
            <li><a href="#ref-for-base-level①">3.
                    Ruby Layout</a> <a href="#ref-for-base-level②">(2)</a>
            <li><a href="#ref-for-base-level③">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-base-level④">3.4.1.
                    Breaking Between Bases</a>
            <li><a href="#ref-for-base-level⑤">4.4.
                    Ruby Text Decoration</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="hidden-annotation">
        <b><a href="#hidden-annotation">#hidden-annotation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-hidden-annotation">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a> <a
                    href="#ref-for-hidden-annotation①">(2)</a> <a href="#ref-for-hidden-annotation②">(3)</a> <a
                    href="#ref-for-hidden-annotation③">(4)</a> <a href="#ref-for-hidden-annotation④">(5)</a> <a
                    href="#ref-for-hidden-annotation⑤">(6)</a> <a href="#ref-for-hidden-annotation⑥">(7)</a> <a
                    href="#ref-for-hidden-annotation⑦">(8)</a>
            <li><a href="#ref-for-hidden-annotation⑧">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-hidden-annotation⑨"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="auto-hidden">
        <b><a href="#auto-hidden">#auto-hidden</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-auto-hidden">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a> <a
                    href="#ref-for-auto-hidden①">(2)</a>
            <li><a href="#ref-for-auto-hidden②"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="propdef-ruby-position">
        <b><a href="#propdef-ruby-position">#propdef-ruby-position</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-propdef-ruby-position">1.2.
                    Module interactions</a>
            <li><a href="#ref-for-propdef-ruby-position①">3.1.2.
                    Block-axis Interlinear Layout</a>
            <li><a href="#ref-for-propdef-ruby-position②">4.1.
                    Ruby Positioning: the ruby-position property</a> <a href="#ref-for-propdef-ruby-position③">(2)</a>
                <a href="#ref-for-propdef-ruby-position④">(3)</a> <a href="#ref-for-propdef-ruby-position⑤">(4)</a>
            <li><a href="#ref-for-propdef-ruby-position⑥">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-propdef-ruby-position⑦"> Changes since the 29 April 2020 WD</a>
            <li><a href="#ref-for-propdef-ruby-position⑧"> Changes since the 5 August 2014 WD</a> <a
                    href="#ref-for-propdef-ruby-position⑨">(2)</a>
            <li><a href="#ref-for-propdef-ruby-position①⓪"> Changes since the 30 June 2011 WD</a> <a
                    href="#ref-for-propdef-ruby-position①①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-position-alternate">
        <b><a href="#valdef-ruby-position-alternate">#valdef-ruby-position-alternate</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-position-alternate">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-valdef-ruby-position-alternate①">(2)</a> <a
                    href="#ref-for-valdef-ruby-position-alternate②">(3)</a> <a
                    href="#ref-for-valdef-ruby-position-alternate③">(4)</a>
            <li><a href="#ref-for-valdef-ruby-position-alternate④"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-position-over">
        <b><a href="#valdef-ruby-position-over">#valdef-ruby-position-over</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-position-over">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-valdef-ruby-position-over①">(2)</a> <a
                    href="#ref-for-valdef-ruby-position-over②">(3)</a> <a
                    href="#ref-for-valdef-ruby-position-over③">(4)</a> <a
                    href="#ref-for-valdef-ruby-position-over④">(5)</a> <a
                    href="#ref-for-valdef-ruby-position-over⑤">(6)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-position-under">
        <b><a href="#valdef-ruby-position-under">#valdef-ruby-position-under</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-position-under">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-valdef-ruby-position-under①">(2)</a> <a
                    href="#ref-for-valdef-ruby-position-under②">(3)</a> <a
                    href="#ref-for-valdef-ruby-position-under③">(4)</a> <a
                    href="#ref-for-valdef-ruby-position-under④">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-position-inter-character">
        <b><a href="#valdef-ruby-position-inter-character">#valdef-ruby-position-inter-character</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-position-inter-character">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-valdef-ruby-position-inter-character①">3.4.
                    Breaking Across Lines</a>
            <li><a href="#ref-for-valdef-ruby-position-inter-character②">4.1.
                    Ruby Positioning: the ruby-position property</a>
            <li><a href="#ref-for-valdef-ruby-position-inter-character③"> Changes since the 30 June 2011 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="ruby-position-inter-character-annotation">
        <b><a
                href="#ruby-position-inter-character-annotation">#ruby-position-inter-character-annotation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-ruby-position-inter-character-annotation">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①">3.
                    Ruby Layout</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation②">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation③">3.1.2.
                    Block-axis Interlinear Layout</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation④">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-ruby-position-inter-character-annotation⑤">(2)</a>
                <a href="#ref-for-ruby-position-inter-character-annotation⑥">(3)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation⑦">(4)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation⑧">(5)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation⑨">(6)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation①⓪">(7)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation①①">(8)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation①②">(9)</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①③">3.4.
                    Breaking Across Lines</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①④">3.4.2.
                    Breaking Within Bases</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①⑤">4.1.
                    Ruby Positioning: the ruby-position property</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation①⑥">(2)</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation①⑦">(3)</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①⑧">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation①⑨">4.3.
                    Ruby Text Distribution: the ruby-align property</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation②⓪"> Changes since the 2 December 2021 WD</a>
            <li><a href="#ref-for-ruby-position-inter-character-annotation②①"> Changes since the 29 April 2020 WD</a> <a
                    href="#ref-for-ruby-position-inter-character-annotation②②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="interlinear-annotations">
        <b><a href="#interlinear-annotations">#interlinear-annotations</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-interlinear-annotations">2.3.
                    Annotation Pairing</a>
            <li><a href="#ref-for-interlinear-annotations①">2.5.
                    White Space Collapsing</a>
            <li><a href="#ref-for-interlinear-annotations②">3.
                    Ruby Layout</a>
            <li><a href="#ref-for-interlinear-annotations③">3.1.
                    Interlinear Ruby Layout</a>
            <li><a href="#ref-for-interlinear-annotations④">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-interlinear-annotations⑤">(2)</a>
            <li><a href="#ref-for-interlinear-annotations⑥">3.1.2.
                    Block-axis Interlinear Layout</a>
            <li><a href="#ref-for-interlinear-annotations⑦">4.1.
                    Ruby Positioning: the ruby-position property</a>
            <li><a href="#ref-for-interlinear-annotations⑧">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-interlinear-annotations⑨"> Changes since the 29 April 2020 WD</a> <a
                    href="#ref-for-interlinear-annotations①⓪">(2)</a> <a
                    href="#ref-for-interlinear-annotations①①">(3)</a> <a
                    href="#ref-for-interlinear-annotations①②">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="propdef-ruby-merge">
        <b><a href="#propdef-ruby-merge">#propdef-ruby-merge</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-propdef-ruby-merge">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-propdef-ruby-merge①">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-propdef-ruby-merge②">(2)</a> <a
                    href="#ref-for-propdef-ruby-merge③">(3)</a> <a href="#ref-for-propdef-ruby-merge④">(4)</a>
            <li><a href="#ref-for-propdef-ruby-merge⑤">3.5.
                    Bidi Reordering</a>
            <li><a href="#ref-for-propdef-ruby-merge⑥">4.2.
                    Sharing Annotation Space: the ruby-merge property</a> <a href="#ref-for-propdef-ruby-merge⑦">(2)</a>
                <a href="#ref-for-propdef-ruby-merge⑧">(3)</a> <a href="#ref-for-propdef-ruby-merge⑨">(4)</a>
            <li><a href="#ref-for-propdef-ruby-merge①⓪">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-propdef-ruby-merge①①">(2)</a>
                <a href="#ref-for-propdef-ruby-merge①②">(3)</a>
            <li><a href="#ref-for-propdef-ruby-merge①③">5.1.
                    Overhanging Ruby: the ruby-overhang property</a>
            <li><a href="#ref-for-propdef-ruby-merge①④"> Changes since the 29 April 2020 WD</a>
            <li><a href="#ref-for-propdef-ruby-merge①⑤"> Changes since the 5 August 2014 WD</a>
            <li><a href="#ref-for-propdef-ruby-merge①⑥"> Changes since the 30 June 2011 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="merged-annotation">
        <b><a href="#merged-annotation">#merged-annotation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-merged-annotation">1.1.
                    What is ruby?</a>
            <li><a href="#ref-for-merged-annotation①">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-merged-annotation②">3.5.
                    Bidi Reordering</a> <a href="#ref-for-merged-annotation③">(2)</a> <a
                    href="#ref-for-merged-annotation④">(3)</a>
            <li><a href="#ref-for-merged-annotation⑤">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-merged-annotation⑥">(2)</a>
            <li><a href="#ref-for-merged-annotation⑦"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-merge-separate">
        <b><a href="#valdef-ruby-merge-separate">#valdef-ruby-merge-separate</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-merge-separate">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-valdef-ruby-merge-separate①">3.1.1.
                    Inline-axis Interlinear Layout</a>
            <li><a href="#ref-for-valdef-ruby-merge-separate②">4.2.
                    Sharing Annotation Space: the ruby-merge property</a> <a
                    href="#ref-for-valdef-ruby-merge-separate③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-merge-merge">
        <b><a href="#valdef-ruby-merge-merge">#valdef-ruby-merge-merge</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-merge-merge">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-valdef-ruby-merge-merge①">3.5.
                    Bidi Reordering</a>
            <li><a href="#ref-for-valdef-ruby-merge-merge②">4.2.
                    Sharing Annotation Space: the ruby-merge property</a>
            <li><a href="#ref-for-valdef-ruby-merge-merge③"> Changes since the 29 April 2020 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-merge-auto">
        <b><a href="#valdef-ruby-merge-auto">#valdef-ruby-merge-auto</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-merge-auto">2.4.
                    Hiding Annotations: visibility: collapse and auto-hidden ruby</a>
            <li><a href="#ref-for-valdef-ruby-merge-auto①">4.3.
                    Ruby Text Distribution: the ruby-align property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="propdef-ruby-align">
        <b><a href="#propdef-ruby-align">#propdef-ruby-align</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-propdef-ruby-align">3.1.1.
                    Inline-axis Interlinear Layout</a> <a href="#ref-for-propdef-ruby-align①">(2)</a> <a
                    href="#ref-for-propdef-ruby-align②">(3)</a> <a href="#ref-for-propdef-ruby-align③">(4)</a> <a
                    href="#ref-for-propdef-ruby-align④">(5)</a> <a href="#ref-for-propdef-ruby-align⑤">(6)</a>
            <li><a href="#ref-for-propdef-ruby-align⑥">3.2.
                    Inter-character Ruby Layout</a> <a href="#ref-for-propdef-ruby-align⑦">(2)</a>
            <li><a href="#ref-for-propdef-ruby-align⑧">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a href="#ref-for-propdef-ruby-align⑨">(2)</a>
                <a href="#ref-for-propdef-ruby-align①⓪">(3)</a> <a href="#ref-for-propdef-ruby-align①①">(4)</a> <a
                    href="#ref-for-propdef-ruby-align①②">(5)</a>
            <li><a href="#ref-for-propdef-ruby-align①③">5.1.
                    Overhanging Ruby: the ruby-overhang property</a>
            <li><a href="#ref-for-propdef-ruby-align①④"> Changes since the 29 April 2020 WD</a> <a
                    href="#ref-for-propdef-ruby-align①⑤">(2)</a>
            <li><a href="#ref-for-propdef-ruby-align①⑥"> Changes since the 30 June 2011 WD</a> <a
                    href="#ref-for-propdef-ruby-align①⑦">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-align-start">
        <b><a href="#valdef-ruby-align-start">#valdef-ruby-align-start</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-align-start">3.2.
                    Inter-character Ruby Layout</a>
            <li><a href="#ref-for-valdef-ruby-align-start①">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a
                    href="#ref-for-valdef-ruby-align-start②">(2)</a> <a href="#ref-for-valdef-ruby-align-start③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-align-center">
        <b><a href="#valdef-ruby-align-center">#valdef-ruby-align-center</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-align-center">4.3.
                    Ruby Text Distribution: the ruby-align property</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-align-space-between">
        <b><a href="#valdef-ruby-align-space-between">#valdef-ruby-align-space-between</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-align-space-between">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a
                    href="#ref-for-valdef-ruby-align-space-between①">(2)</a> <a
                    href="#ref-for-valdef-ruby-align-space-between②">(3)</a> <a
                    href="#ref-for-valdef-ruby-align-space-between③">(4)</a>
            <li><a href="#ref-for-valdef-ruby-align-space-between④"> Changes since the 30 June 2011 WD</a> <a
                    href="#ref-for-valdef-ruby-align-space-between⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="valdef-ruby-align-space-around">
        <b><a href="#valdef-ruby-align-space-around">#valdef-ruby-align-space-around</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-valdef-ruby-align-space-around">4.3.
                    Ruby Text Distribution: the ruby-align property</a> <a
                    href="#ref-for-valdef-ruby-align-space-around①">(2)</a> <a
                    href="#ref-for-valdef-ruby-align-space-around②">(3)</a>
            <li><a href="#ref-for-valdef-ruby-align-space-around③"> Changes since the 30 June 2011 WD</a> <a
                    href="#ref-for-valdef-ruby-align-space-around④">(2)</a> <a
                    href="#ref-for-valdef-ruby-align-space-around⑤">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="propdef-ruby-overhang">
        <b><a href="#propdef-ruby-overhang">#propdef-ruby-overhang</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-propdef-ruby-overhang">5.1.
                    Overhanging Ruby: the ruby-overhang property</a> <a href="#ref-for-propdef-ruby-overhang①">(2)</a>
            <li><a href="#ref-for-propdef-ruby-overhang②"> Changes since the 5 August 2014 WD</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="bopomofo-tone-marks">
        <b><a href="#bopomofo-tone-marks">#bopomofo-tone-marks</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-bopomofo-tone-marks">6.
                    Glossary</a> <a href="#ref-for-bopomofo-tone-marks①">(2)</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script src="/dropdown.js"></script>
