<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>CSS 自定义高亮 API 模块第 1 级</title>
    <meta content="WD" name="w3c-status">
    <meta content="Bikeshed version 4f3d0b2d0, updated Wed Dec 1 15:41:36 2021 -0800" name="generator">
    <link href="https://www.w3.org/TR/css-highlight-api-1/" rel="canonical">
    <meta content="0a0f76a6474c033587a4e23225986e334e38d02a" name="document-revision">
    <style>
        .sample-out {
            background: white;
            padding: 0.5ch;
            border: solid 1px;
            font-size: 2em;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSS 自定义高亮 API 模块第 1 级</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C 工作草案</a>, <time class="dt-updated"
                datetime="2021-12-15">2021 年 12 月 15 日</time></p>
        <details open>
            <summary>更多关于此文档的详情</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>当前版本:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2021/WD-css-highlight-api-1-20211215/">https://www.w3.org/TR/2021/WD-css-highlight-api-1-20211215/</a>
                    <dt>最新发布版本:
                    <dd><a
                            href="https://www.w3.org/TR/css-highlight-api-1/">https://www.w3.org/TR/css-highlight-api-1/</a>
                    <dt>编辑草案:
                    <dd><a
                            href="https://drafts.csswg.org/css-highlight-api-1/">https://drafts.csswg.org/css-highlight-api-1/</a>
                    <dt>以前的版本:
                    <dd><a href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/"
                            rel="prev">https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/</a>
                    <dd><a href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/"
                            rel="prev">https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/</a>
                    <dt>历史:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/css-highlight-api-1">https://www.w3.org/standards/history/css-highlight-api-1</a>
                    <dt>反馈:
                    <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-highlight-api-1">CSSWG 问题库</a>
                    <dd><a href="#issues-index">内嵌在规格中的问题</a>
                    <dt class="editor">编辑者:
                    <dd class="editor p-author h-card vcard" data-editor-id="43241"><a class="p-name fn u-url url"
                            href="https://florian.rivoal.net/">Florian Rivoal</a> (<span class="p-org org">代表
                            Bloomberg</span>)
                    <dd class="editor p-author h-card vcard" data-editor-id="115721"><a class="p-name fn u-url url"
                            href="https://github.com/sanketj">Sanket Joshi</a> (<a class="p-org org"
                            href="https://www.microsoft.com">微软公司</a>)
                    <dd class="editor p-author h-card vcard" data-editor-id="110930"><span class="p-name fn">Megan
                            Gardner</span> (<a class="p-org org" href="https://apple.com/">苹果公司</a>)
                    <dt>为此规范建议编辑:
                    <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-highlight-api-1/Overview.bs">GitHub
                            编辑器</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive
                document license</a> rules apply. </p>
        <hr title="页头分隔线">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>此 CSS 模块描述了一种机制，用于对通过脚本标识的文档中的任意范围进行样式设置。</p>
        <a href="https://www.w3.org/TR/CSS/">CSS</a> 是一种用于描述结构化文档（如 HTML 和 XML）的渲染语言，适用于屏幕、纸张等介质。
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">本文档的状态</span></h2>
    <div data-fill-with="status">
        <p><em>此部分描述了本文档在发布时的状态。
                当前 W3C 出版物列表和该技术报告的最新修订版可以在 <a href="https://www.w3.org/TR/">W3C 技术报告索引</a>中找到。</em> </p>
        <p> 本文档由 <a href="https://www.w3.org/groups/wg/css">CSS 工作组</a> 以 <strong>工作草案</strong> 的形式发布，
            使用 <a href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">推荐轨道</a>。
            作为工作草案发布并不意味着 <abbr title="World Wide Web Consortium">W3C</abbr> 及其成员的认可。 </p>
        <p> 这是一个草稿文档，可能随时更新、替换或被其他文档取代。作为工作进展，不应将此文档作为参考文献。 </p>
        <p>请通过 <a href="https://github.com/w3c/csswg-drafts/issues">在 GitHub 上提交问题</a>（首选）来发送反馈，
            标题中包括规范代码 “css-highlight-api”，例如：
            “[css-highlight-api] <i>…评论摘要…</i>”。
            所有问题和评论都已 <a href="https://lists.w3.org/Archives/Public/public-css-archive/">归档</a>。
            或者，反馈可以发送到 (<a href="https://lists.w3.org/Archives/Public/www-style/">已归档</a>) 公共邮件列表 <a
                href="mailto:www-style@w3.org?Subject=%5Bcss-highlight-api%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>。
        </p>
        <p>本文档受 <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2021 年 11 月 2 日的 W3C
                过程文档</a> 约束。</p>
        <p>本文档由根据 <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C 专利政策</a> 运作的小组编写。
            W3C 维护了一个 <a href="https://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">与该小组交付物相关的公开专利披露列表</a>；
            该页面还包括披露专利的说明。
            个人如果实际知晓专利且认为该专利包含 <a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">必要声明</a>，必须根据 <a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">W3C 专利政策第 6 节</a> 进行披露。
        </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#intro"><span class="secno">1</span> <span class="content">简介</span></a>
            <li><a href="#interaction"><span class="secno">2</span> <span class="content">模块交互</span></a>
            <li>
                <a href="#highlights-set-up"><span class="secno">3</span> <span class="content">设置自定义高亮</span></a>
                <ol class="toc">
                    <li><a href="#creation"><span class="secno">3.1</span> <span class="content">创建自定义高亮</span></a>
                    <li><a href="#registration"><span class="secno">3.2</span> <span class="content">注册自定义高亮</span></a>
                </ol>
            <li>
                <a href="#styling-highlights"><span class="secno">4</span> <span class="content">自定义高亮的样式设置</span></a>
                <ol class="toc">
                    <li><a href="#custom-highlight-pseudo"><span class="secno">4.1</span> <span
                                class="content">自定义高亮伪元素: <span class="css">::highlight()</span></span></a>
                    <li>
                        <a href="#processing-model"><span class="secno">4.2</span> <span class="content">处理模型</span></a>
                        <ol class="toc">
                            <li><a href="#applicable-properties"><span class="secno">4.2.1</span> <span
                                        class="content">适用属性</span></a>
                            <li><a href="#default-styles"><span class="secno">4.2.2</span> <span
                                        class="content">默认样式</span></a>
                            <li><a href="#c-and-h"><span class="secno">4.2.3</span> <span
                                        class="content">级联与继承</span></a>
                            <li><a href="#painting"><span class="secno">4.2.4</span> <span class="content">绘制</span></a>
                            <li><a href="#priorities"><span class="secno">4.2.5</span> <span
                                        class="content">重叠高亮的优先级</span></a>
                            <li><a href="#highlight-types"><span class="secno">4.2.6</span> <span
                                        class="content">高亮类型</span></a>
                        </ol>
                </ol>
            <li>
                <a href="#responding-to-changes"><span class="secno">5</span> <span class="content">响应更改</span></a>
                <ol class="toc">
                    <li><a href="#repaint"><span class="secno">5.1</span> <span class="content">重绘</span></a>
                    <li><a href="#range-invalidation"><span class="secno">5.2</span> <span
                                class="content">范围更新和失效</span></a>
                </ol>
            <li><a href="#events"><span class="secno">6</span> <span class="content">事件处理</span></a>
            <li><a href="#priv-sec"><span class="secno"></span> <span class="content">附录A.隐私和安全考虑</span></a>
            <li><a href="#credits"><span class="secno"></span> <span class="content">附录B.致谢</span></a>
            <li>
                <a href="#changes"><span class="secno"></span> <span class="content">附录C.变更记录</span></a>
                <ol class="toc">
                    <li><a href="#changes-since-20201208"><span class="secno"></span> <span
                                class="content">自2020年12月8日工作草案以来的更改</span></a>
                    <li><a href="#changes-since-20201022"><span class="secno"></span> <span
                                class="content">自2020年10月22日工作草案以来的更改</span></a>
                </ol>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">合规性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span
                                class="content">合规性类别</span></a>
                    <li>
                        <a href="#w3c-partial"><span class="secno"></span> <span class="content">部分实现</span></a>
                        <ol class="toc">
                            <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span
                                        class="content">不稳定和专有功能的实现</span></a>
                        </ol>
                    <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">非实验性实现</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">由本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">通过引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <div class="non-normative">
            <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">
                    简介</span><a class="self-link" href="#intro"></a></h2>
            <p><em>本节为非规范性内容</em>。</p>
            <p>自定义高亮 API 扩展了 <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element">高亮伪元素</a> 的概念（参见 <a
                    href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudos"><cite>CSS 伪元素 4</cite> § 3 高亮伪元素</a>），
                通过为 web 开发者提供一种方式来设置任意 Range 对象的文本样式，
                而不仅限于用户代理定义的 <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-selection"
                    id="ref-for-selectordef-selection">::selection</a>、<span class="css">::inactive-selection</span>、
                <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error"
                    id="ref-for-selectordef-spelling-error">::spelling-error</a>，
                和 <span class="css">::grammar-error</span>。
                这在多种场景中非常有用，
                包括希望实现自定义选择的编辑框架、
                在虚拟化文档中实现页面查找、
                表示在线协作的多重选择，
                或拼写检查框架。
            </p>
            <p>自定义高亮 API 提供了一种编程方式，用于添加和移除不影响底层 DOM 结构的高亮，
                而是基于 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range">range</a> 对象来应用样式，
                通过 <a class="css" data-link-type="maybe" href="#selectordef-highlight-custom-highlight-name"
                    id="ref-for-selectordef-highlight-custom-highlight-name">::highlight()</a> 伪元素进行访问。</p>
            <div class="example" id="intro-ex">
                <a class="self-link" href="#intro-ex"></a> 以下代码使用 <a class="css" data-link-type="maybe"
                    href="#selectordef-highlight-custom-highlight-name"
                    id="ref-for-selectordef-highlight-custom-highlight-name①">::highlight()</a> 伪元素
                为文本 <q>One two</q> 应用了黄色背景和蓝色前景色。
                它通过将一个 <code
                    class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight">Highlight</a></code>
                添加到
                <code
                    class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry">HighlightRegistry</a></code>
                中来实现（这两个都是此规范引入的新概念）。
                该 <code
                    class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight①">Highlight</a></code>
                将包含一个 <code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range">Range</a></code>
                ，其边界点围绕着文本 <q>One two</q>。
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>example-highlight</c-><c- o>)</c-> <c- p>{</c->
    <c- k>background-color</c-><c- p>:</c-> <c- kc>yellow</c-><c- p>;</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>blue</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->One <c- p>&lt;/</c-><c- f>span</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->two <c- p>&lt;/</c-><c- f>span</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->three…<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> r <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r<c- p>.</c->setStart<c- p>(</c->document<c- p>.</c->body<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r<c- p>.</c->setEnd<c- p>(</c->document<c- p>.</c->body<c- p>,</c-> <c- mf>2</c-><c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"example-highlight"</c-><c- p>,</c-> <c- k>new</c-> Highlight<c- p>(</c->r<c- p>));</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>结果如下所示:</p>
                <div class="sample-out"> <span style="background-color:yellow;color:blue;">One Two </span>three… </div>
            </div>
        </div>
        <h2 class="heading settled" data-level="2" id="interaction"><span class="secno">2. </span><span class="content">
                模块交互</span><a class="self-link" href="#interaction"></a></h2>
        <p>本模块依赖于 Infra 标准 <a data-link-type="biblio" href="#biblio-infra">[INFRA]</a> 和 WebIDL <a
                data-link-type="biblio" href="#biblio-webidl">[WebIDL]</a>。</p>
        <p>假设您熟悉 CSS 和 DOM 标准 <a data-link-type="biblio" href="#biblio-dom">[DOM]</a>，
            并特别扩展了 CSS 伪元素模块第 4 级 <a data-link-type="biblio" href="#biblio-css-pseudo-4">[css-pseudo-4]</a> 中定义的机制来处理 <a
                data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                id="ref-for-highlight-pseudo-element①">高亮伪元素</a>。
            选择器第 4 级 <a data-link-type="biblio" href="#biblio-selectors-4">[selectors-4]</a> 规范定义了伪元素的一般工作原理。</p>
        <p>参见 <a href="#references">参考文献</a> 以获取依赖项的完整列表。</p>
        <p class="note" role="note"><span>注意：</span> 此草案为早期版本。
            随着其逐渐成熟，CSS-WG 可能会决定保留它作为独立模块，
            或者可能会将其合并到 <a data-link-type="biblio" href="#biblio-css-pseudo-4">[css-pseudo-4]</a> 或该模块的后续版本中。</p>
        <h2 class="heading settled" data-level="3" id="highlights-set-up"><span class="secno">3. </span><span
                class="content"> 设置自定义高亮</span><a class="self-link" href="#highlights-set-up"></a>
        </h2>
        <h3 class="heading settled" data-level="3.1" id="creation"><span class="secno">3.1. </span><span
                class="content"> 创建自定义高亮</span><a class="self-link" href="#creation"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="custom-highlight">自定义高亮</dfn>是表示文档部分的<a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range①">范围</a>集合。
            它们不一定适合放入元素树中，
            可以随意跨越元素边界，而不遵循其嵌套结构。
            它们可用于影响文档这些部分的外观
            （参见 <a href="#styling-highlights">§ 4 自定义高亮的样式设置</a>），
            或处理与它们相关的事件
            （参见 <a href="#events">§ 6 事件处理</a>）。</p>
        <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight">自定义高亮</a>由 <dfn
                class="dfn-paneled idl-code" data-dfn-type="interface" data-export
                id="highlight"><code>Highlight</code></dfn> 对象表示，<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#dfn-setlike" id="ref-for-dfn-setlike">类似集合</a>对象，其 <a
                data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-set-entries"
                id="ref-for-dfn-set-entries">集合条目</a> 是 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange">AbstractRange</a></code>
            对象。<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②">范围</a>可以通过将它们传递给构造函数添加到 <span id="ref-for-custom-highlight①">自定义高亮</span>中，
            或使用类似集合对象的常规 API
            来操作其 <span id="ref-for-dfn-set-entries①">集合条目</span>。</p>
        <p class="note" role="note"><span>注意：</span>由于 <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range③">自定义高亮</a>中的范围
            是 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange①">AbstractRange</a></code>
            对象，
            作者可以在使用 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range①">Range</a></code>
            对象和 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange">StaticRange</a></code>
            对象之间进行选择。
            有关此选择及其影响的更多详细信息，请参见 <a href="#range-invalidation">§ 5.2 范围更新与无效化</a>。
        </p>
        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-highlighttype"><code><c- g>HighlightType</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-highlight"><code><c- s>"highlight"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-spelling-error"><code><c- s>"spelling-error"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-grammar-error"><code><c- s>"grammar-error"</c-></code></dfn>
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#highlight" id="ref-for-highlight②"><c- g>Highlight</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-highlight-highlight" id="ref-for-dom-highlight-highlight"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange②"><c- n>AbstractRange</c-></a>... <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight/Highlight(...initialRanges), Highlight/constructor(...initialRanges), Highlight/Highlight(), Highlight/constructor()" data-dfn-type="argument" data-export id="dom-highlight-highlight-initialranges-initialranges"><code><c- g>initialRanges</c-></code></dfn>);
  <c- b>setlike</c->&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange③"><c- n>AbstractRange</c-></a>>;
  <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="attribute" data-export data-type="long" id="dom-highlight-priority"><code><c- g>priority</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-highlighttype" id="ref-for-enumdef-highlighttype"><c- n>HighlightType</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="attribute" data-export data-type="HighlightType" id="dom-highlight-type"><code><c- g>type</c-></code></dfn>;
};
</pre>
        <p>有关 <code
                class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority">priority</a></code>
            属性的更多信息，请参见 <a href="#priorities">§ 4.2.5 重叠高亮的优先级</a>。</p>
        <p>有关 <code
                class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type">type</a></code>
            属性的更多信息，请参见 <a href="#highlight-types">§ 4.2.6 高亮类型</a>。</p>
        <div class="algorithm" data-algorithm="创建自定义高亮">
            当调用 <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="constructor" data-export
                data-lt="Highlight(...initialRanges)|constructor(...initialRanges)|Highlight()|constructor()"
                id="dom-highlight-highlight"><code>Highlight(AbstractRange... initialRanges)</code></dfn> 构造函数时，
            运行以下步骤：
            <ol>
                <li> 让 <var>highlight</var> 成为新的 <code
                        class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight③">Highlight</a></code>
                    对象。
                <li> 将 <var>highlight</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority①">priority</a></code>
                    设置为 <code>0</code>。
                <li> 将 <var>highlight</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type①">type</a></code>
                    设置为 <code
                        class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight">highlight</a></code>。
                <li> 对于每个 <var>range</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-highlight-initialranges-initialranges" id="ref-for-dom-highlight-highlight-initialranges-initialranges">initialRanges</a></code>，
                    让 <var>rangeArg</var> 是 <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value"
                        id="ref-for-dfn-convert-idl-to-ecmascript-value">将</a> <var>range</var> 转换为
                    ECMAScript 值的结果，
                    然后运行 <a href="https://webidl.spec.whatwg.org/#es-add-delete">内置类似集合的添加功能步骤</a>，
                    以 <var>highlight</var> 作为 <code>this</code> 值，
                    并以 <var>rangeArg</var> 作为参数。
                <li> 返回 <var>highlight</var>。
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.2" id="registration"><span class="secno">3.2. </span><span
                class="content"> 注册自定义高亮</span><a class="self-link" href="#registration"></a></h3>
        <p>为了产生效果，<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight③">自定义高亮</a>需要被<a
                data-link-type="dfn" href="#registered" id="ref-for-registered">注册</a>到<a data-link-type="dfn"
                href="#highlight-registry" id="ref-for-highlight-registry">高亮注册表</a>中。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="highlight-registry">高亮注册表</dfn>可通过 <code
                class="idl"><a data-link-type="idl" href="#dom-css-highlights" id="ref-for-dom-css-highlights">highlights</a></code>
            属性在 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css">CSS</a></code>
            命名空间中访问，
            它表示所有为<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight④">自定义高亮</a>注册的对象，适用于<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"
                id="ref-for-current-global-object">当前全局对象</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window"
                id="ref-for-concept-document-window">相关文档</a>。
            它是<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-maplike"
                id="ref-for-dfn-maplike">类似映射</a>的结构，并可使用常规方法进行更新。
            它的<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-map-entries"
                id="ref-for-dfn-map-entries">映射条目</a>最初是空的。</p>
        <p>如果<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight⑤">自定义高亮</a>
            位于<a data-link-type="dfn" href="#highlight-registry" id="ref-for-highlight-registry①">高亮注册表</a>中，
            则称其为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="registered">已注册</dfn>。
            如果之后被移除，它将停止成为<a data-link-type="dfn" href="#registered" id="ref-for-registered②">已注册</a>状态。</p>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://www.w3.org/TR/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css①"><c- g>CSS</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#highlightregistry" id="ref-for-highlightregistry①"><c- n>HighlightRegistry</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="HighlightRegistry" id="dom-css-highlights"><code><c- g>highlights</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="highlightregistry"><code><c- g>HighlightRegistry</c-></code></dfn> {
  <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#highlight" id="ref-for-highlight④"><c- n>Highlight</c-></a>>;
};
</pre>
        <div class="algorithm" data-algorithm="注册自定义高亮">
            要<a data-link-type="dfn" href="#registered" id="ref-for-registered③">注册</a><a data-link-type="dfn"
                href="#custom-highlight" id="ref-for-custom-highlight⑥">自定义高亮</a>，
            调用<a data-link-type="dfn" href="#highlight-registry" id="ref-for-highlight-registry②">高亮注册表</a>的
            <code>set</code> 方法，这将运行<a href="https://webidl.spec.whatwg.org/#es-map-set">内置类似映射设置函数的步骤</a>，
            将上下文对象作为 <code>this</code> 值，
            传入的<a data-link-type="dfn" href="#custom-highlight-name" id="ref-for-custom-highlight-name">自定义高亮名称</a>作为
            <var>keyArg</var>，
            传入的高亮作为 <var>valueArg</var>。
            <p>当<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight⑦">自定义高亮</a>被<a
                    data-link-type="dfn" href="#registered" id="ref-for-registered④">注册</a>时分配的<dfn class="dfn-paneled"
                    data-dfn-type="dfn" data-noexport id="custom-highlight-name">自定义高亮名称</dfn>用于在样式设置时标识高亮（参见 <a
                    href="#styling-highlights">§ 4 自定义高亮的样式设置</a>）。</p>
            <p class="note" role="note"><span>注意：</span>在注册<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight⑧">自定义高亮</a>时，
                建议作者使用有效的 CSS <a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#identifier"
                    id="ref-for-identifier">标识符</a>作为<a data-link-type="dfn" href="#custom-highlight-name"
                    id="ref-for-custom-highlight-name①">自定义高亮名称</a>。
                使用无效标识符可能会使高亮难以甚至无法通过 CSS 设置样式。</p>
            <p class="note" role="note"><span>注意：</span>可以为<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight⑨">自定义高亮</a>注册多个<a data-link-type="dfn" href="#custom-highlight-name"
                    id="ref-for-custom-highlight-name②">自定义高亮名称</a>。
                但是，使用多个名称设置一个高亮会为该高亮分配多个不同的样式集，
                且无法控制这些样式集在<code>绘制</code>期间的冲突样式的堆叠顺序。
                这可能会限制作者，并导致混乱的绘制行为
                （参见下面的<a href="#styling-problems-with-multiple-names-per-highlight">示例</a>以获取更多上下文）。
                因此，<b>建议作者在样式设置时为每个高亮只使用一个名称</b>。</p>
            <div class="example" id="styling-problems-with-multiple-names-per-highlight">
                <a class="self-link" href="#styling-problems-with-multiple-names-per-highlight"></a>
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- f>div</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>bar</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>red</c-><c- p>;</c->
  <c- p>}</c->
  <c- f>div</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>foo</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>green</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>>&lt;</c-><c- f>div</c-><c- p>></c->abc<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> div <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->
  <c- a>let</c-> r <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r<c- p>.</c->setStart<c- p>(</c->div<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r<c- p>.</c->setEnd<c- p>(</c->div<c- p>,</c-> <c- mf>1</c-><c- p>);</c->
  <c- a>let</c-> h <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- t>'foo'</c-><c- p>,</c-> h<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- t>'bar'</c-><c- p>,</c-> h<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>在上面的示例中，
                    同一个<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⓪">自定义高亮</a>对象被以
                    <code>foo</code> 和 <code>bar</code> 两个名称<a data-link-type="dfn" href="#registered"
                        id="ref-for-registered⑥">注册</a>。
                    由于每个<a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                        id="ref-for-style-rule">样式规则</a>都针对相同的高亮且具有相同的<a data-link-type="dfn"
                        href="https://www.w3.org/TR/selectors-4/#specificity" id="ref-for-specificity">优先级</a>，
                    作者可能期望最后一个规则在级联顺序中获胜，
                    并且高亮内容显示为绿色。
                    然而，每个高亮名称都将获得独立的一组高亮样式，
                    并且高亮会根据名称绘制多次。
                    在这种情况下，因为 <code>foo</code> 在 <code>bar</code> 之前注册，
                    高亮将首先用 <code>foo</code> 的颜色（绿色）绘制，
                    然后用 <code>bar</code> 的颜色（红色）绘制。
                    因此，高亮的内容将显示为红色。
                </p>
            </div>
            <h2 class="heading settled" data-level="4" id="styling-highlights"><span class="secno">4. </span><span
                    class="content"> 自定义高亮的样式设置</span><a class="self-link" href="#styling-highlights"></a></h2>
            <h3 class="heading settled" data-level="4.1" id="custom-highlight-pseudo"><span class="secno">4.1.
                </span><span class="content"> 自定义高亮伪元素: <a class="css" data-link-type="maybe"
                        href="#selectordef-highlight-custom-highlight-name"
                        id="ref-for-selectordef-highlight-custom-highlight-name②">::highlight()</a></span><a
                    class="self-link" href="#custom-highlight-pseudo"></a></h3>
            <p><dfn class="dfn-paneled css" data-dfn-type="selector" data-export
                    id="selectordef-highlight-custom-highlight-name">::highlight(<a class="production css"
                        data-link-type="type" href="#typedef-custom-highlight-name"
                        id="ref-for-typedef-custom-highlight-name">&lt;custom-highlight-name></a>)</dfn> 伪元素
                （也称为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="custom-highlight-pseudo-element">自定义高亮伪元素</dfn>）
                表示文档中
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#contained" id="ref-for-contained">包含</a>或<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#partially-contained"
                    id="ref-for-partially-contained">部分包含</a>在
                所有<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range④">范围</a>中的已<a data-link-type="dfn" href="#registered"
                    id="ref-for-registered⑦">注册</a>的<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight①①">自定义高亮</a>部分，并且使用了<a data-link-type="dfn"
                    href="#custom-highlight-name" id="ref-for-custom-highlight-name③">自定义高亮名称</a><a
                    class="production css" data-link-type="type" href="#typedef-custom-highlight-name"
                    id="ref-for-typedef-custom-highlight-name①">&lt;custom-highlight-name></a>，如果存在的话。
                <dfn class="dfn-paneled css" data-dfn-type="type" data-export id="typedef-custom-highlight-name"><a
                        class="production css" data-link-type="type" href="#typedef-custom-highlight-name"
                        id="ref-for-typedef-custom-highlight-name②">&lt;custom-highlight-name></a></dfn>必须是有效的
                CSS <a class="production css" data-link-type="type"
                    href="https://www.w3.org/TR/css-syntax-3/#typedef-ident-token"
                    id="ref-for-typedef-ident-token">&lt;ident-token></a>。
            </p>
            <h3 class="heading settled" data-level="4.2" id="processing-model"><span class="secno">4.2. </span><span
                    class="content"> 处理模型</span><a class="self-link" href="#processing-model"></a></h3>
            <h4 class="heading settled" data-level="4.2.1" id="applicable-properties"><span class="secno">4.2.1.
                </span><span class="content"> 适用属性</span><a class="self-link" href="#applicable-properties"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element">自定义高亮伪元素</a>，
                类似于内置的<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element②">高亮伪元素</a>，
                只能使用有限的属性集进行样式设置。
                有关完整列表，请参见 <a href="https://www.w3.org/TR/css-pseudo-4/#highlight-styling"><cite>CSS 伪元素 4</cite>
                    § 3.2 高亮的样式设置</a>。</p>
            <h4 class="heading settled" data-level="4.2.2" id="default-styles"><span class="secno">4.2.2. </span><span
                    class="content"> 默认样式</span><a class="self-link" href="#default-styles"></a></h4>
            <p>UA 不能在默认 UA 样式表中为<a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element①">自定义高亮伪元素</a>定义任何样式。
                <span id="ref-for-custom-highlight-pseudo-element②">自定义高亮伪元素</span>继承其<a data-link-type="dfn"
                    href="https://www.w3.org/TR/selectors-4/#originating-element"
                    id="ref-for-originating-element">起源元素</a>的样式。
            </p>
            <h4 class="heading settled" data-level="4.2.3" id="c-and-h"><span class="secno">4.2.3. </span><span
                    class="content"> 级联与继承</span><a class="self-link" href="#c-and-h"></a></h4>
            <p><a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#cascade"
                    id="ref-for-cascade">级联</a>和<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-cascade-5/#inheritance" id="ref-for-inheritance">继承</a>的
                <a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element③">自定义高亮伪元素</a>与内置的<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element③">高亮伪元素</a>的处理方式相同，
                如 <a href="https://www.w3.org/TR/css-pseudo-4/#highlight-cascade"><cite>CSS 伪元素 4</cite> § 3.5
                    级联与每个元素的高亮样式</a> 中定义。
            </p>
            <h4 class="heading settled" data-level="4.2.4" id="painting"><span class="secno">4.2.4. </span><span
                    class="content"> 绘制</span><a class="self-link" href="#painting"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①②">自定义高亮</a>的绘制方式与内置的<a
                    data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element④">高亮伪元素</a>的绘制方式相同，
                如<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-bounds"><cite>CSS 伪元素 4</cite> § 3.4 高亮区域</a>和<a
                    href="https://www.w3.org/TR/css-pseudo-4/#highlight-painting"><cite>CSS 伪元素 4</cite>
                    § 3.6 高亮的绘制</a>中指定的，
                但有以下说明：</p>
            <ul>
                <li> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed"
                        id="ref-for-range-collapsed">折叠的</a><a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range⑤">范围</a>不会被渲染。
                <li>
                    同一<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range⑥">范围</a>中的重叠<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight①③">自定义高亮</a>
                    将作为一个表示这些重叠部分的并集的单一范围进行渲染。
                    <div class="example" id="overlap-ranges-ex">
                        <a class="self-link" href="#overlap-ranges-ex"></a> 以下示例中，半透明的蓝色背景只会渲染为一个单一高亮区域，
                        而不会出现两个重叠并彼此可见的高亮。
                        <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>sample</c-><c- o>)</c-> <c- p>{</c-> <c- k>background-color</c-><c- p>:</c-> rgba<c- p>(</c-><c- mi>0</c-><c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>255</c-><c- p>,</c-> <c- mf>0.3</c-><c- p>);</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>></c->Lorem Ipsum.
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> textNode <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->

  <c- a>let</c-> r1 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r1<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>1</c-><c- p>);</c->
  r1<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>5</c-><c- p>);</c->

  <c- a>let</c-> r2 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r2<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>3</c-><c- p>);</c->
  r2<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>7</c-><c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"sample"</c-><c- p>,</c-> <c- k>new</c-> Highlight<c- p>(</c->r1<c- p>,</c-> r2<c- p>));</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                        <p>换句话说，这种渲染是正确的：</p>
                        <div class="sample-out"> L<span style="background-color: rgba(0, 0, 255, 0.3)">orem
                                I</span>psum. </div>
                        <p>然而，这种渲染是不正确的：</p>
                        <div class="sample-out"> L<span style="background-color: rgba(0, 0, 255, 0.3)">or<span
                                    style="background-color: rgba(0, 0, 255, 0.3)">em</span> I</span>psum. </div>
                    </div>
                <li> <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                        id="ref-for-highlight-overlay">高亮覆盖</a>的<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight①④">自定义高亮</a>
                    在堆叠顺序中位于内置的<a data-link-type="dfn"
                        href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                        id="ref-for-highlight-pseudo-element⑤">高亮伪元素</a>之下，
                    如<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-painting"><cite>CSS
                            伪元素 4</cite> § 3.6 高亮的绘制</a>中描述的顺序。
                <li> 多个<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                        id="ref-for-highlight-overlay①">高亮覆盖</a>的<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight①⑤">自定义高亮</a>
                    的相对堆叠顺序由它们的<a data-link-type="dfn" href="#priority" id="ref-for-priority">优先级</a>定义（参见<a
                        href="#priorities">§ 4.2.5 重叠高亮的优先级</a>）。
            </ul>
            <h4 class="heading settled" data-level="4.2.5" id="priorities"><span class="secno">4.2.5. </span><span
                    class="content"> 重叠高亮的优先级</span><a class="self-link" href="#priorities"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑥">自定义高亮</a>的
                <code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority②">priority</a></code>
                属性
                定义其<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="priority">优先级</dfn>。
                该属性用于确定对应的<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                    id="ref-for-highlight-overlay②">高亮覆盖</a>在绘制操作期间的堆叠顺序（参见 <a href="#painting">§ 4.2.4 绘制</a>）。
                更高的<a data-link-type="dfn" href="#priority" id="ref-for-priority①">优先级</a>意味着在堆叠顺序中更高。
                如果未显式设置其<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority③">priority</a></code>
                属性，自定义高亮的默认数值优先级为 0。
            </p>
            <p>当两个或多个<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight①⑦">自定义高亮</a>具有相同的数值优先级时，
                最后<a data-link-type="dfn" href="#registered" id="ref-for-registered⑧">注册</a>的高亮具有更高的有效<a
                    data-link-type="dfn" href="#priority" id="ref-for-priority②">优先级</a>。
            </p>
            <div class="example" id="overlap-highlight-ex">
                <a class="self-link" href="#overlap-highlight-ex"></a>
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>foo</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-><c- kc>blue</c-><c- p>;</c->
    <c- k>background-color</c-><c- p>:</c-><c- kc>yellow</c-><c- p>;</c->
  <c- p>}</c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>bar</c-><c- o>)</c-> <c- p>{</c->
    <c- k>background-color</c-><c- p>:</c-><c- kc>orange</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>></c->Some text
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> textNode <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->

  <c- a>let</c-> r1 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r1<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r1<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>6</c-><c- p>);</c->

  <c- a>let</c-> r2 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r2<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>3</c-><c- p>);</c->
  r2<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>9</c-><c- p>);</c->

  <c- a>let</c-> h1 <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r1<c- p>);</c->
  <c- a>let</c-> h2 <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r2<c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"foo"</c-><c- p>,</c-> h1<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"bar"</c-><c- p>,</c-> h2<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>由于没有设置优先级
                    （即 <code>h1</code> 和 <code>h2</code> 之间没有优先级差异），
                    自定义高亮的样式将按照插入到<a data-link-type="dfn" href="#highlight-registry"
                        id="ref-for-highlight-registry③">高亮注册表</a>的顺序进行堆叠。
                    渲染结果将为 "Som" 显示为蓝色文本，黄色背景，
                    "e t" 显示为蓝色文本，橙色背景，
                    "ext" 显示为默认文本颜色，橙色背景。</p>
                <div class="sample-out"> <span style="background:yellow;color:blue;">Som</span><span
                        style="background:orange;color:blue;">e t</span><span style="background:orange;">ext</span>
                </div>
                <p>将 <code class="highlight">h1<c- p>.</c->priority <c- o>=</c-> <c- mf>1</c-><c- p>;</c-></code>
                    设置为1将使 <code>h1</code> 的堆叠顺序高于 <code>h2</code>，
                    结果为 "Some t" 显示为蓝色文本，黄色背景，
                    "ext" 显示为默认文本颜色，橙色背景。</p>
                <div class="sample-out"> <span style="background:yellow;color:blue;">Some t</span><span
                        style="background:orange;">ext</span> </div>
            </div>
            <h4 class="heading settled" data-level="4.2.6" id="highlight-types"><span class="secno">4.2.6. </span><span
                    class="content"> 高亮类型</span><a class="self-link" href="#highlight-types"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑧">自定义高亮</a>的
                <code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type②">type</a></code>
                属性用于作者指定高亮的语义意义。
                这使得辅助技术在向用户展示高亮时可以包含这些语义信息。
            </p>
            <p>如果没有显式设置其<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type③">type</a></code>
                属性，自定义高亮的默认类型将是<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight①">highlight</a></code>。
            </p>
            <p class="note" role="note"><span>注意：</span>建议作者在自定义高亮用于突出显示拼写错误时，将<a data-link-type="dfn"
                    href="#custom-highlight" id="ref-for-custom-highlight①⑨">自定义高亮</a>的<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type④">type</a></code>
                设置为<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-spelling-error" id="ref-for-dom-highlighttype-spelling-error">spelling-error</a></code>。
                当自定义高亮用于强调语法错误时，建议将其类型设置为<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-grammar-error" id="ref-for-dom-highlighttype-grammar-error">grammar-error</a></code>。
                对于其他使用场景，建议将<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type⑥">type</a></code>
                保持为<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight②">highlight</a></code>。
            </p>
            <p>用户代理应将<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight②③">自定义高亮</a>提供给辅助技术使用。
                当通过特定平台的辅助技术 API 暴露高亮时，
                用户代理应尽可能具体地传达由其<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type⑦">type</a></code>
                属性指定的高亮语义。
            </p>
            <p class="note" role="note"><span>注意：</span>例如，
                如果平台的辅助技术 API 能够具体表示拼写错误和语法错误，
                则期望用户代理使用这些功能来传达带有<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-spelling-error" id="ref-for-dom-highlighttype-spelling-error①">spelling-error</a></code>
                和<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-spelling-error" id="ref-for-dom-highlighttype-spelling-error②">spelling-error</a></code>的高亮的语义。
                如果辅助技术 API 只能表达拼写错误，
                则用户代理应使用拼写错误语义来传达拼写错误和语法错误类型的高亮。
                如果辅助技术 API 无法支持表达拼写或语法错误，
                则用户代理会将所有高亮暴露为通用的<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight③">highlight</a></code>，
                而不考虑它们的实际<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type⑧">type</a></code>。
            </p>
            <p class="note" role="note"><span>注意：</span>选择此初始类型集
                是因为它们被认为是 Highlight API 的流行使用案例，
                并且今天的平台辅助技术 API 已经有一些支持来表达它们的语义。
                辅助技术 API 当前无法表达其他预期的 Highlight API 使用案例的特定语义。
                随着辅助技术 API 逐渐支持表达 Highlight API 的更多流行使用案例，
                将来可能会向<code
                    class="idl"><a data-link-type="idl" href="#enumdef-highlighttype" id="ref-for-enumdef-highlighttype①">HighlightType</a></code>中添加更多类型。
            </p>
            <h2 class="heading settled" data-level="5" id="responding-to-changes"><span class="secno">5. </span><span
                    class="content"> 响应更改</span><a class="self-link" href="#responding-to-changes"></a>
            </h2>
            <h3 class="heading settled" data-level="5.1" id="repaint"><span class="secno">5.1. </span><span
                    class="content"> 重绘</span><a class="self-link" href="#repaint"></a></h3>
            <p>在<a data-link-type="dfn" href="#highlight-registry" id="ref-for-highlight-registry④">高亮注册表</a>中
                添加或移除<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②④">自定义高亮</a>，
                或者在已<a data-link-type="dfn" href="#registered" id="ref-for-registered⑨">注册</a>的<span
                    id="ref-for-custom-highlight②⑤">自定义高亮</span>中
                添加或移除<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range⑦">范围</a>，
                必须导致用户代理重新评估渲染结果，并在适当时进行重绘。
            </p>
            <p>用户代理还必须根据作者对<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority④">priority</a></code>属性
                的更改或对已<a data-link-type="dfn" href="#registered" id="ref-for-registered①⓪">注册</a>的<a
                    data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②⑥">自定义高亮</a>中
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp">范围边界点</a>的更改，
                在需要时重绘高亮。
            </p>
            <p class="issue" id="issue-a4ade514"><a class="self-link" href="#issue-a4ade514"></a>
                我们应如何指定此重新评估的时间（及同步性）？<a href="https://github.com/w3c/csswg-drafts/issues/4596">[Issue #4596]</a></p>
            <h3 class="heading settled" data-level="5.2" id="range-invalidation"><span class="secno">5.2. </span><span
                    class="content"> 范围更新和失效</span><a class="self-link" href="#range-invalidation"></a></h3>
            <p>作者可以使用<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range③">Range</a></code>
                或<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange①">StaticRange</a></code>
                来构建<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②⑦">自定义高亮</a>。
            </p>
            <p>生成的<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②⑧">自定义高亮</a>表示文档的相同部分，
                并且可以采用相同的样式设置。
                但是，如果修改了底层文档，行为会有所不同。
            </p>
            <p><code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range④">Range</a></code>
                是<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range"
                    id="ref-for-concept-live-range">活动范围</a>。
                用户代理会根据与该范围或其边界重叠的 DOM 更改调整<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑤">Range</a></code>的
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp①">边界点</a>，
                并相应地<a href="#repaint">重绘</a>。<span id="ref-for-concept-range-bp②">边界点</span>也可以由作者修改。
            </p>
            <p>另一方面，
                用户代理不能根据 DOM 更改调整<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange②">StaticRange</a></code>
                的<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp③">边界点</a>，
                也不能在创建后由作者修改。
                用户代理应存储实际的<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange③">StaticRange</a></code>，
                而不是用活动的<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑥">Range</a></code>
                来支持它们。
            </p>
            <div class="advisement">
                更新所有<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑦">Range</a></code>
                对象以响应 DOM 修改会带来显著的性能成本。
                如果作者打算监控 DOM 更改并根据更改调整或重新创建其<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight②⑨">自定义高亮</a>中的范围，
                强烈建议使用<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange④">StaticRange</a></code>，
                以避免这一步骤的高成本但不必要的操作。
                <p>相反，使用<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange⑤">StaticRange</a></code>
                    的作者应监控并响应 DOM 更改，
                    通过丢弃无效的<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range⑧">范围</a>
                    或<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight③⓪">自定义高亮</a>并重新创建新的范围。
                </p>
            </div>
            <p>在计算文档的渲染方式时，
                如果任何<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start-node"
                    id="ref-for-concept-range-start-node">起始节点</a>
                或<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end-node"
                    id="ref-for-concept-range-end-node">结束节点</a>
                引用的<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range⑨">范围</a>
                其阴影包含根不属于该文档，
                用户代理必须忽略该范围。
                如果任何<a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange"
                    id="ref-for-staticrange⑥">StaticRange</a>
                在关联文档的高亮注册表中无效，
                用户代理也必须忽略该范围。
            </p>
            <p class="issue" id="issue-d5e91a86"><a class="self-link" href="#issue-d5e91a86"></a> 自定义高亮中的<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange⑦">StaticRange</a></code>与
                <a data-link-type="biblio" href="#biblio-css-contain-2">[css-contain-2]</a>的交互似乎存在问题：
                在一个完全包含的元素上，
                我们应期望该元素后代的 DOM 更改不会导致包含元素之外的元素失效、重新设置样式或重绘。
                但是，如果静态范围的一个边界点位于包含的子树内，
                而另一个边界点在子树之外，
                且该子树中的 DOM 发生更改，
                使得子树内的边界点不再指向有效节点，
                那么整个范围应被忽略，
                这将影响包含子树之外的渲染。
                这是<a data-link-type="dfn" href="https://drafts.csswg.org/css-contain-2/#style-containment"
                    id="ref-for-style-containment">样式封装</a>的弱点，
                还是上述失效逻辑的弱点，
                亦或其他问题？<a href="https://github.com/w3c/csswg-drafts/issues/4598">[Issue #4598]</a>
            </p>
            <h2 class="heading settled" data-level="6" id="events"><span class="secno">6. </span><span class="content">
                    事件处理</span><a class="self-link" href="#events"></a></h2>
            <p class="issue" id="issue-3d1f5f66"><a class="self-link" href="#issue-3d1f5f66"></a> 事件部分待定，
                基于 https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/master/highlight/events-explainer.md</p>
            <p class="issue" id="issue-230bd93b"><a class="self-link" href="#issue-230bd93b"></a> 自定义高亮是否应有专门的事件处理机制，
                还是应该将其添加到伪元素的通用处理机制中？</p>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="priv-sec"><span class="content"> 附录 A. 隐私和安全考虑</span><a
                        class="self-link" href="#priv-sec"></a></h2>
                <p><em>本节为非规范性内容</em>。</p>
                <p>本规范认为不会引入任何新的安全或隐私问题。
                    如果有人认为此结论不准确，欢迎联系 CSS 工作组或联合编辑人员。</p>
            </div>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="credits"><span class="content"> 附录 B. 致谢</span><a
                        class="self-link" href="#credits"></a></h2>
                <p><em>本节为非规范性内容</em>。</p>
                <p class="issue" id="issue-f0ab6bff"><a class="self-link" href="#issue-f0ab6bff"></a> 致谢需要感谢的人员（编辑之外）。
                </p>
            </div>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="changes"><span class="content"> 附录 C. 变更记录</span><a
                        class="self-link" href="#changes"></a></h2>
                <p><em>本节为非规范性内容</em>。</p>
                <h3 class="no-num&quot; heading settled" id="changes-since-20201208"><span class="content"> 自<a
                            href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/">2020年12月8日工作草案</a>以来的变更</span><a
                        class="self-link" href="#changes-since-20201208"></a></h3>
                <p>除了各种编辑改进和小的调整，主要更改包括：</p>
                <ul>
                    <li data-md>
                        <p>将 <code>HighlightsRegister</code> 重命名为 <code
                                class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry②">HighlightRegistry</a></code>
                        </p>
                    <li data-md>
                        <p>从 <code
                                class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry③">HighlightRegistry</a></code>
                            中移除了冗余的 <code>add()</code> 方法。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/6092">Issue 6092</a>)</p>
                    <li data-md>
                        <p>使自定义高亮覆盖层堆叠在原生高亮覆盖层下方。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/4595">Issue 4595</a>)</p>
                    <li data-md>
                        <p>使用整数处理高亮优先级，而不是浮点数。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/4592">Issue 4592</a>)</p>
                    <li data-md>
                        <p>定义高亮优先级的默认值为0。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/6136">Issue 6136</a>)</p>
                    <li data-md>
                        <p>将 HighlightRegistry 改为 maplike（而非 setlike），并移除 Highlight 的 <code>name</code> 属性。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/5910">Issue 5910</a>)</p>
                    <li data-md>
                        <p>澄清了来自错误窗口的范围不会被绘制。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/6417">Issue 6417</a>)</p>
                    <li data-md>
                        <p>指定自定义高亮没有用户代理样式。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/6375">Issue 6375</a>)</p>
                    <li data-md>
                        <p>推迟到<a data-link-type="biblio" href="#biblio-dom">[DOM]</a>规范处理范围失效
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/4597">Issue 4597</a>)</p>
                    <li data-md>
                        <p>为 <code
                                class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type⑨">type</a></code>
                            属性增加了支持不同高亮的清晰语义，以便向辅助工具暴露高亮。
                            (见 <a href="https://github.com/w3c/csswg-drafts/pull/6498">Issue 6498</a>)</p>
                </ul>
                <h3 class="no-num&quot; heading settled" id="changes-since-20201022"><span class="content"> 自<a
                            href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/">2020年10月22日工作草案</a>以来的变更</span><a
                        class="self-link" href="#changes-since-20201022"></a></h3>
                <p>自<a href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/">2020年10月22日工作草案</a>以来仅进行了编辑修改；
                    见<a
                        href="https://services.w3.org/htmldiff?doc1=https%3A%2F%2Fwww.w3.org%2FTR%2F2020%2FWD-css-highlight-api-1-20201022%2F&amp;doc2=https%3A%2F%2Fwww.w3.org%2FTR%2Fcss-highlight-api-1%2F">差异</a>。
                </p>
            </div>
        </div>
    </main>
    <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> 合规性</span><a class="self-link"
            href="#w3c-conformance"></a></h2>
    <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> 文档约定</span><a class="self-link"
            href="#w3c-conventions"></a></h3>
    <p>合规性要求通过描述性断言和 RFC 2119 术语的结合来表达。关键字“MUST”（必须）、“MUST NOT”（不得）、“REQUIRED”（必需）、
        “SHALL”（应）、“SHALL NOT”（不应）、“SHOULD”（应该）、“SHOULD NOT”（不应该）、“RECOMMENDED”（推荐）、“MAY”（可以）、
        和“OPTIONAL”（可选）在本文件的规范部分中，应按照 RFC 2119 中的描述进行解释。
        然而，为了提高可读性，这些词在本规范中并没有全部以大写字母出现。 </p>
    <p>本规范的所有文本都是规范性的，除非明确标记为非规范性的部分、示例和注释。<a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
    <p>本规范中的示例以“例如”开头，或使用 <code>class="example"</code> 与规范性文本分开显示，如下所示： </p>
    <div class="example" id="w3c-example">
        <a class="self-link" href="#w3c-example"></a>
        <p>这是一个信息性示例。</p>
    </div>
    <p>信息性注释以“Note”开头，并使用 <code>class="note"</code> 与规范性文本分开显示，如下所示： </p>
    <p class="note" role="note">注意，这是一个信息性注释。</p>
    <p>建议性部分是规范性部分，样式设计为引起特别注意，使用 <code>&lt;strong class="advisement"></code> 与其他规范性文本分开显示，如下所示：<strong
            class="advisement"> 用户代理必须提供可访问的替代方案。</strong> </p>
    <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> 合规性类别</span><a
            class="self-link" href="#w3c-conformance-classes"></a></h3>
    <p>本规范的合规性定义了三类合规性：</p>
    <dl>
        <dt>样式表
        <dd>一份<a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS 样式表</a>。
        <dt>渲染器
        <dd>一个解释样式表语义并渲染使用它们的文档的<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">用户代理（UA）</a>。
        <dt>作者工具
        <dd>一个编写样式表的<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">用户代理（UA）</a>。
    </dl>
    <p>如果样式表中使用本模块定义的语法的所有语句都根据通用 CSS 语法和本模块中定义的各个功能的语法是有效的，则该样式表符合本规范。</p>
    <p>如果渲染器除了按照适当规范解释样式表外，还正确解析并支持本规范中定义的所有功能并相应地渲染文档，则该渲染器符合本规范。然而，由于设备的限制导致用户代理无法正确渲染文档，并不会使用户代理不符合规定。（例如，用户代理不需要在单色显示器上渲染颜色。）
    </p>
    <p>如果作者工具编写的样式表根据通用 CSS 语法和本模块中定义的各个功能的语法是语法正确的，并且符合本模块所描述的样式表的所有其他合规性要求，则该作者工具符合本规范。</p>
    <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> 部分实现</span><a class="self-link"
            href="#w3c-partial"></a></h3>
    <p>为了让作者能够利用向前兼容的解析规则来分配回退值，CSS 渲染器<strong>必须</strong>将无法使用的级别支持的 at-rule、属性、属性值、关键字和其他语法结构视为无效（并根据需要<a
            href="https://www.w3.org/TR/CSS21/conform.html#ignore">忽略</a>）。特别是，用户代理<strong>不得</strong>在单个多值属性声明中选择性地忽略不支持的值并接受支持的值：如果任何值被视为无效（因为不支持的值必须被视为无效），CSS
        要求忽略整个声明。</p>
    <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> 不稳定和专有功能的实现</span><a
            class="self-link" href="#w3c-conform-future-proofing"></a></h4>
    <p>为了避免与未来稳定的 CSS 功能发生冲突，CSS 工作组建议<a href="https://www.w3.org/TR/CSS/#future-proofing">遵循最佳实践</a>，以实现<a
            href="https://www.w3.org/TR/CSS/#unstable">不稳定</a>的功能和<a
            href="https://www.w3.org/TR/CSS/#proprietary-extension">专有扩展</a>。</p>
    <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> 非实验性实现</span><a class="self-link"
            href="#w3c-testing"></a></h3>
    <p>当规范达到候选推荐阶段时，
        非实验性实现是可能的，且实现者应该发布任何已证明按规范正确实现的 CR 级别功能的无前缀实现。</p>
    <p>为了在不同实现中建立和维持 CSS 的互操作性，CSS 工作组要求非实验性 CSS 渲染器在发布任何 CSS 功能的无前缀实现之前，向 W3C 提交实现报告（以及在必要时提交用于该实现报告的测试用例）。
        提交给 W3C 的测试用例需经过 CSS 工作组的审核和修正。</p>
    <p>有关提交测试用例和实现报告的更多信息，请参阅 CSS 工作组的网站 <a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>。
        如有问题，请联系<a href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>邮件列表。
    </p>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">由本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#dom-highlight-highlight">constructor()</a><span>，见 § 3.1</span>
        <li><a href="#dom-highlight-highlight">constructor(...initialRanges)</a><span>，见 § 3.1</span>
        <li><a href="#custom-highlight">自定义高亮</a><span>，见 § 3.1</span>
        <li><a href="#typedef-custom-highlight-name">&lt;custom-highlight-name></a><span>，见 § 4.1</span>
        <li><a href="#custom-highlight-name">自定义高亮名称</a><span>，见 § 3.2</span>
        <li><a href="#custom-highlight-pseudo-element">自定义高亮伪元素</a><span>，见 § 4.1</span>
        <li><a href="#dom-highlighttype-grammar-error">"grammar-error"</a><span>，见 § 3.1</span>
        <li><a href="#dom-highlighttype-highlight">"highlight"</a><span>，见 § 3.1</span>
        <li><a href="#highlight">Highlight</a><span>，见 § 3.1</span>
        <li><a href="#dom-highlight-highlight">Highlight()</a><span>，见 § 3.1</span>
        <li><a href="#selectordef-highlight-custom-highlight-name">::highlight(&lt;custom-highlight-name>)</a><span>，见
                § 4.1</span>
        <li><a href="#dom-highlight-highlight">Highlight(...initialRanges)</a><span>，见 § 3.1</span>
        <li><a href="#highlight-registry">高亮注册表</a><span>，见 § 3.2</span>
        <li><a href="#highlightregistry">HighlightRegistry</a><span>，见 § 3.2</span>
        <li><a href="#dom-css-highlights">highlights</a><span>，见 § 3.2</span>
        <li><a href="#enumdef-highlighttype">HighlightType</a><span>，见 § 3.1</span>
        <li>
            优先级
            <ul>
                <li><a href="#dom-highlight-priority">Highlight 的属性</a><span>，见 § 3.1</span>
                <li><a href="#priority">定义</a><span>，见 § 4.2.5</span>
            </ul>
        <li><a href="#registered">注册</a><span>，见 § 3.2</span>
        <li><a href="#dom-highlighttype-spelling-error">"spelling-error"</a><span>，见 § 3.1</span>
        <li><a href="#dom-highlight-type">type</a><span>，见 § 3.1</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-cascade">
        <a href="https://www.w3.org/TR/css-cascade-5/#cascade">https://www.w3.org/TR/css-cascade-5/#cascade</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-cascade">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inheritance">
        <a
            href="https://www.w3.org/TR/css-cascade-5/#inheritance">https://www.w3.org/TR/css-cascade-5/#inheritance</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inheritance">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-style-containment">
        <a
            href="https://drafts.csswg.org/css-contain-2/#style-containment">https://drafts.csswg.org/css-contain-2/#style-containment</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-style-containment">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-selection">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-selection">https://www.w3.org/TR/css-pseudo-4/#selectordef-selection</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-selection">1.
                    Introduction</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-spelling-error">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error">https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-spelling-error">1.
                    Introduction</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-highlight-overlay">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay">https://www.w3.org/TR/css-pseudo-4/#highlight-overlay</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-highlight-overlay">4.2.4.
                    Painting</a> <a href="#ref-for-highlight-overlay①">(2)</a>
            <li><a href="#ref-for-highlight-overlay②">4.2.5.
                    Priority of Overlapping Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-highlight-pseudo-element">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element">https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-highlight-pseudo-element">1.
                    Introduction</a>
            <li><a href="#ref-for-highlight-pseudo-element①">2.
                    Module Interactions</a>
            <li><a href="#ref-for-highlight-pseudo-element②">4.2.1.
                    Applicable Properties</a>
            <li><a href="#ref-for-highlight-pseudo-element③">4.2.3.
                    Cascading and Inheritance</a>
            <li><a href="#ref-for-highlight-pseudo-element④">4.2.4.
                    Painting</a> <a href="#ref-for-highlight-pseudo-element⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-typedef-ident-token">
        <a
            href="https://www.w3.org/TR/css-syntax-3/#typedef-ident-token">https://www.w3.org/TR/css-syntax-3/#typedef-ident-token</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-typedef-ident-token">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-identifier">
        <a href="https://www.w3.org/TR/css-syntax-3/#identifier">https://www.w3.org/TR/css-syntax-3/#identifier</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-identifier">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-style-rule">
        <a href="https://www.w3.org/TR/css-syntax-3/#style-rule">https://www.w3.org/TR/css-syntax-3/#style-rule</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-style-rule">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-namespacedef-css">
        <a href="https://www.w3.org/TR/cssom-1/#namespacedef-css">https://www.w3.org/TR/cssom-1/#namespacedef-css</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-namespacedef-css">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-namespacedef-css①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abstractrange">
        <a href="https://dom.spec.whatwg.org/#abstractrange">https://dom.spec.whatwg.org/#abstractrange</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abstractrange">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-abstractrange①">(2)</a> <a
                    href="#ref-for-abstractrange②">(3)</a> <a href="#ref-for-abstractrange③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-node">
        <a href="https://dom.spec.whatwg.org/#node">https://dom.spec.whatwg.org/#node</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-range">
        <a href="https://dom.spec.whatwg.org/#range">https://dom.spec.whatwg.org/#range</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-range">1.
                    Introduction</a>
            <li><a href="#ref-for-range①">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-range②">5.1.
                    Repaints</a>
            <li><a href="#ref-for-range③">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-range④">(2)</a> <a
                    href="#ref-for-range⑤">(3)</a> <a href="#ref-for-range⑥">(4)</a> <a href="#ref-for-range⑦">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-staticrange">
        <a href="https://dom.spec.whatwg.org/#staticrange">https://dom.spec.whatwg.org/#staticrange</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-staticrange">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-staticrange①">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-staticrange②">(2)</a> <a
                    href="#ref-for-staticrange③">(3)</a> <a href="#ref-for-staticrange④">(4)</a> <a
                    href="#ref-for-staticrange⑤">(5)</a> <a href="#ref-for-staticrange⑥">(6)</a> <a
                    href="#ref-for-staticrange⑦">(7)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-bp">
        <a href="https://dom.spec.whatwg.org/#concept-range-bp">https://dom.spec.whatwg.org/#concept-range-bp</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-bp">5.1.
                    Repaints</a>
            <li><a href="#ref-for-concept-range-bp①">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-range-bp②">(2)</a> <a
                    href="#ref-for-concept-range-bp③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-range-collapsed">
        <a href="https://dom.spec.whatwg.org/#range-collapsed">https://dom.spec.whatwg.org/#range-collapsed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-range-collapsed">4.2.4.
                    Painting</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-contained">
        <a href="https://dom.spec.whatwg.org/#contained">https://dom.spec.whatwg.org/#contained</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-contained">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-end-node">
        <a
            href="https://dom.spec.whatwg.org/#concept-range-end-node">https://dom.spec.whatwg.org/#concept-range-end-node</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-end-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-live-range">
        <a href="https://dom.spec.whatwg.org/#concept-live-range">https://dom.spec.whatwg.org/#concept-live-range</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-live-range">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-live-range①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-partially-contained">
        <a
            href="https://dom.spec.whatwg.org/#partially-contained">https://dom.spec.whatwg.org/#partially-contained</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-partially-contained">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range">
        <a href="https://dom.spec.whatwg.org/#concept-range">https://dom.spec.whatwg.org/#concept-range</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range">1.
                    Introduction</a>
            <li><a href="#ref-for-concept-range①">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-concept-range②">(2)</a> <a
                    href="#ref-for-concept-range③">(3)</a>
            <li><a href="#ref-for-concept-range④">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-concept-range⑤">4.2.4.
                    Painting</a> <a href="#ref-for-concept-range⑥">(2)</a>
            <li><a href="#ref-for-concept-range⑦">5.1.
                    Repaints</a>
            <li><a href="#ref-for-concept-range⑧">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-range⑨">(2)</a> <a
                    href="#ref-for-concept-range①⓪">(3)</a> <a href="#ref-for-concept-range①①">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-shadow-including-root">
        <a
            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">https://dom.spec.whatwg.org/#concept-shadow-including-root</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-shadow-including-root">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-start-node">
        <a
            href="https://dom.spec.whatwg.org/#concept-range-start-node">https://dom.spec.whatwg.org/#concept-range-start-node</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-start-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-staticrange-valid">
        <a href="https://dom.spec.whatwg.org/#staticrange-valid">https://dom.spec.whatwg.org/#staticrange-valid</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-staticrange-valid">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document-window">
        <a
            href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document-window">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-current-global-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-current-global-object">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-originating-element">
        <a
            href="https://www.w3.org/TR/selectors-4/#originating-element">https://www.w3.org/TR/selectors-4/#originating-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-originating-element">4.2.2.
                    Default Styles</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-pseudo-element">
        <a
            href="https://www.w3.org/TR/selectors-4/#pseudo-element">https://www.w3.org/TR/selectors-4/#pseudo-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-pseudo-element">2.
                    Module Interactions</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-specificity">
        <a href="https://www.w3.org/TR/selectors-4/#specificity">https://www.w3.org/TR/selectors-4/#specificity</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-specificity">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-Exposed①">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-convert-idl-to-ecmascript-value">
        <a
            href="https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value">https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-convert-idl-to-ecmascript-value">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-long">
        <a href="https://webidl.spec.whatwg.org/#idl-long">https://webidl.spec.whatwg.org/#idl-long</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-long">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-map-entries">
        <a href="https://webidl.spec.whatwg.org/#dfn-map-entries">https://webidl.spec.whatwg.org/#dfn-map-entries</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-map-entries">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-maplike">
        <a href="https://webidl.spec.whatwg.org/#dfn-maplike">https://webidl.spec.whatwg.org/#dfn-maplike</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-maplike">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-set-entries">
        <a href="https://webidl.spec.whatwg.org/#dfn-set-entries">https://webidl.spec.whatwg.org/#dfn-set-entries</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-set-entries">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dfn-set-entries①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-setlike">
        <a href="https://webidl.spec.whatwg.org/#dfn-setlike">https://webidl.spec.whatwg.org/#dfn-setlike</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-setlike">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dfn-setlike①">(2)</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">通过引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[css-cascade-5]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-cascade">级联</span>
                <li><span class="dfn-paneled" id="term-for-inheritance">继承</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-contain-2]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-style-containment">样式包含</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-pseudo-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-selectordef-selection">::selection</span>
                <li><span class="dfn-paneled" id="term-for-selectordef-spelling-error">::spelling-error</span>
                <li><span class="dfn-paneled" id="term-for-highlight-overlay">高亮覆盖</span>
                <li><span class="dfn-paneled" id="term-for-highlight-pseudo-element">高亮伪元素</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-syntax-3]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-typedef-ident-token">&lt;ident-token></span>
                <li><span class="dfn-paneled" id="term-for-identifier">标识符</span>
                <li><span class="dfn-paneled" id="term-for-style-rule">样式规则</span>
            </ul>
        <li>
            <a data-link-type="biblio">[cssom-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-namespacedef-css">CSS</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-abstractrange">抽象范围</span>
                <li><span class="dfn-paneled" id="term-for-node">节点</span>
                <li><span class="dfn-paneled" id="term-for-range">范围</span>
                <li><span class="dfn-paneled" id="term-for-staticrange">静态范围</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-bp">边界点</span>
                <li><span class="dfn-paneled" id="term-for-range-collapsed">折叠</span>
                <li><span class="dfn-paneled" id="term-for-contained">包含</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-end-node">结束节点</span>
                <li><span class="dfn-paneled" id="term-for-concept-live-range">活动范围</span>
                <li><span class="dfn-paneled" id="term-for-partially-contained">部分包含</span>
                <li><span class="dfn-paneled" id="term-for-concept-range">范围</span>
                <li><span class="dfn-paneled" id="term-for-concept-shadow-including-root">包含阴影的根节点</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-start-node">开始节点</span>
                <li><span class="dfn-paneled" id="term-for-staticrange-valid">有效</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-concept-document-window">关联文档</span>
                <li><span class="dfn-paneled" id="term-for-current-global-object">当前全局对象</span>
            </ul>
        <li>
            <a data-link-type="biblio">[selectors-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-originating-element">起始元素</span>
                <li><span class="dfn-paneled" id="term-for-pseudo-element">伪元素</span>
                <li><span class="dfn-paneled" id="term-for-specificity">特异性</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WebIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
                <li><span class="dfn-paneled" id="term-for-Exposed">暴露</span>
                <li><span class="dfn-paneled" id="term-for-dfn-convert-idl-to-ecmascript-value">转换为 ECMAScript 值</span>
                <li><span class="dfn-paneled" id="term-for-idl-long">long</span>
                <li><span class="dfn-paneled" id="term-for-dfn-map-entries">映射条目</span>
                <li><span class="dfn-paneled" id="term-for-dfn-maplike">映射类</span>
                <li><span class="dfn-paneled" id="term-for-dfn-set-entries">设置条目</span>
                <li><span class="dfn-paneled" id="term-for-dfn-setlike">设置类</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-5/"><cite>CSS 级联和继承
                    第5版</cite></a>. 2021年12月3日. 工作草案. URL: <a
                href="https://www.w3.org/TR/css-cascade-5/">https://www.w3.org/TR/css-cascade-5/</a>
        <dt id="biblio-css-contain-2">[CSS-CONTAIN-2]
        <dd>Tab Atkins Jr.; Florian Rivoal; Vladimir Levin. <a href="https://www.w3.org/TR/css-contain-2/"><cite>CSS
                    包含模块 第2版</cite></a>. 2020年12月16日. 工作草案. URL: <a
                href="https://www.w3.org/TR/css-contain-2/">https://www.w3.org/TR/css-contain-2/</a>
        <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
        <dd>Daniel Glazman; Elika Etemad; Alan Stearns. <a href="https://www.w3.org/TR/css-pseudo-4/"><cite>CSS 伪元素模块
                    第4版</cite></a>. 2020年12月31日. 工作草案. URL: <a
                href="https://www.w3.org/TR/css-pseudo-4/">https://www.w3.org/TR/css-pseudo-4/</a>
        <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
        <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://www.w3.org/TR/css-syntax-3/"><cite>CSS 语法模块 第3版</cite></a>.
            2019年7月16日. 候选推荐标准. URL: <a
                href="https://www.w3.org/TR/css-syntax-3/">https://www.w3.org/TR/css-syntax-3/</a>
        <dt id="biblio-cssom-1">[CSSOM-1]
        <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://www.w3.org/TR/cssom-1/"><cite>CSS
                    对象模型（CSSOM）</cite></a>. 2021年8月26日. 工作草案. URL: <a
                href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. 现行标准. URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>. 现行标准.
            URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra 标准</cite></a>.
            现行标准. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>用于RFC中的关键字以表示需求级别</cite></a>.
            1997年3月. 当前最佳实践. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-selectors-4">[SELECTORS-4]
        <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/selectors-4/"><cite>选择器 第4版</cite></a>.
            2018年11月21日. 工作草案. URL: <a href="https://www.w3.org/TR/selectors-4/">https://www.w3.org/TR/selectors-4/</a>
        <dt id="biblio-webidl">[WebIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. 现行标准. URL: <a
                href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-highlighttype"><code><c- g>HighlightType</c-></code></a> {
  <a href="#dom-highlighttype-highlight"><code><c- s>"highlight"</c-></code></a>,
  <a href="#dom-highlighttype-spelling-error"><code><c- s>"spelling-error"</c-></code></a>,
  <a href="#dom-highlighttype-grammar-error"><code><c- s>"grammar-error"</c-></code></a>
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#highlight"><c- g>Highlight</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-highlight-highlight"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange"><c- n>AbstractRange</c-></a>... <a href="#dom-highlight-highlight-initialranges-initialranges"><code><c- g>initialRanges</c-></code></a>);
  <c- b>setlike</c->&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange"><c- n>AbstractRange</c-></a>>;
  <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-highlight-priority"><code><c- g>priority</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-highlighttype"><c- n>HighlightType</c-></a> <a data-type="HighlightType" href="#dom-highlight-type"><code><c- g>type</c-></code></a>;
};

<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://www.w3.org/TR/cssom-1/#namespacedef-css"><c- g>CSS</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#highlightregistry"><c- n>HighlightRegistry</c-></a> <a data-readonly data-type="HighlightRegistry" href="#dom-css-highlights"><code><c- g>highlights</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#highlightregistry"><code><c- g>HighlightRegistry</c-></code></a> {
  <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#highlight"><c- n>Highlight</c-></a>>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 我们应该如何指定此重新评估的时间（以及同步性）？ <a href="https://github.com/w3c/csswg-drafts/issues/4596">[问题
                #4596]</a> <a class="issue-return" href="#issue-a4ade514" title="跳转到部分">↵</a></div>
        <div class="issue"> <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange">StaticRange</a></code>
            在 <a data-link-type="dfn" href="#custom-highlight">自定义高亮</a> 中与 <a data-link-type="biblio"
                href="#biblio-css-contain-2">[css-contain-2]</a> 的交互似乎有问题：
            在完全包含的元素上，你应该预期对该元素后代的 DOM 更改不会导致外部元素的失效和重新样式/重绘。
            然而，如果静态范围有一个边界点在包含的子树内，另一个边界点在它之外，并且子树内的 DOM 更改使得内部边界点不再指向有效节点，则整个范围应被忽略，这将影响包含子树外部的绘制。
            这是 <a data-link-type="dfn" href="https://drafts.csswg.org/css-contain-2/#style-containment">样式包含</a>
            的弱点，还是上述失效逻辑的问题，或是其他原因？ <a href="https://github.com/w3c/csswg-drafts/issues/4598">[问题 #4598]</a> <a
                class="issue-return" href="#issue-d5e91a86" title="跳转到部分">↵</a></div>
        <div class="issue"> 关于事件的部分待定，基于
            https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/master/highlight/events-explainer.md <a
                class="issue-return" href="#issue-3d1f5f66" title="跳转到部分">↵</a></div>
        <div class="issue"> 自定义高亮是否应该有一个专用的事件处理机制，还是应该将其添加到伪元素中？ <a class="issue-return" href="#issue-230bd93b"
                title="跳转到部分">↵</a></div>
        <div class="issue"> 认可那些（除了编辑以外）应得功劳的人。 <a class="issue-return" href="#issue-f0ab6bff" title="跳转到部分">↵</a></div>
    </div>
    <aside class="dfn-panel" data-for="custom-highlight">
        <b><a href="#custom-highlight">#custom-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-custom-highlight①">(2)</a> <a
                    href="#ref-for-custom-highlight②">(3)</a>
            <li><a href="#ref-for-custom-highlight③">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-custom-highlight④">(2)</a> <a
                    href="#ref-for-custom-highlight⑤">(3)</a> <a href="#ref-for-custom-highlight⑥">(4)</a> <a
                    href="#ref-for-custom-highlight⑦">(5)</a> <a href="#ref-for-custom-highlight⑧">(6)</a> <a
                    href="#ref-for-custom-highlight⑨">(7)</a> <a href="#ref-for-custom-highlight①⓪">(8)</a>
            <li><a href="#ref-for-custom-highlight①①">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-custom-highlight①②">4.2.4.
                    Painting</a> <a href="#ref-for-custom-highlight①③">(2)</a> <a
                    href="#ref-for-custom-highlight①④">(3)</a> <a href="#ref-for-custom-highlight①⑤">(4)</a>
            <li><a href="#ref-for-custom-highlight①⑥">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-custom-highlight①⑦">(2)</a>
            <li><a href="#ref-for-custom-highlight①⑧">4.2.6.
                    Highlight types</a> <a href="#ref-for-custom-highlight①⑨">(2)</a> <a
                    href="#ref-for-custom-highlight②⓪">(3)</a> <a href="#ref-for-custom-highlight②①">(4)</a> <a
                    href="#ref-for-custom-highlight②②">(5)</a> <a href="#ref-for-custom-highlight②③">(6)</a>
            <li><a href="#ref-for-custom-highlight②④">5.1.
                    Repaints</a> <a href="#ref-for-custom-highlight②⑤">(2)</a> <a
                    href="#ref-for-custom-highlight②⑥">(3)</a>
            <li><a href="#ref-for-custom-highlight②⑦">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-custom-highlight②⑧">(2)</a> <a
                    href="#ref-for-custom-highlight②⑨">(3)</a> <a href="#ref-for-custom-highlight③⓪">(4)</a> <a
                    href="#ref-for-custom-highlight③①">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlight">
        <b><a href="#highlight">#highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlight">1.
                    Introduction</a> <a href="#ref-for-highlight①">(2)</a>
            <li><a href="#ref-for-highlight②">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-highlight③">(2)</a>
            <li><a href="#ref-for-highlight④">3.2.
                    Registering Custom Highlights</a>
            <li><a href="#ref-for-highlight⑤"> Changes since the 8 December 2020 Working Draft</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="enumdef-highlighttype">
        <b><a href="#enumdef-highlighttype">#enumdef-highlighttype</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-enumdef-highlighttype">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-enumdef-highlighttype①">4.2.6.
                    Highlight types</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-highlight">
        <b><a href="#dom-highlighttype-highlight">#dom-highlighttype-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-highlight">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-dom-highlighttype-highlight①">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-highlight②">(2)</a> <a
                    href="#ref-for-dom-highlighttype-highlight③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-spelling-error">
        <b><a href="#dom-highlighttype-spelling-error">#dom-highlighttype-spelling-error</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-spelling-error">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-spelling-error①">(2)</a> <a
                    href="#ref-for-dom-highlighttype-spelling-error②">(3)</a> <a
                    href="#ref-for-dom-highlighttype-spelling-error③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-grammar-error">
        <b><a href="#dom-highlighttype-grammar-error">#dom-highlighttype-grammar-error</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-grammar-error">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-grammar-error①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-highlight-initialranges-initialranges">
        <b><a
                href="#dom-highlight-highlight-initialranges-initialranges">#dom-highlight-highlight-initialranges-initialranges</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-highlight-initialranges-initialranges">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-priority">
        <b><a href="#dom-highlight-priority">#dom-highlight-priority</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-priority">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dom-highlight-priority①">(2)</a>
            <li><a href="#ref-for-dom-highlight-priority②">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-dom-highlight-priority③">(2)</a>
            <li><a href="#ref-for-dom-highlight-priority④">5.1.
                    Repaints</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-type">
        <b><a href="#dom-highlight-type">#dom-highlight-type</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-type">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dom-highlight-type①">(2)</a>
            <li><a href="#ref-for-dom-highlight-type②">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlight-type③">(2)</a> <a
                    href="#ref-for-dom-highlight-type④">(3)</a> <a href="#ref-for-dom-highlight-type⑤">(4)</a> <a
                    href="#ref-for-dom-highlight-type⑥">(5)</a> <a href="#ref-for-dom-highlight-type⑦">(6)</a> <a
                    href="#ref-for-dom-highlight-type⑧">(7)</a>
            <li><a href="#ref-for-dom-highlight-type⑨"> Changes since the 8 December 2020 Working Draft</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-highlight">
        <b><a href="#dom-highlight-highlight">#dom-highlight-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-highlight">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlight-registry">
        <b><a href="#highlight-registry">#highlight-registry</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlight-registry">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-highlight-registry①">(2)</a> <a
                    href="#ref-for-highlight-registry②">(3)</a>
            <li><a href="#ref-for-highlight-registry③">4.2.5.
                    Priority of Overlapping Highlights</a>
            <li><a href="#ref-for-highlight-registry④">5.1.
                    Repaints</a>
            <li><a href="#ref-for-highlight-registry⑤">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-highlight-registry⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="registered">
        <b><a href="#registered">#registered</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-registered">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-registered①">(2)</a> <a
                    href="#ref-for-registered②">(3)</a> <a href="#ref-for-registered③">(4)</a> <a
                    href="#ref-for-registered④">(5)</a> <a href="#ref-for-registered⑤">(6)</a> <a
                    href="#ref-for-registered⑥">(7)</a>
            <li><a href="#ref-for-registered⑦">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-registered⑧">4.2.5.
                    Priority of Overlapping Highlights</a>
            <li><a href="#ref-for-registered⑨">5.1.
                    Repaints</a> <a href="#ref-for-registered①⓪">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-css-highlights">
        <b><a href="#dom-css-highlights">#dom-css-highlights</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-css-highlights">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlightregistry">
        <b><a href="#highlightregistry">#highlightregistry</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlightregistry">1.
                    Introduction</a>
            <li><a href="#ref-for-highlightregistry①">3.2.
                    Registering Custom Highlights</a>
            <li><a href="#ref-for-highlightregistry②"> Changes since the 8 December 2020 Working Draft</a> <a
                    href="#ref-for-highlightregistry③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="custom-highlight-name">
        <b><a href="#custom-highlight-name">#custom-highlight-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight-name">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-custom-highlight-name①">(2)</a> <a
                    href="#ref-for-custom-highlight-name②">(3)</a>
            <li><a href="#ref-for-custom-highlight-name③">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="selectordef-highlight-custom-highlight-name">
        <b><a
                href="#selectordef-highlight-custom-highlight-name">#selectordef-highlight-custom-highlight-name</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-highlight-custom-highlight-name">1.
                    Introduction</a> <a href="#ref-for-selectordef-highlight-custom-highlight-name①">(2)</a>
            <li><a href="#ref-for-selectordef-highlight-custom-highlight-name②">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="custom-highlight-pseudo-element">
        <b><a href="#custom-highlight-pseudo-element">#custom-highlight-pseudo-element</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight-pseudo-element">4.2.1.
                    Applicable Properties</a>
            <li><a href="#ref-for-custom-highlight-pseudo-element①">4.2.2.
                    Default Styles</a> <a href="#ref-for-custom-highlight-pseudo-element②">(2)</a>
            <li><a href="#ref-for-custom-highlight-pseudo-element③">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="typedef-custom-highlight-name">
        <b><a href="#typedef-custom-highlight-name">#typedef-custom-highlight-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-typedef-custom-highlight-name">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a> <a
                    href="#ref-for-typedef-custom-highlight-name①">(2)</a> <a
                    href="#ref-for-typedef-custom-highlight-name②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="priority">
        <b><a href="#priority">#priority</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-priority">4.2.4.
                    Painting</a>
            <li><a href="#ref-for-priority①">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-priority②">(2)</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script>/* script-var-click-highlighting */

        document.addEventListener("click", e => {
            if (e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        {
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script src="/dropdown.js"></script>