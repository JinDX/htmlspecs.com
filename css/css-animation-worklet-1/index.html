<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>CSS 动画 Worklet API</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="WD" name="w3c-status">
    <link href="default.css" rel="stylesheet" type="text/css">
    <meta content="Bikeshed version a8675e8c315faa3f78e47e67c76649fa9a07ee9b" name="generator">
    <link href="https://www.w3.org/TR/css-animation-worklet-1/" rel="canonical">
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: gray;
            color: white;
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: black;
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: #005a9c;
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: black;
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-syntax-highlighting */
        pre.idl.highlight {
            color: #708090;
        }

        .highlight:not(.idl) {
            background: hsl(24, 20%, 95%);
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD" rel="stylesheet" type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSS 动画 Worklet API</h1>
        <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">W3C 第一次公开工作草案，<time
                    class="dt-updated" datetime="2019-06-25">2019年6月25日</time></span></h2>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>此版本：
                <dd><a class="u-url"
                        href="https://www.w3.org/TR/2019/WD-css-animation-worklet-1-20190625/">https://www.w3.org/TR/2019/WD-css-animation-worklet-1-20190625/</a>
                <dt>最新发布版本：
                <dd><a
                        href="https://www.w3.org/TR/css-animation-worklet-1/">https://www.w3.org/TR/css-animation-worklet-1/</a>
                <dt>编辑草案：
                <dd><a
                        href="https://drafts.css-houdini.org/css-animationworklet-1/">https://drafts.css-houdini.org/css-animationworklet-1/</a>
                <dt>反馈：
                <dd><span><a
                            href="mailto:public-houdini@w3.org?subject=%5Bcss-animation-worklet%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a>
                        主题为 “<kbd>[css-animation-worklet] <i data-lt>… 消息主题 …</i></kbd>” (<a
                            href="https://lists.w3.org/Archives/Public/public-houdini/" rel="discussion">存档</a>)</span>
                <dt>问题跟踪：
                <dd><a href="#issues-index">规范中的问题</a>
                <dd><a href="https://github.com/w3c/css-houdini-drafts/labels/css-animation-worklet-1">GitHub 问题</a>
                <dt class="editor">编辑：
                <dd class="editor p-author h-card vcard" data-editor-id="81464"><a class="p-name fn u-email email"
                        href="mailto:majidvp@google.com">Majid Valipour</a>
                <dd class="editor p-author h-card vcard" data-editor-id="98451"><a class="p-name fn u-email email"
                        href="mailto:flackr@chromium.org">Robert Flack</a>
                <dd class="editor p-author h-card vcard" data-editor-id="96463"><a class="p-name fn u-email email"
                        href="mailto:smcgruer@chromium.org">Stephen McGruer</a>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">版权声明</a> © 2019 <a
                href="https://www.w3.org/"><abbr title="万维网联盟">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="麻省理工学院">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr title="欧洲信息学和数学研究联盟">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">庆应义塾大学</a>, <a href="https://ev.buaa.edu.cn/">北京航空航天大学</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">责任声明</a>，<a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">商标</a> 和 <a
                href="https://www.w3.org/Consortium/Legal/copyright-documents">文档使用规则</a> 适用。 </p>
        <hr title="分隔符">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p><a href="#animation-worklet">动画 Worklet</a> API 提供了一种创建脚本动画的方法，该动画控制一组
            <a href="https://w3c.github.io/web-animations/#animation-effect">动画效果</a>。该 API
            的设计使得用户代理可以在自己的专用线程中运行此类动画，从而与主线程提供一定程度的性能隔离。
        </p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文件状态</span>
    </h2>
    <div data-fill-with="status">
        <p><em>本节描述了本文档在发布时的状态。其他文档可能会取代本文件。W3C 当前出版物列表和本技术报告的最新版本可在 <a href="https://www.w3.org/TR/">W3C 技术报告索引
                    https://www.w3.org/TR/</a> 找到。</em> </p>
        <p>本文档是 <b>第一次公开工作草案</b>。 </p>
        <p>作为第一次公开工作草案发布并不意味着 W3C 会员的认可。这是一份草案文档，可能随时更新、替换或被其他文档取代。引用本文档为工作进展以外的用途是不合适的。 </p>
        <p> <a href="https://github.com/w3c/css-houdini-drafts/issues">GitHub 问题</a> 是讨论此规范的首选方式。
            提交问题时，请在标题中包含“css-animation-worklet”字样，最好像这样：
            “[css-animation-worklet] <i>…评论摘要…</i>”。
            所有问题和评论都将<a href="https://lists.w3.org/Archives/Public/public-houdini-archive/">存档</a>。 </p>
        <p>本文档由 <a href="https://www.w3.org/Style/CSS/members">CSS 工作组</a> 制作。 </p>
        <p>本文档由遵循 <a href="https://www.w3.org/Consortium/Patent-Policy/">W3C 专利政策</a> 的小组制作。W3C 维护了一份<a
                href="https://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">任何与小组交付物相关的专利公开声明的公共列表</a>；
            该页面还包括专利公开的说明。了解含有 <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">必要声明</a> 的专利的个人，必须根据
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C 专利政策第6节</a> 公开相关信息。
        </p>
        <p>本文档受 <a href="https://www.w3.org/2019/Process-20190301/" id="w3c_process_revision">2019年3月1日 W3C 流程文档</a> 管理。
        </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content">简介</span></a>
                <ol class="toc">
                    <li><a href="#relationship-to-web-animations"><span class="secno">1.1</span> <span class="content">与
                                Web 动画 API 的关系</span></a>
                </ol>
            <li><a href="#animation-worklet-desc"><span class="secno">2</span> <span class="content">动画
                        Worklet</span></a>
            <li>
                <a href="#animator-desc"><span class="secno">3</span> <span class="content">动画师</span></a>
                <ol class="toc">
                    <li><a href="#stateless-animator-desc"><span class="secno">3.1</span> <span
                                class="content">无状态动画师接口</span></a>
                    <li><a href="#stateful-animator-desc"><span class="secno">3.2</span> <span
                                class="content">有状态动画师接口</span></a>
                    <li><a href="#animator-definition-desc"><span class="secno">3.3</span> <span
                                class="content">动画师定义</span></a>
                    <li><a href="#registering-animator-definition"><span class="secno">3.4</span> <span
                                class="content">注册动画师定义</span></a>
                </ol>
            <li>
                <a href="#animator-instance-section"><span class="secno">4</span> <span class="content">动画师实例</span></a>
                <ol class="toc">
                    <li><a href="#creating-animator-instance"><span class="secno">4.1</span> <span
                                class="content">创建动画师实例</span></a>
                    <li><a href="#running-animators"><span class="secno">4.2</span> <span
                                class="content">运行动画师</span></a>
                    <li><a href="#removing-animator"><span class="secno">4.3</span> <span
                                class="content">移除动画师实例</span></a>
                    <li><a href="#migrating-animator"><span class="secno">4.4</span> <span
                                class="content">迁移动画师实例</span></a>
                    <li><a href="#requesting-animation-frames"><span class="secno">4.5</span> <span
                                class="content">请求动画帧</span></a>
                </ol>
            <li>
                <a href="#web-animation-integration"><span class="secno">5</span> <span class="content">Web
                        动画集成</span></a>
                <ol class="toc">
                    <li><a href="#worklet-animation-desc"><span class="secno">5.1</span> <span class="content">Worklet
                                动画</span></a>
                    <li><a href="#creating-worklet-animation"><span class="secno">5.2</span> <span class="content">创建
                                Worklet 动画</span></a>
                    <li><a href="#timing-model"><span class="secno">5.3</span> <span class="content">Worklet
                                动画时间模型</span></a>
                    <li><a href="#worklet-animation-animator-instances"><span class="secno">5.4</span> <span
                                class="content">与动画师实例的交互</span></a>
                    <li><a href="#scroll-timeline"><span class="secno">5.5</span> <span class="content">滚动时间轴</span></a>
                    <li><a href="#worklet-group-effect"><span class="secno">5.6</span> <span class="content">Worklet
                                群组效果</span></a>
                    <li><a href="#effect-stack-composite-order"><span class="secno">5.7</span> <span
                                class="content">效果堆栈和复合顺序</span></a>
                </ol>
            <li><a href="#security-considerations"><span class="secno">6</span> <span class="content">安全注意事项</span></a>
            <li><a href="#privacy-considerations"><span class="secno">7</span> <span class="content">隐私注意事项</span></a>
            <li>
                <a href="#examples"><span class="secno">8</span> <span class="content">示例</span></a>
                <ol class="toc">
                    <li><a href="#example-1"><span class="secno">8.1</span> <span class="content">示例 1：Twitter
                                头部。</span></a>
                    <li><a href="#example-2"><span class="secno">8.2</span> <span class="content">示例 2：视差背景。</span></a>
                </ol>
            <li>
                <a href="#conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#conformance-classes"><span class="secno"></span> <span
                                class="content">一致性类别</span></a>
                    <li>
                        <a href="#partial"><span class="secno"></span> <span class="content">部分实现</span></a>
                        <ol class="toc">
                            <li><a href="#conform-future-proofing"><span class="secno"></span> <span class="content">
                                        不稳定和专有功能的实现</span></a>
                        </ol>
                    <li><a href="#testing"><span class="secno"></span> <span class="content">非实验性实现</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考性参考文献</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">简介</span><a class="self-link" href="#intro"></a></h2>
        <em>本节非规范性。</em>
        <p>本文档介绍了一种新的原语，它提供了 Web 动画的可扩展性，并在 Web 上实现了高性能的交互式过程动画。有关详细的理由和动机，请参见 <a data-link-type="biblio"
                href="#biblio-explainer">[解释器]</a> 和 <a data-link-type="biblio" href="#biblio-principles">[原则]</a>。</p>
        <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet">动画 Worklet</a> API
            提供了一种创建脚本动画的方法，这些动画控制一组
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect">动画效果</a>。该 API 设计使得用户代理可以在其专用线程中运行此类动画，从而与主线程提供一定程度的性能隔离。
        </p>
        <h3 class="heading settled" data-level="1.1" id="relationship-to-web-animations"><span class="secno">1.1.
            </span><span class="content">与 Web 动画 API 的关系</span><a class="self-link"
                href="#relationship-to-web-animations"></a></h3>
        <em>本节非规范性。</em>
        <p>在 <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet①">动画 Worklet</a>
            执行上下文中运行的动画在主 JavaScript 执行上下文中暴露了来自 Web 动画规范的 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation">动画</a></code>
            接口。这意味着它们可以使用相同的 Web 动画 API 从主线程进行控制和检查。</p>
        <h2 class="heading settled" data-level="2" id="animation-worklet-desc"><span class="secno">2. </span><span
                class="content">动画 Worklet</span><a class="self-link" href="#animation-worklet-desc"></a></h2>
        <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animation-worklet">动画 Worklet</dfn> 是一个
        <code
            class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet">Worklet</a></code>
        ，负责与自定义动画相关的所有类。Worklet 可以通过 <code
            class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet">animationWorklet</a></code>
        属性访问。
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet①">animationWorklet</a></code>
            的 <a data-link-type="dfn" href="https://www.w3.org/TR/worklets-1/#worklet-global-scope-type"
                id="ref-for-worklet-global-scope-type">worklet 全局范围类型</a> 是 <code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope">AnimationWorkletGlobalScope</a></code>。
        </p>
        <p><code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①">AnimationWorkletGlobalScope</a></code>
            表示 <code
                class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet②">animationWorklet</a></code>
            的全局执行上下文。
        </p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet①"><c- n>Worklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="Worklet" id="dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></dfn>;
};
</pre>
        <h2 class="heading settled" data-level="3" id="animator-desc"><span class="secno">3. </span><span
                class="content">动画师</span><a class="self-link" href="#animator-desc"></a></h2>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator">动画师</dfn> 代表了在动画线程上运行的动画实例。
            动画师通过唯一的名称进行识别，并根据当前的输入时间确定动画如何推进其关键帧效果。<a data-link-type="dfn" href="#animator"
                id="ref-for-animator">动画师</a> 实例存在于 <code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope②">AnimationWorkletGlobalScope</a></code>
            中，每个实例都与一个 <code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation">WorkletAnimation</a></code>
            实例相关联。动画师只能通过构造 <code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation①">WorkletAnimation</a></code>
            来实例化。
        </p>
        <p>支持两种动画师类型：<code
                class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator">无状态动画师</a></code>
            和 <code
                class="idl"><a data-link-type="idl" href="#statefulanimator" id="ref-for-statefulanimator">有状态动画师</a></code>
            ，每个提供不同的状态管理策略。</p>
        <h3 class="heading settled" data-level="3.1" id="stateless-animator-desc"><span class="secno">3.1. </span><span
                class="content">无状态动画师接口</span><a class="self-link" href="#stateless-animator-desc"></a></h3>
        <p>此接口表示一个无状态动画师。此类动画师不依赖于存储在实例或全局范围内的任何本地状态。实际上，<code
                class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator①">无状态动画师</a></code>
            的动画函数可以被视为纯函数，期望在相同的输入下产生相同的输出。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>, <dfn class="idl-code" data-dfn-for="StatelessAnimator" data-dfn-type="constructor" data-export data-lt="StatelessAnimator(options)|StatelessAnimator()" id="dom-statelessanimator-statelessanimator"><code><c- g>Constructor</c-></code><a class="self-link" href="#dom-statelessanimator-statelessanimator"></a></dfn> (<c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatelessAnimator/StatelessAnimator(options)" data-dfn-type="argument" data-export id="dom-statelessanimator-statelessanimator-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-statelessanimator-statelessanimator-options-options"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="statelessanimator"><code><c- g>StatelessAnimator</c-></code></dfn> {
};
</pre>
        <div class="note" role="note">
            这是类应有的样子。
            <pre class="lang-javascript highlight"><c- kr>class</c-> FooAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
    constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
        <c- c1>// 当一个新的动画师被实例化时调用。</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// 动画帧逻辑在此。</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <p class="note" role="note"><span>注意：</span> 无状态使动画工作流能够执行优化，例如并行生成多个动画帧，并进行非常低成本的拆卸和设置。强烈推荐使用无状态动画师，以启用此类优化。
        </p>
        <h3 class="heading settled" data-level="3.2" id="stateful-animator-desc"><span class="secno">3.2. </span><span
                class="content">有状态动画师接口</span><a class="self-link" href="#stateful-animator-desc"></a></h3>
        <p>此接口表示一个有状态的动画师。该动画师可以有本地状态，并且动画工作流保证只要有状态动画师履行如下所述的接口要求，它的状态将被维护。</p>
        <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet②">动画 Worklet</a>
            维护着一组可能存在于不同线程或进程中的 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope">WorkletGlobalScope</a></code>。
            动画 worklet 可能会暂时终止某个全局范围（例如，为了节省资源），或在不同全局范围之间移动一个正在运行的 <a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance">动画师实例</a>（例如，如果其效果只能在某一特定线程中发生变化）。动画 worklet
            保证有状态动画师实例的状态即使在不同的全局范围中重新生成时也能保持。</p>
        <p>维护状态的基本机制是动画 worklet 快照通过 <code
                class="idl"><a data-link-type="idl" href="#dom-statefulanimator-state" id="ref-for-dom-statefulanimator-state">state</a></code>
            函数暴露的本地状态，并将其实例化，以便在稍后可能在不同全局范围内重新生成动画师实例时，将其传递给构造函数。<a data-link-type="dfn"
                href="#migrate-an-animator-instance" id="ref-for-migrate-an-animator-instance">迁移动画师实例</a> 算法详细说明了这一过程。
        </p>
        <p>用户定义的有状态动画师需履行以下要求：其 state 函数返回一个对象，表示其状态，该状态可使用结构化序列化算法进行序列化；同时，构造函数也能根据传递给它的同一对象重新创建其状态。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>,
<dfn class="idl-code" data-dfn-for="StatefulAnimator" data-dfn-type="constructor" data-export data-lt="StatefulAnimator(options, state)|StatefulAnimator(options)|StatefulAnimator()" id="dom-statefulanimator-statefulanimator"><code><c- g>Constructor</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator"></a></dfn> (<c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatefulAnimator/StatefulAnimator(options, state)" data-dfn-type="argument" data-export id="dom-statefulanimator-statefulanimator-options-state-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator-options-state-options"></a></dfn>, <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatefulAnimator/StatefulAnimator(options, state)" data-dfn-type="argument" data-export id="dom-statefulanimator-statefulanimator-options-state-state"><code><c- g>state</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator-options-state-state"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="statefulanimator"><code><c- g>StatefulAnimator</c-></code></dfn> {
  <c- b>any</c-> <dfn class="dfn-paneled idl-code" data-dfn-for="StatefulAnimator" data-dfn-type="method" data-export data-lt="state()" id="dom-statefulanimator-state"><code><c- g>state</c-></code></dfn>();
};
</pre>
        <div class="note" role="note">
            这是类应有的样子。
            <pre class="lang-javascript highlight"><c- kr>class</c-> BarAnimator <c- kr>extends</c-> StatefulAnimator <c- p>{</c->
    constructor<c- p>(</c->options<c- p>,</c-> state<c- p>)</c-> <c- p>{</c->
      <c- c1>// 当一个新的动画师被实例化时（无论是首次还是重新生成后）。</c->
      <c- k>this</c-><c- p>.</c->currentVelocity  <c- o>=</c-> state <c- o>?</c-> state<c- p>.</c->velocity <c- o>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// 动画帧逻辑在此，可以依赖 this.currentVelocity。</c->
        <c- k>this</c-><c- p>.</c->currentVelocity <c- o>+=</c-> <c- mf>0.1</c-><c- p>;</c->
    <c- p>}</c->
    state<c- p>()</c-> <c- p>{</c->
      <c- c1>// 返回的对象应使用结构化克隆算法进行序列化。</c->
      <c- k>return</c-> <c- p>{</c->
        velocity<c- o>:</c-> <c- k>this</c-><c- p>.</c->currentVelocity<c- p>;</c->
      <c- p>}</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <h3 class="heading settled" data-level="3.3" id="animator-definition-desc"><span class="secno">3.3. </span><span
                class="content">动画师定义</span><a class="self-link" href="#animator-definition-desc"></a>
        </h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-definition">动画师定义</dfn> 是一个<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">结构</a>，它根据 <code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope③">AnimationWorkletGlobalScope</a></code>
            的需要描述作者定义的自定义动画。
            它包括：</p>
        <ul>
            <li data-md>
                <p>一个 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-name">动画师名称</dfn>
                    <a class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/css-values-4/#typedef-ident"
                        id="ref-for-typedef-ident">&lt;标识符></a>。
                </p>
            <li data-md>
                <p>一个 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="class-constructor">类构造函数</dfn>，它是一个
                    <code
                        class="idl"><a data-link-type="idl" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor">AnimatorInstanceConstructor</a></code>
                    <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-function"
                        id="ref-for-dfn-callback-function">回调函数</a> 类型。
                </p>
            <li data-md>
                <p>一个 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animate-function">动画函数</dfn>，它是一个
                    <a data-link-type="dfn" href="https://heycam.github.io/webidl/#Function"
                        id="ref-for-Function">函数</a>，属于 <a data-link-type="dfn"
                        href="https://heycam.github.io/webidl/#dfn-callback-function"
                        id="ref-for-dfn-callback-function①">回调函数</a> 类型。
                </p>
            <li data-md>
                <p>一个 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-flag">有状态标志</dfn>。
                </p>
        </ul>
        <h3 class="heading settled" data-level="3.4" id="registering-animator-definition"><span class="secno">3.4.
            </span><span class="content">注册动画师定义</span><a class="self-link" href="#registering-animator-definition"></a>
        </h3>
        <code
            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope④">AnimationWorkletGlobalScope</a></code>
        具有一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
            id="animator-name-to-animator-definition-map">动画师名称到动画师定义的映射</dfn>。
        当调用 <code
            class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a></code>
        时，映射会被填充。
        <pre class="idl highlight def">[ <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global②"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a> ]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope①"><c- n>WorkletGlobalScope</c-></a> {
    <c- b>void</c-> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator①"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"></a></dfn>, <a class="n" data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor①"><c- n>AnimatorInstanceConstructor</c-></a> <dfn class="idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"></a></dfn>);
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></dfn> = <c- b>any</c-> (<c- b>any</c-> <dfn class="idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-animatorinstanceconstructor-options"></a></dfn>, <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code><a class="self-link" href="#dom-animatorinstanceconstructor-state"></a></dfn>);

</pre>
        <div class="algorithm" data-algorithm="register-animator">
            <p>当在<code
                    class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑤">AnimationWorkletGlobalScope</a></code>
                中调用 <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope" data-dfn-type="method"
                    data-export
                    id="dom-animationworkletglobalscope-registeranimator"><code>registerAnimator(<var>name</var>, <var>animatorCtor</var>)</code></dfn>
                方法时，用户代理<em>必须</em>运行以下步骤：</p>
            <ol>
                <li data-md>
                    <p>如果 <var>name</var> 不是有效的 <a class="production css" data-link-type="type"
                            href="https://www.w3.org/TR/css-values-4/#typedef-ident"
                            id="ref-for-typedef-ident①">&lt;标识符></a>，<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">抛出</a> <a
                            data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> 并中止这些步骤。
                    </p>
                <li data-md>
                    <p>如果 <var>name</var> 作为键存在于<a data-link-type="dfn" href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map">动画师名称到动画师定义的映射</a>中，<a
                            data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw"
                            id="ref-for-dfn-throw①">抛出</a> <a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#notsupportederror"
                            id="ref-for-notsupportederror">NotSupportedError</a> 并中止所有这些步骤。</p>
                <li data-md>
                    <p>如果 <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor"
                            id="ref-for-sec-isconstructor">IsConstructor</a>(<var>animatorCtor</var>) 的结果为 <b>false</b>，
                        <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw"
                            id="ref-for-dfn-throw②">抛出</a> <a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a>
                        并中止所有这些步骤。
                    </p>
                <li data-md>
                    <p>令 <var>prototype</var> 为调用 <a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-get-o-p"
                            id="ref-for-sec-get-o-p">Get</a>(<var>animatorCtor</var>, "prototype") 的结果。</p>
                <li data-md>
                    <p>如果 <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-samevalue"
                            id="ref-for-sec-samevalue">SameValue</a>(<var>prototype</var>, <code
                            class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator②">无状态动画师</a></code>)
                        为 <b>true</b>，则将 <var>stateful</var> 设置为 <b>false</b>，否则如果 <a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-samevalue"
                            id="ref-for-sec-samevalue①">SameValue</a>(<var>prototype</var>, <code
                            class="idl"><a data-link-type="idl" href="#statefulanimator" id="ref-for-statefulanimator①">有状态动画师</a></code>)
                        为 <b>true</b>，则将 <var>stateful</var> 设置为 <b>true</b>，否则<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw③">抛出</a> <a
                            data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a>
                        并中止所有这些步骤。</p>
                <li data-md>
                    <p>令 <var>animateValue</var> 为调用 <a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-get-o-p"
                            id="ref-for-sec-get-o-p①">Get</a>(<var>prototype</var>, "animate") 的结果。</p>
                <li data-md>
                    <p>令 <var>animate</var> 为 <a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping">转换</a>
                        <var>animateValue</var> 为 <a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#Function" id="ref-for-Function①">函数</a> <a
                            data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-function"
                            id="ref-for-dfn-callback-function②">回调函数</a> 类型的结果。如果抛出异常，请重新抛出异常并中止这些步骤。
                    </p>
                <li data-md>
                    <p>令 <var>definition</var> 为新的 <a data-link-type="dfn" href="#animator-definition"
                            id="ref-for-animator-definition">动画师定义</a>，其中包括：</p>
                    <ul>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name">动画师名称</a> 为
                                <var>name</var>
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#class-constructor"
                                    id="ref-for-class-constructor">类构造函数</a> 为 <var>animatorCtor</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function">动画函数</a> 为
                                <var>animate</var>
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#stateful-flag" id="ref-for-stateful-flag">有状态标志</a> 为
                                <var>stateful</var>
                            </p>
                    </ul>
                <li data-md>
                    <p>将键值对 (<var>name</var> - <var>definition</var>) 添加到 <a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map①">动画师名称到动画师定义的映射</a> 中。</p>
            </ol>
        </div>
        <h2 class="heading settled" data-level="4" id="animator-instance-section"><span class="secno">4. </span><span
                class="content">动画师实例</span><a class="self-link" href="#animator-instance-section"></a></h2>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-instance">动画师实例</dfn>
            是一个<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">结构</a>，
            描述了在<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑥">AnimationWorkletGlobalScope</a></code>中完全实现的自定义动画实例。
            它引用了一个<a data-link-type="dfn" href="#animator-definition"
                id="ref-for-animator-definition①">动画师定义</a>，并拥有特定实例状态，如动画效果和时间线。它包括：</p>
        <ul>
            <li data-md>
                <p>一个<a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name①">动画师名称</a>。</p>
            <li data-md>
                <p>一个<a data-link-type="dfn" href="#animation-requested-flag"
                        id="ref-for-animation-requested-flag">动画请求标志</a>。</p>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-effect">动画师效果</dfn>，它是一个 <a
                        data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                        id="ref-for-animation-effect①">动画效果</a>。</p>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animator-current-time">动画师当前时间</dfn>，它是对应的 <a data-link-type="dfn" href="#worklet-animation"
                        id="ref-for-worklet-animation">worklet 动画</a> 的当前时间。</p>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-timeline">动画师时间线</dfn>，它是一个
                    <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline"
                        id="ref-for-timeline">时间线</a>。
                </p>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animator-serialized-options">动画师序列化选项</dfn>，它是一个可序列化的对象。</p>
        </ul>
        <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-animator-instance">有状态动画师实例</dfn>
            是一个 <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①">动画师实例</a>，其对应的 <a
                data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition②">动画师定义</a> 的 <a
                data-link-type="dfn" href="#stateful-flag" id="ref-for-stateful-flag①">有状态标志</a> 为 <b>true</b>。
        </p>
        <h3 class="heading settled" data-level="4.1" id="creating-animator-instance"><span class="secno">4.1.
            </span><span class="content">创建动画师实例</span><a class="self-link" href="#creating-animator-instance"></a></h3>
        <p>每个<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance②">动画师实例</a>
            存在于<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑦">AnimationWorkletGlobalScope</a></code>中。
        </p>
        <p>每个<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑧">AnimationWorkletGlobalScope</a></code>
            具有一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="animator-instance-set">动画师实例集</dfn>。当用户代理在<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑨">AnimationWorkletGlobalScope</a></code>
            作用域中构造一个新的<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance③">动画师实例</a>时，该集合将被填充。每个<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance④">动画师实例</a>对应于文档作用域中的一个 worklet 动画。</p>
        <div class="algorithm" data-algorithm="create-animator">
            <p>为给定的<var>name</var>、<var>timeline</var>、<var>effect</var>、<var>serializedOptions</var>、<var>serializedState</var>和<var>workletGlobalScope</var>，用户代理<em>必须</em>运行以下步骤以<dfn
                    class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="create-a-new-animator-instance">创建一个新的动画师实例</dfn>：
            </p>
            <ol>
                <li data-md>
                    <p>令<var>definition</var>为在<var>workletGlobalScope</var>的<a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map②">动画师名称到动画师定义映射</a>中查找<var>name</var>的结果。
                    </p>
                    <p>如果<var>definition</var>不存在，终止以下步骤。</p>
                <li data-md>
                    <p>令<var>animatorCtor</var>为<var>definition</var>的<a data-link-type="dfn" href="#class-constructor"
                            id="ref-for-class-constructor①">类构造函数</a>。</p>
                <li data-md>
                    <p>令<var>options</var>为<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structureddeserialize"
                            id="ref-for-structureddeserialize">结构化反序列化</a>(<var>serializedOptions</var>)的结果。
                    </p>
                <li data-md>
                    <p>令<var>state</var>为<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structureddeserialize"
                            id="ref-for-structureddeserialize①">结构化反序列化</a>(<var>serializedState</var>)的结果。
                    </p>
                <li data-md>
                    <p>令<var>animatorInstance</var>为使用«<var>options</var>、<var>state</var>»作为参数<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#construct-a-callback-function"
                            id="ref-for-construct-a-callback-function">构造</a><var>animatorCtor</var>的结果。如果抛出异常，重新抛出异常并终止所有这些步骤。
                    </p>
                <li data-md>
                    <p>在<var>animatorInstance</var>上设置以下内容：</p>
                    <ul>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-name"
                                    id="ref-for-animator-name②">动画师名称</a>为<var>name</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animation-requested-flag"
                                    id="ref-for-animation-requested-flag①">动画请求标志</a>为<var>frame-current</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-current-time"
                                    id="ref-for-animator-current-time">动画师当前时间</a>未解析</p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-effect"
                                    id="ref-for-animator-effect">动画师效果</a>为<var>effect</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-timeline"
                                    id="ref-for-animator-timeline">动画师时间线</a>为<var>timeline</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-serialized-options"
                                    id="ref-for-animator-serialized-options">动画师序列化选项</a>为<var>options</var>
                            </p>
                    </ul>
                <li data-md>
                    <p>将<var>animatorInstance</var>添加到<var>workletGlobalScope</var>的<a data-link-type="dfn"
                            href="#animator-instance-set" id="ref-for-animator-instance-set">动画师实例集</a>。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.2" id="running-animators"><span class="secno">4.2. </span><span
                class="content">运行动画师</span><a class="self-link" href="#running-animators"></a></h3>
        <p>当用户代理希望生成一个新的动画帧时，如果任何<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance⑤">动画师实例</a>的
            关联<a data-link-type="dfn" href="#animation-requested-flag"
                id="ref-for-animation-requested-flag②">动画请求标志</a>为<a data-link-type="dfn" href="#frame-requested"
                id="ref-for-frame-requested">帧请求</a>，则用户代理<em>必须</em>为当前帧<a data-link-type="dfn" href="#run-animators"
                id="ref-for-run-animators">运行动画师</a>。
        </p>
        <p class="note" role="note"><span>注意：</span>用户代理不需要在每个视觉帧上运行动画。可以推迟到后续帧生成动画帧。这允许用户代理根据其策略提供不同的服务级别。</p>
        <div class="algorithm" data-algorithm="run-animators">
            <p>当用户代理想要在给定的<var>workletGlobalScope</var>中<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="run-animators">运行动画器</dfn>时，它<em>必须</em>遍历<var>workletGlobalScope</var>中的所有<a
                    data-link-type="dfn" href="#animator-instance"
                    id="ref-for-animator-instance⑥">动画器实例</a>，并迭代<var>workletGlobalScope</var>的<a data-link-type="dfn"
                    href="#animator-instance-set"
                    id="ref-for-animator-instance-set①">动画器实例集</a>。对于每个这样的<var>实例</var>，用户代理<em>必须</em>执行以下步骤：</p>
            <ol>
                <li data-md>
                    <p>令<var>animatorName</var>为<var>instance</var>的<a data-link-type="dfn" href="#animator-name"
                            id="ref-for-animator-name③">动画师名称</a></p>
                <li data-md>
                    <p>令<var>definition</var>为在<var>workletGlobalScope</var>的<a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map③">动画师名称到动画师定义映射</a>中查找<var>animatorName</var>的结果。
                    </p>
                    <p>如果<var>definition</var>不存在，则中止以下步骤。</p>
                <li data-md>
                    <p>如果<var>instance</var>的<a data-link-type="dfn" href="#animation-requested-flag"
                            id="ref-for-animation-requested-flag③">动画请求标志</a>为<a data-link-type="dfn"
                            href="#frame-current" id="ref-for-frame-current①">当前帧</a>，
                        或者<var>instance</var>所属的效果不会在当前帧的可视视口内可见，用户代理<em>可以</em>中止所有后续步骤。</p>
                    <p class="issue" id="issue-6d334361"><a class="self-link" href="#issue-6d334361"></a>
                        可以考虑允许用户代理跳过运行动画师实例，以限制缓慢的动画师。</p>
                <li data-md>
                    <p>令<var>animateFunction</var>为<var>definition</var>的<a data-link-type="dfn"
                            href="#animate-function" id="ref-for-animate-function①">动画函数</a>。</p>
                <li data-md>
                    <p>令<var>currentTime</var>为<var>instance</var>的<a data-link-type="dfn" href="#animator-current-time"
                            id="ref-for-animator-current-time①">动画师当前时间</a>。</p>
                <li data-md>
                    <p>令<var>effect</var>为<var>instance</var>的<a data-link-type="dfn" href="#animator-effect"
                            id="ref-for-animator-effect①">动画师效果</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function"
                            id="ref-for-invoke-a-callback-function">调用</a><var>animateFunction</var>，参数为«<var>currentTime</var>，<var>effect</var>»，
                        并以<var>instance</var>作为<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#dfn-callback-this-value"
                            id="ref-for-dfn-callback-this-value">回调的 this 值</a>。</p>
            </ol>
        </div>
        注意：虽然效率较低，但用户代理在同一帧中多次<a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators①">运行动画师</a>是合法的。
        <p class="issue" id="issue-84eae255"><a class="self-link" href="#issue-84eae255"></a> 需要明确说明如果 animateFunction
            抛出异常会发生什么。至少需要说明关键帧的 localTime 值会被忽略，以避免不正确的部分更新。</p>
        <h3 class="heading settled" data-level="4.3" id="removing-animator"><span class="secno">4.3. </span><span
                class="content">移除动画师实例</span><a class="self-link" href="#removing-animator"></a>
        </h3>
        <div class="algorithm" data-algorithm="remove-animator">
            <p>为给定的<var>instance</var>和<var>workletGlobalScope</var>移除一个<dfn class="dfn-paneled" data-dfn-type="dfn"
                    data-noexport id="remove-an-animator-instance">动画师实例</dfn>，用户代理<em>必须</em>执行以下步骤：
            </p>
            <ol>
                <li data-md>
                    <p>将<var>instance</var>从<var>workletGlobalScope</var>的<a data-link-type="dfn"
                            href="#animator-instance-set" id="ref-for-animator-instance-set②">动画师实例集</a>中移除。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.4" id="migrating-animator"><span class="secno">4.4. </span><span
                class="content">迁移动画师实例</span><a class="self-link" href="#migrating-animator"></a></h3>
        <p>迁移过程允许<a data-link-type="dfn" href="#stateful-animator-instance"
                id="ref-for-stateful-animator-instance">有状态动画师实例</a>迁移到不同的
            <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope②">WorkletGlobalScope</a></code>
            而不丢失其本地状态。
        </p>
        <div class="algorithm" data-algorithm="migrate-animator">
            <p>要将一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="migrate-an-animator-instance">动画师实例迁移</dfn>从一个<code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope③">WorkletGlobalScope</a></code>
                迁移到另一个，给定<var>instance</var>、<var>sourceWorkletGlobalScope</var>和
                <var>destinationWorkletGlobalScope</var>，用户代理<em>必须</em>执行以下步骤：
            </p>
            <ol>
                <li data-md>
                    <p>令<var>serializedState</var>未定义。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task">在<var>sourceWorkletGlobalScope</var>上排队一个任务</a>，执行以下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>令<var>animatorName</var>为<var>instance</var>的<a data-link-type="dfn"
                                    href="#animator-name" id="ref-for-animator-name④">动画师名称</a></p>
                        <li data-md>
                            <p>令<var>definition</var>为在<var>sourceWorkletGlobalScope</var>的<a data-link-type="dfn"
                                    href="#animator-name-to-animator-definition-map"
                                    id="ref-for-animator-name-to-animator-definition-map④">动画师名称到动画师定义映射</a>中查找<var>animatorName</var>的结果。
                            </p>
                            <p>如果<var>definition</var>不存在，则中止以下步骤。</p>
                        <li data-md>
                            <p>令<var>stateful</var>为<var>definition</var>的<a data-link-type="dfn" href="#stateful-flag"
                                    id="ref-for-stateful-flag②">有状态标志</a>。</p>
                        <li data-md>
                            <p>如果<var>stateful</var>为<b>false</b>，则中止以下步骤。</p>
                        <li data-md>
                            <p>令<var>stateFunction</var>为<var>instance</var>的状态函数。</p>
                        <li data-md>
                            <p>令<var>state</var>为调用<var>stateFunction</var>的结果，<a data-link-type="dfn"
                                    href="https://heycam.github.io/webidl/#invoke-a-callback-function"
                                    id="ref-for-invoke-a-callback-function①">调用</a>时，<var>instance</var>作为<a
                                    data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value"
                                    id="ref-for-dfn-callback-this-value①">回调的 this 值</a>。如果抛出任何异常，请重新抛出异常并中止
                                以下步骤。
                            </p>
                        <li data-md>
                            <p>将<var>serializedState</var>设置为<a data-link-type="dfn"
                                    href="http://w3c.github.io/html/infrastructure.html#structuredserialize"
                                    id="ref-for-structuredserialize">结构化序列化</a>(<var>state</var>)的结果。
                                如果抛出任何异常，则中止以下步骤。</p>
                        <li data-md>
                            <p>执行<a data-link-type="dfn" href="#remove-an-animator-instance"
                                    id="ref-for-remove-an-animator-instance">移除动画师实例</a>的过程，给定
                                <var>instance</var>和<var>sourceWorkletGlobalScope</var>。
                            </p>
                    </ol>
                <li data-md>
                    <p>等待上述任务完成。如果任务中止，停止以下步骤。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task①">在<var>destinationWorkletGlobalScope</var>上排队一个任务</a>，执行以下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>执行<a data-link-type="dfn" href="#create-a-new-animator-instance"
                                    id="ref-for-create-a-new-animator-instance">创建新的动画师实例</a>的过程，
                                给定以下参数：</p>
                            <ul>
                                <li data-md>
                                    <p><var>instance</var>的<a data-link-type="dfn" href="#animator-name"
                                            id="ref-for-animator-name⑤">动画师名称</a>作为名称。</p>
                                <li data-md>
                                    <p><var>instance</var>的<a data-link-type="dfn" href="#animator-timeline"
                                            id="ref-for-animator-timeline①">动画师时间线</a>作为时间线。</p>
                                <li data-md>
                                    <p><var>instance</var>的<a data-link-type="dfn" href="#animator-effect"
                                            id="ref-for-animator-effect②">动画师效果</a>作为效果。</p>
                                <li data-md>
                                    <p><var>instance</var>的<a data-link-type="dfn" href="#animator-serialized-options"
                                            id="ref-for-animator-serialized-options①">动画师序列化选项</a>作为选项。</p>
                                <li data-md>
                                    <p><var>serializedState</var>作为状态。</p>
                                <li data-md>
                                    <p><var>destinationWorkletGlobalScope</var>作为 workletGlobalScope。</p>
                            </ul>
                    </ol>
            </ol>
        </div>
        <p>如果动画师状态 getter 抛出异常，用户代理将移除动画师，但不会重新创建它。
            这实际上移除了动画师实例。</p>
        <h3 class="heading settled" data-level="4.5" id="requesting-animation-frames"><span class="secno">4.5.
            </span><span class="content">请求动画帧</span><a class="self-link" href="#requesting-animation-frames"></a></h3>
        <p>每个<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑦">动画师实例</a>
            关联一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="animation-requested-flag">动画请求标志</dfn>。它必须是
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="frame-requested">帧请求</dfn>或<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="frame-current">当前帧</dfn>。它最初设置为<a
                data-link-type="dfn" href="#frame-current" id="ref-for-frame-current②">当前帧</a>。不同的情况可能会导致<a
                data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag④">动画请求标志</a>被
            设置为<a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested①">帧请求</a>。
            包括以下情况：
        </p>
        <ul>
            <li data-md>
                <p>动画师的<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time">当前时间</a>的变化<a data-link-type="dfn"
                        href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timeline①">时间线</a></p>
            <li data-md>
                <p>动画师对应的<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time①">当前时间</a>的变化<a data-link-type="dfn" href="#worklet-animation"
                        id="ref-for-worklet-animation①">Worklet
                        动画</a></p>
        </ul>
        <p><a href="#running-animators">§4.2 运行动画师</a>将动画师上的<a data-link-type="dfn" href="#animation-requested-flag"
                id="ref-for-animation-requested-flag⑤">动画请求标志</a>重置为
            <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current③">当前帧</a>。
        </p>
        <h2 class="heading settled" data-level="5" id="web-animation-integration"><span class="secno">5. </span><span
                class="content">Web 动画集成</span><a class="self-link" href="#web-animation-integration"></a></h2>
        <h3 class="heading settled" data-level="5.1" id="worklet-animation-desc"><span class="secno">5.1. </span><span
                class="content">Worklet 动画</span><a class="self-link" href="#worklet-animation-desc"></a></h3>
        <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="worklet-animation">Worklet 动画</dfn>是一种
        <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
            id="ref-for-concept-animation">动画</a>，它将动画播放委托给
        一个<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑧">动画师实例</a>。它控制其对应的<a
            data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑨">动画师实例</a>的生命周期和播放状态。
        <p>作为一个<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation①">动画</a>，<a data-link-type="dfn" href="#worklet-animation"
                id="ref-for-worklet-animation②">worklet 动画</a>具有<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effect②">动画效果</a>和
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline"
                id="ref-for-timeline②">时间线</a>。但是，不同于其他动画，worklet 动画的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                id="ref-for-current-time②">当前时间</a>不会直接决定动画效果的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time">本地时间</a>
            （通过其<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#inherited-time"
                id="ref-for-inherited-time">继承时间</a>）。相反，关联的
            <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①⓪">动画师实例</a>直接控制动画效果的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time①">本地时间</a>。请注意，这意味着<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timeline③">时间线</a>的当前时间不能完全决定
            动画的输出。
        </p>
        <p><a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation③">Worklet 动画</a>
            除了<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation①">Animation</a></code>
            接口外，还具有以下属性：</p>
        <ul>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animation-animator-name">动画师名称</dfn>，用于标识其
                    <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition③">动画师定义</a>。
                </p>
            <li data-md>
                <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="serialized-options">序列化选项</dfn>，这是一个可序列化对象，
                    用于构建新的动画师实例。</p>
        </ul>
        <figure>
            <img alt="WorkletAnimation 时间模型概述" src="img/WorkletAnimation-timing-model.svg" width="600">
            <figcaption>
                WorkletAnimation 时间模型概述。<br>
                <p>动画的当前时间输入到动画师实例中，生成动画效果的本地时间值。如果动画师实例在并行全局作用域中运行，实现还可以选择使用本地时间值生成最终效果值，并并行更新视觉效果。</p>
            </figcaption>
        </figure>
        <h3 class="heading settled" data-level="5.2" id="creating-worklet-animation"><span class="secno">5.2.
            </span><span class="content">创建 Worklet 动画</span><a class="self-link"
                href="#creating-worklet-animation"></a></h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>Window</c->,
 <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation" id="ref-for-dom-workletanimation-workletanimation"><c- g>Constructor</c-></a> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"></a></dfn>,
              <c- b>optional</c-> (<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect①"><c- n>AnimationEffect</c-></a>>)? <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"></a></dfn> = <c- b>null</c->,
              <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationtimeline" id="ref-for-animationtimeline"><c- n>AnimationTimeline</c-></a>? <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"></a></dfn>,
              <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletanimation"><code><c- g>WorkletAnimation</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation②"><c- n>Animation</c-></a> {
        <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="attribute" data-export data-readonly data-type="DOMString" id="dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code><a class="self-link" href="#dom-workletanimation-animatorname"></a></dfn>;
};

</pre>
        <div class="algorithm" data-algorithm="create-worklet-animation">
            <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="constructor" data-export
                id="dom-workletanimation-workletanimation"><code>WorkletAnimation(<var>animatorName</var>, <var>effects</var>, <var>timeline</var>, <var>options</var>)</code></dfn>
            <p>使用以下过程创建一个新的<code
                    class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation②">WorkletAnimation</a></code>
                对象。</p>
            <ol>
                <li data-md>
                    <p>令<var>workletAnimation</var>为一个新的<code
                            class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation③">WorkletAnimation</a></code>
                        对象。</p>
                <li data-md>
                    <p>运行设置动画时间线的过程，传递<var>timeline</var>作为新的时间线，或者，如果未提供<var>timeline</var>参数，
                        则传递与<a data-link-type="idl"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"
                            id="ref-for-window">Window</a>关联的
                        <a data-link-type="dfn"
                            href="https://w3c.github.io/web-animations/#the-documents-default-timeline"
                            id="ref-for-the-documents-default-timeline">默认文档时间线</a>。
                    </p>
                <li data-md>
                    <p>根据以下条件匹配第一个结果，令<var>effect</var>为对应的结果。</p>
                    <dl>
                        <dt data-md>如果<var>effects</var>是一个<code
                                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect②">AnimationEffect</a></code>对象，
                        <dd data-md>
                            <p>令<var>effect</var>为<var>effects</var>。</p>
                        <dt data-md>如果<var>effects</var>是一个<code
                                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect③">AnimationEffect</a></code>对象的列表，
                        <dd data-md>
                            <p>令<var>effect</var>为一个新的<code
                                    class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect">WorkletGroupEffect</a></code>，其子级设置为<var>effects</var>。
                            </p>
                        <dt data-md>否则，
                        <dd data-md>
                            <p>令<var>effect</var>为未定义。</p>
                    </dl>
                <li data-md>
                    <p>运行设置动画目标效果的过程，传递<var>effect</var>作为新的效果。</p>
                <li data-md>
                    <p>令<var>serializedOptions</var>为<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structuredserialize"
                            id="ref-for-structuredserialize①">结构化序列化</a>(<var>options</var>)的结果。
                        重新抛出任何异常。</p>
                <li data-md>
                    <p>将<var>workletAnimation</var>的<a data-link-type="dfn" href="#serialized-options"
                            id="ref-for-serialized-options">序列化选项</a>设置为<var>serializedOptions</var>。</p>
                <li data-md>
                    <p>将<var>workletAnimation</var>的<a data-link-type="dfn" href="#animation-animator-name"
                            id="ref-for-animation-animator-name">动画师名称</a>设置为<var>animatorName</var>。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="5.3" id="timing-model"><span class="secno">5.3. </span><span
                class="content">Worklet 动画时间模型</span><a class="self-link" href="#timing-model"></a></h3>
        <p>本节描述了<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation④">worklet 动画</a>的时间模型与其他
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation②">动画</a>的不同之处。
        </p>
        <p>除了现有条件下何时将<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation③">动画</a>视为
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#ready" id="ref-for-ready">就绪</a>，
            <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑤">worklet 动画</a>
            只有在以下条件也为真时，才会被视为<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#ready"
                id="ref-for-ready①">就绪</a>：
        </p>
        <ul>
            <li data-md>
                <p>用户代理已完成创建<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑥">worklet
                        动画</a>对应的
                    <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①①">动画师实例</a>
                    所需的任何设置。
                </p>
        </ul>
        <p>如<a href="#worklet-animation-desc">§5.1 Worklet 动画</a>中所述，
            <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑦">worklet 动画</a>的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                id="ref-for-current-time③">当前时间</a>不会决定其
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect③">动画效果</a>的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time②">本地时间</a>。相反，关联的
            <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①②">动画师实例</a>
            直接控制动画效果的<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time③">本地时间</a>。这意味着动画效果的本地时间由可能在并行执行上下文中的
            <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope"
                    id="ref-for-workletglobalscope④">WorkletGlobalScope</a></code>控制。
        </p>
        <p>以下是上述语义的几个含义：</p>
        <ul>
            <li data-md>
                <p>设置<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time④">当前时间</a>或<a data-link-type="dfn"
                        href="https://www.w3.org/TR/css3-transitions/#transition-start-time"
                        id="ref-for-transition-start-time">开始时间</a>的
                    <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑧">worklet 动画</a>
                    不一定会更改其输出，但可能会更改动画的<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state"
                        id="ref-for-play-state">播放状态</a>。
                </p>
            <li data-md>
                <p>同样，调用<code class="idl"><a data-link-type="idl"
                            href="https://www.w3.org/TR/web-animations-1/#dom-animation-finish"
                            id="ref-for-dom-animation-finish">finish()</a></code>
                    或更新<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑨">worklet 动画</a>的
                    <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#playback-rate"
                        id="ref-for-playback-rate">播放速率</a>只会更改动画的
                    <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state"
                        id="ref-for-play-state①">播放状态</a>，可能不会更改输出。
                </p>
            <li data-md>
                <p>使用<code class="idl"><a data-link-type="idl"
                            href="https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming"
                            id="ref-for-dom-animationeffect-getcomputedtiming">getComputedTiming()</a></code>
                    查询动画效果的本地时间时，可能会返回陈旧的信息，如果
                    <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①③">动画师实例</a>
                    正在并行执行上下文中运行。
                </p>
        </ul>
        <p>如果 Worklet 动画在并行 worklet 执行上下文中执行，则应定期将其动画效果的最新状态同步回主
            JavaScript 执行上下文。从并行 worklet 执行上下文到主 JavaScript 执行上下文的
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#effect-value"
                id="ref-for-effect-value">效果值</a>同步<em>必须</em>在文档生命周期中
            <a data-link-type="dfn" href="https://html.spec.whatwg.org/#run-the-animation-frame-callbacks"
                id="ref-for-run-the-animation-frame-callbacks">运行动画帧回调</a>之前进行。
            请注意，由于此动画模型的异步性质，当主 JavaScript 执行上下文中的脚本读取由 Worklet 动画
            动画的<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#target-property"
                id="ref-for-target-property">目标属性</a>时，可能会看到陈旧的值，
            而与当前用于生成用户可见的视觉帧的值不同。这类似于异步滚动时读取主 JavaScript 执行上下文中的滚动偏移量的效果。
        </p>
        <p class="issue" id="issue-61e3a71a"><a class="self-link" href="#issue-61e3a71a"></a> 为动画师实例在其
            动画 currentTime 发生变化时（例如，通过 reverse()、finish() 或 playbackRate 更改）提供适当的机制进行通知。
            这样它可以做出适当的反应。
            <a
                href="https://github.com/w3c/css-houdini-drafts/issues/811">&lt;https://github.com/w3c/css-houdini-drafts/issues/811></a>
        </p>
        <h3 class="heading settled" data-level="5.4" id="worklet-animation-animator-instances"><span class="secno">5.4.
            </span><span class="content">与动画师实例的交互</span><a class="self-link"
                href="#worklet-animation-animator-instances"></a></h3>
        <p>一个<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①⓪">worklet
                动画</a>在任何时间最多对应一个<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①⑤">动画师实例</a>，并且可能没有当前对应的<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①⑥">动画师实例</a>。对于<a data-link-type="dfn" href="#worklet-animation"
                id="ref-for-worklet-animation①①">worklet 动画</a>，其<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state②">播放状态</a>决定了对应的<a
                data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①⑦">动画师实例</a>。</p>
        <div class="algorithm" data-algorithm="associate-animator-instance">
            <p>为了给定<var>workletAnimation</var>的<a data-link-type="dfn"
                    href="#associate-animator-instance-of-worklet-animation">关联动画师实例</a>，
                用户代理<em>必须</em>执行以下步骤：</p>
            <ol>
                <li data-md>
                    <p>如果<var>workletAnimation</var>已经有一个对应的<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance①⑧">动画师实例</a>，则中止后续步骤。</p>
                <li data-md>
                    <p>令<var>workletGlobalScope</var>为与<var>workletAnimation</var>关联的<code
                            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①⓪">AnimationWorkletGlobalScope</a></code>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task②">排队一个任务</a>在<var>workletGlobalScope</var>上，运行创建新<a
                            data-link-type="dfn" href="#create-a-new-animator-instance"
                            id="ref-for-create-a-new-animator-instance①">动画师实例</a>的过程，传递：</p>
                    <ul>
                        <li data-md>
                            <p>作为名称的<var>workletAnimation</var>的<a data-link-type="dfn" href="#animation-animator-name"
                                    id="ref-for-animation-animator-name①">动画师名称</a>。</p>
                        <li data-md>
                            <p>作为时间线的<var>workletAnimation</var>的<a data-link-type="dfn"
                                    href="https://w3c.github.io/web-animations/#timeline"
                                    id="ref-for-timeline④">时间线</a>。</p>
                        <li data-md>
                            <p>作为效果的<var>workletAnimation</var>的<a data-link-type="dfn"
                                    href="https://w3c.github.io/web-animations/#animation-effect"
                                    id="ref-for-animation-effect④">动画效果</a>。</p>
                        <li data-md>
                            <p>作为选项的<var>workletAnimation</var>的<a data-link-type="dfn" href="#serialized-options"
                                    id="ref-for-serialized-options①">序列化选项</a>。</p>
                        <li data-md>
                            <p>作为<var>workletGlobalScope</var>的<var>workletGlobalScope</var>。</p>
                    </ul>
                <li data-md>
                    <p>如果该过程成功，则将生成的<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance①⑨">动画师实例</a>设置为与<var>workletAnimation</var>对应。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="disassociate-animator-instance">
            <p>为了给定<var>workletAnimation</var>的<a data-link-type="dfn"
                    href="#disassociate-animator-instance-of-worklet-animation">取消关联动画师实例</a>，
                用户代理<em>必须</em>执行以下步骤：</p>
            <ol>
                <li data-md>
                    <p>如果<var>workletAnimation</var>没有对应的<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance②⓪">动画师实例</a>，则中止后续步骤。</p>
                <li data-md>
                    <p>令<var>workletGlobalScope</var>为与<var>workletAnimation</var>关联的<code
                            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①①">AnimationWorkletGlobalScope</a></code>。
                    </p>
                <li data-md>
                    <p>令<var>animatorInstance</var>为<var>workletAnimation</var>对应的<a data-link-type="dfn"
                            href="#animator-instance" id="ref-for-animator-instance②①">动画师实例</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task③">排队一个任务</a>在<var>workletGlobalScope</var>上，运行<a
                            data-link-type="dfn" href="#remove-an-animator-instance"
                            id="ref-for-remove-an-animator-instance①">移除动画师实例</a>的过程，传递<var>animatorInstance</var>作为实例，并传递<var>workletGlobalScope</var>。
                    </p>
                <li data-md>
                    <p>将<var>workletAnimation</var>设置为没有对应的<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance②②">动画师实例</a>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="set-animator-instance">
            <p>为了给定<var>workletAnimation</var>的<a data-link-type="dfn"
                    href="#set-animator-instance-of-worklet-animation">设置动画师实例</a>，
                用户代理<em>必须</em>执行以下步骤：</p>
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation"
                            id="ref-for-disassociate-animator-instance-of-worklet-animation">取消关联动画师实例</a>给定<var>workletAnimation</var>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation"
                            id="ref-for-associate-animator-instance-of-worklet-animation">关联动画师实例</a>给定<var>workletAnimation</var>。
                    </p>
            </ol>
        </div>
        <p>当给定的<var>workletAnimation</var>的<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state③">播放状态</a>变为
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#pending" id="ref-for-pending">待处理</a>、<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#running" id="ref-for-running">运行</a>或<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#paused" id="ref-for-paused">暂停</a>时，
            执行<a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation"
                id="ref-for-associate-animator-instance-of-worklet-animation①">关联动画师实例</a>给定<var>workletAnimation</var>的过程。
        </p>
        <p>当给定的<var>workletAnimation</var>的<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state④">播放状态</a>变为
            <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#idle" id="ref-for-idle">空闲</a>或<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#finished"
                id="ref-for-finished">已完成</a>时，
            执行<a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation"
                id="ref-for-disassociate-animator-instance-of-worklet-animation①">取消关联动画师实例</a>给定<var>workletAnimation</var>的过程。
        </p>
        <p>当为给定的<var>workletAnimation</var>调用<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#set-the-target-effect-of-an-animation"
                id="ref-for-set-the-target-effect-of-an-animation①">设置动画的目标效果</a>的过程时，执行<a data-link-type="dfn"
                href="#set-animator-instance-of-worklet-animation"
                id="ref-for-set-animator-instance-of-worklet-animation">设置动画师实例</a>给定<var>workletAnimation</var>的过程。</p>
        <p>当为给定的<var>workletAnimation</var>调用<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#set-the-timeline-of-an-animation"
                id="ref-for-set-the-timeline-of-an-animation①">设置动画的时间线</a>的过程时，执行<a data-link-type="dfn"
                href="#set-animator-instance-of-worklet-animation"
                id="ref-for-set-animator-instance-of-worklet-animation①">设置动画师实例</a>给定<var>workletAnimation</var>的过程。
        </p>
        <h3 class="heading settled" data-level="5.5" id="scroll-timeline"><span class="secno">5.5. </span><span
                class="content">滚动时间线</span><a class="self-link" href="#scroll-timeline"></a></h3>
        <em>本节非规范性。</em>
        <p><code
                class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline" id="ref-for-scrolltimeline">ScrollTimeline</a></code>
            是一个提议添加到Web动画API的新概念。它定义了一个动画时间线，其时间值取决于滚动容器的滚动位置。<a data-link-type="dfn" href="#worklet-animation"
                id="ref-for-worklet-animation①②">Worklet动画</a>
            可以有一个滚动时间线，从而根据滚动偏移驱动它们的脚本效果。</p>
        <p class="note" role="note"><span>注意：</span>
            <strong>访问输入</strong>：我们有兴趣暴露除滚动以外的其他用户输入（例如，触摸/指针输入）给这些动画，以便作者可以创建无卡顿的输入驱动动画，而这些动画在当今并不太可能实现。我们仍在努力找出实现这一目标的正确抽象和机制。
        </p>

        <h3 class="heading settled" data-level="5.6" id="worklet-group-effect"><span class="secno">5.6. </span><span
                class="content">WorkletGroupEffect</span><a class="self-link" href="#worklet-group-effect"></a></h3>
        <p><code
                class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect①">WorkletGroupEffect</a></code>
            是一种<a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect"
                id="ref-for-group-effect">组效果</a>，它允许其<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/level-2/#child-effect" id="ref-for-child-effect">子效果</a>的<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time④">本地时间</a>单独变更。</p>
        <p>当一个<code
                class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect②">WorkletGroupEffect</a></code>
            被设置为<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect⑤">动画效果</a>，并与<code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation④">Worklet动画</a></code>关联时，
            对应的<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance②③">动画师实例</a>可以直接控制<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#child-effect"
                id="ref-for-child-effect①">子效果</a>的<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time⑤">本地时间</a>。这允许单个worklet动画协调多个效果——参见<a href="#example-2">§8.2
                示例2：视差背景。</a>中的一个使用场景示例。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></dfn> {
  <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect④"><c- n>AnimationEffect</c-></a>> <dfn class="idl-code" data-dfn-for="WorkletGroupEffect" data-dfn-type="method" data-export data-lt="getChildren()" id="dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code><a class="self-link" href="#dom-workletgroupeffect-getchildren"></a></dfn>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑤"><c- g>AnimationEffect</c-></a> {
    // 用于Animation Worklet范围内驱动效果。
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationEffect" data-dfn-type="attribute" data-export data-type="double" id="dom-animationeffect-localtime"><code><c- g>localTime</c-></code></dfn>;
};
</pre>
        <div class="algorithm" data-algorithm="set-local-time">
            <p>为了将<var>t</var>值设置为<var>effect</var>的<code
                    class="idl"><a data-link-type="idl" href="#dom-animationeffect-localtime" id="ref-for-dom-animationeffect-localtime">localTime</a></code>属性，
                用户代理应执行以下第一个匹配条件对应的操作：</p>
            <dl>
                <dt data-md>如果<var>effect</var>没有父组，
                <dd data-md>
                    <p>将<var>effect</var>的本地时间设置为<var>t</var>。</p>
                <dt data-md>如果<var>effect</var>有父组，且父组类型为<code
                        class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect③">WorkletGroupEffect</a></code>，
                <dd data-md>
                    <p>将效果开始时间设置为（父级的变换时间- t）。注意这实际上设置了<var>effect</var>的本地时间为t。</p>
                <dt data-md>否则
                <dd data-md>
                    <p>抛出一个异常，指出子效果时间只能由其父组控制。</p>
            </dl>
        </div>
        <p class="issue" id="issue-9ff2b6cb"><a class="self-link" href="#issue-9ff2b6cb"></a>
            上述接口暴露了作为web-animation-2一部分提议的组效果的保守子集。我们应该将其移到对web动画的增量规范中。<a
                href="https://github.com/w3c/csswg-drafts/issues/2071">&lt;https://github.com/w3c/csswg-drafts/issues/2071></a>
        </p>
        <h3 class="heading settled" data-level="5.7" id="effect-stack-composite-order"><span class="secno">5.7.
            </span><span class="content">效果堆栈和组合顺序</span><a class="self-link" href="#effect-stack-composite-order"></a>
        </h3>
        <p>与其他动画一样，<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①③">worklet动画</a>参与了<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#effect-stack"
                id="ref-for-effect-stack">效果堆栈</a>。worklet动画没有特定的<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#animation-class"
                id="ref-for-animation-class">动画类</a>，这意味着它与其他由JavaScript创建的Web动画具有相同的组合顺序。</p>

        <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span
                class="content">安全性考虑</span><a class="self-link" href="#security-considerations"></a></h2>
        <p>这些特性没有已知的安全问题。</p>

        <h2 class="heading settled" data-level="7" id="privacy-considerations"><span class="secno">7. </span><span
                class="content">隐私考虑</span><a class="self-link" href="#privacy-considerations"></a></h2>
        <p>这些特性没有已知的隐私问题。</p>

        <h2 class="heading settled" data-level="8" id="examples"><span class="secno">8. </span><span
                class="content">示例</span><a class="self-link" href="#examples"></a></h2>
        <h3 class="heading settled" data-level="8.1" id="example-1"><span class="secno">8.1. </span><span
                class="content">示例1：Twitter 头部。</span><a class="self-link" href="#example-1"></a></h3>
        一个展示Twitter个人资料头部效果的示例，其中两个元素（头像和头部）根据滚动偏移同步更新。
        <pre class="lang-markup highlight">// 在文档范围内。
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'header'</c-> <c- e>style</c-><c- o>=</c-><c- s>'height: 150px'</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'avatar'</c-><c- p>>&lt;</c-><c- f>img</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
await CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'twitter-header-animator.js'</c-><c- p>);</c->
<c- kr>const</c-> animation <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'twitter-header'</c-><c- p>,</c->
    <c- p>[</c-><c- k>new</c-> KeyframeEffect<c- p>(</c->$avatar<c- p>,</c->  <c- d>/* 向上滚动时缩放 */</c->
                    <c- p>[{</c->transform<c- o>:</c-> <c- t>'scale(1)'</c-><c- p>},</c-> <c- p>{</c->transform<c- o>:</c-> <c- t>'scale(0.5)'</c-><c- p>}],</c->
                    <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>,</c-> iterations<c- o>:</c-> <c- mi>1</c-><c- p>}),</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$header<c- p>,</c-> <c- d>/* 向上滚动时透明度降低 */</c->
                    <c- p>[{</c->opacity<c- o>:</c-> <c- mi>0</c-><c- p>},</c-> <c- p>{</c->opacity<c- o>:</c-> <c- mf>0.8</c-><c- p>}],</c->
                    <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>,</c-> iterations<c- o>:</c-> <c- mi>1</c-><c- p>})],</c->
    <c- k>new</c-> ScrollTimeline<c- p>({</c->
      scrollSource<c- o>:</c-> $scrollingContainer<c- p>,</c->
      orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
      timeRange<c- o>:</c-> <c- mi>1000</c-><c- p>,</c->
      startScrollOffset<c- o>:</c-> <c- mi>0</c-><c- p>,</c->
      endScrollOffset<c- o>:</c-> $header<c- p>.</c->clientHeight<c- p>}));</c->
animation<c- p>.</c->play<c- p>();</c->

<c- c1>// 由于此动画使用的是组效果，同一动画实例可以通过不同的句柄访问：$avatarEl.getAnimations()[0], $headerEl.getAnimations()[0]</c->

<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        <pre class="lang-javascript highlight"><c- c1>// 在AnimationWorkletGlobalScope内。</c->
registerAnimator<c- p>(</c-><c- t>'twitter-header'</c-><c- p>,</c-> <c- kr>class</c-> HeaderAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
  constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->timing_ <c- o>=</c-> <c- k>new</c-> CubicBezier<c- p>(</c-><c- t>'ease-out'</c-><c- p>);</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    <c- kr>const</c-> scroll <c- o>=</c-> currentTime<c- p>;</c->  <c- c1>// 滚动值在[0, 1000]范围内</c->

    <c- c1>// 通过单独设置其子效果的本地时间来驱动输出组效果。</c->
    effect<c- p>.</c->children<c- p>[</c-><c- mi>0</c-><c- p>].</c->localTime <c- o>=</c-> scroll<c- p>;</c->
    effect<c- p>.</c->children<c- p>[</c-><c- mi>1</c-><c- p>].</c->localTime <c- o>=</c-> <c- k>this</c-><c- p>.</c->timing_<c- p>(</c->clamp<c- p>(</c->scroll<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>500</c-><c- p>));</c->
  <c- p>}</c->
<c- p>});</c->

<c- a>function</c-> clamp<c- p>(</c->value<c- p>,</c-> min<c- p>,</c-> max<c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> Math<c- p>.</c->min<c- p>(</c->Math<c- p>.</c->max<c- p>(</c->value<c- p>,</c-> min<c- p>),</c-> max<c- p>);</c->
<c- p>}</c->
</pre>
        <h3 class="heading settled" data-level="8.2" id="example-2"><span class="secno">8.2. </span><span
                class="content">示例2：视差背景。</span><a class="self-link" href="#example-2"></a></h3>
        一个简单的视差背景示例。
        <pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>.</c-><c- nc>parallax</c-> <c- p>{</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>fixed</c-><c- p>;</c->
    <c- k>top</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>left</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>opacity</c-><c- p>:</c-> <c- mf>0.5</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"slow"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"fast"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
await CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'parallax-animator.js'</c-><c- p>);</c->
<c- kr>const</c-> scrollTimeline <c- o>=</c-> <c- k>new</c-> ScrollTimeline<c- p>({</c->
  scrollSource<c- o>:</c-> $scrollingContainer<c- p>,</c->
  orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
  timeRange<c- o>:</c-> <c- mi>1000</c->
<c- p>});</c->
<c- kr>const</c-> scrollRange <c- o>=</c-> $scrollingContainer<c- p>.</c->scrollHeight <c- o>-</c-> $scrollingContainer<c- p>.</c->clientHeight<c- p>;</c->

<c- kr>const</c-> slowParallax <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$parallax_slow<c- p>,</c-> <c- p>[{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY(0)'</c-><c- p>},</c-> <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>}],</c-> <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.4</c-><c- p>}</c->
<c- p>);</c->
slowParallax<c- p>.</c->play<c- p>();</c->

<c- kr>const</c-> fastParallax <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$parallax_fast<c- p>,</c-> <c- p>[{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY(0)'</c-><c- p>},</c-> <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>}],</c-> <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.8</c-><c- p>}</c->
<c- p>);</c->
fastParallax<c- p>.</c->play<c- p>();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        <pre class="lang-javascript highlight"><c- c1>// 在 AnimationWorkletGlobalScope 内。</c->
registerAnimator<c- p>(</c-><c- t>'parallax'</c-><c- p>,</c-> <c- kr>class</c-> ParallaxAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
  constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->rate_ <c- o>=</c-> options<c- p>.</c->rate<c- p>;</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    effect<c- p>.</c->localTime <c- o>=</c-> currentTime <c- o>*</c-> <c- k>this</c-><c- p>.</c->rate_<c- p>;</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
    </main>
    <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">一致性</span><a class="self-link"
            href="#conformance"></a></h2>
    <h3 class="no-ref heading settled" id="conventions"><span class="content">文档约定</span><a class="self-link"
            href="#conventions"></a></h3>
    <p>一致性要求通过描述性断言和RFC 2119术语的组合来表达。关键字“必须（MUST）”，“不得（MUST NOT）”，“要求（REQUIRED）”，“应（SHALL）”，“不应（SHALL
        NOT）”，“应该（SHOULD）”，“不应该（SHOULD NOT）”，“建议（RECOMMENDED）”，“可以（MAY）”和“可选（OPTIONAL）”在本文件的规范部分中应按照RFC
        2119中的解释进行理解。不过，为了可读性，这些词在本规范中并未全部使用大写字母。</p>
    <p>本规范的所有文本均为规范性内容，除非明确标记为非规范性的部分、示例和注释。<a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
    <p>本规范中的示例通过“例如”引出，或与规范文本分开，使用<code>class="example"</code>标记，例如：</p>
    <div class="example" id="example-ae2b6bc0">
        <a class="self-link" href="#example-ae2b6bc0"></a>
        <p>这是一个信息性示例。</p>
    </div>
    <p>信息性注释以“注释”开头，并与规范文本分开，使用<code>class="note"</code>标记，例如：</p>
    <p class="note" role="note">注释，这是一个信息性注释。</p>
    <p>建议性条文为规范部分，样式为醒目，使用<code>&lt;strong class="advisement"></code>标记，例如：<strong
            class="advisement">用户代理（UAs）必须提供可访问的替代方案。</strong></p>
    <h3 class="no-ref heading settled" id="conformance-classes"><span class="content">一致性类别</span><a class="self-link"
            href="#conformance-classes"></a></h3>
    <p>本规范的一致性分为三类：</p>
    <dl>
        <dt>样式表
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS样式表</a>。
        <dt>渲染器
        <dd>解释样式表语义并渲染使用样式表的文档的<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">用户代理（UA）</a>。
        <dt>创作工具
        <dd>编写样式表的<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">用户代理（UA）</a>。
    </dl>
    <p>样式表符合本规范的要求，前提是其使用本模块定义的语法的所有声明都符合通用CSS语法和本模块中每个功能定义的个体语法。</p>
    <p>渲染器符合本规范的要求，不仅需要按照适当的规范解释样式表，还要正确解析并支持本规范定义的所有功能，进而正确渲染文档。然而，如果由于设备限制而无法正确渲染文档，这并不意味着用户代理不符合要求。（例如，用户代理不需要在单色显示器上渲染颜色。）
    </p>
    <p>创作工具符合本规范的要求，前提是它编写的样式表在语法上符合通用CSS语法和本模块中每个功能的个体语法，并且满足本模块中描述的样式表的所有其他一致性要求。</p>
    <h3 class="no-ref heading settled" id="partial"><span class="content"> 部分实现</span><a class="self-link"
            href="#partial"></a></h3>
    <p>为了让作者能够利用向前兼容的解析规则分配回退值，CSS 渲染器<strong>必须</strong>将其无法支持的任何@规则、属性、属性值、关键字和其他语法结构视为无效（并且<a
            href="https://www.w3.org/TR/CSS21/conform.html#ignore">适当忽略</a>）。特别是，用户代理<strong>不得</strong>在单个多值属性声明中选择性忽略不支持的组件值并接受支持的值：如果任何值被认为是无效的（因为不支持的值必须如此），CSS
        要求忽略整个声明。</p>
    <h4 class="heading settled" id="conform-future-proofing"><span class="content"> 不稳定和专有功能的实现</span><a
            class="self-link" href="#conform-future-proofing"></a></h4>
    <p>为了避免与未来稳定的 CSS 功能发生冲突，CSSWG 建议<a href="https://www.w3.org/TR/CSS/#future-proofing">遵循最佳实践</a>来实现<a
            href="https://www.w3.org/TR/CSS/#unstable">不稳定</a>的功能和<a
            href="https://www.w3.org/TR/CSS/#proprietary-extension">专有扩展</a>。</p>
    <h3 class="no-ref heading settled" id="testing"><span class="content"> 非实验性实现</span><a class="self-link"
            href="#testing"></a></h3>
    <p>一旦规范进入候选推荐阶段（Candidate Recommendation），就可以进行非实验性实现，实施者应发布任何CR级别功能的无前缀实现，前提是他们能够证明其按照规范正确实现。</p>
    <p>为了建立和维护 CSS 在不同实现之间的互操作性，CSS 工作组请求非实验性的 CSS 渲染器在发布任何 CSS 功能的无前缀实现之前，向 W3C 提交一份实现报告（如果必要，还包括用于该实现报告的测试用例）。提交给 W3C
        的测试用例将由 CSS 工作组进行审查和修正。</p>
    <p>关于提交测试用例和实现报告的更多信息，可以从 CSS 工作组的网站<a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>获取。相关问题应通过<a
            href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>邮件列表进行询问。
    </p>
    <script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#animate-function">动画函数</a><span>, 在 §3.3</span>
        <li><a href="#animation-animator-name">动画动画师名称</a><span>, 在 §5.1</span>
        <li><a href="#animation-requested-flag">动画请求标志</a><span>, 在 §4.5</span>
        <li><a href="#animation-worklet">动画工作单元</a><span>, 在 §2</span>
        <li><a href="#dom-css-animationworklet">动画工作单元 (animationWorklet)</a><span>, 在 §2</span>
        <li><a href="#animationworkletglobalscope">动画工作单元全局范围</a><span>, 在 §3.4</span>
        <li><a href="#animator">动画师</a><span>, 在 §3</span>
        <li><a href="#animator-current-time">动画师当前时间</a><span>, 在 §4</span>
        <li><a href="#animator-definition">动画师定义</a><span>, 在 §3.3</span>
        <li><a href="#animator-effect">动画师效果</a><span>, 在 §4</span>
        <li><a href="#animator-instance">动画师实例</a><span>, 在 §4</span>
        <li><a href="#callbackdef-animatorinstanceconstructor">动画师实例构造函数</a><span>, 在 §3.4</span>
        <li><a href="#animator-instance-set">动画师实例集</a><span>, 在 §4.1</span>
        <li><a href="#animator-name">动画师名称</a><span>, 在 §3.3</span>
        <li><a href="#dom-workletanimation-animatorname">动画师名称 (animatorName)</a><span>, 在 §5.2</span>
        <li><a href="#animator-name-to-animator-definition-map">动画师名称到动画师定义映射</a><span>, 在 §3.4</span>
        <li><a href="#animator-serialized-options">动画师序列化选项</a><span>, 在 §4</span>
        <li><a href="#animator-timeline">动画师时间轴</a><span>, 在 §4</span>
        <li><a href="#associate-animator-instance-of-worklet-animation">关联动画师实例</a><span>, 在 §5.4</span>
        <li><a href="#class-constructor">类构造函数</a><span>, 在 §3.3</span>
        <li><a href="#create-a-new-animator-instance">创建一个新的动画师实例</a><span>, 在 §4.1</span>
        <li><a href="#disassociate-animator-instance-of-worklet-animation">取消关联动画师实例</a><span>, 在 §5.4</span>
        <li><a href="#frame-current">当前帧</a><span>, 在 §4.5</span>
        <li><a href="#frame-requested">请求帧</a><span>, 在 §4.5</span>
        <li><a href="#dom-workletgroupeffect-getchildren">获取子元素 (getChildren())</a><span>, 在 §5.6</span>
        <li><a href="#dom-animationeffect-localtime">局部时间 (localTime)</a><span>, 在 §5.6</span>
        <li><a href="#migrate-an-animator-instance">迁移动画师实例</a><span>, 在 §4.4</span>
        <li><a href="#dom-animationworkletglobalscope-registeranimator">注册动画师 (registerAnimator)</a><span>, 在
                §3.4</span>
        <li><a href="#remove-an-animator-instance">移除动画师实例</a><span>, 在 §4.3</span>
        <li><a href="#run-animators">运行动画师</a><span>, 在 §4.2</span>
        <li><a href="#serialized-options">序列化选项</a><span>, 在 §5.1</span>
        <li><a href="#set-animator-instance-of-worklet-animation">设置动画师实例</a><span>, 在 §5.4</span>
        <li><a href="#dom-statefulanimator-state">状态函数 (state())</a><span>, 在 §3.2</span>
        <li><a href="#statefulanimator">有状态动画师</a><span>, 在 §3.2</span>
        <li><a href="#dom-statefulanimator-statefulanimator">有状态动画师构造函数 (StatefulAnimator())</a><span>, 在 §3.2</span>
        <li><a href="#stateful-animator-instance">有状态动画师实例</a><span>, 在 §4</span>
        <li><a href="#dom-statefulanimator-statefulanimator">有状态动画师构造函数 (StatefulAnimator(options))</a><span>, 在
                §3.2</span>
        <li><a href="#dom-statefulanimator-statefulanimator">有状态动画师构造函数 (StatefulAnimator(options, state))</a><span>, 在
                §3.2</span>
        <li><a href="#stateful-flag">有状态标志</a><span>, 在 §3.3</span>
        <li><a href="#dom-statelessanimator-statelessanimator">无状态动画师构造函数 (StatelessAnimator())</a><span>, 在 §3.1</span>
        <li><a href="#statelessanimator">无状态动画师</a><span>, 在 §3.1</span>
        <li><a href="#dom-statelessanimator-statelessanimator">无状态动画师构造函数 (StatelessAnimator(options))</a><span>, 在
                §3.1</span>
        <li><a href="#worklet-animation">工作单元动画</a><span>, 在 §5.1</span>
        <li><a href="#workletanimation">工作单元动画 (WorkletAnimation)</a><span>, 在 §5.2</span>
        <li><a href="#dom-workletanimation-workletanimation">工作单元动画构造函数 (WorkletAnimation(animatorName, effects,
                timeline, options))</a><span>, 在 §5.2</span>
        <li><a href="#workletgroupeffect">工作单元组效果</a><span>, 在 §5.6</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-transition-start-time">
        <a
            href="https://www.w3.org/TR/css3-transitions/#transition-start-time">https://www.w3.org/TR/css3-transitions/#transition-start-time</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-transition-start-time">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-typedef-ident">
        <a
            href="https://www.w3.org/TR/css-values-4/#typedef-ident">https://www.w3.org/TR/css-values-4/#typedef-ident</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-typedef-ident">3.3. Animator Definition</a>
            <li><a href="#ref-for-typedef-ident①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-namespacedef-css">
        <a
            href="https://drafts.csswg.org/cssom-1/#namespacedef-css">https://drafts.csswg.org/cssom-1/#namespacedef-css</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-namespacedef-css">2. Animation Worklet</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-document">
        <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-document">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-window">
        <a
            href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-window">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-current-global-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-current-global-object">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue-a-task">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-queue-a-task">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-queue-a-task①">(2)</a>
            <li><a href="#ref-for-queue-a-task②">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-queue-a-task③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list">
        <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-list">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct">
        <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-struct">3.3. Animator Definition</a>
            <li><a href="#ref-for-struct①">4. Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animation">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animation">https://www.w3.org/TR/web-animations-1/#animation</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animation">1.1. Relationship to the Web Animations API</a>
            <li><a href="#ref-for-animation①">5.1. Worklet Animation</a>
            <li><a href="#ref-for-animation②">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animationeffect">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animationeffect">https://www.w3.org/TR/web-animations-1/#animationeffect</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animationeffect">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-animationeffect①">(2)</a> <a href="#ref-for-animationeffect②">(3)</a> <a
                    href="#ref-for-animationeffect③">(4)</a>
            <li><a href="#ref-for-animationeffect④">5.6. WorkletGroupEffect</a> <a
                    href="#ref-for-animationeffect⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animationtimeline">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animationtimeline">https://www.w3.org/TR/web-animations-1/#animationtimeline</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animationtimeline">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-animation-finish">
        <a
            href="https://www.w3.org/TR/web-animations-1/#dom-animation-finish">https://www.w3.org/TR/web-animations-1/#dom-animation-finish</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animation-finish">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-animationeffect-getcomputedtiming">
        <a
            href="https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming">https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationeffect-getcomputedtiming">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-idl-DOMString①">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-idl-DOMString②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">2. Animation Worklet</a>
            <li><a href="#ref-for-Exposed①">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-Exposed②">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-Exposed③">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-Exposed④">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-Exposed⑤">5.6. WorkletGroupEffect</a> <a href="#ref-for-Exposed⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Global">
        <a href="https://heycam.github.io/webidl/#Global">https://heycam.github.io/webidl/#Global</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Global">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-Global①">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-Global②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-SameObject">
        <a href="https://heycam.github.io/webidl/#SameObject">https://heycam.github.io/webidl/#SameObject</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-SameObject">2. Animation Worklet</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-callback-function">
        <a
            href="https://heycam.github.io/webidl/#dfn-callback-function">https://heycam.github.io/webidl/#dfn-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-callback-function">3.3. Animator Definition</a> <a
                    href="#ref-for-dfn-callback-function①">(2)</a>
            <li><a href="#ref-for-dfn-callback-function②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-double">
        <a href="https://heycam.github.io/webidl/#idl-double">https://heycam.github.io/webidl/#idl-double</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-double">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-worklet">
        <a href="https://www.w3.org/TR/worklets-1/#worklet">https://www.w3.org/TR/worklets-1/#worklet</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-worklet">2. Animation Worklet</a> <a href="#ref-for-worklet①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-workletglobalscope">
        <a
            href="https://www.w3.org/TR/worklets-1/#workletglobalscope">https://www.w3.org/TR/worklets-1/#workletglobalscope</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-workletglobalscope">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-workletglobalscope①">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-workletglobalscope②">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-workletglobalscope③">(2)</a>
            <li><a href="#ref-for-workletglobalscope④">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-worklet-global-scope-type">
        <a
            href="https://www.w3.org/TR/worklets-1/#worklet-global-scope-type">https://www.w3.org/TR/worklets-1/#worklet-global-scope-type</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-worklet-global-scope-type">2. Animation Worklet</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">其他文档定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[css-transitions-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-transition-start-time" style="color:initial">开始时间</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-values-4]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-typedef-ident" style="color:initial">&lt;标识符></span>
            </ul>
        <li>
            <a data-link-type="biblio">[cssom-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-namespacedef-css" style="color:initial">CSS</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-document" style="color:initial">文档 (Document)</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-window" style="color:initial">窗口 (Window)</span>
                <li><span class="dfn-paneled" id="term-for-current-global-object" style="color:initial">当前全局对象</span>
                <li><span class="dfn-paneled" id="term-for-queue-a-task" style="color:initial">队列任务</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-list" style="color:initial">列表</span>
                <li><span class="dfn-paneled" id="term-for-struct" style="color:initial">结构体</span>
            </ul>
        <li>
            <a data-link-type="biblio">[web-animations-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-animation" style="color:initial">动画</span>
                <li><span class="dfn-paneled" id="term-for-animationeffect" style="color:initial">动画效果</span>
                <li><span class="dfn-paneled" id="term-for-animationtimeline" style="color:initial">动画时间轴</span>
                <li><span class="dfn-paneled" id="term-for-dom-animation-finish" style="color:initial">完成
                        (finish())</span>
                <li><span class="dfn-paneled" id="term-for-dom-animationeffect-getcomputedtiming"
                        style="color:initial">获取计算时间 (getComputedTiming())</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WebIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString" style="color:initial">DOM字符串
                        (DOMString)</span>
                <li><span class="dfn-paneled" id="term-for-Exposed" style="color:initial">公开 (Exposed)</span>
                <li><span class="dfn-paneled" id="term-for-Global" style="color:initial">全局 (Global)</span>
                <li><span class="dfn-paneled" id="term-for-SameObject" style="color:initial">同一对象 (SameObject)</span>
                <li><span class="dfn-paneled" id="term-for-dfn-callback-function" style="color:initial">回调函数 (callback
                        function)</span>
                <li><span class="dfn-paneled" id="term-for-idl-double" style="color:initial">双精度 (double)</span>
            </ul>
        <li>
            <a data-link-type="biblio">[worklets-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-worklet" style="color:initial">工作单元 (Worklet)</span>
                <li><span class="dfn-paneled" id="term-for-workletglobalscope" style="color:initial">工作单元全局范围</span>
                <li><span class="dfn-paneled" id="term-for-worklet-global-scope-type"
                        style="color:initial">工作单元全局范围类型</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-transitions-1">[CSS-TRANSITIONS-1]
        <dd>David Baron等人. <a href="https://www.w3.org/TR/css-transitions-1/">CSS 过渡效果</a>. 2018年10月11日.
            WD. URL: <a href="https://www.w3.org/TR/css-transitions-1/">https://www.w3.org/TR/css-transitions-1/</a>
        <dt id="biblio-css-values-4">[CSS-VALUES-4]
        <dd>Tab Atkins Jr. 和 Elika Etemad. <a href="https://www.w3.org/TR/css-values-4/">CSS 值与单位模块 4</a>. 2019年1月31日.
            WD. URL: <a href="https://www.w3.org/TR/css-values-4/">https://www.w3.org/TR/css-values-4/</a>
        <dt id="biblio-cssom-1">[CSSOM-1]
        <dd>Simon Pieters 和 Glenn Adams. <a href="https://www.w3.org/TR/cssom-1/">CSS 对象模型 (CSSOM)</a>. 2016年3月17日.
            WD. URL: <a href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM 标准</a>. 现行标准. URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren等人. <a href="https://html.spec.whatwg.org/multipage/">HTML 标准</a>. 现行标准.
            URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren 和 Domenic Denicola. <a href="https://infra.spec.whatwg.org/">基础标准 (Infra)</a>. 现行标准.
            URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">用于指示要求级别的关键字</a>. 1997年3月. 最佳当前实践. URL: <a
                href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
        <dt id="biblio-web-animations-1">[WEB-ANIMATIONS-1]
        <dd>Brian Birtles等人. <a href="https://www.w3.org/TR/web-animations-1/">Web 动画</a>. 2018年10月11日.
            WD. URL: <a href="https://www.w3.org/TR/web-animations-1/">https://www.w3.org/TR/web-animations-1/</a>
        <dt id="biblio-webidl">[WebIDL]
        <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 2016年12月15日. ED. URL: <a
                href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
        <dt id="biblio-worklets-1">[WORKLETS-1]
        <dd>Ian Kilpatrick. <a href="https://www.w3.org/TR/worklets-1/">工作单元 第1级</a>. 2016年6月7日. WD. URL: <a
                href="https://www.w3.org/TR/worklets-1/">https://www.w3.org/TR/worklets-1/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">信息性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-explainer">[EXPLAINER]
        <dd><a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md">动画工作单元解释器</a>.
            URL: <a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md</a>
        <dt id="biblio-principles">[PRINCIPLES]
        <dd><a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md">动画工作单元设计原则与目标</a>.
            URL: <a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑦"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css①"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject①"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet①①"><c- n>Worklet</c-></a> <a data-readonly data-type="Worklet" href="#dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global③"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>, <a href="#dom-statelessanimator-statelessanimator"><code><c- g>Constructor</c-></code></a> (<c- b>optional</c-> <c- b>any</c-> <a href="#dom-statelessanimator-statelessanimator-options-options"><code><c- g>options</c-></code></a>)]
<c- b>interface</c-> <a href="#statelessanimator"><code><c- g>StatelessAnimator</c-></code></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>,
<a href="#dom-statefulanimator-statefulanimator"><code><c- g>Constructor</c-></code></a> (<c- b>optional</c-> <c- b>any</c-> <a href="#dom-statefulanimator-statefulanimator-options-state-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <c- b>any</c-> <a href="#dom-statefulanimator-statefulanimator-options-state-state"><code><c- g>state</c-></code></a>)]
<c- b>interface</c-> <a href="#statefulanimator"><code><c- g>StatefulAnimator</c-></code></a> {
  <c- b>any</c-> <a href="#dom-statefulanimator-state"><code><c- g>state</c-></code></a>();
};

[ <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global②①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a> ]
<c- b>interface</c-> <a href="#animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope①①"><c- n>WorkletGlobalScope</c-></a> {
    <c- b>void</c-> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator①①"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code></a>, <a class="n" data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor①①"><c- n>AnimatorInstanceConstructor</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code></a>);
};

<c- b>callback</c-> <a href="#callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></a> = <c- b>any</c-> (<c- b>any</c-> <a href="#dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <c- b>any</c-> <a href="#dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code></a>);


[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④①"><c- g>Exposed</c-></a>=<c- n>Window</c->,
 <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation" id="ref-for-dom-workletanimation-workletanimation①"><c- g>Constructor</c-></a> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①①"><c- b>DOMString</c-></a> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code></a>,
              <c- b>optional</c-> (<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑥"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect①①"><c- n>AnimationEffect</c-></a>>)? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code></a> = <c- b>null</c->,
              <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationtimeline" id="ref-for-animationtimeline①"><c- n>AnimationTimeline</c-></a>? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code></a>,
              <c- b>optional</c-> <c- b>any</c-> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code></a>)]
<c- b>interface</c-> <a href="#workletanimation"><code><c- g>WorkletAnimation</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation②①"><c- n>Animation</c-></a> {
        <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②①"><c- b>DOMString</c-></a> <a data-readonly data-type="DOMString" href="#dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code></a>;
};


[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <a href="#workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></a> {
  <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect④①"><c- n>AnimationEffect</c-></a>> <a href="#dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code></a>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑤①"><c- g>AnimationEffect</c-></a> {
    // Intended for use inside Animation Worklet scope to drive the effect.
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a> <a data-type="double" href="#dom-animationeffect-localtime"><code><c- g>localTime</c-></code></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 考虑赋予用户代理跳过执行动画实例的权限，以限制慢速动画的节奏。<a href="#issue-6d334361"> ↵ </a></div>
        <div class="issue"> 应明确规定当 animateFunction 抛出异常时的处理方式。至少，我们应说明忽略关键帧的 localTime 值以避免不正确的部分更新。<a
                href="#issue-84eae255"> ↵ </a></div>
        <div class="issue"> 为 <a data-link-type="dfn" href="#animator-instance">animator instance</a> 提供适当的机制，以便在动画的
            currentTime 改变时（如通过 reverse()、finish() 或 playbackRate 改变）能够收到通知，并做出相应反应。<a
                href="https://github.com/w3c/css-houdini-drafts/issues/811">&lt;https://github.com/w3c/css-houdini-drafts/issues/811></a><a
                href="#issue-61e3a71a"> ↵ </a></div>
        <div class="issue"> 上述接口暴露的是 web-animation-2 中提议的 GroupEffect 的保守子集。我们应该将其移动到针对 web-animation 的增量规范中。<a
                href="https://github.com/w3c/csswg-drafts/issues/2071">&lt;https://github.com/w3c/csswg-drafts/issues/2071></a><a
                href="#issue-9ff2b6cb"> ↵ </a></div>
    </div>
    <aside class="dfn-panel" data-for="animation-worklet">
        <b><a href="#animation-worklet">#animation-worklet</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-worklet">1. Introduction</a>
            <li><a href="#ref-for-animation-worklet①">1.1. Relationship to the Web Animations API</a>
            <li><a href="#ref-for-animation-worklet②">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-css-animationworklet">
        <b><a href="#dom-css-animationworklet">#dom-css-animationworklet</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-css-animationworklet">2. Animation Worklet</a> <a
                    href="#ref-for-dom-css-animationworklet①">(2)</a> <a
                    href="#ref-for-dom-css-animationworklet②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator">
        <b><a href="#animator">#animator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator">3. Animator</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="statelessanimator">
        <b><a href="#statelessanimator">#statelessanimator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-statelessanimator">3. Animator</a>
            <li><a href="#ref-for-statelessanimator①">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-statelessanimator②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="statefulanimator">
        <b><a href="#statefulanimator">#statefulanimator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-statefulanimator">3. Animator</a>
            <li><a href="#ref-for-statefulanimator①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-statefulanimator-state">
        <b><a href="#dom-statefulanimator-state">#dom-statefulanimator-state</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-statefulanimator-state">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-definition">
        <b><a href="#animator-definition">#animator-definition</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-definition">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animator-definition①">4. Animator Instance</a> <a
                    href="#ref-for-animator-definition②">(2)</a>
            <li><a href="#ref-for-animator-definition③">5.1. Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-name">
        <b><a href="#animator-name">#animator-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-name">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animator-name①">4. Animator Instance</a>
            <li><a href="#ref-for-animator-name②">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-name③">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-name④">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-animator-name⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="class-constructor">
        <b><a href="#class-constructor">#class-constructor</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-class-constructor">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-class-constructor①">4.1. Creating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animate-function">
        <b><a href="#animate-function">#animate-function</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animate-function">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animate-function①">4.2. Running Animators</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="stateful-flag">
        <b><a href="#stateful-flag">#stateful-flag</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-stateful-flag">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-stateful-flag①">4. Animator Instance</a>
            <li><a href="#ref-for-stateful-flag②">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-name-to-animator-definition-map">
        <b><a
                href="#animator-name-to-animator-definition-map">#animator-name-to-animator-definition-map</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animator-name-to-animator-definition-map">3.4. Registering an Animator Definition</a>
                <a href="#ref-for-animator-name-to-animator-definition-map①">(2)</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map②">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map③">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map④">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animationworkletglobalscope">
        <b><a href="#animationworkletglobalscope">#animationworkletglobalscope</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animationworkletglobalscope">2. Animation Worklet</a> <a
                    href="#ref-for-animationworkletglobalscope①">(2)</a>
            <li><a href="#ref-for-animationworkletglobalscope②">3. Animator</a>
            <li><a href="#ref-for-animationworkletglobalscope③">3.3. Animator Definition</a>
            <li><a href="#ref-for-animationworkletglobalscope④">3.4. Registering an Animator Definition</a> <a
                    href="#ref-for-animationworkletglobalscope⑤">(2)</a>
            <li><a href="#ref-for-animationworkletglobalscope⑥">4. Animator Instance</a>
            <li><a href="#ref-for-animationworkletglobalscope⑦">4.1. Creating an Animator Instance</a> <a
                    href="#ref-for-animationworkletglobalscope⑧">(2)</a> <a
                    href="#ref-for-animationworkletglobalscope⑨">(3)</a>
            <li><a href="#ref-for-animationworkletglobalscope①⓪">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-animationworkletglobalscope①①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="callbackdef-animatorinstanceconstructor">
        <b><a
                href="#callbackdef-animatorinstanceconstructor">#callbackdef-animatorinstanceconstructor</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-callbackdef-animatorinstanceconstructor">3.3. Animator Definition</a>
            <li><a href="#ref-for-callbackdef-animatorinstanceconstructor①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-animationworkletglobalscope-registeranimator">
        <b><a
                href="#dom-animationworkletglobalscope-registeranimator">#dom-animationworkletglobalscope-registeranimator</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator">3.4. Registering an Animator
                    Definition</a> <a href="#ref-for-dom-animationworkletglobalscope-registeranimator①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-instance">
        <b><a href="#animator-instance">#animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-instance">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-animator-instance①">4. Animator Instance</a>
            <li><a href="#ref-for-animator-instance②">4.1. Creating an Animator Instance</a> <a
                    href="#ref-for-animator-instance③">(2)</a> <a href="#ref-for-animator-instance④">(3)</a>
            <li><a href="#ref-for-animator-instance⑤">4.2. Running Animators</a> <a
                    href="#ref-for-animator-instance⑥">(2)</a>
            <li><a href="#ref-for-animator-instance⑦">4.5. Requesting Animation Frames</a>
            <li><a href="#ref-for-animator-instance⑧">5.1. Worklet Animation</a> <a
                    href="#ref-for-animator-instance⑨">(2)</a> <a href="#ref-for-animator-instance①⓪">(3)</a>
            <li><a href="#ref-for-animator-instance①①">5.3. Worklet Animation timing model</a> <a
                    href="#ref-for-animator-instance①②">(2)</a> <a href="#ref-for-animator-instance①③">(3)</a> <a
                    href="#ref-for-animator-instance①④">(4)</a>
            <li><a href="#ref-for-animator-instance①⑤">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-animator-instance①⑥">(2)</a> <a href="#ref-for-animator-instance①⑦">(3)</a> <a
                    href="#ref-for-animator-instance①⑧">(4)</a> <a href="#ref-for-animator-instance①⑨">(5)</a> <a
                    href="#ref-for-animator-instance②⓪">(6)</a> <a href="#ref-for-animator-instance②①">(7)</a> <a
                    href="#ref-for-animator-instance②②">(8)</a>
            <li><a href="#ref-for-animator-instance②③">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-effect">
        <b><a href="#animator-effect">#animator-effect</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-effect">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-effect①">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-effect②">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-current-time">
        <b><a href="#animator-current-time">#animator-current-time</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-current-time">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-current-time①">4.2. Running Animators</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-timeline">
        <b><a href="#animator-timeline">#animator-timeline</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-timeline">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-timeline①">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-serialized-options">
        <b><a href="#animator-serialized-options">#animator-serialized-options</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-serialized-options">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-serialized-options①">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="stateful-animator-instance">
        <b><a href="#stateful-animator-instance">#stateful-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-stateful-animator-instance">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-instance-set">
        <b><a href="#animator-instance-set">#animator-instance-set</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-instance-set">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-instance-set①">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-instance-set②">4.3. Removing an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="create-a-new-animator-instance">
        <b><a href="#create-a-new-animator-instance">#create-a-new-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-create-a-new-animator-instance">4.4. Migrating an Animator Instance</a>
            <li><a href="#ref-for-create-a-new-animator-instance①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="run-animators">
        <b><a href="#run-animators">#run-animators</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-run-animators">4.2. Running Animators</a> <a href="#ref-for-run-animators①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="remove-an-animator-instance">
        <b><a href="#remove-an-animator-instance">#remove-an-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-remove-an-animator-instance">4.4. Migrating an Animator Instance</a>
            <li><a href="#ref-for-remove-an-animator-instance①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="migrate-an-animator-instance">
        <b><a href="#migrate-an-animator-instance">#migrate-an-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-migrate-an-animator-instance">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animation-requested-flag">
        <b><a href="#animation-requested-flag">#animation-requested-flag</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-requested-flag">4. Animator Instance</a>
            <li><a href="#ref-for-animation-requested-flag①">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animation-requested-flag②">4.2. Running Animators</a> <a
                    href="#ref-for-animation-requested-flag③">(2)</a>
            <li><a href="#ref-for-animation-requested-flag④">4.5. Requesting Animation Frames</a> <a
                    href="#ref-for-animation-requested-flag⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="frame-requested">
        <b><a href="#frame-requested">#frame-requested</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-frame-requested">4.2. Running Animators</a>
            <li><a href="#ref-for-frame-requested①">4.5. Requesting Animation Frames</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="frame-current">
        <b><a href="#frame-current">#frame-current</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-frame-current">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-frame-current①">4.2. Running Animators</a>
            <li><a href="#ref-for-frame-current②">4.5. Requesting Animation Frames</a> <a
                    href="#ref-for-frame-current③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="worklet-animation">
        <b><a href="#worklet-animation">#worklet-animation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-worklet-animation">4. Animator Instance</a>
            <li><a href="#ref-for-worklet-animation①">4.5. Requesting Animation Frames</a>
            <li><a href="#ref-for-worklet-animation②">5.1. Worklet Animation</a> <a
                    href="#ref-for-worklet-animation③">(2)</a>
            <li><a href="#ref-for-worklet-animation④">5.3. Worklet Animation timing model</a> <a
                    href="#ref-for-worklet-animation⑤">(2)</a> <a href="#ref-for-worklet-animation⑥">(3)</a> <a
                    href="#ref-for-worklet-animation⑦">(4)</a> <a href="#ref-for-worklet-animation⑧">(5)</a> <a
                    href="#ref-for-worklet-animation⑨">(6)</a>
            <li><a href="#ref-for-worklet-animation①⓪">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-worklet-animation①①">(2)</a>
            <li><a href="#ref-for-worklet-animation①②">5.5. ScrollTimeline</a>
            <li><a href="#ref-for-worklet-animation①③">5.7. Effect Stack and Composite Order</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animation-animator-name">
        <b><a href="#animation-animator-name">#animation-animator-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-animator-name">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-animation-animator-name①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="serialized-options">
        <b><a href="#serialized-options">#serialized-options</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-serialized-options">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-serialized-options①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="workletanimation">
        <b><a href="#workletanimation">#workletanimation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-workletanimation">3. Animator</a> <a href="#ref-for-workletanimation①">(2)</a>
            <li><a href="#ref-for-workletanimation②">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-workletanimation③">(2)</a>
            <li><a href="#ref-for-workletanimation④">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-workletanimation-workletanimation">
        <b><a href="#dom-workletanimation-workletanimation">#dom-workletanimation-workletanimation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-workletanimation-workletanimation">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="associate-animator-instance-of-worklet-animation">
        <b><a
                href="#associate-animator-instance-of-worklet-animation">#associate-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-associate-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-associate-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="disassociate-animator-instance-of-worklet-animation">
        <b><a
                href="#disassociate-animator-instance-of-worklet-animation">#disassociate-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-disassociate-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-disassociate-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="set-animator-instance-of-worklet-animation">
        <b><a
                href="#set-animator-instance-of-worklet-animation">#set-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-set-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-set-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="workletgroupeffect">
        <b><a href="#workletgroupeffect">#workletgroupeffect</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-workletgroupeffect">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-workletgroupeffect①">5.6. WorkletGroupEffect</a> <a
                    href="#ref-for-workletgroupeffect②">(2)</a> <a href="#ref-for-workletgroupeffect③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-animationeffect-localtime">
        <b><a href="#dom-animationeffect-localtime">#dom-animationeffect-localtime</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationeffect-localtime">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>

    <p role="navigation" id="back-to-top"><a href="#toc"><abbr title="回到顶部">↑</abbr></a></p>

    <script>/* script-var-click-highlighting */

        document.addEventListener("click", e => {
            if (e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        {
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s| )+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script src="/dropdown.js"></script>