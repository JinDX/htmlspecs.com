<!doctype html>
<html lang="en">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>Web User Agents</title>
    <meta content="NOTE-WD" name="w3c-status">
    <meta content="Bikeshed version 3c53a5b02, updated Thu Nov 27 17:03:30 2025 +0000" name="generator">
    <link href="https://www.w3.org/TR/web-user-agents/" rel="canonical">
    <meta content="7e26abff8841b8a6640b4f5caa52d935ac68152a" name="revision">
    <meta content="dark light" name="color-scheme">
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example " counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-DNOTE" rel="stylesheet">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
                <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a>
        </p>
        <h1 class="no-ref p-name" id="title">Web User Agents</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#DNOTE">W3C Group Note Draft</a>,
            <time class="dt-updated" datetime="2026-01-20">20 January 2026</time>
        </p>
        <details open>
            <summary>More details about this document</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>This version:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2026/DNOTE-web-user-agents-20260120/">https://www.w3.org/TR/2026/DNOTE-web-user-agents-20260120/</a>
                    <dt>Latest published version:
                    <dd><a href="https://www.w3.org/TR/web-user-agents/">https://www.w3.org/TR/web-user-agents/</a>
                    <dt>Editor's Draft:
                    <dd><a href="https://w3ctag.github.io/user-agents">https://w3ctag.github.io/user-agents</a>
                    <dt>Previous Versions:
                    <dd><a href="https://www.w3.org/TR/2026/DNOTE-web-user-agents-20260113/"
                            rel="prev">https://www.w3.org/TR/2026/DNOTE-web-user-agents-20260113/</a>
                    <dt>History:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/web-user-agents/">https://www.w3.org/standards/history/web-user-agents/</a>
                    <dt>Feedback:
                    <dd><a href="https://github.com/w3ctag/user-agents/issues/">GitHub</a>
                    <dt class="editor">Editors:
                    <dd class="editor h-card p-author vcard" data-editor-id="72192"><a class="email fn p-name u-email"
                            href="mailto:jyasskin@google.com">Jeffrey Yasskin</a> (<a class="org p-org"
                            href="https://google.com">Google</a>)
                    <dd class="editor h-card p-author vcard" data-editor-id="46140"><a class="fn p-name u-url url"
                            href="https://csarven.ca/">Sarven Capadisli</a> (<span class="org p-org">Invited
                            Expert</span>)
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2026 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr
                title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a
                href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/copyright/software-license/" rel="license"
                title="W3C Software and Document License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
        <p>Web user agents include both web browsers and other intermediaries
            between end-users and the web.
            Each user agent serves its user,
            not any of the other constituencies.
            A user agent owes its user various duties,
            which should be established through collective discussions
            and embodied in the various standards that user agents implement.</p>
    </div>
    <h2 class="heading no-num no-ref no-toc settled" id="sotd"><span class="content">Status of this document</span></h2>
    <div data-fill-with="status">
        <p>
            <em>This section describes the status of this document at the time of its
                publication. A list of current
                <abbr title="World Wide Web Consortium">W3C</abbr> publications and the
                latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr
                        title="World Wide Web
    Consortium">W3C</abbr> standards and drafts index</a>.</em>
        </p>
        <p>
            This document was published by the <a href="https://www.w3.org/groups/other/tag/">Technical Architecture
                Group</a>
            as a Group Note Draft using the Note track.
            This is a draft document and
            may be updated, replaced, or obsoleted by other documents at any time.
            It is inappropriate to cite this document as other than a work in progress.
            Group Note Drafts are not endorsed by <abbr title="World Wide Web
    Consortium">W3C</abbr> nor its Members.
        </p>
        <p></p>
        <p>
            Feedback and comments on this document are welcome. Please
            <a href="https://github.com/w3ctag/user-agents/issues">file an issue</a>
            in this document’s
            <a href="https://github.com/w3ctag/user-agents/">GitHub repository</a>.
        </p>
        <p data-deliverer="34270">
            The <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World
    Wide Web Consortium">W3C</abbr> Patent Policy</a> does not carry any
            licensing requirements or commitments on this document.
        </p>
        <p>
            This document is governed by the <a href="https://www.w3.org/policies/process/20250818/"
                id="w3c_process_revision">18 August 2025 W3C
                Process Document</a>.
        </p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
        <ol class="toc">
            <li><a href="#audience"><span class="secno">1</span> <span class="content">Audience</span></a>
            <li>
                <a href="#what"><span class="secno">2</span> <span class="content">What is a web user agent</span></a>
                <ol class="toc">
                    <li><a href="#ua-as-software"><span class="secno">2.1</span> <span class="content">User agents as
                                software components</span></a>
                </ol>
            <li>
                <a href="#duties"><span class="secno">3</span> <span class="content">Duties of user agents</span></a>
                <ol class="toc">
                    <li><a href="#protection"><span class="secno">3.1</span> <span class="content">Protection</span></a>
                    <li><a href="#honesty"><span class="secno">3.2</span> <span class="content">Honesty</span></a>
                    <li><a href="#loyalty"><span class="secno">3.3</span> <span class="content">Loyalty</span></a>
                </ol>
            <li><a href="#acknowledgements"><span class="secno">4</span> <span
                        class="content">Acknowledgements</span></a>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by
                                this specification</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms
                                defined by reference</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">Normative
                                References</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">Informative
                                References</span></a>
                </ol>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="audience"><span class="secno">1. </span><span
                class="content">Audience</span><a class="self-link" href="#audience"></a></h2>
        <p>This document is intended for:</p>
        <ul>
            <li data-md>
                <p><strong>Technical authors</strong> who want to reuse or reference these concepts in their own
                    specifications or documentation.</p>
            <li data-md>
                <p><strong>User agent developers</strong> who want to align implementations with design and privacy
                    principles that prioritize their users.</p>
            <li data-md>
                <p><strong>Web developers</strong> who want to understand why user agents prioritize user privacy and
                    security over other constituencies, including developer convenience.</p>
            <li data-md>
                <p><strong>Regulators and policymakers</strong> who seek to understand the duties, principles, and
                    expectations guiding user agent behavior.</p>
        </ul>
        <h2 class="heading settled" data-level="2" id="what"><span class="secno">2. </span><span class="content">What is
                a web user agent</span><a class="self-link" href="#what"></a></h2>
        <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="general user agent" data-noexport
                id="general-user-agent">user agent</dfn>, in general, is any software entity
            that interacts with other entities on behalf of its user.
            User agents include many operating systems; email clients; PDF, ebook, and image viewers;
            <a data-link-type="dfn" href="https://www.w3.org/TR/credential-management-1/#credential-manager"
                id="ref-for-credential-manager">credential managers</a>, including digital wallets; and many other kinds
            of software.
        </p>
        <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="user agent|web user agent" data-noexport
                id="user-agent">web user agent</dfn> is
            any software entity that interacts with websites outside the entity itself,
            on behalf of its user,
            including simply rendering the content of websites.
            In web specifications and the rest of this document,
            web user agents are usually referred to as just "<a data-link-type="dfn" href="#user-agent"
                id="ref-for-user-agent">user agents</a>".
            Either fully-qualified term can be used
            if there’s a chance of confusion.
            A person can use many different user agents in their day-to-day life.</p>
        <p>The most common type of web user agent is the web browser,
            including in-app browsers that can follow cross-site links.
            However, user agents also include other tools like
            search engines, voice-driven assistants, and generative AI systems
            that present snippets or summaries of website content,
            or help people navigate and interact with websites.</p>
        <p>User agent behavior is not completely defined by web standards
            or even by technical specifications in general.
            In particular,
            user agents choose which specifications to implement in order to best serve their users,
            and they implement proprietary user interfaces and other behavior
            around the specifications they do implement.</p>
        <h3 class="heading settled" data-level="2.1" id="ua-as-software"><span class="secno">2.1. </span><span
                class="content">User agents as software components</span><a class="self-link"
                href="#ua-as-software"></a></h3>
        <p>As software components, user agents can be parts of larger applications
            and can call libraries that implement the web platform or parts of it.</p>
        <p>When an application makes a clear distinction
            between its pieces that are <a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent①">user
                agents</a> and its pieces that aren’t,
            then only the <a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent②">user agent</a> parts,
            which browse content from outside the user agent itself,
            need to follow the <a data-link-type="dfn" href="#user-agent-duties" id="ref-for-user-agent-duties">user
                agent duties</a>.
            Parts that are clearly only showing the application’s own content
            can act on their own behalf,
            but the application should still
            give its users clear expectations about
            what behavior they should expect from different parts of the application.
            If the distinction between internal and external content is too small—for example
            if the application doesn’t show an address bar
            or another indicator of content origin
            when browsing external content—then
            the application should also follow the <a data-link-type="dfn" href="#user-agent-duties"
                id="ref-for-user-agent-duties①">user agent duties</a>
            when showing its own content.</p>
        <p>Similarly a library that implements the web platform
            may or may not be a full <a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent③">user agent</a>.
            Some, like <a
                href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller"><code>SFSafariViewController</code></a>
            and <a href="https://developer.chrome.com/docs/android/custom-tabs">Android Custom Tabs</a>
            take on the responsibility of implementing the <a data-link-type="dfn" href="#user-agent-duties"
                id="ref-for-user-agent-duties②">user agent duties</a>
            and of clearly distinguishing between the external content they browse
            and the content controlled by the embedding application.
            These libraries are <a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent④">user agents</a>.</p>
        <p>Other libraries, like the
            <a href="https://developer.android.com/reference/android/webkit/WebView">Android</a>,
            <a href="https://developer.apple.com/documentation/webkit/wkwebview">iOS</a>,
            and <a href="https://developer.microsoft.com/en-us/Microsoft-edge/webview2/">Windows</a>
            WebView libraries,
            are designed to support many kinds of applications.
            Because some of these applications include only their own content,
            WebView libraries are not meant to be <a data-link-type="dfn" href="#user-agent"
                id="ref-for-user-agent⑤">user agents</a> on their own,
            and they do not implement the <a data-link-type="dfn" href="#user-agent-duties"
                id="ref-for-user-agent-duties③">user agent duties</a>.
        </p>
        <p>Ultimately, an embedding application is responsible for
            following the <a data-link-type="dfn" href="#user-agent-duties" id="ref-for-user-agent-duties④">user agent
                duties</a>
            if it, or any part of it, acts as a <a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent⑥">user
                agent</a>.
            This can be straightforward if the application only browses external content through a <a
                data-link-type="dfn" href="#user-agent" id="ref-for-user-agent⑦">user agent</a> library.
            Developers need to take extra care
            to follow the <a data-link-type="dfn" href="#user-agent-duties" id="ref-for-user-agent-duties⑤">user agent
                duties</a>
            when using a non-<a data-link-type="dfn" href="#user-agent" id="ref-for-user-agent⑧">user agent</a> WebView
            to implement an in-app browser .</p>
        <h2 class="heading settled" data-level="3" id="duties"><span class="secno">3. </span><span
                class="content">Duties of user agents</span><a class="self-link" href="#duties"></a></h2>
        <p>Each user agent serves its user (<a data-biblio-display="inline" data-link-type="biblio"
                href="https://www.rfc-editor.org/rfc/rfc8890"><cite>The Internet is for End Users</cite></a>),
            not any of the other constituencies.
            A user agent owes its user various
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="user agent duties|UA duties" data-noexport
                id="user-agent-duties">duties</dfn>,
            which should be established through collective discussions
            and embodied in the various standards that user agents implement.
        </p>
        <h3 class="heading settled" data-level="3.1" id="protection"><span class="secno">3.1. </span><span
                class="content">Protection</span><a class="self-link" href="#protection"></a></h3>
        <p><a href="https://www.w3.org/TR/design-principles/#safe-to-browse">It should be safe to visit a web page.</a>
            Visiting a page must not by itself
            let the page change the user’s computer or environment,
            such as by installing software or accessing hardware.</p>
        <p>Any data revealed to sites or other observers
            should be aligned with the user’s preferences
            and follow the principle of <a href="https://www.w3.org/TR/design-principles/#data-minimization">data
                minimization</a>.
            In particular, user agents must act to
            limit the potential for sites to track user activity <a data-link-type="biblio"
                href="#biblio-unsanctioned-tracking" title="Unsanctioned Web Tracking">[unsanctioned-tracking]</a>.</p>
        <p>Users may <a href="https://www.w3.org/TR/privacy-principles/#dfn-opt-in">choose to share more
                information</a>,
            such as by filling out forms or granting permissions.
            Even then, user agents must help users avoid deception and
            clearly signal when a page attempts to gain elevated access.</p>
        <p>Access to local files or other sensitive resources
            must be limited to clear, intentional user actions, with appropriate warnings.</p>
        <div class="example no-marker" id="example-protection-exploits">
            <a class="self-link" href="#example-protection-exploits"></a>
            <div class="marker">EXAMPLE: Attacks</div>
            <p>User agents need to prevent malicious code on a site from
                being able to escape the user agent
                to modify the user’s computer or access other <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                    id="ref-for-concept-origin">origins</a>.
                User agents meet this duty of protection by sandboxing components,
                using memory-safe languages,
                and employing security teams to find and respond to vulnerabilities.
                These defenses need to evolve continuously to address new threats.</p>
        </div>
        <div class="example no-marker" id="example-protection-tracking">
            <a class="self-link" href="#example-protection-tracking"></a>
            <div class="marker">EXAMPLE: Tracking</div>
            <p>If a person visits unrelated websites,
                it’s feasible to avoid sending a shared identifying cookie to embedded iframes.
                A browser that does send such a cookie is failing its duty of protection.
                However, revealing a stable IP address is currently unavoidable,
                so it’s not a violation.</p>
        </div>
        <div class="example no-marker" id="example-protection-local-files">
            <a class="self-link" href="#example-protection-local-files"></a>
            <div class="marker">EXAMPLE: Local Files</div>
            <p>User agents are expected to prevent pages from accessing local files
                unless the user explicitly selects or opens one.
                This motivates behaviors like:</p>
            <ul>
                <li data-md>
                    <p>giving each <code>file:</code> URL its own <a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin">origin</a>,</p>
                <li data-md>
                    <p>removing path components from
                        <a data-link-type="element-state"
                            href="https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type%3Dfile)"
                            id="ref-for-file-upload-state-(type%3Dfile)"><code>&lt;input type=file></code></a> uploads,
                        and
                    </p>
                <li data-md>
                    <p>restricting which local fonts can be used in <a class="css" data-link-type="at-rule"
                            href="https://www.w3.org/TR/css-fonts-5/#at-font-face-rule"
                            id="ref-for-at-font-face-rule">@font-face</a> rules.</p>
            </ul>
            <p>However, users can still choose to share files,
                e.g., via uploads or downloads.
                APIs like <a data-biblio-display="inline" data-link-type="biblio"
                    href="https://wicg.github.io/file-system-access/"><cite>File System Access</cite></a> don’t violate
                this duty,
                provided users have the tools to <a href="https://www.w3.org/TR/design-principles/#user-decisions">make
                    good decisions</a>.</p>
        </div>
        <h3 class="heading settled" data-level="3.2" id="honesty"><span class="secno">3.2. </span><span
                class="content">Honesty</span><a class="self-link" href="#honesty"></a></h3>
        <p>A user agent must mediate between the Web and its user,
            explaining what is happening in a form the user can understand.</p>
        <p>A user agent may use multiple approaches for explanations, including
            text, permission prompts, indicators, previews, and other interface elements.
            Consider the placement of these elements and whether anything needs emphasis.</p>
        <p>A quintessential example is user agents indicating if a website was served over an encrypted connection.
            This has evolved over time, from insecure sites being shown with a broken lock icon,
            to some user agents explicitly including the text "not secure" in the URL bar.</p>
        <p>Specifications, like the <a data-biblio-display="inline" data-link-type="biblio"
                href="https://www.w3.org/TR/mediacapture-streams/"><cite>Media Capture and Streams</cite></a>, include
            <a href="https://www.w3.org/TR/mediacapture-streams/#privacy-indicator-requirements">Privacy Indicator
                Requirements</a>
            that require user agents to explain some specific kinds of website behavior,
            but user agents should also use the same techniques when users need to know
            about other behavior, even if a specification doesn’t specifically call out that behavior.
        </p>
        <p>An honest user agent actively works to present the truth to its user.
            It doesn’t just avoid lies.
            Its explanations
            should clearly represent the current state and likely consequences,
            avoid euphemism or ambiguity,
            and make it obvious when sensitive activity is occurring.</p>
        <p>The user agent should choose when and how often to show these explanations,
            so explanations arrive when helpful and inform rather than distract.
            The user agent should ensure the user can control if and when they make a decision.</p>
        <h3 class="heading settled" data-level="3.3" id="loyalty"><span class="secno">3.3. </span><span
                class="content">Loyalty</span><a class="self-link" href="#loyalty"></a></h3>
        <p>A user agent must serve its user’s interests
            over its implementer’s interests
            and over the interests of any other party.</p>
        <p>A user agent can be loyal
            while also collecting payment for its services,
            as long as that payment is fair and was agreed ahead of time.</p>
        <p>A user agent can also help its user
            make a credible commitment to a page in order to get that page’s services,
            and it’s not disloyal to maintain that commitment after getting the services.</p>
        <p>A user agent must not obstruct its users from switching to another user agent.
            For example, it must not block access to, export, or store user data in ways that prevent portability.
            This includes identity information, bookmarks, history, passwords, and credentials such as passkeys.
            If the user agent relies on the underlying <abbr title="Operating System">OS</abbr> to store credentials,
            there needs to be a way for users to allow other user agents to access those credentials.</p>
        <section class="non-normative">
            <h2 class="heading settled" data-level="4" id="acknowledgements"><span class="secno">4. </span><span
                    class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
            <p>Thanks to the <a data-biblio-display="inline" data-link-type="biblio"
                    href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>
                for an earlier definition of User Agents
                and to <a data-biblio-display="inline" data-link-type="biblio"
                    href="https://www.w3.org/TR/privacy-principles/"><cite>Privacy Principles</cite></a> for the initial
                version of these duties.</p>
        </section>
    </main>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this
            specification</span><a class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#general-user-agent">general user agent</a><span>, in § 2</span>
        <li><a href="#user-agent-duties">UA duties</a><span>, in § 3</span>
        <li><a href="#user-agent">user agent</a><span>, in § 2</span>
        <li><a href="#user-agent-duties">user agent duties</a><span>, in § 3</span>
        <li><a href="#user-agent">web user agent</a><span>, in § 2</span>
    </ul>
    <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by
            reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CREDENTIAL-MANAGEMENT-1]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="abbb0b06">credential manager</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-FONTS-5]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="b24ce65e">@font-face</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="6d60ab67">File Upload</span>
                <li><span class="dfn-paneled" id="086e3aff">origin</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="959ad97b">origin</span>
            </ul>
    </ul>
    <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a
            class="self-link" href="#references"></a></h2>
    <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a
            class="self-link" href="#normative"></a></h3>
    <dl>
        <dt id="biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]
        <dd>Nina Satragno; Marcos Caceres. <a href="https://www.w3.org/TR/credential-management-1/"><cite>Credential
                    Management Level 1</cite></a>. 28 October 2025. WD. URL: <a
                href="https://www.w3.org/TR/credential-management-1/">https://www.w3.org/TR/credential-management-1/</a>
        <dt id="biblio-design-principles">[DESIGN-PRINCIPLES]
        <dd>Martin Thomson; Jeffrey Yasskin. <a href="https://www.w3.org/TR/design-principles/"><cite>Web Platform
                    Design Principles</cite></a>. 18 December 2025. NOTE. URL: <a
                href="https://www.w3.org/TR/design-principles/">https://www.w3.org/TR/design-principles/</a>
        <dt id="biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]
        <dd>Cullen Jennings; et al. <a href="https://www.w3.org/TR/mediacapture-streams/"><cite>Media Capture and
                    Streams</cite></a>. 9 October 2025. CRD. URL: <a
                href="https://www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
        <dt id="biblio-rfc8890">[RFC8890]
        <dd>M. Nottingham. <a href="https://www.rfc-editor.org/rfc/rfc8890"><cite>The Internet is for End
                    Users</cite></a>. August 2020. Informational. URL: <a
                href="https://www.rfc-editor.org/rfc/rfc8890">https://www.rfc-editor.org/rfc/rfc8890</a>
    </dl>
    <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a
            class="self-link" href="#informative"></a></h3>
    <dl>
        <dt id="biblio-css-fonts-5">[CSS-FONTS-5]
        <dd>Chris Lilley. <a href="https://www.w3.org/TR/css-fonts-5/"><cite>CSS Fonts Module Level 5</cite></a>. 6
            February 2024. WD. URL: <a href="https://www.w3.org/TR/css-fonts-5/">https://www.w3.org/TR/css-fonts-5/</a>
        <dt id="biblio-file-system-access">[FILE-SYSTEM-ACCESS]
        <dd><a href="https://wicg.github.io/file-system-access/"><cite>File System Access</cite></a>. Draft Community
            Group Report. URL: <a
                href="https://wicg.github.io/file-system-access/">https://wicg.github.io/file-system-access/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
            Living Standard. URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[Infra]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    Standard</cite></a>. Living Standard. URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-privacy-principles">[PRIVACY-PRINCIPLES]
        <dd>Robin Berjon; Jeffrey Yasskin. <a href="https://www.w3.org/TR/privacy-principles/"><cite>Privacy
                    Principles</cite></a>. 15 May 2025. STMT. URL: <a
                href="https://www.w3.org/TR/privacy-principles/">https://www.w3.org/TR/privacy-principles/</a>
        <dt id="biblio-unsanctioned-tracking">[UNSANCTIONED-TRACKING]
        <dd>Mark Nottingham. <a href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/"><cite>Unsanctioned Web
                    Tracking</cite></a>. 17 July 2015. TAG Finding. URL: <a
                href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/">https://www.w3.org/2001/tag/doc/unsanctioned-tracking/</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard.
            URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
    </dl>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "086e3aff": { "dfnID": "086e3aff", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin" }], "title": "3.1. Protection" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "6d60ab67": { "dfnID": "6d60ab67", "dfnText": "File Upload", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-file-upload-state-(type%3Dfile)" }], "title": "3.1. Protection" }], "url": "https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type%3Dfile)" },
                "959ad97b": { "dfnID": "959ad97b", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-origin" }], "title": "3.1. Protection" }], "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "abbb0b06": { "dfnID": "abbb0b06", "dfnText": "credential manager", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-credential-manager" }], "title": "2. What is a web user agent" }], "url": "https://www.w3.org/TR/credential-management-1/#credential-manager" },
                "b24ce65e": { "dfnID": "b24ce65e", "dfnText": "@font-face", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-font-face-rule" }], "title": "3.1. Protection" }], "url": "https://www.w3.org/TR/css-fonts-5/#at-font-face-rule" },
                "general-user-agent": { "dfnID": "general-user-agent", "dfnText": "user agent", "external": false, "refSections": [], "url": "#general-user-agent" },
                "user-agent": { "dfnID": "user-agent", "dfnText": "web user agent", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-user-agent" }], "title": "2. What is a web user agent" }, { "refs": [{ "id": "ref-for-user-agent\u2460" }, { "id": "ref-for-user-agent\u2461" }, { "id": "ref-for-user-agent\u2462" }, { "id": "ref-for-user-agent\u2463" }, { "id": "ref-for-user-agent\u2464" }, { "id": "ref-for-user-agent\u2465" }, { "id": "ref-for-user-agent\u2466" }, { "id": "ref-for-user-agent\u2467" }], "title": "2.1. User agents as software components" }], "url": "#user-agent" },
                "user-agent-duties": { "dfnID": "user-agent-duties", "dfnText": "duties", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-user-agent-duties" }, { "id": "ref-for-user-agent-duties\u2460" }, { "id": "ref-for-user-agent-duties\u2461" }, { "id": "ref-for-user-agent-duties\u2462" }, { "id": "ref-for-user-agent-duties\u2463" }, { "id": "ref-for-user-agent-duties\u2464" }], "title": "2.1. User agents as software components" }], "url": "#user-agent-duties" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#user-agent": { "displayText": "user agent", "export": true, "for_": [], "level": "", "normative": true, "shortname": "web-user-agents", "spec": "web-user-agents", "status": "local", "text": "user agent", "type": "dfn", "url": "#user-agent" },
                "#user-agent-duties": { "displayText": "user agent duties", "export": true, "for_": [], "level": "", "normative": true, "shortname": "web-user-agents", "spec": "web-user-agents", "status": "local", "text": "user agent duties", "type": "dfn", "url": "#user-agent-duties" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": { "displayText": "origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type%3Dfile)": { "displayText": "File Upload", "export": true, "for_": ["input"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "file upload", "type": "element-state", "url": "https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type%3Dfile)" },
                "https://url.spec.whatwg.org/#concept-url-origin": { "displayText": "origin", "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "origin", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "https://www.w3.org/TR/credential-management-1/#credential-manager": { "displayText": "credential manager", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "credential-management", "spec": "credential-management-1", "status": "snapshot", "text": "credential manager", "type": "dfn", "url": "https://www.w3.org/TR/credential-management-1/#credential-manager" },
                "https://www.w3.org/TR/css-fonts-5/#at-font-face-rule": { "displayText": "@font-face", "export": true, "for_": [], "level": "5", "normative": true, "shortname": "css-fonts", "spec": "css-fonts-5", "status": "snapshot", "text": "@font-face", "type": "at-rule", "url": "https://www.w3.org/TR/css-fonts-5/#at-font-face-rule" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const refHintKey = link.getAttribute("data-refhint-key");
                let key = url;
                if (refHintKey) {
                    key = refHintKey + "_" + url;
                }
                const ref = refsData[key];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>