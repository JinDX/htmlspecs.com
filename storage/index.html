<!doctype html>
<html lang="zh-hans">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="#3c790a" name="theme-color">
    <meta content="light dark" name="color-scheme">
    <title>Storage 标准</title>
    <link crossorigin href="https://resources.whatwg.org/standard-shared-with-dev.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/standard.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/spec.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/logo-storage.svg" rel="icon">
    <script crossorigin defer src="https://resources.whatwg.org/commit-snapshot-shortcut-key.js"></script>
    <meta content="Bikeshed version 4416b18d5, updated Tue Jan 2 15:52:39 2024 -0800" name="generator">
    <meta content="9f3b87bf2c914b6a41824782c5a1ac65f051e860" name="revision">
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-mdn-anno */
        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
            --mdn-pass: green;
            --mdn-fail: red;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --mdn-bg: #222;
                --mdn-shadow: #444;
                --mdn-nosupport-text: #666;
                --mdn-pass: #690;
                --mdn-fail: #d22;
            }
        }

        .mdn-anno {
            background: var(--mdn-bg, #EEE);
            border-radius: .25em;
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            color: var(--text, black);
            font: 1em sans-serif;
            hyphens: none;
            max-width: min-content;
            overflow: hidden;
            padding: 0.2em;
            position: absolute;
            right: 0.3em;
            top: auto;
            white-space: nowrap;
            word-wrap: normal;
            z-index: 8;
        }

        .mdn-anno.unpositioned {
            display: none;
        }

        .mdn-anno.overlapping-main {
            opacity: .2;
            transition: opacity .1s;
        }

        .mdn-anno[open] {
            opacity: 1;
            z-index: 9;
            min-width: 9em;
        }

        .mdn-anno:hover {
            opacity: 1;
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>summary {
            font-weight: normal;
            text-align: right;
            cursor: pointer;
            display: block;
        }

        .mdn-anno>summary>.less-than-two-engines-flag {
            color: var(--mdn-fail);
            padding-right: 2px;
        }

        .mdn-anno>summary>.all-engines-flag {
            color: var(--mdn-pass);
            padding-right: 2px;
        }

        .mdn-anno>summary>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: var(--mdn-fail);
        }

        .mdn-anno>.feature>.all-engines-text {
            color: var(--mdn-pass);
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color="0"] {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var[data-var-color="1"] {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var[data-var-color="2"] {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var[data-var-color="3"] {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var[data-var-color="4"] {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var[data-var-color="5"] {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var[data-var-color="6"] {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>

<body class="h-entry status-LS">
    <div class="head">
        <a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" crossorigin height="100"
                src="https://resources.whatwg.org/logo-storage.svg"> </a>
        <hgroup>
            <h1 class="p-name no-ref" id="title">Storage</h1>
            <p id="subtitle">现行标准 — 最后更新 <time class="dt-updated" datetime="2024-09-20">2024年9月20日</time> </p>
        </hgroup>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>参与:
                <dd><a href="https://github.com/whatwg/storage">GitHub whatwg/storage</a> (<a
                        href="https://github.com/whatwg/storage/issues/new/choose">新问题</a>, <a
                        href="https://github.com/whatwg/storage/issues">打开的问题</a>)
                <dd><a href="https://whatwg.org/chat">在Matrix上聊天</a>
                <dt>提交记录:
                <dd><a href="https://github.com/whatwg/storage/commits">GitHub whatwg/storage/commits</a>
                <dd><a href="/commit-snapshots/9f3b87bf2c914b6a41824782c5a1ac65f051e860/"
                        id="commit-snapshot-link">此提交的快照</a>
                <dd><a href="https://twitter.com/storagestandard">@storagestandard</a>
                <dt>测试:
                <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/storage">web-platform-tests
                        storage/</a> (<a href="https://github.com/web-platform-tests/wpt/labels/storage">进行中的工作</a>)
                <dt>翻译 <small>（非规范性）</small>:
                <dd><span title="日语"><a href="https://triple-underscore.github.io/storage-ja.html" hreflang="ja"
                            lang="ja" rel="alternate">日本語</a></span>
                <dd><span title="Simplified Chinese"><a href="https://htmlspecs.com/storage/" hreflang="zh-hans"
                            lang="zh-hans" rel="alternate">简体中文</a></span>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
    </div>

    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>存储标准定义了持久存储和配额估算的API，以及平台存储架构。</p>
    </div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#introduction"><span class="secno">1</span> <span class="content">介绍</span></a>
            <li><a href="#terminology"><span class="secno">2</span> <span class="content">术语</span></a>
            <li><a href="#infrastructure"><span class="secno">3</span> <span class="content">整体布局</span></a>
            <li>
                <a href="#model"><span class="secno">4</span> <span class="content">模型</span></a>
                <ol class="toc">
                    <li><a href="#storage-endpoints"><span class="secno">4.1</span> <span
                                class="content">存储端点</span></a>
                    <li><a href="#storage-keys"><span class="secno">4.2</span> <span class="content">存储键</span></a>
                    <li><a href="#storage-sheds"><span class="secno">4.3</span> <span class="content">存储棚</span></a>
                    <li><a href="#storage-shelves"><span class="secno">4.4</span> <span class="content">存储架</span></a>
                    <li><a href="#buckets"><span class="secno">4.5</span> <span class="content">存储桶</span></a>
                    <li><a href="#storage-bottles"><span class="secno">4.6</span> <span class="content">存储瓶</span></a>
                    <li><a href="#storage-proxy-maps"><span class="secno">4.7</span> <span
                                class="content">存储代理映射</span></a>
                    <li><a href="#storage-task-source"><span class="secno">4.8</span> <span
                                class="content">存储任务源</span></a>
                </ol>
            <li><a href="#persistence"><span class="secno">5</span> <span class="content">持久化权限</span></a>
            <li><a href="#usage-and-quota"><span class="secno">6</span> <span class="content">使用量和配额</span></a>
            <li>
                <a href="#management"><span class="secno">7</span> <span class="content">管理</span></a>
                <ol class="toc">
                    <li><a href="#storage-pressure"><span class="secno">7.1</span> <span class="content">存储压力</span></a>
                    <li><a href="#ui-guidelines"><span class="secno">7.2</span> <span class="content">用户界面指南</span></a>
                </ol>
            <li><a href="#api"><span class="secno">8</span> <span class="content">API</span></a>
            <li><a href="#acks"><span class="secno"></span> <span class="content">致谢</span></a>
            <li><a href="#ipr"><span class="secno"></span> <span class="content">知识产权</span></a>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用中定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span
                class="content">介绍</span><a class="self-link" href="#introduction"></a></h2>
        <p>多年来，网页已经发展出各种可以用于存储的API，例如
            IndexedDB、<code>localStorage</code>和<code>showNotification()</code>。存储标准通过定义以下内容来整合这些API：</p>
        <ul class="brief">
            <li>一个存储桶，这些API存储其数据的基本单位
            <li>使该存储桶持久化的方法
            <li>一种获取<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                    id="ref-for-concept-origin">源</a>的使用量和配额估算的方法
        </ul>
        <p>传统上，当用户设备上的存储空间不足时，这些API存储的数据会丢失，用户无法干预。然而，持久化存储桶不能在未经用户同意的情况下被清除。这为网页带来了用户在本地平台上享受的数据保障。</p>
        <div class="example" id="example-3a7051a8">
            <a class="self-link" href="#example-3a7051a8"></a>
            <p>使存储持久化的一种简单方法是调用<code
                    class="idl"><a data-link-type="idl" href="#dom-storagemanager-persist" id="ref-for-dom-storagemanager-persist">persist()</a></code>方法。它同时向终端用户请求权限，并在获得权限后将存储更改为持久化：
            </p>

            <pre><code class="lang-javascript highlight">navigator<c- p>.</c->storage<c- p>.</c->persist<c- p>().</c->then<c- p>(</c->persisted <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->persisted<c- p>)</c-> <c- p>{</c->
    <c- d>/* … */</c->
  <c- p>}</c->
<c- p>});</c->
</code></pre>
            <p>为了避免在没有预先通知的情况下向终端用户显示由用户代理驱动的对话框，可以编写稍微复杂一些的代码：</p>

            <pre><code class="lang-javascript highlight">Promise<c- p>.</c->all<c- p>([</c->
  navigator<c- p>.</c->storage<c- p>.</c->persisted<c- p>(),</c->
  navigator<c- p>.</c->permissions<c- p>.</c->query<c- p>({</c->name<c- o>:</c-> <c- u>"persistent-storage"</c-><c- p>})</c->
<c- p>]).</c->then<c- p>(([</c->persisted<c- p>,</c-> permission<c- p>])</c-> <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->persisted <c- o>&amp;&amp;</c-> permission<c- p>.</c->state <c- o>==</c-> <c- u>"granted"</c-><c- p>)</c-> <c- p>{</c->
    navigator<c- p>.</c->storage<c- p>.</c->persist<c- p>().</c->then<c- p>(</c-> <c- d>/* … */</c-> <c- p>);</c->
  <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c-><c- o>!</c->persisted <c- o>&amp;&amp;</c-> permission<c- p>.</c->state <c- o>==</c-> <c- u>"prompt"</c-><c- p>)</c-> <c- p>{</c->
    showPersistentStorageExplanation<c- p>();</c->
  <c- p>}</c->
<c- p>});</c->
</code></pre>
            <p><code
                    class="idl"><a data-link-type="idl" href="#dom-storagemanager-estimate" id="ref-for-dom-storagemanager-estimate">estimate()</a></code>
                方法可以用来确定是否有足够的空间来存储应用程序的内容：</p>

            <pre><code class="lang-javascript highlight"><c- a>function</c-> retrieveNextChunk<c- p>(</c->nextChunkInfo<c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> navigator<c- p>.</c->storage<c- p>.</c->estimate<c- p>().</c->then<c- p>(</c->info <c- p>=></c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->info<c- p>.</c->quota <c- o>-</c-> info<c- p>.</c->usage <c- o>></c-> nextChunkInfo<c- p>.</c->size<c- p>)</c-> <c- p>{</c->
      <c- k>return</c-> fetch<c- p>(</c->nextChunkInfo<c- p>.</c->url<c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>throw</c-> <c- ow>new</c-> <c- ne>Error</c-><c- p>(</c-><c- u>"insufficient space to store next chunk"</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}).</c->then<c- p>(</c-> <c- d>/* … */</c-> <c- p>);</c->
<c- p>}</c->
</code></pre>
        </div>
        <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span
                class="content">术语</span><a class="self-link" href="#terminology"></a></h2>
        <p>本规范依赖于Infra标准。<a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
        <p>本规范使用HTML、IDL和权限标准中的术语。<a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> <a
                data-link-type="biblio" href="#biblio-webidl" title="Web IDL Standard">[WEBIDL]</a> <a
                data-link-type="biblio" href="#biblio-permissions" title="Permissions">[PERMISSIONS]</a></p>

        <h2 class="heading settled" data-level="3" id="infrastructure"><span class="secno">3. </span><span
                class="content">基础设施</span><a class="self-link" href="#infrastructure"></a></h2>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent"
                id="ref-for-user-agent">用户代理</a>具有各种类型的半持久性状态：</p>
        <dl>
            <dt>凭据
            <dd>
                <p>最终用户凭据，如通过HTML表单提交的用户名和密码</p>
            <dt>权限
            <dd>
                <p>各种功能的权限，如地理位置</p>
            <dt>网络
            <dd>
                <p>HTTP缓存、Cookies、身份验证条目、TLS客户端证书</p>
            <dt id="site-storage"><a class="self-link" href="#site-storage"></a>存储
            <dd>Indexed DB、Cache API、服务工作者注册、<code>localStorage</code>、<code>sessionStorage</code>、应用缓存、通知等。
        </dl>
        <p>本标准主要关注存储。</p>

        <h2 class="heading settled" data-level="4" id="model"><span class="secno">4. </span><span
                class="content">模型</span><a class="self-link" href="#model"></a></h2>
        <p>定义本地或会话存储API的标准将定义<a data-link-type="dfn" href="#storage-endpoint"
                id="ref-for-storage-endpoint">存储端点</a>并通过更改本标准来<a data-link-type="dfn"
                href="#registered-storage-endpoints" id="ref-for-registered-storage-endpoints">注册</a>它们。这些标准将调用<a
                data-link-type="dfn" href="#obtain-a-local-storage-bottle-map"
                id="ref-for-obtain-a-local-storage-bottle-map">获取本地存储瓶映射</a>或<a data-link-type="dfn"
                href="#obtain-a-session-storage-bottle-map"
                id="ref-for-obtain-a-session-storage-bottle-map">获取会话存储瓶映射</a>算法，这将为它们提供：</p>
        <ul>
            <li>
                <p>失败，这可能意味着API必须抛出异常或以其他方式表明该<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                        id="ref-for-environment-settings-object">环境设置对象</a>没有可用的存储。</p>
            <li>
                <p>一个<a data-link-type="dfn" href="#storage-proxy-map"
                        id="ref-for-storage-proxy-map">存储代理映射</a>，其操作类似于<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#ordered-map"
                        id="ref-for-ordered-map">映射</a>，可用于以适合API的方式存储数据。本标准负责将这些数据与其他API、<a data-link-type="dfn"
                        href="#storage-key" id="ref-for-storage-key">存储密钥</a>和<a data-link-type="dfn"
                        href="#storage-type" id="ref-for-storage-type">存储类型</a>隔离开来。</p>
        </ul>
        <p class="note" role="note">如果你正在为此类API定义标准，建议针对本标准提交一个issue以寻求帮助和审查。</p>
        <p><img alt="存储模型图（在下文中描述）。" crossorigin height="815"
                src="https://storage.spec.whatwg.org/assets/model-diagram.svg" width="434"></p>
        <p>为了隔离这些数据，本标准定义了<a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed">存储棚</a>，它通过<a
                data-link-type="dfn" href="#storage-key" id="ref-for-storage-key①">存储密钥</a>将<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf">存储架</a>进行分段。<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf①">存储架</a>又由一个<a data-link-type="dfn"
                href="#storage-bucket" id="ref-for-storage-bucket">存储桶</a>组成，未来可能会由多个<a data-link-type="dfn"
                href="#storage-bucket" id="ref-for-storage-bucket①">存储桶</a>组成，以允许不同的存储策略。最后，<a data-link-type="dfn"
                href="#storage-bucket" id="ref-for-storage-bucket②">存储桶</a>由<a data-link-type="dfn"
                href="#storage-bottle" id="ref-for-storage-bottle">存储瓶</a>组成，每个<a data-link-type="dfn"
                href="#storage-endpoint" id="ref-for-storage-endpoint①">存储端点</a>一个。</p>

        <h3 class="heading settled" data-level="4.1" id="storage-endpoints"><span class="secno">4.1. </span><span
                class="content">存储端点</span><a class="self-link" href="#storage-endpoints"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="storage-endpoint">存储端点</dfn>是一个<a
                data-link-type="dfn" href="#local-storage" id="ref-for-local-storage">本地</a>或<a data-link-type="dfn"
                href="#session-storage" id="ref-for-session-storage">会话存储</a>API，它使用本标准定义的基础架构，尤其是<a
                data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle①">存储瓶</a>，来跟踪其存储需求。</p>
        <p><a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint②">存储端点</a>有一个<dfn
                class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport
                id="storage-endpoint-identifier">标识符</dfn>，它是一个<a data-link-type="dfn" href="#storage-identifier"
                id="ref-for-storage-identifier">存储标识符</a>。</p>
        <p><a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint③">存储端点</a>还具有<dfn
                class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport
                id="storage-endpoint-types">类型</dfn>，这是一个<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">集合</a>，包含<a
                data-link-type="dfn" href="#storage-type" id="ref-for-storage-type①">存储类型</a>。</p>
        <p><a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint④">存储端点</a>还具有一个<dfn
                class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport
                id="storage-endpoint-quota">配额</dfn>，它是null或代表每个与此<a data-link-type="dfn" href="#storage-endpoint"
                id="ref-for-storage-endpoint⑤">存储端点</a>对应的<a data-link-type="dfn" href="#storage-bottle-quota"
                id="ref-for-storage-bottle-quota">配额</a>（以字节为单位）的推荐数值。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-identifier">存储标识符</dfn>是一个<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string"
                id="ref-for-ascii-string">ASCII字符串</a>。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="storage-type">存储类型</dfn>为“<code>local</code>”或“<code>session</code>”。</p>
        <hr>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="registered-storage-endpoints">注册的存储端点</dfn>是一个<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">集合</a>，由下表定义的<a
                data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑥">存储端点</a>组成：</p>
        <table>
            <tbody>
                <tr>
                    <th><a data-link-type="dfn" href="#storage-endpoint-identifier"
                            id="ref-for-storage-endpoint-identifier">标识符</a>
                    <th><a data-link-type="dfn" href="#storage-endpoint-types"
                            id="ref-for-storage-endpoint-types">类型</a>
                    <th><a data-link-type="dfn" href="#storage-endpoint-quota"
                            id="ref-for-storage-endpoint-quota">配额</a>
                <tr>
                    <td>"<code>caches</code>"
                    <td>« "<code>local</code>" »
                    <td>null
                <tr>
                    <td>"<code>indexedDB</code>"
                    <td>« "<code>local</code>" »
                    <td>null
                <tr>
                    <td>"<code>localStorage</code>"
                    <td>« "<code>local</code>" »
                    <td>5 × 2<sup>20</sup> (即5 Mebibytes)
                <tr>
                    <td>"<code>serviceWorkerRegistrations</code>"
                    <td>« "<code>local</code>" »
                    <td>null
                <tr>
                    <td>"<code>sessionStorage</code>"
                    <td>« "<code>session</code>" »
                    <td>5 × 2<sup>20</sup> (即5 Mebibytes)
            </tbody>
        </table>
        <p class="note" role="note">如前所述，标准可以将这些<a data-link-type="dfn" href="#storage-identifier"
                id="ref-for-storage-identifier①">存储标识符</a>与<a data-link-type="dfn"
                href="#obtain-a-local-storage-bottle-map"
                id="ref-for-obtain-a-local-storage-bottle-map①">获取本地存储瓶映射</a>和<a data-link-type="dfn"
                href="#obtain-a-session-storage-bottle-map"
                id="ref-for-obtain-a-session-storage-bottle-map①">获取会话存储瓶映射</a>一起使用。预计未来某些API将适用于这两种<a
                data-link-type="dfn" href="#storage-type" id="ref-for-storage-type②">存储类型</a>。</p>

        <h3 class="heading settled" data-level="4.2" id="storage-keys"><span class="secno">4.2. </span><span
                class="content">存储键</span><a class="self-link" href="#storage-keys"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-key">存储键</dfn>是由<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">元组</a>组成的，包含一个<dfn
                class="dfn-paneled" data-dfn-for="storage key" data-dfn-type="dfn" data-noexport
                id="storage-key-origin">源</dfn>（一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin①">源</a>）。<a data-link-type="biblio" href="#biblio-html"
                title="HTML Standard">[HTML]</a></p>
        <p class="XXX">这预计会有所改变；请参见<a href="https://privacycg.github.io/storage-partitioning/">客户端存储分区</a>。</p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="obtain-a-storage-key">获取一个存储键</dfn>，给定一个<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment"
                id="ref-for-environment">环境</a><var>environment</var>，执行以下步骤：</p>
        <ol>
            <li>
                <p>让<var>key</var>成为运行<a data-link-type="dfn" href="#obtain-a-storage-key-for-non-storage-purposes"
                        id="ref-for-obtain-a-storage-key-for-non-storage-purposes">获取用于非存储目的的存储键</a>与<var>environment</var>后的结果。
                </p>
            <li>
                <p>如果<var>key</var>的<a data-link-type="dfn" href="#storage-key-origin"
                        id="ref-for-storage-key-origin">源</a>是一个<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"
                        id="ref-for-concept-origin-opaque">不透明源</a>，则返回失败。</p>
            <li>
                <p>如果用户禁用了存储，则返回失败。</p>
            <li>
                <p>返回<var>key</var>。</p>
        </ol>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="obtain-a-storage-key-for-non-storage-purposes">获取用于非存储目的的存储键</dfn>，给定一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment"
                id="ref-for-environment①">环境</a><var>environment</var>，执行以下步骤：</p>
        <ol>
            <li>
                <p>如果<var>environment</var>是<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                        id="ref-for-environment-settings-object①">环境设置对象</a>，则<var>origin</var>为<var>environment</var>的<a
                        data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"
                        id="ref-for-concept-settings-object-origin">源</a>；否则为<var>environment</var>的<a
                        data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url"
                        id="ref-for-concept-environment-creation-url">创建URL</a>的<a data-link-type="dfn"
                        href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">源</a>。
                </p>
            <li>
                <p>返回一个包含<var>origin</var>的<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple"
                        id="ref-for-tuple①">元组</a>。</p>
        </ol>
        <p>要确定<var>A</var>的<a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key②">存储键</a><dfn
                class="dfn-paneled" data-dfn-for="storage key" data-dfn-type="dfn" data-export data-lt="equal"
                id="storage-key-equal">是否等于</dfn><var>B</var>的<a data-link-type="dfn" href="#storage-key"
                id="ref-for-storage-key③">存储键</a>，请执行以下步骤：</p>
        <ol>
            <li>
                <p>如果<var>A</var>的<a data-link-type="dfn" href="#storage-key-origin"
                        id="ref-for-storage-key-origin①">源</a>与<var>B</var>的<a data-link-type="dfn"
                        href="#storage-key-origin" id="ref-for-storage-key-origin②">源</a>不是<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin"
                        id="ref-for-same-origin">同源</a>，则返回false。</p>
            <li>
                <p>返回true。</p>
        </ol>

        <h3 class="heading settled" data-level="4.3" id="storage-sheds"><span class="secno">4.3. </span><span
                class="content">存储棚</span><a class="self-link" href="#storage-sheds"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-shed">存储棚</dfn>是一个<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map"
                id="ref-for-ordered-map①">映射</a>，将<a data-link-type="dfn" href="#storage-key"
                id="ref-for-storage-key④">存储键</a>映射到<a data-link-type="dfn" href="#storage-shelf"
                id="ref-for-storage-shelf②">存储架</a>。最初它是空的。</p>
        <hr>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent"
                id="ref-for-user-agent①">用户代理</a>持有一个<dfn class="dfn-paneled" data-dfn-for="user agent"
                data-dfn-type="dfn" data-noexport id="user-agent-storage-shed">存储棚</dfn>，这是一个<a data-link-type="dfn"
                href="#storage-shed" id="ref-for-storage-shed①">存储棚</a>。用户代理的<a data-link-type="dfn"
                href="#user-agent-storage-shed" id="ref-for-user-agent-storage-shed">存储棚</a>持有所有的<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="local-storage">本地存储</dfn>数据。</p>
        <p><a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable">可遍历的导航对象</a>持有一个<dfn class="dfn-paneled"
                data-dfn-for="traversable navigable" data-dfn-type="dfn" data-noexport
                id="traversable-navigable-storage-shed">存储棚</dfn>，这是一个<a data-link-type="dfn" href="#storage-shed"
                id="ref-for-storage-shed②">存储棚</a>。<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable①">可遍历的导航对象</a>的<a data-link-type="dfn"
                href="#traversable-navigable-storage-shed"
                id="ref-for-traversable-navigable-storage-shed">存储棚</a>持有所有的<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="session-storage">会话存储</dfn>数据。</p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="legacy-clone-a-traversable-storage-shed">遗留克隆一个可遍历存储棚</dfn>，给定一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable②">可遍历的导航对象</a><var>A</var>和一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable③">可遍历的导航对象</a><var>B</var>，执行以下步骤：</p>
        <ol>
            <li>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate"
                        id="ref-for-map-iterate">对每个</a><var>key</var> → <var>shelf</var>在<var>A</var>的<a
                        data-link-type="dfn" href="#traversable-navigable-storage-shed"
                        id="ref-for-traversable-navigable-storage-shed①">存储棚</a>中的项：</p>
                <ol>
                    <li>
                        <p>让<var>newShelf</var>成为运行<a data-link-type="dfn" href="#create-a-storage-shelf"
                                id="ref-for-create-a-storage-shelf">创建一个存储架</a>并使用"<code>session</code>"后的结果。</p>
                    <li>
                        <p>将<var>newShelf</var>的<a data-link-type="dfn" href="#bucket-map"
                                id="ref-for-bucket-map">桶映射</a>["<code>default</code>"]的<a data-link-type="dfn"
                                href="#bottle-map" id="ref-for-bottle-map">瓶映射</a>["<code>sessionStorage</code>"]的<a
                                data-link-type="dfn" href="#storage-bottle-map"
                                id="ref-for-storage-bottle-map">映射</a>设置为<var>shelf</var>的<a data-link-type="dfn"
                                href="#bucket-map" id="ref-for-bucket-map①">桶映射</a>["<code>default</code>"]的<a
                                data-link-type="dfn" href="#bottle-map"
                                id="ref-for-bottle-map①">瓶映射</a>["<code>sessionStorage</code>"]的<a data-link-type="dfn"
                                href="#storage-bottle-map" id="ref-for-storage-bottle-map①">映射</a>的<a
                                data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-clone"
                                id="ref-for-map-clone">克隆</a>。</p>
                    <li>
                        <p>将<var>B</var>的<a data-link-type="dfn" href="#traversable-navigable-storage-shed"
                                id="ref-for-traversable-navigable-storage-shed②">存储棚</a>[<var>key</var>]设置为<var>newShelf</var>。
                        </p>
                </ol>
        </ol>
        <p class="note" role="note">这被认为是遗留的，因为其益处（如果有的话）并不超过实现的复杂性。因此，它不会被扩展或在<cite>HTML</cite>之外使用。<a
                data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a></p>

        <h3 class="heading settled" data-level="4.4" id="storage-shelves"><span class="secno">4.4. </span><span
                class="content">存储架</span><a class="self-link" href="#storage-shelves"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="storage shelf|storage shelves" data-noexport
                id="storage-shelf">存储架</dfn>为<a data-link-type="dfn" href="#storage-shed"
                id="ref-for-storage-shed③">存储棚</a>中的每个<a data-link-type="dfn" href="#storage-key"
                id="ref-for-storage-key⑤">存储键</a>存在。它持有一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="bucket-map">桶映射</dfn>，这是一个将<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string"
                id="ref-for-string">字符串</a>映射到<a data-link-type="dfn" href="#storage-bucket"
                id="ref-for-storage-bucket③">存储桶</a>的<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">映射</a>。</p>
        <p class="note" role="note">目前，"<code>default</code>"是<a data-link-type="dfn" href="#bucket-map"
                id="ref-for-bucket-map②">桶映射</a>中唯一存在的<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">键</a>。参见<a
                href="https://github.com/whatwg/storage/issues/2">issue #2</a>。当第一次<a data-link-type="dfn"
                href="#obtain-a-storage-shelf" id="ref-for-obtain-a-storage-shelf">获取</a>一个<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf③">存储架</a>时，将为其赋予<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#map-value" id="ref-for-map-value">值</a>。</p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-storage-shelf">获取一个存储架</dfn>，给定一个<a
                data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed④">存储棚</a><var>shed</var>、一个<a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object②">环境设置对象</a><var>environment</var>和一个<a data-link-type="dfn"
                href="#storage-type" id="ref-for-storage-type③">存储类型</a><var>type</var>，运行以下步骤：</p>
        <ol>
            <li>
                <p>将<var>key</var>设为通过<var>environment</var>运行<a data-link-type="dfn" href="#obtain-a-storage-key"
                        id="ref-for-obtain-a-storage-key">获取存储键</a>的结果。</p>
            </li>
            <li>
                <p>如果<var>key</var>失败，则返回失败。</p>
            </li>
            <li>
                <p>如果<var>shed</var>[<var>key</var>]不存在<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#map-exists"
                        id="ref-for-map-exists">存在</a>，则将<var>shed</var>[<var>key</var>]设置为运行<a data-link-type="dfn"
                        href="#create-a-storage-shelf"
                        id="ref-for-create-a-storage-shelf①">创建存储架</a>并使用<var>type</var>的结果。</p>
            </li>
            <li>
                <p>返回<var>shed</var>[<var>key</var>]。</p>
            </li>
        </ol>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="obtain-a-local-storage-shelf">获取一个本地存储架</dfn>，给定一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object③">环境设置对象</a><var>environment</var>，返回通过用户代理的<a
                data-link-type="dfn" href="#user-agent-storage-shed"
                id="ref-for-user-agent-storage-shed①">存储棚</a>、<var>environment</var>和"<code>local</code>"运行<a
                data-link-type="dfn" href="#obtain-a-storage-shelf" id="ref-for-obtain-a-storage-shelf①">获取存储架</a>的结果。
        </p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-storage-shelf">创建一个存储架</dfn>，给定一个<a
                data-link-type="dfn" href="#storage-type" id="ref-for-storage-type④">存储类型</a><var>type</var>，运行以下步骤：</p>
        <ol>
            <li>
                <p>将<var>shelf</var>设为一个新的<a data-link-type="dfn" href="#storage-shelf"
                        id="ref-for-storage-shelf④">存储架</a>。</p>
            </li>
            <li>
                <p>将<var>shelf</var>的<a data-link-type="dfn" href="#bucket-map"
                        id="ref-for-bucket-map③">桶映射</a>["<code>default</code>"]设置为通过<var>type</var>运行<a
                        data-link-type="dfn" href="#create-a-storage-bucket"
                        id="ref-for-create-a-storage-bucket">创建一个存储桶</a>的结果。</p>
            </li>
            <li>
                <p>返回<var>shelf</var>。</p>
            </li>
        </ol>

        <h3 class="heading settled" data-level="4.5" id="buckets"><span class="secno">4.5. </span><span
                class="content">存储桶</span><span id="boxes"></span><a class="self-link" href="#buckets"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-bucket">存储桶</dfn>是<a
                data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑦">存储端点</a>存储数据的地方。</p>
        <p><a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket④">存储桶</a>有一个<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bottle-map">瓶映射</dfn>，将<a data-link-type="dfn"
                href="#storage-identifier" id="ref-for-storage-identifier②">存储标识符</a>映射到<a data-link-type="dfn"
                href="#storage-bottle" id="ref-for-storage-bottle③">存储瓶</a>。</p>
        <hr>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bucket">本地存储桶<span id="box"></span></dfn>是用于<a
                data-link-type="dfn" href="#local-storage" id="ref-for-local-storage①">本地存储</a>API的<a
                data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑤">存储桶</a>。</p>
        <p><a data-link-type="dfn" href="#bucket" id="ref-for-bucket">本地存储桶</a>有一个<dfn class="dfn-paneled"
                data-dfn-for="local storage bucket" data-dfn-type="dfn" data-noexport id="bucket-mode">模式<span
                    id="box-mode"></span></dfn>，其值为"<code>best-effort</code>"或"<code>persistent</code>"。最初值为"<code>best-effort</code>"。
        </p>
        <hr>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-storage-bucket">会话存储桶</dfn>是<a
                data-link-type="dfn" href="#session-storage" id="ref-for-session-storage①">会话存储</a>API的<a
                data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑥">存储桶</a>。</p>
        <hr>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-storage-bucket">创建一个存储桶</dfn>，给定一个<a
                data-link-type="dfn" href="#storage-type" id="ref-for-storage-type⑤">存储类型</a><var>type</var>，运行以下步骤：</p>
        <ol>
            <li>
                <p>将<var>bucket</var>设为null。</p>
            </li>
            <li>
                <p>如果<var>type</var>为"<code>local</code>"，则将<var>bucket</var>设为一个新的<a data-link-type="dfn"
                        href="#bucket" id="ref-for-bucket①">本地存储桶</a>。</p>
            </li>
            <li>
                <p>否则：</p>
                <ol>
                    <li>
                        <p>断言：<var>type</var>为"<code>session</code>"。</p>
                    </li>
                    <li>
                        <p>将<var>bucket</var>设为一个新的<a data-link-type="dfn" href="#session-storage-bucket"
                                id="ref-for-session-storage-bucket">会话存储桶</a>。</p>
                    </li>
                </ol>
            </li>
            <li>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                        id="ref-for-list-iterate">对于</a> <var>endpoint</var>中的每一个<a data-link-type="dfn"
                        href="#registered-storage-endpoints" id="ref-for-registered-storage-endpoints①">注册的存储端点</a>，若其<a
                        data-link-type="dfn" href="#storage-endpoint-types" id="ref-for-storage-endpoint-types①">类型</a>
                    <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain"
                        id="ref-for-list-contain">包含</a> <var>type</var>，则将<var>bucket</var>的<a data-link-type="dfn"
                        href="#bottle-map" id="ref-for-bottle-map②">瓶映射</a>[<var>endpoint</var>的<a data-link-type="dfn"
                        href="#storage-endpoint-identifier" id="ref-for-storage-endpoint-identifier①">标识符</a>]设为一个新的<a
                        data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle④">存储瓶</a>，其<a
                        data-link-type="dfn" href="#storage-bottle-quota"
                        id="ref-for-storage-bottle-quota①">配额</a>为<var>endpoint</var>的<a data-link-type="dfn"
                        href="#storage-endpoint-quota" id="ref-for-storage-endpoint-quota①">配额</a>。
                </p>
            </li>
            <li>
                <p>返回<var>bucket</var>。</p>
            </li>
        </ol>

        <h3 class="heading settled" data-level="4.6" id="storage-bottles"><span class="secno">4.6. </span><span
                class="content">存储瓶</span><a class="self-link" href="#storage-bottles"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-bottle">存储瓶</dfn>是<a
                data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑦">存储桶</a>的一部分，为单个<a
                data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑧">存储端点</a>划分出来。<a
                data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑤">存储瓶</a>有一个<dfn
                class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport
                id="storage-bottle-map">映射</dfn>，最初为空<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">映射</a>。<a
                data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑥">存储瓶</a>还有一个<dfn
                class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport
                id="storage-bottle-proxy-map-reference-set">代理映射引用集</dfn>，最初为空<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">集合</a>。<a
                data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑦">存储瓶</a>还有一个<dfn
                class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport
                id="storage-bottle-quota">配额</dfn>，其值为null或表示它可以容纳的总字节数的保守估计。null表示没有限制。<span class="note">它仍然受其所包含的<a
                    data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑤">存储架</a>的<a
                    data-link-type="dfn" href="#storage-quota" id="ref-for-storage-quota">存储配额</a>的约束。</span></p>
        <p><a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑧">存储瓶</a>的<a data-link-type="dfn"
                href="#storage-bottle-map" id="ref-for-storage-bottle-map②">映射</a>是存储实际数据的位置。用户代理应存储这些数据，并以<a
                data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-agents"
                id="ref-for-sec-agents">代理</a>甚至<a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#sec-agent-clusters"
                id="ref-for-sec-agent-clusters">代理集群</a>边界的方式在<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#implementation-defined"
                id="ref-for-implementation-defined">实现定义</a>的方式中跨越这些边界存储和访问这些内容，使本标准及使用本标准的标准能够访问这些内容。</p>
        <hr>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="obtain-a-storage-bottle-map">获取存储瓶映射</dfn>，给定一个<a data-link-type="dfn" href="#storage-type"
                id="ref-for-storage-type⑥">存储类型</a><var>type</var>、<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object④">环境设置对象</a><var>environment</var>和<a data-link-type="dfn"
                href="#storage-identifier" id="ref-for-storage-identifier③">存储标识符</a><var>identifier</var>，运行以下步骤：</p>
        <ol>
            <li>
                <p>将<var>shed</var>设为null。</p>
            </li>
            <li>
                <p>如果<var>type</var>为"<code>local</code>"，则将<var>shed</var>设为用户代理的<a data-link-type="dfn"
                        href="#user-agent-storage-shed" id="ref-for-user-agent-storage-shed②">存储棚</a>。</p>
            </li>
            <li>
                <p>否则：</p>
                <ol>
                    <li>
                        <p>断言：<var>type</var>为"<code>session</code>"。</p>
                    </li>
                    <li>
                        <p>将<var>shed</var>设为<var>environment</var>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object"
                                id="ref-for-global-object">全局对象</a>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                                id="ref-for-concept-document-window">关联<code>Document</code></a>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"
                                id="ref-for-node-navigable">节点可导航</a>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable"
                                id="ref-for-nav-traversable">可遍历导航</a>的<a data-link-type="dfn"
                                href="#traversable-navigable-storage-shed"
                                id="ref-for-traversable-navigable-storage-shed③">存储棚</a>。</p>
                    </li>
                </ol>
            </li>
            <li>
                <p>让<var>shelf</var>成为运行<a data-link-type="dfn" href="#obtain-a-storage-shelf"
                        id="ref-for-obtain-a-storage-shelf②">获取存储架</a>的结果，传递<var>shed</var>、<var>environment</var>和<var>type</var>。
                </p>
            </li>
            <li>
                <p>如果<var>shelf</var>失败，则返回失败。</p>
            </li>
            <li>
                <p>让<var>bucket</var>成为<var>shelf</var>的<a data-link-type="dfn" href="#bucket-map"
                        id="ref-for-bucket-map④">桶映射</a>["<code>default</code>"]。</p>
            </li>
            <li>
                <p>让<var>bottle</var>成为<var>bucket</var>的<a data-link-type="dfn" href="#bottle-map"
                        id="ref-for-bottle-map③">瓶映射</a>[<var>identifier</var>]。</p>
            </li>
            <li>
                <p>让<var>proxyMap</var>成为一个新的<a data-link-type="dfn" href="#storage-proxy-map"
                        id="ref-for-storage-proxy-map①">存储代理映射</a>，其<a data-link-type="dfn"
                        href="#storage-proxy-map-backing-map"
                        id="ref-for-storage-proxy-map-backing-map">支持映射</a>为<var>bottle</var>的<a data-link-type="dfn"
                        href="#storage-bottle-map" id="ref-for-storage-bottle-map③">映射</a>。</p>
            </li>
            <li>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                        id="ref-for-set-append">将</a><var>proxyMap</var>附加到<var>bottle</var>的<a data-link-type="dfn"
                        href="#storage-bottle-proxy-map-reference-set"
                        id="ref-for-storage-bottle-proxy-map-reference-set">代理映射引用集</a>中。</p>
            </li>
            <li>
                <p>返回<var>proxyMap</var>。</p>
            </li>
        </ol>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="obtain-a-local-storage-bottle-map">获取本地存储瓶映射</dfn>，给定<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object⑤">环境设置对象</a><var>environment</var>和<a data-link-type="dfn"
                href="#storage-identifier" id="ref-for-storage-identifier④">存储标识符</a><var>identifier</var>，返回运行<a
                data-link-type="dfn" href="#obtain-a-storage-bottle-map"
                id="ref-for-obtain-a-storage-bottle-map">获取存储瓶映射</a>的结果，传递"<code>local</code>"、<var>environment</var>和<var>identifier</var>。
        </p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="obtain-a-session-storage-bottle-map">获取会话存储瓶映射</dfn>，给定<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object⑥">环境设置对象</a><var>environment</var>和<a data-link-type="dfn"
                href="#storage-identifier" id="ref-for-storage-identifier⑤">存储标识符</a><var>identifier</var>，返回运行<a
                data-link-type="dfn" href="#obtain-a-storage-bottle-map"
                id="ref-for-obtain-a-storage-bottle-map①">获取存储瓶映射</a>的结果，传递"<code>session</code>"、<var>environment</var>和<var>identifier</var>。
        </p>

        <h3 class="heading settled" data-level="4.7" id="storage-proxy-maps"><span class="secno">4.7. </span><span
                class="content">存储代理映射</span><a class="self-link" href="#storage-proxy-maps"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-proxy-map">存储代理映射</dfn>等同于<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map"
                id="ref-for-ordered-map④">映射</a>，只是所有操作都改为在其<dfn class="dfn-paneled" data-dfn-for="storage proxy map"
                data-dfn-type="dfn" data-noexport id="storage-proxy-map-backing-map">支持映射</dfn>上执行。</p>
        <p class="XXX">这允许替换<a data-link-type="dfn" href="#storage-proxy-map-backing-map"
                id="ref-for-storage-proxy-map-backing-map①">支持映射</a>。这对于<a
                href="https://github.com/whatwg/storage/issues/4">问题#4</a>和可能的<a
                href="https://privacycg.github.io/storage-access/">存储访问API</a>是必要的。</p>
        <h3 class="heading settled" data-level="4.8" id="storage-task-source"><span class="secno">4.8. </span><span
                class="content">存储任务源</span><a class="self-link" href="#storage-task-source"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="task-source">存储任务源</dfn>是用于与<a
                data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑨">存储端点</a>相关的所有<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                id="ref-for-concept-task">任务</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source">任务源</a>。特别是那些与<a data-link-type="dfn" href="#storage-endpoint"
                id="ref-for-storage-endpoint①⓪">存储端点</a>的<a data-link-type="dfn" href="#storage-endpoint-quota"
                id="ref-for-storage-endpoint-quota②">配额</a>相关的任务。</p>
        <div class="algorithm" data-algorithm="queue a storage task">
            <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="queue-a-storage-task">排队存储任务</dfn>，给定一个<a
                    data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object"
                    id="ref-for-global-object①">全局对象</a><var>global</var>和一系列步骤<var>steps</var>，在<a data-link-type="dfn"
                    href="#task-source" id="ref-for-task-source①">存储任务源</a>上使用<var>global</var>和<var>steps</var><a
                    data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                    id="ref-for-queue-a-global-task">排队一个全局任务</a>。</p>
        </div>

        <h2 class="heading settled" data-level="5" id="persistence"><span class="secno">5. </span><span
                class="content">持久化权限</span><a class="self-link" href="#persistence"></a></h2>
        <p>只有当用户（或用户代理代表用户）授予使用"<code>persistent-storage</code>"<a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-powerful-feature"
                id="ref-for-dfn-powerful-feature">强大功能</a>的权限时，<a data-link-type="dfn" href="#bucket"
                id="ref-for-bucket②">本地存储桶</a>才能将其<a data-link-type="dfn" href="#bucket-mode"
                id="ref-for-bucket-mode">模式</a>更改为"<code>persistent</code>"。</p>
        <p class="note" role="note">当授予给<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin②">源</a>时，持久化权限可用于保护存储免受用户代理的清理策略影响。用户代理在没有源或用户参与的情况下不能清理标记为持久化的存储。这对于用户需要离线使用的资源或用户在本地创建的资源特别有用。
        </p>
        <p>"<code>persistent-storage</code>"<a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-powerful-feature"
                id="ref-for-dfn-powerful-feature①">强大功能</a>的权限相关算法和类型默认是一样的，除了以下几点：</p>
        <dl>
            <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state"
                    id="ref-for-dfn-permission-state">权限状态</a></dt>
            <dd>
                <p>"<code>persistent-storage</code>"的<a data-link-type="dfn"
                        href="https://w3c.github.io/permissions/#dfn-permission-state"
                        id="ref-for-dfn-permission-state①">权限状态</a>必须对具有相同<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"
                        id="ref-for-concept-settings-object-origin①">源</a>的所有<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                        id="ref-for-environment-settings-object⑦">环境设置对象</a>具有相同的值。</p>
            </dd>
            <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm"
                    id="ref-for-dfn-permission-revocation-algorithm">权限撤销算法</a></dt>
            <dd class="algorithm" data-algorithm="permission-revocation">
                <ol>
                    <li>
                        <p>如果使用"<code>persistent-storage</code>"时<a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state"
                                id="ref-for-dfn-getting-the-current-permission-state">获取当前权限状态</a>的结果是"<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted">granted</a></code>"，则返回。
                        </p>
                    </li>
                    <li>
                        <p>运行<a data-link-type="dfn" href="#obtain-a-local-storage-shelf"
                                id="ref-for-obtain-a-local-storage-shelf">获取本地存储架</a>，使用<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object"
                                id="ref-for-current-settings-object">当前设置对象</a>的结果为<var>shelf</var>。</p>
                    </li>
                    <li>
                        <p>将<var>shelf</var>的<a data-link-type="dfn" href="#bucket-map"
                                id="ref-for-bucket-map⑤">桶映射</a>["<code>default</code>"]的<a data-link-type="dfn"
                                href="#bucket-mode" id="ref-for-bucket-mode①">模式</a>设置为"<code>best-effort</code>"。</p>
                    </li>
                </ol>
            </dd>
        </dl>

        <h2 class="heading settled" data-level="6" id="usage-and-quota"><span class="secno">6. </span><span
                class="content">使用量和配额</span><a class="self-link" href="#usage-and-quota"></a></h2>
        <p><a class="dfn-paneled" data-dfn-type="dfn" data-export id="storage-usage">存储使用量</a>是<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf⑥">存储架</a>使用的大致字节数的<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#implementation-defined"
                id="ref-for-implementation-defined①">实现定义</a>的粗略估计。</p>
        <p class="note" role="note">这不能是一个精确的数字，因为用户代理可能会（并且鼓励这样做）使用去重、压缩和其他技术，这些技术会模糊<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf⑦">存储架</a>实际使用的字节数。</p>
        <p><a class="tracking-vector" href="https://infra.spec.whatwg.org/#tracking-vector"><img alt="(这是一个追踪矢量。)"
                    crossorigin height="64" src="https://resources.whatwg.org/tracking-vector.svg" title="此处有一个追踪矢量。"
                    width="46"></a> <a class="dfn-paneled" data-dfn-type="dfn" data-export
                id="storage-quota">存储配额</a>是<a data-link-type="dfn" href="#storage-shelf"
                id="ref-for-storage-shelf⑧">存储架</a>能容纳的总字节数的<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#implementation-defined"
                id="ref-for-implementation-defined②">实现定义</a>的保守估计。这一数值应小于设备上的总存储空间。它不能是设备上可用存储空间的函数。</p>
        <div class="note" role="note">
            <p>强烈建议用户代理在确定配额时考虑导航频率、最近的访问、书签和<a href="#persistence">“<code>持久存储</code>”权限</a>。</p>
            <p>直接或间接透露可用存储空间可能导致指纹识别并泄露超出涉及的<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                    id="ref-for-concept-origin④">源</a>范围的信息。</p>
        </div>

        <h2 class="heading settled" data-level="7" id="management"><span class="secno">7. </span><span
                class="content">管理</span><a class="self-link" href="#management"></a></h2>
        <p>每当用户代理清除<a data-link-type="dfn" href="#storage-bucket"
                id="ref-for-storage-bucket⑧">存储桶</a>时，必须将其完全清除。用户代理应避免在能够访问它们的脚本正在运行时清除<a data-link-type="dfn"
                href="#storage-bucket" id="ref-for-storage-bucket⑨">存储桶</a>，除非用户另有指示。</p>
        <p>如果删除<a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket①⓪">存储桶</a>导致其包含的<a
                data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑨">存储架</a>的<a data-link-type="dfn"
                href="#bucket-map" id="ref-for-bucket-map⑥">桶映射</a>为空<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#map-is-empty" id="ref-for-map-is-empty">空</a>，则从其包含的<a
                data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed⑤">存储棚</a>中<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">移除</a>该<a data-link-type="dfn"
                href="#storage-shelf" id="ref-for-storage-shelf①⓪">存储架</a>及相应的<a data-link-type="dfn"
                href="#storage-key" id="ref-for-storage-key⑥">存储键</a>。</p>

        <h3 class="heading settled" data-level="7.1" id="storage-pressure"><span class="secno">7.1. </span><span
                class="content">存储压力</span><a class="self-link" href="#storage-pressure"></a></h3>
        <p>当用户代理面临存储压力时，应清除网络状态和模式为“<code>尽力而为</code>”的<a data-link-type="dfn" href="#bucket"
                id="ref-for-bucket③">本地存储桶</a>，理想情况下，优先以最不影响用户的方式进行清除。</p>
        <p>如果用户代理持续面临存储压力，则用户代理应通知用户并提供一种清除剩余<a data-link-type="dfn" href="#bucket"
                id="ref-for-bucket④">本地存储桶</a>（即模式为“<code>持久</code>”的那些）的方式。</p>
        <p><a data-link-type="dfn" href="#session-storage-bucket" id="ref-for-session-storage-bucket①">会话存储桶</a>必须在<a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable④">可遍历导航</a>关闭时清除。</p>
        <p class="note" role="note">如果用户代理允许恢复<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable⑤">可遍历导航</a>，例如通过重新打开<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable"
                id="ref-for-traversable-navigable⑥">可遍历导航</a>或在重新启动用户代理后继续使用它们，那么清除过程必然涉及更复杂的一组启发式方法。</p>

        <h3 class="heading settled" data-level="7.2" id="ui-guidelines"><span class="secno">7.2. </span><span
                class="content">用户界面指南</span><a class="self-link" href="#ui-guidelines"></a></h3>
        <p>用户代理应为用户提供清除单个网站的网络状态和存储的能力。用户代理在其用户界面中不应区分网络状态和存储。这确保了网络状态不能用于恢复存储，并减少了用户需要注意的概念数量。</p>
        <p>凭据应分开处理，因为它们包含用户可能无法恢复的数据，例如自动生成的密码。权限也最好分开处理，以避免给用户带来不便。</p>

        <h2 class="heading settled" data-level="8" id="api"><span class="secno">8. </span><span
                class="content">API</span><a class="self-link" href="#api"></a></h2>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorstorage"><code><c- g>NavigatorStorage</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagemanager" id="ref-for-storagemanager"><c- n>StorageManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageManager" href="#dom-navigatorstorage-storage" id="ref-for-dom-navigatorstorage-storage"><c- g>storage</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage" id="ref-for-navigatorstorage"><c- n>NavigatorStorage</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage" id="ref-for-navigatorstorage①"><c- n>NavigatorStorage</c-></a>;
</pre>
        <p>每个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object⑧">环境设置对象</a>都有一个关联的<code
                class="idl"><a data-link-type="idl" href="#storagemanager" id="ref-for-storagemanager①">StorageManager</a></code>对象。<a
                data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a></p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorStorage" data-dfn-type="attribute" data-export
                id="dom-navigatorstorage-storage"><code>storage</code></dfn>的getter步骤是返回<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                id="ref-for-relevant-settings-object">相关设置对象</a>的<code
                class="idl"><a data-link-type="idl" href="#storagemanager" id="ref-for-storagemanager②">StorageManager</a></code>对象。
        </p>

        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>,
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="storagemanager"><code><c- g>StorageManager</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted" id="ref-for-dom-storagemanager-persisted"><c- g>persisted</c-></a>();
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist" id="ref-for-dom-storagemanager-persist①"><c- g>persist</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate" id="ref-for-dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate" id="ref-for-dom-storagemanager-estimate①"><c- g>estimate</c-></a>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-storageestimate"><code><c- g>StorageEstimate</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-storageestimate-usage"><code><c- g>usage</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long①"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-storageestimate-quota"><code><c- g>quota</c-></code></dfn>;
};
</pre>
        <div class="algorithm" data-algorithm="persisted()" data-algorithm-for="StorageManager">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export
                    id="dom-storagemanager-persisted"><code>persisted()</code></dfn>方法的步骤为：</p>
            <ol>
                <li>
                    <p>令<var>promise</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                            id="ref-for-a-new-promise">一个新的 promise</a>。</p>
                <li>
                    <p>令<var>global</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①">this</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global">相关全局对象</a>。</p>
                <li>
                    <p>令<var>shelf</var>为运行<a data-link-type="dfn" href="#obtain-a-local-storage-shelf"
                            id="ref-for-obtain-a-local-storage-shelf①">获取本地存储架</a>与<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>的<a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object①">相关设置对象</a>的结果。</p>
                <li>
                    <p>如果<var>shelf</var>失败，则<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                            id="ref-for-reject">拒绝</a><var>promise</var>，并返回一个<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>。
                    </p>
                <li>
                    <p>否则，<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel">并行</a>执行以下步骤：</p>
                    <ol>
                        <li>
                            <p>如果<var>shelf</var>的<a data-link-type="dfn" href="#bucket-map"
                                    id="ref-for-bucket-map⑦">bucket map</a>["<code>default</code>"]的<a
                                    data-link-type="dfn" href="#bucket-mode"
                                    id="ref-for-bucket-mode④">模式</a>为"<code>persistent</code>"，则将<var>persisted</var>设为true；否则设为false。
                            </p>
                            <p class="note" role="note">当存在内部错误时，它将为false。</p>
                        <li>
                            <p><a data-link-type="dfn" href="#queue-a-storage-task"
                                    id="ref-for-queue-a-storage-task">排队存储任务</a>与<var>global</var>一起<a
                                    data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                    id="ref-for-resolve">解析</a><var>promise</var>，并将<var>persisted</var>作为返回值。</p>
                    </ol>
                <li>
                    <p>返回<var>promise</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="persist()" data-algorithm-for="StorageManager">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export
                    id="dom-storagemanager-persist"><code>persist()</code></dfn>方法的步骤为：</p>
            <ol>
                <li>
                    <p>令<var>promise</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                            id="ref-for-a-new-promise①">一个新的 promise</a>。</p>
                <li>
                    <p>令<var>global</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this③">this</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global①">相关全局对象</a>。</p>
                <li>
                    <p>令<var>shelf</var>为运行<a data-link-type="dfn" href="#obtain-a-local-storage-shelf"
                            id="ref-for-obtain-a-local-storage-shelf②">获取本地存储架</a>与<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>的<a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object②">相关设置对象</a>的结果。</p>
                <li>
                    <p>如果<var>shelf</var>失败，则<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                            id="ref-for-reject①">拒绝</a><var>promise</var>，并返回一个<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>。
                    </p>
                <li>
                    <p>否则，<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel①">并行</a>执行以下步骤：</p>
                    <ol>
                        <li>
                            <p>令<var>permission</var>为<a data-link-type="dfn"
                                    href="https://w3c.github.io/permissions/#dfn-request-permission-to-use"
                                    id="ref-for-dfn-request-permission-to-use">请求使用权限</a>"<code>persistent-storage</code>"的结果。
                            </p>
                            <p class="note" role="note">鼓励用户代理不要让用户在同一时间为相同的<a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                                    id="ref-for-concept-origin⑤">来源</a>回答两次问题，并且该算法无法处理这种情况。</p>
                        <li>
                            <p>令<var>bucket</var>为<var>shelf</var>的<a data-link-type="dfn" href="#bucket-map"
                                    id="ref-for-bucket-map⑧">bucket map</a>["<code>default</code>"]。</p>
                        <li>
                            <p>如果<var>bucket</var>的<a data-link-type="dfn" href="#bucket-mode"
                                    id="ref-for-bucket-mode⑤">模式</a>为"<code>persistent</code>"，则将<var>persisted</var>设为true；否则设为false。
                            </p>
                            <p class="note" role="note">当存在内部错误时，它将为false。</p>
                        <li>
                            <p>如果<var>persisted</var>为false且<var>permission</var>为"<code
                                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted①">granted</a></code>"，则：
                            </p>
                            <ol>
                                <li>
                                    <p>将<var>bucket</var>的<a data-link-type="dfn" href="#bucket-mode"
                                            id="ref-for-bucket-mode⑥">模式</a>设为"<code>persistent</code>"。</p>
                                <li>
                                    <p>如果没有内部错误，则将<var>persisted</var>设为true。</p>
                            </ol>
                        <li>
                            <p><a data-link-type="dfn" href="#queue-a-storage-task"
                                    id="ref-for-queue-a-storage-task①">排队存储任务</a>与<var>global</var>一起<a
                                    data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                    id="ref-for-resolve①">解析</a><var>promise</var>，并将<var>persisted</var>作为返回值。</p>
                    </ol>
                <li>
                    <p>返回<var>promise</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="estimate()" data-algorithm-for="StorageManager">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export
                    id="dom-storagemanager-estimate"><code>estimate()</code></dfn>方法的步骤为：</p>
            <ol>
                <li>
                    <p>令<var>promise</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                            id="ref-for-a-new-promise②">一个新的 promise</a>。</p>
                <li>
                    <p>令<var>global</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this⑤">this</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global②">相关全局对象</a>。</p>
                <li>
                    <p>令<var>shelf</var>为运行<a data-link-type="dfn" href="#obtain-a-local-storage-shelf"
                            id="ref-for-obtain-a-local-storage-shelf③">获取本地存储架</a>与<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>的<a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object③">相关设置对象</a>的结果。</p>
                <li>
                    <p>如果<var>shelf</var>失败，则<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                            id="ref-for-reject②">拒绝</a><var>promise</var>，并返回一个<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>。
                    </p>
                <li>
                    <p>否则，<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel②">并行</a>执行以下步骤：</p>
                    <ol>
                        <li>
                            <p>令<var>usage</var>为<var>shelf</var>的<a data-link-type="dfn" href="#storage-usage"
                                    id="ref-for-storage-usage">存储使用量</a>。</p>
                        <li>
                            <p>令<var>quota</var>为<var>shelf</var>的<a data-link-type="dfn" href="#storage-quota"
                                    id="ref-for-storage-quota①">存储配额</a>。</p>
                        <li>
                            <p>令<var>dictionary</var>为一个新的<code
                                    class="idl"><a data-link-type="idl" href="#dictdef-storageestimate" id="ref-for-dictdef-storageestimate①">StorageEstimate</a></code>字典，其中<code
                                    class="idl"><a data-link-type="idl" href="#dom-storageestimate-usage" id="ref-for-dom-storageestimate-usage">usage</a></code>成员为<var>usage</var>，<code
                                    class="idl"><a data-link-type="idl" href="#dom-storageestimate-quota" id="ref-for-dom-storageestimate-quota">quota</a></code>成员为<var>quota</var>。
                            </p>
                        <li>
                            <p>如果在获取<var>usage</var>和<var>quota</var>时出现内部错误，则<a data-link-type="dfn"
                                    href="#queue-a-storage-task"
                                    id="ref-for-queue-a-storage-task②">排队存储任务</a>与<var>global</var>一起<a
                                    data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                                    id="ref-for-reject③">拒绝</a><var>promise</var>，并返回一个<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>。
                            </p>
                            <p class="note" role="note">内部错误应该极其罕见，并表明某种低级平台或硬件故障。然而，在网络的规模和实现的多样性及平台的多样性下，意外确实会发生。</p>
                        <li>
                            <p>否则，<a data-link-type="dfn" href="#queue-a-storage-task"
                                    id="ref-for-queue-a-storage-task③">排队存储任务</a>与<var>global</var>一起<a
                                    data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                    id="ref-for-resolve②">解析</a><var>promise</var>，并将<var>dictionary</var>作为返回值。</p>
                    </ol>
                <li>
                    <p>返回<var>promise</var>。</p>
            </ol>
        </div>

        <h2 class="no-num heading settled" id="acks"><span class="content">致谢</span><a class="self-link"
                href="#acks"></a></h2>
        <p>由此，特别感谢Adrian Bateman，Aislinn Grigas，Alex Russell，Ali Alabbas，Andrew Sutherland，Andrew Williams，Austin
            Sullivan，Ben Kelly，Ben Turner，Dale Harvey，David Grogan，Domenic Denicola，fantasai，Jake Archibald，Jeffrey
            Yasskin，Jesse Mykolyn，Jinho Bang，Jonas Sicking，Joshua Bell，Kenji Baheux，Kinuko Yasuda，Luke Wagner，Michael
            Nordman，Mike Taylor，Mounir Lamouri，Shachar Zohar，黃強 (Shawn Huang)，簡冠庭 (Timothy Guan-tin Chien)，以及Victor
            Costan，感谢你们的出色贡献！</p>
        <p>本标准由<a href="https://annevankesteren.nl/" lang="nl">Anne van Kesteren</a>（<a
                href="https://www.apple.com/">Apple</a>，<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>）撰写。</p>
        <h2 class="no-num heading settled" id="ipr"><span class="content">知识产权</span><a class="self-link"
                href="#ipr"></a></h2>
        <p>版权 © WHATWG（Apple，Google，Mozilla，Microsoft）。本作品采用<a href="https://creativecommons.org/licenses/by/4.0/"
                rel="license">知识共享署名 4.0 国际许可协议</a>进行许可。对于纳入源代码的部分，此类部分在源代码中根据<a
                href="https://opensource.org/licenses/BSD-3-Clause" rel="license">BSD 3-Clause 许可证</a>进行许可。</p>
        <p>这是现行标准。有兴趣获取专利审查版本的人士应查看<a href="/review-drafts/2023-02/">现行标准审查草案</a>。</p>

    </main>
    <script>
        // "use strict";
        // if ("serviceWorker" in navigator) {
        //     navigator.serviceWorker.register("/service-worker.js");
        // }
    </script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#storage-proxy-map-backing-map">backing map</a><span>，在 § 4.7</span>
        <li><a href="#bottle-map">bottle map</a><span>，在 § 4.5</span>
        <li><a href="#bucket-map">bucket map</a><span>，在 § 4.4</span>
        <li><a href="#create-a-storage-bucket">create a storage bucket</a><span>，在 § 4.5</span>
        <li><a href="#create-a-storage-shelf">create a storage shelf</a><span>，在 § 4.4</span>
        <li><a href="#storage-key-equal">equal</a><span>，在 § 4.2</span>
        <li><a href="#dom-storagemanager-estimate">estimate()</a><span>，在 § 8</span>
        <li><a href="#storage-endpoint-identifier">identifier</a><span>，在 § 4.1</span>
        <li><a href="#legacy-clone-a-traversable-storage-shed">legacy-clone a traversable storage shed</a><span>，在
                § 4.3</span>
        <li><a href="#local-storage">local storage</a><span>，在 § 4.3</span>
        <li><a href="#bucket">local storage bucket</a><span>，在 § 4.5</span>
        <li><a href="#storage-bottle-map">map</a><span>，在 § 4.6</span>
        <li><a href="#bucket-mode">mode</a><span>，在 § 4.5</span>
        <li><a href="#navigatorstorage">NavigatorStorage</a><span>，在 § 8</span>
        <li><a href="#obtain-a-local-storage-bottle-map">obtain a local storage bottle map</a><span>，在 § 4.6</span>
        <li><a href="#obtain-a-local-storage-shelf">obtain a local storage shelf</a><span>，在 § 4.4</span>
        <li><a href="#obtain-a-session-storage-bottle-map">obtain a session storage bottle map</a><span>，在 § 4.6</span>
        <li><a href="#obtain-a-storage-bottle-map">obtain a storage bottle map</a><span>，在 § 4.6</span>
        <li><a href="#obtain-a-storage-key">obtain a storage key</a><span>，在 § 4.2</span>
        <li><a href="#obtain-a-storage-key-for-non-storage-purposes">obtain a storage key for non-storage
                purposes</a><span>，在 § 4.2</span>
        <li><a href="#obtain-a-storage-shelf">obtain a storage shelf</a><span>，在 § 4.4</span>
        <li><a href="#storage-key-origin">origin</a><span>，在 § 4.2</span>
        <li><a href="#dom-storagemanager-persist">persist()</a><span>，在 § 8</span>
        <li><a href="#dom-storagemanager-persisted">persisted()</a><span>，在 § 8</span>
        <li><a href="#storage-bottle-proxy-map-reference-set">proxy map reference set</a><span>，在 § 4.6</span>
        <li><a href="#queue-a-storage-task">queue a storage task</a><span>，在 § 4.8</span>
        <li>
            quota
            <ul>
                <li><a href="#storage-bottle-quota">定义在 storage bottle</a><span>，在 § 4.6</span>
                <li><a href="#storage-endpoint-quota">定义在 storage endpoint</a><span>，在 § 4.1</span>
                <li><a href="#dom-storageestimate-quota">定义在 StorageEstimate</a><span>，在 § 8</span>
            </ul>
        <li><a href="#registered-storage-endpoints">registered storage endpoints</a><span>，在 § 4.1</span>
        <li><a href="#session-storage">session storage</a><span>，在 § 4.3</span>
        <li><a href="#session-storage-bucket">session storage bucket</a><span>，在 § 4.5</span>
        <li><a href="#dom-navigatorstorage-storage">storage</a><span>，在 § 8</span>
        <li><a href="#storage-bottle">storage bottle</a><span>，在 § 4.6</span>
        <li><a href="#storage-bucket">storage bucket</a><span>，在 § 4.5</span>
        <li><a href="#storage-endpoint">storage endpoint</a><span>，在 § 4.1</span>
        <li><a href="#dictdef-storageestimate">StorageEstimate</a><span>，在 § 8</span>
        <li><a href="#storage-identifier">storage identifier</a><span>，在 § 4.1</span>
        <li><a href="#storage-key">storage key</a><span>，在 § 4.2</span>
        <li><a href="#storagemanager">StorageManager</a><span>，在 § 8</span>
        <li><a href="#storage-proxy-map">storage proxy map</a><span>，在 § 4.7</span>
        <li><a href="#storage-quota">storage quota</a><span>，在 § 6</span>
        <li>
            storage shed
            <ul>
                <li><a href="#storage-shed">定义</a><span>，在 § 4.3</span>
                <li><a href="#traversable-navigable-storage-shed">定义在 traversable navigable</a><span>，在 § 4.3</span>
                <li><a href="#user-agent-storage-shed">定义在 user agent</a><span>，在 § 4.3</span>
            </ul>
        <li><a href="#storage-shelf">storage shelf</a><span>，在 § 4.4</span>
        <li><a href="#storage-shelf">storage shelves</a><span>，在 § 4.4</span>
        <li><a href="#task-source">storage task source</a><span>，在 § 4.8</span>
        <li><a href="#storage-type">storage type</a><span>，在 § 4.1</span>
        <li><a href="#storage-usage">storage usage</a><span>，在 § 6</span>
        <li><a href="#storage-endpoint-types">types</a><span>，在 § 4.1</span>
        <li><a href="#dom-storageestimate-usage">usage</a><span>，在 § 8</span>
    </ul>

    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[ECMASCRIPT]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="3187558e">agent</span>
                <li><span class="dfn-paneled" id="f6e4cbfd">agent cluster</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
                <li><span class="dfn-paneled" id="a4785085">WorkerNavigator</span>
                <li><span class="dfn-paneled" id="3349d69f">关联的文档</span>
                <li><span class="dfn-paneled" id="fa5ee9c5">创建URL</span>
                <li><span class="dfn-paneled" id="12b8dfc0">当前设置对象</span>
                <li><span class="dfn-paneled" id="24cf98a1">环境</span>
                <li><span class="dfn-paneled" id="3e12e042">环境设置对象</span>
                <li><span class="dfn-paneled" id="4b6086d7">全局对象</span>
                <li><span class="dfn-paneled" id="a72449dd">并行执行</span>
                <li><span class="dfn-paneled" id="13dd6cae">节点导航器</span>
                <li><span class="dfn-paneled" id="b01b1359">不透明的来源</span>
                <li><span class="dfn-paneled" id="086e3aff">来源</span>
                <li><span class="dfn-paneled" id="43ac8374">来源 <small>（针对环境设置对象）</small></span>
                <li><span class="dfn-paneled" id="48438eb3">排队一个全局任务</span>
                <li><span class="dfn-paneled" id="e99bd18e">相关的全局对象</span>
                <li><span class="dfn-paneled" id="9c4c1e66">相关的设置对象</span>
                <li><span class="dfn-paneled" id="7393da89">同源</span>
                <li><span class="dfn-paneled" id="e270bd2a">任务</span>
                <li><span class="dfn-paneled" id="c3b2d08c">任务源</span>
                <li><span class="dfn-paneled" id="d0c1b934">可遍历的导航</span>
                <li><span class="dfn-paneled" id="17582406">可遍历的导航 <small>（针对导航器）</small></span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="a3b18719">追加</span>
                <li><span class="dfn-paneled" id="2d5a2765">ASCII字符串</span>
                <li><span class="dfn-paneled" id="ab3919d2">克隆</span>
                <li><span class="dfn-paneled" id="ae8def21">包含</span>
                <li><span class="dfn-paneled" id="1243a891">存在</span>
                <li><span class="dfn-paneled" id="16d07e10">对每个 <small>（针对列表）</small></span>
                <li><span class="dfn-paneled" id="45209803">对每个 <small>（针对映射）</small></span>
                <li><span class="dfn-paneled" id="860300d4">实现定义的</span>
                <li><span class="dfn-paneled" id="dc3369de">为空</span>
                <li><span class="dfn-paneled" id="d14a6f26">键</span>
                <li><span class="dfn-paneled" id="3fca5a9e">映射</span>
                <li><span class="dfn-paneled" id="7d4424b2">移除</span>
                <li><span class="dfn-paneled" id="15e48c39">集合</span>
                <li><span class="dfn-paneled" id="0698d556">字符串</span>
                <li><span class="dfn-paneled" id="0e8de730">元组</span>
                <li><span class="dfn-paneled" id="6d19ac93">用户代理</span>
                <li><span class="dfn-paneled" id="802b0fdd">值</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="33438879">获取当前权限状态</span>
                <li><span class="dfn-paneled" id="c6ce3c60">已授权</span>
                <li><span class="dfn-paneled" id="409a61ca">权限撤销算法</span>
                <li><span class="dfn-paneled" id="d124397f">权限状态</span>
                <li><span class="dfn-paneled" id="6c2d7879">强大功能</span>
                <li><span class="dfn-paneled" id="d357c753">请求使用权限</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="959ad97b">来源</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
                <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
                <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
                <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
                <li><span class="dfn-paneled" id="dacde8b5">一个新Promise</span>
                <li><span class="dfn-paneled" id="5372cca8">boolean</span>
                <li><span class="dfn-paneled" id="b262501e">拒绝</span>
                <li><span class="dfn-paneled" id="3b90bdcd">解决</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
                <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
            </ul>
    </ul>

    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-ecmascript">[ECMASCRIPT]
        <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript语言规范</cite></a>。URL: <a
                href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren等。<a href="https://html.spec.whatwg.org/multipage/"><cite>HTML标准</cite></a>。现行标准。URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola。<a
                href="https://infra.spec.whatwg.org/"><cite>Infra标准</cite></a>。现行标准。URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-permissions">[PERMISSIONS]
        <dd>Marcos Caceres; Mike Taylor。<a href="https://w3c.github.io/permissions/"><cite>权限</cite></a>。URL:
            <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren。<a href="https://url.spec.whatwg.org/"><cite>URL标准</cite></a>。现行标准。
            URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu。<a href="https://webidl.spec.whatwg.org/"><cite>Web IDL标准</cite></a>。现行标准。
            URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorstorage"><code><c- g>NavigatorStorage</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagemanager"><c- n>StorageManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageManager" href="#dom-navigatorstorage-storage"><c- g>storage</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage"><c- n>NavigatorStorage</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage"><c- n>NavigatorStorage</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>,
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#storagemanager"><code><c- g>StorageManager</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted"><c- g>persisted</c-></a>();
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist"><c- g>persist</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate"><c- g>estimate</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-storageestimate"><code><c- g>StorageEstimate</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-storageestimate-usage"><code><c- g>usage</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-storageestimate-quota"><code><c- g>quota</c-></code></a>;
};

</pre>
    <details class="mdn-anno unpositioned" data-anno-for="dom-navigatorstorage-storage">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/storage"
                    title="The Navigator.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use.">Navigator/storage</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>15.2+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>55+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerNavigator/storage"
                    title="The WorkerNavigator.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use.">WorkerNavigator/storage</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>15.2+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>55+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-storagemanager-estimate">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/estimate"
                    title="The estimate() method of the StorageManager interface asks the Storage Manager for how much storage the current origin takes up (usage), and how much space is available (quota).">StorageManager/estimate</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>17+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>61+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-storagemanager-persist">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persist"
                    title="The persist() method of the StorageManager interface requests permission to use persistent storage, and returns a Promise that resolves to true if permission is granted and bucket mode is persistent, and false otherwise.">StorageManager/persist</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>15.2+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>55+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-storagemanager-persisted">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persisted"
                    title="The persisted() method of the StorageManager interface returns a Promise that resolves to true if your site&apos;s storage bucket is persistent.">StorageManager/persisted</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>15.2+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>55+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="storagemanager">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager"
                    title="The StorageManager interface of the Storage API provides an interface for managing persistence permissions and estimating available storage. You can get a reference to this interface using either navigator.storage or WorkerNavigator.storage.">StorageManager</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span
                    class="safari yes"><span>Safari</span><span>15.2+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>55+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "0698d556": { "dfnID": "0698d556", "dfnText": "string", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-string" }], "title": "4.4. Storage shelves" }], "url": "https://infra.spec.whatwg.org/#string" },
                "086e3aff": { "dfnID": "086e3aff", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-concept-origin\u2460" }], "title": "4.2. Storage keys" }, { "refs": [{ "id": "ref-for-concept-origin\u2461" }, { "id": "ref-for-concept-origin\u2462" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-concept-origin\u2463" }], "title": "6. Usage and quota" }, { "refs": [{ "id": "ref-for-concept-origin\u2464" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "0e8de730": { "dfnID": "0e8de730", "dfnText": "tuple", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-tuple" }, { "id": "ref-for-tuple\u2460" }], "title": "4.2. Storage keys" }], "url": "https://infra.spec.whatwg.org/#tuple" },
                "1243a891": { "dfnID": "1243a891", "dfnText": "exist", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-exists" }], "title": "4.4. Storage shelves" }], "url": "https://infra.spec.whatwg.org/#map-exists" },
                "12b8dfc0": { "dfnID": "12b8dfc0", "dfnText": "current settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-current-settings-object" }], "title": "5. Persistence permission" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" },
                "13dd6cae": { "dfnID": "13dd6cae", "dfnText": "node navigable", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-node-navigable" }], "title": "4.6. Storage bottles" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" },
                "15e48c39": { "dfnID": "15e48c39", "dfnText": "set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-set" }, { "id": "ref-for-ordered-set\u2460" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-ordered-set\u2461" }], "title": "4.6. Storage bottles" }], "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "16d07e10": { "dfnID": "16d07e10", "dfnText": "for each (for list)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-iterate" }], "title": "4.5. Storage buckets" }], "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "17582406": { "dfnID": "17582406", "dfnText": "traversable navigable (for navigable)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-nav-traversable" }], "title": "4.6. Storage bottles" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable" },
                "24cf98a1": { "dfnID": "24cf98a1", "dfnText": "environment", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-environment" }, { "id": "ref-for-environment\u2460" }], "title": "4.2. Storage keys" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment" },
                "2d5a2765": { "dfnID": "2d5a2765", "dfnText": "ascii string", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ascii-string" }], "title": "4.1. Storage endpoints" }], "url": "https://infra.spec.whatwg.org/#ascii-string" },
                "3187558e": { "dfnID": "3187558e", "dfnText": "agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sec-agents" }], "title": "4.6. Storage bottles" }], "url": "https://tc39.github.io/ecma262/#sec-agents" },
                "33438879": { "dfnID": "33438879", "dfnText": "getting the current permission state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-getting-the-current-permission-state" }], "title": "5. Persistence permission" }], "url": "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state" },
                "3349d69f": { "dfnID": "3349d69f", "dfnText": "associated document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-window" }], "title": "4.6. Storage bottles" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "3b90bdcd": { "dfnID": "3b90bdcd", "dfnText": "resolve", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-resolve" }, { "id": "ref-for-resolve\u2460" }, { "id": "ref-for-resolve\u2461" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#resolve" },
                "3e12e042": { "dfnID": "3e12e042", "dfnText": "environment settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-environment-settings-object" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-environment-settings-object\u2460" }], "title": "4.2. Storage keys" }, { "refs": [{ "id": "ref-for-environment-settings-object\u2461" }, { "id": "ref-for-environment-settings-object\u2462" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-environment-settings-object\u2463" }, { "id": "ref-for-environment-settings-object\u2464" }, { "id": "ref-for-environment-settings-object\u2465" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-environment-settings-object\u2466" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-environment-settings-object\u2467" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" },
                "3fca5a9e": { "dfnID": "3fca5a9e", "dfnText": "map", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-map" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-ordered-map\u2460" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-ordered-map\u2461" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-ordered-map\u2462" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-ordered-map\u2463" }], "title": "4.7. Storage proxy maps" }], "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }, { "id": "ref-for-this\u2460" }, { "id": "ref-for-this\u2461" }, { "id": "ref-for-this\u2462" }, { "id": "ref-for-this\u2463" }, { "id": "ref-for-this\u2464" }, { "id": "ref-for-this\u2465" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "409a61ca": { "dfnID": "409a61ca", "dfnText": "permission revocation algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-revocation-algorithm" }], "title": "5. Persistence permission" }], "url": "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm" },
                "43ac8374": { "dfnID": "43ac8374", "dfnText": "origin (for environment settings object)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-settings-object-origin" }], "title": "4.2. Storage keys" }, { "refs": [{ "id": "ref-for-concept-settings-object-origin\u2460" }], "title": "5. Persistence permission" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" },
                "45209803": { "dfnID": "45209803", "dfnText": "for each (for map)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-iterate" }], "title": "4.3. Storage sheds" }], "url": "https://infra.spec.whatwg.org/#map-iterate" },
                "48438eb3": { "dfnID": "48438eb3", "dfnText": "queue a global task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-global-task" }], "title": "4.8. Storage task source" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "4b6086d7": { "dfnID": "4b6086d7", "dfnText": "global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-global-object" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-global-object\u2460" }], "title": "4.8. Storage task source" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#global-object" },
                "5372cca8": { "dfnID": "5372cca8", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-boolean" }, { "id": "ref-for-idl-boolean\u2460" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "6c2d7879": { "dfnID": "6c2d7879", "dfnText": "powerful feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-powerful-feature" }, { "id": "ref-for-dfn-powerful-feature\u2460" }], "title": "5. Persistence permission" }], "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "6d19ac93": { "dfnID": "6d19ac93", "dfnText": "user agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-user-agent" }], "title": "3. Lay of the land" }, { "refs": [{ "id": "ref-for-user-agent\u2460" }], "title": "4.3. Storage sheds" }], "url": "https://infra.spec.whatwg.org/#user-agent" },
                "7393da89": { "dfnID": "7393da89", "dfnText": "same origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-same-origin" }], "title": "4.2. Storage keys" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "7d4424b2": { "dfnID": "7d4424b2", "dfnText": "remove", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-remove" }], "title": "7. Management" }], "url": "https://infra.spec.whatwg.org/#map-remove" },
                "802b0fdd": { "dfnID": "802b0fdd", "dfnText": "value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-value" }], "title": "4.4. Storage shelves" }], "url": "https://infra.spec.whatwg.org/#map-value" },
                "82ca3efc": { "dfnID": "82ca3efc", "dfnText": "TypeError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-exceptiondef-typeerror" }, { "id": "ref-for-exceptiondef-typeerror\u2460" }, { "id": "ref-for-exceptiondef-typeerror\u2461" }, { "id": "ref-for-exceptiondef-typeerror\u2462" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror" },
                "860300d4": { "dfnID": "860300d4", "dfnText": "implementation-defined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-implementation-defined" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-implementation-defined\u2460" }, { "id": "ref-for-implementation-defined\u2461" }], "title": "6. Usage and quota" }], "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }, { "id": "ref-for-Exposed\u2460" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "959ad97b": { "dfnID": "959ad97b", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-origin" }], "title": "4.2. Storage keys" }], "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "9c4c1e66": { "dfnID": "9c4c1e66", "dfnText": "relevant settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-relevant-settings-object" }, { "id": "ref-for-relevant-settings-object\u2460" }, { "id": "ref-for-relevant-settings-object\u2461" }, { "id": "ref-for-relevant-settings-object\u2462" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "a3b18719": { "dfnID": "a3b18719", "dfnText": "append", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-set-append" }], "title": "4.6. Storage bottles" }], "url": "https://infra.spec.whatwg.org/#set-append" },
                "a4785085": { "dfnID": "a4785085", "dfnText": "WorkerNavigator", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-workernavigator" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator" },
                "a5c91173": { "dfnID": "a5c91173", "dfnText": "SameObject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-SameObject" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#SameObject" },
                "a72449dd": { "dfnID": "a72449dd", "dfnText": "in parallel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-in-parallel" }, { "id": "ref-for-in-parallel\u2460" }, { "id": "ref-for-in-parallel\u2461" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "ab3919d2": { "dfnID": "ab3919d2", "dfnText": "clone", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-clone" }], "title": "4.3. Storage sheds" }], "url": "https://infra.spec.whatwg.org/#map-clone" },
                "ae8def21": { "dfnID": "ae8def21", "dfnText": "contain", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-contain" }], "title": "4.5. Storage buckets" }], "url": "https://infra.spec.whatwg.org/#list-contain" },
                "b01b1359": { "dfnID": "b01b1359", "dfnText": "opaque origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin-opaque" }], "title": "4.2. Storage keys" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" },
                "b262501e": { "dfnID": "b262501e", "dfnText": "reject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reject" }, { "id": "ref-for-reject\u2460" }, { "id": "ref-for-reject\u2461" }, { "id": "ref-for-reject\u2462" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#reject" },
                "b75bb3bd": { "dfnID": "b75bb3bd", "dfnText": "SecureContext", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-SecureContext" }, { "id": "ref-for-SecureContext\u2460" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "bdbd19d1": { "dfnID": "bdbd19d1", "dfnText": "Promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-promise" }, { "id": "ref-for-idl-promise\u2460" }, { "id": "ref-for-idl-promise\u2461" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "be0c27b2": { "dfnID": "be0c27b2", "dfnText": "Navigator", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-navigator" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator" },
                "bottle-map": { "dfnID": "bottle-map", "dfnText": "bottle map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-bottle-map" }, { "id": "ref-for-bottle-map\u2460" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-bottle-map\u2461" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-bottle-map\u2462" }], "title": "4.6. Storage bottles" }], "url": "#bottle-map" },
                "bucket": { "dfnID": "bucket", "dfnText": "local storage bucket", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-bucket" }, { "id": "ref-for-bucket\u2460" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-bucket\u2461" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-bucket\u2462" }, { "id": "ref-for-bucket\u2463" }], "title": "7.1. Storage pressure" }], "url": "#bucket" },
                "bucket-map": { "dfnID": "bucket-map", "dfnText": "bucket map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-bucket-map" }, { "id": "ref-for-bucket-map\u2460" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-bucket-map\u2461" }, { "id": "ref-for-bucket-map\u2462" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-bucket-map\u2463" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-bucket-map\u2464" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-bucket-map\u2465" }], "title": "7. Management" }, { "refs": [{ "id": "ref-for-bucket-map\u2466" }, { "id": "ref-for-bucket-map\u2467" }], "title": "8. API" }], "url": "#bucket-map" },
                "bucket-mode": { "dfnID": "bucket-mode", "dfnText": "mode", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-bucket-mode" }, { "id": "ref-for-bucket-mode\u2460" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-bucket-mode\u2461" }, { "id": "ref-for-bucket-mode\u2462" }], "title": "7.1. Storage pressure" }, { "refs": [{ "id": "ref-for-bucket-mode\u2463" }, { "id": "ref-for-bucket-mode\u2464" }, { "id": "ref-for-bucket-mode\u2465" }], "title": "8. API" }], "url": "#bucket-mode" },
                "c3b2d08c": { "dfnID": "c3b2d08c", "dfnText": "task source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-task-source" }], "title": "4.8. Storage task source" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "c6ce3c60": { "dfnID": "c6ce3c60", "dfnText": "granted", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-permissionstate-granted" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-dom-permissionstate-granted\u2460" }], "title": "8. API" }], "url": "https://w3c.github.io/permissions/#dom-permissionstate-granted" },
                "create-a-storage-bucket": { "dfnID": "create-a-storage-bucket", "dfnText": "create a storage bucket", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-storage-bucket" }], "title": "4.4. Storage shelves" }], "url": "#create-a-storage-bucket" },
                "create-a-storage-shelf": { "dfnID": "create-a-storage-shelf", "dfnText": "create a storage shelf", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-storage-shelf" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-create-a-storage-shelf\u2460" }], "title": "4.4. Storage shelves" }], "url": "#create-a-storage-shelf" },
                "d0c1b934": { "dfnID": "d0c1b934", "dfnText": "traversable navigable", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-traversable-navigable" }, { "id": "ref-for-traversable-navigable\u2460" }, { "id": "ref-for-traversable-navigable\u2461" }, { "id": "ref-for-traversable-navigable\u2462" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-traversable-navigable\u2463" }, { "id": "ref-for-traversable-navigable\u2464" }, { "id": "ref-for-traversable-navigable\u2465" }], "title": "7.1. Storage pressure" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" },
                "d124397f": { "dfnID": "d124397f", "dfnText": "permission state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-state" }, { "id": "ref-for-dfn-permission-state\u2460" }], "title": "5. Persistence permission" }], "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "d14a6f26": { "dfnID": "d14a6f26", "dfnText": "key", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-key" }], "title": "4.4. Storage shelves" }], "url": "https://infra.spec.whatwg.org/#map-key" },
                "d357c753": { "dfnID": "d357c753", "dfnText": "requesting permission to use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-request-permission-to-use" }], "title": "8. API" }], "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "dacde8b5": { "dfnID": "dacde8b5", "dfnText": "a new promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-a-new-promise" }, { "id": "ref-for-a-new-promise\u2460" }, { "id": "ref-for-a-new-promise\u2461" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "dc3369de": { "dfnID": "dc3369de", "dfnText": "is empty", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-is-empty" }], "title": "7. Management" }], "url": "https://infra.spec.whatwg.org/#map-is-empty" },
                "dictdef-storageestimate": { "dfnID": "dictdef-storageestimate", "dfnText": "StorageEstimate", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-storageestimate" }, { "id": "ref-for-dictdef-storageestimate\u2460" }], "title": "8. API" }], "url": "#dictdef-storageestimate" },
                "dom-navigatorstorage-storage": { "dfnID": "dom-navigatorstorage-storage", "dfnText": "storage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-navigatorstorage-storage" }], "title": "8. API" }], "url": "#dom-navigatorstorage-storage" },
                "dom-storageestimate-quota": { "dfnID": "dom-storageestimate-quota", "dfnText": "quota", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-storageestimate-quota" }], "title": "8. API" }], "url": "#dom-storageestimate-quota" },
                "dom-storageestimate-usage": { "dfnID": "dom-storageestimate-usage", "dfnText": "usage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-storageestimate-usage" }], "title": "8. API" }], "url": "#dom-storageestimate-usage" },
                "dom-storagemanager-estimate": { "dfnID": "dom-storagemanager-estimate", "dfnText": "estimate()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-storagemanager-estimate" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-storagemanager-estimate\u2460" }], "title": "8. API" }], "url": "#dom-storagemanager-estimate" },
                "dom-storagemanager-persist": { "dfnID": "dom-storagemanager-persist", "dfnText": "persist()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-storagemanager-persist" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-storagemanager-persist\u2460" }], "title": "8. API" }], "url": "#dom-storagemanager-persist" },
                "dom-storagemanager-persisted": { "dfnID": "dom-storagemanager-persisted", "dfnText": "persisted()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-storagemanager-persisted" }], "title": "8. API" }], "url": "#dom-storagemanager-persisted" },
                "e270bd2a": { "dfnID": "e270bd2a", "dfnText": "task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task" }], "title": "4.8. Storage task source" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "e99bd18e": { "dfnID": "e99bd18e", "dfnText": "relevant global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-global" }, { "id": "ref-for-concept-relevant-global\u2460" }, { "id": "ref-for-concept-relevant-global\u2461" }], "title": "8. API" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "f14b47b8": { "dfnID": "f14b47b8", "dfnText": "unsigned long long", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-unsigned-long-long" }, { "id": "ref-for-idl-unsigned-long-long\u2460" }], "title": "8. API" }], "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "f6e4cbfd": { "dfnID": "f6e4cbfd", "dfnText": "agent cluster", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sec-agent-clusters" }], "title": "4.6. Storage bottles" }], "url": "https://tc39.github.io/ecma262/#sec-agent-clusters" },
                "fa5ee9c5": { "dfnID": "fa5ee9c5", "dfnText": "creation url", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-environment-creation-url" }], "title": "4.2. Storage keys" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" },
                "legacy-clone-a-traversable-storage-shed": { "dfnID": "legacy-clone-a-traversable-storage-shed", "dfnText": "legacy-clone a traversable storage shed", "external": false, "refSections": [], "url": "#legacy-clone-a-traversable-storage-shed" },
                "local-storage": { "dfnID": "local-storage", "dfnText": "local storage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-local-storage" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-local-storage\u2460" }], "title": "4.5. Storage buckets" }], "url": "#local-storage" },
                "navigatorstorage": { "dfnID": "navigatorstorage", "dfnText": "NavigatorStorage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-navigatorstorage" }, { "id": "ref-for-navigatorstorage\u2460" }], "title": "8. API" }], "url": "#navigatorstorage" },
                "obtain-a-local-storage-bottle-map": { "dfnID": "obtain-a-local-storage-bottle-map", "dfnText": "obtain a local storage bottle map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-local-storage-bottle-map" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-obtain-a-local-storage-bottle-map\u2460" }], "title": "4.1. Storage endpoints" }], "url": "#obtain-a-local-storage-bottle-map" },
                "obtain-a-local-storage-shelf": { "dfnID": "obtain-a-local-storage-shelf", "dfnText": "obtain a local storage shelf", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-local-storage-shelf" }], "title": "5. Persistence permission" }, { "refs": [{ "id": "ref-for-obtain-a-local-storage-shelf\u2460" }, { "id": "ref-for-obtain-a-local-storage-shelf\u2461" }, { "id": "ref-for-obtain-a-local-storage-shelf\u2462" }], "title": "8. API" }], "url": "#obtain-a-local-storage-shelf" },
                "obtain-a-session-storage-bottle-map": { "dfnID": "obtain-a-session-storage-bottle-map", "dfnText": "obtain a session storage bottle map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-session-storage-bottle-map" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-obtain-a-session-storage-bottle-map\u2460" }], "title": "4.1. Storage endpoints" }], "url": "#obtain-a-session-storage-bottle-map" },
                "obtain-a-storage-bottle-map": { "dfnID": "obtain-a-storage-bottle-map", "dfnText": "obtain a storage bottle map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-storage-bottle-map" }, { "id": "ref-for-obtain-a-storage-bottle-map\u2460" }], "title": "4.6. Storage bottles" }], "url": "#obtain-a-storage-bottle-map" },
                "obtain-a-storage-key": { "dfnID": "obtain-a-storage-key", "dfnText": "obtain a storage key", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-storage-key" }], "title": "4.4. Storage shelves" }], "url": "#obtain-a-storage-key" },
                "obtain-a-storage-key-for-non-storage-purposes": { "dfnID": "obtain-a-storage-key-for-non-storage-purposes", "dfnText": "obtain a storage key for non-storage purposes", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-storage-key-for-non-storage-purposes" }], "title": "4.2. Storage keys" }], "url": "#obtain-a-storage-key-for-non-storage-purposes" },
                "obtain-a-storage-shelf": { "dfnID": "obtain-a-storage-shelf", "dfnText": "obtain a storage shelf", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-storage-shelf" }, { "id": "ref-for-obtain-a-storage-shelf\u2460" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-obtain-a-storage-shelf\u2461" }], "title": "4.6. Storage bottles" }], "url": "#obtain-a-storage-shelf" },
                "queue-a-storage-task": { "dfnID": "queue-a-storage-task", "dfnText": "queue a storage task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-storage-task" }, { "id": "ref-for-queue-a-storage-task\u2460" }, { "id": "ref-for-queue-a-storage-task\u2461" }, { "id": "ref-for-queue-a-storage-task\u2462" }], "title": "8. API" }], "url": "#queue-a-storage-task" },
                "registered-storage-endpoints": { "dfnID": "registered-storage-endpoints", "dfnText": "registered storage endpoints", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-registered-storage-endpoints" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-registered-storage-endpoints\u2460" }], "title": "4.5. Storage buckets" }], "url": "#registered-storage-endpoints" },
                "session-storage": { "dfnID": "session-storage", "dfnText": "session storage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-session-storage" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-session-storage\u2460" }], "title": "4.5. Storage buckets" }], "url": "#session-storage" },
                "session-storage-bucket": { "dfnID": "session-storage-bucket", "dfnText": "session storage bucket", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-session-storage-bucket" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-session-storage-bucket\u2460" }], "title": "7.1. Storage pressure" }], "url": "#session-storage-bucket" },
                "storage-bottle": { "dfnID": "storage-bottle", "dfnText": "storage bottle", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-bottle" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-bottle\u2460" }, { "id": "ref-for-storage-bottle\u2461" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-bottle\u2462" }, { "id": "ref-for-storage-bottle\u2463" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-bottle\u2464" }, { "id": "ref-for-storage-bottle\u2465" }, { "id": "ref-for-storage-bottle\u2466" }, { "id": "ref-for-storage-bottle\u2467" }], "title": "4.6. Storage bottles" }], "url": "#storage-bottle" },
                "storage-bottle-map": { "dfnID": "storage-bottle-map", "dfnText": "map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-bottle-map" }, { "id": "ref-for-storage-bottle-map\u2460" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-storage-bottle-map\u2461" }, { "id": "ref-for-storage-bottle-map\u2462" }], "title": "4.6. Storage bottles" }], "url": "#storage-bottle-map" },
                "storage-bottle-proxy-map-reference-set": { "dfnID": "storage-bottle-proxy-map-reference-set", "dfnText": "proxy map reference set", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-bottle-proxy-map-reference-set" }], "title": "4.6. Storage bottles" }], "url": "#storage-bottle-proxy-map-reference-set" },
                "storage-bottle-quota": { "dfnID": "storage-bottle-quota", "dfnText": "quota", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-bottle-quota" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-bottle-quota\u2460" }], "title": "4.5. Storage buckets" }], "url": "#storage-bottle-quota" },
                "storage-bucket": { "dfnID": "storage-bucket", "dfnText": "storage bucket", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-bucket" }, { "id": "ref-for-storage-bucket\u2460" }, { "id": "ref-for-storage-bucket\u2461" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-bucket\u2462" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-storage-bucket\u2463" }, { "id": "ref-for-storage-bucket\u2464" }, { "id": "ref-for-storage-bucket\u2465" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-bucket\u2466" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-storage-bucket\u2467" }, { "id": "ref-for-storage-bucket\u2468" }, { "id": "ref-for-storage-bucket\u2460\u24ea" }], "title": "7. Management" }], "url": "#storage-bucket" },
                "storage-endpoint": { "dfnID": "storage-endpoint", "dfnText": "storage endpoint", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-endpoint" }, { "id": "ref-for-storage-endpoint\u2460" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-endpoint\u2461" }, { "id": "ref-for-storage-endpoint\u2462" }, { "id": "ref-for-storage-endpoint\u2463" }, { "id": "ref-for-storage-endpoint\u2464" }, { "id": "ref-for-storage-endpoint\u2465" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-endpoint\u2466" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-endpoint\u2467" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-storage-endpoint\u2468" }, { "id": "ref-for-storage-endpoint\u2460\u24ea" }], "title": "4.8. Storage task source" }], "url": "#storage-endpoint" },
                "storage-endpoint-identifier": { "dfnID": "storage-endpoint-identifier", "dfnText": "identifier", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-endpoint-identifier" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-endpoint-identifier\u2460" }], "title": "4.5. Storage buckets" }], "url": "#storage-endpoint-identifier" },
                "storage-endpoint-quota": { "dfnID": "storage-endpoint-quota", "dfnText": "quota", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-endpoint-quota" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-endpoint-quota\u2460" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-endpoint-quota\u2461" }], "title": "4.8. Storage task source" }], "url": "#storage-endpoint-quota" },
                "storage-endpoint-types": { "dfnID": "storage-endpoint-types", "dfnText": "types", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-endpoint-types" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-endpoint-types\u2460" }], "title": "4.5. Storage buckets" }], "url": "#storage-endpoint-types" },
                "storage-identifier": { "dfnID": "storage-identifier", "dfnText": "storage identifier", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-identifier" }, { "id": "ref-for-storage-identifier\u2460" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-identifier\u2461" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-identifier\u2462" }, { "id": "ref-for-storage-identifier\u2463" }, { "id": "ref-for-storage-identifier\u2464" }], "title": "4.6. Storage bottles" }], "url": "#storage-identifier" },
                "storage-key": { "dfnID": "storage-key", "dfnText": "storage key", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-key" }, { "id": "ref-for-storage-key\u2460" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-key\u2461" }, { "id": "ref-for-storage-key\u2462" }], "title": "4.2. Storage keys" }, { "refs": [{ "id": "ref-for-storage-key\u2463" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-storage-key\u2464" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-storage-key\u2465" }], "title": "7. Management" }], "url": "#storage-key" },
                "storage-key-equal": { "dfnID": "storage-key-equal", "dfnText": "equals", "external": false, "refSections": [], "url": "#storage-key-equal" },
                "storage-key-origin": { "dfnID": "storage-key-origin", "dfnText": "origin", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-key-origin" }, { "id": "ref-for-storage-key-origin\u2460" }, { "id": "ref-for-storage-key-origin\u2461" }], "title": "4.2. Storage keys" }], "url": "#storage-key-origin" },
                "storage-proxy-map": { "dfnID": "storage-proxy-map", "dfnText": "storage proxy map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-proxy-map" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-proxy-map\u2460" }], "title": "4.6. Storage bottles" }], "url": "#storage-proxy-map" },
                "storage-proxy-map-backing-map": { "dfnID": "storage-proxy-map-backing-map", "dfnText": "backing map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-proxy-map-backing-map" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-storage-proxy-map-backing-map\u2460" }], "title": "4.7. Storage proxy maps" }], "url": "#storage-proxy-map-backing-map" },
                "storage-quota": { "dfnID": "storage-quota", "dfnText": "storage quota", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-quota" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-storage-quota\u2460" }], "title": "8. API" }], "url": "#storage-quota" },
                "storage-shed": { "dfnID": "storage-shed", "dfnText": "storage shed", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-shed" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-shed\u2460" }, { "id": "ref-for-storage-shed\u2461" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-storage-shed\u2462" }, { "id": "ref-for-storage-shed\u2463" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-storage-shed\u2464" }], "title": "7. Management" }], "url": "#storage-shed" },
                "storage-shelf": { "dfnID": "storage-shelf", "dfnText": "storage shelf", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-shelf" }, { "id": "ref-for-storage-shelf\u2460" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-shelf\u2461" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-storage-shelf\u2462" }, { "id": "ref-for-storage-shelf\u2463" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-storage-shelf\u2464" }], "title": "4.6. Storage bottles" }, { "refs": [{ "id": "ref-for-storage-shelf\u2465" }, { "id": "ref-for-storage-shelf\u2466" }, { "id": "ref-for-storage-shelf\u2467" }], "title": "6. Usage and quota" }, { "refs": [{ "id": "ref-for-storage-shelf\u2468" }, { "id": "ref-for-storage-shelf\u2460\u24ea" }], "title": "7. Management" }], "url": "#storage-shelf" },
                "storage-type": { "dfnID": "storage-type", "dfnText": "storage type", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-type" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-storage-type\u2460" }, { "id": "ref-for-storage-type\u2461" }], "title": "4.1. Storage endpoints" }, { "refs": [{ "id": "ref-for-storage-type\u2462" }, { "id": "ref-for-storage-type\u2463" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-storage-type\u2464" }], "title": "4.5. Storage buckets" }, { "refs": [{ "id": "ref-for-storage-type\u2465" }], "title": "4.6. Storage bottles" }], "url": "#storage-type" },
                "storage-usage": { "dfnID": "storage-usage", "dfnText": "storage usage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-usage" }], "title": "8. API" }], "url": "#storage-usage" },
                "storagemanager": { "dfnID": "storagemanager", "dfnText": "StorageManager", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storagemanager" }, { "id": "ref-for-storagemanager\u2460" }, { "id": "ref-for-storagemanager\u2461" }], "title": "8. API" }], "url": "#storagemanager" },
                "task-source": { "dfnID": "task-source", "dfnText": "storage task source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-source\u2460" }], "title": "4.8. Storage task source" }], "url": "#task-source" },
                "traversable-navigable-storage-shed": { "dfnID": "traversable-navigable-storage-shed", "dfnText": "storage shed", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-traversable-navigable-storage-shed" }, { "id": "ref-for-traversable-navigable-storage-shed\u2460" }, { "id": "ref-for-traversable-navigable-storage-shed\u2461" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-traversable-navigable-storage-shed\u2462" }], "title": "4.6. Storage bottles" }], "url": "#traversable-navigable-storage-shed" },
                "user-agent-storage-shed": { "dfnID": "user-agent-storage-shed", "dfnText": "storage shed", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-user-agent-storage-shed" }], "title": "4.3. Storage sheds" }, { "refs": [{ "id": "ref-for-user-agent-storage-shed\u2460" }], "title": "4.4. Storage shelves" }, { "refs": [{ "id": "ref-for-user-agent-storage-shed\u2461" }], "title": "4.6. Storage bottles" }], "url": "#user-agent-storage-shed" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getRootLevelAbsolutePosition(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // Returns the root-level absolute position {left and top} of element.
            function getRootLevelAbsolutePosition(el) {
                const boundsRect = el.getBoundingClientRect();
                let xPos = 0;
                let yPos = 0;

                while (el) {
                    let xScroll = el.scrollLeft;
                    let yScroll = el.scrollTop;

                    // Ignore scrolling of body.
                    if (el.tagName === "BODY") {
                        xScroll = 0;
                        yScroll = 0;
                    }
                    xPos += (el.offsetLeft - xScroll + el.clientLeft);
                    yPos += (el.offsetTop - yScroll + el.clientTop);

                    el = el.offsetParent;
                }
                return {
                    left: xPos,
                    top: yPos,
                    right: xPos + boundsRect.width,
                    bottom: yPos + boundsRect.height,
                };
            }

            function scrolledIntoView(element) {
                const rect = element.getBoundingClientRect();
                return (
                    rect.top > 0 &&
                    rect.bottom < window.innerHeight
                );
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        // Maybe prevent default scroll.
                        if (scrolledIntoView(dest)) {
                            event.preventDefault();
                        }
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-position-annos */
        "use strict";
        {
            function repositionAnnoPanels() {
                const panels = [...document.querySelectorAll("[data-anno-for]")];
                hydratePanels(panels);
                let vSoFar = 0;
                for (const panel of panels.sort(cmpTops)) {
                    if (panel.top < vSoFar) {
                        panel.top = vSoFar;
                        panel.style.top = vSoFar + "px";
                    }
                    vSoFar = panel.top + panel.height + 15;
                }
            }
            function hydratePanels(panels) {
                const main = document.querySelector("main");
                let mainRect;
                if (main) mainRect = main.getBoundingClientRect();
                // First display them all, if they're not already visible.
                for (const panel of panels) {
                    panel.classList.remove("unpositioned");
                }
                // Measure them all
                for (const panel of panels) {
                    const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
                    if (!dfn) {
                        console.log("Can't find the annotation panel target:", panel);
                        continue;
                    }
                    panel.dfn = dfn;
                    panel.top = window.scrollY + dfn.getBoundingClientRect().top;
                    let panelRect = panel.getBoundingClientRect();
                    panel.height = panelRect.height;
                    if (main) {
                        panel.overlappingMain = panelRect.left < mainRect.right;
                    } else {
                        panel.overlappingMain = false;
                    }
                }
                // And finally position them
                for (const panel of panels) {
                    const dfn = panel.dfn;
                    if (!dfn) continue;
                    panel.style.top = panel.top + "px";
                    panel.classList.toggle("overlapping-main", panel.overlappingMain);
                }
            }

            function cmpTops(a, b) {
                return a.top - b.top;
            }

            window.addEventListener("load", repositionAnnoPanels);
            window.addEventListener("resize", repositionAnnoPanels);
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#bottle-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "bottle map", "type": "dfn", "url": "#bottle-map" },
                "#bucket": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "local storage bucket", "type": "dfn", "url": "#bucket" },
                "#bucket-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "bucket map", "type": "dfn", "url": "#bucket-map" },
                "#bucket-mode": { "export": true, "for_": ["local storage bucket"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "mode", "type": "dfn", "url": "#bucket-mode" },
                "#create-a-storage-bucket": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "create a storage bucket", "type": "dfn", "url": "#create-a-storage-bucket" },
                "#create-a-storage-shelf": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "create a storage shelf", "type": "dfn", "url": "#create-a-storage-shelf" },
                "#dictdef-storageestimate": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "StorageEstimate", "type": "dictionary", "url": "#dictdef-storageestimate" },
                "#dom-navigatorstorage-storage": { "export": true, "for_": ["NavigatorStorage"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage", "type": "attribute", "url": "#dom-navigatorstorage-storage" },
                "#dom-storageestimate-quota": { "export": true, "for_": ["StorageEstimate"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "quota", "type": "dict-member", "url": "#dom-storageestimate-quota" },
                "#dom-storageestimate-usage": { "export": true, "for_": ["StorageEstimate"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "usage", "type": "dict-member", "url": "#dom-storageestimate-usage" },
                "#dom-storagemanager-estimate": { "export": true, "for_": ["StorageManager"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "estimate()", "type": "method", "url": "#dom-storagemanager-estimate" },
                "#dom-storagemanager-persist": { "export": true, "for_": ["StorageManager"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "persist()", "type": "method", "url": "#dom-storagemanager-persist" },
                "#dom-storagemanager-persisted": { "export": true, "for_": ["StorageManager"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "persisted()", "type": "method", "url": "#dom-storagemanager-persisted" },
                "#local-storage": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "local storage", "type": "dfn", "url": "#local-storage" },
                "#navigatorstorage": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "NavigatorStorage", "type": "interface", "url": "#navigatorstorage" },
                "#obtain-a-local-storage-bottle-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a local storage bottle map", "type": "dfn", "url": "#obtain-a-local-storage-bottle-map" },
                "#obtain-a-local-storage-shelf": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a local storage shelf", "type": "dfn", "url": "#obtain-a-local-storage-shelf" },
                "#obtain-a-session-storage-bottle-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a session storage bottle map", "type": "dfn", "url": "#obtain-a-session-storage-bottle-map" },
                "#obtain-a-storage-bottle-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a storage bottle map", "type": "dfn", "url": "#obtain-a-storage-bottle-map" },
                "#obtain-a-storage-key": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a storage key", "type": "dfn", "url": "#obtain-a-storage-key" },
                "#obtain-a-storage-key-for-non-storage-purposes": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a storage key for non-storage purposes", "type": "dfn", "url": "#obtain-a-storage-key-for-non-storage-purposes" },
                "#obtain-a-storage-shelf": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "obtain a storage shelf", "type": "dfn", "url": "#obtain-a-storage-shelf" },
                "#queue-a-storage-task": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "queue a storage task", "type": "dfn", "url": "#queue-a-storage-task" },
                "#registered-storage-endpoints": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "registered storage endpoints", "type": "dfn", "url": "#registered-storage-endpoints" },
                "#session-storage": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "session storage", "type": "dfn", "url": "#session-storage" },
                "#session-storage-bucket": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "session storage bucket", "type": "dfn", "url": "#session-storage-bucket" },
                "#storage-bottle": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage bottle", "type": "dfn", "url": "#storage-bottle" },
                "#storage-bottle-map": { "export": true, "for_": ["storage bottle"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "map", "type": "dfn", "url": "#storage-bottle-map" },
                "#storage-bottle-proxy-map-reference-set": { "export": true, "for_": ["storage bottle"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "proxy map reference set", "type": "dfn", "url": "#storage-bottle-proxy-map-reference-set" },
                "#storage-bottle-quota": { "export": true, "for_": ["storage bottle"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "quota", "type": "dfn", "url": "#storage-bottle-quota" },
                "#storage-bucket": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage bucket", "type": "dfn", "url": "#storage-bucket" },
                "#storage-endpoint": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage endpoint", "type": "dfn", "url": "#storage-endpoint" },
                "#storage-endpoint-identifier": { "export": true, "for_": ["storage endpoint"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "identifier", "type": "dfn", "url": "#storage-endpoint-identifier" },
                "#storage-endpoint-quota": { "export": true, "for_": ["storage endpoint"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "quota", "type": "dfn", "url": "#storage-endpoint-quota" },
                "#storage-endpoint-types": { "export": true, "for_": ["storage endpoint"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "types", "type": "dfn", "url": "#storage-endpoint-types" },
                "#storage-identifier": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage identifier", "type": "dfn", "url": "#storage-identifier" },
                "#storage-key": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage key", "type": "dfn", "url": "#storage-key" },
                "#storage-key-origin": { "export": true, "for_": ["storage key"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "origin", "type": "dfn", "url": "#storage-key-origin" },
                "#storage-proxy-map": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage proxy map", "type": "dfn", "url": "#storage-proxy-map" },
                "#storage-proxy-map-backing-map": { "export": true, "for_": ["storage proxy map"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "backing map", "type": "dfn", "url": "#storage-proxy-map-backing-map" },
                "#storage-quota": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage quota", "type": "dfn", "url": "#storage-quota" },
                "#storage-shed": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage shed", "type": "dfn", "url": "#storage-shed" },
                "#storage-shelf": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage shelves", "type": "dfn", "url": "#storage-shelf" },
                "#storage-type": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage type", "type": "dfn", "url": "#storage-type" },
                "#storage-usage": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage usage", "type": "dfn", "url": "#storage-usage" },
                "#storagemanager": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "StorageManager", "type": "interface", "url": "#storagemanager" },
                "#task-source": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage task source", "type": "dfn", "url": "#task-source" },
                "#traversable-navigable-storage-shed": { "export": true, "for_": ["traversable navigable"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage shed", "type": "dfn", "url": "#traversable-navigable-storage-shed" },
                "#user-agent-storage-shed": { "export": true, "for_": ["user agent"], "level": "", "normative": true, "shortname": "storage", "spec": "storage", "status": "local", "text": "storage shed", "type": "dfn", "url": "#user-agent-storage-shed" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "opaque origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" },
                "https://html.spec.whatwg.org/multipage/browsers.html#same-origin": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "same origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable": { "export": true, "for_": ["navigable"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "traversable navigable", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "node navigable", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "traversable navigable", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" },
                "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "in parallel", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "associated document", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "https://html.spec.whatwg.org/multipage/system-state.html#navigator": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "Navigator", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url": { "export": true, "for_": ["environment"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "creation url", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": { "export": true, "for_": ["environment settings object"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "current settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#environment": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "environment", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "environment settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#global-object": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#global-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "queue a global task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#task-source": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task source", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "https://html.spec.whatwg.org/multipage/workers.html#workernavigator": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "WorkerNavigator", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator" },
                "https://infra.spec.whatwg.org/#ascii-string": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "ascii string", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ascii-string" },
                "https://infra.spec.whatwg.org/#implementation-defined": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "implementation-defined", "type": "dfn", "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "https://infra.spec.whatwg.org/#list-contain": { "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "contain", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-contain" },
                "https://infra.spec.whatwg.org/#list-iterate": { "export": true, "for_": ["list", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "for each", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "https://infra.spec.whatwg.org/#map-clone": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "clone", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-clone" },
                "https://infra.spec.whatwg.org/#map-exists": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "exist", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-exists" },
                "https://infra.spec.whatwg.org/#map-is-empty": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "is empty", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-is-empty" },
                "https://infra.spec.whatwg.org/#map-iterate": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "for each", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-iterate" },
                "https://infra.spec.whatwg.org/#map-key": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "key", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-key" },
                "https://infra.spec.whatwg.org/#map-remove": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "remove", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-remove" },
                "https://infra.spec.whatwg.org/#map-value": { "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "value", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-value" },
                "https://infra.spec.whatwg.org/#ordered-map": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "map", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "https://infra.spec.whatwg.org/#ordered-set": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "set", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "https://infra.spec.whatwg.org/#set-append": { "export": true, "for_": ["set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "append", "type": "dfn", "url": "https://infra.spec.whatwg.org/#set-append" },
                "https://infra.spec.whatwg.org/#string": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "string", "type": "dfn", "url": "https://infra.spec.whatwg.org/#string" },
                "https://infra.spec.whatwg.org/#tuple": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "tuple", "type": "dfn", "url": "https://infra.spec.whatwg.org/#tuple" },
                "https://infra.spec.whatwg.org/#user-agent": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "user agent", "type": "dfn", "url": "https://infra.spec.whatwg.org/#user-agent" },
                "https://tc39.github.io/ecma262/#sec-agent-clusters": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "anchor-block", "text": "agent cluster", "type": "dfn", "url": "https://tc39.github.io/ecma262/#sec-agent-clusters" },
                "https://tc39.github.io/ecma262/#sec-agents": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "anchor-block", "text": "agent", "type": "dfn", "url": "https://tc39.github.io/ecma262/#sec-agents" },
                "https://url.spec.whatwg.org/#concept-url-origin": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "origin", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "getting the current permission state", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state" },
                "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm": { "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission revocation algorithm", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm" },
                "https://w3c.github.io/permissions/#dfn-permission-state": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission state", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "https://w3c.github.io/permissions/#dfn-powerful-feature": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "powerful feature", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "https://w3c.github.io/permissions/#dfn-request-permission-to-use": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "requesting permission to use", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "https://w3c.github.io/permissions/#dom-permissionstate-granted": { "export": true, "for_": ["PermissionState"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "granted", "type": "enum-value", "url": "https://w3c.github.io/permissions/#dom-permissionstate-granted" },
                "https://webidl.spec.whatwg.org/#Exposed": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#SameObject": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SameObject", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#SameObject" },
                "https://webidl.spec.whatwg.org/#SecureContext": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SecureContext", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "https://webidl.spec.whatwg.org/#a-new-promise": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "a new promise", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "https://webidl.spec.whatwg.org/#exceptiondef-typeerror": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "TypeError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror" },
                "https://webidl.spec.whatwg.org/#idl-boolean": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "boolean", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "https://webidl.spec.whatwg.org/#idl-promise": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Promise", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "https://webidl.spec.whatwg.org/#idl-unsigned-long-long": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "unsigned long long", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "https://webidl.spec.whatwg.org/#reject": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "reject", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#reject" },
                "https://webidl.spec.whatwg.org/#resolve": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "resolve", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#resolve" },
                "https://webidl.spec.whatwg.org/#this": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.text != linkText) {
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.text)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const ref = refsData[url];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getRootLevelAbsolutePosition(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getRootLevelAbsolutePosition(el) {
                const boundsRect = el.getBoundingClientRect();
                let xPos = 0;
                let yPos = 0;

                while (el) {
                    let xScroll = el.scrollLeft;
                    let yScroll = el.scrollTop;

                    // Ignore scrolling of body.
                    if (el.tagName === "BODY") {
                        xScroll = 0;
                        yScroll = 0;
                    }
                    xPos += (el.offsetLeft - xScroll + el.clientLeft);
                    yPos += (el.offsetTop - yScroll + el.clientTop);

                    el = el.offsetParent;
                }
                return {
                    left: xPos,
                    top: yPos,
                    right: xPos + boundsRect.width,
                    bottom: yPos + boundsRect.height,
                };
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mouseover", e => {
                    let link = e.target.closest("a");
                    if (link) showRefHint(link);
                });
                document.body.addEventListener("focus", e => {
                    let link = e.target.closest("a");
                    if (link) showRefHint(link);
                });

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all link panels.
                    hideAllRefHints();
                });
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>
