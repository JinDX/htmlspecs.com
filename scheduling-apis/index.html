<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>优先级任务调度</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
    <!-- <meta content="Bikeshed version 9a7a6709a, updated Tue May 27 16:45:34 2025 -0700" name="generator"> -->
    <link href="https://wicg.github.io/scheduling-apis/" rel="canonical">
    <!-- <meta content="0e7fece76e188c05a9e6f415264acc4423b8de58" name="revision"> -->
    <meta content="dark light" name="color-scheme">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">
    <style>
        /*
 * Put nice boxes around each algorithm.
 *
 * This is in bikeshed's stylesheet.include, but not in W3C's base.css. And
 * since stylesheet.include is not longer inlined when we link to it, this
 * is omitted.
 *
 * The culprit might be:
 * https://github.com/tabatkins/bikeshed/commit/90652a820d408493d429e471a35a9c4a628d9f60
 */
        [data-algorithm]:not(.heading) {
            padding: .5em;
            border: thin solid #ddd;
            border-radius: .5em;
            margin: .5em calc(-0.5em - 1px);
        }

        [data-algorithm]:not(.heading)> :first-child {
            margin-top: 0;
        }

        [data-algorithm]:not(.heading)> :last-child {
            margin-bottom: 0;
        }

        /* domintro from https://resources.whatwg.org/standard.css */
        .domintro {
            position: relative;
            color: green;
            background: #DDFFDD;
            margin: 2.5em 0 2em 0;
            padding: 1.5em 1em 0.5em 2em;
        }

        .domintro dt,
        .domintro dt * {
            color: black;
            font-size: inherit;
        }

        .domintro dd {
            margin: 0.5em 0 1em 2em;
            padding: 0;
        }

        .domintro dd p {
            margin: 0.5em 0;
        }

        .domintro::before {
            content: 'For web developers (non-normative)';
            background: green;
            color: white;
            padding: 0.15em 0.25em;
            font-style: normal;
            position: absolute;
            top: -0.8em;
            left: -0.8em;
        }

        /* WHATWG-style <hr>s, instead of WICG-style. Specific selector is necessary to override WICG styles. */
        :not(.head)> :not(.head)+hr {
            display: block;
            background: none;
            border: none;
            padding: 0;
            margin: 2em 0;
            height: auto;
        }

        :not(.head)> :not(.head)+hr::before {
            content: none;
        }
    </style>
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-mdn-anno */
        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
            --mdn-pass: green;
            --mdn-fail: red;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --mdn-bg: #222;
                --mdn-shadow: #444;
                --mdn-nosupport-text: #666;
                --mdn-pass: #690;
                --mdn-fail: #d22;
            }
        }

        .mdn-anno {
            background: var(--mdn-bg, #EEE);
            border-radius: .25em;
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            color: var(--text, black);
            font: 1em sans-serif;
            hyphens: none;
            max-width: min-content;
            overflow: hidden;
            padding: 0.2em;
            position: absolute;
            right: 0.3em;
            top: auto;
            white-space: nowrap;
            word-wrap: normal;
            z-index: 8;
        }

        .mdn-anno.unpositioned {
            display: none;
        }

        .mdn-anno.overlapping-main {
            opacity: .2;
            transition: opacity .1s;
        }

        .mdn-anno[open] {
            opacity: 1;
            z-index: 9;
            min-width: 9em;
        }

        .mdn-anno:hover {
            opacity: 1;
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>summary {
            font-weight: normal;
            text-align: right;
            cursor: pointer;
            display: block;
        }

        .mdn-anno>summary>.less-than-two-engines-flag {
            color: var(--mdn-fail);
            padding-right: 2px;
        }

        .mdn-anno>summary>.all-engines-flag {
            color: var(--mdn-pass);
            padding-right: 2px;
        }

        .mdn-anno>summary>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: var(--mdn-fail);
        }

        .mdn-anno>.feature>.all-engines-text {
            color: var(--mdn-pass);
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color] {
            background-color: var(--var-bg);
            box-shadow: 0 0 0 2px var(--var-bg);
        }

        var[data-var-color] {
            --var-bg: #F4D200;
        }

        var[data-var-color="1"] {
            --var-bg: #FF87A2;
        }

        var[data-var-color="2"] {
            --var-bg: #96E885;
        }

        var[data-var-color="3"] {
            --var-bg: #3EEED2;
        }

        var[data-var-color="4"] {
            --var-bg: #EACFB6;
        }

        var[data-var-color="5"] {
            --var-bg: #82DDFF;
        }

        var[data-var-color="6"] {
            --var-vg: #FFBCF2;
        }

        @media (prefers-color-scheme: dark) {
            var[data-var-color] {
                --var-bg: #bc1a00;
            }

            var[data-var-color="1"] {
                --var-bg: #007f00;
            }

            var[data-var-color="2"] {
                --var-bg: #008698;
            }

            var[data-var-color="3"] {
                --var-bg: #7f5b2b;
            }

            var[data-var-color="4"] {
                --var-bg: #004df3;
            }

            var[data-var-color="5"] {
                --var-bg: #a1248a;
            }

            var[data-var-color="6"] {
                --var-vg: #ff0000;
            }
        }
    </style>

<body class="h-entry">
    <div class="head">
        <h1 class="p-name no-ref" id="title">优先级任务调度</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">社区组草案报告</a>, <time class="dt-updated"
                datetime="2025-05-30">2025年5月30日</time></p>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>此版本：
                <dd><a class="u-url"
                        href="https://wicg.github.io/scheduling-apis/">https://wicg.github.io/scheduling-apis/</a>
                <dt>问题追踪：
                <dd><a href="https://github.com/wicg/scheduling-apis/issues/">GitHub</a>
                <dd><a href="#issues-index">规范内标注</a>
                <dt class="editor">编辑：
                <dd class="editor p-author h-card vcard" data-editor-id="122093"><a class="p-name fn u-email email"
                        href="mailto:shaseley@google.com">Scott Haseley</a> (<a class="p-org org"
                        href="https://google.com/">Google</a>)
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2025 the Contributors to the Prioritized Task Scheduling Specification, published by the <a
                href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a
                href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement
                (CLA)</a>.
            A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本规范定义了用于调度和控制优先级任务的API。</p>
    </div>
    <div data-fill-with="at-risk"></div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文档状态</span>
    </h2>
    <div data-fill-with="status">
        <p> 本规范由<a href="https://www.w3.org/community/wicg/">Web平台孵化社区组</a>发布。
            它不是W3C标准，也不在W3C标准制定流程中。

            请注意，根据<a href="https://www.w3.org/community/about/agreements/cla/">W3C社区贡献者许可协议（CLA）</a>，有有限的选择退出权利并适用其他条件。

            了解更多关于<a href="http://www.w3.org/community/">W3C社区与业务组</a>的信息。 </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#intro"><span class="secno">1</span> <span class="content">简介</span></a>
            <li>
                <a href="#sec-scheduling-tasks-and-continuations"><span class="secno">2</span> <span
                        class="content">任务与续作的调度</span></a>
                <ol class="toc">
                    <li><a href="#sec-task-priorities"><span class="secno">2.1</span> <span
                                class="content">任务和续作优先级</span></a>
                    <li><a href="#sec-scheduler"><span class="secno">2.2</span> <span class="content">
                                <code>Scheduler</code>接口</span></a>
                    <li><a href="#sec-scheduling-tasks-definitions"><span class="secno">2.3</span> <span
                                class="content">定义</span></a>
                    <li>
                        <a href="#sec-scheduling-tasks-processing-model"><span class="secno">2.4</span> <span
                                class="content">处理模型</span></a>
                        <ol class="toc">
                            <li><a href="#sec-queuing-scheduler-tasks"><span class="secno">2.4.1</span> <span
                                        class="content">调度器任务排队与移除</span></a>
                            <li><a href="#sec-scheduler-alg-scheduling-tasks-and-continuations"><span
                                        class="secno">2.4.2</span> <span class="content">任务与续作的调度</span></a>
                            <li><a href="#sec-scheduler-alg-select-next-task"><span class="secno">2.4.3</span> <span
                                        class="content">选择下一个要运行的任务</span></a>
                        </ol>
                    <li><a href="#sec-scheduling-tasks-examples"><span class="secno">2.5</span> <span
                                class="content">示例</span></a>
                </ol>
            <li>
                <a href="#sec-controlling-tasks"><span class="secno">3</span> <span class="content">控制任务</span></a>
                <ol class="toc">
                    <li><a href="#sec-task-priority-change-event"><span class="secno">3.1</span> <span
                                class="content"><code>TaskPriorityChangeEvent</code>接口</span></a>
                    <li><a href="#sec-task-controller"><span class="secno">3.2</span> <span class="content">
                                <code>TaskController</code>接口</span></a>
                    <li>
                        <a href="#sec-task-signal"><span class="secno">3.3</span> <span class="content">
                                <code>TaskSignal</code>接口</span></a>
                        <ol class="toc">
                            <li><a href="#sec-task-signal-garbage-collection"><span class="secno">3.3.1</span> <span
                                        class="content">垃圾回收</span></a>
                        </ol>
                    <li><a href="#sec-controlling-tasks-examples"><span class="secno">3.4</span> <span
                                class="content">示例</span></a>
                </ol>
            <li>
                <a href="#sec-patches"><span class="secno">4</span> <span class="content">对其他标准的修改</span></a>
                <ol class="toc">
                    <li>
                        <a href="#sec-patches-html"><span class="secno">4.1</span> <span
                                class="content">HTML标准</span></a>
                        <ol class="toc">
                            <li><a href="#sec-patches-html-windoworworkerglobalscope"><span class="secno">4.1.1</span>
                                    <span class="content"><code>WindowOrWorkerGlobalScope</code></span></a>
                            <li><a href="#sec-patches-html-event-loop-definitions"><span class="secno">4.1.2</span>
                                    <span class="content"><span>事件循环：定义</span></span></a>
                            <li><a href="#sec-patches-html-event-loop-processing"><span class="secno">4.1.3</span> <span
                                        class="content"><span>事件循环：处理模型</span></span></a>
                            <li><a href="#sec-patches-html-queuing-tasks"><span class="secno">4.1.4</span> <span
                                        class="content"><span>事件循环：任务排队</span></span></a>
                            <li><a href="#sec-patches-html-hostmakejobcallback"><span class="secno">4.1.5</span> <span
                                        class="content"><span>HostMakeJobCallback(callable)</span></span></a>
                            <li><a href="#sec-patches-html-hostcalljobcallback"><span class="secno">4.1.6</span> <span
                                        class="content"><span>HostCallJobCallback(callback, V,
                                            argumentsList)</span></span></a>
                            <li><a href="#sec-patches-html-hostenqueuepromisejob"><span class="secno">4.1.7</span> <span
                                        class="content"><span>HostEnqueuePromiseJob(job, realm)</span></span></a>
                        </ol>
                    <li>
                        <a href="#sec-patches-requestidlecallback"><span class="secno">4.2</span> <span
                                class="content"><span><code>requestIdleCallback()</code></span></span></a>
                        <ol class="toc">
                            <li><a href="#sec-patches-invoke-idle-callbacks"><span class="secno">4.2.1</span> <span
                                        class="content"><span>调用 idle callback 算法</span></span></a>
                        </ol>
                </ol>
            <li>
                <a href="#sec-security"><span class="secno">5</span> <span class="content">安全性考虑</span></a>
                <ol class="toc">
                    <li><a href="#sec-security-high-res-timer"><span class="secno">5.1</span> <span
                                class="content"><code>postTask</code>作为高精度计时源</span></a>
                    <li><a href="#sec-security-monitoring-tasks"><span class="secno">5.2</span> <span
                                class="content">监控其他来源的任务</span></a>
                </ol>
            <li><a href="#sec-privacy"><span class="secno">6</span> <span class="content">隐私性注意事项</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">说明性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">简介</span><a class="self-link" href="#intro"></a></h2>
        <div class="non-normative">
            <p><em>本节为非规范性内容。</em></p>
            <p>调度可以作为开发者提升网站性能的重要工具。总体而言，调度对两个方面有显著影响：用户感知的延迟和响应性。调度能够优化用户感知的延迟，将较低优先级的工作推迟，以优先处理直接影响体验质量的高优先级工作。例如，在页面加载时推迟部分第三方库脚本的执行，可以让内容更快地呈现于用户。将视口内内容相关的工作优先处理，同样能够改善体验。对于主线程运行的脚本，长任务会阻塞输入和界面更新，影响输入和视觉响应性。将长任务拆分为更小的片段，并调度这些<em>片段</em>或任务<em>续作</em>，是应用和框架开发者提升响应性的重要方法。
            </p>
            <p>用户空间的调度器通常通过提供调度任务的方法及控制任务何时执行来工作。任务通常带有一个优先级，这很大程度上决定了该任务与其他任务的相对执行顺序。调度器常常会执行一段时间（调度时间片）后，将控制权交还浏览器，并通过续作任务（如
                <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" id="ref-for-dom-settimeout">setTimeout()</a></code>
                或 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options">postMessage()</a></code>
                等方式）恢复后续执行。
            </p>
            <p>虽然用户空间调度器已被广泛应用，采用集中式浏览器调度器和更完善的调度原语会进一步改善现状。调度器的优先级系统只在其作用范围内生效。对于用户空间调度器而言，UA通常无法获知其任务的优先级，唯一的例外是调度器部分工作使用了
                <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback">requestIdleCallback()</a></code>
                ，但这限于最低优先级的任务。页面上如果有<em>多个</em>调度器（越来越常见，例如React框架内调度、应用自身调度以及内嵌地图等子模块的调度器），浏览器是理想的协调点，因为它掌握全局信息，并负责事件循环和任务管理。
            </p>
            <p>除了优先级，用户空间调度器赖以实现的原语对于现代用例也并不理想。<code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" id="ref-for-dom-settimeout①">setTimeout(0)</a></code>
                是调度非延迟任务的标准方式，但由于存在最小延迟（如嵌套任务），实际会带来更高延迟和性能问题。<a
                    href="https://dbaron.org/log/20100309-faster-timeouts">一种常用变通方法</a>是利用 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options①">postMessage()</a></code>
                或 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel" id="ref-for-messagechannel">MessageChannel</a></code>，
                但这些API并非为调度设计，例如，无法将回调加入队列。<code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback①">requestIdleCallback()</a></code>
                适用于部分场景，但仅限空闲任务，且无法根据用户输入（如滚动）动态调整任务优先级，比如对屏幕外内容重新排序。
            </p>
            <p>本规范为开发者引入了新的接口，用于调度和控制优先级任务与续作。这里的任务是指异步运行于自身<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                    id="ref-for-event-loop">事件循环</a> <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task">任务</a>的JavaScript回调。续作指的是在让渡控制权给浏览器后，在新的<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                    id="ref-for-event-loop①">事件循环</a> <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task①">任务</a>中恢复JavaScript代码的执行。<code
                    class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler">Scheduler</a></code>
                接口
                提供 <code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask">postTask()</a></code>
                方法用于调度任务，<code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield">yield()</a></code>
                方法用于调度续作。规范定义了若干<code
                    class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority">TaskPriorities</a></code>
                以控制任务和续作的执行顺序。同时，<code
                    class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller">TaskController</a></code>
                及其相关的 <code
                    class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal">TaskSignal</a></code>
                可用于中止已调度的任务及控制其优先级。</p>
        </div>
        <h2 class="heading settled" data-level="2" id="sec-scheduling-tasks-and-continuations"><span class="secno">2.
            </span><span class="content">任务与续作的调度</span><a class="self-link"
                href="#sec-scheduling-tasks-and-continuations"></a></h2>
        <h3 class="heading settled" data-level="2.1" id="sec-task-priorities"><span class="secno">2.1. </span><span
                class="content">任务和续作优先级</span><a class="self-link" href="#sec-task-priorities"></a></h3>
        <p>本规范正式定义了三种用于支持任务调度的优先级：</p>
        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></dfn> {
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking"><c- s>"user-blocking"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible"><c- s>"user-visible"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background"><c- s>"background"</c-></a>
};
</pre>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export
                data-lt="&quot;user-blocking&quot;|user-blocking"
                id="dom-taskpriority-user-blocking"><code>user-blocking</code></dfn>
            是最高优先级，专为需要尽快执行的任务准备，若以较低优先级运行会影响用户体验。例如，直接响应用户输入或更新视口内容的（分块）工作。<br><br>注意，该优先级调度的任务在事件循环中通常优先于其他任务，但不必然阻塞渲染。需要立即同步完成的工作一般建议同步执行，但如果耗时过长会导致响应性下降。而
            "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking①">user-blocking</a></code>"
            任务可用于将工作切块，提升输入和渲染的响应性，并尽量加快任务完成速度。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export
                data-lt="&quot;user-visible&quot;|user-visible"
                id="dom-taskpriority-user-visible"><code>user-visible</code></dfn>
            是第二高优先级，用于对用户有有用副作用但不一定立刻可见或非关键体验的任务。这类任务的重要性和紧急程度低于 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking②">user-blocking</a></code>"
            任务。此优先级为默认值。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export
                data-lt="&quot;background&quot;|background"
                id="dom-taskpriority-background"><code>background</code></dfn>
            是最低优先级，专用于非时间敏感的任务，如日志处理、指标统计或第三方库初始化等后台工作。</p>
        <p class="note" role="note"><span class="marker">注意：</span> 通过同一个 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①">Scheduler</a></code>
            调度的任务以<em>严格优先级顺序</em>运行，即调度器总是优先运行 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking③">user-blocking</a></code>"
            任务，然后是 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible①">user-visible</a></code>"
            任务，最后是 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background①">background</a></code>"
            任务。续作相较同优先级的普通任务有更高<a data-link-type="dfn" href="#scheduler-task-queue-effective-priority"
                id="ref-for-scheduler-task-queue-effective-priority">有效优先级</a>。</p>
        <h3 class="heading settled" data-level="2.2" id="sec-scheduler"><span class="secno">2.2. </span><span
                class="content"><code>Scheduler</code> 接口</span><a class="self-link" href="#sec-scheduler"></a></h3>
        <pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal" id="dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></dfn>;
  <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="TaskPriority" id="dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></dfn>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long" id="dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></dfn> = 0;
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="scheduler"><code><c- g>Scheduler</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask①"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback" id="ref-for-callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code></dfn>,
                        <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions" id="ref-for-dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code></dfn> = {});
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield①"><c- g>yield</c-></a>();
};
</pre>
        <p class="note" role="note"><span class="marker">注意：</span> <code
                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal">signal</a></code>
            选项既可以是 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code>
            ，也可以是 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①">TaskSignal</a></code>，
            但此处定义为 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal②">AbortSignal</a></code>
            ，因为其为 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②">TaskSignal</a></code>
            的超类。如需动态优先级控制，应使用 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③">TaskSignal</a></code>。仅需取消时，用
            <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal③">AbortSignal</a></code>
            即可，便于与现有使用 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal④">AbortSignals</a></code>
            的代码集成。
        </p>
        <dl class="domintro non-normative">
            <dt><code>result = scheduler . <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask②">postTask</a></code>(
                <var>callback</var>, <var>options</var> )</code>
            <dd>
                <p>返回一个Promise，成功时为 <var>callback</var> 的返回值，任务被中止时以 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑤">AbortSignal</a></code>
                    的<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                        id="ref-for-abortsignal-abort-reason">中止原因</a> 失败。<var>callback</var> 抛错时，Promise以该错误拒绝。
                </p>
                <p>任务的 <code
                        class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority③">priority</a></code>
                    由 <var>option</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority">priority</a></code>
                    和 <code
                        class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal①">signal</a></code>
                    联合确定:
                </p>
                <ul>
                    <li>
                        <p>若指定了 <var>option</var> 的 <code
                                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority①">priority</a></code>
                            ，则使用该 <code
                                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority④">TaskPriority</a></code>
                            ，任务优先级为固定不可变。 </p>
                    <li>
                        <p>否则，若指定了 <var>option</var> 的 <code
                                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal②">signal</a></code>
                            且类型为 <code
                                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal④">TaskSignal</a></code>
                            ，则任务优先级由 <var>option</var> 的 <code
                                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal③">signal</a></code>
                            的<a data-link-type="dfn" href="#tasksignal-priority"
                                id="ref-for-tasksignal-priority">priority</a> 属性动态决定，可通过关联的 <code
                                class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller①">TaskController</a></code>
                            的 <code
                                class="idl"><a data-link-type="idl" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority">controller.setPriority()</a></code>
                            动态更改。</p>
                    <li>
                        <p>否则，优先级默认为 "<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible②">user-visible</a></code>"。
                        </p>
                </ul>
                <p>若指定 <var>option</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal④">signal</a></code>
                    ，Scheduler用其判断任务是否被中止。</p>
                <p>若指定 <var>option</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay">delay</a></code>
                    且大于0，任务执行会延迟至少 <code
                        class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay①">delay</a></code>
                    毫秒。</p>
            <dt><code>result = scheduler . <code class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield②">yield</a></code>()</code>
            <dd>
                <p>返回一个Promise，成功时为 <code>undefined</code>，被中止时以 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑥">AbortSignal</a></code>
                    的<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                        id="ref-for-abortsignal-abort-reason①">中止原因</a> 失败。
                </p>
                <p>续作的优先级及用于中止的signal均继承自原任务。若源任务以 <code
                        class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask④">postTask()</a></code>
                    指定了 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑦">AbortSignal</a></code>
                    ，则使用该信号判断续作是否中止；原任务的优先级（<code
                        class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑤">TaskSignal</a></code>
                    或固定优先级）也决定续作优先级。若原任务无优先级，则默认使用 "<code
                        class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible③">user-visible</a></code>"。
                </p>
        </dl>
        <p><code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler③">Scheduler</a></code>
            对象拥有一个<dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-noexport
                id="scheduler-static-priority-task-queue-map">静态优先级任务队列映射</dfn>，
            即将 (<code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑤">TaskPriority</a></code>,
            boolean) 映射为 <a data-link-type="dfn" href="#scheduler-task-queue"
                id="ref-for-scheduler-task-queue">调度器任务队列</a>。初始化为空<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a>。</p>
        <p><code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler④">Scheduler</a></code>
            对象还有一个<dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-noexport
                id="scheduler-dynamic-priority-task-queue-map">动态优先级任务队列映射</dfn>，
            即将 (<code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑥">TaskSignal</a></code>,
            boolean) 映射为 <a data-link-type="dfn" href="#scheduler-task-queue"
                id="ref-for-scheduler-task-queue①">调度器任务队列</a>。初始化为空<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>。</p>
        <p class="note" role="note"><span class="marker">注意：</span> 我们通过将特定 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑦">TaskSignal</a></code>
            关联的任务全部加入同一个<a data-link-type="dfn" href="#scheduler-task-queue"
                id="ref-for-scheduler-task-queue②">调度器任务队列</a>，并在<code>prioritychange</code>事件触发时调整队列优先级，以支持<em>动态优先级管理</em>。<a
                data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map"
                id="ref-for-scheduler-dynamic-priority-task-queue-map">动态优先级任务队列映射</a>用于存储那些优先级可变的<a
                data-link-type="dfn" href="#scheduler-task-queue"
                id="ref-for-scheduler-task-queue③">调度器任务队列</a>，其键为对应<code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑧">TaskSignal</a></code>。
            <br><br> <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map"
                id="ref-for-scheduler-static-priority-task-queue-map">静态优先级任务队列映射</a>存的是优先级不变的队列，包括通过明确 <code
                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority②">priority</a></code>
            指定或 <code
                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑥">signal</a></code>
            为 null 或为 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑧">AbortSignal</a></code>
            的任务，键为 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑥">TaskPriority</a></code>。<br><br>另一种等价实现方式是每
            <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑦">TaskPriority</a></code>
            仅维护一个<a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑤">调度器任务队列</a>，在
            <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑨">TaskSignal</a></code>
            <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority①">priority</a>
            变化时将任务在各队列间移动，按<a data-link-type="dfn" href="#scheduler-task-enqueue-order"
                id="ref-for-scheduler-task-enqueue-order">入队顺序</a>排序。这简化了<a data-link-type="dfn"
                href="#select-the-next-scheduler-task-queue-from-all-schedulers"
                id="ref-for-select-the-next-scheduler-task-queue-from-all-schedulers">从所有调度器选择下一个任务队列</a>的逻辑，但加重了优先级变更处理的复杂度。
        </p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler" data-dfn-type="method" data-export
                data-lt="postTask(callback, options)|postTask(callback)" id="dom-scheduler-posttask"
                title="postTask(callback, options)"><code>postTask(<var>callback</var>, <var>options</var>)</code></dfn>
            方法：返回<a data-link-type="dfn" href="#schedule-a-posttask-task"
                id="ref-for-schedule-a-posttask-task">调度postTask任务</a>的结果，参数为本对象、<var>callback</var> 和
            <var>options</var>。
        </p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler" data-dfn-type="method" data-export
                id="dom-scheduler-yield" title="yield()"><code>yield()</code></dfn>
            方法：返回<a data-link-type="dfn" href="#schedule-a-yield-continuation"
                id="ref-for-schedule-a-yield-continuation">调度yield续作</a>的结果，参数为本对象。</p>
        <h3 class="heading settled" data-level="2.3" id="sec-scheduling-tasks-definitions"><span class="secno">2.3.
            </span><span class="content">定义</span><a class="self-link" href="#sec-scheduling-tasks-definitions"></a>
        </h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task">调度器任务</dfn>是一个<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                id="ref-for-concept-task②">任务</a>，并额外包含初始值为0的数值类型<dfn class="dfn-paneled" data-dfn-for="scheduler task"
                data-dfn-type="dfn" data-noexport id="scheduler-task-enqueue-order">入队顺序</dfn> <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">条目</a>。
        </p>
        <p>下列<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source">任务源</a>
            被定义为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-sources">调度器任务源</dfn>，
            仅可用于<a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task">调度器任务</a>。</p>
        <dl>
            <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="posted-task-task-source">已派发任务源</dfn>
            <dd data-md>
                <p>该<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                        id="ref-for-task-source①">任务源</a>用于通过 <code
                        class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑤">postTask()</a></code>
                    或 <code
                        class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield③">yield()</a></code>
                    调度的任务。
                </p>
        </dl>
        <p><br></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-queue">调度器任务队列</dfn>是一个<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">结构体</a>，包含如下<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">条目</a>：
        </p>
        <dl>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport
                    id="scheduler-task-queue-priority">优先级</dfn>
            <dd data-md>
                <p><code
                        class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑧">TaskPriority</a></code>。
                </p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport
                    id="scheduler-task-queue-is-continuation">是否为续作</dfn>
            <dd data-md>
                <p>布尔值。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport
                    id="scheduler-task-queue-tasks">任务集</dfn>
            <dd data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                        id="ref-for-ordered-set">集合</a>，包含<a data-link-type="dfn" href="#scheduler-task"
                        id="ref-for-scheduler-task①">调度器任务</a>。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport
                    id="scheduler-task-queue-removal-steps">移除算法</dfn>
            <dd data-md>
                <p>算法。</p>
        </dl>
        <p><br></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduling-state">调度状态</dfn>是一个<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">结构体</a>，包含如下<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item②">条目</a>：
        </p>
        <dl>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduling state" data-dfn-type="dfn" data-noexport
                    id="scheduling-state-abort-source">中止源</dfn>
            <dd data-md>
                <p><code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑨">AbortSignal</a></code>
                    对象或 null，初始为 null。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduling state" data-dfn-type="dfn" data-noexport
                    id="scheduling-state-priority-source">优先级源</dfn>
            <dd data-md>
                <p><code
                        class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⓪">TaskSignal</a></code>
                    对象或 null，初始为 null。</p>
        </dl>
        <p><br></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="continuation-state">续作状态</dfn>
            是一个<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">结构体</a>，
            包含如下<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item"
                id="ref-for-struct-item③">条目</a>：</p>
        <dl>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="continuation state" data-dfn-type="dfn" data-noexport
                    id="continuation-state-state-map">状态映射</dfn>
            <dd data-md>
                <p>初始为空<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map"
                        id="ref-for-ordered-map④">map</a>。</p>
        </dl>
        <p class="note" role="note"><span class="marker">注意：</span> 上述<a data-link-type="dfn"
                href="#continuation-state-state-map"
                id="ref-for-continuation-state-state-map">状态映射</a>可以用弱映射实现（键为可垃圾回收对象）。</p>
        <p><br></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="task-handle">任务句柄</dfn>为<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct③">结构体</a>，
            包含如下<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item"
                id="ref-for-struct-item④">条目</a>：</p>
        <dl>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="task handle" data-dfn-type="dfn" data-noexport
                    id="task-handle-task">任务</dfn>
            <dd data-md>
                <p><a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task②">调度器任务</a> 或 null。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="task handle" data-dfn-type="dfn" data-noexport
                    id="task-handle-queue">队列</dfn>
            <dd data-md>
                <p><a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑦">调度器任务队列</a> 或
                    null。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="task handle" data-dfn-type="dfn" data-noexport
                    id="task-handle-abort-steps">中止算法</dfn>
            <dd data-md>
                <p>算法。</p>
            <dt data-md><dfn class="dfn-paneled" data-dfn-for="task handle" data-dfn-type="dfn" data-noexport
                    id="task-handle-task-complete-steps">任务完成算法</dfn>
            <dd data-md>
                <p>算法。</p>
        </dl>
        <h3 class="heading settled" data-level="2.4" id="sec-scheduling-tasks-processing-model"><span class="secno">2.4.
            </span><span class="content">处理模型</span><a class="self-link"
                href="#sec-scheduling-tasks-processing-model"></a></h3>
        <div class="algorithm" data-algorithm="older than" data-algorithm-for="scheduler task"> 如果 <a
                data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task③">调度器任务</a>
            <var>t1</var> 的 <a data-link-type="dfn" href="#scheduler-task-enqueue-order"
                id="ref-for-scheduler-task-enqueue-order①">入队顺序</a> 小于 <a data-link-type="dfn" href="#scheduler-task"
                id="ref-for-scheduler-task④">调度器任务</a> <var>t2</var> 的 <a data-link-type="dfn"
                href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order②">入队顺序</a>，则 <var>t1</var>
            <dfn class="dfn-paneled" data-dfn-for="scheduler task" data-dfn-type="dfn" data-noexport
                id="scheduler-task-older-than">早于</dfn> <var>t2</var>。
        </div>
        <div class="algorithm" data-algorithm="create a scheduler task queue">
            要用 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑨">TaskPriority</a></code>
            <var>priority</var>、布尔值 <var>isContinuation</var> 和算法 <var>removalSteps</var> <dfn class="dfn-paneled"
                data-dfn-type="dfn" data-noexport id="create-a-scheduler-task-queue">创建调度器任务队列</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>queue</var> 为一个新的 <a data-link-type="dfn" href="#scheduler-task-queue"
                            id="ref-for-scheduler-task-queue⑧">调度器任务队列</a>。</p>
                <li data-md>
                    <p>将 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-priority"
                            id="ref-for-scheduler-task-queue-priority">优先级</a> 设为 <var>priority</var>。</p>
                <li data-md>
                    <p>将 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-is-continuation"
                            id="ref-for-scheduler-task-queue-is-continuation">是否为续作</a> 设为
                        <var>isContinuation</var>。
                    </p>
                <li data-md>
                    <p>将 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-tasks"
                            id="ref-for-scheduler-task-queue-tasks">任务集</a> 设为一个新的空 <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">集合</a>。</p>
                <li data-md>
                    <p>将 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-removal-steps"
                            id="ref-for-scheduler-task-queue-removal-steps">移除算法</a> 设为
                        <var>removalSteps</var>。
                    </p>
                <li data-md>
                    <p>返回 <var>queue</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="create a task handle">
            要根据 promise <var>result</var> 和 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①⓪">AbortSignal</a></code>
            或 null <var>signal</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="create-a-task-handle">创建任务句柄</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>handle</var> 为一个新的 <a data-link-type="dfn" href="#task-handle"
                            id="ref-for-task-handle">任务句柄</a>。</p>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-task"
                            id="ref-for-task-handle-task">任务</a> 设为 null。</p>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-queue"
                            id="ref-for-task-handle-queue">队列</a> 设为 null。</p>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-abort-steps"
                            id="ref-for-task-handle-abort-steps">中止算法</a> 设为以下步骤：</p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                                    id="ref-for-reject">拒绝（reject）</a> <var>result</var>，理由为 <var>signal</var> 的 <a
                                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                                    id="ref-for-abortsignal-abort-reason②">中止原因</a>。</p>
                        <li data-md>
                            <p>如果 <var>task</var> 不为 null：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="#scheduler-task-queue-remove"
                                            id="ref-for-scheduler-task-queue-remove">从</a> <var>queue</var> 移除
                                        <var>task</var>。
                                    </p>
                                <li data-md>
                                    <p>如果 <var>queue</var> <a data-link-type="dfn" href="#scheduler-task-queue-empty"
                                            id="ref-for-scheduler-task-queue-empty">为空</a>，则运行
                                        <var>queue</var> 的 <a data-link-type="dfn"
                                            href="#scheduler-task-queue-removal-steps"
                                            id="ref-for-scheduler-task-queue-removal-steps①">移除算法</a>。
                                    </p>
                            </ol>
                    </ol>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-task-complete-steps"
                            id="ref-for-task-handle-task-complete-steps">任务完成算法</a> 设为以下步骤：
                    </p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>signal</var> 不为 null，则从 <var>signal</var> <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#abortsignal-remove"
                                    id="ref-for-abortsignal-remove">移除</a> <var>handle</var> 的 <a data-link-type="dfn"
                                    href="#task-handle-abort-steps" id="ref-for-task-handle-abort-steps①">中止算法</a>。</p>
                        <li data-md>
                            <p>如果 <var>queue</var> <a data-link-type="dfn" href="#scheduler-task-queue-empty"
                                    id="ref-for-scheduler-task-queue-empty①">为空</a>，则运行 <var>queue</var> 的 <a
                                    data-link-type="dfn" href="#scheduler-task-queue-removal-steps"
                                    id="ref-for-scheduler-task-queue-removal-steps②">移除算法</a>。</p>
                    </ol>
                <li data-md>
                    <p>返回 <var>handle</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="first runnable task" data-algorithm-for="scheduler task queue"> <a
                data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑨">调度器任务队列</a>
            <var>queue</var> 的 <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn"
                data-noexport id="scheduler-task-queue-first-runnable-task">首个可运行任务</dfn>
            是 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑤">调度器任务</a>
            中第一个 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable"
                id="ref-for-concept-task-runnable">可运行</a> 的任务。
        </div>
        <div class="algorithm" data-algorithm="effective priority" data-algorithm-for="scheduler task queue">
            <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①⓪">调度器任务队列</a>
            <var>queue</var> 的 <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn"
                data-noexport id="scheduler-task-queue-effective-priority">有效优先级</dfn>
            由 <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-priority"
                id="ref-for-scheduler-task-queue-priority①">优先级</a>
            和 <a data-link-type="dfn" href="#scheduler-task-queue-is-continuation"
                id="ref-for-scheduler-task-queue-is-continuation①">是否为续作</a> 匹配的行的第三列计算得出：
            <p>
            <table>
                <thead>
                    <tr>
                        <th>优先级
                        <th>是否为续作
                        <th>有效优先级
                <tbody>
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background②">background</a></code>"
                        <td><code>false</code>
                        <td>0
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background③">background</a></code>"
                        <td><code>true</code>
                        <td>1
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible④">user-visible</a></code>"
                        <td><code>false</code>
                        <td>2
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible⑤">user-visible</a></code>"
                        <td><code>true</code>
                        <td>3
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking④">user-blocking</a></code>"
                        <td><code>false</code>
                        <td>4
                    <tr>
                        <td>"<code
                                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking⑤">user-blocking</a></code>"
                        <td><code>true</code>
                        <td>5
            </table>
            </p>
        </div>
        <h4 class="heading settled" data-level="2.4.1" id="sec-queuing-scheduler-tasks"><span class="secno">2.4.1.
            </span><span class="content">调度器任务排队与移除</span><a class="self-link" href="#sec-queuing-scheduler-tasks"></a>
        </h4>
        <div class="algorithm" data-algorithm="queue a scheduler task">
            要在 <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①①">调度器任务队列</a>
            <var>queue</var> 上按照数值 <var>enqueue order</var>、<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source②">任务源</a> <var>source</var>、<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">文档</a>
            <var>document</var> 执行流程步骤 <var>steps</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="queue-a-scheduler-task">排队调度器任务</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>task</var> 为一个新的 <a data-link-type="dfn" href="#scheduler-task"
                            id="ref-for-scheduler-task⑥">调度器任务</a>。</p>
                <li data-md>
                    <p>将 <var>task</var> 的 <a data-link-type="dfn" href="#scheduler-task-enqueue-order"
                            id="ref-for-scheduler-task-enqueue-order③">入队顺序</a> 设为 <var>enqueue order</var>。</p>
                <li data-md>
                    <p>将 <var>task</var> 的 <a class="idl-code" data-link-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps"
                            id="ref-for-concept-task-steps">步骤</a> 设为 <var>steps</var>。</p>
                <li data-md>
                    <p>将 <var>task</var> 的 <a class="idl-code" data-link-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-source"
                            id="ref-for-concept-task-source">任务源</a> 设为 <var>source</var>。</p>
                <li data-md>
                    <p>将 <var>task</var> 的 <a class="idl-code" data-link-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-document"
                            id="ref-for-concept-task-document">文档</a> 设为 <var>document</var>。</p>
                <li data-md>
                    <p>将 <var>task</var> 的 <a class="idl-code" data-link-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set"
                            id="ref-for-script-evaluation-environment-settings-object-set">脚本执行环境设置对象集</a> 设为一个新的空 <a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                            id="ref-for-ordered-set②">集合</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                            id="ref-for-set-append">追加</a> <var>task</var> 至 <var>queue</var> 的 <a data-link-type="dfn"
                            href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks②">任务集</a>。</p>
                <li data-md>
                    <p>返回 <var>task</var>。</p>
            </ol>
            <p class="issue" id="issue-83467c82"><a class="self-link" href="#issue-83467c82"></a> 我们应考虑重构 HTML 规范，为 <a
                    data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task③">任务</a> 添加构造器。
                一个问题在于我们需要新任务为 <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑦">调度器任务</a>
                而不是普通 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task④">任务</a>。</p>
        </div>
        <div class="algorithm" data-algorithm="remove" data-algorithm-for="scheduler task queue"> 要从 <a
                data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑧">调度器任务</a> <var>task</var> 中 <a
                data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①②">调度器任务队列</a>
            <var>queue</var> <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn"
                data-noexport id="scheduler-task-queue-remove">移除</dfn>，需 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">从</a> <var>queue</var> 的 <a
                data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks③">任务集</a>
            移除 <var>task</var>。
        </div>
        <div class="algorithm" data-algorithm="empty" data-algorithm-for="scheduler task queue"> <a data-link-type="dfn"
                href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①③">调度器任务队列</a> <var>queue</var> <dfn
                class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport
                id="scheduler-task-queue-empty">为空</dfn>，当且仅当 <var>queue</var> 的 <a data-link-type="dfn"
                href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks④">任务集</a> <a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">为空</a>。
        </div>
        <h4 class="heading settled" data-level="2.4.2" id="sec-scheduler-alg-scheduling-tasks-and-continuations"><span
                class="secno">2.4.2. </span><span class="content">任务与续作的调度</span><a class="self-link"
                href="#sec-scheduler-alg-scheduling-tasks-and-continuations"></a></h4>
        <div class="algorithm" data-algorithm="set the current scheduling state">
            要将 <var>scheduler</var>（一个 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑤">Scheduler</a></code>）的<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="set-the-current-scheduling-state">当前调度状态</dfn>设置为 <var>state</var>（一个<a data-link-type="dfn"
                href="#scheduling-state" id="ref-for-scheduling-state">调度状态</a>）：
            <ol>
                <li data-md>
                    <p>令 <var>eventLoop</var> 为 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent"
                            id="ref-for-relevant-agent">相关 agent</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                            id="ref-for-concept-agent-event-loop">事件循环</a>。</p>
                <li data-md>
                    <p>以 <var>eventLoop</var> 为参数，为 <var>scheduler</var> <a data-link-type="dfn"
                            href="#set-the-continuation-state-value"
                            id="ref-for-set-the-continuation-state-value">设置续作状态值</a>为 <var>state</var>。
                    </p>
            </ol>
            <p class="note" role="note"><span class="marker">注意：</span> <a data-link-type="dfn"
                    href="#continuation-state-state-map" id="ref-for-continuation-state-state-map①">状态映射</a>可以使用任何
                key，只要对同一 <code
                    class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑥">Scheduler</a></code>
                唯一即可。
            </p>
        </div>
        <div class="algorithm" data-algorithm="get the current scheduling state">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="get-the-current-scheduling-state">获取<var>scheduler</var>（一个 <code
                    class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑦">Scheduler</a></code>）的当前调度状态</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>eventLoop</var> 为 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent"
                            id="ref-for-relevant-agent①">关联 agent</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                            id="ref-for-concept-agent-event-loop①">事件循环（event loop）</a>。</p>
                <li data-md>
                    <p>返回对 <var>scheduler</var> 及 <var>eventLoop</var> <a data-link-type="dfn"
                            href="#get-the-continuation-state-value"
                            id="ref-for-get-the-continuation-state-value">获取延续状态值</a> 的结果。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="schedule a postTask task">
            要为 <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑧">Scheduler</a></code>
            <var>scheduler</var>，给定 <code
                class="idl"><a data-link-type="idl" href="#callbackdef-schedulerposttaskcallback" id="ref-for-callbackdef-schedulerposttaskcallback①">SchedulerPostTaskCallback</a></code>
            <var>callback</var> 和 <code
                class="idl"><a data-link-type="idl" href="#dictdef-schedulerposttaskoptions" id="ref-for-dictdef-schedulerposttaskoptions①">SchedulerPostTaskOptions</a></code>
            <var>options</var>，<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="schedule-a-posttask-task">调度一个 postTask 任务</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>result</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">一个新的
                            promise</a>。</p>
                <li data-md>
                    <p>令 <var>signal</var> 为 <var>options</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑦">signal</a></code>"]
                        （如果其 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists"
                            id="ref-for-map-exists">存在</a>），否则为 null。</p>
                <li data-md>
                    <p>如果 <var>signal</var> 非空且其为 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                            id="ref-for-abortsignal-aborted">已中止</a>，则用 <var>signal</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason③">中止原因</a> <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">拒绝</a> <var>result</var>
                        并返回 <var>result</var>。
                    </p>
                <li data-md>
                    <p>令 <var>state</var> 为一个新的 <a data-link-type="dfn" href="#scheduling-state"
                            id="ref-for-scheduling-state①">调度状态</a>。</p>
                <li data-md>
                    <p>设置 <var>state</var> 的 <a data-link-type="dfn" href="#scheduling-state-abort-source"
                            id="ref-for-scheduling-state-abort-source">中止源</a>为 <var>signal</var>。</p>
                <li data-md>
                    <p>如果 <var>options</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority③">priority</a></code>"]
                        <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists"
                            id="ref-for-map-exists①">存在</a>，则将 <var>state</var> 的 <a data-link-type="dfn"
                            href="#scheduling-state-priority-source"
                            id="ref-for-scheduling-state-priority-source">优先级源</a> 设置为 <a data-link-type="dfn"
                            href="#create-a-fixed-priority-unabortable-task-signal"
                            id="ref-for-create-a-fixed-priority-unabortable-task-signal">创建固定优先级不可中止任务信号</a>（参数为
                        <var>options</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority④">priority</a></code>"]）的结果。
                    </p>
                <li data-md>
                    <p>否则，如果 <var>signal</var> 非空且 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#implements" id="ref-for-implements">实现了</a>
                        <code
                            class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①①">TaskSignal</a></code>
                        接口，则将 <var>state</var> 的 <a data-link-type="dfn" href="#scheduling-state-priority-source"
                            id="ref-for-scheduling-state-priority-source①">优先级源</a> 设置为 <var>signal</var>。
                    </p>
                <li data-md>
                    <p>如果 <var>state</var> 的 <a data-link-type="dfn" href="#scheduling-state-priority-source"
                            id="ref-for-scheduling-state-priority-source②">优先级源</a> 为空，则将 <var>state</var> 的 <a
                            data-link-type="dfn" href="#scheduling-state-priority-source"
                            id="ref-for-scheduling-state-priority-source③">优先级源</a> 设置为 <a data-link-type="dfn"
                            href="#create-a-fixed-priority-unabortable-task-signal"
                            id="ref-for-create-a-fixed-priority-unabortable-task-signal①">创建固定优先级不可中止任务信号</a>（参数为 "<code
                            class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible⑥">user-visible</a></code>"）的结果。
                    </p>
                <li data-md>
                    <p>令 <var>handle</var> 为<a data-link-type="dfn" href="#create-a-task-handle"
                            id="ref-for-create-a-task-handle">创建任务句柄</a>（参数为 <var>result</var> 和 <var>signal</var>）的结果。
                    </p>
                <li data-md>
                    <p>如果 <var>signal</var> 非空，则 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">添加</a>
                        <var>handle</var> 的<a data-link-type="dfn" href="#task-handle-abort-steps"
                            id="ref-for-task-handle-abort-steps②">中止步骤</a>到 <var>signal</var>。
                    </p>
                <li data-md>
                    <p>令 <var>enqueueSteps</var> 为如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-queue"
                                    id="ref-for-task-handle-queue①">队列</a> 设为 <a data-link-type="dfn"
                                    href="#select-the-scheduler-task-queue"
                                    id="ref-for-select-the-scheduler-task-queue">选择调度器任务队列</a>（参数为
                                <var>scheduler</var>、<var>state</var> 的
                                <a data-link-type="dfn" href="#scheduling-state-priority-source"
                                    id="ref-for-scheduling-state-priority-source④">优先级源</a> 和 false）的结果。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#schedule-a-task-to-invoke-an-algorithm"
                                    id="ref-for-schedule-a-task-to-invoke-an-algorithm">调度一个执行算法的任务</a>给
                                <var>scheduler</var>，参数为 <var>handle</var> 以及以下步骤：
                            </p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>eventLoop</var> 为 <var>scheduler</var> 的 <a data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent"
                                            id="ref-for-relevant-agent②">关联 agent</a> 的 <a data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                                            id="ref-for-concept-agent-event-loop②">事件循环</a>。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="#set-the-current-scheduling-state"
                                            id="ref-for-set-the-current-scheduling-state">设置当前调度状态</a>为
                                        <var>state</var>。
                                    </p>
                                <li data-md>
                                    <p>令 <var>callbackResult</var> 为 <a data-link-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#invoke-a-callback-function"
                                            id="ref-for-invoke-a-callback-function">调用</a> <var>callback</var>，传参为 « » 及
                                        "<code>rethrow</code>" 的结果。
                                        如果其抛出异常，则 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                                            id="ref-for-reject②">拒绝</a> <var>result</var>；否则，<a data-link-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">解决</a>
                                        <var>result</var>，值为 <var>callbackResult</var>。
                                    </p>
                                <li data-md>
                                    <p>将 <var>eventLoop</var> 的 <a data-link-type="dfn"
                                            href="#event-loop-current-continuation-state"
                                            id="ref-for-event-loop-current-continuation-state">当前延续状态</a> 设为 null。</p>
                            </ol>
                    </ol>
                <li data-md>
                    <p>令 <var>delay</var> 为 <var>options</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay②">delay</a></code>"]。
                    </p>
                <li data-md>
                    <p>如果 <var>delay</var> 大于 0，则 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout"
                            id="ref-for-run-steps-after-a-timeout">在超时后运行步骤</a>，参数为
                        <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global">相关全局对象</a>、
                        "<code>scheduler-postTask</code>"、<var>delay</var> 以及以下步骤：
                    </p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>signal</var> 为空或 <var>signal</var> 未 <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                                    id="ref-for-abortsignal-aborted①">中止</a>，则执行 <var>enqueueSteps</var>。</p>
                    </ol>
                <li data-md>
                    <p>否则，执行 <var>enqueueSteps</var>。</p>
                <li data-md>
                    <p>返回 <var>result</var>。</p>
            </ol>
            <p class="note" role="note"><span class="marker">注：</span>此处创建的固定优先级不可中止信号可以被缓存和复用以避免额外的内存分配。</p>
        </div>
        <p class="issue" id="issue-cb2ce7e9"><a class="self-link" href="#issue-cb2ce7e9"></a> <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout"
                id="ref-for-run-steps-after-a-timeout①">定时器延后运行</a> 不一定涵盖挂起场景；参见 <a
                href="https://github.com/whatwg/html/issues/5925">whatwg/html#5925</a>。</p>
        <div class="algorithm" data-algorithm="schedule a yield continuation">
            要为 <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑨">Scheduler</a></code>
            <var>scheduler</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="schedule-a-yield-continuation">调度一次 yield continuation</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>result</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">一个新的
                            promise</a>。</p>
                <li data-md>
                    <p>令 <var>inheritedState</var> 为对 <var>scheduler</var> <a data-link-type="dfn"
                            href="#get-the-current-scheduling-state"
                            id="ref-for-get-the-current-scheduling-state">获取当前调度状态</a> 的结果。
                    </p>
                <li data-md>
                    <p>令 <var>abortSource</var> 为 <var>inheritedState</var> 的 <a data-link-type="dfn"
                            href="#scheduling-state-abort-source" id="ref-for-scheduling-state-abort-source①">中止源</a>（若
                        <var>inheritedState</var> 不为 null），否则为 null。
                    </p>
                <li data-md>
                    <p>如果 <var>abortSource</var> 不为 null 且被 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                            id="ref-for-abortsignal-aborted②">中止</a>，则用 <var>abortSource</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason④">中止原因</a> <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject③">拒绝（reject）</a>
                        <var>result</var> 并返回 。
                    </p>
                <li data-md>
                    <p>令 <var>prioritySource</var> 为 <var>inheritedState</var> 的 <a data-link-type="dfn"
                            href="#scheduling-state-priority-source"
                            id="ref-for-scheduling-state-priority-source⑤">优先级源</a>（若 <var>inheritedState</var> 不为
                        null），否则为 null。
                    </p>
                <li data-md>
                    <p>如果 <var>prioritySource</var> 为 null，则设为 <a data-link-type="dfn"
                            href="#create-a-fixed-priority-unabortable-task-signal"
                            id="ref-for-create-a-fixed-priority-unabortable-task-signal②">创建固定优先级不可中止TaskSignal</a>
                        的结果，参数为 "<code
                            class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible⑦">user-visible</a></code>"。
                    </p>
                <li data-md>
                    <p>令 <var>handle</var> 为 <a data-link-type="dfn" href="#create-a-task-handle"
                            id="ref-for-create-a-task-handle①">创建任务句柄</a> 的结果，参数为 <var>result</var> 和
                        <var>abortSource</var>。
                    </p>
                <li data-md>
                    <p>如果 <var>abortSource</var> 不为 null，则将 <a data-link-type="dfn" href="#task-handle-abort-steps"
                            id="ref-for-task-handle-abort-steps③">中止算法</a> 添加到 <var>abortSource</var>（<a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add"
                            id="ref-for-abortsignal-add①">add</a>）。</p>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-queue"
                            id="ref-for-task-handle-queue②">队列</a> 设为对 <var>scheduler</var>，以 <var>prioritySource</var>
                        和 true 为参数，调用 <a data-link-type="dfn" href="#select-the-scheduler-task-queue"
                            id="ref-for-select-the-scheduler-task-queue①">选择调度器任务队列</a> 的结果。
                    </p>
                <li data-md>
                    <p>为 <var>scheduler</var> 用 <var>handle</var> 和以下步骤 <a data-link-type="dfn"
                            href="#schedule-a-task-to-invoke-an-algorithm"
                            id="ref-for-schedule-a-task-to-invoke-an-algorithm①">调度一个运行算法的任务</a>：</p>
                    <ol>
                        <li data-md>
                            <p>resolve <var>result</var>。</p>
                    </ol>
                <li data-md>
                    <p>返回 <var>result</var>。</p>
            </ol>
            <p class="note" role="note"><span class="marker">注意：</span> 此处创建的固定优先级不可中止 signal 可缓存和重用，以避免多余的内存分配。</p>
        </div>
        <div class="algorithm" data-algorithm="select the scheduler task queue">
            要为 <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⓪">Scheduler</a></code>
            <var>scheduler</var>，给定 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①②">TaskSignal</a></code>
            对象 <var>signal</var> 和布尔值 <var>isContinuation</var>，<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="select-the-scheduler-task-queue">选择调度器任务队列</dfn>：
            <ol>
                <li data-md>
                    <p>如果 <var>signal</var> 没有 <a data-link-type="dfn" href="#tasksignal-has-fixed-priority"
                            id="ref-for-tasksignal-has-fixed-priority">固定优先级</a>，则</p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>scheduler</var> 的 <a data-link-type="dfn"
                                    href="#scheduler-dynamic-priority-task-queue-map"
                                    id="ref-for-scheduler-dynamic-priority-task-queue-map①">动态优先级任务队列映射</a> 不 <a
                                    data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists"
                                    id="ref-for-map-exists②">包含</a> (<var>signal</var>, <var>isContinuation</var>)，则</p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>queue</var> 为 <a data-link-type="dfn"
                                            href="#create-a-scheduler-task-queue"
                                            id="ref-for-create-a-scheduler-task-queue">创建调度器任务队列</a> 的结果，参数为
                                        <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                                            id="ref-for-tasksignal-priority②">priority</a>、<var>isContinuation</var>
                                        和以下步骤：
                                    </p>
                                    <ol>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove"
                                                    id="ref-for-map-remove">移除</a> <a data-link-type="dfn"
                                                    href="#scheduler-dynamic-priority-task-queue-map"
                                                    id="ref-for-scheduler-dynamic-priority-task-queue-map②">动态优先级任务队列映射</a>[(<var>signal</var>,
                                                <var>isContinuation</var>)]。
                                            </p>
                                    </ol>
                                <li data-md>
                                    <p>设置 <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map"
                                            id="ref-for-scheduler-dynamic-priority-task-queue-map③">动态优先级任务队列映射</a>[(<var>signal</var>,
                                        <var>isContinuation</var>)] 为
                                        <var>queue</var>。
                                    </p>
                                <li data-md>
                                    <p>为 <var>signal</var> <a data-link-type="dfn"
                                            href="#tasksignal-add-a-priority-change-algorithm"
                                            id="ref-for-tasksignal-add-a-priority-change-algorithm">添加优先级变更算法</a>，步骤如下：
                                    </p>
                                    <ol>
                                        <li data-md>
                                            <p>将 <var>queue</var> 的 <a data-link-type="dfn"
                                                    href="#scheduler-task-queue-priority"
                                                    id="ref-for-scheduler-task-queue-priority②">优先级</a> 设为
                                                <var>signal</var> 的 <code
                                                    class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority">priority</a></code>。
                                            </p>
                                    </ol>
                            </ol>
                        <li data-md>
                            <p>返回 <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map"
                                    id="ref-for-scheduler-dynamic-priority-task-queue-map④">动态优先级任务队列映射</a>[(<var>signal</var>,
                                <var>isContinuation</var>)]。
                            </p>
                    </ol>
                <li data-md>
                    <p>否则</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>priority</var> 为 <var>signal</var> 的 <a data-link-type="dfn"
                                    href="#tasksignal-priority" id="ref-for-tasksignal-priority③">priority</a>。</p>
                        <li data-md>
                            <p>如果 <var>scheduler</var> 的 <a data-link-type="dfn"
                                    href="#scheduler-static-priority-task-queue-map"
                                    id="ref-for-scheduler-static-priority-task-queue-map①">静态优先级任务队列映射</a> 不 <a
                                    data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists"
                                    id="ref-for-map-exists③">包含</a> (<var>priority</var>, <var>isContinuation</var>)，则
                            </p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>queue</var> 为 <a data-link-type="dfn"
                                            href="#create-a-scheduler-task-queue"
                                            id="ref-for-create-a-scheduler-task-queue①">创建调度器任务队列</a> 的结果，参数为
                                        <var>priority</var>、<var>isContinuation</var> 和以下步骤：
                                    </p>
                                    <ol>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove"
                                                    id="ref-for-map-remove①">移除</a> <a data-link-type="dfn"
                                                    href="#scheduler-static-priority-task-queue-map"
                                                    id="ref-for-scheduler-static-priority-task-queue-map②">静态优先级任务队列映射</a>[(<var>priority</var>,
                                                <var>isContinuation</var>)]。
                                            </p>
                                    </ol>
                                <li data-md>
                                    <p>设置 <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map"
                                            id="ref-for-scheduler-static-priority-task-queue-map③">静态优先级任务队列映射</a>[(<var>priority</var>,
                                        <var>isContinuation</var>)] 为
                                        <var>queue</var>。
                                    </p>
                            </ol>
                        <li data-md>
                            <p>返回 <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map"
                                    id="ref-for-scheduler-static-priority-task-queue-map④">静态优先级任务队列映射</a>[(<var>priority</var>,
                                <var>isContinuation</var>)]。
                            </p>
                    </ol>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="schedule a task to invoke an algorithm">
            要为 <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①①">Scheduler</a></code>
            <var>scheduler</var>，给定 <a data-link-type="dfn" href="#task-handle" id="ref-for-task-handle①">task
                handle</a> <var>handle</var> 和算法 <var>steps</var>，<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="schedule-a-task-to-invoke-an-algorithm">调度一个运行算法的任务</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>global</var> 为 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global①">相关全局对象</a>。</p>
                <li data-md>
                    <p>如果 <var>global</var> 是 <code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>
                        对象，令 <var>document</var> 为 <var>global</var> 的 <a class="idl-code" data-link-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window"
                            id="ref-for-concept-document-window">关联 <code>Document</code></a>；否则为 null。
                    </p>
                <li data-md>
                    <p>令 <var>event loop</var> 为 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent"
                            id="ref-for-relevant-agent③">相关 agent</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                            id="ref-for-concept-agent-event-loop③">事件循环</a>。</p>
                <li data-md>
                    <p>令 <var>enqueue order</var> 为 <var>event loop</var> 的 <a data-link-type="dfn"
                            href="#event-loop-next-enqueue-order" id="ref-for-event-loop-next-enqueue-order">next
                            enqueue order</a>。</p>
                <li data-md>
                    <p>将 <var>event loop</var> 的 <a data-link-type="dfn" href="#event-loop-next-enqueue-order"
                            id="ref-for-event-loop-next-enqueue-order①">next enqueue order</a> 加一。</p>
                <li data-md>
                    <p>将 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-task"
                            id="ref-for-task-handle-task①">任务</a> 设为在 <var>handle</var> 的 <a data-link-type="dfn"
                            href="#task-handle-queue" id="ref-for-task-handle-queue③">队列</a> 上，按 <var>enqueue
                            order</var>, <a data-link-type="dfn" href="#posted-task-task-source"
                            id="ref-for-posted-task-task-source">posted task 任务源</a> 和 <var>document</var> 调用 <a
                            data-link-type="dfn" href="#queue-a-scheduler-task"
                            id="ref-for-queue-a-scheduler-task">排队调度器任务</a> 的结果，并包含如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>执行 <var>steps</var>。</p>
                        <li data-md>
                            <p>执行 <var>handle</var> 的 <a data-link-type="dfn" href="#task-handle-task-complete-steps"
                                    id="ref-for-task-handle-task-complete-steps①">任务完成算法</a>。</p>
                    </ol>
            </ol>
            <p class="issue" id="issue-14b7599b"><a class="self-link" href="#issue-14b7599b"></a> 由于该算法可以在<a
                    data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                    id="ref-for-in-parallel">并行</a>步骤中被调用，因此本算法以及其它算法的部分实现存在数据争用问题。特别是
                <a data-link-type="dfn" href="#event-loop-next-enqueue-order"
                    id="ref-for-event-loop-next-enqueue-order②">next enqueue order</a> 应原子性更新，访问 <a data-link-type="dfn"
                    href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①④">调度器任务队列</a> 也需原子性，后者也影响事件循环任务队列（见
                <a href="https://github.com/whatwg/html/issues/6475">this
                    issue</a>）。
            </p>
        </div>
        <h4 class="heading settled" data-level="2.4.3" id="sec-scheduler-alg-select-next-task"><span
                class="secno">2.4.3. </span><span class="content">选择下一个要运行的任务</span><a class="self-link"
                href="#sec-scheduler-alg-select-next-task"></a></h4>
        <div class="algorithm" data-algorithm="has a runnable task"> 一个 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①②">调度器（Scheduler）</a></code>
            <var>scheduler</var> <dfn class="dfn-paneled" data-dfn-type="dfn"
                data-lt="has a runnable task|have a runnable task" data-noexport
                id="has-a-runnable-task">有可运行任务</dfn>，如果对 <var>scheduler</var> <a data-link-type="dfn"
                href="#get-the-runnable-task-queues" id="ref-for-get-the-runnable-task-queues">获取可运行任务队列</a> 的结果是非<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">空</a>。
        </div>
        <div class="algorithm" data-algorithm="get the runnable task queues">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="get-the-runnable-task-queues">获取可运行任务队列</dfn>，针对一个 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①③">Scheduler</a></code>
            <var>scheduler</var>：
            <ol>
                <li data-md>
                    <p>令 <var>queues</var> 为对 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="#scheduler-static-priority-task-queue-map"
                            id="ref-for-scheduler-static-priority-task-queue-map⑤">静态优先级任务队列映射</a> <a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values"
                            id="ref-for-map-getting-the-values">获取值</a> 的结果。
                    </p>
                <li data-md>
                    <p>用 <var>scheduler</var> 的 <a data-link-type="dfn"
                            href="#scheduler-dynamic-priority-task-queue-map"
                            id="ref-for-scheduler-dynamic-priority-task-queue-map⑤">动态优先级任务队列映射</a> <a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values"
                            id="ref-for-map-getting-the-values①">获取值</a> 的结果，<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#list-extend" id="ref-for-list-extend">扩展</a>
                        <var>queues</var>。
                    </p>
                <li data-md>
                    <p>从 <var>queues</var> 中<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove①">移除</a>所有其 <a data-link-type="dfn"
                            href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks⑤">任务</a>不包含<a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable"
                            id="ref-for-concept-task-runnable①">可运行</a>的<a data-link-type="dfn" href="#scheduler-task"
                            id="ref-for-scheduler-task⑨">调度器任务</a>的 <var>queue</var>。
                    </p>
                <li data-md>
                    <p>返回 <var>queues</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="select the next scheduler task queue from all schedulers">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="select-the-next-scheduler-task-queue-from-all-schedulers">从所有调度器中选择下一个调度器任务队列</dfn>，给定一个 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop②">事件循环</a> <var>event loop</var>，执行以下步骤。它们返回一个 <a data-link-type="dfn"
                href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①⑤">调度器任务队列</a>，若没有和 <var>event loop</var>
            关联的 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①④">Scheduler</a></code> <a
                data-link-type="dfn" href="#has-a-runnable-task" id="ref-for-has-a-runnable-task">有可运行任务</a>，则返回 null。
            <ol>
                <li data-md>
                    <p>令 <var>queues</var> 为一个空<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                            id="ref-for-ordered-set③">有序集合</a>。</p>
                <li data-md>
                    <p>令 <var>schedulers</var> 为所有 <code
                            class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑤">Scheduler</a></code>
                        对象的<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                            id="ref-for-ordered-set④">有序集合</a>，其 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent"
                            id="ref-for-relevant-agent④">相关代理</a>的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                            id="ref-for-concept-agent-event-loop④">事件循环</a>为 <var>event loop</var>，且<a
                            data-link-type="dfn" href="#has-a-runnable-task"
                            id="ref-for-has-a-runnable-task①">有可运行任务</a>。
                    </p>
                <li data-md>
                    <p>对 <var>schedulers</var> 中每个 <var>scheduler</var>，用 <a data-link-type="dfn"
                            href="#get-the-runnable-task-queues"
                            id="ref-for-get-the-runnable-task-queues①">获取可运行任务队列</a> 的结果 <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#list-extend" id="ref-for-list-extend①">扩展</a>
                        <var>queues</var>。
                    </p>
                <li data-md>
                    <p>如果 <var>queues</var> 为<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty"
                            id="ref-for-list-empty②">空</a>，返回 null。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove②">移除</a> 从 <var>queues</var> 中的任何 <var>queue</var>，使得
                        <var>queue</var> 的 <a data-link-type="dfn" href="#scheduler-task-queue-effective-priority"
                            id="ref-for-scheduler-task-queue-effective-priority①">有效优先级</a> 小于
                        <var>queues</var> 的任何其他 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item"
                            id="ref-for-list-item">项</a>。
                    </p>
                <li data-md>
                    <p>令 <var>queue</var> 为 <var>queues</var> 中 <a data-link-type="dfn" href="#scheduler-task-queue"
                            id="ref-for-scheduler-task-queue①⑥">调度器任务队列</a>，其 <a data-link-type="dfn"
                            href="#scheduler-task-queue-first-runnable-task"
                            id="ref-for-scheduler-task-queue-first-runnable-task">首个可运行任务</a>是<a data-link-type="dfn"
                            href="#scheduler-task-older-than" id="ref-for-scheduler-task-older-than">最老</a>的。 <br><span
                            class="note">两个任务不会有相同的 age，因为 <a data-link-type="dfn" href="#scheduler-task-enqueue-order"
                                id="ref-for-scheduler-task-enqueue-order④">入队顺序</a>是唯一的。</span></p>
                <li data-md>
                    <p>返回 <var>queue</var>。</p>
            </ol>
            <p class="note" role="note"><span class="marker">注意：</span>下一个将要运行的任务是所有与 <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                    id="ref-for-event-loop③">事件循环</a> 相关联的 <code
                    class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑥">Scheduler</a></code>
                中，优先级最高且最老的<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable"
                    id="ref-for-concept-task-runnable②">可运行</a> <a data-link-type="dfn" href="#scheduler-task"
                    id="ref-for-scheduler-task①⓪">调度器任务</a>。</p>
        </div>
        <h3 class="heading settled" data-level="2.5" id="sec-scheduling-tasks-examples"><span class="secno">2.5.
            </span><span class="content">示例</span><a class="self-link" href="#sec-scheduling-tasks-examples"></a>
        </h3>
        <p><strong>TODO</strong>(shaseley)：添加示例。</p>
        <h2 class="heading settled" data-level="3" id="sec-controlling-tasks"><span class="secno">3. </span><span
                class="content">控制任务</span><a class="self-link" href="#sec-controlling-tasks"></a></h2>
        <p> 通过 <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑦">Scheduler</a></code>
            接口调度的任务可以通过 <code
                class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller②">TaskController</a></code>
            控制，
            只需在调用 <code
                class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑥">postTask()</a></code>
            时传入 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①③">TaskSignal</a></code>，
            该信号由 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal">controller.signal</a></code>
            提供，
            作为 <code
                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑧">option</a></code>
            传递。
            <code
                class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller③">TaskController</a></code>
            接口支持终止任务或任务组、变更优先级。
        </p>
        <h3 class="heading settled" data-level="3.1" id="sec-task-priority-change-event"><span class="secno">3.1.
            </span><span class="content"><code>TaskPriorityChangeEvent</code> 接口</span><a class="self-link"
                href="#sec-task-priority-change-event"></a></h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="taskprioritychangeevent"><code><c- g>TaskPriorityChangeEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEvent" data-dfn-type="constructor" data-export data-lt="TaskPriorityChangeEvent(type, priorityChangeEventInitDict)|constructor(type, priorityChangeEventInitDict)" id="dom-taskprioritychangeevent-taskprioritychangeevent"><code><c- g>constructor</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEvent/TaskPriorityChangeEvent(type, priorityChangeEventInitDict), TaskPriorityChangeEvent/constructor(type, priorityChangeEventInitDict)" data-dfn-type="argument" data-export id="dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type"><code><c- g>type</c-></code></dfn>, <a data-link-type="idl-name" href="#dictdef-taskprioritychangeeventinit" id="ref-for-dictdef-taskprioritychangeeventinit"><c- n>TaskPriorityChangeEventInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEvent/TaskPriorityChangeEvent(type, priorityChangeEventInitDict), TaskPriorityChangeEvent/constructor(type, priorityChangeEventInitDict)" data-dfn-type="argument" data-export id="dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict"><code><c- g>priorityChangeEventInitDict</c-></code></dfn>);

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⓪"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority"><c- g>previousPriority</c-></a>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-taskprioritychangeeventinit"><code><c- g>TaskPriorityChangeEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①①"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEventInit" data-dfn-type="dict-member" data-export data-type="TaskPriority" id="dom-taskprioritychangeeventinit-previouspriority"><code><c- g>previousPriority</c-></code></dfn>;
};
</pre>
        <dl class="domintro non-normative">
            <dt><code>event . <code class="idl"><a data-link-type="idl" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority①">previousPriority</a></code></code>
            <dd>
                <p>返回对应 <code
                        class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①②">TaskPriority</a></code>
                    的 <code
                        class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①④">TaskSignal</a></code>
                    在本次 <code>prioritychange</code> 事件发生前的值。</p>
                <p>新的 <code
                        class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①③">TaskPriority</a></code>
                    可通过 <code>event.target.priority</code> 读取。</p>
        </dl>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEvent" data-dfn-type="attribute"
                data-export id="dom-taskprioritychangeevent-previouspriority"><code>previousPriority</code></dfn> 的
            getter 步骤是返回该属性在初始化时设置的值。</p>
        <h3 class="heading settled" data-level="3.2" id="sec-task-controller"><span class="secno">3.2. </span><span
                class="content"><code>TaskController</code> 接口</span><a class="self-link"
                href="#sec-task-controller"></a></h3>
        <pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-taskcontrollerinit"><code><c- g>TaskControllerInit</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①④"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;user-visible&quot;" data-dfn-for="TaskControllerInit" data-dfn-type="dict-member" data-export data-type="TaskPriority" id="dom-taskcontrollerinit-priority"><code><c- g>priority</c-></code></dfn> = "user-visible";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="taskcontroller"><code><c- g>TaskController</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller"><c- n>AbortController</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-taskcontroller-taskcontroller" id="ref-for-dom-taskcontroller-taskcontroller"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-taskcontrollerinit" id="ref-for-dictdef-taskcontrollerinit"><c- n>TaskControllerInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskController/TaskController(init), TaskController/constructor(init), TaskController/TaskController(), TaskController/constructor()" data-dfn-type="argument" data-export id="dom-taskcontroller-taskcontroller-init-init"><code><c- g>init</c-></code></dfn> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority①"><c- g>setPriority</c-></a>(<a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑤"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskController/setPriority(priority)" data-dfn-type="argument" data-export id="dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code></dfn>);
};
</pre>
        <p class="note" role="note"><span class="marker">注意：</span><code
                class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller④">TaskController</a></code>
            的
            <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal①">signal</a></code>
            getter（继承自 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller①">AbortController</a></code>），
            返回一个 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑤">TaskSignal</a></code>
            对象。
        </p>
        <dl class="domintro non-normative">
            <dt><code>controller = new <code class="idl"><a data-link-type="idl" href="#dom-taskcontroller-taskcontroller" id="ref-for-dom-taskcontroller-taskcontroller①">TaskController</a></code>(
                <var>init</var> )</code>
            <dd>
                <p>返回一个新的 <code
                        class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller⑤">TaskController</a></code>，
                    其 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal②">signal</a></code>
                    被设置为新创建的 <code
                        class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑥">TaskSignal</a></code>，
                    并用 <var>init</var> 的 <code
                        class="idl"><a data-link-type="idl" href="#dom-taskcontrollerinit-priority" id="ref-for-dom-taskcontrollerinit-priority">priority</a></code>
                    初始化其 <code
                        class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority①">priority</a></code>。
                </p>
            <dt><code>controller . <code class="idl"><a data-link-type="idl" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority②">setPriority</a></code>(
                <var>priority</var> )</code>
            <dd>
                <p>调用此方法会更改关联的 <code
                        class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑦">TaskSignal</a></code>
                    的
                    <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority④">priority</a>，
                    向所有观察者发出优先级变更信号，并触发 <code>prioritychange</code> 事件。
                </p>
        </dl>
        <div class="algorithm" data-algorithm="TaskController()" data-algorithm-for="TaskController">
            <dfn class="dfn-paneled idl-code" data-dfn-for="TaskController" data-dfn-type="constructor" data-export
                data-lt="TaskController(init)|constructor(init)|TaskController()|constructor()"
                id="dom-taskcontroller-taskcontroller"><code>new TaskController(<var>init</var>)</code></dfn>
            构造步骤如下：
            <ol>
                <li data-md>
                    <p>令 <var>signal</var> 为一个新的 <code
                            class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑧">TaskSignal</a></code>
                        对象。</p>
                <li data-md>
                    <p>将 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                            id="ref-for-tasksignal-priority⑤">priority</a> 设置为 <var>init</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-taskcontrollerinit-priority" id="ref-for-dom-taskcontrollerinit-priority①">priority</a></code>"]。
                    </p>
                <li data-md>
                    <p>将 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>
                        的 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortcontroller-signal"
                            id="ref-for-abortcontroller-signal">signal</a> 设置为 <var>signal</var>。</p>
            </ol>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskController" data-dfn-type="method" data-export
                id="dom-taskcontroller-setpriority"><code>setPriority(<var>priority</var>)</code></dfn> 方法步骤为：在 <a
                data-link-type="dfn" href="#tasksignal-signal-priority-change"
                id="ref-for-tasksignal-signal-priority-change">signal priority change</a> 上，对 <a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a> 的 <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#abortcontroller-signal"
                id="ref-for-abortcontroller-signal①">signal</a>，传入 <var>priority</var>。</p>
        <h3 class="heading settled" data-level="3.3" id="sec-task-signal"><span class="secno">3.3. </span><span
                class="content"><code>TaskSignal</code> 接口</span><a class="self-link" href="#sec-task-signal"></a></h3>
        <pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-tasksignalanyinit"><code><c- g>TaskSignalAnyInit</c-></code></dfn> {
  (<a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑥"><c- n>TaskPriority</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#tasksignal" id="ref-for-tasksignal①⑨"><c- n>TaskSignal</c-></a>) <dfn class="dfn-paneled idl-code" data-default="&quot;user-visible&quot;" data-dfn-for="TaskSignalAnyInit" data-dfn-type="dict-member" data-export data-type="(TaskPriority or TaskSignal)" id="dom-tasksignalanyinit-priority"><code><c- g>priority</c-></code></dfn> = "user-visible";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="tasksignal"><code><c- g>TaskSignal</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①①"><c- n>AbortSignal</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject" id="ref-for-NewObject"><c- g>NewObject</c-></a>] <c- b>static</c-> <a data-link-type="idl-name" href="#tasksignal" id="ref-for-tasksignal②⓪"><c- n>TaskSignal</c-></a> <a class="idl-code" data-link-type="method" href="#dom-tasksignal-any" id="ref-for-dom-tasksignal-any"><c- g>_any</c-></a>(<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①②"><c- n>AbortSignal</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal/any(signals, init), TaskSignal/any(signals)" data-dfn-type="argument" data-export id="dom-tasksignal-any-signals-init-signals"><code><c- g>signals</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-tasksignalanyinit" id="ref-for-dictdef-tasksignalanyinit"><c- n>TaskSignalAnyInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal/any(signals, init), TaskSignal/any(signals)" data-dfn-type="argument" data-export id="dom-tasksignal-any-signals-init-init"><code><c- g>init</c-></code></dfn> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑦"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority②"><c- g>priority</c-></a>;

  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-tasksignal-onprioritychange" id="ref-for-dom-tasksignal-onprioritychange"><c- g>onprioritychange</c-></a>;
};
</pre>
        <p class="note" role="note"><span class="marker">注意：</span><code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②①">TaskSignal</a></code>
            继承自 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①③">AbortSignal</a></code>
            可用于所有接受 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①④">AbortSignal</a></code>
            的 API。
            此外，<code
                class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑦">postTask()</a></code>
            也接受 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①⑤">AbortSignal</a></code>，
            如果不需要动态优先级，也非常有用。</p>
        <dl class="domintro non-normative">
            <dt><code>TaskSignal . <a class="idl-code" data-link-type="method" href="#dom-tasksignal-any" id="ref-for-dom-tasksignal-any①">any</a>(<var>signals</var>, <var>init</var>)</code>
            <dd>返回一个 <code
                    class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②②">TaskSignal</a></code>
                实例，当 <var>signals</var> 中任意一个被中止时也会被中止。它的 <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                    id="ref-for-abortsignal-abort-reason⑤">中止原因</a> 将设置为使其中止的 <var>signals</var> 中的某一个。
                此 signal 的 <a data-link-type="dfn" href="#tasksignal-priority"
                    id="ref-for-tasksignal-priority⑥">priority</a> 将由 <var>init</var> 的 <code
                    class="idl"><a data-link-type="idl" href="#dom-tasksignalanyinit-priority" id="ref-for-dom-tasksignalanyinit-priority">priority</a></code>
                决定，
                可以为固定 <code
                    class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑧">TaskPriority</a></code>
                ，也可以是 <code
                    class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②③">TaskSignal</a></code>
                ，
                若为后者，新信号的 <a data-link-type="dfn" href="#tasksignal-priority"
                    id="ref-for-tasksignal-priority⑦">priority</a> 会随该信号改变。
            <dt><code>signal . <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority③">priority</a></code></code>
            <dd>
                <p>返回该信号的 <code
                        class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑨">TaskPriority</a></code>。
                </p>
        </dl>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②④">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-priority">priority</dfn>（<code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②⓪">TaskPriority</a></code>）。
        </p>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⑤">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-priority-changing">priority changing</dfn>（<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">布尔</a>），初始为 false。
        </p>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⑥">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-priority-change-algorithms">priority change algorithms</dfn>，
            （<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                id="ref-for-ordered-set⑤">算法集合</a>，当 <a data-link-type="dfn" href="#tasksignal-priority-changing"
                id="ref-for-tasksignal-priority-changing">priority changing</a> 为 true 时执行），最初为空。
        </p>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⑦">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-source-signal">source signal</dfn>（对 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⑧">TaskSignal</a></code>
            的弱引用，
            该对象依赖于其 <a data-link-type="dfn" href="#tasksignal-priority"
                id="ref-for-tasksignal-priority⑧">priority</a>），初始为 null。
        </p>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⑨">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-dependent-signals">dependent signals</dfn>（对 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③⓪">TaskSignal</a></code>
            的弱<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                id="ref-for-ordered-set⑥">集合</a>，这些对象依赖于自身的 <a data-link-type="dfn" href="#tasksignal-priority"
                id="ref-for-tasksignal-priority⑨">priority</a>），初始为空。
        </p>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③①">TaskSignal</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-dependent">dependent</dfn>（布尔值），初始为 false。
        </p>
        <hr>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export
                id="dom-tasksignal-priority"><code>priority</code></dfn> getter 步骤为返回 <a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a> 的 <a data-link-type="dfn"
                href="#tasksignal-priority" id="ref-for-tasksignal-priority①⓪">priority</a>。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export
                id="dom-tasksignal-onprioritychange"><code>onprioritychange</code></dfn> 属性是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"
                id="ref-for-event-handler-idl-attributes">事件处理 IDL 属性</a>，
            用于 <code>onprioritychange</code> <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers"
                id="ref-for-event-handlers">事件处理函数</a>，其 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type"
                id="ref-for-event-handler-event-type">事件处理类型</a>为 <dfn class="dfn-paneled idl-code"
                data-dfn-for="TaskSignal" data-dfn-type="event" data-export
                id="eventdef-tasksignal-prioritychange"><code>prioritychange</code></dfn>。
        </p>
        <p>静态 <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="method" data-export
                data-lt="any(signals, init)|any(signals)"
                id="dom-tasksignal-any"><code>any(<var>signals</var>, <var>init</var>)</code></dfn> 方法步骤为返回<a
                data-link-type="dfn" href="#create-a-dependent-task-signal"
                id="ref-for-create-a-dependent-task-signal">创建依赖任务信号</a> 的结果，参数为 <var>signals</var>、<var>init</var> 及当前
            <a data-link-type="dfn" href="https://tc39.es/ecma262/#current-realm" id="ref-for-current-realm">realm</a>。
        </p>
        <hr>
        <p><code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③②">TaskSignal</a></code>
            <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn"
                data-lt="has fixed priority|have fixed priority" data-noexport
                id="tasksignal-has-fixed-priority">有固定优先级</dfn>，如果它是一个 <a data-link-type="dfn"
                href="#tasksignal-dependent" id="ref-for-tasksignal-dependent">dependent</a> signal 且其 <a
                data-link-type="dfn" href="#tasksignal-source-signal" id="ref-for-tasksignal-source-signal">source
                signal</a> 为 null。
        </p>
        <p>要<dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-add-a-priority-change-algorithm">添加优先级更改算法</dfn>
            <var>algorithm</var> 到 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③③">TaskSignal</a></code>
            对象 <var>signal</var>，<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                id="ref-for-set-append①">追加</a> <var>algorithm</var> 到 <var>signal</var> 的 <a data-link-type="dfn"
                href="#tasksignal-priority-change-algorithms"
                id="ref-for-tasksignal-priority-change-algorithms">priority change algorithms</a>。
        </p>
        <div class="algorithm" data-algorithm="create a dependent task signal">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="create-a-dependent-task-signal">创建依赖任务信号</dfn>，根据 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> 的 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①⑥">AbortSignal</a></code>
            对象 <var>signals</var>，
            <code
                class="idl"><a data-link-type="idl" href="#dictdef-tasksignalanyinit" id="ref-for-dictdef-tasksignalanyinit①">TaskSignalAnyInit</a></code>
            <var>init</var> 及 <var>realm</var>：
            <ol>
                <li data-md>
                    <p>令 <var>resultSignal</var> 为用 <code
                            class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③④">TaskSignal</a></code>
                        接口 和 <var>realm</var> 从 <var>signals</var> <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#create-a-dependent-abort-signal"
                            id="ref-for-create-a-dependent-abort-signal">创建依赖信号</a> 的结果。
                    </p>
                <li data-md>
                    <p>将 <var>resultSignal</var> 的 <a data-link-type="dfn" href="#tasksignal-dependent"
                            id="ref-for-tasksignal-dependent①">dependent</a> 设为 true。</p>
                <li data-md>
                    <p>如果 <var>init</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-tasksignalanyinit-priority" id="ref-for-dom-tasksignalanyinit-priority①">priority</a></code>"]
                        是 <code
                            class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②①">TaskPriority</a></code>：
                    </p>
                    <ol>
                        <li data-md>
                            <p>将 <var>resultSignal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                                    id="ref-for-tasksignal-priority①①">priority</a> 设为 <var>init</var>["<code
                                    class="idl"><a data-link-type="idl" href="#dom-tasksignalanyinit-priority" id="ref-for-dom-tasksignalanyinit-priority②">priority</a></code>"]。
                            </p>
                    </ol>
                <li data-md>
                    <p>否则：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>sourceSignal</var> 为 <var>init</var>["<code
                                    class="idl"><a data-link-type="idl" href="#dom-tasksignalanyinit-priority" id="ref-for-dom-tasksignalanyinit-priority③">priority</a></code>"]。
                            </p>
                        <li data-md>
                            <p>将 <var>resultSignal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                                    id="ref-for-tasksignal-priority①②">priority</a> 设为 <var>sourceSignal</var> 的 <a
                                    data-link-type="dfn" href="#tasksignal-priority"
                                    id="ref-for-tasksignal-priority①③">priority</a>。</p>
                        <li data-md>
                            <p>如果 <var>sourceSignal</var> 不 <a data-link-type="dfn"
                                    href="#tasksignal-has-fixed-priority"
                                    id="ref-for-tasksignal-has-fixed-priority①">有固定优先级</a>，则：</p>
                            <ol>
                                <li data-md>
                                    <p>如果 <var>sourceSignal</var> 的 <a data-link-type="dfn" href="#tasksignal-dependent"
                                            id="ref-for-tasksignal-dependent②">dependent</a> 为 true，则将
                                        <var>sourceSignal</var> 设为其 <a data-link-type="dfn"
                                            href="#tasksignal-source-signal"
                                            id="ref-for-tasksignal-source-signal①">source signal</a>。
                                    </p>
                                <li data-md>
                                    <p class="assertion">断言：<var>sourceSignal</var> 不是 <a data-link-type="dfn"
                                            href="#tasksignal-dependent"
                                            id="ref-for-tasksignal-dependent③">dependent</a>。</p>
                                <li data-md>
                                    <p>将 <var>resultSignal</var> 的 <a data-link-type="dfn"
                                            href="#tasksignal-source-signal"
                                            id="ref-for-tasksignal-source-signal②">source signal</a> 设置为
                                        <var>sourceSignal</var> 的弱引用。
                                    </p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                                            id="ref-for-set-append②">追加</a> <var>resultSignal</var> 到
                                        <var>sourceSignal</var> 的 <a data-link-type="dfn"
                                            href="#tasksignal-dependent-signals"
                                            id="ref-for-tasksignal-dependent-signals">dependent signals</a>。
                                    </p>
                            </ol>
                    </ol>
                <li data-md>
                    <p>返回 <var>resultSignal</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="signal priority change" data-algorithm-for="TaskSignal">
            要<dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport
                id="tasksignal-signal-priority-change">触发优先级变更</dfn>，针对 <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③⑤">TaskSignal</a></code>
            对象 <var>signal</var>，给定 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②②">TaskPriority</a></code>
            <var>priority</var>:
            <ol>
                <li data-md>
                    <p>如果 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority-changing"
                            id="ref-for-tasksignal-priority-changing①">priority changing</a> 为 true，则 <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw"
                            id="ref-for-dfn-throw">抛出</a> "<code
                            class="idl"><a class="idl-code" data-link-type="exception" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                            id="ref-for-tasksignal-priority①④">priority</a> 等于 <var>priority</var> 则返回。</p>
                <li data-md>
                    <p>将 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority-changing"
                            id="ref-for-tasksignal-priority-changing②">priority changing</a> 设为 true。</p>
                <li data-md>
                    <p>令 <var>previousPriority</var> 为 <var>signal</var> 的 <a data-link-type="dfn"
                            href="#tasksignal-priority" id="ref-for-tasksignal-priority①⑤">priority</a>。</p>
                <li data-md>
                    <p>将 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority"
                            id="ref-for-tasksignal-priority①⑥">priority</a> 设为 <var>priority</var>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate">遍历</a> <var>signal</var> 的 <a data-link-type="dfn"
                            href="#tasksignal-priority-change-algorithms"
                            id="ref-for-tasksignal-priority-change-algorithms①">priority change algorithms</a>，并运行每个
                        <var>algorithm</var>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire">触发事件</a>，事件名为 <code
                            class="idl"><a data-link-type="idl" href="#eventdef-tasksignal-prioritychange" id="ref-for-eventdef-tasksignal-prioritychange">prioritychange</a></code>，
                        目标为 <var>signal</var>，使用 <code
                            class="idl"><a data-link-type="idl" href="#taskprioritychangeevent" id="ref-for-taskprioritychangeevent">TaskPriorityChangeEvent</a></code>，
                        其 <code
                            class="idl"><a data-link-type="idl" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority②">previousPriority</a></code>
                        初始化为 <var>previousPriority</var>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate①">遍历</a> <var>signal</var> 的 <a data-link-type="dfn"
                            href="#tasksignal-dependent-signals" id="ref-for-tasksignal-dependent-signals①">dependent
                            signals</a>，对每个 <var>dependentSignal</var> 调用 <a data-link-type="dfn"
                            href="#tasksignal-signal-priority-change"
                            id="ref-for-tasksignal-signal-priority-change①">signal priority change</a> ，参数为
                        <var>priority</var>。
                    </p>
                <li data-md>
                    <p>将 <var>signal</var> 的 <a data-link-type="dfn" href="#tasksignal-priority-changing"
                            id="ref-for-tasksignal-priority-changing③">priority changing</a> 设为 false。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="create a fixed priority unabortable task signal">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="create-a-fixed-priority-unabortable-task-signal">创建固定优先级且不可中止任务信号</dfn>，给定 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②③">TaskPriority</a></code>
            <var>priority</var> 和 <a data-link-type="dfn"
                href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm"
                id="ref-for-realm">realm</a> <var>realm</var>。
            <ol>
                <li data-md>
                    <p>令 <var>init</var> 为新的 <code
                            class="idl"><a data-link-type="idl" href="#dictdef-tasksignalanyinit" id="ref-for-dictdef-tasksignalanyinit②">TaskSignalAnyInit</a></code>。
                    </p>
                <li data-md>
                    <p>将 <var>init</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-tasksignalanyinit-priority" id="ref-for-dom-tasksignalanyinit-priority④">priority</a></code>"]
                        设为 <var>priority</var>。</p>
                <li data-md>
                    <p>返回 <a data-link-type="dfn" href="#create-a-dependent-task-signal"
                            id="ref-for-create-a-dependent-task-signal①">创建依赖任务信号</a> 的结果，参数为 « »、<var>init</var> 和
                        <var>realm</var>。
                    </p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.3.1" id="sec-task-signal-garbage-collection"><span
                class="secno">3.3.1. </span><span class="content">垃圾回收</span><a class="self-link"
                href="#sec-task-signal-garbage-collection"></a></h4>
        <p><a data-link-type="dfn" href="#tasksignal-dependent" id="ref-for-tasksignal-dependent④">dependent</a> <code
                class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③⑥">TaskSignal</a></code>
            对象在其 <a data-link-type="dfn" href="#tasksignal-source-signal" id="ref-for-tasksignal-source-signal③">source
                signal</a> 非 null 且为 <code
                class="idl"><a data-link-type="idl" href="#eventdef-tasksignal-prioritychange" id="ref-for-eventdef-tasksignal-prioritychange①">prioritychange</a></code>
            事件注册过监听器，或其 <a data-link-type="dfn" href="#tasksignal-priority-change-algorithms"
                id="ref-for-tasksignal-priority-change-algorithms②">priority change algorithms</a> 非空时，不可被垃圾回收。</p>
        <h3 class="heading settled" data-level="3.4" id="sec-controlling-tasks-examples"><span class="secno">3.4.
            </span><span class="content">示例</span><a class="self-link" href="#sec-controlling-tasks-examples"></a>
        </h3>
        <p><strong>TODO</strong>(shaseley)：添加示例。</p>
        <h2 class="heading settled" data-level="4" id="sec-patches"><span class="secno">4. </span><span
                class="content">对其他标准的修改</span><a class="self-link" href="#sec-patches"></a>
        </h2>
        <h3 class="heading settled" data-level="4.1" id="sec-patches-html"><span class="secno">4.1. </span><span
                class="content">HTML 标准</span><a class="self-link" href="#sec-patches-html"></a></h3>
        <h4 class="heading settled" data-level="4.1.1" id="sec-patches-html-windoworworkerglobalscope"><span
                class="secno">4.1.1. </span><span class="content"><code>WindowOrWorkerGlobalScope</code></span><a
                class="self-link" href="#sec-patches-html-windoworworkerglobalscope"></a></h4>
        <p>每个实现了 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code>
            mixin 的对象都有一个对应的 <dfn class="dfn-paneled" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="dfn"
                data-noexport id="windoworworkerglobalscope-scheduler">scheduler</dfn>，初始化为新的 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑧">Scheduler</a></code>。</p>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope①"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Replaceable" id="ref-for-Replaceable"><c- g>Replaceable</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler" id="ref-for-scheduler①⑨"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler" id="ref-for-dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};
</pre>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="attribute"
                data-export id="dom-windoworworkerglobalscope-scheduler"><code>scheduler</code></dfn> 属性的 getter 步骤为
            返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a> 的 <a
                data-link-type="dfn" href="#windoworworkerglobalscope-scheduler"
                id="ref-for-windoworworkerglobalscope-scheduler">scheduler</a>。</p>
        <h4 class="heading settled" data-level="4.1.2" id="sec-patches-html-event-loop-definitions"><span
                class="secno">4.1.2. </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">事件循环：定义</a></span><a
                class="self-link" href="#sec-patches-html-event-loop-definitions"></a></h4>
        <p>替换：对于每个 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop④">event
                loop</a>，每个 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source③">task
                source</a> 必须关联一个具体的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue">task
                queue</a>。</p>
        <p>改为：对于每个 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop⑤">event
                loop</a>，每一个不是 <a data-link-type="dfn" href="#scheduler-task-sources"
                id="ref-for-scheduler-task-sources">scheduler task source</a> 的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source④">task
                source</a> 必须被关联到一个具体的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue①">task
                queue</a>。</p>
        <p>新增：<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop⑥">event loop</a> 有一个数值型 <dfn class="dfn-paneled" data-dfn-for="event loop"
                data-dfn-type="dfn" data-noexport id="event-loop-next-enqueue-order">next enqueue order</dfn>，初始化为 1。
        </p>
        <p class="note" role="note"><span class="marker">注意：</span><a data-link-type="dfn"
                href="#event-loop-next-enqueue-order" id="ref-for-event-loop-next-enqueue-order③">next enqueue order</a>
            是严格递增数，用于在所有与同一个 <a data-link-type="dfn" href="#scheduler-task-queue"
                id="ref-for-scheduler-task-queue①⑦">scheduler task queues</a> 相关联的 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②④">TaskPriority</a></code>
            下确定任务执行顺序。
            随着队列推进，可以使用时间戳，只要它严格递增且唯一。</p>
        <p>新增：<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop⑧">event loop</a> 有一个 <dfn class="dfn-paneled" data-dfn-for="event loop"
                data-dfn-type="dfn" data-noexport id="event-loop-current-continuation-state">current continuation
                state</dfn>（<a data-link-type="dfn" href="#continuation-state"
                id="ref-for-continuation-state">continuation state</a> 或 null），初始为 null。</p>
        <p>添加如下算法：</p>
        <div class="algorithm" data-algorithm="set the continuation state value">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-the-continuation-state-value">设置
                continuation state 值</dfn>，针对 <var>key</var> 和 <var>value</var>，给定 <var>eventLoop</var>（一个<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop⑨">event loop</a>）：
            <ol>
                <li data-md>
                    <p>如果 <var>eventLoop</var> 的 <a data-link-type="dfn" href="#event-loop-current-continuation-state"
                            id="ref-for-event-loop-current-continuation-state①">current continuation state</a> 为 null，
                        则将其设为新的 <a data-link-type="dfn" href="#continuation-state"
                            id="ref-for-continuation-state①">continuation
                            state</a>。
                    </p>
                <li data-md>
                    <p>令 <var>continuationState</var> 为 <var>eventLoop</var> 的 <a data-link-type="dfn"
                            href="#event-loop-current-continuation-state"
                            id="ref-for-event-loop-current-continuation-state③">current continuation state</a>。</p>
                <li data-md>
                    <p class="assertion">断言：<var>continuationState</var> 的 <a data-link-type="dfn"
                            href="#continuation-state-state-map" id="ref-for-continuation-state-state-map②">state
                            map</a>[<var>key</var>] 不 <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">存在</a>。</p>
                <li data-md>
                    <p>将 <var>continuationState</var> 的 <a data-link-type="dfn" href="#continuation-state-state-map"
                            id="ref-for-continuation-state-state-map③">state map</a>[<var>key</var>] 设为
                        <var>value</var>。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="get the continuation state value">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-continuation-state-value">获取
                continuation state 值</dfn>，针对 <var>key</var> ，给定 <var>eventLoop</var>（一个 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①⓪">event
                loop</a>）：
            <ol>
                <li data-md>
                    <p>令 <var>continuationState</var> 为 <var>eventLoop</var> 的 <a data-link-type="dfn"
                            href="#event-loop-current-continuation-state"
                            id="ref-for-event-loop-current-continuation-state④">current continuation state</a>。</p>
                <li data-md>
                    <p>如果 <var>continuationState</var> 非 null 且 <var>continuationState</var> 的 <a data-link-type="dfn"
                            href="#continuation-state-state-map" id="ref-for-continuation-state-state-map④">state
                            map</a>[<var>key</var>] <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑤">存在</a>，则返回
                        <var>continuationState</var> 的 <a data-link-type="dfn" href="#continuation-state-state-map"
                            id="ref-for-continuation-state-state-map⑤">state map</a>[<var>key</var>]，否则返回 null。
                    </p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="4.1.3" id="sec-patches-html-event-loop-processing"><span
                class="secno">4.1.3. </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">事件循环：处理模型</a></span><a
                class="self-link" href="#sec-patches-html-event-loop-processing"></a></h4>
        <p>在事件循环处理步骤的第 2 步之前，添加如下步骤：</p>
        <ol>
            <li data-md>
                <p>令 <var>queues</var> 为 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                        id="ref-for-ordered-set⑦">集合</a>，包含 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                        id="ref-for-event-loop①①">event loop</a> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue"
                        id="ref-for-task-queue②">task queues</a> ，且队列包含至少一个 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable"
                        id="ref-for-concept-task-runnable③">可运行</a> <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                        id="ref-for-concept-task⑤">任务</a>。</p>
            <li data-md>
                <p>令 <var>schedulerQueue</var> 为 <a data-link-type="dfn"
                        href="#select-the-next-scheduler-task-queue-from-all-schedulers"
                        id="ref-for-select-the-next-scheduler-task-queue-from-all-schedulers①">从所有调度器中选择下一个调度器任务队列</a>
                    的结果。</p>
        </ol>
        <p>修改步骤 2：</p>
        <ol>
            <li data-md>
                <p>若 <var>schedulerQueue</var> 不为 null 或 <var>queues</var> 不<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty③">为空</a>：</p>
        </ol>
        <p>修改 2.1 步如下：</p>
        <ol>
            <li data-md>
                <p>令 <var>taskQueue</var> 为下列之一，以 <a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#implementation-defined"
                        id="ref-for-implementation-defined">实现自定义</a>方式选出：</p>
                <ul>
                    <li data-md>
                        <p>若 <var>queues</var> 不<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty"
                                id="ref-for-list-empty④">为空</a>，则在 <var>queues</var> 中以 <a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#implementation-defined"
                                id="ref-for-implementation-defined①">实现自定义</a>方式选一个 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue"
                                id="ref-for-task-queue③">task queues</a>。</p>
                    <li data-md>
                        <p>若 <var>schedulerQueue</var> 不为 null，则为 <var>schedulerQueue</var> 的 <a data-link-type="dfn"
                                href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks⑥">tasks</a>。
                        </p>
                </ul>
        </ol>
        <p class="note" role="note"><span class="marker">注意：</span>HTML 规范通过让事件循环处理步骤中选择下一个 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑤">task
                source</a> 的优先级可按源调整，
            同理，本规范中用于在所有相关 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①②">event
                loop</a> 的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue⑤">task
                queues</a> 和 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②①">Scheduler</a></code>
            任务之间选择任务也是实现自定义的，
            这样为 UA 提供最大调度灵活性。<br><br>不过本规范的目的是让 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②②">Scheduler</a></code>
            任务的 <code
                class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②⑤">TaskPriority</a></code>
            能影响事件循环优先级。
            其中 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background④">background</a></code>"
            任务和连续体通常比大多数其他事件循环任务更不重要，
            而 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking⑥">user-blocking</a></code>"
            任务和连续体，以及 "<code
                class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible⑧">user-visible</a></code>"
            连续体（非任务）通常被视为更重要。<br><br>一种策略是，让 <code
                class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②③">Scheduler</a></code>
            任务中 <a data-link-type="dfn" href="#scheduler-task-queue-effective-priority"
                id="ref-for-scheduler-task-queue-effective-priority②">effective priority</a> 大于等于 3 的任务优先执行，
            比如设置为只低于输入、渲染等紧急工作，但高于大多数其他 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑥">task
                sources</a>。
            <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②④">Scheduler</a></code>
            任务的 <a data-link-type="dfn" href="#scheduler-task-queue-effective-priority"
                id="ref-for-scheduler-task-queue-effective-priority③">effective priority</a> 为 0 或 1 只在事件循环 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue"
                id="ref-for-task-queue⑥">task
                queues</a> 无可运行任务时才调度，而为 2 时可视为超时等调度任务源。
        </p>
        <p class="issue" id="issue-04c96c57"><a class="self-link" href="#issue-04c96c57"></a> 这一步中的 <var>taskQueue</var>
            既可能是 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                id="ref-for-ordered-set⑧">任务集合</a>，也可能是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                id="ref-for-concept-task⑦">任务</a> 的集合，或 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑨">scheduler tasks</a>
            的集合。后续步骤只是 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                id="ref-for-list-remove③">删除</a>一个 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list-item"
                id="ref-for-list-item①">项目</a>，因此大致兼容。理想情况下应有统一的任务队列接口并支持 pop() 方法直接返回普通 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                id="ref-for-concept-task⑧">task</a>，但这涉及较多重构。
        </p>
        <h4 class="heading settled" data-level="4.1.4" id="sec-patches-html-queuing-tasks"><span class="secno">4.1.4.
            </span><span class="content"><a href="https://html.spec.whatwg.org/#queuing-tasks">事件循环：任务排队</a></span><a
                class="self-link" href="#sec-patches-html-queuing-tasks"></a></h4>
        <p>将 <a href="https://html.spec.whatwg.org/#queue-a-microtask">排队微任务</a>算法修改为接受一个可选布尔值
            <var>ignoreContinuationState</var>（默认为 false）。
        </p>
        <p>将第 5 步修改为：</p>
        <ol>
            <li data-md>
                <p>令 <var>continuationState</var> 为 null。</p>
            <li data-md>
                <p>如果 <var>ignoreContinuationState</var> 为 false 且 <var>eventLoop</var> 的<a data-link-type="dfn"
                        href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state⑤">当前连续体状态</a>不为 null，
                    则将 <var>continuationState</var> 设为<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-clone" id="ref-for-list-clone">克隆</a> <var>event
                        loop</var> 的<a data-link-type="dfn" href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state⑥">当前连续体状态</a>的结果。</p>
            <li data-md>
                <p>将 <var>microtask</var> 的 <a class="idl-code" data-link-type="attribute"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps"
                        id="ref-for-concept-task-steps①">steps</a> 设为如下步骤：</p>
                <ol>
                    <li data-md>
                        <p>如果 <var>ignoreContinuationState</var> 为 false，则将 <var>eventLoop</var> 的<a
                                data-link-type="dfn" href="#event-loop-current-continuation-state"
                                id="ref-for-event-loop-current-continuation-state⑦">当前连续体状态</a>设为
                            <var>continuationState</var>。
                        </p>
                    <li data-md>
                        <p>运行 <var>steps</var>。</p>
                    <li data-md>
                        <p>如果 <var>ignoreContinuationState</var> 为 false，则将 <var>eventLoop</var> 的<a
                                data-link-type="dfn" href="#event-loop-current-continuation-state"
                                id="ref-for-event-loop-current-continuation-state⑧">当前连续体状态</a>设为 null。</p>
                </ol>
        </ol>
        <h4 class="heading settled" data-level="4.1.5" id="sec-patches-html-hostmakejobcallback"><span
                class="secno">4.1.5. </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback">HostMakeJobCallback(callable)</a></span><a
                class="self-link" href="#sec-patches-html-hostmakejobcallback"></a></h4>
        <p>在第 5 步之前添加如下内容：</p>
        <ol>
            <li data-md>
                <p>令 <var>event loop</var> 为 <var>incumbent settings<var> 的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm"
                                id="ref-for-environment-settings-object's-realm">realm</a> 的 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent"
                                id="ref-for-realm's-agent">agent</a> 的 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                                id="ref-for-concept-agent-event-loop⑤">事件循环</a>。</var></var></p>
            <li data-md>
                <p>令 <var>state</var> 为 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-clone"
                        id="ref-for-list-clone①">克隆</a> <var>event
                        loop</var> 的<a data-link-type="dfn" href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state⑨">当前连续体状态</a>的结果（如 <a data-link-type="dfn"
                        href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state①⓪">当前连续体状态</a>不为 null），否则为 null。</p>
        </ol>
        <p>将第 5 步修改为：</p>
        <ol>
            <li data-md>
                <p>返回 <span>JobCallback Record</span> { [[Callback]]: <var>callable</var>,
                    [[HostDefined]]: { [[IncumbentSettings]]: <var>incumbent settings</var>,
                    [[ActiveScriptContext]]: <var>script execution context</var>,
                    [[ContinuationState]]: <var>state</var> } }。</p>
        </ol>
        <h4 class="heading settled" data-level="4.1.6" id="sec-patches-html-hostcalljobcallback"><span
                class="secno">4.1.6. </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#hostcalljobcallback">HostCallJobCallback(callback,
                    V, argumentsList)</a></span><a class="self-link" href="#sec-patches-html-hostcalljobcallback"></a>
        </h4>
        <p>在第 5 步之前添加如下步骤：</p>
        <ol>
            <li data-md>
                <p>令 <var>event loop</var> 为 <var>incumbent settings<var> 的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm"
                                id="ref-for-environment-settings-object's-realm①">realm</a> 的 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent"
                                id="ref-for-realm's-agent①">agent</a> 的 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"
                                id="ref-for-concept-agent-event-loop⑥">事件循环</a>。</var></var></p>
            <li data-md>
                <p>将 <var>event loop</var> 的<a data-link-type="dfn" href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state①①">当前连续体状态</a>设为
                    <var>callback</var>.[[HostDefined]].[[ContinuationState]]。
                </p>
        </ol>
        <p>第 7 步后添加如下内容：</p>
        <ol>
            <li data-md>
                <p>将 <var>event loop</var> 的<a data-link-type="dfn" href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state①②">当前连续体状态</a>设为 null。</p>
        </ol>
        <h4 class="heading settled" data-level="4.1.7" id="sec-patches-html-hostenqueuepromisejob"><span
                class="secno">4.1.7. </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#hostenqueuepromisejob">HostEnqueuePromiseJob(job,
                    realm)</a></span><a class="self-link" href="#sec-patches-html-hostenqueuepromisejob"></a></h4>
        <p>将第 2 步修改为：</p>
        <ol>
            <li data-md>
                <p>排队一个微任务，<var>ignoreContinuationState</var> 设为 true，执行如下步骤：</p>
        </ol>
        <h3 class="heading settled" data-level="4.2" id="sec-patches-requestidlecallback"><span class="secno">4.2.
            </span><span class="content"><a
                    href="https://w3c.github.io/requestidlecallback/"><code>requestIdleCallback()</code></a></span><a
                class="self-link" href="#sec-patches-requestidlecallback"></a></h3>
        <h4 class="heading settled" data-level="4.2.1" id="sec-patches-invoke-idle-callbacks"><span class="secno">4.2.1.
            </span><span class="content"><a
                    href="https://w3c.github.io/requestidlecallback/#invoke-idle-callbacks-algorithm">调用 idle callback
                    算法</a></span><a class="self-link" href="#sec-patches-invoke-idle-callbacks"></a>
        </h4>
        <p>在第 3.3 步之前添加如下步骤：</p>
        <ol>
            <li data-md>
                <p>令 <var>realm</var> 为 <var>window</var> 的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"
                        id="ref-for-concept-relevant-realm">相关 realm</a>。</p>
            <li data-md>
                <p>令 <var>state</var> 为一个新的<a data-link-type="dfn" href="#scheduling-state"
                        id="ref-for-scheduling-state②">调度状态</a>。</p>
            <li data-md>
                <p>将 <var>state</var> 的<a data-link-type="dfn" href="#scheduling-state-priority-source"
                        id="ref-for-scheduling-state-priority-source⑥">优先级来源</a>设为<a data-link-type="dfn"
                        href="#create-a-fixed-priority-unabortable-task-signal"
                        id="ref-for-create-a-fixed-priority-unabortable-task-signal③">创建固定优先级不可中止任务信号</a>的返回值，传入 "<code
                        class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background⑤">background</a></code>"
                    和 <var>realm</var>。</p>
            <li data-md>
                <p>令 <var>scheduler</var> 为 <code
                        class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②⑥">Scheduler</a></code>，
                    其<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"
                        id="ref-for-concept-relevant-realm①">相关 realm</a>为 <var>realm</var>。</p>
            <li data-md>
                <p><a data-link-type="dfn" href="#set-the-current-scheduling-state"
                        id="ref-for-set-the-current-scheduling-state①">为 <var>scheduler</var> 设置当前调度状态</a>为
                    <var>state</var>。
                </p>
        </ol>
        <p>在第 3.3 步后添加：</p>
        <ol>
            <li data-md>
                <p>将 <var>event loop</var> 的<a data-link-type="dfn" href="#event-loop-current-continuation-state"
                        id="ref-for-event-loop-current-continuation-state①③">当前连续体状态</a>设为 null。</p>
        </ol>
        <h2 class="heading settled" data-level="5" id="sec-security"><span class="secno">5. </span><span
                class="content">安全性考虑</span><a class="self-link" href="#sec-security"></a></h2>
        <div class="non-normative">
            <em>本节为非规范内容。</em>
            <p>本规范定义的 API 的主要安全性考虑是是否可能通过基于时序的侧信道攻击泄露不同来源间的信息。</p>
        </div>
        <h3 class="heading settled" data-level="5.1" id="sec-security-high-res-timer"><span class="secno">5.1.
            </span><span class="content"><code>postTask</code> 作为高精度计时源</span><a class="self-link"
                href="#sec-security-high-res-timer"></a></h3>
        <div class="non-normative">该 API 不能作为高精度计时源使用。与 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" id="ref-for-dom-settimeout②">setTimeout()</a></code>
            的 timeout 值类似，<code
                class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑧">postTask()</a></code>
            的
            <code
                class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay③">delay</a></code>
            单位为毫秒（最小非零延迟为 1 ms），调用者无法指定精度高于 1 ms 的计时。此外，由于任务是在延迟到期后排队而非立即执行，实际可用精度会进一步降低。
        </div>
        <h3 class="heading settled" data-level="5.2" id="sec-security-monitoring-tasks"><span class="secno">5.2.
            </span><span class="content">监控其他来源的任务</span><a class="self-link" href="#sec-security-monitoring-tasks"></a>
        </h3>
        <div class="non-normative">
            第二个考虑是 <code
                class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑨">postTask()</a></code>
            或 <code
                class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield④">yield()</a></code>
            是否会泄露关于其它来源任务的信息。我们考虑攻击者运行在一个来源，试图获取调度在同一浏览器线程但属于另一个事件循环（且为不同来源）的代码信息。
            <p>由于 UA
                中一个线程一次只能运行一个事件循环的任务，攻击者可以通过监测自己任务的运行时机推断其他事件循环中的任务。例如，攻击者可以用大量任务填充系统并期望连贯地执行；如果中间出现较大间歇，则可以推断有另一个任务（可能来自其他事件循环）运行。此时泄露信息的多少取决于实现细节，实际实现可通过下述措施减少信息泄露。
            </p>
            <p><strong>可能获得哪些信息？</strong> <br> 具体来说，攻击者可以通过大量排队任务或递归排队任务检测浏览器何时执行了其它任务。这是一种<a
                    href="https://www.usenix.org/conference/usenixsecurity17/technical-sessions/presentation/vila">已知攻击</a>，可通过现有
                API（如 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options②">postMessage()</a></code>）实现。
                被插队的任务可能是其他事件循环的任务，也可能是攻击者自身事件循环的任务，包括 UA 内部任务（如垃圾回收）。</p>
            <p>假定攻击者能够高概率判断当前执行的任务属于另一个事件循环，那么接下来问题是还能获知哪些额外信息？因为跨事件循环任务的选择没有标准化，所以这些信息依赖于实现以及 UA
                如何排列不同事件循环的任务。但在一些实现中，若将共享线程的事件循环视为一个整体进行优先级调度，则可能泄漏更多信息。</p>
            <p>可以把 UA 可能选择而非攻击者自身任务的“潜在任务集合”看作可获得的信息。当攻击者向系统排队大量任务时，可能被调度的任务集合就是当时 UA
                认为更高优先级的所有任务。这可能是静态优先级（如输入恒为最高、网络次之等）的结果，也可能更动态，比如 UA 会偶尔调度其他已饿死的任务源。动态调度会扩大潜在任务集合，从而降低泄露信息的精确性。</p>
            <p><code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask①⓪">postTask()</a></code>
                和 <code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield⑤">yield()</a></code>
                支持给调度的任务和连续体分配优先级。这些任务和其他任务源如何交错也取决于实现。但攻击者可以通过利用优先级降低可能被“插队”的任务集合。例如，如果 UA 使用全局静态优先级调度，则使用 "<code
                    class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking⑦">user-blocking</a></code>"
                <code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask①①">postTask()</a></code>
                任务或
                "<code
                    class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible⑨">user-visible</a></code>"
                及更高优先级 <code
                    class="idl"><a data-link-type="idl" href="#dom-scheduler-yield" id="ref-for-dom-scheduler-yield⑥">yield()</a></code>
                连续体（这些连续体本应具有更高事件循环优先级），
                而不是 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options③">postMessage()</a></code>
                任务时，可能会减小此集合，具体视优先级及插队内容而定。
            </p>
            <p><strong>如何规避风险？</strong> <br> 实现者可以通过如下措施减少风险：</p>
            <ul>
                <li data-md>
                    <p>可能时，将跨源事件循环隔离到不同线程。此类攻击依赖于事件循环共享线程。</p>
                <li data-md>
                    <p>采用非仅优先级排序的事件循环调度策略。例如可以使用轮转（round-robin）或公平调度（fair-scheduling），以防止优先级信息泄露。也可以确保低优先级任务周期性获得调度，以避免推断优先级信息。
                    </p>
            </ul>
        </div>
        <h2 class="heading settled" data-level="6" id="sec-privacy"><span class="secno">6. </span><span
                class="content">隐私性注意事项</span><a class="self-link" href="#sec-privacy"></a></h2>
        <div class="non-normative">
            <p><em>本节为非规范内容。</em></p>
            <p>我们已从隐私角度评估本规范定义的 API，认为不存在隐私性问题。</p>
        </div>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档约定</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求通过描述性断言与RFC 2119术语结合表达。
            规范性部分中的关键字 “MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY” 和
            “OPTIONAL”
            应按照RFC 2119中的描述进行解释。
            但为提高可读性，
            本规范中这些词不会全部用大写字母出现。</p>
        <p>本规范的所有文本都是规范性的，
            除非明确标记为非规范性、示例和注释。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>本规范中的示例以“例如”引入，
            或使用 <code>class="example"</code> 与规范性文本区分开，
            如下所示：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个说明性示例。</p>
        </div>
        <p>说明性注释以“注”开头，
            并用 <code>class="note"</code> 与规范性文本区分，
            如下所示：</p>
        <p class="note" role="note">注，这是一个说明性注释。</p>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#scheduling-state-abort-source">abort source</a><span>, 见 § 2.3</span>
        <li><a href="#task-handle-abort-steps">abort steps</a><span>, 见 § 2.3</span>
        <li><a href="#tasksignal-add-a-priority-change-algorithm">add a priority change algorithm</a><span>, 见
                § 3.3</span>
        <li><a href="#dom-tasksignal-any">any(signals)</a><span>, 见 § 3.3</span>
        <li><a href="#dom-tasksignal-any">any(signals, init)</a><span>, 见 § 3.3</span>
        <li><a href="#dom-taskpriority-background">"background"</a><span>, 见 § 2.1</span>
        <li><a href="#dom-taskpriority-background">background</a><span>, 见 § 2.1</span>
        <li><a href="#dom-taskcontroller-taskcontroller">constructor()</a><span>, 见 § 3.2</span>
        <li><a href="#dom-taskcontroller-taskcontroller">constructor(init)</a><span>, 见 § 3.2</span>
        <li><a href="#dom-taskprioritychangeevent-taskprioritychangeevent">constructor(type,
                priorityChangeEventInitDict)</a><span>, 见 § 3.1</span>
        <li><a href="#continuation-state">continuation state</a><span>, 见 § 2.3</span>
        <li><a href="#create-a-dependent-task-signal">create a dependent task signal</a><span>, 见 § 3.3</span>
        <li><a href="#create-a-fixed-priority-unabortable-task-signal">create a fixed priority unabortable task
                signal</a><span>, 见 § 3.3</span>
        <li><a href="#create-a-scheduler-task-queue">create a scheduler task queue</a><span>, 见 § 2.4</span>
        <li><a href="#create-a-task-handle">create a task handle</a><span>, 见 § 2.4</span>
        <li><a href="#event-loop-current-continuation-state">current continuation state</a><span>, 见 § 4.1.2</span>
        <li><a href="#dom-schedulerposttaskoptions-delay">delay</a><span>, 见 § 2.2</span>
        <li><a href="#tasksignal-dependent">dependent</a><span>, 见 § 3.3</span>
        <li><a href="#tasksignal-dependent-signals">dependent signals</a><span>, 见 § 3.3</span>
        <li><a href="#scheduler-dynamic-priority-task-queue-map">dynamic priority task queue map</a><span>, 见
                § 2.2</span>
        <li><a href="#scheduler-task-queue-effective-priority">effective priority</a><span>, 见 § 2.4</span>
        <li><a href="#scheduler-task-queue-empty">empty</a><span>, 见 § 2.4.1</span>
        <li><a href="#scheduler-task-enqueue-order">enqueue order</a><span>, 见 § 2.3</span>
        <li><a href="#scheduler-task-queue-first-runnable-task">first runnable task</a><span>, 见 § 2.4</span>
        <li><a href="#get-the-continuation-state-value">get the continuation state value</a><span>, 见 § 4.1.2</span>
        <li><a href="#get-the-current-scheduling-state">get the current scheduling state</a><span>, 见 § 2.4.2</span>
        <li><a href="#get-the-runnable-task-queues">get the runnable task queues</a><span>, 见 § 2.4.3</span>
        <li><a href="#has-a-runnable-task">has a runnable task</a><span>, 见 § 2.4.3</span>
        <li><a href="#tasksignal-has-fixed-priority">has fixed priority</a><span>, 见 § 3.3</span>
        <li><a href="#has-a-runnable-task">have a runnable task</a><span>, 见 § 2.4.3</span>
        <li><a href="#tasksignal-has-fixed-priority">have fixed priority</a><span>, 见 § 3.3</span>
        <li><a href="#scheduler-task-queue-is-continuation">is continuation</a><span>, 见 § 2.3</span>
        <li><a href="#event-loop-next-enqueue-order">next enqueue order</a><span>, 见 § 4.1.2</span>
        <li><a href="#scheduler-task-older-than">older than</a><span>, 见 § 2.4</span>
        <li><a href="#dom-tasksignal-onprioritychange">onprioritychange</a><span>, 见 § 3.3</span>
        <li><a href="#posted-task-task-source">posted task task source</a><span>, 见 § 2.3</span>
        <li><a href="#dom-scheduler-posttask">postTask(callback)</a><span>, 见 § 2.2</span>
        <li><a href="#dom-scheduler-posttask">postTask(callback, options)</a><span>, 见 § 2.2</span>
        <li>
            previousPriority
            <ul>
                <li><a href="#dom-taskprioritychangeevent-previouspriority">TaskPriorityChangeEvent
                        的 attribute</a><span>, 见 § 3.1</span>
                <li><a href="#dom-taskprioritychangeeventinit-previouspriority">TaskPriorityChangeEventInit
                        的 dict-member</a><span>, 见 § 3.1</span>
            </ul>
        <li>
            priority
            <ul>
                <li><a href="#dom-tasksignal-priority">TaskSignal 的 attribute</a><span>, 见 § 3.3</span>
                <li><a href="#tasksignal-priority">TaskSignal 的 dfn</a><span>, 见 § 3.3</span>
                <li><a href="#scheduler-task-queue-priority">scheduler task queue 的 dfn</a><span>, 见 § 2.3</span>
                <li><a href="#dom-schedulerposttaskoptions-priority">SchedulerPostTaskOptions
                        的 dict-member</a><span>,
                        见 § 2.2</span>
                <li><a href="#dom-taskcontrollerinit-priority">TaskControllerInit
                        的 dict-member</a><span>, 见 § 3.2</span>
                <li><a href="#dom-tasksignalanyinit-priority">TaskSignalAnyInit
                        的 dict-member</a><span>, 见 § 3.3</span>
            </ul>
        <li><a href="#eventdef-tasksignal-prioritychange">prioritychange</a><span>, 见 § 3.3</span>
        <li><a href="#tasksignal-priority-change-algorithms">priority change algorithms</a><span>, 见 § 3.3</span>
        <li><a href="#tasksignal-priority-changing">priority changing</a><span>, 见 § 3.3</span>
        <li><a href="#scheduling-state-priority-source">priority source</a><span>, 见 § 2.3</span>
        <li><a href="#task-handle-queue">queue</a><span>, 见 § 2.3</span>
        <li><a href="#queue-a-scheduler-task">queue a scheduler task</a><span>, 见 § 2.4.1</span>
        <li><a href="#scheduler-task-queue-removal-steps">removal steps</a><span>, 见 § 2.3</span>
        <li><a href="#scheduler-task-queue-remove">remove</a><span>, 见 § 2.4.1</span>
        <li><a href="#schedule-a-posttask-task">schedule a postTask task</a><span>, 见 § 2.4.2</span>
        <li><a href="#schedule-a-task-to-invoke-an-algorithm">schedule a task to invoke an algorithm</a><span>, 见
                § 2.4.2</span>
        <li><a href="#schedule-a-yield-continuation">schedule a yield continuation</a><span>, 见 § 2.4.2</span>
        <li><a href="#scheduler">Scheduler</a><span>, 见 § 2.2</span>
        <li>
            scheduler
            <ul>
                <li><a href="#dom-windoworworkerglobalscope-scheduler">WindowOrWorkerGlobalScope 的 attribute</a><span>,
                        见 § 4.1.1</span>
                <li><a href="#windoworworkerglobalscope-scheduler">WindowOrWorkerGlobalScope 的 dfn</a><span>, 见
                        § 4.1.1</span>
            </ul>
        <li><a href="#callbackdef-schedulerposttaskcallback">SchedulerPostTaskCallback</a><span>, 见 § 2.2</span>
        <li><a href="#dictdef-schedulerposttaskoptions">SchedulerPostTaskOptions</a><span>, 见 § 2.2</span>
        <li><a href="#scheduler-task">scheduler task</a><span>, 见 § 2.3</span>
        <li><a href="#scheduler-task-queue">scheduler task queue</a><span>, 见 § 2.3</span>
        <li><a href="#scheduler-task-sources">scheduler task sources</a><span>, 见 § 2.3</span>
        <li><a href="#scheduling-state">scheduling state</a><span>, 见 § 2.3</span>
        <li><a href="#select-the-next-scheduler-task-queue-from-all-schedulers">select the next scheduler task queue
                from all schedulers</a><span>, 见 § 2.4.3</span>
        <li><a href="#select-the-scheduler-task-queue">select the scheduler task queue</a><span>, 见 § 2.4.2</span>
        <li><a href="#dom-taskcontroller-setpriority">setPriority(priority)</a><span>, 见 § 3.2</span>
        <li><a href="#set-the-continuation-state-value">set the continuation state value</a><span>, 见 § 4.1.2</span>
        <li><a href="#set-the-current-scheduling-state">set the current scheduling state</a><span>, 见 § 2.4.2</span>
        <li><a href="#dom-schedulerposttaskoptions-signal">signal</a><span>, 见 § 2.2</span>
        <li><a href="#tasksignal-signal-priority-change">signal priority change</a><span>, 见 § 3.3</span>
        <li><a href="#tasksignal-source-signal">source signal</a><span>, 见 § 3.3</span>
        <li><a href="#continuation-state-state-map">state map</a><span>, 见 § 2.3</span>
        <li><a href="#scheduler-static-priority-task-queue-map">static priority task queue map</a><span>, 见
                § 2.2</span>
        <li><a href="#task-handle-task">task</a><span>, 见 § 2.3</span>
        <li><a href="#task-handle-task-complete-steps">task complete steps</a><span>, 见 § 2.3</span>
        <li><a href="#taskcontroller">TaskController</a><span>, 见 § 3.2</span>
        <li><a href="#dom-taskcontroller-taskcontroller">TaskController()</a><span>, 见 § 3.2</span>
        <li><a href="#dom-taskcontroller-taskcontroller">TaskController(init)</a><span>, 见 § 3.2</span>
        <li><a href="#dictdef-taskcontrollerinit">TaskControllerInit</a><span>, 见 § 3.2</span>
        <li><a href="#task-handle">task handle</a><span>, 见 § 2.3</span>
        <li><a href="#enumdef-taskpriority">TaskPriority</a><span>, 见 § 2.1</span>
        <li><a href="#taskprioritychangeevent">TaskPriorityChangeEvent</a><span>, 见 § 3.1</span>
        <li><a href="#dictdef-taskprioritychangeeventinit">TaskPriorityChangeEventInit</a><span>, 见 § 3.1</span>
        <li><a href="#dom-taskprioritychangeevent-taskprioritychangeevent">TaskPriorityChangeEvent(type,
                priorityChangeEventInitDict)</a><span>, 见 § 3.1</span>
        <li><a href="#scheduler-task-queue-tasks">tasks</a><span>, 见 § 2.3</span>
        <li><a href="#tasksignal">TaskSignal</a><span>, 见 § 3.3</span>
        <li><a href="#dictdef-tasksignalanyinit">TaskSignalAnyInit</a><span>, 见 § 3.3</span>
        <li><a href="#dom-taskpriority-user-blocking">"user-blocking"</a><span>, 见 § 2.1</span>
        <li><a href="#dom-taskpriority-user-blocking">user-blocking</a><span>, 见 § 2.1</span>
        <li><a href="#dom-taskpriority-user-visible">"user-visible"</a><span>, 见 § 2.1</span>
        <li><a href="#dom-taskpriority-user-visible">user-visible</a><span>, 见 § 2.1</span>
        <li><a href="#dom-scheduler-yield">yield()</a><span>, 见 § 2.2</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="2e66eaf1">AbortController</span>
                <li><span class="dfn-paneled" id="cca3cdb2">AbortSignal</span>
                <li><span class="dfn-paneled" id="129bdae8">Event</span>
                <li><span class="dfn-paneled" id="44a7708c">EventInit</span>
                <li><span class="dfn-paneled" id="28e64574">abort reason</span>
                <li><span class="dfn-paneled" id="535dd335">aborted</span>
                <li><span class="dfn-paneled" id="87bc23a5">add</span>
                <li><span class="dfn-paneled" id="c4db4cb4">creating a dependent signal</span>
                <li><span class="dfn-paneled" id="a973e0fe">document</span>
                <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
                <li><span class="dfn-paneled" id="ff87eaf9">remove</span>
                <li><span class="dfn-paneled" id="0fe84b59">signal</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ECMASCRIPT]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="3aec4bbc">current realm</span>
                <li><span class="dfn-paneled" id="a5f015e3">realm</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
                <li><span class="dfn-paneled" id="02fb8691">MessageChannel</span>
                <li><span class="dfn-paneled" id="5d7209e9">Window</span>
                <li><span class="dfn-paneled" id="5f6d392d">WindowOrWorkerGlobalScope</span>
                <li><span class="dfn-paneled" id="3134c785">agent</span>
                <li><span class="dfn-paneled" id="cad18354">associated Document</span>
                <li><span class="dfn-paneled" id="00e097fa">document</span>
                <li><span class="dfn-paneled" id="6a5a59a0">event handler</span>
                <li><span class="dfn-paneled" id="9d386f55">event handler event type</span>
                <li><span class="dfn-paneled" id="03675365">event handler IDL attribute</span>
                <li><span class="dfn-paneled" id="c6d19e56">event loop</span>
                <li><span class="dfn-paneled" id="b78d6a64">event loop <small>(for agent)</small></span>
                <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
                <li><span class="dfn-paneled" id="8a7dfd23">postMessage(message, options)</span>
                <li><span class="dfn-paneled" id="d1ee46ce">realm</span>
                <li><span class="dfn-paneled" id="d8049b98">relevant agent</span>
                <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
                <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
                <li><span class="dfn-paneled" id="8596ac55">run steps after a timeout</span>
                <li><span class="dfn-paneled" id="140e18c2">runnable</span>
                <li><span class="dfn-paneled" id="9a2f4b9f">script evaluation environment settings object set</span>
                <li><span class="dfn-paneled" id="3332e595">setTimeout(handler, timeout, ...arguments)</span>
                <li><span class="dfn-paneled" id="fcc3f167">source</span>
                <li><span class="dfn-paneled" id="fae3c4de">steps</span>
                <li><span class="dfn-paneled" id="e270bd2a">task</span>
                <li><span class="dfn-paneled" id="80726755">task queues</span>
                <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
                <li><span class="dfn-paneled" id="28763c99">timer task source</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="a3b18719">append</span>
                <li><span class="dfn-paneled" id="36858240">boolean</span>
                <li><span class="dfn-paneled" id="027e3e49">clone</span>
                <li><span class="dfn-paneled" id="a326add7">contain</span>
                <li><span class="dfn-paneled" id="03afaf9c">empty</span>
                <li><span class="dfn-paneled" id="1243a891">exist</span>
                <li><span class="dfn-paneled" id="d8f8bd6e">extend</span>
                <li><span class="dfn-paneled" id="32dd7834">get the values</span>
                <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
                <li><span class="dfn-paneled" id="5afbefcd">item <small>(for list)</small></span>
                <li><span class="dfn-paneled" id="c88f3887">item <small>(for struct)</small></span>
                <li><span class="dfn-paneled" id="f02cd417">iterate</span>
                <li><span class="dfn-paneled" id="649608b9">list</span>
                <li><span class="dfn-paneled" id="3fca5a9e">map</span>
                <li><span class="dfn-paneled" id="99c988d6">remove <small>(for list)</small></span>
                <li><span class="dfn-paneled" id="7d4424b2">remove <small>(for map)</small></span>
                <li><span class="dfn-paneled" id="15e48c39">set</span>
                <li><span class="dfn-paneled" id="984221ca">struct</span>
            </ul>
        <li>
            <a data-link-type="biblio">[REQUESTIDLECALLBACK]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="145b2fc1">requestIdleCallback()</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了如下术语：
            <ul>
                <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
                <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
                <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="c807e273">NewObject</span>
                <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
                <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
                <li><span class="dfn-paneled" id="01d5a451">Replaceable</span>
                <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
                <li><span class="dfn-paneled" id="6c6b1005">any</span>
                <li><span class="dfn-paneled" id="a32c65d4">implements</span>
                <li><span class="dfn-paneled" id="10ce5f6f">invoke</span>
                <li><span class="dfn-paneled" id="b262501e">reject</span>
                <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
                <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
                <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
                <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
                <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard.
            URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-ecmascript">[ECMASCRIPT]
        <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a
                href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
            Living Standard. URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    Standard</cite></a>. Living Standard. URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living
            Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">说明性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-requestidlecallback">[REQUESTIDLECALLBACK]
        <dd>Scott Haseley. <a href="https://w3c.github.io/requestidlecallback/"><cite>requestIdleCallback()</cite></a>.
            URL: <a href="https://w3c.github.io/requestidlecallback/">https://w3c.github.io/requestidlecallback/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></a> {
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-blocking"><c- s>"user-blocking"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-visible"><c- s>"user-visible"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-background"><c- s>"background"</c-></a>
};

<c- b>dictionary</c-> <a href="#dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></a> {
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal" href="#dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></a>;
  <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-type="TaskPriority" href="#dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-default="0" data-type="unsigned long long" href="#dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></a> = 0;
};

<c- b>callback</c-> <a href="#callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#scheduler"><code><c- g>Scheduler</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <a href="#dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code></a>,
                        <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <a href="#dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code></a> = {});
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-yield"><c- g>yield</c-></a>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#taskprioritychangeevent"><code><c- g>TaskPriorityChangeEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
  <a href="#dom-taskprioritychangeevent-taskprioritychangeevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type"><code><c- g>type</c-></code></a>, <a data-link-type="idl-name" href="#dictdef-taskprioritychangeeventinit"><c- n>TaskPriorityChangeEventInit</c-></a> <a href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict"><code><c- g>priorityChangeEventInitDict</c-></code></a>);

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-taskprioritychangeevent-previouspriority"><c- g>previousPriority</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-taskprioritychangeeventinit"><code><c- g>TaskPriorityChangeEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-type="TaskPriority" href="#dom-taskprioritychangeeventinit-previouspriority"><code><c- g>previousPriority</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-taskcontrollerinit"><code><c- g>TaskControllerInit</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-default="&quot;user-visible&quot;" data-type="TaskPriority" href="#dom-taskcontrollerinit-priority"><code><c- g>priority</c-></code></a> = "user-visible";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#taskcontroller"><code><c- g>TaskController</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller"><c- n>AbortController</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-taskcontroller-taskcontroller"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-taskcontrollerinit"><c- n>TaskControllerInit</c-></a> <a href="#dom-taskcontroller-taskcontroller-init-init"><code><c- g>init</c-></code></a> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-taskcontroller-setpriority"><c- g>setPriority</c-></a>(<a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a href="#dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-tasksignalanyinit"><code><c- g>TaskSignalAnyInit</c-></code></a> {
  (<a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#tasksignal"><c- n>TaskSignal</c-></a>) <a data-default="&quot;user-visible&quot;" data-type="(TaskPriority or TaskSignal)" href="#dom-tasksignalanyinit-priority"><code><c- g>priority</c-></code></a> = "user-visible";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#tasksignal"><code><c- g>TaskSignal</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject"><c- g>NewObject</c-></a>] <c- b>static</c-> <a data-link-type="idl-name" href="#tasksignal"><c- n>TaskSignal</c-></a> <a class="idl-code" data-link-type="method" href="#dom-tasksignal-any"><c- g>_any</c-></a>(<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a>> <a href="#dom-tasksignal-any-signals-init-signals"><code><c- g>signals</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-tasksignalanyinit"><c- n>TaskSignalAnyInit</c-></a> <a href="#dom-tasksignal-any-signals-init-init"><code><c- g>init</c-></code></a> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-tasksignal-priority"><c- g>priority</c-></a>;

  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-tasksignal-onprioritychange"><c- g>onprioritychange</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Replaceable"><c- g>Replaceable</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 我们应考虑重构 HTML 规范，为 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a> 添加构造函数。
            一个问题是我们需要的新任务是 <a data-link-type="dfn" href="#scheduler-task">scheduler task</a>，而不是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>。<a
                class="issue-return" href="#issue-83467c82" title="Jump to section">↵</a></div>
        <div class="issue"> <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout">超时后运行步骤</a>
            不一定考虑了挂起；见 <a href="https://github.com/whatwg/html/issues/5925">whatwg/html#5925</a>。<a class="issue-return"
                href="#issue-cb2ce7e9" title="Jump to section">↵</a></div>
        <div class="issue"> 因为此算法可以从 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">并行</a> 步骤中被调用，
            此处及其它算法的部分内容存在竞态情况。特别是，<a data-link-type="dfn" href="#event-loop-next-enqueue-order">next
                enqueue order</a> 应该以原子方式更新，并且访问 <a data-link-type="dfn" href="#scheduler-task-queue">scheduler task
                queues</a>
            也应原子地进行。后者也影响事件循环任务队列（见 <a href="https://github.com/whatwg/html/issues/6475">该问题</a>）。<a
                class="issue-return" href="#issue-14b7599b" title="Jump to section">↵</a></div>
        <div class="issue"> 此步骤中的 <var>taskQueue</var> 要么是 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set">set</a> 的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">tasks</a>，要么是 <a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a> 的 <a data-link-type="dfn"
                href="#scheduler-task">scheduler tasks</a>。后续步骤仅 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list-remove">移除</a> 一个 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list-item">项</a>，所以它们是
            <em>大致</em> 兼容的。理想情况下，应该有一个通用的任务队列接口支持 <code>pop()</code> 方法，该方法能返回一个普通的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>，但这会涉及较多重构。<a
                class="issue-return" href="#issue-04c96c57" title="Jump to section">↵</a>
        </div>
    </div>
    <details class="mdn-anno unpositioned" data-anno-for="dom-scheduler-posttask">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Scheduler/postTask"
                    title="The postTask() method of the Scheduler interface is used for adding tasks to be scheduled according to their priority.">Scheduler/postTask</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="scheduler">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Scheduler"
                    title="The Scheduler interface of the Prioritized Task Scheduling API provides the Scheduler.postTask() method that can be used for adding prioritized tasks to be scheduled.">Scheduler</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-taskcontroller-taskcontroller">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskController/TaskController"
                    title="The TaskController() constructor creates a new TaskController object, optionally setting the initial priority of its associated signal.">TaskController/TaskController</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-taskcontroller-setpriority">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskController/setPriority"
                    title="The setPriority() method of the TaskController interface can be called to set a new priority for this controller&apos;s signal. If a prioritized task is configured to use the signal, this will also change the task priority.">TaskController/setPriority</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="sec-task-controller">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskController"
                    title="The TaskController interface of the Prioritized Task Scheduling API represents a controller object that can be used to both abort and change the priority of one or more prioritized tasks. If there is no need to change task priorities, then AbortController can be used instead.">TaskController</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-taskprioritychangeevent-taskprioritychangeevent">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskPriorityChangeEvent/TaskPriorityChangeEvent"
                    title="The TaskPriorityChangeEvent() constructor creates a new TaskPriorityChangeEvent object.">TaskPriorityChangeEvent/TaskPriorityChangeEvent</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-taskprioritychangeevent-previouspriority">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskPriorityChangeEvent/previousPriority"
                    title="The readonly previousPriority property of the TaskPriorityChangeEvent interface returns the priority of the corresponding TaskSignal before it was changed and this prioritychange event was emitted.">TaskPriorityChangeEvent/previousPriority</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="sec-task-priority-change-event">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskPriorityChangeEvent"
                    title="The TaskPriorityChangeEvent is the interface for the prioritychange event.">TaskPriorityChangeEvent</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-tasksignal-priority">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskSignal/priority"
                    title="The read-only priority property of the TaskSignal interface indicates the signal priority.">TaskSignal/priority</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-eventdef-tasksignal-prioritychange">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskSignal/prioritychange_event"
                    title="The prioritychange event is sent to a TaskSignal if its priority is changed.">TaskSignal/prioritychange_event</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-tasksignal-onprioritychange">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskSignal/prioritychange_event"
                    title="The prioritychange event is sent to a TaskSignal if its priority is changed.">TaskSignal/prioritychange_event</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="tasksignal">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskSignal"
                    title="The TaskSignal interface of the Prioritized Task Scheduling API represents a signal object that allows you to communicate with a prioritized task, and abort it or change the priority (if required) via a TaskController object.">TaskSignal</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-windoworworkerglobalscope-scheduler">
        <summary><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scheduler"
                    title="The global read-only scheduler property is the entry point for using the Prioritized Task Scheduling API.">Window/scheduler</a>
            </p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span
                        title="Requires setting a user preference or runtime flag.">🔰 101+</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "00e097fa": { "dfnID": "00e097fa", "dfnText": "document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task-document" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-document" },
                "01d5a451": { "dfnID": "01d5a451", "dfnText": "Replaceable", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Replaceable" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }], "url": "https://webidl.spec.whatwg.org/#Replaceable" },
                "027e3e49": { "dfnID": "027e3e49", "dfnText": "clone", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-clone" }], "title": "4.1.4. Event Loop: Queuing Tasks" }, { "refs": [{ "id": "ref-for-list-clone\u2460" }], "title": "4.1.5. HostMakeJobCallback(callable)" }], "url": "https://infra.spec.whatwg.org/#list-clone" },
                "02fb8691": { "dfnID": "02fb8691", "dfnText": "MessageChannel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-messagechannel" }], "title": "1. Introduction" }], "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel" },
                "03675365": { "dfnID": "03675365", "dfnText": "event handler IDL attribute", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handler-idl-attributes" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "03afaf9c": { "dfnID": "03afaf9c", "dfnText": "empty", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-empty" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-list-empty\u2460" }, { "id": "ref-for-list-empty\u2461" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-list-empty\u2462" }, { "id": "ref-for-list-empty\u2463" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://infra.spec.whatwg.org/#list-empty" },
                "0fe84b59": { "dfnID": "0fe84b59", "dfnText": "signal", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortcontroller-signal" }, { "id": "ref-for-abortcontroller-signal\u2460" }], "title": "3.2. The TaskController Interface" }], "url": "https://dom.spec.whatwg.org/#abortcontroller-signal" },
                "10ce5f6f": { "dfnID": "10ce5f6f", "dfnText": "invoke", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-invoke-a-callback-function" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://webidl.spec.whatwg.org/#invoke-a-callback-function" },
                "1243a891": { "dfnID": "1243a891", "dfnText": "exist", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-exists" }, { "id": "ref-for-map-exists\u2460" }, { "id": "ref-for-map-exists\u2461" }, { "id": "ref-for-map-exists\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-map-exists\u2463" }, { "id": "ref-for-map-exists\u2464" }], "title": "4.1.2. Event loop: definitions" }], "url": "https://infra.spec.whatwg.org/#map-exists" },
                "129bdae8": { "dfnID": "129bdae8", "dfnText": "Event", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }], "url": "https://dom.spec.whatwg.org/#event" },
                "140e18c2": { "dfnID": "140e18c2", "dfnText": "runnable", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task-runnable" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-concept-task-runnable\u2460" }, { "id": "ref-for-concept-task-runnable\u2461" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-concept-task-runnable\u2462" }, { "id": "ref-for-concept-task-runnable\u2463" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" },
                "145b2fc1": { "dfnID": "145b2fc1", "dfnText": "requestIdleCallback()", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-window-requestidlecallback" }, { "id": "ref-for-dom-window-requestidlecallback\u2460" }], "title": "1. Introduction" }], "url": "https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" },
                "15e48c39": { "dfnID": "15e48c39", "dfnText": "set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-set" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-ordered-set\u2460" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-ordered-set\u2461" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-ordered-set\u2462" }, { "id": "ref-for-ordered-set\u2463" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-ordered-set\u2464" }, { "id": "ref-for-ordered-set\u2465" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-ordered-set\u2466" }, { "id": "ref-for-ordered-set\u2467" }, { "id": "ref-for-ordered-set\u2468" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "28763c99": { "dfnID": "28763c99", "dfnText": "timer task source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-timer-task-source" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timer-task-source" },
                "28e64574": { "dfnID": "28e64574", "dfnText": "abort reason", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-abort-reason" }, { "id": "ref-for-abortsignal-abort-reason\u2460" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-abortsignal-abort-reason\u2461" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-abortsignal-abort-reason\u2462" }, { "id": "ref-for-abortsignal-abort-reason\u2463" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-abortsignal-abort-reason\u2464" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://dom.spec.whatwg.org/#abortsignal-abort-reason" },
                "2e66eaf1": { "dfnID": "2e66eaf1", "dfnText": "AbortController", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortcontroller" }, { "id": "ref-for-abortcontroller\u2460" }], "title": "3.2. The TaskController Interface" }], "url": "https://dom.spec.whatwg.org/#abortcontroller" },
                "3134c785": { "dfnID": "3134c785", "dfnText": "agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-realm's-agent" }], "title": "4.1.5. HostMakeJobCallback(callable)" }, { "refs": [{ "id": "ref-for-realm's-agent\u2460" }], "title": "4.1.6. HostCallJobCallback(callback, V, argumentsList)" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent" },
                "32dd7834": { "dfnID": "32dd7834", "dfnText": "get the values", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-getting-the-values" }, { "id": "ref-for-map-getting-the-values\u2460" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "https://infra.spec.whatwg.org/#map-getting-the-values" },
                "3332e595": { "dfnID": "3332e595", "dfnText": "setTimeout(handler, timeout, ...arguments)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-settimeout" }, { "id": "ref-for-dom-settimeout\u2460" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-settimeout\u2461" }], "title": "5.1. postTask as a High-Resolution Timing Source" }], "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" },
                "36858240": { "dfnID": "36858240", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-boolean" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://infra.spec.whatwg.org/#boolean" },
                "3aec4bbc": { "dfnID": "3aec4bbc", "dfnText": "current realm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-current-realm" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://tc39.es/ecma262/#current-realm" },
                "3b90bdcd": { "dfnID": "3b90bdcd", "dfnText": "resolve", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-resolve" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://webidl.spec.whatwg.org/#resolve" },
                "3fca5a9e": { "dfnID": "3fca5a9e", "dfnText": "map", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-map" }, { "id": "ref-for-ordered-map\u2460" }, { "id": "ref-for-ordered-map\u2461" }, { "id": "ref-for-ordered-map\u2462" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-ordered-map\u2463" }], "title": "2.3. Definitions" }], "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }, { "id": "ref-for-this\u2460" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-this\u2461" }, { "id": "ref-for-this\u2462" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-this\u2463" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-this\u2464" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "44a7708c": { "dfnID": "44a7708c", "dfnText": "EventInit", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-eventinit" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }], "url": "https://dom.spec.whatwg.org/#dictdef-eventinit" },
                "535dd335": { "dfnID": "535dd335", "dfnText": "aborted", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-aborted" }, { "id": "ref-for-abortsignal-aborted\u2460" }, { "id": "ref-for-abortsignal-aborted\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://dom.spec.whatwg.org/#abortsignal-aborted" },
                "5991ccfb": { "dfnID": "5991ccfb", "dfnText": "relevant realm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-realm" }, { "id": "ref-for-concept-relevant-realm\u2460" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" },
                "5afbefcd": { "dfnID": "5afbefcd", "dfnText": "item (for list)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-item" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-list-item\u2460" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://infra.spec.whatwg.org/#list-item" },
                "5d7209e9": { "dfnID": "5d7209e9", "dfnText": "Window", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-window" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "5f6d392d": { "dfnID": "5f6d392d", "dfnText": "WindowOrWorkerGlobalScope", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-windoworworkerglobalscope" }, { "id": "ref-for-windoworworkerglobalscope\u2460" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" },
                "5f90bbfb": { "dfnID": "5f90bbfb", "dfnText": "undefined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-undefined" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-idl-undefined\u2460" }], "title": "3.2. The TaskController Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "5fd23811": { "dfnID": "5fd23811", "dfnText": "fire an event", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-event-fire" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "649608b9": { "dfnID": "649608b9", "dfnText": "list", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://infra.spec.whatwg.org/#list" },
                "6a5a59a0": { "dfnID": "6a5a59a0", "dfnText": "event handler", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handlers" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" },
                "6c6b1005": { "dfnID": "6c6b1005", "dfnText": "any", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-any" }, { "id": "ref-for-idl-any\u2460" }], "title": "2.2. The Scheduler Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-any" },
                "7d4424b2": { "dfnID": "7d4424b2", "dfnText": "remove (for map)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-remove" }, { "id": "ref-for-map-remove\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://infra.spec.whatwg.org/#map-remove" },
                "80726755": { "dfnID": "80726755", "dfnText": "task queues", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-task-queue" }, { "id": "ref-for-task-queue\u2460" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-task-queue\u2461" }, { "id": "ref-for-task-queue\u2462" }, { "id": "ref-for-task-queue\u2463" }, { "id": "ref-for-task-queue\u2464" }, { "id": "ref-for-task-queue\u2465" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" },
                "8596ac55": { "dfnID": "8596ac55", "dfnText": "run steps after a timeout", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-run-steps-after-a-timeout" }, { "id": "ref-for-run-steps-after-a-timeout\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout" },
                "860300d4": { "dfnID": "860300d4", "dfnText": "implementation-defined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-implementation-defined" }, { "id": "ref-for-implementation-defined\u2460" }, { "id": "ref-for-implementation-defined\u2461" }, { "id": "ref-for-implementation-defined\u2462" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "87bc23a5": { "dfnID": "87bc23a5", "dfnText": "add", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-add" }, { "id": "ref-for-abortsignal-add\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://dom.spec.whatwg.org/#abortsignal-add" },
                "8855a9aa": { "dfnID": "8855a9aa", "dfnText": "DOMString", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMString" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMString" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-Exposed\u2460" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }, { "refs": [{ "id": "ref-for-Exposed\u2461" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-Exposed\u2462" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "8a7dfd23": { "dfnID": "8a7dfd23", "dfnText": "postMessage(message, options)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-window-postmessage-options" }, { "id": "ref-for-dom-window-postmessage-options\u2460" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-window-postmessage-options\u2461" }, { "id": "ref-for-dom-window-postmessage-options\u2462" }], "title": "5.2. Monitoring Another Origin\u2019s Tasks" }], "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" },
                "984221ca": { "dfnID": "984221ca", "dfnText": "struct", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-struct" }, { "id": "ref-for-struct\u2460" }, { "id": "ref-for-struct\u2461" }, { "id": "ref-for-struct\u2462" }], "title": "2.3. Definitions" }], "url": "https://infra.spec.whatwg.org/#struct" },
                "99c988d6": { "dfnID": "99c988d6", "dfnText": "remove (for list)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-remove" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-list-remove\u2460" }, { "id": "ref-for-list-remove\u2461" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-list-remove\u2462" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://infra.spec.whatwg.org/#list-remove" },
                "9a2f4b9f": { "dfnID": "9a2f4b9f", "dfnText": "script evaluation environment settings object set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-script-evaluation-environment-settings-object-set" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set" },
                "9cce47fd": { "dfnID": "9cce47fd", "dfnText": "sequence", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-sequence" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-sequence" },
                "9d386f55": { "dfnID": "9d386f55", "dfnText": "event handler event type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handler-event-type" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" },
                "a326add7": { "dfnID": "a326add7", "dfnText": "contain", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-exists" }, { "id": "ref-for-map-exists\u2460" }, { "id": "ref-for-map-exists\u2461" }, { "id": "ref-for-map-exists\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-map-exists\u2463" }, { "id": "ref-for-map-exists\u2464" }], "title": "4.1.2. Event loop: definitions" }], "url": "https://infra.spec.whatwg.org/#map-exists" },
                "a32c65d4": { "dfnID": "a32c65d4", "dfnText": "implements", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-implements" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://webidl.spec.whatwg.org/#implements" },
                "a3b18719": { "dfnID": "a3b18719", "dfnText": "append", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-set-append" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-set-append\u2460" }, { "id": "ref-for-set-append\u2461" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://infra.spec.whatwg.org/#set-append" },
                "a5f015e3": { "dfnID": "a5f015e3", "dfnText": "realm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-realm" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm" },
                "a72449dd": { "dfnID": "a72449dd", "dfnText": "in parallel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-in-parallel" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "a973e0fe": { "dfnID": "a973e0fe", "dfnText": "document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }], "url": "https://dom.spec.whatwg.org/#concept-document" },
                "b262501e": { "dfnID": "b262501e", "dfnText": "reject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reject" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-reject\u2460" }, { "id": "ref-for-reject\u2461" }, { "id": "ref-for-reject\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://webidl.spec.whatwg.org/#reject" },
                "b4cfa5ce": { "dfnID": "b4cfa5ce", "dfnText": "throw", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-throw" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#dfn-throw" },
                "b78d6a64": { "dfnID": "b78d6a64", "dfnText": "event loop (for agent)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-agent-event-loop" }, { "id": "ref-for-concept-agent-event-loop\u2460" }, { "id": "ref-for-concept-agent-event-loop\u2461" }, { "id": "ref-for-concept-agent-event-loop\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-concept-agent-event-loop\u2463" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-concept-agent-event-loop\u2464" }], "title": "4.1.5. HostMakeJobCallback(callable)" }, { "refs": [{ "id": "ref-for-concept-agent-event-loop\u2465" }], "title": "4.1.6. HostCallJobCallback(callback, V, argumentsList)" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" },
                "ba556545": { "dfnID": "ba556545", "dfnText": "NotAllowedError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-notallowederror" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "bdbd19d1": { "dfnID": "bdbd19d1", "dfnText": "Promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-promise" }, { "id": "ref-for-idl-promise\u2460" }], "title": "2.2. The Scheduler Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "c01cbda0": { "dfnID": "c01cbda0", "dfnText": "EnforceRange", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-EnforceRange" }], "title": "2.2. The Scheduler Interface" }], "url": "https://webidl.spec.whatwg.org/#EnforceRange" },
                "c3b2d08c": { "dfnID": "c3b2d08c", "dfnText": "task source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-task-source" }, { "id": "ref-for-task-source\u2460" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-task-source\u2461" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-task-source\u2462" }, { "id": "ref-for-task-source\u2463" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-task-source\u2464" }, { "id": "ref-for-task-source\u2465" }, { "id": "ref-for-task-source\u2466" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "c4db4cb4": { "dfnID": "c4db4cb4", "dfnText": "creating a dependent signal", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-create-a-dependent-abort-signal" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://dom.spec.whatwg.org/#create-a-dependent-abort-signal" },
                "c6d19e56": { "dfnID": "c6d19e56", "dfnText": "event loop", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-loop" }, { "id": "ref-for-event-loop\u2460" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-event-loop\u2461" }, { "id": "ref-for-event-loop\u2462" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-event-loop\u2463" }, { "id": "ref-for-event-loop\u2464" }, { "id": "ref-for-event-loop\u2465" }, { "id": "ref-for-event-loop\u2466" }, { "id": "ref-for-event-loop\u2467" }, { "id": "ref-for-event-loop\u2468" }, { "id": "ref-for-event-loop\u2460\u24ea" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-event-loop\u2460\u2460" }, { "id": "ref-for-event-loop\u2460\u2461" }, { "id": "ref-for-event-loop\u2460\u2462" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" },
                "c807e273": { "dfnID": "c807e273", "dfnText": "NewObject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-NewObject" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#NewObject" },
                "c88f3887": { "dfnID": "c88f3887", "dfnText": "item (for struct)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-struct-item" }, { "id": "ref-for-struct-item\u2460" }, { "id": "ref-for-struct-item\u2461" }, { "id": "ref-for-struct-item\u2462" }, { "id": "ref-for-struct-item\u2463" }], "title": "2.3. Definitions" }], "url": "https://infra.spec.whatwg.org/#struct-item" },
                "cad18354": { "dfnID": "cad18354", "dfnText": "associated Document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-window" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" },
                "callbackdef-schedulerposttaskcallback": { "dfnID": "callbackdef-schedulerposttaskcallback", "dfnText": "SchedulerPostTaskCallback", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-callbackdef-schedulerposttaskcallback" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-callbackdef-schedulerposttaskcallback\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#callbackdef-schedulerposttaskcallback" },
                "cca3cdb2": { "dfnID": "cca3cdb2", "dfnText": "AbortSignal", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal" }, { "id": "ref-for-abortsignal\u2460" }, { "id": "ref-for-abortsignal\u2461" }, { "id": "ref-for-abortsignal\u2462" }, { "id": "ref-for-abortsignal\u2463" }, { "id": "ref-for-abortsignal\u2464" }, { "id": "ref-for-abortsignal\u2465" }, { "id": "ref-for-abortsignal\u2466" }, { "id": "ref-for-abortsignal\u2467" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-abortsignal\u2468" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-abortsignal\u2460\u24ea" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-abortsignal\u2460\u2460" }, { "id": "ref-for-abortsignal\u2460\u2461" }, { "id": "ref-for-abortsignal\u2460\u2462" }, { "id": "ref-for-abortsignal\u2460\u2463" }, { "id": "ref-for-abortsignal\u2460\u2464" }, { "id": "ref-for-abortsignal\u2460\u2465" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://dom.spec.whatwg.org/#abortsignal" },
                "continuation-state": { "dfnID": "continuation-state", "dfnText": "continuation state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-continuation-state" }, { "id": "ref-for-continuation-state\u2460" }], "title": "4.1.2. Event loop: definitions" }], "url": "#continuation-state" },
                "continuation-state-state-map": { "dfnID": "continuation-state-state-map", "dfnText": "state map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-continuation-state-state-map" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-continuation-state-state-map\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-continuation-state-state-map\u2461" }, { "id": "ref-for-continuation-state-state-map\u2462" }, { "id": "ref-for-continuation-state-state-map\u2463" }, { "id": "ref-for-continuation-state-state-map\u2464" }], "title": "4.1.2. Event loop: definitions" }], "url": "#continuation-state-state-map" },
                "create-a-dependent-task-signal": { "dfnID": "create-a-dependent-task-signal", "dfnText": "create a dependent task signal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-dependent-task-signal" }, { "id": "ref-for-create-a-dependent-task-signal\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "#create-a-dependent-task-signal" },
                "create-a-fixed-priority-unabortable-task-signal": { "dfnID": "create-a-fixed-priority-unabortable-task-signal", "dfnText": "create a fixed priority unabortable task signal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-fixed-priority-unabortable-task-signal" }, { "id": "ref-for-create-a-fixed-priority-unabortable-task-signal\u2460" }, { "id": "ref-for-create-a-fixed-priority-unabortable-task-signal\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-create-a-fixed-priority-unabortable-task-signal\u2462" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#create-a-fixed-priority-unabortable-task-signal" },
                "create-a-scheduler-task-queue": { "dfnID": "create-a-scheduler-task-queue", "dfnText": "create a scheduler task queue", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-scheduler-task-queue" }, { "id": "ref-for-create-a-scheduler-task-queue\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#create-a-scheduler-task-queue" },
                "create-a-task-handle": { "dfnID": "create-a-task-handle", "dfnText": "create a task handle", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-create-a-task-handle" }, { "id": "ref-for-create-a-task-handle\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#create-a-task-handle" },
                "d1ee46ce": { "dfnID": "d1ee46ce", "dfnText": "realm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-environment-settings-object's-realm" }], "title": "4.1.5. HostMakeJobCallback(callable)" }, { "refs": [{ "id": "ref-for-environment-settings-object's-realm\u2460" }], "title": "4.1.6. HostCallJobCallback(callback, V, argumentsList)" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm" },
                "d8049b98": { "dfnID": "d8049b98", "dfnText": "relevant agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-relevant-agent" }, { "id": "ref-for-relevant-agent\u2460" }, { "id": "ref-for-relevant-agent\u2461" }, { "id": "ref-for-relevant-agent\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-relevant-agent\u2463" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent" },
                "d8f8bd6e": { "dfnID": "d8f8bd6e", "dfnText": "extend", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-extend" }, { "id": "ref-for-list-extend\u2460" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "https://infra.spec.whatwg.org/#list-extend" },
                "dacde8b5": { "dfnID": "dacde8b5", "dfnText": "a new promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-a-new-promise" }, { "id": "ref-for-a-new-promise\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "dca2de17": { "dfnID": "dca2de17", "dfnText": "DOMException", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMException" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "dictdef-schedulerposttaskoptions": { "dfnID": "dictdef-schedulerposttaskoptions", "dfnText": "SchedulerPostTaskOptions", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-schedulerposttaskoptions" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dictdef-schedulerposttaskoptions\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#dictdef-schedulerposttaskoptions" },
                "dictdef-taskcontrollerinit": { "dfnID": "dictdef-taskcontrollerinit", "dfnText": "TaskControllerInit", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-taskcontrollerinit" }], "title": "3.2. The TaskController Interface" }], "url": "#dictdef-taskcontrollerinit" },
                "dictdef-taskprioritychangeeventinit": { "dfnID": "dictdef-taskprioritychangeeventinit", "dfnText": "TaskPriorityChangeEventInit", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-taskprioritychangeeventinit" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }], "url": "#dictdef-taskprioritychangeeventinit" },
                "dictdef-tasksignalanyinit": { "dfnID": "dictdef-tasksignalanyinit", "dfnText": "TaskSignalAnyInit", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-tasksignalanyinit" }, { "id": "ref-for-dictdef-tasksignalanyinit\u2460" }, { "id": "ref-for-dictdef-tasksignalanyinit\u2461" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dictdef-tasksignalanyinit" },
                "dom-scheduler-posttask": { "dfnID": "dom-scheduler-posttask", "dfnText": "postTask(callback, options)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-scheduler-posttask" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2460" }, { "id": "ref-for-dom-scheduler-posttask\u2461" }, { "id": "ref-for-dom-scheduler-posttask\u2462" }, { "id": "ref-for-dom-scheduler-posttask\u2463" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2464" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2465" }], "title": "3. Controlling Tasks" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2466" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2467" }], "title": "5.1. postTask as a High-Resolution Timing Source" }, { "refs": [{ "id": "ref-for-dom-scheduler-posttask\u2468" }, { "id": "ref-for-dom-scheduler-posttask\u2460\u24ea" }, { "id": "ref-for-dom-scheduler-posttask\u2460\u2460" }], "title": "5.2. Monitoring Another Origin\u2019s Tasks" }], "url": "#dom-scheduler-posttask" },
                "dom-scheduler-posttask-callback-options-callback": { "dfnID": "dom-scheduler-posttask-callback-options-callback", "dfnText": "callback", "external": false, "refSections": [], "url": "#dom-scheduler-posttask-callback-options-callback" },
                "dom-scheduler-posttask-callback-options-options": { "dfnID": "dom-scheduler-posttask-callback-options-options", "dfnText": "options", "external": false, "refSections": [], "url": "#dom-scheduler-posttask-callback-options-options" },
                "dom-scheduler-yield": { "dfnID": "dom-scheduler-yield", "dfnText": "yield()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-scheduler-yield" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-dom-scheduler-yield\u2460" }, { "id": "ref-for-dom-scheduler-yield\u2461" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-scheduler-yield\u2462" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-dom-scheduler-yield\u2463" }, { "id": "ref-for-dom-scheduler-yield\u2464" }, { "id": "ref-for-dom-scheduler-yield\u2465" }], "title": "5.2. Monitoring Another Origin\u2019s Tasks" }], "url": "#dom-scheduler-yield" },
                "dom-schedulerposttaskoptions-delay": { "dfnID": "dom-schedulerposttaskoptions-delay", "dfnText": "delay", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-delay" }, { "id": "ref-for-dom-schedulerposttaskoptions-delay\u2460" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-delay\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-delay\u2462" }], "title": "5.1. postTask as a High-Resolution Timing Source" }], "url": "#dom-schedulerposttaskoptions-delay" },
                "dom-schedulerposttaskoptions-priority": { "dfnID": "dom-schedulerposttaskoptions-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-priority" }, { "id": "ref-for-dom-schedulerposttaskoptions-priority\u2460" }, { "id": "ref-for-dom-schedulerposttaskoptions-priority\u2461" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-priority\u2462" }, { "id": "ref-for-dom-schedulerposttaskoptions-priority\u2463" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#dom-schedulerposttaskoptions-priority" },
                "dom-schedulerposttaskoptions-signal": { "dfnID": "dom-schedulerposttaskoptions-signal", "dfnText": "signal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-signal" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2460" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2461" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2462" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2463" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2464" }, { "id": "ref-for-dom-schedulerposttaskoptions-signal\u2465" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-signal\u2466" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-dom-schedulerposttaskoptions-signal\u2467" }], "title": "3. Controlling Tasks" }], "url": "#dom-schedulerposttaskoptions-signal" },
                "dom-taskcontroller-setpriority": { "dfnID": "dom-taskcontroller-setpriority", "dfnText": "setPriority(priority)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskcontroller-setpriority" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-taskcontroller-setpriority\u2460" }, { "id": "ref-for-dom-taskcontroller-setpriority\u2461" }], "title": "3.2. The TaskController Interface" }], "url": "#dom-taskcontroller-setpriority" },
                "dom-taskcontroller-setpriority-priority-priority": { "dfnID": "dom-taskcontroller-setpriority-priority-priority", "dfnText": "priority", "external": false, "refSections": [], "url": "#dom-taskcontroller-setpriority-priority-priority" },
                "dom-taskcontroller-taskcontroller": { "dfnID": "dom-taskcontroller-taskcontroller", "dfnText": "new TaskController(init)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskcontroller-taskcontroller" }, { "id": "ref-for-dom-taskcontroller-taskcontroller\u2460" }], "title": "3.2. The TaskController Interface" }], "url": "#dom-taskcontroller-taskcontroller" },
                "dom-taskcontroller-taskcontroller-init-init": { "dfnID": "dom-taskcontroller-taskcontroller-init-init", "dfnText": "init", "external": false, "refSections": [], "url": "#dom-taskcontroller-taskcontroller-init-init" },
                "dom-taskcontrollerinit-priority": { "dfnID": "dom-taskcontrollerinit-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskcontrollerinit-priority" }, { "id": "ref-for-dom-taskcontrollerinit-priority\u2460" }], "title": "3.2. The TaskController Interface" }], "url": "#dom-taskcontrollerinit-priority" },
                "dom-taskpriority-background": { "dfnID": "dom-taskpriority-background", "dfnText": "background", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskpriority-background" }, { "id": "ref-for-dom-taskpriority-background\u2460" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-dom-taskpriority-background\u2461" }, { "id": "ref-for-dom-taskpriority-background\u2462" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-background\u2463" }], "title": "4.1.3. Event loop: processing model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-background\u2464" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#dom-taskpriority-background" },
                "dom-taskpriority-user-blocking": { "dfnID": "dom-taskpriority-user-blocking", "dfnText": "user-blocking", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskpriority-user-blocking" }, { "id": "ref-for-dom-taskpriority-user-blocking\u2460" }, { "id": "ref-for-dom-taskpriority-user-blocking\u2461" }, { "id": "ref-for-dom-taskpriority-user-blocking\u2462" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-blocking\u2463" }, { "id": "ref-for-dom-taskpriority-user-blocking\u2464" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-blocking\u2465" }], "title": "4.1.3. Event loop: processing model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-blocking\u2466" }], "title": "5.2. Monitoring Another Origin\u2019s Tasks" }], "url": "#dom-taskpriority-user-blocking" },
                "dom-taskpriority-user-visible": { "dfnID": "dom-taskpriority-user-visible", "dfnText": "user-visible", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskpriority-user-visible" }, { "id": "ref-for-dom-taskpriority-user-visible\u2460" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-visible\u2461" }, { "id": "ref-for-dom-taskpriority-user-visible\u2462" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-visible\u2463" }, { "id": "ref-for-dom-taskpriority-user-visible\u2464" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-visible\u2465" }, { "id": "ref-for-dom-taskpriority-user-visible\u2466" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-visible\u2467" }], "title": "4.1.3. Event loop: processing model" }, { "refs": [{ "id": "ref-for-dom-taskpriority-user-visible\u2468" }], "title": "5.2. Monitoring Another Origin\u2019s Tasks" }], "url": "#dom-taskpriority-user-visible" },
                "dom-taskprioritychangeevent-previouspriority": { "dfnID": "dom-taskprioritychangeevent-previouspriority", "dfnText": "previousPriority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-taskprioritychangeevent-previouspriority" }, { "id": "ref-for-dom-taskprioritychangeevent-previouspriority\u2460" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }, { "refs": [{ "id": "ref-for-dom-taskprioritychangeevent-previouspriority\u2461" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dom-taskprioritychangeevent-previouspriority" },
                "dom-taskprioritychangeevent-taskprioritychangeevent": { "dfnID": "dom-taskprioritychangeevent-taskprioritychangeevent", "dfnText": "constructor", "external": false, "refSections": [], "url": "#dom-taskprioritychangeevent-taskprioritychangeevent" },
                "dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict": { "dfnID": "dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict", "dfnText": "priorityChangeEventInitDict", "external": false, "refSections": [], "url": "#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict" },
                "dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type": { "dfnID": "dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type", "dfnText": "type", "external": false, "refSections": [], "url": "#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type" },
                "dom-taskprioritychangeeventinit-previouspriority": { "dfnID": "dom-taskprioritychangeeventinit-previouspriority", "dfnText": "previousPriority", "external": false, "refSections": [], "url": "#dom-taskprioritychangeeventinit-previouspriority" },
                "dom-tasksignal-any": { "dfnID": "dom-tasksignal-any", "dfnText": "any(signals, init)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-tasksignal-any" }, { "id": "ref-for-dom-tasksignal-any\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dom-tasksignal-any" },
                "dom-tasksignal-any-signals-init-init": { "dfnID": "dom-tasksignal-any-signals-init-init", "dfnText": "init", "external": false, "refSections": [], "url": "#dom-tasksignal-any-signals-init-init" },
                "dom-tasksignal-any-signals-init-signals": { "dfnID": "dom-tasksignal-any-signals-init-signals", "dfnText": "signals", "external": false, "refSections": [], "url": "#dom-tasksignal-any-signals-init-signals" },
                "dom-tasksignal-onprioritychange": { "dfnID": "dom-tasksignal-onprioritychange", "dfnText": "onprioritychange", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-tasksignal-onprioritychange" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dom-tasksignal-onprioritychange" },
                "dom-tasksignal-priority": { "dfnID": "dom-tasksignal-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-tasksignal-priority" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-dom-tasksignal-priority\u2460" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-dom-tasksignal-priority\u2461" }, { "id": "ref-for-dom-tasksignal-priority\u2462" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dom-tasksignal-priority" },
                "dom-tasksignalanyinit-priority": { "dfnID": "dom-tasksignalanyinit-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-tasksignalanyinit-priority" }, { "id": "ref-for-dom-tasksignalanyinit-priority\u2460" }, { "id": "ref-for-dom-tasksignalanyinit-priority\u2461" }, { "id": "ref-for-dom-tasksignalanyinit-priority\u2462" }, { "id": "ref-for-dom-tasksignalanyinit-priority\u2463" }], "title": "3.3. The TaskSignal Interface" }], "url": "#dom-tasksignalanyinit-priority" },
                "dom-windoworworkerglobalscope-scheduler": { "dfnID": "dom-windoworworkerglobalscope-scheduler", "dfnText": "scheduler", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-windoworworkerglobalscope-scheduler" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }], "url": "#dom-windoworworkerglobalscope-scheduler" },
                "e270bd2a": { "dfnID": "e270bd2a", "dfnText": "task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task" }, { "id": "ref-for-concept-task\u2460" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-concept-task\u2461" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-concept-task\u2462" }, { "id": "ref-for-concept-task\u2463" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-concept-task\u2464" }, { "id": "ref-for-concept-task\u2465" }, { "id": "ref-for-concept-task\u2466" }, { "id": "ref-for-concept-task\u2467" }], "title": "4.1.3. Event loop: processing model" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "e99bd18e": { "dfnID": "e99bd18e", "dfnText": "relevant global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-global" }, { "id": "ref-for-concept-relevant-global\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "enumdef-taskpriority": { "dfnID": "enumdef-taskpriority", "dfnText": "TaskPriority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-enumdef-taskpriority" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2460" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2461" }, { "id": "ref-for-enumdef-taskpriority\u2462" }, { "id": "ref-for-enumdef-taskpriority\u2463" }, { "id": "ref-for-enumdef-taskpriority\u2464" }, { "id": "ref-for-enumdef-taskpriority\u2465" }, { "id": "ref-for-enumdef-taskpriority\u2466" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2467" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2468" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2460\u24ea" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2460" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2461" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2462" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2460\u2463" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2464" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2460\u2465" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2466" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2467" }, { "id": "ref-for-enumdef-taskpriority\u2460\u2468" }, { "id": "ref-for-enumdef-taskpriority\u2461\u24ea" }, { "id": "ref-for-enumdef-taskpriority\u2461\u2460" }, { "id": "ref-for-enumdef-taskpriority\u2461\u2461" }, { "id": "ref-for-enumdef-taskpriority\u2461\u2462" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2461\u2463" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-enumdef-taskpriority\u2461\u2464" }], "title": "4.1.3. Event loop: processing model" }], "url": "#enumdef-taskpriority" },
                "event-loop-current-continuation-state": { "dfnID": "event-loop-current-continuation-state", "dfnText": "current continuation state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-event-loop-current-continuation-state" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-event-loop-current-continuation-state\u2460" }, { "id": "ref-for-event-loop-current-continuation-state\u2461" }, { "id": "ref-for-event-loop-current-continuation-state\u2462" }, { "id": "ref-for-event-loop-current-continuation-state\u2463" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-event-loop-current-continuation-state\u2464" }, { "id": "ref-for-event-loop-current-continuation-state\u2465" }, { "id": "ref-for-event-loop-current-continuation-state\u2466" }, { "id": "ref-for-event-loop-current-continuation-state\u2467" }], "title": "4.1.4. Event Loop: Queuing Tasks" }, { "refs": [{ "id": "ref-for-event-loop-current-continuation-state\u2468" }, { "id": "ref-for-event-loop-current-continuation-state\u2460\u24ea" }], "title": "4.1.5. HostMakeJobCallback(callable)" }, { "refs": [{ "id": "ref-for-event-loop-current-continuation-state\u2460\u2460" }, { "id": "ref-for-event-loop-current-continuation-state\u2460\u2461" }], "title": "4.1.6. HostCallJobCallback(callback, V, argumentsList)" }, { "refs": [{ "id": "ref-for-event-loop-current-continuation-state\u2460\u2462" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#event-loop-current-continuation-state" },
                "event-loop-next-enqueue-order": { "dfnID": "event-loop-next-enqueue-order", "dfnText": "next enqueue order", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-event-loop-next-enqueue-order" }, { "id": "ref-for-event-loop-next-enqueue-order\u2460" }, { "id": "ref-for-event-loop-next-enqueue-order\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-event-loop-next-enqueue-order\u2462" }], "title": "4.1.2. Event loop: definitions" }], "url": "#event-loop-next-enqueue-order" },
                "eventdef-tasksignal-prioritychange": { "dfnID": "eventdef-tasksignal-prioritychange", "dfnText": "prioritychange", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-eventdef-tasksignal-prioritychange" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-eventdef-tasksignal-prioritychange\u2460" }], "title": "3.3.1. Garbage Collection" }], "url": "#eventdef-tasksignal-prioritychange" },
                "f02cd417": { "dfnID": "f02cd417", "dfnText": "iterate", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-iterate" }, { "id": "ref-for-list-iterate\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "f0951476": { "dfnID": "f0951476", "dfnText": "EventHandler", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eventhandler" }], "title": "3.3. The TaskSignal Interface" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "f14b47b8": { "dfnID": "f14b47b8", "dfnText": "unsigned long long", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-unsigned-long-long" }], "title": "2.2. The Scheduler Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "fae3c4de": { "dfnID": "fae3c4de", "dfnText": "steps", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task-steps" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-concept-task-steps\u2460" }], "title": "4.1.4. Event Loop: Queuing Tasks" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps" },
                "fcc3f167": { "dfnID": "fcc3f167", "dfnText": "source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task-source" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-source" },
                "ff87eaf9": { "dfnID": "ff87eaf9", "dfnText": "remove", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-remove" }], "title": "2.4. Processing Model" }], "url": "https://dom.spec.whatwg.org/#abortsignal-remove" },
                "get-the-continuation-state-value": { "dfnID": "get-the-continuation-state-value", "dfnText": "get the continuation state value", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-get-the-continuation-state-value" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#get-the-continuation-state-value" },
                "get-the-current-scheduling-state": { "dfnID": "get-the-current-scheduling-state", "dfnText": "get the current scheduling state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-get-the-current-scheduling-state" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#get-the-current-scheduling-state" },
                "get-the-runnable-task-queues": { "dfnID": "get-the-runnable-task-queues", "dfnText": "get the runnable task queues", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-get-the-runnable-task-queues" }, { "id": "ref-for-get-the-runnable-task-queues\u2460" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#get-the-runnable-task-queues" },
                "has-a-runnable-task": { "dfnID": "has-a-runnable-task", "dfnText": "has a runnable\n  task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-has-a-runnable-task" }, { "id": "ref-for-has-a-runnable-task\u2460" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#has-a-runnable-task" },
                "posted-task-task-source": { "dfnID": "posted-task-task-source", "dfnText": "posted task task source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-posted-task-task-source" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#posted-task-task-source" },
                "queue-a-scheduler-task": { "dfnID": "queue-a-scheduler-task", "dfnText": "queue a scheduler task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-scheduler-task" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#queue-a-scheduler-task" },
                "schedule-a-posttask-task": { "dfnID": "schedule-a-posttask-task", "dfnText": "schedule a postTask task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-schedule-a-posttask-task" }], "title": "2.2. The Scheduler Interface" }], "url": "#schedule-a-posttask-task" },
                "schedule-a-task-to-invoke-an-algorithm": { "dfnID": "schedule-a-task-to-invoke-an-algorithm", "dfnText": "schedule a task to invoke an algorithm", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-schedule-a-task-to-invoke-an-algorithm" }, { "id": "ref-for-schedule-a-task-to-invoke-an-algorithm\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#schedule-a-task-to-invoke-an-algorithm" },
                "schedule-a-yield-continuation": { "dfnID": "schedule-a-yield-continuation", "dfnText": "schedule a yield continuation", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-schedule-a-yield-continuation" }], "title": "2.2. The Scheduler Interface" }], "url": "#schedule-a-yield-continuation" },
                "scheduler": { "dfnID": "scheduler", "dfnText": "Scheduler", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-scheduler\u2460" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-scheduler\u2461" }, { "id": "ref-for-scheduler\u2462" }, { "id": "ref-for-scheduler\u2463" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-scheduler\u2464" }, { "id": "ref-for-scheduler\u2465" }, { "id": "ref-for-scheduler\u2466" }, { "id": "ref-for-scheduler\u2467" }, { "id": "ref-for-scheduler\u2468" }, { "id": "ref-for-scheduler\u2460\u24ea" }, { "id": "ref-for-scheduler\u2460\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduler\u2460\u2461" }, { "id": "ref-for-scheduler\u2460\u2462" }, { "id": "ref-for-scheduler\u2460\u2463" }, { "id": "ref-for-scheduler\u2460\u2464" }, { "id": "ref-for-scheduler\u2460\u2465" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-scheduler\u2460\u2466" }], "title": "3. Controlling Tasks" }, { "refs": [{ "id": "ref-for-scheduler\u2460\u2467" }, { "id": "ref-for-scheduler\u2460\u2468" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }, { "refs": [{ "id": "ref-for-scheduler\u2461\u24ea" }], "title": "4.1.2. Event loop: definitions" }, { "refs": [{ "id": "ref-for-scheduler\u2461\u2460" }, { "id": "ref-for-scheduler\u2461\u2461" }, { "id": "ref-for-scheduler\u2461\u2462" }, { "id": "ref-for-scheduler\u2461\u2463" }, { "id": "ref-for-scheduler\u2461\u2464" }], "title": "4.1.3. Event loop: processing model" }, { "refs": [{ "id": "ref-for-scheduler\u2461\u2465" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#scheduler" },
                "scheduler-dynamic-priority-task-queue-map": { "dfnID": "scheduler-dynamic-priority-task-queue-map", "dfnText": "dynamic priority task queue map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-dynamic-priority-task-queue-map" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-scheduler-dynamic-priority-task-queue-map\u2460" }, { "id": "ref-for-scheduler-dynamic-priority-task-queue-map\u2461" }, { "id": "ref-for-scheduler-dynamic-priority-task-queue-map\u2462" }, { "id": "ref-for-scheduler-dynamic-priority-task-queue-map\u2463" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduler-dynamic-priority-task-queue-map\u2464" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#scheduler-dynamic-priority-task-queue-map" },
                "scheduler-static-priority-task-queue-map": { "dfnID": "scheduler-static-priority-task-queue-map", "dfnText": "static priority task queue map", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-static-priority-task-queue-map" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-scheduler-static-priority-task-queue-map\u2460" }, { "id": "ref-for-scheduler-static-priority-task-queue-map\u2461" }, { "id": "ref-for-scheduler-static-priority-task-queue-map\u2462" }, { "id": "ref-for-scheduler-static-priority-task-queue-map\u2463" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduler-static-priority-task-queue-map\u2464" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#scheduler-static-priority-task-queue-map" },
                "scheduler-task": { "dfnID": "scheduler-task", "dfnText": "scheduler task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task" }, { "id": "ref-for-scheduler-task\u2460" }, { "id": "ref-for-scheduler-task\u2461" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-scheduler-task\u2462" }, { "id": "ref-for-scheduler-task\u2463" }, { "id": "ref-for-scheduler-task\u2464" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-scheduler-task\u2465" }, { "id": "ref-for-scheduler-task\u2466" }, { "id": "ref-for-scheduler-task\u2467" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-scheduler-task\u2468" }, { "id": "ref-for-scheduler-task\u2460\u24ea" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-scheduler-task\u2460\u2460" }], "title": "4.1.3. Event loop: processing model" }], "url": "#scheduler-task" },
                "scheduler-task-enqueue-order": { "dfnID": "scheduler-task-enqueue-order", "dfnText": "enqueue order", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-enqueue-order" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-scheduler-task-enqueue-order\u2460" }, { "id": "ref-for-scheduler-task-enqueue-order\u2461" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-scheduler-task-enqueue-order\u2462" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-scheduler-task-enqueue-order\u2463" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#scheduler-task-enqueue-order" },
                "scheduler-task-older-than": { "dfnID": "scheduler-task-older-than", "dfnText": "older than", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-older-than" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#scheduler-task-older-than" },
                "scheduler-task-queue": { "dfnID": "scheduler-task-queue", "dfnText": "scheduler task queue", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue" }, { "id": "ref-for-scheduler-task-queue\u2460" }, { "id": "ref-for-scheduler-task-queue\u2461" }, { "id": "ref-for-scheduler-task-queue\u2462" }, { "id": "ref-for-scheduler-task-queue\u2463" }, { "id": "ref-for-scheduler-task-queue\u2464" }, { "id": "ref-for-scheduler-task-queue\u2465" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2466" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2467" }, { "id": "ref-for-scheduler-task-queue\u2468" }, { "id": "ref-for-scheduler-task-queue\u2460\u24ea" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2460\u2460" }, { "id": "ref-for-scheduler-task-queue\u2460\u2461" }, { "id": "ref-for-scheduler-task-queue\u2460\u2462" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2460\u2463" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2460\u2464" }, { "id": "ref-for-scheduler-task-queue\u2460\u2465" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-scheduler-task-queue\u2460\u2466" }], "title": "4.1.2. Event loop: definitions" }], "url": "#scheduler-task-queue" },
                "scheduler-task-queue-effective-priority": { "dfnID": "scheduler-task-queue-effective-priority", "dfnText": "effective priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-effective-priority" }], "title": "2.1. Task and Continuation Priorities" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-effective-priority\u2460" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-effective-priority\u2461" }, { "id": "ref-for-scheduler-task-queue-effective-priority\u2462" }, { "id": "ref-for-scheduler-task-queue-effective-priority\u2463" }], "title": "4.1.3. Event loop: processing model" }], "url": "#scheduler-task-queue-effective-priority" },
                "scheduler-task-queue-empty": { "dfnID": "scheduler-task-queue-empty", "dfnText": "empty", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-empty" }, { "id": "ref-for-scheduler-task-queue-empty\u2460" }], "title": "2.4. Processing Model" }], "url": "#scheduler-task-queue-empty" },
                "scheduler-task-queue-first-runnable-task": { "dfnID": "scheduler-task-queue-first-runnable-task", "dfnText": "first runnable task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-first-runnable-task" }], "title": "2.4.3. Selecting the Next Task to Run" }], "url": "#scheduler-task-queue-first-runnable-task" },
                "scheduler-task-queue-is-continuation": { "dfnID": "scheduler-task-queue-is-continuation", "dfnText": "is continuation", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-is-continuation" }, { "id": "ref-for-scheduler-task-queue-is-continuation\u2460" }], "title": "2.4. Processing Model" }], "url": "#scheduler-task-queue-is-continuation" },
                "scheduler-task-queue-priority": { "dfnID": "scheduler-task-queue-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-priority" }, { "id": "ref-for-scheduler-task-queue-priority\u2460" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-priority\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#scheduler-task-queue-priority" },
                "scheduler-task-queue-removal-steps": { "dfnID": "scheduler-task-queue-removal-steps", "dfnText": "removal steps", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-removal-steps" }, { "id": "ref-for-scheduler-task-queue-removal-steps\u2460" }, { "id": "ref-for-scheduler-task-queue-removal-steps\u2461" }], "title": "2.4. Processing Model" }], "url": "#scheduler-task-queue-removal-steps" },
                "scheduler-task-queue-remove": { "dfnID": "scheduler-task-queue-remove", "dfnText": "remove", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-remove" }], "title": "2.4. Processing Model" }], "url": "#scheduler-task-queue-remove" },
                "scheduler-task-queue-tasks": { "dfnID": "scheduler-task-queue-tasks", "dfnText": "tasks", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-queue-tasks" }, { "id": "ref-for-scheduler-task-queue-tasks\u2460" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-tasks\u2461" }, { "id": "ref-for-scheduler-task-queue-tasks\u2462" }, { "id": "ref-for-scheduler-task-queue-tasks\u2463" }], "title": "2.4.1. Queueing and Removing Scheduler Tasks" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-tasks\u2464" }], "title": "2.4.3. Selecting the Next Task to Run" }, { "refs": [{ "id": "ref-for-scheduler-task-queue-tasks\u2465" }], "title": "4.1.3. Event loop: processing model" }], "url": "#scheduler-task-queue-tasks" },
                "scheduler-task-sources": { "dfnID": "scheduler-task-sources", "dfnText": "scheduler task sources", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduler-task-sources" }], "title": "4.1.2. Event loop: definitions" }], "url": "#scheduler-task-sources" },
                "scheduling-state": { "dfnID": "scheduling-state", "dfnText": "scheduling state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduling-state" }, { "id": "ref-for-scheduling-state\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduling-state\u2461" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#scheduling-state" },
                "scheduling-state-abort-source": { "dfnID": "scheduling-state-abort-source", "dfnText": "abort source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduling-state-abort-source" }, { "id": "ref-for-scheduling-state-abort-source\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#scheduling-state-abort-source" },
                "scheduling-state-priority-source": { "dfnID": "scheduling-state-priority-source", "dfnText": "priority source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-scheduling-state-priority-source" }, { "id": "ref-for-scheduling-state-priority-source\u2460" }, { "id": "ref-for-scheduling-state-priority-source\u2461" }, { "id": "ref-for-scheduling-state-priority-source\u2462" }, { "id": "ref-for-scheduling-state-priority-source\u2463" }, { "id": "ref-for-scheduling-state-priority-source\u2464" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-scheduling-state-priority-source\u2465" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#scheduling-state-priority-source" },
                "select-the-next-scheduler-task-queue-from-all-schedulers": { "dfnID": "select-the-next-scheduler-task-queue-from-all-schedulers", "dfnText": "select the next scheduler task queue from all schedulers", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-select-the-next-scheduler-task-queue-from-all-schedulers" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-select-the-next-scheduler-task-queue-from-all-schedulers\u2460" }], "title": "4.1.3. Event loop: processing model" }], "url": "#select-the-next-scheduler-task-queue-from-all-schedulers" },
                "select-the-scheduler-task-queue": { "dfnID": "select-the-scheduler-task-queue", "dfnText": "select the scheduler task queue", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-select-the-scheduler-task-queue" }, { "id": "ref-for-select-the-scheduler-task-queue\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#select-the-scheduler-task-queue" },
                "set-the-continuation-state-value": { "dfnID": "set-the-continuation-state-value", "dfnText": "set the continuation state value", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-set-the-continuation-state-value" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#set-the-continuation-state-value" },
                "set-the-current-scheduling-state": { "dfnID": "set-the-current-scheduling-state", "dfnText": "set the current scheduling state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-set-the-current-scheduling-state" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-set-the-current-scheduling-state\u2460" }], "title": "4.2.1. Invoke idle callbacks algorithm" }], "url": "#set-the-current-scheduling-state" },
                "task-handle": { "dfnID": "task-handle", "dfnText": "task handle", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-handle" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-task-handle\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#task-handle" },
                "task-handle-abort-steps": { "dfnID": "task-handle-abort-steps", "dfnText": "abort steps", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-handle-abort-steps" }, { "id": "ref-for-task-handle-abort-steps\u2460" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-task-handle-abort-steps\u2461" }, { "id": "ref-for-task-handle-abort-steps\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#task-handle-abort-steps" },
                "task-handle-queue": { "dfnID": "task-handle-queue", "dfnText": "queue", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-handle-queue" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-task-handle-queue\u2460" }, { "id": "ref-for-task-handle-queue\u2461" }, { "id": "ref-for-task-handle-queue\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#task-handle-queue" },
                "task-handle-task": { "dfnID": "task-handle-task", "dfnText": "task", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-handle-task" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-task-handle-task\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#task-handle-task" },
                "task-handle-task-complete-steps": { "dfnID": "task-handle-task-complete-steps", "dfnText": "task complete steps", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-task-handle-task-complete-steps" }], "title": "2.4. Processing Model" }, { "refs": [{ "id": "ref-for-task-handle-task-complete-steps\u2460" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#task-handle-task-complete-steps" },
                "taskcontroller": { "dfnID": "taskcontroller", "dfnText": "TaskController", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-taskcontroller" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-taskcontroller\u2460" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-taskcontroller\u2461" }, { "id": "ref-for-taskcontroller\u2462" }], "title": "3. Controlling Tasks" }, { "refs": [{ "id": "ref-for-taskcontroller\u2463" }, { "id": "ref-for-taskcontroller\u2464" }], "title": "3.2. The TaskController Interface" }], "url": "#taskcontroller" },
                "taskprioritychangeevent": { "dfnID": "taskprioritychangeevent", "dfnText": "TaskPriorityChangeEvent", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-taskprioritychangeevent" }], "title": "3.3. The TaskSignal Interface" }], "url": "#taskprioritychangeevent" },
                "tasksignal": { "dfnID": "tasksignal", "dfnText": "TaskSignal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-tasksignal\u2460" }, { "id": "ref-for-tasksignal\u2461" }, { "id": "ref-for-tasksignal\u2462" }, { "id": "ref-for-tasksignal\u2463" }, { "id": "ref-for-tasksignal\u2464" }, { "id": "ref-for-tasksignal\u2465" }, { "id": "ref-for-tasksignal\u2466" }, { "id": "ref-for-tasksignal\u2467" }, { "id": "ref-for-tasksignal\u2468" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u24ea" }], "title": "2.3. Definitions" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u2460" }, { "id": "ref-for-tasksignal\u2460\u2461" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u2462" }], "title": "3. Controlling Tasks" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u2463" }], "title": "3.1. The TaskPriorityChangeEvent Interface" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u2464" }, { "id": "ref-for-tasksignal\u2460\u2465" }, { "id": "ref-for-tasksignal\u2460\u2466" }, { "id": "ref-for-tasksignal\u2460\u2467" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-tasksignal\u2460\u2468" }, { "id": "ref-for-tasksignal\u2461\u24ea" }, { "id": "ref-for-tasksignal\u2461\u2460" }, { "id": "ref-for-tasksignal\u2461\u2461" }, { "id": "ref-for-tasksignal\u2461\u2462" }, { "id": "ref-for-tasksignal\u2461\u2463" }, { "id": "ref-for-tasksignal\u2461\u2464" }, { "id": "ref-for-tasksignal\u2461\u2465" }, { "id": "ref-for-tasksignal\u2461\u2466" }, { "id": "ref-for-tasksignal\u2461\u2467" }, { "id": "ref-for-tasksignal\u2461\u2468" }, { "id": "ref-for-tasksignal\u2462\u24ea" }, { "id": "ref-for-tasksignal\u2462\u2460" }, { "id": "ref-for-tasksignal\u2462\u2461" }, { "id": "ref-for-tasksignal\u2462\u2462" }, { "id": "ref-for-tasksignal\u2462\u2463" }, { "id": "ref-for-tasksignal\u2462\u2464" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-tasksignal\u2462\u2465" }], "title": "3.3.1. Garbage Collection" }], "url": "#tasksignal" },
                "tasksignal-add-a-priority-change-algorithm": { "dfnID": "tasksignal-add-a-priority-change-algorithm", "dfnText": "add a priority change algorithm", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-add-a-priority-change-algorithm" }], "title": "2.4.2. Scheduling Tasks and Continuations" }], "url": "#tasksignal-add-a-priority-change-algorithm" },
                "tasksignal-dependent": { "dfnID": "tasksignal-dependent", "dfnText": "dependent", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-dependent" }, { "id": "ref-for-tasksignal-dependent\u2460" }, { "id": "ref-for-tasksignal-dependent\u2461" }, { "id": "ref-for-tasksignal-dependent\u2462" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-tasksignal-dependent\u2463" }], "title": "3.3.1. Garbage Collection" }], "url": "#tasksignal-dependent" },
                "tasksignal-dependent-signals": { "dfnID": "tasksignal-dependent-signals", "dfnText": "dependent signals", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-dependent-signals" }, { "id": "ref-for-tasksignal-dependent-signals\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "#tasksignal-dependent-signals" },
                "tasksignal-has-fixed-priority": { "dfnID": "tasksignal-has-fixed-priority", "dfnText": "has fixed priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-has-fixed-priority" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-tasksignal-has-fixed-priority\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "#tasksignal-has-fixed-priority" },
                "tasksignal-priority": { "dfnID": "tasksignal-priority", "dfnText": "priority", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-priority" }, { "id": "ref-for-tasksignal-priority\u2460" }], "title": "2.2. The Scheduler Interface" }, { "refs": [{ "id": "ref-for-tasksignal-priority\u2461" }, { "id": "ref-for-tasksignal-priority\u2462" }], "title": "2.4.2. Scheduling Tasks and Continuations" }, { "refs": [{ "id": "ref-for-tasksignal-priority\u2463" }, { "id": "ref-for-tasksignal-priority\u2464" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-tasksignal-priority\u2465" }, { "id": "ref-for-tasksignal-priority\u2466" }, { "id": "ref-for-tasksignal-priority\u2467" }, { "id": "ref-for-tasksignal-priority\u2468" }, { "id": "ref-for-tasksignal-priority\u2460\u24ea" }, { "id": "ref-for-tasksignal-priority\u2460\u2460" }, { "id": "ref-for-tasksignal-priority\u2460\u2461" }, { "id": "ref-for-tasksignal-priority\u2460\u2462" }, { "id": "ref-for-tasksignal-priority\u2460\u2463" }, { "id": "ref-for-tasksignal-priority\u2460\u2464" }, { "id": "ref-for-tasksignal-priority\u2460\u2465" }], "title": "3.3. The TaskSignal Interface" }], "url": "#tasksignal-priority" },
                "tasksignal-priority-change-algorithms": { "dfnID": "tasksignal-priority-change-algorithms", "dfnText": "priority change algorithms", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-priority-change-algorithms" }, { "id": "ref-for-tasksignal-priority-change-algorithms\u2460" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-tasksignal-priority-change-algorithms\u2461" }], "title": "3.3.1. Garbage Collection" }], "url": "#tasksignal-priority-change-algorithms" },
                "tasksignal-priority-changing": { "dfnID": "tasksignal-priority-changing", "dfnText": "priority changing", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-priority-changing" }, { "id": "ref-for-tasksignal-priority-changing\u2460" }, { "id": "ref-for-tasksignal-priority-changing\u2461" }, { "id": "ref-for-tasksignal-priority-changing\u2462" }], "title": "3.3. The TaskSignal Interface" }], "url": "#tasksignal-priority-changing" },
                "tasksignal-signal-priority-change": { "dfnID": "tasksignal-signal-priority-change", "dfnText": "signal priority change", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-signal-priority-change" }], "title": "3.2. The TaskController Interface" }, { "refs": [{ "id": "ref-for-tasksignal-signal-priority-change\u2460" }], "title": "3.3. The TaskSignal Interface" }], "url": "#tasksignal-signal-priority-change" },
                "tasksignal-source-signal": { "dfnID": "tasksignal-source-signal", "dfnText": "source signal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-tasksignal-source-signal" }, { "id": "ref-for-tasksignal-source-signal\u2460" }, { "id": "ref-for-tasksignal-source-signal\u2461" }], "title": "3.3. The TaskSignal Interface" }, { "refs": [{ "id": "ref-for-tasksignal-source-signal\u2462" }], "title": "3.3.1. Garbage Collection" }], "url": "#tasksignal-source-signal" },
                "windoworworkerglobalscope-scheduler": { "dfnID": "windoworworkerglobalscope-scheduler", "dfnText": "scheduler", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-windoworworkerglobalscope-scheduler" }], "title": "4.1.1. WindowOrWorkerGlobalScope" }], "url": "#windoworworkerglobalscope-scheduler" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-position-annos */
        "use strict";
        {
            function repositionAnnoPanels() {
                const panels = [...document.querySelectorAll("[data-anno-for]")];
                hydratePanels(panels);
                let vSoFar = 0;
                for (const panel of panels.sort(cmpTops)) {
                    if (panel.top < vSoFar) {
                        panel.top = vSoFar;
                        panel.style.top = vSoFar + "px";
                    }
                    vSoFar = panel.top + panel.height + 15;
                }
            }
            function hydratePanels(panels) {
                const main = document.querySelector("main");
                let mainRect;
                if (main) mainRect = main.getBoundingClientRect();
                // First display them all, if they're not already visible.
                for (const panel of panels) {
                    panel.classList.remove("unpositioned");
                }
                // Measure them all
                for (const panel of panels) {
                    const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
                    if (!dfn) {
                        console.log("Can't find the annotation panel target:", panel);
                        continue;
                    }
                    panel.dfn = dfn;
                    panel.top = window.scrollY + dfn.getBoundingClientRect().top;
                    let panelRect = panel.getBoundingClientRect();
                    panel.height = panelRect.height;
                    if (main) {
                        panel.overlappingMain = panelRect.left < mainRect.right;
                    } else {
                        panel.overlappingMain = false;
                    }
                }
                // And finally position them
                for (const panel of panels) {
                    const dfn = panel.dfn;
                    if (!dfn) continue;
                    panel.style.top = panel.top + "px";
                    panel.classList.toggle("overlapping-main", panel.overlappingMain);
                }
            }

            function cmpTops(a, b) {
                return a.top - b.top;
            }

            window.addEventListener("load", repositionAnnoPanels);
            window.addEventListener("resize", repositionAnnoPanels);
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#callbackdef-schedulerposttaskcallback": { "displayText": "SchedulerPostTaskCallback", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "SchedulerPostTaskCallback", "type": "callback", "url": "#callbackdef-schedulerposttaskcallback" },
                "#continuation-state": { "displayText": "continuation state", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "continuation state", "type": "dfn", "url": "#continuation-state" },
                "#continuation-state-state-map": { "displayText": "state map", "export": true, "for_": ["continuation state"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "state map", "type": "dfn", "url": "#continuation-state-state-map" },
                "#create-a-dependent-task-signal": { "displayText": "create a dependent task signal", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "create a dependent task signal", "type": "dfn", "url": "#create-a-dependent-task-signal" },
                "#create-a-fixed-priority-unabortable-task-signal": { "displayText": "create a fixed priority unabortable task signal", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "create a fixed priority unabortable task signal", "type": "dfn", "url": "#create-a-fixed-priority-unabortable-task-signal" },
                "#create-a-scheduler-task-queue": { "displayText": "create a scheduler task queue", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "create a scheduler task queue", "type": "dfn", "url": "#create-a-scheduler-task-queue" },
                "#create-a-task-handle": { "displayText": "create a task handle", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "create a task handle", "type": "dfn", "url": "#create-a-task-handle" },
                "#dictdef-schedulerposttaskoptions": { "displayText": "SchedulerPostTaskOptions", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "SchedulerPostTaskOptions", "type": "dictionary", "url": "#dictdef-schedulerposttaskoptions" },
                "#dictdef-taskcontrollerinit": { "displayText": "TaskControllerInit", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskControllerInit", "type": "dictionary", "url": "#dictdef-taskcontrollerinit" },
                "#dictdef-taskprioritychangeeventinit": { "displayText": "TaskPriorityChangeEventInit", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskPriorityChangeEventInit", "type": "dictionary", "url": "#dictdef-taskprioritychangeeventinit" },
                "#dictdef-tasksignalanyinit": { "displayText": "TaskSignalAnyInit", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskSignalAnyInit", "type": "dictionary", "url": "#dictdef-tasksignalanyinit" },
                "#dom-scheduler-posttask": { "displayText": "postTask(callback)", "export": true, "for_": ["Scheduler"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "postTask(callback)", "type": "method", "url": "#dom-scheduler-posttask" },
                "#dom-scheduler-yield": { "displayText": "yield()", "export": true, "for_": ["Scheduler"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "yield()", "type": "method", "url": "#dom-scheduler-yield" },
                "#dom-schedulerposttaskoptions-delay": { "displayText": "delay", "export": true, "for_": ["SchedulerPostTaskOptions"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "delay", "type": "dict-member", "url": "#dom-schedulerposttaskoptions-delay" },
                "#dom-schedulerposttaskoptions-priority": { "displayText": "priority", "export": true, "for_": ["SchedulerPostTaskOptions"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "dict-member", "url": "#dom-schedulerposttaskoptions-priority" },
                "#dom-schedulerposttaskoptions-signal": { "displayText": "signal", "export": true, "for_": ["SchedulerPostTaskOptions"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "signal", "type": "dict-member", "url": "#dom-schedulerposttaskoptions-signal" },
                "#dom-taskcontroller-setpriority": { "displayText": "setPriority(priority)", "export": true, "for_": ["TaskController"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "setPriority(priority)", "type": "method", "url": "#dom-taskcontroller-setpriority" },
                "#dom-taskcontroller-taskcontroller": { "displayText": "TaskController()", "export": true, "for_": ["TaskController"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskController()", "type": "constructor", "url": "#dom-taskcontroller-taskcontroller" },
                "#dom-taskcontrollerinit-priority": { "displayText": "priority", "export": true, "for_": ["TaskControllerInit"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "dict-member", "url": "#dom-taskcontrollerinit-priority" },
                "#dom-taskpriority-background": { "displayText": "\"background\"", "export": true, "for_": ["TaskPriority"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "\"background\"", "type": "enum-value", "url": "#dom-taskpriority-background" },
                "#dom-taskpriority-user-blocking": { "displayText": "\"user-blocking\"", "export": true, "for_": ["TaskPriority"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "\"user-blocking\"", "type": "enum-value", "url": "#dom-taskpriority-user-blocking" },
                "#dom-taskpriority-user-visible": { "displayText": "\"user-visible\"", "export": true, "for_": ["TaskPriority"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "\"user-visible\"", "type": "enum-value", "url": "#dom-taskpriority-user-visible" },
                "#dom-taskprioritychangeevent-previouspriority": { "displayText": "previousPriority", "export": true, "for_": ["TaskPriorityChangeEvent"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "previousPriority", "type": "attribute", "url": "#dom-taskprioritychangeevent-previouspriority" },
                "#dom-tasksignal-any": { "displayText": "any(signals, init)", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "any(signals, init)", "type": "method", "url": "#dom-tasksignal-any" },
                "#dom-tasksignal-onprioritychange": { "displayText": "onprioritychange", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "onprioritychange", "type": "attribute", "url": "#dom-tasksignal-onprioritychange" },
                "#dom-tasksignal-priority": { "displayText": "priority", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "attribute", "url": "#dom-tasksignal-priority" },
                "#dom-tasksignalanyinit-priority": { "displayText": "priority", "export": true, "for_": ["TaskSignalAnyInit"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "dict-member", "url": "#dom-tasksignalanyinit-priority" },
                "#dom-windoworworkerglobalscope-scheduler": { "displayText": "scheduler", "export": true, "for_": ["WindowOrWorkerGlobalScope"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduler", "type": "attribute", "url": "#dom-windoworworkerglobalscope-scheduler" },
                "#enumdef-taskpriority": { "displayText": "TaskPriority", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskPriority", "type": "enum", "url": "#enumdef-taskpriority" },
                "#event-loop-current-continuation-state": { "displayText": "current continuation state", "export": true, "for_": ["event loop"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "current continuation state", "type": "dfn", "url": "#event-loop-current-continuation-state" },
                "#event-loop-next-enqueue-order": { "displayText": "next enqueue order", "export": true, "for_": ["event loop"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "next enqueue order", "type": "dfn", "url": "#event-loop-next-enqueue-order" },
                "#eventdef-tasksignal-prioritychange": { "displayText": "prioritychange", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "prioritychange", "type": "event", "url": "#eventdef-tasksignal-prioritychange" },
                "#get-the-continuation-state-value": { "displayText": "get the continuation state value", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "get the continuation state value", "type": "dfn", "url": "#get-the-continuation-state-value" },
                "#get-the-current-scheduling-state": { "displayText": "get the current scheduling state", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "get the current scheduling state", "type": "dfn", "url": "#get-the-current-scheduling-state" },
                "#get-the-runnable-task-queues": { "displayText": "get the runnable task queues", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "get the runnable task queues", "type": "dfn", "url": "#get-the-runnable-task-queues" },
                "#has-a-runnable-task": { "displayText": "has a runnable task", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "has a runnable task", "type": "dfn", "url": "#has-a-runnable-task" },
                "#posted-task-task-source": { "displayText": "posted task task source", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "posted task task source", "type": "dfn", "url": "#posted-task-task-source" },
                "#queue-a-scheduler-task": { "displayText": "queue a scheduler task", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "queue a scheduler task", "type": "dfn", "url": "#queue-a-scheduler-task" },
                "#schedule-a-posttask-task": { "displayText": "schedule a posttask task", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "schedule a posttask task", "type": "dfn", "url": "#schedule-a-posttask-task" },
                "#schedule-a-task-to-invoke-an-algorithm": { "displayText": "schedule a task to invoke an algorithm", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "schedule a task to invoke an algorithm", "type": "dfn", "url": "#schedule-a-task-to-invoke-an-algorithm" },
                "#schedule-a-yield-continuation": { "displayText": "schedule a yield continuation", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "schedule a yield continuation", "type": "dfn", "url": "#schedule-a-yield-continuation" },
                "#scheduler": { "displayText": "Scheduler", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "Scheduler", "type": "interface", "url": "#scheduler" },
                "#scheduler-dynamic-priority-task-queue-map": { "displayText": "dynamic priority task queue map", "export": true, "for_": ["Scheduler"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "dynamic priority task queue map", "type": "dfn", "url": "#scheduler-dynamic-priority-task-queue-map" },
                "#scheduler-static-priority-task-queue-map": { "displayText": "static priority task queue map", "export": true, "for_": ["Scheduler"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "static priority task queue map", "type": "dfn", "url": "#scheduler-static-priority-task-queue-map" },
                "#scheduler-task": { "displayText": "scheduler task", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduler task", "type": "dfn", "url": "#scheduler-task" },
                "#scheduler-task-enqueue-order": { "displayText": "enqueue order", "export": true, "for_": ["scheduler task"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "enqueue order", "type": "dfn", "url": "#scheduler-task-enqueue-order" },
                "#scheduler-task-older-than": { "displayText": "older than", "export": true, "for_": ["scheduler task"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "older than", "type": "dfn", "url": "#scheduler-task-older-than" },
                "#scheduler-task-queue": { "displayText": "scheduler task queue", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduler task queue", "type": "dfn", "url": "#scheduler-task-queue" },
                "#scheduler-task-queue-effective-priority": { "displayText": "effective priority", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "effective priority", "type": "dfn", "url": "#scheduler-task-queue-effective-priority" },
                "#scheduler-task-queue-empty": { "displayText": "empty", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "empty", "type": "dfn", "url": "#scheduler-task-queue-empty" },
                "#scheduler-task-queue-first-runnable-task": { "displayText": "first runnable task", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "first runnable task", "type": "dfn", "url": "#scheduler-task-queue-first-runnable-task" },
                "#scheduler-task-queue-is-continuation": { "displayText": "is continuation", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "is continuation", "type": "dfn", "url": "#scheduler-task-queue-is-continuation" },
                "#scheduler-task-queue-priority": { "displayText": "priority", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "dfn", "url": "#scheduler-task-queue-priority" },
                "#scheduler-task-queue-removal-steps": { "displayText": "removal steps", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "removal steps", "type": "dfn", "url": "#scheduler-task-queue-removal-steps" },
                "#scheduler-task-queue-remove": { "displayText": "remove", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "remove", "type": "dfn", "url": "#scheduler-task-queue-remove" },
                "#scheduler-task-queue-tasks": { "displayText": "tasks", "export": true, "for_": ["scheduler task queue"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "tasks", "type": "dfn", "url": "#scheduler-task-queue-tasks" },
                "#scheduler-task-sources": { "displayText": "scheduler task sources", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduler task sources", "type": "dfn", "url": "#scheduler-task-sources" },
                "#scheduling-state": { "displayText": "scheduling state", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduling state", "type": "dfn", "url": "#scheduling-state" },
                "#scheduling-state-abort-source": { "displayText": "abort source", "export": true, "for_": ["scheduling state"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "abort source", "type": "dfn", "url": "#scheduling-state-abort-source" },
                "#scheduling-state-priority-source": { "displayText": "priority source", "export": true, "for_": ["scheduling state"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority source", "type": "dfn", "url": "#scheduling-state-priority-source" },
                "#select-the-next-scheduler-task-queue-from-all-schedulers": { "displayText": "select the next scheduler task queue from all schedulers", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "select the next scheduler task queue from all schedulers", "type": "dfn", "url": "#select-the-next-scheduler-task-queue-from-all-schedulers" },
                "#select-the-scheduler-task-queue": { "displayText": "select the scheduler task queue", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "select the scheduler task queue", "type": "dfn", "url": "#select-the-scheduler-task-queue" },
                "#set-the-continuation-state-value": { "displayText": "set the continuation state value", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "set the continuation state value", "type": "dfn", "url": "#set-the-continuation-state-value" },
                "#set-the-current-scheduling-state": { "displayText": "set the current scheduling state", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "set the current scheduling state", "type": "dfn", "url": "#set-the-current-scheduling-state" },
                "#task-handle": { "displayText": "task handle", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "task handle", "type": "dfn", "url": "#task-handle" },
                "#task-handle-abort-steps": { "displayText": "abort steps", "export": true, "for_": ["task handle"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "abort steps", "type": "dfn", "url": "#task-handle-abort-steps" },
                "#task-handle-queue": { "displayText": "queue", "export": true, "for_": ["task handle"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "queue", "type": "dfn", "url": "#task-handle-queue" },
                "#task-handle-task": { "displayText": "task", "export": true, "for_": ["task handle"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "task", "type": "dfn", "url": "#task-handle-task" },
                "#task-handle-task-complete-steps": { "displayText": "task complete steps", "export": true, "for_": ["task handle"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "task complete steps", "type": "dfn", "url": "#task-handle-task-complete-steps" },
                "#taskcontroller": { "displayText": "TaskController", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskController", "type": "interface", "url": "#taskcontroller" },
                "#taskprioritychangeevent": { "displayText": "TaskPriorityChangeEvent", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskPriorityChangeEvent", "type": "interface", "url": "#taskprioritychangeevent" },
                "#tasksignal": { "displayText": "TaskSignal", "export": true, "for_": [], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "TaskSignal", "type": "interface", "url": "#tasksignal" },
                "#tasksignal-add-a-priority-change-algorithm": { "displayText": "add a priority change algorithm", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "add a priority change algorithm", "type": "dfn", "url": "#tasksignal-add-a-priority-change-algorithm" },
                "#tasksignal-dependent": { "displayText": "dependent", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "dependent", "type": "dfn", "url": "#tasksignal-dependent" },
                "#tasksignal-dependent-signals": { "displayText": "dependent signals", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "dependent signals", "type": "dfn", "url": "#tasksignal-dependent-signals" },
                "#tasksignal-has-fixed-priority": { "displayText": "have fixed priority", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "have fixed priority", "type": "dfn", "url": "#tasksignal-has-fixed-priority" },
                "#tasksignal-priority": { "displayText": "priority", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority", "type": "dfn", "url": "#tasksignal-priority" },
                "#tasksignal-priority-change-algorithms": { "displayText": "priority change algorithms", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority change algorithms", "type": "dfn", "url": "#tasksignal-priority-change-algorithms" },
                "#tasksignal-priority-changing": { "displayText": "priority changing", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "priority changing", "type": "dfn", "url": "#tasksignal-priority-changing" },
                "#tasksignal-signal-priority-change": { "displayText": "signal priority change", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "signal priority change", "type": "dfn", "url": "#tasksignal-signal-priority-change" },
                "#tasksignal-source-signal": { "displayText": "source signal", "export": true, "for_": ["TaskSignal"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "source signal", "type": "dfn", "url": "#tasksignal-source-signal" },
                "#windoworworkerglobalscope-scheduler": { "displayText": "scheduler", "export": true, "for_": ["WindowOrWorkerGlobalScope"], "level": "", "normative": true, "shortname": "scheduling-apis", "spec": "scheduling-apis", "status": "local", "text": "scheduler", "type": "dfn", "url": "#windoworworkerglobalscope-scheduler" },
                "https://dom.spec.whatwg.org/#abortcontroller": { "displayText": "AbortController", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "AbortController", "type": "interface", "url": "https://dom.spec.whatwg.org/#abortcontroller" },
                "https://dom.spec.whatwg.org/#abortcontroller-signal": { "displayText": "signal", "export": true, "for_": ["AbortController"], "level": "", "normative": true, "shortname": "dom", "spec": "dom", "status": "anchor-block", "text": "signal", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortcontroller-signal" },
                "https://dom.spec.whatwg.org/#abortsignal": { "displayText": "AbortSignal", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "AbortSignal", "type": "interface", "url": "https://dom.spec.whatwg.org/#abortsignal" },
                "https://dom.spec.whatwg.org/#abortsignal-abort-reason": { "displayText": "abort reason", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "abort reason", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-abort-reason" },
                "https://dom.spec.whatwg.org/#abortsignal-aborted": { "displayText": "aborted", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "aborted", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-aborted" },
                "https://dom.spec.whatwg.org/#abortsignal-add": { "displayText": "add", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "add", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-add" },
                "https://dom.spec.whatwg.org/#abortsignal-remove": { "displayText": "remove", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "remove", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-remove" },
                "https://dom.spec.whatwg.org/#concept-document": { "displayText": "document", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "document", "type": "dfn", "url": "https://dom.spec.whatwg.org/#concept-document" },
                "https://dom.spec.whatwg.org/#concept-event-fire": { "displayText": "fire an event", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "fire an event", "type": "dfn", "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "https://dom.spec.whatwg.org/#create-a-dependent-abort-signal": { "displayText": "creating a dependent signal", "export": true, "for_": ["AbortSignal"], "level": "", "normative": true, "shortname": "dom", "spec": "dom", "status": "anchor-block", "text": "creating a dependent signal", "type": "dfn", "url": "https://dom.spec.whatwg.org/#create-a-dependent-abort-signal" },
                "https://dom.spec.whatwg.org/#dictdef-eventinit": { "displayText": "EventInit", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "EventInit", "type": "dictionary", "url": "https://dom.spec.whatwg.org/#dictdef-eventinit" },
                "https://dom.spec.whatwg.org/#dom-abortcontroller-signal": { "displayText": "signal", "export": true, "for_": ["AbortController"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "signal", "type": "attribute", "url": "https://dom.spec.whatwg.org/#dom-abortcontroller-signal" },
                "https://dom.spec.whatwg.org/#event": { "displayText": "Event", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "Event", "type": "interface", "url": "https://dom.spec.whatwg.org/#event" },
                "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": { "displayText": "in parallel", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "in parallel", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": { "displayText": "Window", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "Window", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout": { "displayText": "setTimeout(handler, timeout, ...arguments)", "export": true, "for_": ["WindowOrWorkerGlobalScope"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "setTimeout(handler, timeout, ...arguments)", "type": "method", "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" },
                "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout": { "displayText": "run steps after a timeout", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "run steps after a timeout", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout" },
                "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timer-task-source": { "displayText": "timer task source", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "timer task source", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timer-task-source" },
                "https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options": { "displayText": "postMessage(message, options)", "export": true, "for_": ["Window"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "postMessage(message, options)", "type": "method", "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" },
                "https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel": { "displayText": "MessageChannel", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "MessageChannel", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop": { "displayText": "event loop", "export": true, "for_": ["agent"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event loop", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": { "displayText": "relevant global object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": { "displayText": "relevant realm", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant realm", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task": { "displayText": "task", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-document": { "displayText": "document", "export": true, "for_": ["task"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "document", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-document" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable": { "displayText": "runnable", "export": true, "for_": ["task"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "runnable", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-source": { "displayText": "source", "export": true, "for_": ["task"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "source", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-source" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps": { "displayText": "steps", "export": true, "for_": ["task"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "steps", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm": { "displayText": "realm", "export": true, "for_": ["environment settings object"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "realm", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type": { "displayText": "event handler event type", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler event type", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes": { "displayText": "event handler IDL attribute", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler idl attribute", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers": { "displayText": "event handler", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop": { "displayText": "event loop", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event loop", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": { "displayText": "EventHandler", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "EventHandler", "type": "typedef", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent": { "displayText": "agent", "export": true, "for_": ["realm"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "agent", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent": { "displayText": "relevant agent", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant agent", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set": { "displayText": "script evaluation environment settings object set", "export": true, "for_": ["task"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "script evaluation environment settings object set", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue": { "displayText": "task queues", "export": false, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task queues", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#task-source": { "displayText": "task source", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task source", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope": { "displayText": "WindowOrWorkerGlobalScope", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "WindowOrWorkerGlobalScope", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" },
                "https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window": { "displayText": "associated Document", "export": true, "for_": ["Window"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "associated Document", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" },
                "https://infra.spec.whatwg.org/#boolean": { "displayText": "boolean", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "boolean", "type": "dfn", "url": "https://infra.spec.whatwg.org/#boolean" },
                "https://infra.spec.whatwg.org/#implementation-defined": { "displayText": "implementation-defined", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "implementation-defined", "type": "dfn", "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "https://infra.spec.whatwg.org/#list": { "displayText": "list", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "list", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list" },
                "https://infra.spec.whatwg.org/#list-clone": { "displayText": "clone", "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "clone", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-clone" },
                "https://infra.spec.whatwg.org/#list-empty": { "displayText": "empty", "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "empty", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-empty" },
                "https://infra.spec.whatwg.org/#list-extend": { "displayText": "extend", "export": true, "for_": ["list"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "extend", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-extend" },
                "https://infra.spec.whatwg.org/#list-item": { "displayText": "item", "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "item", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-item" },
                "https://infra.spec.whatwg.org/#list-iterate": { "displayText": "iterate", "export": true, "for_": ["list", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "iterate", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "https://infra.spec.whatwg.org/#list-remove": { "displayText": "remove", "export": true, "for_": ["list", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "remove", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-remove" },
                "https://infra.spec.whatwg.org/#map-exists": { "displayText": "exist", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "exist", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-exists" },
                "https://infra.spec.whatwg.org/#map-getting-the-values": { "displayText": "get the values", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "get the values", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-getting-the-values" },
                "https://infra.spec.whatwg.org/#map-remove": { "displayText": "remove", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "remove", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-remove" },
                "https://infra.spec.whatwg.org/#ordered-map": { "displayText": "map", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "map", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "https://infra.spec.whatwg.org/#ordered-set": { "displayText": "set", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "set", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "https://infra.spec.whatwg.org/#set-append": { "displayText": "append", "export": true, "for_": ["set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "append", "type": "dfn", "url": "https://infra.spec.whatwg.org/#set-append" },
                "https://infra.spec.whatwg.org/#struct": { "displayText": "struct", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "struct", "type": "dfn", "url": "https://infra.spec.whatwg.org/#struct" },
                "https://infra.spec.whatwg.org/#struct-item": { "displayText": "item", "export": true, "for_": ["struct", "tuple"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "item", "type": "dfn", "url": "https://infra.spec.whatwg.org/#struct-item" },
                "https://tc39.es/ecma262/#current-realm": { "displayText": "current realm", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "anchor-block", "text": "current realm", "type": "dfn", "url": "https://tc39.es/ecma262/#current-realm" },
                "https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm": { "displayText": "realm", "export": true, "for_": ["ECMAScript"], "level": "1", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "current", "text": "realm", "type": "dfn", "url": "https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm" },
                "https://webidl.spec.whatwg.org/#EnforceRange": { "displayText": "EnforceRange", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "EnforceRange", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#EnforceRange" },
                "https://webidl.spec.whatwg.org/#Exposed": { "displayText": "Exposed", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#NewObject": { "displayText": "NewObject", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "NewObject", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#NewObject" },
                "https://webidl.spec.whatwg.org/#Replaceable": { "displayText": "Replaceable", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Replaceable", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Replaceable" },
                "https://webidl.spec.whatwg.org/#a-new-promise": { "displayText": "a new promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "a new promise", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "https://webidl.spec.whatwg.org/#dfn-throw": { "displayText": "throw", "export": true, "for_": ["exception"], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "throw", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#dfn-throw" },
                "https://webidl.spec.whatwg.org/#idl-DOMException": { "displayText": "DOMException", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMException", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "https://webidl.spec.whatwg.org/#idl-DOMString": { "displayText": "DOMString", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMString", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMString" },
                "https://webidl.spec.whatwg.org/#idl-any": { "displayText": "any", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "any", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-any" },
                "https://webidl.spec.whatwg.org/#idl-promise": { "displayText": "Promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Promise", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "https://webidl.spec.whatwg.org/#idl-sequence": { "displayText": "sequence", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "sequence", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#idl-sequence" },
                "https://webidl.spec.whatwg.org/#idl-undefined": { "displayText": "undefined", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "undefined", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "https://webidl.spec.whatwg.org/#idl-unsigned-long-long": { "displayText": "unsigned long long", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "unsigned long long", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "https://webidl.spec.whatwg.org/#implements": { "displayText": "implements", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "implements", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#implements" },
                "https://webidl.spec.whatwg.org/#invoke-a-callback-function": { "displayText": "invoke", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "invoke", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#invoke-a-callback-function" },
                "https://webidl.spec.whatwg.org/#notallowederror": { "displayText": "NotAllowedError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "NotAllowedError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "https://webidl.spec.whatwg.org/#reject": { "displayText": "reject", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "reject", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#reject" },
                "https://webidl.spec.whatwg.org/#resolve": { "displayText": "resolve", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "resolve", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#resolve" },
                "https://webidl.spec.whatwg.org/#this": { "displayText": "this", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
                "https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback": { "displayText": "requestIdleCallback()", "export": true, "for_": ["Window"], "level": "", "normative": true, "shortname": "requestidlecallback", "spec": "requestidlecallback", "status": "anchor-block", "text": "requestIdleCallback()", "type": "method", "url": "https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const refHintKey = link.getAttribute("data-refhint-key");
                let key = url;
                if (refHintKey) {
                    key = refHintKey + "_" + url;
                }
                const ref = refsData[key];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>
    <script src="/dropdown.js"></script>