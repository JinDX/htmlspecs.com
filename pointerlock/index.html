<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 35.1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "âš ";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>

    <title>Pointer Lock 2.0</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "Â§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>


    <meta name="color-scheme" content="light">
    <meta name="revision" content="0e99fcf3daa23269bf2b019f5269a154088d2347">
    <link rel="canonical" href="https://www.w3.org/TR/pointerlock-2/">
    <style>
        .hljs {
            --base: #fafafa;
            --mono-1: #383a42;
            --mono-2: #686b77;
            --mono-3: #717277;
            --hue-1: #0b76c5;
            --hue-2: #336ae3;
            --hue-3: #a626a4;
            --hue-4: #42803c;
            --hue-5: #ca4706;
            --hue-5-2: #c91243;
            --hue-6: #986801;
            --hue-6-2: #9a6a01
        }

        @media (prefers-color-scheme:dark) {
            .hljs {
                --base: #282c34;
                --mono-1: #abb2bf;
                --mono-2: #818896;
                --mono-3: #5c6370;
                --hue-1: #56b6c2;
                --hue-2: #61aeee;
                --hue-3: #c678dd;
                --hue-4: #98c379;
                --hue-5: #e06c75;
                --hue-5-2: #be5046;
                --hue-6: #d19a66;
                --hue-6-2: #e6c07b
            }
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            color: var(--mono-1, #383a42);
            background: #fafafa;
            background: var(--base, #fafafa)
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            color: var(--mono-3, #717277);
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4;
            color: var(--hue-3, #a626a4)
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            color: var(--hue-5, #ca4706);
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5;
            color: var(--hue-1, #0b76c5)
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c;
            color: var(--hue-4, #42803c)
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01;
            color: var(--hue-6-2, #9a6a01)
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801;
            color: var(--hue-6, #986801)
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3;
            color: var(--hue-2, #336ae3)
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
      "specStatus": "WD",
      "caniuse": "pointerlock",
      "previousPublishDate": "2024-05-16",
      "previousMaturity": "WD",
      "testSuiteURI": "https://github.com/web-platform-tests/wpt/tree/master/pointerlock",
      "editors": [
        {
          "name": "Mustaq Ahmed",
          "company": "Google",
          "companyURL": "http://www.google.com/",
          "w3cid": "75206"
        },
        {
          "name": "Vincent Scheib",
          "url": "http://www.scheib.net",
          "company": "Google",
          "companyURL": "http://www.google.com/",
          "w3cid": "49724"
        }
      ],
      "formerEditors": [
        {
          "name": "Navid Zolghadr",
          "company": "Google",
          "companyURL": "http://www.google.com/",
          "w3cid": "92361"
        }
      ],
      "github": "w3c/pointerlock",
      "group": "webapps",
      "xref": {
        "specs": [
          "uievents"
        ],
        "profile": "web-platform"
      },
      "shortName": "pointerlock-2",
      "gitRevision": "0e99fcf3daa23269bf2b019f5269a154088d2347",
      "publishDate": "2024-06-17",
      "publishISODate": "2024-06-17T00:00:00.000Z",
      "generatedSubtitle": "W3C Working Draft 17 June 2024"
    }</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body data-cite="WEBIDL uievents uievents HTML INFRA URL WEBIDL DOM FETCH" class="h-entry">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">Pointer Lock 2.0</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C Working Draft</a> <time
                class="dt-published" datetime="2024-06-17">17 June 2024</time></p>
        <details open="">
            <summary>More details about this document</summary>
            <dl>
                <dt>This version:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2024/WD-pointerlock-2-20240617/">https://www.w3.org/TR/2024/WD-pointerlock-2-20240617/</a>
                </dd>
                <dt>Latest published version:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/pointerlock-2/">https://www.w3.org/TR/pointerlock-2/</a>
                </dd>
                <dt>Latest editor's draft:</dt>
                <dd><a href="https://w3c.github.io/pointerlock/">https://w3c.github.io/pointerlock/</a></dd>
                <dt>History:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/pointerlock-2/">https://www.w3.org/standards/history/pointerlock-2/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/pointerlock/commits/">Commit history</a>
                </dd>
                <dt>Test suite:</dt>
                <dd><a
                        href="https://github.com/web-platform-tests/wpt/tree/master/pointerlock">https://github.com/web-platform-tests/wpt/tree/master/pointerlock</a>
                </dd>




                <dt>Editors:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="75206">
                    <span class="p-name fn">Mustaq Ahmed</span> (<a class="p-org org h-org"
                        href="https://www.google.com/">Google</a>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="49724">
                    <a class="u-url url p-name fn" href="http://www.scheib.net">Vincent Scheib</a> (<a
                        class="p-org org h-org" href="https://www.google.com/">Google</a>)
                </dd>
                <dt>
                    Former editor:
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="92361">
                    <span class="p-name fn">Navid Zolghadr</span> (<a class="p-org org h-org"
                        href="https://www.google.com/">Google</a>)
                </dd>

                <dt>Feedback:</dt>
                <dd>
                    <a href="https://github.com/w3c/pointerlock/">GitHub w3c/pointerlock</a>
                    (<a href="https://github.com/w3c/pointerlock/pulls/">pull requests</a>,
                    <a href="https://github.com/w3c/pointerlock/issues/new/choose">new issue</a>,
                    <a href="https://github.com/w3c/pointerlock/issues/">open issues</a>)
                </dd>


                <dt class="caniuse-title">Browser support:</dt>
                <dd class="caniuse-stats"><a href="https://caniuse.com/pointerlock">caniuse.com</a></dd>
            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            Â©
            2024

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>Â®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2>Abstract</h2>
        This specification defines an API that provides scripted access to raw
        mouse movement data while locking the target of mouse events to a single
        element and removing the cursor from view. This is an essential input
        mode for certain classes of applications, especially first person
        perspective 3D applications and 3D modeling software.
    </section>
    <section id="sotd" class="introductory">
        <h2>Status of This Document</h2>
        <p><em>This section describes the status of this
                document at the time of its publication. A list of current <abbr
                    title="World Wide Web Consortium">W3C</abbr>
                publications and the latest revision of this technical report can be found
                in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical
                    reports index</a> at
                https://www.w3.org/TR/.</em></p>

        <p>
            A history of changes to this document can be found at <a
                href="https://github.com/w3c/pointerlock/commits/gh-pages/index.html">https://github.com/w3c/pointerlock/commits/gh-pages/index.html</a>
        </p>
        <p>
            Summary of changes since <a href="https://www.w3.org/TR/2016/WD-pointerlock-2-20161122/"><abbr
                    title="World Wide Web Consortium">W3C</abbr>
                Recommendation 27 October 2016</a>:
        </p>
        <ul>
            <li>
                <a href="https://github.com/w3c/pointerlock/commit/027f57ae80cf5bdb03379203828aa234f3e7e433">
                    IDL blocks updated</a> to be machine <a
                    href="https://github.com/w3c/pointerlock/issues/13">parsable</a>, no
                substantive change.
            </li>
        </ul>
        <p>
            This document was published by the <a href="https://www.w3.org/groups/wg/webapps">Web Applications Working
                Group</a> as
            a Working Draft using the
            <a href="https://www.w3.org/2023/Process-20231103/#recs-and-notes">Recommendation track</a>.
        </p>
        <p>Publication as a Working Draft does not
            imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. </p>
        <p>
            This is a draft document and may be updated, replaced or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other
            than work in progress.

        </p>
        <p>

            This document was produced by a group
            operating under the
            <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                Patent
                Policy</a>.


            <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webapps/ipr">public list of any patent
                disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr
                    title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.

        </p>
        <p>
            This document is governed by the
            <a id="w3c_process_revision" href="https://www.w3.org/2023/Process-20231103/">03 November 2023 <abbr
                    title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">Table of Contents</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>
                    Introduction
                </a></li>
            <li class="tocline"><a class="tocxref" href="#pointer-lock-and-interfaces"><bdi class="secno">2. </bdi>
                    Pointer Lock and Interfaces
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#the-pointer-lock-state-definition"><bdi
                                class="secno">2.1 </bdi>
                            The <span>pointer lock state</span> definition
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#pointerlockoptions-dictionary"><bdi class="secno">2.2
                            </bdi>
                            <code>PointerLockOptions</code> dictionary
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#pointerlockchange-and-pointerlockerror-events"><bdi
                                class="secno">2.3 </bdi>
                            <code>pointerlockchange</code> and <code>pointerlockerror</code> Events
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#exit-pointer-lock"><bdi class="secno">2.4 </bdi>
                            <span>Exit Pointer Lock</span>
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#requestPointerLock"><bdi class="secno">3. </bdi>
                    Extensions to the <code>Element</code> Interface
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-document-interface"><bdi class="secno">4.
                    </bdi>
                    Extensions to the <code>Document</code> Interface
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-documentorshadowroot-mixin"><bdi
                        class="secno">5. </bdi>
                    Extensions to the <code>DocumentOrShadowRoot</code> Mixin
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-mouseevent-interface"><bdi class="secno">6.
                    </bdi>
                    Extensions to the <code>MouseEvent</code> Interface
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-mouseeventinit-dictionary"><bdi
                        class="secno">7. </bdi>
                    Extensions to the <code>MouseEventInit</code> Dictionary
                </a></li>
            <li class="tocline"><a class="tocxref" href="#requirements"><bdi class="secno">8. </bdi>
                    Requirements
                </a></li>
            <li class="tocline"><a class="tocxref" href="#use-cases"><bdi class="secno">9. </bdi>
                    Use Cases
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref"
                            href="#relative-view-port-rotation-of-free-moving-virtual-actors"><bdi class="secno">9.1
                            </bdi>
                            Relative view-port rotation of free moving virtual actors
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#free-rotation-of-3d-models-or-panning-of-2d-layers"><bdi class="secno">9.2 </bdi>
                            Free rotation of 3D models or panning of 2D layers
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#relative-movement-of-actors"><bdi class="secno">9.3
                            </bdi>
                            Relative movement of actors
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#jog-movement-over-spinner-controls"><bdi
                                class="secno">9.4 </bdi>
                            Jog movement over spinner controls
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#synthetic-cursor-interaction-with-html-dom-ui"><bdi
                                class="secno">9.5 </bdi>
                            Synthetic cursor interaction with HTML DOM UI
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"><bdi
                                class="secno">9.6 </bdi>
                            View-port panning by moving a mouse cursor against the bounds of a
                            view-port.
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#game-lobby-timer-based-pointer-lock"><bdi
                                class="secno">9.7 </bdi>
                            Game Lobby, timer based pointer lock
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#game-portal"><bdi class="secno">9.8 </bdi>
                            Game Portal
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#security"><bdi class="secno">10. </bdi>
                    Security
                </a></li>
            <li class="tocline"><a class="tocxref" href="#frequently-asked-questions"><bdi class="secno">11. </bdi>
                    Frequently Asked Questions
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#why-not-merge-with-mouse-capture-setcapture"><bdi
                                class="secno">11.1 </bdi>
                            Why not merge with Mouse Capture: setCapture()?
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-not-repurpose-mouseevent-s-clientx-y-screenx-y"><bdi class="secno">11.2 </bdi>
                            Why not repurpose MouseEvent's .clientX/Y .screenX/Y?
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#why-use-movementx-y-instead-of-deltax-y"><bdi
                                class="secno">11.3 </bdi>
                            Why use .movementX/Y instead of .deltaX/Y?
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#why-bundle"><bdi class="secno">11.4 </bdi>
                            Why bundle all functionality (hiding cursor, providing mouse deltas)
                            instead of using CSS to hide the cursor, always providing delta
                            values, and offering an API to restrict the cursor movement to a
                            portion of the web page?
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#high-resolution-deltas-high-frequency-updates"><bdi
                                class="secno">11.5 </bdi>
                            High resolution deltas / High frequency updates?
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event"><bdi
                                class="secno">11.6 </bdi>
                            Why modify MouseEvent and reuse existing mouse events instead of
                            creating a mouse delta event?
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"><bdi
                                class="secno">11.7 </bdi>
                            Why separate targets for mouse events under pointer lock and keyboard
                            input focus?
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">12. </bdi>Conformance</a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgments"><bdi class="secno">A. </bdi>
                    Acknowledgments
                </a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>Normative references</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>Informative references</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section id="introduction" class="informative">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>
                Introduction
            </h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>
            The Pointer Lock API provides applications the ability to directly
            interpret mouse movements as an input method, rather than being limited
            to only read the position of the mouse cursor. A popular example is
            that of first person movement controls in three dimensional graphics
            applications such as games: movement of the mouse is interpreted to
            control the rotation/direction of the player's camera; no mouse cursor
            is displayed, and the movement is not limited to the traditional
            boundaries (such as the user agent's window, or the overall screen)
            that the mouse cursor is usually subject to, meaning that any mouse
            movements can be tracked indefinitely in any direction.
        </p>
        <p>
            Pointer Lock is related to Mouse Capture [<cite><a class="bibref" data-link-type="biblio"
                    href="#bib-mdn-setcapture" title="Element.setCapture()">MDN-SETCAPTURE</a></cite>] (Mouse
            Capture is unspecified: bug <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=14600">14600</a>).
            Capture provides continued event delivery to a target element while a
            mouse is being dragged, but ceases when the mouse button is released.
            Pointer Lock differs by being persistent, not limited by screen
            boundaries, sending events regardless of mouse button state, hiding the
            cursor, and not releasing until an API call or specific <a href="#dfn-default-unlock-gesture"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-default-unlock-gesture-1">default
                unlock gesture</a> by the user.
        </p>
        <p>
            Pointer Lock deals with capturing a single resource and relating it to
            a single element. This is similar to the Fullscreen API [<cite><a class="bibref" data-link-type="biblio"
                    href="#bib-fullscreen" title="Fullscreen API Standard">FULLSCREEN</a></cite>],
            which promotes a single element to be full screen. The Pointer Lock API
            chooses to pattern the resource capture, state change, and release API
            as closely as possible after the Fullscreen API.
        </p>
        <p>
            The Pointer Lock interaction mode was previously referred to as mouse
            lock. The name was changed as many different controller types besides
            mice can manipulate the on screen pointing cursor, and they are all
            impacted.
        </p>
    </section>
    <section id="pointer-lock-and-interfaces">
        <div class="header-wrapper">
            <h2 id="x2-pointer-lock-and-interfaces"><bdi class="secno">2. </bdi>
                Pointer Lock and Interfaces
            </h2><a class="self-link" href="#pointer-lock-and-interfaces" aria-label="Permalink for Section 2."></a>
        </div>

        <section id="the-pointer-lock-state-definition">
            <div class="header-wrapper">
                <h3 id="x2-1-the-pointer-lock-state-definition"><bdi class="secno">2.1 </bdi>
                    The <dfn id="dfn-pointer-lock-state" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">pointer
                        lock state</dfn> definition
                </h3><a class="self-link" href="#the-pointer-lock-state-definition"
                    aria-label="Permalink for Section 2.1"></a>
            </div>

            <p>
                The <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-1">pointer lock state</a> is the state where a single DOM
                element,
                which we will call the <dfn id="dfn-pointer-lock-target" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">pointer-lock target</dfn>, receives all
                mouse events and the cursor is hidden.
            </p>
            <p>
                Once in the <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-2">pointer lock state</a> the <a data-link-type="dfn|abstract-op"
                    href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-1">user agent</a> has a
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-1">pointer-lock target</a>, a <dfn id="dfn-pointer-lock-options"
                    tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">pointer-lock options</dfn>, which is
                a <a data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions"
                    class="internalDFN" id="ref-for-dom-pointerlockoptions-1"><code>PointerLockOptions</code></a> and a
                <dfn id="dfn-cursor-position" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">cursor
                    position</dfn> which is a
                pair of numbers representing the location of the system mouse cursor
                when the Pointer Lock State was entered (the same location that is
                reported in <code>screenX</code>, <code>screenY</code>). The <a data-link-type="dfn|abstract-op"
                    href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-2">pointer-lock target</a>
                receives all relevant user generated <a data-link-type="idl" data-lt="MouseEvent" data-type="interface"
                    href="https://www.w3.org/TR/uievents/#mouseevent"><code>MouseEvent</code></a> events: namely,
                all user-generated <code>mousemove</code>, <code>mousedown</code>, <code>mouseup</code>,
                <code>click</code>,
                <code>dblclick</code>, <code>auxclick</code>, and <code>wheel</code> [<cite><a class="bibref"
                        data-link-type="biblio" href="#bib-ui-events" title="UI Events">ui-events</a></cite>]. No other
                elements
                receive these events while in <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state"
                    class="internalDFN" id="ref-for-dfn-pointer-lock-state-3">pointer lock state</a>. There will be
                no dispatching of events that require the concept of a mouse cursor:
                namely, <code>mouseenter</code>, <code>mouseleave</code>, <code>mouseover</code>, <code>mouseout</code>,
                <code>drag</code>,
                and <code>drop</code>.
            </p>
            <div class="issue" id="issue-container-number-97">
                <div role="heading" class="issue-title marker" id="h-issue" aria-level="4"><a
                        href="https://github.com/w3c/pointerlock/issues/97"><span class="issue-number">Issue
                            97</span></a><span class="issue-label">: Section 2.1 should mention the effect of lock on
                        PointerEvents</span></div>
                <p dir="auto">This came up in <a href="https://github.com/w3c/pointerlock/pull/49#discussion_r468133933"
                        data-hovercard-type="pull_request" data-hovercard-url="/w3c/pointerlock/pull/49/hovercard">this
                        thread</a> on <a class="issue-link js-issue-link" data-error-text="Failed to load title"
                        data-id="468848569" data-permission-text="Title is private"
                        data-url="https://github.com/w3c/pointerlock/issues/49" data-hovercard-type="pull_request"
                        data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                        href="https://github.com/w3c/pointerlock/pull/49">#49</a>:</p>
                <blockquote>
                    <p dir="auto">Would it be possible to list these events normatively, instead of only giving some
                        examples?</p>
                    <p dir="auto">I think the current text is OK, because the lack of precision here is just a symptom
                        of the larger lack of precision in how mouse events are specified in general. Some progress is
                        being made there, in <a class="issue-link js-issue-link" data-error-text="Failed to load title"
                            data-id="312692962" data-permission-text="Title is private"
                            data-url="https://github.com/w3c/uievents/issues/200" data-hovercard-type="issue"
                            data-hovercard-url="/w3c/uievents/issues/200/hovercard"
                            href="https://github.com/w3c/uievents/issues/200">w3c/uievents#200</a>, and if that lands
                        then eventually this paragraph can move into the UI events spec as an actual change to the
                        processing model.</p>
                    <p dir="auto">But in the meantime, it would help achieve interoperability if you were precise about
                        the list of events.</p>
                    <p dir="auto">For example, it's not clear to me whether pointer events are impacted by this change.
                    </p>
                </blockquote>
            </div>
            <p></p>
            <p>
                While in the <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-4">pointer lock state</a> if the <a
                    data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-options-1">pointer-lock options</a>'
                <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-unadjustedmovement-1"><code>unadjustedMovement</code></a> member
                is <code>true</code>, the event
                coordinates will not be affected by the underlying platform behaviors
                such as mouse acceleration. In other words, the user agent uses the
                APIs provided by the underlying platform to guarantee getting the raw
                events. If the <a data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions"
                    class="internalDFN" id="ref-for-dom-pointerlockoptions-2"><code>PointerLockOptions</code></a>'
                <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-unadjustedmovement-2"><code>unadjustedMovement</code></a> member
                is <code>false</code>, the user
                agent relies on the default behavior of the underlying platform
                regarding the mouse acceleration.
            </p>
            <p>
                In the <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-5">pointer lock state</a>, the system mouse cursor is hidden and
                the window is prevented from losing focus, regardless of mouse
                movement or button presses. This is directly or indirectly achieved
                utilizing the underlying operating system API.
            </p>
            <div class="note" role="note" id="issue-container-generatedID">
                <div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div>
                <p class="">
                    Synthetic mouse events created by application script act the same
                    regardless of lock state.
                </p>
            </div>
        </section>
        <section data-dfn-for="PointerLockOptions" id="pointerlockoptions-dictionary">
            <div class="header-wrapper">
                <h3 id="x2-2-pointerlockoptions-dictionary"><bdi class="secno">2.2 </bdi>
                    <code>PointerLockOptions</code> dictionary
                </h3><a class="self-link" href="#pointerlockoptions-dictionary"
                    aria-label="Permalink for Section 2.2"></a>
            </div>

            <pre class="idl def" id="webidl-1846476394"><span class="idlHeader"><a class="self-link" href="#webidl-1846476394">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-pointerlockoptions" data-title="PointerLockOptions">dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-pointerlockoptions" id="ref-for-dom-pointerlockoptions-3"><code>PointerLockOptions</code></a> {<span data-idl="" class="idlMember" id="idl-def-pointerlockoptions-unadjustedmovement" data-title="unadjustedMovement" data-dfn-for="PointerLockOptions"><span class="idlType">
      <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-pointerlockoptions-unadjustedmovement" id="ref-for-dom-pointerlockoptions-unadjustedmovement-3"><code>unadjustedMovement</code></a> = false;</span>
    };</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="dictionary" id="dom-pointerlockoptions" data-idl="dictionary"
                        data-title="PointerLockOptions" data-dfn-for="" tabindex="0"
                        aria-haspopup="dialog"><code>PointerLockOptions</code></dfn> dictionary
                </dt>
                <dd>
                    <p>
                        The options dictionary to customize how the pointer behaves in
                        the locked mode.
                    </p>
                </dd>
                <dt>
                    <dfn data-export="" data-dfn-type="dict-member" id="dom-pointerlockoptions-unadjustedmovement"
                        data-idl="field" data-title="unadjustedMovement" data-dfn-for="PointerLockOptions"
                        data-type="boolean" tabindex="0" aria-haspopup="dialog"><code>unadjustedMovement</code></dfn>
                    member
                </dt>
                <dd>
                    <p>
                        If this value is set to <code>true</code>, then the pointer movements will
                        not be affected by the underlying platform modifications such as
                        mouse accelaration.
                    </p>
                </dd>
            </dl>
        </section>
        <section id="pointerlockchange-and-pointerlockerror-events">
            <div class="header-wrapper">
                <h3 id="x2-3-pointerlockchange-and-pointerlockerror-events"><bdi class="secno">2.3 </bdi>
                    <code>pointerlockchange</code> and <code>pointerlockerror</code> Events
                </h3><a class="self-link" href="#pointerlockchange-and-pointerlockerror-events"
                    aria-label="Permalink for Section 2.3"></a>
            </div>

            <p>
                Two events are used to communicate pointer lock state change or an
                error in changing state. They are named <dfn class="event" data-dfn-type="event"
                    id="dfn-pointerlockchange" tabindex="0" aria-haspopup="dialog"
                    data-export="">pointerlockchange</dfn> and <dfn class="event" data-dfn-type="event"
                    id="dfn-pointerlockerror" tabindex="0" aria-haspopup="dialog" data-export="">pointerlockerror</dfn>.
                Refer to algorithm of
                <a href="#requestPointerLock" data-matched-text="[[[#requestPointerLock]]]" class="sec-ref"><bdi
                        class="secno">3. </bdi>
                    Extensions to the <code>Element</code> Interface</a> for detail.
            </p>
            <div class="note" role="note" id="issue-container-generatedID-0">
                <div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>Note</span></div>
                <p class="">
                    Magnification software increases the size of content on the screen.
                    It uses the mouse to move the magnified point of focus around. When a
                    pointer lock is initiated, the magnification software needs to switch
                    to using the keyboard to move the magnified point of focus around
                    instead. When a <a data-link-type="idl" data-lt="pointerlockchange" href="#dfn-pointerlockchange"
                        class="internalDFN" id="ref-for-dfn-pointerlockchange-1"><code>pointerlockchange</code></a>
                    event is fired, web browsers
                    therefore need to make sure the event is communicated to assistive
                    technologies like screen magnifiers.
                </p>
            </div>
        </section>
        <section id="exit-pointer-lock">
            <div class="header-wrapper">
                <h3 id="x2-4-exit-pointer-lock"><bdi class="secno">2.4 </bdi>
                    <dfn id="dfn-exit-pointer-lock" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Exit Pointer
                        Lock</dfn>
                </h3><a class="self-link" href="#exit-pointer-lock" aria-label="Permalink for Section 2.4"></a>
            </div>

            <p>
                The process of exiting pointer lock, given an <var data-type="Element">element</var>, is
                as follows:
            </p>
            <ol class="algorithm">
                <li>The system mouse cursor must be displayed again and positioned at
                    <a data-link-type="dfn|abstract-op" href="#dfn-cursor-position" class="internalDFN"
                        id="ref-for-dfn-cursor-position-1">cursor position</a>.
                </li>
                <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue an
                        element task</a> on the <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                        interaction task source</a>
                    to <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a> named <a
                        data-link-type="idl" data-lt="pointerlockchange" href="#dfn-pointerlockchange"
                        class="internalDFN" id="ref-for-dfn-pointerlockchange-2"><code>pointerlockchange</code></a> at
                    the given
                    <var data-type="Element">element</var>'s <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>.
                </li>
                <li>Exit the <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-state-6">pointer lock state</a> by setting <a
                        data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-target-3">pointer-lock target</a>, <a
                        data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-options-2">pointer-lock options</a>, and <a
                        data-link-type="dfn|abstract-op" href="#dfn-cursor-position" class="internalDFN"
                        id="ref-for-dfn-cursor-position-2">cursor position</a> to null.
                </li>
            </ol>
        </section>
    </section>
    <section data-dfn-for="Element" data-link-for="Element" id="requestPointerLock">
        <div class="header-wrapper">
            <h2 id="x3-extensions-to-the-element-interface"><bdi class="secno">3. </bdi>
                Extensions to the <code>Element</code> Interface
            </h2><a class="self-link" href="#requestPointerLock" aria-label="Permalink for Section 3."></a>
        </div>

        <p>
            The <a data-link-type="idl" data-lt="Element" data-type="interface"
                href="https://dom.spec.whatwg.org/#element"><code>Element</code></a> interface is extended to provide
            the ability to request
            the pointer be locked.
        </p>
        <pre class="idl def" id="webidl-1328413902"><span class="idlHeader"><a class="self-link" href="#webidl-1328413902">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-element-partial-1" data-title="Element">partial interface <a data-idl="partial" data-link-type="interface" data-title="Element" class="idlID" data-dfn-for="Element" data-type="interface" href="https://dom.spec.whatwg.org/#element">Element</a> {<span data-idl="" class="idlMethod" id="idl-def-element-requestpointerlock-options" data-title="requestPointerLock" data-dfn-for="Element"><span class="idlType">
      <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise">Promise</a>&lt;<a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a>&gt;</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-element-requestpointerlock" id="ref-for-dom-element-requestpointerlock-1"><code>requestPointerLock</code></a>(optional<span class="idlType"> <a data-link-type="idl" href="#dom-pointerlockoptions" class="internalDFN" id="ref-for-dom-pointerlockoptions-4"><code>PointerLockOptions</code></a></span> <span class="idlParamName">options</span> = {});</span>
    };</span></code></pre>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">Example<bdi> 1</bdi></a>
            </div>
            <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">const</span> lock_element = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"lock_element"</span>);
    <span class="hljs-keyword">const</span> lock_button = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"lock"</span>);
    lock_button.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">await</span> lock_element.requestPointerLock({ <span class="hljs-attr">unadjustedMovement</span>: <span class="hljs-literal">true</span> });
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"successfully locked!"</span>);
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"lock failed with error: "</span>, e);
        }
    });</code></pre>
        </div>
        <dl>
            <dt>
                requestPointerLock(<a data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions"
                    class="internalDFN" id="ref-for-dom-pointerlockoptions-5"><code>PointerLockOptions</code></a>
                options) method
            </dt>
            <dd>
                <p>
                    A <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue">parallel
                        queue</a> named as <dfn id="dfn-lock-requests-queue" tabindex="0" aria-haspopup="dialog"
                        data-dfn-type="dfn">lock requests queue</dfn> is
                    used for queuing all requests. When <dfn data-export="" data-dfn-type="method"
                        id="dom-element-requestpointerlock" data-idl="operation" data-title="requestPointerLock()"
                        data-dfn-for="Element" data-type="Promise"
                        data-lt="requestPointerLock()|requestPointerLock(options)"
                        data-local-lt="Element.requestPointerLock|Element.requestPointerLock()|requestPointerLock"
                        tabindex="0" aria-haspopup="dialog"><code>requestPointerLock()</code></dfn>
                    is invoked, perform the following steps:
                </p>
                <ol class="algorithm">
                    <li>Let <var data-type="Promise">promise</var> be <a data-link-type="dfn|abstract-op"
                            data-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise">a new promise</a>.
                    </li>
                    <li>When a <a data-link-type="idl" data-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window"><code>window</code></a>
                        is in <a data-link-type="dfn|abstract-op" data-type="event"
                            href="https://html.spec.whatwg.org/multipage/indices.html#event-focus">focus</a>, if the
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a data-link-type="dfn|abstract-op"
                            data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including root</a>
                        is the <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">active
                            document</a> of a <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">browsing
                            context</a> (or has an
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-ancestor">ancestor</a> <a
                            data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context">browsing
                            context</a>) that is not in focus:
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                    an element task</a> on the <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                    interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                    data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                following steps:
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
                                        named <a data-link-type="idl" data-lt="pointerlockerror"
                                            href="#dfn-pointerlockerror" class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-1"><code>pointerlockerror</code></a> at
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>.
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">Reject</a> <var
                                            data-type="Promise">promise</var> with a "<a data-link-type="idl"
                                            data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#wrongdocumenterror"><code>WrongDocumentError</code></a>"
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                    </li>
                                </ol>
                            </li>
                            <li>Return <var data-type="Promise">promise</var>.
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-93">
                            <div role="heading" class="issue-title marker" id="h-issue-0" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/93"><span class="issue-number">Issue
                                        93</span></a><span class="issue-label">: Visibility state checks</span></div>
                            <p dir="auto">The spec should not allow hidden documents to request pointer lock.</p>
                            <p dir="auto">Additionally, should a document become hidden, it should release the pointer
                                lock.</p>
                        </div>
                    </li>
                    <li>If the 'relevant global object does not have <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">transient
                            activation</a> and the <a data-link-type="idl" data-lt="Document" data-type="interface"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> has not previously
                        released a
                        successful pointer lock with <a data-link-type="idl" data-lt="exitPointerLock()"
                            href="#dom-document-exitpointerlock" class="internalDFN"
                            id="ref-for-dom-document-exitpointerlock-1"><code>exitPointerLock</code></a><code>()</code>:
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                    an element task</a> on the <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                    interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                    data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                following steps:
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
                                        named <a data-link-type="idl" data-lt="pointerlockerror"
                                            href="#dfn-pointerlockerror" class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-2"><code>pointerlockerror</code></a> at
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>.
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">Reject</a> <var
                                            data-type="Promise">promise</var> with a
                                        "<a data-link-type="idl" data-lt="NotAllowedError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#notallowederror"><code>NotAllowedError</code></a>"
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                    </li>
                                </ol>
                            </li>
                            <li>Return <var data-type="Promise">promise</var>.
                            </li>
                        </ol>
                        <div class="note" role="note" id="issue-container-generatedID-1">
                            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>Note</span>
                            </div>
                            <aside class="">
                                When a single <a data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/interaction.html#tracking-user-activation">user
                                    activation</a> initiates both pointer
                                lock and fullscreen [<cite><a class="bibref" data-link-type="biblio"
                                        href="#bib-fullscreen" title="Fullscreen API Standard">FULLSCREEN</a></cite>],
                                the
                                <a data-link-type="idl" data-lt="requestPointerLock()"
                                    href="#dom-element-requestpointerlock" class="internalDFN"
                                    id="ref-for-dom-element-requestpointerlock-2"><code>requestPointerLock</code></a><code>()</code>
                                call succeeds only when it is made
                                before a fullscreen request because fullscreen is a
                                <a data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/interaction.html#activation-consuming-api">transient
                                    activation-consuming API</a>.
                            </aside>
                        </div>
                    </li>
                    <li>If <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a data-link-type="dfn|abstract-op"
                            data-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node
                            document</a>'s <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set">active
                            sandboxing flag set</a> has the <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#sandboxed-pointer-lock-browsing-context-flag">sandboxed
                            pointer lock browsing context flag</a> set:
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                    an element task</a> on the <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                    interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                    data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                following steps:
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
                                        named <a data-link-type="idl" data-lt="pointerlockerror"
                                            href="#dfn-pointerlockerror" class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-3"><code>pointerlockerror</code></a> at
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>.
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">Reject</a> <var
                                            data-type="Promise">promise</var> with a
                                        "<a data-link-type="idl" data-lt="SecurityError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#securityerror"><code>SecurityError</code></a>"
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                    </li>
                                </ol>
                            </li>
                            <li>Return <var data-type="Promise">promise</var>.
                            </li>
                        </ol>
                    </li>
                    <li>If options["<a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement"
                            class="internalDFN"
                            id="ref-for-dom-pointerlockoptions-unadjustedmovement-4"><code>unadjustedMovement</code></a>"]
                        is true
                        and the platform does not support
                        <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                            id="ref-for-dom-pointerlockoptions-unadjustedmovement-5"><code>unadjustedMovement</code></a>:
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                    an element task</a> on the <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                    interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                    data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                following steps:
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an event</a>
                                        named <a data-link-type="idl" data-lt="pointerlockerror"
                                            href="#dfn-pointerlockerror" class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-4"><code>pointerlockerror</code></a> at
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>.
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">Reject</a> <var
                                            data-type="Promise">promise</var> with a
                                        "<a data-link-type="idl" data-lt="NotSupportedError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a>"
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                    </li>
                                </ol>
                            </li>
                            <li>Return <var data-type="Promise">promise</var>.
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-90">
                            <div role="heading" class="issue-title marker" id="h-issue-1" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/90"><span class="issue-number">Issue
                                        90</span></a><span class="issue-label">: Propose to add a static field to
                                    indicate whether `unadjustedMovement` is supported.</span></div>
                            <p dir="auto">In PR <a class="issue-link js-issue-link"
                                    data-error-text="Failed to load title" data-id="468848569"
                                    data-permission-text="Title is private"
                                    data-url="https://github.com/w3c/pointerlock/issues/49"
                                    data-hovercard-type="pull_request"
                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                                    href="https://github.com/w3c/pointerlock/pull/49">#49</a>, <code
                                    class="notranslate">PointerLockOptions</code> is introduced. However, <code
                                    class="notranslate">unadjustedMovement</code> of <code
                                    class="notranslate">PointerLockOptions</code> might not be supported on all
                                platforms. A static field could be useful to determine whether it is supported before
                                directly using it in <code class="notranslate">PointerLockOptions</code> and get a not
                                supported error.</p>
                        </div>
                    </li>
                    <li>Enqueue the following steps to the <a data-link-type="dfn|abstract-op"
                            href="#dfn-lock-requests-queue" class="internalDFN"
                            id="ref-for-dfn-lock-requests-queue-1">lock requests queue</a>:
                        <ol>
                            <li>If the user agent's <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-target-4">pointer-lock target</a>
                                is an element
                                whose <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a> is not equal to <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>'s
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a>, then:
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                            an element task</a> on the <a data-link-type="dfn|abstract-op"
                                            data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                            interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                            data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to
                                        perform the following
                                        steps:
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an
                                                    event</a> named <a data-link-type="idl" data-lt="pointerlockerror"
                                                    href="#dfn-pointerlockerror" class="internalDFN"
                                                    id="ref-for-dfn-pointerlockerror-5"><code>pointerlockerror</code></a>
                                                at
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-node-document">node
                                                    document</a>.
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#reject">Reject</a> <var
                                                    data-type="Promise">promise</var> with a
                                                "<a data-link-type="idl" data-lt="InvalidStateError"
                                                    data-type="exception"
                                                    href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>"
                                                <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                                    href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                            <li>If the user agent's <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-target-5">pointer-lock target</a>'s
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a> is equal to <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>'s
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a> and options are equivalent to the
                                current <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-options-3">pointer-lock
                                    options</a>, then:
                                <ol>
                                    <li>Set <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                            class="internalDFN" id="ref-for-dfn-pointer-lock-target-6">pointer-lock
                                            target</a> to <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>.
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                            an element task</a> on the <a data-link-type="dfn|abstract-op"
                                            data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                            interaction task source</a>, given <a data-link-type="dfn|abstract-op"
                                            data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, to
                                        perform the following
                                        steps:
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-event-fire">Fire an
                                                    event</a> named <a data-link-type="idl" data-lt="pointerlockchange"
                                                    href="#dfn-pointerlockchange" class="internalDFN"
                                                    id="ref-for-dfn-pointerlockchange-3"><code>pointerlockchange</code></a>
                                                at
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-node-document">node
                                                    document</a>.
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#resolve">Resolve</a> the <var
                                                    data-type="Promise">promise</var>.
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                            <li>If <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-target-7">pointer-lock target</a>
                                is null, or options is not
                                equivalent to the current <a data-link-type="dfn|abstract-op"
                                    href="#dfn-pointer-lock-options" class="internalDFN"
                                    id="ref-for-dfn-pointer-lock-options-4">pointer-lock options</a>, process the
                                lock request and handle response upon fulfillment:
                                <ol>
                                    <li>If the lock request failed:
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                                    an element task</a> on the <a data-link-type="dfn|abstract-op"
                                                    data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                                    interaction task source</a>, given <a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                                following
                                                steps:
                                                <ol>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire
                                                            an event</a> named <a data-link-type="idl"
                                                            data-lt="pointerlockerror" href="#dfn-pointerlockerror"
                                                            class="internalDFN"
                                                            id="ref-for-dfn-pointerlockerror-6"><code>pointerlockerror</code></a>
                                                        at
                                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-node-document">node
                                                            document</a>.
                                                    </li>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#reject">Reject</a>
                                                        <var data-type="Promise">promise</var> with a
                                                        "<a data-link-type="idl" data-lt="NotSupportedError"
                                                            data-type="exception"
                                                            href="https://webidl.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a>"
                                                        <a data-link-type="idl" data-lt="DOMException"
                                                            data-type="interface"
                                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>.
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                        <div class="issue" id="issue-container-number-91">
                                            <div role="heading" class="issue-title marker" id="h-issue-2"
                                                aria-level="3"><a
                                                    href="https://github.com/w3c/pointerlock/issues/91"><span
                                                        class="issue-number">Issue 91</span></a><span
                                                    class="issue-label">: When a subsequent requestPointerLock is
                                                    rejected, should an already locked target exit lock state? </span>
                                            </div>
                                            <p dir="auto">In the PR <a class="issue-link js-issue-link"
                                                    data-error-text="Failed to load title" data-id="468848569"
                                                    data-permission-text="Title is private"
                                                    data-url="https://github.com/w3c/pointerlock/issues/49"
                                                    data-hovercard-type="pull_request"
                                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                                                    href="https://github.com/w3c/pointerlock/pull/49">#49</a>'s
                                                algorithm of <code class="notranslate">requestPointerLock</code> is
                                                currently missing the description for the scenario:<br>
                                                When a subsequent request failed (for any possible reason), should an
                                                already locked target exit lock state?</p>
                                        </div>
                                    </li>
                                    <li>If the lock request succeed:
                                        <ol>
                                            <li>Enter <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state"
                                                    class="internalDFN" id="ref-for-dfn-pointer-lock-state-7">pointer
                                                    lock state</a> by performing the
                                                following:
                                                <ol>
                                                    <li>Set the user agent's <a data-link-type="dfn|abstract-op"
                                                            href="#dfn-pointer-lock-target" class="internalDFN"
                                                            id="ref-for-dfn-pointer-lock-target-8">pointer-lock
                                                            target</a> to
                                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>.
                                                    </li>
                                                    <li>Set the user agent's <a data-link-type="dfn|abstract-op"
                                                            href="#dfn-cursor-position" class="internalDFN"
                                                            id="ref-for-dfn-cursor-position-3">cursor position</a> to
                                                        the
                                                        current system mouse location.
                                                    </li>
                                                    <li>Set the <a data-link-type="dfn|abstract-op"
                                                            href="#dfn-pointer-lock-options" class="internalDFN"
                                                            id="ref-for-dfn-pointer-lock-options-5">pointer-lock
                                                            options</a> to options.
                                                    </li>
                                                </ol>
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">Queue
                                                    an element task</a> on the <a data-link-type="dfn|abstract-op"
                                                    data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                                                    interaction task source</a>, given <a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>, to perform the
                                                following
                                                steps:
                                                <ol>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-event-fire">Fire
                                                            an event</a> named <a data-link-type="idl"
                                                            data-lt="pointerlockchange" href="#dfn-pointerlockchange"
                                                            class="internalDFN"
                                                            id="ref-for-dfn-pointerlockchange-4"><code>pointerlockchange</code></a>
                                                        at <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-node-document">node
                                                            document</a>.
                                                    </li>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#resolve">Resolve</a>
                                                        the <var data-type="Promise">promise</var>.
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-96">
                            <div role="heading" class="issue-title marker" id="h-issue-3" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/96"><span class="issue-number">Issue
                                        96</span></a><span class="issue-label">: lock requests queue processing is
                                    incomplete</span></div>
                            <p dir="auto">In the PR<a href="https://github.com/w3c/pointerlock/pull/49"
                                    data-hovercard-type="pull_request"
                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard">#49</a>'s algorithm of
                                requestPointerLock is currently missing the description about how entries in <code
                                    class="notranslate">lock requests queue</code> are processed. Without an explicit
                                text, we will leave open the incorrect (?) assumption that all entries will be
                                synchronously dequeued at the end.</p>
                        </div>
                    </li>
                    <li>Return <var data-type="Promise">promise</var>.
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-2">
                    <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>Note</span></div>
                    <aside class="">
                        This algorithm is under active development and may be modified in
                        subsequent updates.
                    </aside>
                </div>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="Document" data-link-for="Document" id="extensions-to-the-document-interface">
        <div class="header-wrapper">
            <h2 id="x4-extensions-to-the-document-interface"><bdi class="secno">4. </bdi>
                Extensions to the <code>Document</code> Interface
            </h2><a class="self-link" href="#extensions-to-the-document-interface"
                aria-label="Permalink for Section 4."></a>
        </div>

        <pre class="idl def" id="webidl-131603804"><span class="idlHeader"><a class="self-link" href="#webidl-131603804">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-document-partial-1" data-title="Document">partial interface <a data-idl="partial" data-link-type="interface" data-title="Document" class="idlID" data-dfn-for="Document" data-type="interface" href="https://dom.spec.whatwg.org/#document">Document</a> {<span data-idl="" class="idlAttribute" id="idl-def-document-onpointerlockchange" data-title="onpointerlockchange" data-dfn-for="Document">
      attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-document-onpointerlockchange" id="ref-for-dom-document-onpointerlockchange-1"><code>onpointerlockchange</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-document-onpointerlockerror" data-title="onpointerlockerror" data-dfn-for="Document">
      attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-document-onpointerlockerror" id="ref-for-dom-document-onpointerlockerror-1"><code>onpointerlockerror</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-document-exitpointerlock" data-title="exitPointerLock" data-dfn-for="Document"><span class="idlType">
      <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-document-exitpointerlock" id="ref-for-dom-document-exitpointerlock-2"><code>exitPointerLock</code></a>();</span>
    };</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-document-onpointerlockchange" data-idl="attribute"
                    data-title="onpointerlockchange" data-dfn-for="Document" data-type="EventHandler"
                    data-lt="onpointerlockchange" data-local-lt="Document.onpointerlockchange" tabindex="0"
                    aria-haspopup="dialog"><code>onpointerlockchange</code></dfn> attribute
            </dt>
            <dd>
                <p>
                    An <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">event
                        handler idl attribute</a> for
                    <a data-link-type="idl" href="#dfn-pointerlockchange" class="internalDFN"
                        id="ref-for-dfn-pointerlockchange-5"><code>pointerlockchange</code></a> events.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-document-onpointerlockerror" data-idl="attribute"
                    data-title="onpointerlockerror" data-dfn-for="Document" data-type="EventHandler"
                    data-lt="onpointerlockerror" data-local-lt="Document.onpointerlockerror" tabindex="0"
                    aria-haspopup="dialog"><code>onpointerlockerror</code></dfn> attribute
            </dt>
            <dd>
                <p>
                    An <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">event
                        handler idl attribute</a> for
                    <a data-link-type="idl" href="#dfn-pointerlockerror" class="internalDFN"
                        id="ref-for-dfn-pointerlockerror-7"><code>pointerlockerror</code></a> events.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-document-exitpointerlock" data-idl="operation"
                    data-title="exitPointerLock()" data-dfn-for="Document" data-type="undefined"
                    data-lt="exitPointerLock()"
                    data-local-lt="Document.exitPointerLock|Document.exitPointerLock()|exitPointerLock" tabindex="0"
                    aria-haspopup="dialog"><code>exitPointerLock()</code></dfn> method
            </dt>
            <dd>
                <ol>
                    <li>If the user agent's pointer-lock target is null, then return.
                    </li>
                    <li>If <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                            id="ref-for-dfn-pointer-lock-target-9">pointer-lock target</a>'s <a
                            data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                            root</a>is not
                        equal to <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a data-link-type="dfn|abstract-op"
                            data-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>,
                        return.
                    </li>
                    <li><a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                            id="ref-for-dfn-exit-pointer-lock-1">Exit pointer lock</a> with the user agent's <a
                            data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                            id="ref-for-dfn-pointer-lock-target-10">pointer-lock target</a>.
                    </li>
                </ol>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="DocumentOrShadowRoot" id="extensions-to-the-documentorshadowroot-mixin">
        <div class="header-wrapper">
            <h2 id="x5-extensions-to-the-documentorshadowroot-mixin"><bdi class="secno">5. </bdi>
                Extensions to the <code>DocumentOrShadowRoot</code> Mixin
            </h2><a class="self-link" href="#extensions-to-the-documentorshadowroot-mixin"
                aria-label="Permalink for Section 5."></a>
        </div>

        <pre class="idl def" id="webidl-748339506"><span class="idlHeader"><a class="self-link" href="#webidl-748339506">WebIDL</a></span><code><span data-idl="" class="idlInterface mixin" id="idl-def-documentorshadowroot-partial-1" data-title="DocumentOrShadowRoot">partial interface mixin <a data-idl="partial" data-link-type="interface" data-title="DocumentOrShadowRoot" class="idlID" data-dfn-for="DocumentOrShadowRoot" data-type="interface" href="https://dom.spec.whatwg.org/#documentorshadowroot">DocumentOrShadowRoot</a> {<span data-idl="" class="idlAttribute" id="idl-def-documentorshadowroot-pointerlockelement" data-title="pointerLockElement" data-dfn-for="DocumentOrShadowRoot">
      readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://dom.spec.whatwg.org/#element">Element</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-documentorshadowroot-pointerlockelement" id="ref-for-dom-documentorshadowroot-pointerlockelement-1"><code>pointerLockElement</code></a>;</span>
    };</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-documentorshadowroot-pointerlockelement"
                    data-idl="attribute" data-title="pointerLockElement" data-dfn-for="DocumentOrShadowRoot"
                    data-type="Element" data-lt="pointerLockElement"
                    data-local-lt="DocumentOrShadowRoot.pointerLockElement" tabindex="0"
                    aria-haspopup="dialog"><code>pointerLockElement</code></dfn>
            </dt>
            <dd>
                <p>
                    While the pointer is locked, returns the result of <a data-link-type="dfn|abstract-op"
                        data-type="dfn" href="https://dom.spec.whatwg.org/#retarget">retargeting</a>
                    the element, which is the target for mouse events, against <a data-link-type="dfn|abstract-op"
                        data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>
                    element if the result and <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> element are in the same tree,
                    otherwise returns null.
                </p>
                <p>
                    Returns null if lock is pending or if pointer is unlocked.
                </p>
                <div class="example" id="example-retarget-pointerlock">
                    <div class="marker">
                        <a class="self-link" href="#example-retarget-pointerlock">Example<bdi> 2</bdi></a>
                    </div>
                    <pre aria-busy="false"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"host1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">shadow-root</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">shadow-root</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"host2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">shadow-root</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">shadow-root</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre>
                </div>
                <div class="note" role="note" id="issue-container-generatedID-3">
                    <div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>Note</span></div>
                    <p class="">
                        The example uses fictional <code>shadow-root</code> element to denote a
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-element-shadow-root">shadow root</a> instance.
                    </p>
                </div>
                <p>
                    If <code>#canvas1</code> is the target, <code>document.pointerLockElement</code> returns
                    <code>#host1</code>, and <code>root1.pointerLockElement</code> returns <code>#canvas1</code>. The
                    result of <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#retarget">retargeting</a> <code>#canvas1</code> against
                    <code>#root2</code> is <code>#host1</code>,
                    but as <code>#host1</code> is not in the same tree as <code>#root2</code>, null will be
                    returned for <code>root2.pointerLockElement</code>.
                </p>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="MouseEvent" data-link-for="MouseEvent" data-cite="WEBIDL ui-events"
        id="extensions-to-the-mouseevent-interface">
        <div class="header-wrapper">
            <h2 id="x6-extensions-to-the-mouseevent-interface"><bdi class="secno">6. </bdi>
                Extensions to the <code>MouseEvent</code> Interface
            </h2><a class="self-link" href="#extensions-to-the-mouseevent-interface"
                aria-label="Permalink for Section 6."></a>
        </div>

        <pre class="idl def" id="webidl-1698756137"><span class="idlHeader"><a class="self-link" href="#webidl-1698756137">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-mouseevent-partial-1" data-title="MouseEvent">partial interface <a data-idl="partial" data-link-type="interface" data-title="MouseEvent" class="idlID" data-dfn-for="MouseEvent" data-type="interface" href="https://www.w3.org/TR/uievents/#mouseevent">MouseEvent</a> {<span data-idl="" class="idlAttribute" id="idl-def-mouseevent-movementx" data-title="movementX" data-dfn-for="MouseEvent">
      readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-mouseevent-movementx" id="ref-for-dom-mouseevent-movementx-1"><code>movementX</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mouseevent-movementy" data-title="movementY" data-dfn-for="MouseEvent">
      readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-mouseevent-movementy" id="ref-for-dom-mouseevent-movementy-1"><code>movementY</code></a>;</span>
    };</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-mouseevent-movementx" data-idl="attribute"
                    data-title="movementX" data-dfn-for="MouseEvent" data-type="double" data-lt="movementX"
                    data-local-lt="MouseEvent.movementX" tabindex="0"
                    aria-haspopup="dialog"><code>movementX</code></dfn> attribute
            </dt>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-mouseevent-movementy" data-idl="attribute"
                    data-title="movementY" data-dfn-for="MouseEvent" data-type="double" data-lt="movementY"
                    data-local-lt="MouseEvent.movementY" tabindex="0"
                    aria-haspopup="dialog"><code>movementY</code></dfn> attribute
            </dt>
            <dd>
                <p>
                    The attributes <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx"
                        class="internalDFN" id="ref-for-dom-mouseevent-movementx-2"><code>movementX</code></a> and <a
                        data-link-type="idl" data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-2"><code>movementY</code></a> must provide the
                    change in position of the pointer, as if the values of <code>screenX</code>,
                    <code>screenY</code>, were stored between two subsequent <code>mousemove</code> events
                    <code>eNow</code> and <code>ePrevious</code> and the difference taken <code>movementX =
                eNow.screenX - ePrevious.screenX</code>.
                </p>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-3"><code>movementX</code></a> and <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-3"><code>movementY</code></a> must be zero for all mouse
                    events
                    except <code>mousemove</code>. All motion data must be delivered via
                    <code>mousemove</code> events such that between any two mouse events
                    <code>earlierEvent</code> and <code>currentEvent</code> the value of
                    <code>currentEvent.screenX - earlierEvent.screenX</code> is equivalent to the
                    sum of all <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx"
                        class="internalDFN" id="ref-for-dom-mouseevent-movementx-4"><code>movementX</code></a> in the
                    events after <code>earlierEvent</code>, with
                    the exception of when screenX can not be updated because the
                    pointer is clipped by the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent"
                        class="internalDFN" id="ref-for-dfn-user-agent-2">user agent</a> screen boundaries.
                </p>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-5"><code>movementX</code></a> and <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-4"><code>movementY</code></a> must be updated regardless of
                    pointer lock state.
                </p>
                <p>
                    When unlocked, the system cursor can exit and re-enter the <a data-link-type="dfn|abstract-op"
                        href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-3">user agent</a> window.
                    If it does so and the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                        id="ref-for-dfn-user-agent-4">user agent</a> was not the
                    target of operating system mouse move events then the most recent
                    pointer position will be unknown to the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent"
                        class="internalDFN" id="ref-for-dfn-user-agent-5">user agent</a> and
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-6"><code>movementX</code></a> / <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-5"><code>movementY</code></a> can not be computed and must
                    be set
                    to zero.
                </p>
                <p>
                    When pointer lock is enabled <code>clientX</code>, <code>clientY</code>, <code>screenX</code>, and
                    <code>screenY</code> must hold constant values as if the pointer did not move
                    at all once pointer lock was entered. But <a data-link-type="idl" data-lt="movementX"
                        href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-7"><code>movementX</code></a> and
                    <a data-link-type="idl" data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-6"><code>movementY</code></a> must continue to provide the
                    change in position of
                    the pointer as when the pointer is unlocked. There will be no limit
                    to <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-8"><code>movementX</code></a> and <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-7"><code>movementY</code></a> values if the mouse is
                    continuously moved in a single direction. The concept of the mouse
                    cursor will have been removed, and it will not move off the window
                    or be clamped by a screen edge.
                </p>
                <p>
                    The un-initialized value of <a data-link-type="idl" data-lt="movementX"
                        href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-9"><code>movementX</code></a> and <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-8"><code>movementY</code></a> must be
                    <code>0</code>.
                </p>
                <p>
                    Large movement values must not appear in situations when mouse
                    input is interupted, such as the mouse cursor leaving the window
                    and then re-entering at another location. If a <a data-link-type="dfn|abstract-op"
                        href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-6">user agent</a>
                    experiences a gap in receiving mouse input data from the operating
                    system then the next generated <code>mousemove</code> event must have
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-10"><code>movementX</code></a> and <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-9"><code>movementY</code></a> set to <code>0</code>. These
                    gaps may appear
                    for example when the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                        id="ref-for-dfn-user-agent-7">user agent</a> receives a mouse leaving event
                    at the window system API. As an exception mouse capture may allow
                    the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                        id="ref-for-dfn-user-agent-8">user agent</a> to continue receiving mouse events when the
                    cursor moves outside the window.
                </p>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="MouseEventInit" data-link-for="MouseEventInit" data-cite="WEBIDL ui-events"
        id="extensions-to-the-mouseeventinit-dictionary">
        <div class="header-wrapper">
            <h2 id="x7-extensions-to-the-mouseeventinit-dictionary"><bdi class="secno">7. </bdi>
                Extensions to the <code>MouseEventInit</code> Dictionary
            </h2><a class="self-link" href="#extensions-to-the-mouseeventinit-dictionary"
                aria-label="Permalink for Section 7."></a>
        </div>

        <pre class="idl def" id="webidl-788447252"><span class="idlHeader"><a class="self-link" href="#webidl-788447252">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-mouseeventinit-partial-1" data-title="MouseEventInit">partial dictionary <a data-idl="partial" data-link-type="dictionary" data-title="MouseEventInit" class="idlID" data-dfn-for="MouseEventInit" data-type="dictionary" href="https://www.w3.org/TR/uievents/#dictdef-mouseeventinit">MouseEventInit</a> {<span data-idl="" class="idlMember" id="idl-def-mouseeventinit-movementx" data-title="movementX" data-dfn-for="MouseEventInit"><span class="idlType">
      <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-mouseeventinit-movementx" id="ref-for-dom-mouseeventinit-movementx-1"><code>movementX</code></a> = 0;</span><span data-idl="" class="idlMember" id="idl-def-mouseeventinit-movementy" data-title="movementY" data-dfn-for="MouseEventInit"><span class="idlType">
      <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-mouseeventinit-movementy" id="ref-for-dom-mouseeventinit-movementy-1"><code>movementY</code></a> = 0;</span>
    };</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="dict-member" id="dom-mouseeventinit-movementx" data-idl="field"
                    data-title="movementX" data-dfn-for="MouseEventInit" data-type="double" tabindex="0"
                    aria-haspopup="dialog"><code>movementX</code></dfn> member
            </dt>
            <dt>
                <dfn data-export="" data-dfn-type="dict-member" id="dom-mouseeventinit-movementy" data-idl="field"
                    data-title="movementY" data-dfn-for="MouseEventInit" data-type="double" tabindex="0"
                    aria-haspopup="dialog"><code>movementY</code></dfn> member
            </dt>
            <dd>
                The members <a data-link-type="idl" data-lt="movementX" href="#dom-mouseeventinit-movementx"
                    class="internalDFN" id="ref-for-dom-mouseeventinit-movementx-2"><code>movementX</code></a> and <a
                    data-link-type="idl" data-lt="movementY" href="#dom-mouseeventinit-movementy" class="internalDFN"
                    id="ref-for-dom-mouseeventinit-movementy-2"><code>movementY</code></a> are used to initialize
                respective members of <a data-link-type="idl" data-lt="MouseEvent" data-type="interface"
                    href="https://www.w3.org/TR/uievents/#mouseevent"><code>MouseEvent</code></a>.
            </dd>
        </dl>
    </section>
    <section id="requirements">
        <div class="header-wrapper">
            <h2 id="x8-requirements"><bdi class="secno">8. </bdi>
                Requirements
            </h2><a class="self-link" href="#requirements" aria-label="Permalink for Section 8."></a>
        </div>

        <p>
            A <dfn id="dfn-default-unlock-gesture" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">default
                unlock gesture</dfn> must always be available that will
            <a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                id="ref-for-dfn-exit-pointer-lock-2">exit pointer lock</a> with the <a data-link-type="dfn|abstract-op"
                href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-9">user agent</a>'s <a
                data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                id="ref-for-dfn-pointer-lock-target-11">pointer-lock target</a>.
        </p>
        <div class="note" role="note" id="issue-container-generatedID-4">
            <div role="heading" class="note-title marker" id="h-note-4" aria-level="3"><span>Note</span></div>
            <aside class="">
                <p>
                    The ESC key is the recommended <a data-link-type="dfn|abstract-op"
                        href="#dfn-default-unlock-gesture" class="internalDFN"
                        id="ref-for-dfn-default-unlock-gesture-2">default unlock gesture</a> for <a
                        data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                        id="ref-for-dfn-user-agent-10">user agents</a> with keyboard input. It is recommended that the
                    unlock
                    gesture also match any used to exit fullscreen [<cite><a class="bibref" data-link-type="biblio"
                            href="#bib-fullscreen" title="Fullscreen API Standard">FULLSCREEN</a></cite>].
                </p>
            </aside>
        </div>
        <p>
            Pointer lock must be exited if the <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                class="internalDFN" id="ref-for-dfn-pointer-lock-target-12">pointer-lock target</a> <a
                data-lt="become disconnected" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-disconnected">becomes
                disconnected</a>, or the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-11">user agent</a>,
            window, or tab loses focus. Moving focus between elements of
            <a data-link-type="dfn|abstract-op" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">active document</a>,
            including between <a data-link-type="dfn|abstract-op" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">browsing
                contexts</a> , does not <a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock"
                class="internalDFN" id="ref-for-dfn-exit-pointer-lock-3">exit pointer lock</a>. E.g. using the keyboard
            to
            move focus between contents of frames or iframes will not exit.
        </p>
        <p>
            Pointer lock must not be exited when fullscreen [<cite><a class="bibref" data-link-type="biblio"
                    href="#bib-fullscreen" title="Fullscreen API Standard">FULLSCREEN</a></cite>] is
            entered or exited unless the pointer is required to enable interaction
            with the <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-12">user agent</a> graphical user interface, the <a
                data-link-type="dfn|abstract-op" href="#dfn-default-unlock-gesture" class="internalDFN"
                id="ref-for-dfn-default-unlock-gesture-3">default unlock gesture</a> was used to exit both fullscreen
            and pointer lock, or window
            or tab focus was lost.
        </p>
    </section>
    <section class="informative" id="use-cases">
        <div class="header-wrapper">
            <h2 id="x9-use-cases"><bdi class="secno">9. </bdi>
                Use Cases
            </h2><a class="self-link" href="#use-cases" aria-label="Permalink for Section 9."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <section id="relative-view-port-rotation-of-free-moving-virtual-actors">
            <div class="header-wrapper">
                <h3 id="x9-1-relative-view-port-rotation-of-free-moving-virtual-actors"><bdi class="secno">9.1 </bdi>
                    Relative view-port rotation of free moving virtual actors
                </h3><a class="self-link" href="#relative-view-port-rotation-of-free-moving-virtual-actors"
                    aria-label="Permalink for Section 9.1"></a>
            </div>

            <p>
                A player on a first/third person game will need to control the
                view-port orientation. A widely used method is the use of mouse
                movements to control the viewing angle. This kind of application can
                use the Pointer Lock API to allow a complete freedom of control over
                the viewport's yaw and pitch even when the user is not pressing mouse
                buttons. Those buttons can be used for other actions while constantly
                providing navigation via mouse movement.
            </p>
        </section>
        <section id="free-rotation-of-3d-models-or-panning-of-2d-layers">
            <div class="header-wrapper">
                <h3 id="x9-2-free-rotation-of-3d-models-or-panning-of-2d-layers"><bdi class="secno">9.2 </bdi>
                    Free rotation of 3D models or panning of 2D layers
                </h3><a class="self-link" href="#free-rotation-of-3d-models-or-panning-of-2d-layers"
                    aria-label="Permalink for Section 9.2"></a>
            </div>

            <p>
                Users of a three dimensional modeling application will need to rotate
                models. A application can use the Pointer Lock API to enable the
                author to rotate the model freely in a drag operation without
                limiting motion. Without pointer lock a drag would stop providing
                motion data when the mouse cursor is limited by the edge of the
                screen.
            </p>
            <p>
                Similarly, absolute motion panning of a large two dimensional image
                could be permitted in a single drag operation without cursor / screen
                limits.
            </p>
        </section>
        <section id="relative-movement-of-actors">
            <div class="header-wrapper">
                <h3 id="x9-3-relative-movement-of-actors"><bdi class="secno">9.3 </bdi>
                    Relative movement of actors
                </h3><a class="self-link" href="#relative-movement-of-actors"
                    aria-label="Permalink for Section 9.3"></a>
            </div>

            <p>
                A player on a fast reflexes game controls a paddle to bounce back a
                ball to the opponent, while allowing the same paddle to execute
                actions based on different mouse buttons being pressed. The
                application can use the Pointer Lock API to allow the player to react
                quickly without being concerned about the mouse cursor leaving the
                game play area and clicking another system application, thus breaking
                the game flow.
            </p>
        </section>
        <section id="jog-movement-over-spinner-controls">
            <div class="header-wrapper">
                <h3 id="x9-4-jog-movement-over-spinner-controls"><bdi class="secno">9.4 </bdi>
                    Jog movement over spinner controls
                </h3><a class="self-link" href="#jog-movement-over-spinner-controls"
                    aria-label="Permalink for Section 9.4"></a>
            </div>

            <p>
                When modifying numerically magnitudes in applications sometimes the
                user will prefer to "drag" a numeric control by its button handles to
                increment or decrement the numeric value. E.g. a spinner with a
                number entry text box and arrows pointing up and down that can be
                clicked or dragged on to change the value. An application could use
                the Pointer Lock API to allow modifying the numeric values beyond
                what the logical screen bounds allow. The same could apply for a
                control that fast forwards or rewinds a video or audio stream like a
                "jog".
            </p>
        </section>
        <section id="synthetic-cursor-interaction-with-html-dom-ui">
            <div class="header-wrapper">
                <h3 id="x9-5-synthetic-cursor-interaction-with-html-dom-ui"><bdi class="secno">9.5 </bdi>
                    Synthetic cursor interaction with HTML DOM UI
                </h3><a class="self-link" href="#synthetic-cursor-interaction-with-html-dom-ui"
                    aria-label="Permalink for Section 9.5"></a>
            </div>

            <p>
                Some games use a classical cursor, however they want it to be limited
                or controlled in some manner. E.g. limited to the bounds of the game,
                or movable by the game. Locking the pointer enables this if the
                application creates their own cursor. However HTML and DOM should
                still be available to use for user interface. Synthetic mouse events
                should be permitted to allow an application defined cursor to
                interact with DOM. E.g. the following code should permit a custom
                cursor to send click events while the pointer is locked:
            </p>
            <div class="example" id="example-3">
                <div class="marker">
                    <a class="self-link" href="#example-3">Example<bdi> 3</bdi></a>
                </div>
                <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (e._isSynthetic)
        <span class="hljs-keyword">return</span>;
      <span class="hljs-comment">// send a synthetic click</span>
      <span class="hljs-keyword">var</span> ee = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"MouseEvents"</span>);
      ee._isSynthetic = <span class="hljs-literal">true</span>;
      x = myCursor.x;
      y = myCursor.y;
      ee.initMouseEvent(<span class="hljs-string">"click"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">1</span>,
                        x + e.screenX - e.clientX,
                        y + e.screenY - e.clientY,
                        x,
                        y);
      <span class="hljs-keyword">var</span> target = <span class="hljs-built_in">document</span>.elementFromPoint(x, y);
      <span class="hljs-keyword">if</span> (target)
        target.dispatchEvent(ee);
    });</code></pre>
            </div>
            <p>
                Note that synthetic clicks may not be permitted by a <a data-link-type="dfn|abstract-op"
                    href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-13">user agent</a>
                to produce the same default action as a non-synthetic click. However,
                application handlers can still take action and provide user interface
                with existing HTML &amp; DOM mechanisms.
            </p>
        </section>
        <section id="view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port">
            <div class="header-wrapper">
                <h3 id="x9-6-view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"><bdi
                        class="secno">9.6 </bdi>
                    View-port panning by moving a mouse cursor against the bounds of a
                    view-port.
                </h3><a class="self-link"
                    href="#view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"
                    aria-label="Permalink for Section 9.6"></a>
            </div>

            <p>
                Real Time Strategy games often use this technique. When the player
                moves the pointer to the view-port borders, if they "push" the border
                with a mouse movement, the view-port is panned over the game area
                according to how much they move the mouse. When moving the mouse
                cursor within the bounds of the view port it acts at is typically
                would on a system. Applications may choose to implement this using
                pointer lock and the previous use case of "Synthetic cursor
                interaction with HTML DOM UI" to bring cursor behavior completely
                under their control.
            </p>
        </section>
        <section id="game-lobby-timer-based-pointer-lock">
            <div class="header-wrapper">
                <h3 id="x9-7-game-lobby-timer-based-pointer-lock"><bdi class="secno">9.7 </bdi>
                    Game Lobby, timer based pointer lock
                </h3><a class="self-link" href="#game-lobby-timer-based-pointer-lock"
                    aria-label="Permalink for Section 9.7"></a>
            </div>

            <p>
                Games that use pointer lock may desire a traditional UI and system
                cursor while players prepare in a game lobby. Games usually start
                after a short timer when all players are ready. Ideally the game
                could then switch to pointer lock mode without a <a data-link-type="dfn|abstract-op" data-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/interaction.html#tracking-user-activation">user
                    activation</a>.
                Players should be able to seamlessly move from the game lobby into
                game navigation.
            </p>
        </section>
        <section id="game-portal">
            <div class="header-wrapper">
                <h3 id="x9-8-game-portal"><bdi class="secno">9.8 </bdi>
                    Game Portal
                </h3><a class="self-link" href="#game-portal" aria-label="Permalink for Section 9.8"></a>
            </div>

            <p>
                Game portals, and other sites such as Facebook and Google Plus, host
                games for users to play. These games may be hosted and served from a
                different origin from that of the portal site. Embedded games should
                be able to lock the pointer, even in non-full screen mode.
            </p>
        </section>
    </section>
    <section class="informative" id="security">
        <div class="header-wrapper">
            <h2 id="x10-security"><bdi class="secno">10. </bdi>
                Security
            </h2><a class="self-link" href="#security" aria-label="Permalink for Section 10."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>
            Security Concerns:
        </p>
        <ul>
            <li>User actions may be misdirected to elements the user did not intend
                to interact with.
            </li>
            <li>Pointer Lock will remove the ability of a user to interact with <a data-link-type="dfn|abstract-op"
                    href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-14">user agent</a> and
                operating system controls
            </li>
            <li>Pointer Lock can be called repeated by script after user exits
                pointer lock, blocking user from meaningful progress.
            </li>
            <li>Full screen exit instructions are displayed in some <a data-link-type="dfn|abstract-op"
                    href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-15">user agent</a>s
                when the pointer is moved to the top of the screen. During pointer lock
                that gesture is not possible.
            </li>
        </ul>
        <p>
            Responses:
        </p>
        <ul>
            <li>The <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-16">user agents</a> may limit what security origins may lock the
                pointer.
            </li>
            <li>The <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-17">user agents</a> may prompt for confirmation before locking,
                this preference may be saved as a content setting.
            </li>
            <li>Escape will always be provided by a <a data-link-type="dfn|abstract-op"
                    href="#dfn-default-unlock-gesture" class="internalDFN"
                    id="ref-for-dfn-default-unlock-gesture-4">default unlock gesture</a>,
                e.g. Esc key.
            </li>
            <li>Persistent display of escape instructions can be provided.
            </li>
            <li>Repeated escapes of pointer lock can signal <a data-link-type="dfn|abstract-op" href="#dfn-user-agent"
                    class="internalDFN" id="ref-for-dfn-user-agent-18">user agent</a> to not
                re-lock the pointer without more specific user action, e.g. similar to
                how Chrome suppresses repeated alert() calls.
            </li>
            <li>Changing to new tabs, windows, or any other action that causes a
                page to lose focus will <a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock"
                    class="internalDFN" id="ref-for-dfn-exit-pointer-lock-4">exit pointer lock</a> with the <a
                    data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-19">user agent</a>'s
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-13">pointer-lock target</a>.
            </li>
            <li>Pointer lock can only be engaged when the window is in focus in the
                <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-20">user agent</a> and operating system.
            </li>
        </ul>
        <p>
            Recommendations:
        </p>
        <ul>
            <li>Esc key should <a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                    id="ref-for-dfn-exit-pointer-lock-5">exit pointer lock</a> with the user agent's
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-14">pointer-lock target</a>.
            </li>
            <li>Preferences per sub-domain can be used to allow or block pointer
                lock, similar to pop-up, geolocation, and fullscreen.
            </li>
        </ul>
        <p>
            Pointer lock is a required user interaction mode for certain
            application types, but carries a usability concern if maliciously used.
            An attacker could remove the ability for a user to control their mouse
            cursor on their system. <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-21">user agents</a> will prevent this by always
            providing a mechanism to <a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock"
                class="internalDFN" id="ref-for-dfn-exit-pointer-lock-6">exit pointer lock</a>, by informing the user
            of how, and by limiting how pointer lock can be entered.
        </p>
        <p>
            <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-22">user agents</a> will determine their own appropriate policies, which
            may be specialized per device or differ based on user options.
        </p>
    </section>
    <section class="informative" id="frequently-asked-questions">
        <div class="header-wrapper">
            <h2 id="x11-frequently-asked-questions"><bdi class="secno">11. </bdi>
                Frequently Asked Questions
            </h2><a class="self-link" href="#frequently-asked-questions" aria-label="Permalink for Section 11."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <section id="why-not-merge-with-mouse-capture-setcapture">
            <div class="header-wrapper">
                <h3 id="x11-1-why-not-merge-with-mouse-capture-setcapture"><bdi class="secno">11.1 </bdi>
                    Why not merge with Mouse Capture: setCapture()?
                </h3><a class="self-link" href="#why-not-merge-with-mouse-capture-setcapture"
                    aria-label="Permalink for Section 11.1"></a>
            </div>

            <p>
                Mouse Capture [<cite><a class="bibref" data-link-type="biblio" href="#bib-mdn-setcapture"
                        title="Element.setCapture()">MDN-SETCAPTURE</a></cite>] handles low security risk mouse
                event target lock for the duration of a mouse drag gesture. Pointer
                lock removes the concept of the cursor and directs all events to a
                given target. They are related, but different.
            </p>
            <p>
                If a browser implemented both, it would be reasonable to support a
                combination of traits: The security simplicity of "automatically
                release lock when mouse up" and the increased functionality of total
                control over mouse input and removal of the system cursor. The
                security trait would allow more permissive use of the feature for
                applications that only required a short burst of pointer lock during
                a drag event.
            </p>
            <p>
                This functionality is omitted from the initial version of this spec
                because it helps the minor use cases in windowed mode but we still do
                not have an implementation solving the major ones. And, to implement
                this a browser must implement both, which none does yet. It is not
                clear if this feature should live on .lock or on .setCapture. If both
                were implemented, either API could be augmented fairly easily to
                offer the hybrid functionality.
            </p>
        </section>
        <section id="why-not-repurpose-mouseevent-s-clientx-y-screenx-y">
            <div class="header-wrapper">
                <h3 id="x11-2-why-not-repurpose-mouseevent-s-clientx-y-screenx-y"><bdi class="secno">11.2 </bdi>
                    Why not repurpose MouseEvent's .clientX/Y .screenX/Y?
                </h3><a class="self-link" href="#why-not-repurpose-mouseevent-s-clientx-y-screenx-y"
                    aria-label="Permalink for Section 11.2"></a>
            </div>

            <p>
                Even in non locked state, the delta values of mouse movement are
                useful. Changing the meaning of .client or .screen based on lock
                state would also cause easy errors in code not carefully monitoring
                the lock state.
            </p>
        </section>
        <section id="why-use-movementx-y-instead-of-deltax-y">
            <div class="header-wrapper">
                <h3 id="x11-3-why-use-movementx-y-instead-of-deltax-y"><bdi class="secno">11.3 </bdi>
                    Why use .movementX/Y instead of .deltaX/Y?
                </h3><a class="self-link" href="#why-use-movementx-y-instead-of-deltax-y"
                    aria-label="Permalink for Section 11.3"></a>
            </div>

            <p>
                When the pointer is locked 'wheel' events should be sent to the
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-15">pointer-lock target</a> element just as 'mousemove' events
                are. There
                is a naming conflict with .deltaX/Y/Z as defined in <a
                    href="https://w3c.github.io/uievents/#events-wheelevents">DOM 3 'wheel'
                    event</a>.
            </p>
        </section>
        <section id="why-bundle">
            <div class="header-wrapper">
                <h3
                    id="x11-4-why-bundle-all-functionality-hiding-cursor-providing-mouse-deltas-instead-of-using-css-to-hide-the-cursor-always-providing-delta-values-and-offering-an-api-to-restrict-the-cursor-movement-to-a-portion-of-the-web-page">
                    <bdi class="secno">11.4 </bdi>
                    Why bundle all functionality (hiding cursor, providing mouse deltas)
                    instead of using CSS to hide the cursor, always providing delta
                    values, and offering an API to restrict the cursor movement to a
                    portion of the web page?
                </h3><a class="self-link" href="#why-bundle" aria-label="Permalink for Section 11.4"></a>
            </div>

            <p>
                There are good motivations to provide a more fine grained approach.
                E.g. the use case "View-port panning by moving a mouse cursor against
                the bounds of a view-port" doesn't require hiding the mouse cursor,
                only bounding it and always having delta values available. Also, this
                specification defines the movement deltas to be taken from how the
                system mouse cursor moves, which incorporates operating system
                filtering and acceleration of the mouse movement data. Applications
                may desire access to a more raw form of movement data prior to
                adjustments appropriate for a mouse cursor. Also, raw data may
                provide better than pixel level accuracy for movement, as well as
                higher frequency updates. Providing the raw delta movement would also
                not require special permission or mode from a user, and for some set
                of applications that do not require bounding the cursor may reduce
                the security barriers and prompts needed.
            </p>
            <p>
                There are two justifications for postponing this finer grained
                approach. The first is a concern of specifying what units mouse
                movement data are provided in. This specification defines
                .movementX/Y precisely as the same values that could be recorded when
                the mouse is not under lock by changes in .screenX/Y. Implementations
                across multiple <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-23">user agents</a> and operating systems will easily be
                able to meet that requirement and provide application developers and
                users with a consistent experience. Further, users are expected to
                have already configured the full system of hardware input and
                operating system options resulting in a comfortable control the
                system mouse cursor. By specifying .movementX/Y in the same units
                mouse lock API applications will be instantly usable to all users
                because they have already settled their preferences.
            </p>
            <p>
                Secondly, the implementation of providing movement data and bounding
                the mouse cursor is more difficult in the fine grained approach.
                Bundling the features together gives implementations freedom to use a
                variety of techniques as appropriate on each operating system and is
                more practical to implement. Direct APIs do not exist on major
                desktop platforms (Windows, Mac OS X, Linux) to bound the cursor to a
                specific rectangle, and prototypes have not yet been developed to
                demonstrate building that behavior by e.g. <a
                    href="https://tronche.com/gui/x/xlib/window/attributes/">invisible
                    windows</a> with <a href="https://en.wikipedia.org/wiki/Xlib">Xlib</a> or manual cursor
                movement on Mac. Unaccelerated Delta values have been proposed to be
                accessed by reading raw Human Interface Device (HID) data. E.g.
                WM_INPUT messages on Windows, and USB device APIs on Mac OS X /
                Linux. The challenge here is interpreting and normalizing the units
                to some consistent and specifiable scale. Also, most APIs considered
                to date are limited to USB devices.
            </p>
            <p>
                It would be reasonable to consider adding these capabilities in the
                future, as the currently specified pointer lock API would be easy to
                continue to support if the finer grained delta and confinement
                features were implemented.
            </p>
            <p>
                The bundled API is selected for implementation practicality, because
                the desired use cases are supported, and because it will not conflict
                with future improvements as discussed here.
            </p>
        </section>
        <section id="high-resolution-deltas-high-frequency-updates">
            <div class="header-wrapper">
                <h3 id="x11-5-high-resolution-deltas-high-frequency-updates"><bdi class="secno">11.5 </bdi>
                    High resolution deltas / High frequency updates?
                </h3><a class="self-link" href="#high-resolution-deltas-high-frequency-updates"
                    aria-label="Permalink for Section 11.5"></a>
            </div>

            <p>
                Not yet, for the same reasons in the previous question: <a href="#why-bundle">"Why bundle all
                    functionality (hiding cursor, providing
                    mouse deltas) instead of using CSS to hide the cursor, always
                    providing delta values, and offering an API to restrict the cursor
                    movement to a portion of the web page?"</a>.
            </p>
        </section>
        <section id="why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event">
            <div class="header-wrapper">
                <h3
                    id="x11-6-why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event">
                    <bdi class="secno">11.6 </bdi>
                    Why modify MouseEvent and reuse existing mouse events instead of
                    creating a mouse delta event?
                </h3><a class="self-link"
                    href="#why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event"
                    aria-label="Permalink for Section 11.6"></a>
            </div>

            <p>
                When under pointer lock many mouse events remain relevant, e.g.
                click, mousedown, etc. These all share the same event data structure
                MouseEvent. If movement data were reported via a new data structure
                then a new event would be needed for reporting delta movement. The
                new data structure would have many parallels to MouseEvent to offer
                the same conveniences, e.g. button and modifier key states. When
                handling click, down, and up events would the existing mousedown,
                mouseup be used? If so, they would provide .clientX/Y and .screenX/Y
                with no useful data, but would lack the convenience of containing the
                current movement data. Or, new events would also be required for when
                the mouse is locked.
            </p>
            <p>
                Also, movementX/Y are convenient even when the mouse is not locked.
                This spec requires movement members to always be valid, even when the
                mouse cursor exists. This reduces code required to track the last
                cursor state and mouseover/mouseout transitions if applications wish
                to make use of delta motion of the mouse.
            </p>
            <p>
                The only negative of adding movementX/Y to MouseEvent appears to be
                the unused values in clientX/Y and screenX/Y when under pointer lock.
                This does not seem to be a significant problem.
            </p>
            <p>
                Therefore the minimal change to add movementX/Y to MouseEvent is
                selected to reduce API and implementation complexity.
            </p>
        </section>
        <section id="why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus">
            <div class="header-wrapper">
                <h3 id="x11-7-why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"><bdi
                        class="secno">11.7 </bdi>
                    Why separate targets for mouse events under pointer lock and keyboard
                    input focus?
                </h3><a class="self-link"
                    href="#why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"
                    aria-label="Permalink for Section 11.7"></a>
            </div>

            <p>
                Consider a game with a 3D view controlled by moving the mouse cursor,
                while the user may still chat with other users via a text console. It
                is reasonable for the application to accept text input to an element
                that is different than where mouse events are being dispatched. This
                is similar to pre-existing behavior of receiving mousemove events
                over any element while typing into a form on a page.
            </p>
        </section>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x12-conformance"><bdi class="secno">12. </bdi>Conformance</h2><a class="self-link"
                href="#conformance" aria-label="Permalink for Section 12."></a>
        </div>
        <p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this
            specification are non-normative. Everything else in this specification is normative.</p>
        <p>
            This specification defines conformance criteria that apply to a single
            product: the <dfn data-plurals="user agents" id="dfn-user-agent" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">user agent</dfn> that implements the interfaces that
            it contains.
        </p>
    </section>
    <section class="appendix informative" id="acknowledgments">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>
                Acknowledgments
            </h2><a class="self-link" href="#acknowledgments" aria-label="Permalink for Appendix A."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>
            Many thanks to lots of people who made contributions to the discussions
            of this specification:
        </p>
        <ul>
            <li>Adam Barth
            </li>
            <li>Alexey Proskuryakov
            </li>
            <li>Aryeh Gregor
            </li>
            <li>Boris Zbarsky
            </li>
            <li>Brandon Andrews
            </li>
            <li>Darin Fisher
            </li>
            <li>Dimitri Glazkov
            </li>
            <li>Ella Ge
            </li>
            <li>Glenn Maynard
            </li>
            <li>Gregg Tavares
            </li>
            <li>Janice Shiu
            </li>
            <li>John Villar
            </li>
            <li>Jonas Sicking
            </li>
            <li>Kagami Sascha Rosylight
            </li>
            <li>Klaas Heidstra
            </li>
            <li>LÃ©onie Watson
            </li>
            <li>Marcos CÃ¡ceres
            </li>
            <li>Ms2ger
            </li>
            <li>Mustaq Ahmed
            </li>
            <li>Navid Zolghadr
            </li>
            <li>Olli Pettay
            </li>
            <li>Patrick H. Lauke
            </li>
            <li>Philip JÃ¤genstedt
            </li>
            <li>Philippe Le Hegaret
            </li>
            <li>Robert O'Callahan
            </li>
            <li>Tab Atkins Jr.
            </li>
            <li>Takayoshi Kochi
            </li>
            <li>Timeless
            </li>
            <li>Vincent Scheib
            </li>
            <li>Xiaoqian Wu
            </li>
            <li>Yves Lafon
            </li>
        </ul>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>References</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>Normative references</h3><a
                    class="self-link" href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-fullscreen">[FULLSCREEN]</dt>
                <dd>
                    <a href="https://fullscreen.spec.whatwg.org/"><cite>Fullscreen API Standard</cite></a>. Philip
                    JÃ¤genstedt. WHATWG. Living Standard. URL: <a
                        href="https://fullscreen.spec.whatwg.org/">https://fullscreen.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Ian Hickson; Philip JÃ¤genstedt; Simon Pieters. WHATWG. Living Standard. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-ui-events">[ui-events]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/uievents/"><cite>UI Events</cite></a>. Gary Kacmarcik; Travis
                    Leithead. W3C. 21 February 2024. W3C Working Draft. URL: <a
                        href="https://www.w3.org/TR/uievents/">https://www.w3.org/TR/uievents/</a>
                </dd>
                <dt id="bib-webidl">[WEBIDL]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. Living Standard. URL: <a
                        href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>Informative references</h3><a
                    class="self-link" href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-mdn-setcapture">[MDN-SETCAPTURE]</dt>
                <dd>
                    <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture"><cite>Element.setCapture()</cite></a>.
                    Eric Shepherd; et. al. URL: <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture">https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">â†‘</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-state"
        aria-label="Links in this document to definition: pointer lock state">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-state"
                aria-label="Permalink for definition: pointer lock state. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-1" title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dfn-pointer-lock-state-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-state-3" title="Reference 3">(3)</a>
                <a href="#ref-for-dfn-pointer-lock-state-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointer-lock-state-5" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-6" title="Â§ 2.4 Exit Pointer Lock">Â§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-7" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-target"
        aria-label="Links in this document to definition: pointer-lock target">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-target"
                aria-label="Permalink for definition: pointer-lock target. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-1" title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dfn-pointer-lock-target-2"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-3" title="Â§ 2.4 Exit Pointer Lock">Â§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-4" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointer-lock-target-5"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-target-6" title="Reference 3">(3)</a>
                <a href="#ref-for-dfn-pointer-lock-target-7" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointer-lock-target-8" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-9" title="Â§ 4. Extensions to the Document Interface">Â§ 4.
                    Extensions to the Document Interface</a> <a href="#ref-for-dfn-pointer-lock-target-10"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-11" title="Â§ 8. Requirements">Â§ 8. Requirements</a> <a
                    href="#ref-for-dfn-pointer-lock-target-12" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-13" title="Â§ 10. Security">Â§ 10. Security</a> <a
                    href="#ref-for-dfn-pointer-lock-target-14" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-15"
                    title="Â§ 11.3 Why use .movementX/Y instead of .deltaX/Y?">Â§ 11.3 Why use .movementX/Y instead of
                    .deltaX/Y?</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-options"
        aria-label="Links in this document to definition: pointer-lock options">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-options"
                aria-label="Permalink for definition: pointer-lock options. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-1" title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The
                    pointer lock state definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-2" title="Â§ 2.4 Exit Pointer Lock">Â§ 2.4 Exit Pointer
                    Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-3" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointer-lock-options-4"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-options-5"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-cursor-position"
        aria-label="Links in this document to definition: cursor position">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-cursor-position"
                aria-label="Permalink for definition: cursor position. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-cursor-position-1" title="Â§ 2.4 Exit Pointer Lock">Â§ 2.4 Exit Pointer Lock</a> <a
                    href="#ref-for-dfn-cursor-position-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-cursor-position-3" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-pointerlockoptions"
        aria-label="Links in this document to definition: PointerLockOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-pointerlockoptions"
                aria-label="Permalink for definition: PointerLockOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1846476394">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-1" title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dom-pointerlockoptions-2"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-3" title="Â§ 2.2 PointerLockOptions dictionary">Â§ 2.2
                    PointerLockOptions dictionary</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-4" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dom-pointerlockoptions-5"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-pointerlockoptions-unadjustedmovement"
        aria-label="Links in this document to definition: unadjustedMovement">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-pointerlockoptions-unadjustedmovement"
                aria-label="Permalink for definition: unadjustedMovement. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1846476394">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-1"
                    title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The pointer lock state definition</a> <a
                    href="#ref-for-dom-pointerlockoptions-unadjustedmovement-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-3"
                    title="Â§ 2.2 PointerLockOptions dictionary">Â§ 2.2 PointerLockOptions dictionary</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-4"
                    title="Â§ 3. Extensions to the Element Interface">Â§ 3. Extensions to the Element Interface</a> <a
                    href="#ref-for-dom-pointerlockoptions-unadjustedmovement-5" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointerlockchange"
        aria-label="Links in this document to definition: pointerlockchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointerlockchange"
                aria-label="Permalink for definition: pointerlockchange. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-1" title="Â§ 2.3 pointerlockchange and pointerlockerror Events">Â§
                    2.3 pointerlockchange and pointerlockerror Events</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-2" title="Â§ 2.4 Exit Pointer Lock">Â§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-3" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointerlockchange-4"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-5" title="Â§ 4. Extensions to the Document Interface">Â§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointerlockerror"
        aria-label="Links in this document to definition: pointerlockerror">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointerlockerror"
                aria-label="Permalink for definition: pointerlockerror. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointerlockerror-1" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointerlockerror-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointerlockerror-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dfn-pointerlockerror-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointerlockerror-5" title="Reference 5">(5)</a> <a
                    href="#ref-for-dfn-pointerlockerror-6" title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockerror-7" title="Â§ 4. Extensions to the Document Interface">Â§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-exit-pointer-lock"
        aria-label="Links in this document to definition: Exit Pointer Lock">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-exit-pointer-lock"
                aria-label="Permalink for definition: Exit Pointer Lock. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-1" title="Â§ 4. Extensions to the Document Interface">Â§ 4.
                    Extensions to the Document Interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-2" title="Â§ 8. Requirements">Â§ 8. Requirements</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-3" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-4" title="Â§ 10. Security">Â§ 10. Security</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-5" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-6" title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-lock-requests-queue"
        aria-label="Links in this document to definition: lock requests queue">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-lock-requests-queue"
                aria-label="Permalink for definition: lock requests queue. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-lock-requests-queue-1" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-element-requestpointerlock"
        aria-label="Links in this document to definition: requestPointerLock()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-element-requestpointerlock"
                aria-label="Permalink for definition: requestPointerLock(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1328413902">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-element-requestpointerlock-1" title="Â§ 3. Extensions to the Element Interface">Â§
                    3. Extensions to the Element Interface</a> <a href="#ref-for-dom-element-requestpointerlock-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-onpointerlockchange"
        aria-label="Links in this document to definition: onpointerlockchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-onpointerlockchange"
                aria-label="Permalink for definition: onpointerlockchange. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-onpointerlockchange-1"
                    title="Â§ 4. Extensions to the Document Interface">Â§ 4. Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-onpointerlockerror"
        aria-label="Links in this document to definition: onpointerlockerror">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-onpointerlockerror"
                aria-label="Permalink for definition: onpointerlockerror. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-onpointerlockerror-1" title="Â§ 4. Extensions to the Document Interface">Â§
                    4. Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-exitpointerlock"
        aria-label="Links in this document to definition: exitPointerLock()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-exitpointerlock"
                aria-label="Permalink for definition: exitPointerLock(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-exitpointerlock-1" title="Â§ 3. Extensions to the Element Interface">Â§ 3.
                    Extensions to the Element Interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-document-exitpointerlock-2" title="Â§ 4. Extensions to the Document Interface">Â§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-documentorshadowroot-pointerlockelement"
        aria-label="Links in this document to definition: pointerLockElement">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-documentorshadowroot-pointerlockelement"
                aria-label="Permalink for definition: pointerLockElement. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-748339506">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-documentorshadowroot-pointerlockelement-1"
                    title="Â§ 5. Extensions to the DocumentOrShadowRoot Mixin">Â§ 5. Extensions to the
                    DocumentOrShadowRoot Mixin</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseevent-movementx"
        aria-label="Links in this document to definition: movementX">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseevent-movementx"
                aria-label="Permalink for definition: movementX. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1698756137">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseevent-movementx-1" title="Â§ 6. Extensions to the MouseEvent Interface">Â§ 6.
                    Extensions to the MouseEvent Interface</a> <a href="#ref-for-dom-mouseevent-movementx-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-mouseevent-movementx-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-mouseevent-movementx-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-mouseevent-movementx-5"
                    title="Reference 5">(5)</a> <a href="#ref-for-dom-mouseevent-movementx-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dom-mouseevent-movementx-7"
                    title="Reference 7">(7)</a> <a href="#ref-for-dom-mouseevent-movementx-8"
                    title="Reference 8">(8)</a> <a href="#ref-for-dom-mouseevent-movementx-9"
                    title="Reference 9">(9)</a> <a href="#ref-for-dom-mouseevent-movementx-10"
                    title="Reference 10">(10)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseevent-movementy"
        aria-label="Links in this document to definition: movementY">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseevent-movementy"
                aria-label="Permalink for definition: movementY. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1698756137">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseevent-movementy-1" title="Â§ 6. Extensions to the MouseEvent Interface">Â§ 6.
                    Extensions to the MouseEvent Interface</a> <a href="#ref-for-dom-mouseevent-movementy-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-mouseevent-movementy-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-mouseevent-movementy-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-mouseevent-movementy-5"
                    title="Reference 5">(5)</a> <a href="#ref-for-dom-mouseevent-movementy-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dom-mouseevent-movementy-7"
                    title="Reference 7">(7)</a> <a href="#ref-for-dom-mouseevent-movementy-8"
                    title="Reference 8">(8)</a> <a href="#ref-for-dom-mouseevent-movementy-9"
                    title="Reference 9">(9)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseeventinit-movementx"
        aria-label="Links in this document to definition: movementX">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseeventinit-movementx"
                aria-label="Permalink for definition: movementX. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-788447252">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseeventinit-movementx-1"
                    title="Â§ 7. Extensions to the MouseEventInit Dictionary">Â§ 7. Extensions to the MouseEventInit
                    Dictionary</a> <a href="#ref-for-dom-mouseeventinit-movementx-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseeventinit-movementy"
        aria-label="Links in this document to definition: movementY">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseeventinit-movementy"
                aria-label="Permalink for definition: movementY. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-788447252">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseeventinit-movementy-1"
                    title="Â§ 7. Extensions to the MouseEventInit Dictionary">Â§ 7. Extensions to the MouseEventInit
                    Dictionary</a> <a href="#ref-for-dom-mouseeventinit-movementy-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-default-unlock-gesture"
        aria-label="Links in this document to definition: default unlock gesture">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-default-unlock-gesture"
                aria-label="Permalink for definition: default unlock gesture. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-1" title="Â§ 1. Introduction">Â§ 1. Introduction</a>
            </li>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-2" title="Â§ 8. Requirements">Â§ 8. Requirements</a> <a
                    href="#ref-for-dfn-default-unlock-gesture-3" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-4" title="Â§ 10. Security">Â§ 10. Security</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-user-agent"
        aria-label="Links in this document to definition: user agent">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-user-agent"
                aria-label="Permalink for definition: user agent. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-user-agent-1" title="Â§ 2.1 The pointer lock state definition">Â§ 2.1 The pointer
                    lock state definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-2" title="Â§ 6. Extensions to the MouseEvent Interface">Â§ 6. Extensions
                    to the MouseEvent Interface</a> <a href="#ref-for-dfn-user-agent-3" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-user-agent-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-5"
                    title="Reference 4">(4)</a> <a href="#ref-for-dfn-user-agent-6" title="Reference 5">(5)</a> <a
                    href="#ref-for-dfn-user-agent-7" title="Reference 6">(6)</a> <a href="#ref-for-dfn-user-agent-8"
                    title="Reference 7">(7)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-9" title="Â§ 8. Requirements">Â§ 8. Requirements</a> <a
                    href="#ref-for-dfn-user-agent-10" title="Reference 2">(2)</a> <a href="#ref-for-dfn-user-agent-11"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-12" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-13" title="Â§ 9.5 Synthetic cursor interaction with HTML DOM UI">Â§ 9.5
                    Synthetic cursor interaction with HTML DOM UI</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-14" title="Â§ 10. Security">Â§ 10. Security</a> <a
                    href="#ref-for-dfn-user-agent-15" title="Reference 2">(2)</a> <a href="#ref-for-dfn-user-agent-16"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-17" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-user-agent-18" title="Reference 5">(5)</a> <a href="#ref-for-dfn-user-agent-19"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-user-agent-20" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-user-agent-21" title="Reference 8">(8)</a> <a href="#ref-for-dfn-user-agent-22"
                    title="Reference 9">(9)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-23"
                    title="Â§ 11.4 Why bundle all functionality (hiding cursor, providing mouse deltas) instead of using CSS to hide the cursor, always providing delta values, and offering an API to restrict the cursor movement to a portion of the web page?">Â§
                    11.4 Why bundle all functionality (hiding cursor, providing mouse deltas) instead of using CSS to
                    hide the cursor, always providing delta values, and offering an API to restrict the cursor movement
                    to a portion of the web page?</a>
            </li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
</body>

</html>