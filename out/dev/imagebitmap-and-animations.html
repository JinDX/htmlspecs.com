<!DOCTYPE html><html class=split lang=en-US-x-hixie><script src=/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML 标准，适用于网页开发者的版本</title><meta content=#3c790a name=theme-color><meta content="light dark" name=color-scheme><link rel=stylesheet href=https://resources.whatwg.org/standard-shared-with-dev.css crossorigin=""><link rel=icon href=https://resources.whatwg.org/logo.svg crossorigin=""><link rel=stylesheet href=/dev/styles.css crossorigin=""><script>
    function toggleStatus(div) {
      div.parentNode.classList.toggle('wrapped');
    }
    function setLinkFragment(link) {
      link.hash = location.hash;
    }
  </script><body>
  <script async="" src=/dev/search.js></script>
  
  
  <header id=head class="head with-buttons">
    <a href=https://whatwg.org/ class=logo><img width=100 alt=WHATWG crossorigin="" class=darkmode-aware src=https://resources.whatwg.org/logo.svg height=100></a>
    
    <hgroup><h1><a rel=home href=/dev/>HTML: 现行标准</a></h1><p id=dev-edition-h2>适用于网页开发者的版本 — 上次更新 <span class=pubdate>7 September 2024</span></hgroup>
    

    <div id=search>
      <input placeholder="搜索。按 '/' 键" autocomplete=off name=query id=query type=search>
      <ol id=results></ol>
    </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href=system-state.html>← 8.9 System state and capabilities</a> — <a href=./>Table of Contents</a> — <a href=comms.html>9 Communication →</a></nav><ol class=toc><li><ol><li><a href=imagebitmap-and-animations.html#images-2><span class=secno>8.10</span> Images</a><li><a href=imagebitmap-and-animations.html#animation-frames><span class=secno>8.11</span> Animation frames</a></ol></ol><h3 id=images-2><span class=secno>8.10</span> Images<a href=#images-2 class=self-link></a></h3>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap title="The ImageBitmap interface represents a bitmap image which can be drawn to a <canvas> without undue latency. It can be created from a variety of source objects using the createImageBitmap() factory method. ImageBitmap provides an asynchronous and resource efficient pathway to prepare textures for rendering in WebGL.">ImageBitmap</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>50+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><pre><code class=idl>[Exposed=(Window,Worker), <span>Serializable</span>, <span>Transferable</span>]
interface <dfn id=imagebitmap data-dfn-type=interface>ImageBitmap</dfn> {
  readonly attribute unsigned long <a href=#dom-imagebitmap-width id=images-2:dom-imagebitmap-width>width</a>;
  readonly attribute unsigned long <a href=#dom-imagebitmap-height id=images-2:dom-imagebitmap-height>height</a>;
  undefined <a href=#dom-imagebitmap-close id=images-2:dom-imagebitmap-close>close</a>();
};

typedef (<a id=images-2:canvasimagesource href=canvas.html#canvasimagesource>CanvasImageSource</a> or
         <a id=images-2:blob href=https://w3c.github.io/FileAPI/#dfn-Blob data-x-internal=blob>Blob</a> or
         <a id=images-2:imagedata href=canvas.html#imagedata>ImageData</a>) <dfn id=imagebitmapsource data-dfn-type=typedef>ImageBitmapSource</dfn>;

enum <dfn id=imageorientation data-dfn-type=enum>ImageOrientation</dfn> { "<span>from-image</span>", "<span>flipY</span>" };
enum <dfn id=premultiplyalpha data-dfn-type=enum>PremultiplyAlpha</dfn> { "<span>none</span>", "<span>premultiply</span>", "<span>default</span>" };
enum <dfn id=colorspaceconversion data-dfn-type=enum>ColorSpaceConversion</dfn> { "<span>none</span>", "<span>default</span>" };
enum <dfn id=resizequality data-dfn-type=enum>ResizeQuality</dfn> { "<span>pixelated</span>", "<span>low</span>", "<span>medium</span>", "<span>high</span>" };

dictionary <dfn id=imagebitmapoptions data-dfn-type=dictionary>ImageBitmapOptions</dfn> {
  <a href=#imageorientation id=images-2:imageorientation>ImageOrientation</a> <span>imageOrientation</span> = "<span>from-image</span>";
  <a href=#premultiplyalpha id=images-2:premultiplyalpha>PremultiplyAlpha</a> <span>premultiplyAlpha</span> = "<span>default</span>";
  <a href=#colorspaceconversion id=images-2:colorspaceconversion>ColorSpaceConversion</a> <span>colorSpaceConversion</span> = "<span>default</span>";
  [EnforceRange] unsigned long <span>resizeWidth</span>;
  [EnforceRange] unsigned long <span>resizeHeight</span>;
  <a href=#resizequality id=images-2:resizequality>ResizeQuality</a> <span>resizeQuality</span> = "<span>low</span>";
};</code></pre>

  <p>An <code id=images-2:imagebitmap><a href=#imagebitmap>ImageBitmap</a></code> object represents a bitmap image that can be painted to a canvas
    without undue latency.</p>

  <p class=note>The exact judgement of what is undue latency of this is left up to the
    implementer, but in general if making use of the bitmap requires network I/O, or even local disk
    I/O, then the latency is probably undue; whereas if it only requires a blocking read from a GPU or
    system RAM, the latency is probably acceptable.</p>

  <dl class=domintro><dt><code><var>promise</var> = self.<span id=dom-createimagebitmap>createImageBitmap</span>(<var>image</var> [, <var>options</var> ])</code><dt><code><var>promise</var> = self.<a href=#dom-createimagebitmap id=images-2:dom-createimagebitmap>createImageBitmap</a>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var> [, <var>options</var> ])</code><dd>
      <p>Takes <var>image</var>, which can be an <code id=images-2:the-img-element><a href=embedded-content.html#the-img-element>img</a></code> element, an <a id=images-2:svg-image href=https://svgwg.org/svg2-draft/embedded.html#ImageElement data-x-internal=svg-image>SVG
          <code>image</code></a> element, a <code id=images-2:the-video-element><a href=media.html#the-video-element>video</a></code> element, a <code id=images-2:the-canvas-element><a href=canvas.html#the-canvas-element>canvas</a></code> element,
        a <code id=images-2:blob-2><a data-x-internal=blob href=https://w3c.github.io/FileAPI/#dfn-Blob>Blob</a></code> object, an <code id=images-2:imagedata-2><a href=canvas.html#imagedata>ImageData</a></code> object, or another
        <code id=images-2:imagebitmap-2><a href=#imagebitmap>ImageBitmap</a></code> object, and returns a promise that is resolved when a new
        <code id=images-2:imagebitmap-3><a href=#imagebitmap>ImageBitmap</a></code> is created.
      </p>

      <p>If no <code id=images-2:imagebitmap-4><a href=#imagebitmap>ImageBitmap</a></code> object can be constructed, for example because the provided
        <var>image</var> data is not actually an image, then the promise is rejected instead.
      </p>

      <p>If <var>sx</var>, <var>sy</var>, <var>sw</var>, and <var>sh</var> arguments are provided, the
        source image is cropped to the given pixels, with any pixels missing in the original replaced by
        <a id=images-2:transparent-black href=https://drafts.csswg.org/css-color/#transparent-black data-x-internal=transparent-black>transparent black</a>. These coordinates are in the source image's pixel coordinate
        space, <em>not</em> in <a href=https://drafts.csswg.org/css-values/#px id="images-2:'px'" data-x-internal="'px'">CSS pixels</a>.
      </p>

      <p>If <var>options</var> is provided, the <code id=images-2:imagebitmap-5><a href=#imagebitmap>ImageBitmap</a></code> object's bitmap data is
        modified according to <var>options</var>. For example, if the <code>premultiplyAlpha</code> option is set to "<code>premultiply</code>", the <span>bitmap data</span>'s color channels are <a href=canvas.html#concept-premultiplied-alpha id=images-2:concept-premultiplied-alpha>premultiplied by its alpha channel</a>.</p>

      <p>Rejects the promise with an <a id=images-2:invalidstateerror href=https://webidl.spec.whatwg.org/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a>
        <code id=images-2:domexception><a data-x-internal=domexception href=https://webidl.spec.whatwg.org/#dfn-DOMException>DOMException</a></code> if the source image is not in a valid state (e.g., an <code id=images-2:the-img-element-2><a href=embedded-content.html#the-img-element>img</a></code>
        element that hasn't loaded successfully, an <code id=images-2:imagebitmap-6><a href=#imagebitmap>ImageBitmap</a></code> object whose
        <span>[[Detached]]</span> internal slot value is true, an <code id=images-2:imagedata-3><a href=canvas.html#imagedata>ImageData</a></code> object whose
        <code id=images-2:dom-imagedata-data><a href=canvas.html#dom-imagedata-data>data</a></code> attribute value's [[ViewedArrayBuffer]] internal
        slot is detached, or a <code id=images-2:blob-3><a data-x-internal=blob href=https://w3c.github.io/FileAPI/#dfn-Blob>Blob</a></code> whose data cannot be interpreted as a bitmap
        image).
      </p>

      <p>Rejects the promise with a <a id=images-2:securityerror href=https://webidl.spec.whatwg.org/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
        <code id=images-2:domexception-2><a data-x-internal=domexception href=https://webidl.spec.whatwg.org/#dfn-DOMException>DOMException</a></code> if the script is not allowed to access the image data of the source
        image (e.g. a <code id=images-2:the-video-element-2><a href=media.html#the-video-element>video</a></code> that is <span>CORS-cross-origin</span>, or a
        <code id=images-2:the-canvas-element-2><a href=canvas.html#the-canvas-element>canvas</a></code> being drawn on by a script in a worker from another
        <a id=images-2:concept-origin href=browsers.html#concept-origin>origin</a>).
      </p>
    <dt><code><var>imageBitmap</var>.<span id=dom-imagebitmap-close>close</span>()</code><dd>
      <p>Releases <var>imageBitmap</var>'s underlying <span>bitmap data</span>.</p>
    <dt><code><var>imageBitmap</var>.<span id=dom-imagebitmap-width>width</span></code><dd>
      <p>Returns the <a id=images-2:natural-width href=https://drafts.csswg.org/css-images/#natural-width data-x-internal=natural-width>natural width</a> of the image, in <a href=https://drafts.csswg.org/css-values/#px id="images-2:'px'-2" data-x-internal="'px'">CSS
          pixels</a>.</p>
    <dt><code><var>imageBitmap</var>.<span id=dom-imagebitmap-height>height</span></code><dd>
      <p>Returns the <a id=images-2:natural-height href=https://drafts.csswg.org/css-images/#natural-height data-x-internal=natural-height>natural height</a> of the image, in <a href=https://drafts.csswg.org/css-values/#px id="images-2:'px'-3" data-x-internal="'px'">CSS
          pixels</a>.</p>
    </dl>

  

  <div class=example>

    <p>Using this API, a sprite sheet can be precut and prepared:</p>

    <pre><code class=js>var sprites = {};
function loadMySprites() {
  var image = new Image();
  image.src = 'mysprites.png';
  var resolver;
  var promise = new Promise(function (arg) { resolver = arg });
  image.onload = function () {
    resolver(Promise.all([
      createImageBitmap(image,  0,  0, 40, 40).then(function (image) { sprites.person = image }),
      createImageBitmap(image, 40,  0, 40, 40).then(function (image) { sprites.grass  = image }),
      createImageBitmap(image, 80,  0, 40, 40).then(function (image) { sprites.tree   = image }),
      createImageBitmap(image,  0, 40, 40, 40).then(function (image) { sprites.hut    = image }),
      createImageBitmap(image, 40, 40, 40, 40).then(function (image) { sprites.apple  = image }),
      createImageBitmap(image, 80, 40, 40, 40).then(function (image) { sprites.snake  = image })
    ]));
  };
  return promise;
}

function runDemo() {
  var canvas = document.querySelector('canvas#demo');
  var context = canvas.getContext('2d');
  context.drawImage(sprites.tree, 30, 10);
  context.drawImage(sprites.snake, 70, 10);
}

loadMySprites().then(runDemo);</code></pre>

  </div>



  <h3 id=animation-frames><span class=secno>8.11</span> Animation frames<a href=#animation-frames class=self-link></a></h3>

  <p>Some objects include the <code id=animation-frames:animationframeprovider><a href=#animationframeprovider>AnimationFrameProvider</a></code> interface mixin.</p>

  <pre><code class=idl>callback <dfn id=framerequestcallback data-dfn-type=callback>FrameRequestCallback</dfn> = undefined (<a id=animation-frames:domhighrestimestamp href=https://w3c.github.io/hr-time/#dom-domhighrestimestamp data-x-internal=domhighrestimestamp>DOMHighResTimeStamp</a> time);

interface mixin <dfn id=animationframeprovider data-dfn-type=interface>AnimationFrameProvider</dfn> {
  unsigned long <a href=#dom-animationframeprovider-requestanimationframe id=animation-frames:dom-animationframeprovider-requestanimationframe>requestAnimationFrame</a>(<a href=#framerequestcallback id=animation-frames:framerequestcallback>FrameRequestCallback</a> callback);
  undefined <a href=#animationframeprovider-cancelanimationframe id=animation-frames:animationframeprovider-cancelanimationframe>cancelAnimationFrame</a>(unsigned long handle);
};
<a id=animation-frames:window href=nav-history-apis.html#window>Window</a> includes <a href=#animationframeprovider id=animation-frames:animationframeprovider-2>AnimationFrameProvider</a>;
<a id=animation-frames:dedicatedworkerglobalscope-2 href=workers.html#dedicatedworkerglobalscope-2>DedicatedWorkerGlobalScope</a> includes <a href=#animationframeprovider id=animation-frames:animationframeprovider-3>AnimationFrameProvider</a>;</code></pre>

  <p>Each <code id=animation-frames:animationframeprovider-4><a href=#animationframeprovider>AnimationFrameProvider</a></code> object also has a <dfn id=concept-animationframeprovider-target-object>target object</dfn> that stores the
    provider's internal state. It is defined as follows:</p>

  <dl><dt>If the <code id=animation-frames:animationframeprovider-5><a href=#animationframeprovider>AnimationFrameProvider</a></code> is a <code id=animation-frames:window-2><a href=nav-history-apis.html#window>Window</a></code><dd>The <code id=animation-frames:window-3><a href=nav-history-apis.html#window>Window</a></code>'s <span>associated
        <code id=animation-frames:document><a href=dom.html#document>Document</a></code></span><dt>If the <code id=animation-frames:animationframeprovider-6><a href=#animationframeprovider>AnimationFrameProvider</a></code> is a <code id=animation-frames:dedicatedworkerglobalscope-2-2><a href=workers.html#dedicatedworkerglobalscope-2>DedicatedWorkerGlobalScope</a></code><dd>The <code id=animation-frames:dedicatedworkerglobalscope-2-3><a href=workers.html#dedicatedworkerglobalscope-2>DedicatedWorkerGlobalScope</a></code></dl>

  <p>Each <a href=#concept-animationframeprovider-target-object id=animation-frames:concept-animationframeprovider-target-object>target object</a> has a
    <dfn id=list-of-animation-frame-callbacks>map of animation frame callbacks</dfn>, which is an
    <a id=animation-frames:ordered-map href=https://infra.spec.whatwg.org/#ordered-map data-x-internal=ordered-map>ordered map</a> that must be initially empty, and an <dfn id=animation-frame-callback-identifier>animation frame callback
      identifier</dfn>, which is a number that must initially be zero.
  </p>

  <p>An <code id=animation-frames:animationframeprovider-7><a href=#animationframeprovider>AnimationFrameProvider</a></code> <var>provider</var> is considered <dfn id=concept-animationframeprovider-supported>supported</dfn> if any of the following are
    true:</p>

  <ul><li>
      <p><var>provider</var> is a <code id=animation-frames:window-4><a href=nav-history-apis.html#window>Window</a></code>.</p>
    <li>
      <p><var>provider</var>'s <span>owner set</span> <a href=https://infra.spec.whatwg.org/#list-contain id=animation-frames:list-contains data-x-internal=list-contains>contains</a>
        a <code id=animation-frames:document-2><a href=dom.html#document>Document</a></code> object.</p>
    <li>
      <p>Any of the <code id=animation-frames:dedicatedworkerglobalscope-2-4><a href=workers.html#dedicatedworkerglobalscope-2>DedicatedWorkerGlobalScope</a></code> objects in <var>provider</var>'s
        <span>owner set</span> are <a href=#concept-animationframeprovider-supported id=animation-frames:concept-animationframeprovider-supported>supported</a>.
      </p>
    </ul>

  <hr>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame title="The window.requestAnimationFrame() method tells the browser that you wish to perform an animation and requests that the browser calls a specified function to update an animation right before the next repaint. The method takes a callback as an argument to be invoked before the repaint.">Window/requestAnimationFrame</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><p>The <dfn data-dfn-for=AnimationFrameProvider id=dom-animationframeprovider-requestanimationframe data-dfn-type=method><code>requestAnimationFrame(<var>callback</var>)</code></dfn>
    method steps are:</p>

  <ol><li>
      <p>If <a id=animation-frames:this href=https://webidl.spec.whatwg.org/#this data-x-internal=this>this</a> is not <a href=#concept-animationframeprovider-supported id=animation-frames:concept-animationframeprovider-supported-2>supported</a>, then throw a
        <a id=animation-frames:notsupportederror href=https://webidl.spec.whatwg.org/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=animation-frames:domexception><a data-x-internal=domexception href=https://webidl.spec.whatwg.org/#dfn-DOMException>DOMException</a></code>.
      </p>
    <li>
      <p>Let <var>target</var> be <a id=animation-frames:this-2 href=https://webidl.spec.whatwg.org/#this data-x-internal=this>this</a>'s <a href=#concept-animationframeprovider-target-object id=animation-frames:concept-animationframeprovider-target-object-2>target object</a>.</p>
    <li>
      <p>Increment <var>target</var>'s <a href=#animation-frame-callback-identifier id=animation-frames:animation-frame-callback-identifier>animation frame callback identifier</a> by one,
        and let <var>handle</var> be the result.</p>
    <li>
      <p>Let <var>callbacks</var> be <var>target</var>'s <a href=#list-of-animation-frame-callbacks id=animation-frames:list-of-animation-frame-callbacks>map of animation frame
          callbacks</a>.</p>
    <li>
      <p><a href=https://infra.spec.whatwg.org/#map-set id=animation-frames:map-set data-x-internal=map-set>Set</a> <var>callbacks</var>[<var>handle</var>] to
        <var>callback</var>.
      </p>
    <li>
      <p>Return <var>handle</var>.</p>
    </ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame title="The window.cancelAnimationFrame() method cancels an animation frame request previously scheduled through a call to window.requestAnimationFrame().">Window/cancelAnimationFrame</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><p>The <dfn data-dfn-for=AnimationFrameProvider id=animationframeprovider-cancelanimationframe data-dfn-type=method><code>cancelAnimationFrame(<var>handle</var>)</code></dfn>
    method steps are:</p>

  <ol><li>
      <p>If <a id=animation-frames:this-3 href=https://webidl.spec.whatwg.org/#this data-x-internal=this>this</a> is not <a href=#concept-animationframeprovider-supported id=animation-frames:concept-animationframeprovider-supported-3>supported</a>, then throw a
        <a id=animation-frames:notsupportederror-2 href=https://webidl.spec.whatwg.org/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=animation-frames:domexception-2><a data-x-internal=domexception href=https://webidl.spec.whatwg.org/#dfn-DOMException>DOMException</a></code>.
      </p>
    <li>
      <p>Let <var>callbacks</var> be <a id=animation-frames:this-4 href=https://webidl.spec.whatwg.org/#this data-x-internal=this>this</a>'s <a href=#concept-animationframeprovider-target-object id=animation-frames:concept-animationframeprovider-target-object-3>target object</a>'s <a href=#list-of-animation-frame-callbacks id=animation-frames:list-of-animation-frame-callbacks-2>map of
          animation frame callbacks</a>.</p>
    <li>
      <p><a href=https://infra.spec.whatwg.org/#map-remove id=animation-frames:map-remove data-x-internal=map-remove>Remove</a> <var>callbacks</var>[<var>handle</var>].</p>
    </ol>

  <p>To <dfn id=run-the-animation-frame-callbacks>run the animation frame callbacks</dfn> for a <a href=#concept-animationframeprovider-target-object id=animation-frames:concept-animationframeprovider-target-object-4>target object</a> <var>target</var> with
    a timestamp <var>now</var>:</p>

  <ol><li>
      <p>Let <var>callbacks</var> be <var>target</var>'s <a href=#list-of-animation-frame-callbacks id=animation-frames:list-of-animation-frame-callbacks-3>map of animation frame
          callbacks</a>.</p>
    <li>
      <p>Let <var>callbackHandles</var> be the result of <a href=https://infra.spec.whatwg.org/#map-getting-the-keys id=animation-frames:map-get-the-keys data-x-internal=map-get-the-keys>getting
          the keys</a> of <var>callbacks</var>.</p>
    <li>
      <p><a href=https://infra.spec.whatwg.org/#list-iterate id=animation-frames:list-iterate data-x-internal=list-iterate>For each</a> <var>handle</var> in
        <var>callbackHandles</var>, if <var>handle</var> <a href=https://infra.spec.whatwg.org/#map-exists id=animation-frames:map-exists data-x-internal=map-exists>exists</a> in
        <var>callbacks</var>:
      </p>

      <ol><li>
          <p>Let <var>callback</var> be <var>callbacks</var>[<var>handle</var>].</p>
        <li>
          <p><a href=https://infra.spec.whatwg.org/#map-remove id=animation-frames:map-remove-2 data-x-internal=map-remove>Remove</a>
            <var>callbacks</var>[<var>handle</var>].
          </p>
        <li>
          <p><a href=https://webidl.spec.whatwg.org/#invoke-a-callback-function id=animation-frames:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>callback</var> with «
            <var>now</var> » and "<code>report</code>".
          </p>
        </ol>
    </ol>

  <div class=example>
    <p>Inside workers, <code id=animation-frames:dom-animationframeprovider-requestanimationframe-2><a href=#dom-animationframeprovider-requestanimationframe>requestAnimationFrame()</a></code> can be
      used together with an <code id=animation-frames:offscreencanvas><a href=canvas.html#offscreencanvas>OffscreenCanvas</a></code> transferred from a <code id=animation-frames:the-canvas-element><a href=canvas.html#the-canvas-element>canvas</a></code>
      element. First, in the document, transfer control to the worker:</p>

    <pre><code class=js>const offscreenCanvas = document.getElementById("c").transferControlToOffscreen();
worker.postMessage(offscreenCanvas, [offscreenCanvas]);</code></pre>

    <p>Then, in the worker, the following code will draw a rectangle moving from left to right:</p>

    <pre><code class=js>let ctx, pos = 0;
function draw(dt) {
  ctx.clearRect(0, 0, 100, 100);
  ctx.fillRect(pos, 0, 10, 10);
  pos += 10 * dt;
  requestAnimationFrame(draw);
}

self.onmessage = function(ev) {
  const transferredCanvas = ev.data;
  ctx = transferredCanvas.getContext("2d");
  draw();
};</code></pre>
  </div>

  <nav><a href=system-state.html>← 8.9 System state and capabilities</a> — <a href=./>Table of Contents</a> — <a href=comms.html>9 Communication →</a></nav>
