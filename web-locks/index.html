<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>Web 锁 API</title>
    <meta content="WD" name="w3c-status">
    <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
    <meta content="Bikeshed version 26e85e599, updated Thu Dec 8 15:29:31 2022 -0800" name="generator">
    <link href="https://www.w3.org/TR/web-locks/" rel="canonical">
    <link href="https://www.w3.org/TR/web-locks/logo-lock.svg" rel="icon">
    <style>
        .domintro::before {
            content: 'For web developers (non-normative)';
            text-transform: initial;
        }

        .domintro dt {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;

            padding-top: 0.5em;
            padding-bottom: 1em;
        }

        .domintro dt a {
            color: inherit;
            border-bottom-style: none;
        }

        .domintro dt code {
            font-size: inherit;
        }
    </style>
    <style>
        #speclogo {
            height: 100px;
            width: 100px;
            background-color: transparent;
        }

        main #speclogo {
            position: absolute;
            right: 20px;
            top: 30px;
        }

        .logo #speclogo {
            margin-top: 20px;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-mdn-anno */
        @media (max-width: 767px) {
            .mdn-anno {
                opacity: .1;
            }
        }

        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
        }

        .mdn-anno {
            font: 1em sans-serif;
            padding: 0.3em;
            position: absolute;
            z-index: 8;
            right: 0.3em;
            background: var(--mdn-bg, #EEE);
            color: var(--text, black);
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            overflow: hidden;
            border-collapse: initial;
            border-spacing: initial;
            min-width: 9em;
            max-width: min-content;
            white-space: nowrap;
            word-wrap: normal;
            hyphens: none;
            border-radius: .25em;
        }

        .mdn-anno:not(.wrapped) {
            opacity: 1;
            z-index: 9;
        }

        .mdn-anno.wrapped {
            min-width: 0;
        }

        .mdn-anno.wrapped> :not(button) {
            display: none;
        }

        .mdn-anno:hover {
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>.mdn-anno-btn {
            cursor: pointer;
            border: none;
            color: #000;
            background: transparent;
            margin: -8px;
            float: right;
            padding: 10px 8px 8px 8px;
            outline: none;
        }

        .mdn-anno>.mdn-anno-btn>.less-than-two-engines-flag {
            color: red;
            padding-right: 2px;
        }

        .mdn-anno>.mdn-anno-btn>.all-engines-flag {
            color: green;
            padding-right: 2px;
        }

        .mdn-anno>.mdn-anno-btn>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: red;
        }

        .mdn-anno>.feature>.all-engines-text {
            color: green;
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>

    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">Web 锁 API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#FPWD">W3C 首次公开工作草案</a>, <time class="dt-updated"
                datetime="2023-01-05">2023年1月5日</time></p>
        <details open>
            <summary>有关此文档的更多详细信息</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>此版本:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2023/WD-web-locks-20230105/">https://www.w3.org/TR/2023/WD-web-locks-20230105/</a>
                    <dt>最新发布的版本:
                    <dd><a href="https://www.w3.org/TR/web-locks/">https://www.w3.org/TR/web-locks/</a>
                    <dt>编辑草案:
                    <dd><a href="https://w3c.github.io/web-locks/">https://w3c.github.io/web-locks/</a>
                    <dt>历史:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/web-locks">https://www.w3.org/standards/history/web-locks</a>
                    <dt>测试套件:
                    <dd><a
                            href="https://github.com/web-platform-tests/wpt/tree/master/web-locks">https://github.com/web-platform-tests/wpt/tree/master/web-locks</a>
                    <dt>反馈:
                    <dd><a href="https://github.com/w3c/web-locks/issues/">GitHub</a>
                    <dd><a href="#issues-index">规范内的行内问题</a>
                    <dt class="editor">编辑:
                    <dd class="editor p-author h-card vcard" data-editor-id="61302"><a class="p-name fn u-email email"
                            href="mailto:jsbell@google.com">Joshua Bell</a> (<a class="p-org org"
                            href="https://google.com">Google Inc.</a>)
                    <dd class="editor p-author h-card vcard" data-editor-id="107856"><a class="p-name fn u-email email"
                            href="mailto:krosylight@mozilla.com">Kagami Rosylight</a> (<a class="p-org org"
                            href="https://www.mozilla.org/">Mozilla</a>)
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive
                document license</a> rules apply. </p>
        <hr title="标题分隔符">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本文档定义了一个 Web 平台 API，允许脚本异步地获取对资源的锁，持有锁进行工作，然后释放锁。在持有期间，同一来源的其他脚本无法获取对相同资源的锁。这使得 Web
            应用程序中的上下文（窗口、工作者）能够协调资源的使用。</p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">本文件的状态</span></h2>
    <div data-fill-with="status">
        <p> <em>此部分描述了该文档在发布时的状态。当前<abbr title="World Wide Web Consortium">W3C</abbr>出版物列表及本技术报告的最新修订版可在<abbr
                    title="World Wide Web Consortium">W3C</abbr>技术报告索引（<a
                    href="https://www.w3.org/TR/">https://www.w3.org/TR/</a>）中找到。</em> </p>
        <p> 本文档由<a href="https://www.w3.org/groups/wg/webapps">Web 应用工作组</a>发布为工作草案。此文档旨在成为 <abbr
                title="World Wide Web Consortium">W3C</abbr> 推荐标准。</p>
        <p></p>
        <p> 本文档由<a href="https://www.w3.org/groups/wg/webapps">Web 应用工作组</a>作为首次公开工作草案发布，使用 <a
                href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">推荐轨道</a>。

            欢迎对本规范的反馈和评论。请使用 <a href="https://github.com/w3c/web-locks/issues">GitHub 问题</a>进行反馈。历史讨论可在<a
                href="https://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org 存档</a>中找到。</p>
        <p> 作为首次公开工作草案发布并不意味着获得 <abbr
                title="World Wide Web Consortium">W3C</abbr>及其成员的认可。这是一个草案文档，可能会随时更新、替换或废弃。在其他情况下引用该文档是不合适的，除非作为工作进展。
        </p>
        <p> 本文档由依据 <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/"><abbr
                    title="World Wide Web Consortium">W3C</abbr> 专利政策</a>运营的团体制作。<abbr
                title="World Wide Web Consortium">W3C</abbr> 维护了一份<a
                href="https://www.w3.org/2004/01/pp-impl/114929/status"
                rel="disclosure">与该团体的交付物有关的专利披露的公开列表</a>；该页面还包括有关披露专利的说明。个人如果已知包含 <a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">必要权利要求</a>的专利，必须根据 <a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">W3C 专利政策第6条</a>披露信息。</p>
        <p>本文档受 <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2021年11月2日 W3C 流程文档</a>管理。
        </p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#introduction"><span class="secno">1</span> <span class="content">介绍</span></a>
                <ol class="toc">
                    <li><a href="#usage-overview"><span class="secno">1.1</span> <span class="content">使用概述</span></a>
                    <li><a href="#motivations"><span class="secno">1.2</span> <span class="content">动机和使用案例</span></a>
                </ol>
            <li>
                <a href="#concepts"><span class="secno">2</span> <span class="content">概念</span></a>
                <ol class="toc">
                    <li><a href="#resource-names"><span class="secno">2.1</span> <span class="content">资源名称</span></a>
                    <li><a href="#lock-managers"><span class="secno">2.2</span> <span class="content">锁管理器</span></a>
                    <li><a href="#modes-scheduling"><span class="secno">2.3</span> <span
                                class="content">模式和调度</span></a>
                    <li><a href="#concept-lock"><span class="secno">2.4</span> <span class="content">锁</span></a>
                    <li><a href="#concept-lock-request"><span class="secno">2.5</span> <span
                                class="content">锁请求</span></a>
                    <li><a href="#termination-of-locks"><span class="secno">2.6</span> <span
                                class="content">锁的终止</span></a>
                </ol>
            <li>
                <a href="#api"><span class="secno">3</span> <span class="content">API</span></a>
                <ol class="toc">
                    <li><a href="#navigator-mixins"><span class="secno">3.1</span> <span class="content">Navigator
                                混入</span></a>
                    <li>
                        <a href="#api-lock-manager"><span class="secno">3.2</span> <span class="content"><code
                                    class="idl"><span>LockManager</span></code> 类</span></a>
                        <ol class="toc">
                            <li><a href="#api-lock-manager-request"><span class="secno">3.2.1</span> <span
                                        class="content"><code class="idl"><span>request()</span></code> 方法</span></a>
                            <li><a href="#api-lock-manager-query"><span class="secno">3.2.2</span> <span
                                        class="content"><code class="idl"><span>query()</span></code> 方法</span></a>
                        </ol>
                    <li><a href="#api-lock"><span class="secno">3.3</span> <span class="content"><code
                                    class="idl"><span>Lock</span></code> 类</span></a>
                </ol>
            <li>
                <a href="#algorithms"><span class="secno">4</span> <span class="content">算法</span></a>
                <ol class="toc">
                    <li><a href="#algorithm-request-lock"><span class="secno">4.1</span> <span
                                class="content">请求锁</span></a>
                    <li><a href="#algorithm-release-lock"><span class="secno">4.2</span> <span
                                class="content">释放锁</span></a>
                    <li><a href="#algorithm-abort-request"><span class="secno">4.3</span> <span
                                class="content">中止请求</span></a>
                    <li><a href="#algorithm-process-request"><span class="secno">4.4</span> <span
                                class="content">处理给定资源名称的锁请求队列</span></a>
                    <li><a href="#algorithm-snapshot-state"><span class="secno">4.5</span> <span
                                class="content">快照锁状态</span></a>
                </ol>
            <li>
                <a href="#usage-considerations"><span class="secno">5</span> <span class="content">使用注意事项</span></a>
                <ol class="toc">
                    <li><a href="#deadlocks"><span class="secno">5.1</span> <span class="content">死锁</span></a>
                </ol>
            <li>
                <a href="#security-privacy"><span class="secno">6</span> <span class="content">安全和隐私注意事项</span></a>
                <ol class="toc">
                    <li><a href="#security-scope"><span class="secno">6.1</span> <span class="content">锁的作用域</span></a>
                    <li><a href="#private-browsing"><span class="secno">6.2</span> <span class="content">隐私浏览</span></a>
                    <li><a href="#implementation-risks"><span class="secno">6.3</span> <span
                                class="content">实现风险</span></a>
                    <li><a href="#security-privacy-checklist"><span class="secno">6.4</span> <span
                                class="content">检查清单</span></a>
                </ol>
            <li><a href="#acknowledgements"><span class="secno">7</span> <span class="content">致谢</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span
                                class="content">一致性算法</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">通过引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">说明性参考文献</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <p><img alt="logo" height="100" id="speclogo" src="https://www.w3.org/TR/web-locks/logo-lock.svg" width="100">
        </p>
        <script>
            (function () {
                const logo = document.querySelector('.logo');
                if (logo) logo.appendChild(document.querySelector('#speclogo'));
            })();
        </script>
        <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span
                class="content">介绍</span><a class="self-link" href="#introduction"></a></h2>
        <p><em>本节是非规范性的。</em></p>
        <p>脚本对特定的<a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request">锁请求</a>发起操作，
            请求特定的<a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name">资源名称</a>和
            <a data-link-type="dfn" href="#mode" id="ref-for-mode">模式</a>。调度算法查看当前和之前请求的状态，
            最终授予锁请求。<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept">锁</a>是一个已授予的请求；
            它有一个<a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name①">资源名称</a>和
            <a data-link-type="dfn" href="#mode" id="ref-for-mode①">模式</a>。它作为一个返回给脚本的对象表示。
            只要锁被持有，它可能阻止其他锁请求被授予（取决于名称和模式）。脚本可以释放锁，
            此时它可能允许其他锁请求被授予。
        </p>
        <p>该 API 提供了一些可按需使用的可选功能，包括：</p>
        <ul>
            <li data-md>
                <p>从异步任务中返回值，</p>
            <li data-md>
                <p>共享和独占锁模式，</p>
            <li data-md>
                <p>条件获取，</p>
            <li data-md>
                <p>查询锁状态的诊断功能，</p>
            <li data-md>
                <p>防止死锁的应急措施。</p>
        </ul>
        <p>合作协调在共享<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent">代理</a>的
            <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket">存储桶</a>的范围内进行；
            这可能跨越多个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism"
                id="ref-for-integration-with-the-javascript-agent-cluster-formalism">代理集群</a>。
        </p>
        <aside class="note">
            <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent①">代理</a>
            大致对应于窗口（标签页）、iframe 和 worker。
            <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism"
                id="ref-for-integration-with-the-javascript-agent-cluster-formalism①">代理集群</a>在一些用户代理实现中对应于独立的进程。
        </aside>
        <h3 class="heading settled" data-level="1.1" id="usage-overview"><span class="secno">1.1. </span><span
                class="content">使用概述</span><a class="self-link" href="#usage-overview"></a></h3>
        <p>该 API 的使用步骤如下：</p>
        <ol>
            <li data-md>
                <p>请求锁。</p>
            <li data-md>
                <p>在异步任务中持有锁时执行工作。</p>
            <li data-md>
                <p>任务完成时自动释放锁。</p>
        </ol>
        <aside class="example" id="example-basic-usage">
            <a class="self-link" href="#example-basic-usage"></a>
            <p>以下是 API 使用的基本示例：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// 锁已获取。</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- k>await</c-> do_something_else<c- p>();</c->
   <c- c1>// 锁现在将被释放。</c->
<c- p>});</c->
</pre>
            <p>在异步函数中，请求本身可以使用 await 等待：</p>
            <pre class="language-js highlight"><c- c1>// 在请求锁之前。</c->
<c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// 锁已获取。</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- c1>// 锁现在将被释放。</c->
<c- p>});</c->
<c- c1>// 在锁被释放之后</c->
</pre>
        </aside>
        <h3 class="heading settled" data-level="1.2" id="motivations"><span class="secno">1.2. </span><span
                class="content">动机和使用案例</span><a class="self-link" href="#motivations"></a></h3>
        <p>基于 Web 的文档编辑器将状态存储在内存中以便快速访问，并将更改（作为一系列记录）持久化到存储 API，
            例如 <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">Indexed Database
                API</a>，
            以提高弹性和离线使用能力，同时同步到服务器以支持跨设备使用。当同一文档在两个标签页中打开进行编辑时，必须在这些标签页之间进行协调，
            例如确保一次只能有一个标签页对文档进行修改或同步。需要在活动标签页离开（导航、关闭、崩溃）时使其他标签页可以变为活动状态。</p>
        <p>在数据同步服务中，会指定一个“主标签页”。这个标签页是唯一执行某些操作的页面（例如网络同步、清理排队数据等）。它持有一个锁并且从不释放。
            其他标签页可以尝试获取该锁，所有尝试将排队进行。如果“主标签页”崩溃或关闭，则其他标签页中的一个将获得该锁并成为新的主标签页。</p>
        <p><a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">Indexed Database
                API</a> 定义了一个事务模型，
            允许在原点内的多个命名存储分区之间进行共享读取和独占写入访问。将此概念作为一个原语公开，可以基于资源的可用性调度任何 Web 平台活动，
            例如允许为其他存储类型（例如 Caches <a data-link-type="biblio" href="#biblio-service-workers"
                title="Service Workers">[Service-Workers]</a>）、
            跨存储类型，甚至跨非存储 API（例如网络获取）组合事务。</p>
        <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span
                class="content">概念</span><a class="self-link" href="#concepts"></a></h2>
        <p>本规范的目的如下：</p>
        <ul>
            <li data-md>
                <p>浏览器中的不同用户配置文件被视为不同的用户代理。</p>
            <li data-md>
                <p>每个<a href="https://github.com/w3ctag/private-mode">隐私模式</a>浏览会话被视为一个单独的用户代理。</p>
        </ul>
        <p>一个<a data-link-type="dfn" href="https://www.w3.org/TR/CSS2/conform.html#user-agent"
                id="ref-for-user-agent">用户代理</a>具有一个
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-task-queue">锁任务队列</dfn>，它是
            <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue"
                id="ref-for-starting-a-new-parallel-queue">启动新的并行队列</a>的结果。
        </p>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source">任务来源</a>对于下面排队的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                id="ref-for-enqueue-the-following-steps">步骤</a>是<dfn data-dfn-type="dfn" data-export
                id="web-locks-tasks-source">Web 锁任务来源<a class="self-link" href="#web-locks-tasks-source"></a></dfn>。</p>
        <h3 class="heading settled" data-level="2.1" id="resource-names"><span class="secno">2.1. </span><span
                class="content">资源名称</span><a class="self-link" href="#resource-names"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="resource-name">资源名称</dfn>是由 web 应用程序选择的表示抽象资源的
            <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">JavaScript 字符串</a>。
        </p>
        <p>资源名称在调度算法之外没有外部含义，但在共享
            <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent②">代理</a>的
            <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket①">存储桶</a>中是全局的。
            Web 应用程序可以自由使用任何资源命名方案。
        </p>
        <aside class="example" id="example-indexeddb-transactions">
            <a class="self-link" href="#example-indexeddb-transactions"></a> 要在命名数据库中模拟对命名存储的事务锁定，
            可以这样写脚本，组合资源名称：
            <pre class="language-js highlight">encodeURIComponent<c- p>(</c->db_name<c- p>)</c-> <c- o>+</c-> <c- t>'/'</c-> <c- o>+</c-> encodeURIComponent<c- p>(</c->store_name<c- p>)</c->
</pre>
        </aside>
        <p>以 U+002D HYPHEN-MINUS（-）开头的资源名称是保留的；请求这些资源名称将引发异常。</p>
        <h3 class="heading settled" data-level="2.2" id="lock-managers"><span class="secno">2.2. </span><span
                class="content">锁管理器</span><a class="self-link" href="#lock-managers"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-manager">锁管理器</dfn>封装了
            <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①">锁</a>和
            <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request①">锁请求</a>的状态。
            每个<a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket②">存储桶</a>
            都通过与 Web 锁 API 相关联的<a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle"
                id="ref-for-storage-bottle">存储瓶</a>包含一个
            <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager">锁管理器</a>。
        </p>
        <p class="note" role="note"><span>注意：</span>页面和 worker（<a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent③">代理</a>）
            共享一个<a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket③">存储桶</a>，
            即使它们处于不相关的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"
                id="ref-for-browsing-context">浏览上下文</a>中，
            但它们仍共享同一个<a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager①">锁管理器</a>。</p>
        <div class="algorithm" data-algorithm="obtain a lock manager">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-lock-manager">获取一个锁管理器</dfn>，
            给定一个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object">环境设置对象</a>
            <var>environment</var>，运行以下步骤：
            <ol>
                <li data-md>
                    <p>令<var>map</var>为通过<var>environment</var>和"<code>web-locks</code>"<a data-link-type="dfn"
                            href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map"
                            id="ref-for-obtain-a-local-storage-bottle-map">获取本地存储瓶映射</a>的结果。</p>
                <li data-md>
                    <p>如果<var>map</var>为失败，则返回失败。</p>
                <li data-md>
                    <p>令<var>bottle</var>为<var>map</var>相关联的
                        <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle"
                            id="ref-for-storage-bottle①">存储瓶</a>。
                    </p>
                <li data-md>
                    <p>返回<var>bottle</var>的相关联<a data-link-type="dfn" href="#lock-manager"
                            id="ref-for-lock-manager②">锁管理器</a>。</p>
            </ol>
        </div>
        <p class="issue" id="issue-73644ca1"><a class="self-link" href="#issue-73644ca1"></a> 这里需要完善与
            <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[存储]</a>的集成，
            包括如何从给定环境中正确获取锁管理器。
        </p>
        <h3 class="heading settled" data-level="2.3" id="modes-scheduling"><span class="secno">2.3. </span><span
                class="content">模式和调度</span><a class="self-link" href="#modes-scheduling"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="mode">模式</dfn>可以是
            "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive">exclusive</a></code>"
            或 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared">shared</a></code>"。
            模式可以用于模拟常见的
            <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">读写锁</a>模式。
            如果持有 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive①">exclusive</a></code>"
            锁，
            则无法授予该名称的其他锁。如果持有 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared①">shared</a></code>"
            锁，
            则可以授予其他具有相同名称的 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared②">shared</a></code>"
            锁，
            但不能授予任何 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive②">exclusive</a></code>"
            锁。
            API 中的默认模式是 "<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive③">exclusive</a></code>"。
        </p>
        <p>其他属性可能会影响调度，例如超时、公平性等。</p>
        <h3 class="heading settled" data-level="2.4" id="concept-lock"><span class="secno">2.4. </span><span
                class="content">锁</span><a class="self-link" href="#concept-lock"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="lock-concept" data-noexport
                id="lock-concept">锁</dfn>表示对共享资源的独占访问。</p>
        <div>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept②">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-agent">代理</dfn>，它是一个
                <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent④">代理</a>。
            </p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept③">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-clientid">clientId</dfn>，它是一个不透明的字符串。</p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept④">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-manager">管理器</dfn>，它是一个<a data-link-type="dfn" href="#lock-manager"
                    id="ref-for-lock-manager③">锁管理器</a>。</p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑤">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-name">名称</dfn>，它是一个<a data-link-type="dfn" href="#resource-name"
                    id="ref-for-resource-name②">资源名称</a>。</p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑥">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-mode">模式</dfn>，它是"<code
                    class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive④">exclusive</a></code>"
                或 "<code
                    class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared③">shared</a></code>"中的一个。
            </p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑦">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-waiting-promise">等待的 promise</dfn>，它是一个 Promise。</p>
            <p>一个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑧">锁</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-released-promise">释放的 promise</dfn>，它是一个 Promise。</p>
            <aside class="note">
                锁的生命周期中有两个相关的 Promise：
                <ul>
                    <li data-md>
                        <p>由回调函数在锁被授予时隐式或显式提供的 Promise，用于确定锁持有的时间。当这个 Promise 完成时，锁被释放。这被称为锁的
                            <a data-link-type="dfn" href="#lock-concept-waiting-promise"
                                id="ref-for-lock-concept-waiting-promise">等待的 promise</a>。
                        </p>
                    <li data-md>
                        <p>由<code
                                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager">LockManager</a></code>的
                            <code
                                class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request">request()</a></code>方法返回的
                            Promise，
                            它在锁被释放或请求被中止时完成。这被称为锁的
                            <a data-link-type="dfn" href="#lock-concept-released-promise"
                                id="ref-for-lock-concept-released-promise">释放的 promise</a>。
                        </p>
                </ul>
                <pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> p2 <c- o>=</c-> <c- ow>new</c-> Promise<c- p>(</c->r <c- p>=></c-> <c- p>{</c->
    <c- c1>// 使用锁的逻辑并解决 promise...</c->
  <c- p>});</c->
  <c- k>return</c-> p2<c- p>;</c->
<c- p>});</c->
</pre>
                <p>在上面的示例中，<code>p1</code> 是<a data-link-type="dfn" href="#lock-concept-released-promise"
                        id="ref-for-lock-concept-released-promise①">释放的 promise</a>，
                    而<code>p2</code> 是<a data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise①">等待的 promise</a>。
                    请注意，大多数代码中的回调函数会实现为<code>async</code>函数，返回的 Promise 是隐式的，如下例所示：</p>
                <pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// 使用锁的逻辑...</c->
<c- p>});</c->
</pre>
                <p>在上述代码中，<a data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise②">等待的 promise</a>未命名，
                    但仍然作为匿名<code>async</code>回调的返回值存在。
                    进一步注意，如果回调函数不是<code>async</code>，并返回一个非 promise，返回值将被包装在一个立即解决的 Promise 中；
                    锁将在接下来的微任务中释放，而<a data-link-type="dfn" href="#lock-concept-released-promise"
                        id="ref-for-lock-concept-released-promise②">释放的 promise</a>也将在后续的微任务中解决。</p>
            </aside>
            <p>每个<a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager④">锁管理器</a>具有一个<dfn
                    class="dfn-paneled" data-dfn-for="lock manager" data-dfn-type="dfn" data-noexport
                    id="lock-manager-held-lock-set">持有的锁集合</dfn>，
                它是<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set"
                    id="ref-for-ordered-set">锁的有序集合</a>。</p>
            <div class="algorithm" data-algorithm="waiting promise settles">
                <p>当<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⓪">锁</a> <var>lock</var>的
                    <a data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise③">等待的 promise</a>
                    完成（成功或失败）时，<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                        id="ref-for-enqueue-the-following-steps①">排队以下步骤</a>到
                    <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue">锁任务队列</a>中：
                </p>
                <ol>
                    <li data-md>
                        <p><a data-link-type="dfn" href="#release-the-lock" id="ref-for-release-the-lock">释放锁</a>
                            <var>lock</var>。
                        </p>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                id="ref-for-resolve">解决</a> <var>lock</var>的
                            <a data-link-type="dfn" href="#lock-concept-released-promise"
                                id="ref-for-lock-concept-released-promise③">释放的 promise</a>，
                            使用<var>lock</var>的<a data-link-type="dfn" href="#lock-concept-waiting-promise"
                                id="ref-for-lock-concept-waiting-promise④">等待的 promise</a>。
                        </p>
                </ol>
            </div>
        </div>
        <h3 class="heading settled" data-level="2.5" id="concept-lock-request"><span class="secno">2.5. </span><span
                class="content">锁请求</span><a class="self-link" href="#concept-lock-request"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-request">锁请求</dfn>表示一个待处理的<a
                data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①①">锁</a>请求。
        </p>
        <div>
            <p>一个<a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request②">锁请求</a>是一个<a
                    data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">结构体</a>，
                具有以下<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item"
                    id="ref-for-struct-item">项</a>：<dfn class="dfn-paneled" data-dfn-for="lock request"
                    data-dfn-type="dfn" data-noexport id="lock-request-agent">代理</dfn>、<dfn class="dfn-paneled"
                    data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-clientid">clientId</dfn>、<dfn class="dfn-paneled" data-dfn-for="lock request"
                    data-dfn-type="dfn" data-noexport id="lock-request-manager">管理器</dfn>、<dfn class="dfn-paneled"
                    data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-name">名称</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-mode">模式</dfn>、<dfn class="dfn-paneled" data-dfn-for="lock request"
                    data-dfn-type="dfn" data-noexport id="lock-request-callback">回调函数</dfn>、<dfn class="dfn-paneled"
                    data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-promise">promise</dfn>，以及<dfn class="dfn-paneled" data-dfn-for="lock request"
                    data-dfn-type="dfn" data-noexport id="lock-request-signal">信号</dfn>。
            </p>
        </div>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-request-queue">锁请求队列</dfn>
            是一个<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue" id="ref-for-queue">队列</a>，其中包含<a
                data-link-type="dfn" href="#lock-request" id="ref-for-lock-request③">锁请求</a>。</p>
        <p>每个<a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager⑤">锁管理器</a>都有一个<dfn
                class="dfn-paneled" data-dfn-for="lock manager" data-dfn-type="dfn" data-noexport
                id="lock-manager-lock-request-queue-map">锁请求队列映射</dfn>，它是一个<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">有序映射</a>，
            将<a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name③">资源名称</a>映射到<a
                data-link-type="dfn" href="#lock-request-queue" id="ref-for-lock-request-queue">锁请求队列</a>。
        </p>
        <div class="algorithm" data-algorithm="get the lock request queue">
            <p>要从<a data-link-type="dfn" href="#lock-manager-lock-request-queue-map"
                    id="ref-for-lock-manager-lock-request-queue-map">锁请求队列映射</a>
                <var>queueMap</var>中获取<a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name④">资源名称</a>
                <var>name</var>的
                <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="get-the-lock-request-queue">锁请求队列</dfn>，运行以下步骤：
            </p>
            <ol>
                <li data-md>
                    <p>如果<var>queueMap</var>[<var>name</var>] <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">不存在</a>，
                        则<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set"
                            id="ref-for-map-set">设置</a><var>queueMap</var>[<var>name</var>]为一个新的空<a data-link-type="dfn"
                            href="#lock-request-queue" id="ref-for-lock-request-queue①">锁请求队列</a>。</p>
                <li data-md>
                    <p>返回<var>queueMap</var>[<var>name</var>]。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="grantable">
            <p>当以下步骤返回 true 时，表示<a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request④">锁请求</a>
                <var>request</var>是<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="grantable">可授予的</dfn>：
            </p>
            <ol>
                <li data-md>
                    <p>设<var>manager</var>为<var>request</var>的<a data-link-type="dfn" href="#lock-request-manager"
                            id="ref-for-lock-request-manager">管理器</a>。</p>
                <li data-md>
                    <p>设<var>queueMap</var>为<var>manager</var>的<a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map①">锁请求队列映射</a>。</p>
                <li data-md>
                    <p>设<var>name</var>为<var>request</var>的<a data-link-type="dfn" href="#lock-request-name"
                            id="ref-for-lock-request-name">名称</a>。</p>
                <li data-md>
                    <p>设<var>queue</var>为从<var>queueMap</var>中获取<var>name</var>的结果<a data-link-type="dfn"
                            href="#get-the-lock-request-queue" id="ref-for-get-the-lock-request-queue">锁请求队列</a>。
                    </p>
                <li data-md>
                    <p>设<var>held</var>为<var>manager</var>的<a data-link-type="dfn" href="#lock-manager-held-lock-set"
                            id="ref-for-lock-manager-held-lock-set">持有的锁集合</a>。</p>
                <li data-md>
                    <p>设<var>mode</var>为<var>request</var>的<a data-link-type="dfn" href="#lock-request-mode"
                            id="ref-for-lock-request-mode">模式</a>。</p>
                <li data-md>
                    <p>如果<var>queue</var><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty"
                            id="ref-for-list-is-empty">不为空</a>，
                        且<var>request</var>不是<var>queue</var>中的第一个<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">项</a>，
                        则返回 false。</p>
                <li data-md>
                    <p>如果<var>mode</var>是"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑤">exclusive</a></code>"，
                        则当<var>held</var>中没有<a data-link-type="dfn" href="#lock-concept"
                            id="ref-for-lock-concept①②">锁</a>的
                        <a data-link-type="dfn" href="#lock-concept-name"
                            id="ref-for-lock-concept-name">名称</a>等于<var>name</var>时返回 true，否则返回 false。
                    </p>
                <li data-md>
                    <p>否则，<var>mode</var>是"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared④">shared</a></code>"；
                        当<var>held</var>中没有<a data-link-type="dfn" href="#lock-concept"
                            id="ref-for-lock-concept①③">锁</a>的
                        <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode">模式</a>为"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑥">exclusive</a></code>"，
                        且其<a data-link-type="dfn" href="#lock-concept-name"
                            id="ref-for-lock-concept-name①">名称</a>等于<var>name</var>时，返回 true，否则返回 false。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="2.6" id="termination-of-locks"><span class="secno">2.6. </span><span
                class="content">锁的终止</span><a class="self-link" href="#termination-of-locks"></a></h3>
        <p>每当运行<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps"
                id="ref-for-unloading-document-cleanup-steps">卸载文档清理步骤</a>时，对其<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">文档</a>使用<a
                data-link-type="dfn" href="#terminate-remaining-locks-and-requests"
                id="ref-for-terminate-remaining-locks-and-requests">终止剩余锁和请求</a>的过程，其对应的<a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent⑤">代理</a>。
        </p>
        <p>当<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent⑥">代理</a>终止时，<a
                data-link-type="dfn" href="#terminate-remaining-locks-and-requests"
                id="ref-for-terminate-remaining-locks-and-requests①">终止剩余锁和请求</a>。
        </p>
        <p class="issue" id="issue-9062c3e0"><a class="self-link" href="#issue-9062c3e0"></a>
            目前这仅适用于工作线程，并且定义得较为模糊，因为没有规范的方法来在工作线程终止时运行步骤。</p>
        <div class="algorithm" data-algorithm="terminate remaining locks and requests">
            <p>为了<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="terminate-remaining-locks-and-requests">终止剩余锁和请求</dfn>，使用<var>代理</var>，在<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                    id="ref-for-enqueue-the-following-steps②">锁任务队列中排入以下步骤</a>：
            </p>
            <ol>
                <li data-md>
                    <p>对于每个<a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑤">锁请求</a>
                        <var>request</var>，其<a data-link-type="dfn" href="#lock-request-agent"
                            id="ref-for-lock-request-agent">代理</a>等于<var>代理</var>：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#abort-the-request" id="ref-for-abort-the-request">中止请求</a>
                                <var>request</var>。
                            </p>
                    </ol>
                <li data-md>
                    <p>对于每个<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①④">锁</a>
                        <var>lock</var>，其<a data-link-type="dfn" href="#lock-concept-agent"
                            id="ref-for-lock-concept-agent">代理</a>等于<var>代理</var>：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#release-the-lock" id="ref-for-release-the-lock①">释放锁</a>
                                <var>lock</var>。
                            </p>
                    </ol>
            </ol>
        </div>
        <h2 class="heading settled" data-level="3" id="api"><span class="secno">3. </span><span
                class="content">API</span><a class="self-link" href="#api"></a></h2>
        <h3 class="heading settled" data-level="3.1" id="navigator-mixins"><span class="secno">3.1. </span><span
                class="content">Navigator 混入</span><a class="self-link" href="#navigator-mixins"></a></h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorlocks"><code><c- g>NavigatorLocks</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager" id="ref-for-lockmanager①"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks" id="ref-for-dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks①"><c- n>NavigatorLocks</c-></a>;
</pre>
        <p>每个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object①">环境设置对象</a>都有一个 <code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager②">LockManager</a></code>
            对象。
        </p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中都可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/locks"
                        title="Navigator 接口的 locks 只读属性返回一个 LockManager 对象，该对象提供请求新锁对象和查询现有锁对象的方法。">Navigator/locks</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorLocks" data-dfn-type="attribute" data-export
                id="dom-navigatorlocks-locks"><code>locks</code></dfn> 获取器的步骤是返回 <a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">此对象</a>的 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                id="ref-for-relevant-settings-object">相关设置对象</a>的 <code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager③">LockManager</a></code>
            对象。
        </p>
        <h3 class="heading settled" data-level="3.2" id="api-lock-manager"><span class="secno">3.2. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager④">LockManager</a></code>
                类</span><a class="self-link" href="#api-lock-manager"></a></h3>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中都可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager"
                        title="Web Locks API 的 LockManager 接口提供用于请求新锁对象和查询现有锁对象的方法。要获取 LockManager 的实例，请调用 navigator.locks。">LockManager</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lockmanager"><code><c- g>LockManager</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request①"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-callback"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions"><c- n>LockOptions</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-options"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback①"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-callback"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot" id="ref-for-dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock" id="ref-for-lock"><c- n>Lock</c-></a>? <dfn class="idl-code" data-dfn-for="LockGrantedCallback" data-dfn-type="argument" data-export id="dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code><a class="self-link" href="#dom-lockgrantedcallback-lock"></a></dfn>);

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-lockmode"><code><c- g>LockMode</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-shared"><code><c- s>"shared"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></dfn> };

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockoptions"><code><c- g>LockOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode"><c- n>LockMode</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;exclusive&quot;" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockoptions-mode"><code><c- g>mode</c-></code></dfn> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></dfn> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-steal"><code><c- g>steal</c-></code></dfn> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal " id="dom-lockoptions-signal"><code><c- g>signal</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-held"><code><c- g>held</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-held"></a></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo①"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-pending"></a></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockinfo"><code><c- g>LockInfo</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockinfo-name"></a></dfn>;
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode①"><c- n>LockMode</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockinfo-mode"><code><c- g>mode</c-></code><a class="self-link" href="#dom-lockinfo-mode"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-clientid"><code><c- g>clientId</c-></code><a class="self-link" href="#dom-lockinfo-clientid"></a></dfn>;
};
</pre>
        <p>一个 <code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager⑤">LockManager</a></code>
            实例允许脚本发起 <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑥">锁请求</a> 并查询
            <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager⑥">锁管理器</a> 的状态。
        </p>
        <h4 class="heading settled" data-level="3.2.1" id="api-lock-manager-request"><span class="secno">3.2.1.
            </span><span class="content">方法 <code
                    class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request②">request()</a></code></span><a
                class="self-link" href="#api-lock-manager-request"></a></h4>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"
                        title="LockManager 接口的 request() 方法请求一个锁对象，并指定其名称和特性。请求的锁传递给回调函数，而该函数本身返回一个以 undefined 解析的 Promise。">LockManager/request</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <div class="domintro note" role="note">
            <dl>
                <dt data-md><var>promise</var> = navigator.locks.<code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request③">request</a></code>(<var>name</var>,
                    <var>callback</var>)
                </dt>
                <dt data-md><var>promise</var> = navigator.locks.<code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback①">request</a></code>(<var>name</var>,
                    <var>options</var>, <var>callback</var>)
                </dt>
                <dd data-md>
                    <p>调用 <code
                            class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request④">request()</a></code>
                        方法来请求一个锁。</p>
                    <p><var>name</var>（初始参数）是一个 <a data-link-type="dfn" href="#resource-name"
                            id="ref-for-resource-name⑤">资源名称</a>字符串。</p>
                    <p><var>callback</var>（最后一个参数）是一个当锁被授予时调用的 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#dfn-callback-function"
                            id="ref-for-dfn-callback-function">回调函数</a>。这是由脚本指定的，通常是一个 <code>async</code>
                        函数。锁在回调函数完成之前一直被持有。如果传递了一个非异步的回调函数，它将自动包裹在一个立即解析的 Promise 中，因此锁只会在同步回调的持续时间内持有。</p>
                </dd>
            </dl>
            <p>返回的 <var>promise</var> 在锁释放后解析（或拒绝）回调的结果，如果请求被中止则拒绝。</p>
            <p>示例：</p>
            <pre class="language-js highlight"><c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> result <c- o>=</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
    <c- c1>// 此处持有锁。</c->
    <c- k>await</c-> do_something<c- p>();</c->
    <c- k>await</c-> do_something_else<c- p>();</c->
    <c- k>return</c-> <c- u>"ok"</c-><c- p>;</c->
    <c- c1>// 现在锁将被释放。</c->
  <c- p>});</c->
  <c- c1>// |result| 是回调的返回值。</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// 如果回调抛出错误，将在此处捕获。</c->
<c- p>}</c->
</pre>
            <p>当回调因任何原因退出时，无论是代码返回还是抛出，锁都将被释放。</p>
            <p>可以将 <var>options</var> 字典作为第二个参数指定；<var>callback</var> 参数始终在最后。</p>
            <dl>
                <dt data-md><var>options</var>.mode</dt>
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-mode" id="ref-for-dom-lockoptions-mode">mode</a></code>
                        选项可以是 "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑦">exclusive</a></code>"（如果未指定，默认为此）或
                        "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑤">shared</a></code>"。多个标签页或工作者可以以
                        "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑥">shared</a></code>"
                        模式持有对同一资源的锁，但在 "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑧">exclusive</a></code>"
                        模式下只能有一个标签页或工作者持有对资源的锁。</p>
                    <p>最常见的用途是允许多个读取器同时访问资源，但防止更改。一旦读取器锁被释放，单个排他写入器可以获取锁进行更改，随后可以是另一个排他写入器或更多共享读取器。</p>
                </dd>
            </dl>
            <pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->mode<c- o>:</c-> <c- t>'shared'</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// 锁在此处持有。其他上下文也可能以共享模式持有锁，</c->
  <c- c1>// 但没有其他上下文会以排他模式持有锁。</c->
<c- p>});</c->
</pre>
            <dl>
                <dt data-md><var>options</var>.ifAvailable</dt>
                <dd data-md>
                    <p>如果 <code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-ifavailable" id="ref-for-dom-lockoptions-ifavailable">ifAvailable</a></code>
                        选项为
                        <code>true</code>，则只有在无需额外等待的情况下才会授予锁。请注意，这仍然不是同步的；在许多用户代理中，这将需要跨进程通信以查看锁是否可以被授予。如果锁无法被授予，则回调会用
                        <code>null</code> 调用。（由于这是预期的，故请求不会被拒绝。）
                    </p>
                </dd>
            </dl>
            <pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->ifAvailable<c- o>:</c-> <c- kc>true</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->lock<c- p>)</c-> <c- p>{</c->
    <c- c1>// 没有获得锁。可能需要采取适当的行动。</c->
    <c- k>return</c-><c- p>;</c->
  <c- p>}</c->
  <c- c1>// 此处持有锁。</c->
<c- p>});</c->
</pre>
            <dl>
                <dt data-md><var>options</var>.signal</dt>
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-signal" id="ref-for-dom-lockoptions-signal">signal</a></code>
                        选项可以设置为一个 <code
                            class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code>。这允许中止锁请求，例如如果在及时的情况下请求未被授予：
                    </p>
                </dd>
            </dl>
            <pre class="language-js highlight"><c- a>const</c-> controller <c- o>=</c-> <c- ow>new</c-> AbortController<c- p>();</c-> setTimeout<c- p>(()</c-> <c- p>=></c-> controller<c- p>.</c->abort<c- p>(),</c-> <c- mf>200</c-><c- p>);</c-> <c- c1>// 最多等待 200ms。</c->
<c- k>try</c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->
    <c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->signal<c- o>:</c-> controller<c- p>.</c->signal<c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// 此处持有锁。</c->
  <c- p>});</c->
  <c- c1>// 在此完成锁的使用。</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// 如果定时器触发，|ex| 将是一个名称为 "AbortError" 的 DOMException。</c->
<c- p>}</c->
</pre>
            <p>如果在授予锁之前发出中止信号，则请求的 Promise 将以 <code
                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror">AbortError</a></code>
                被拒绝。一旦锁被授予，信号将被忽略。</p>
            <dl>
                <dt data-md><var>options</var>.steal</dt>
                <dd data-md>
                    <p>如果 <code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal">steal</a></code>
                        选项为 <code>true</code>，则将释放对该资源持有的任何锁（并且此类锁的 <a data-link-type="dfn"
                            href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise④">释放的
                            Promise</a> 将以 <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror①">AbortError</a></code>
                        解析），并授予请求，抢占任何排队的请求。</p>
                    <p>如果 Web 应用程序检测到不可恢复的状态 — 例如，一些协调点（如 Service Worker）确定持有锁的标签页不再响应 — 那么可以使用此选项 "窃取" 锁。</p>
                </dd>
            </dl>
        </div>
        <aside class="advisement"> 使用 <code
                class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal①">steal</a></code>
            选项时请谨慎。
            使用该选项时，之前持有锁的代码将会在没有保证它是唯一有权访问资源的上下文的情况下执行。
            同样，使用该选项的代码也无法保证其他上下文不会仍然像拥有对抽象资源的访问权一样继续执行。
            它是为需要在面对应用程序和/或用户代理缺陷时尝试恢复的 Web 应用程序而设计的，在这种情况下，行为已经不可预测。
        </aside>
        <div class="algorithm" data-algorithm="LockManager request method">
            <p>方法 <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-request"><code>request(<var>name</var>, <var>callback</var>)</code></dfn> 和
                <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-request-name-options-callback"><code>request(<var>name</var>, <var>options</var>, <var>callback</var>)</code></dfn>
                的步骤如下：
            </p>
            <ol>
                <li data-md>
                    <p>如果没有传递 <var>options</var>，则让 <var>options</var> 为一个新的 <code
                            class="idl"><a data-link-type="idl" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions①">LockOptions</a></code>
                        字典，其成员使用默认值。</p>
                <li data-md>
                    <p>让 <var>environment</var> 为 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①">this</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object①">相关设置对象</a>。</p>
                <li data-md>
                    <p>如果 <var>environment</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global">相关全局对象</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window">关联的文档</a> 不是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active">完全激活的</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>让 <var>manager</var> 为 <a data-link-type="dfn" href="#obtain-a-lock-manager"
                            id="ref-for-obtain-a-lock-manager">获取锁管理器</a> 的结果，给定 <var>environment</var>。如果返回失败，则返回 <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with①">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror">SecurityError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>name</var> 以 U+002D HYPHEN-MINUS (-) 开头，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with②">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>options</var>["<code>steal</code>"] 和 <var>options</var>["<code>ifAvailable</code>"] 都为
                        true，则返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with③">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror①">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>options</var>["<code>steal</code>"] 为 true 且 <var>options</var>["<code>mode</code>"] 不是
                        "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑨">exclusive</a></code>"，则返回
                        <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with④">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror②">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>options</var>["<code>signal</code>"] <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">存在</a>，且
                        <var>options</var>["<code>steal</code>"] 或 <var>options</var>["<code>ifAvailable</code>"] 为
                        true，则返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑤">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror③">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>options</var>["<code>signal</code>"] <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">存在</a> 且已 <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                            id="ref-for-abortsignal-aborted">中止</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑥">一个被拒绝的 Promise</a>，包含
                        <var>options</var>["<code>signal</code>"] 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason">中止原因</a>。
                    </p>
                <li data-md>
                    <p>让 <var>promise</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">一个新的
                            Promise</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#request-a-lock" id="ref-for-request-a-lock">请求一个锁</a>，传入
                        <var>promise</var>、当前的 <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent"
                            id="ref-for-agent⑦">代理</a>、<var>environment</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id"
                            id="ref-for-concept-environment-id">id</a>、<var>manager</var>、<var>callback</var>、<var>name</var>、<var>options</var>["<code>mode</code>"]、<var>options</var>["<code>ifAvailable</code>"]、<var>options</var>["<code>steal</code>"]
                        和 <var>options</var>["<code>signal</code>"]。
                    </p>
                <li data-md>
                    <p>返回 <var>promise</var>。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.2.2" id="api-lock-manager-query"><span class="secno">3.2.2.
            </span><span class="content">方法 <code
                    class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query①">query()</a></code></span><a
                class="self-link" href="#api-lock-manager-query"></a></h4>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager/query"
                        title="LockManager 接口的 query() 方法返回一个 Promise，该 Promise 解析为一个包含有关持有和等待中的锁的信息的对象。">LockManager/query</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <div class="domintro note" role="note">
            <dl>
                <dt data-md><var>state</var> = await navigator.locks.<code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query②">query</a></code>()
                </dt>
                <dd data-md>
                    <p>可以使用 <code
                            class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query③">query()</a></code>
                        方法为一个源生成 <a data-link-type="dfn" href="#lock-manager"
                            id="ref-for-lock-manager⑦">锁管理器</a>状态的快照，这允许 Web 应用程序检查其锁的使用情况，用于日志记录或调试目的。</p>
                    <p>返回的 Promise 解析为 <var>state</var>，这是一个普通的数据结构（即类似 JSON 的数据），其形式如下：</p>
            </dl>
            <pre class="language-js highlight"><c- p>{</c->
  held<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
  <c- p>],</c->
  pending<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"d341a5d0-1d8d-4224-be10-704d1ef92a15"</c-> <c- p>},</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
            <p><code>clientId</code> 字段对应于唯一的上下文（框架或工作者），并且是 <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/service-workers-1/#client" id="ref-for-client">Client</a></code>
                的 <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/service-workers-1/#dom-client-id" id="ref-for-dom-client-id">id</a></code>
                属性返回的相同值。</p>
        </div>
        <aside class="advisement"> 这些数据只是 <a data-link-type="dfn" href="#lock-manager"
                id="ref-for-lock-manager⑧">锁管理器</a> 状态在某个时间点的 <em>快照</em>。当数据返回到脚本时，实际的锁状态可能已经发生了变化。 </aside>
        <div class="algorithm" data-algorithm="query()" data-algorithm-for="LockManager">
            <p>方法 <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-query"><code>query()</code></dfn> 的步骤如下：</p>
            <ol>
                <li data-md>
                    <p>让 <var>environment</var> 为 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this②">this</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object②">相关设置对象</a>。</p>
                <li data-md>
                    <p>如果 <var>environment</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global①">相关全局对象</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window①">关联的文档</a> 不是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active①">完全激活的</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑦">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>让 <var>manager</var> 为 <a data-link-type="dfn" href="#obtain-a-lock-manager"
                            id="ref-for-obtain-a-lock-manager①">获取锁管理器</a> 的结果，给定 <var>environment</var>。如果返回失败，则返回 <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑧">一个被拒绝的 Promise</a>，带有一个 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror①">SecurityError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>让 <var>promise</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">一个新的
                            Promise</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps③">将步骤排入队列</a>以 <a data-link-type="dfn"
                            href="#snapshot-the-lock-state" id="ref-for-snapshot-the-lock-state">快照锁状态</a>，传入
                        <var>manager</var> 和 <var>promise</var> 到 <a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue②">锁任务队列</a>。
                    </p>
                <li data-md>
                    <p>返回 <var>promise</var>。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.3" id="api-lock"><span class="secno">3.3. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock②">Lock</a></code> 类</span><a
                class="self-link" href="#api-lock"></a></h3>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock"
                        title="Web Locks API 的 Lock 接口提供了锁的名称和模式。这可以是通过 LockManager.request() 接收的新请求锁，也可以是通过 LockManager.query() 返回的活动或排队中的锁记录。">Lock</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lock"><code><c- g>Lock</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name" id="ref-for-dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode②"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode" id="ref-for-dom-lock-mode"><c- g>mode</c-></a>;
};
</pre>
        <p><code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock③">Lock</a></code> 对象有一个关联的 <a
                data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑤">锁</a>。</p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock/name"
                        title="Lock 接口的 name 只读属性返回请求锁时传递给 LockManager.request 的名称。">Lock/name</a></p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export
                id="dom-lock-name"><code>name</code></dfn> 获取器的步骤是返回关联的 <a data-link-type="dfn" href="#lock-concept"
                id="ref-for-lock-concept①⑥">锁</a> 的 <a data-link-type="dfn" href="#lock-concept-name"
                id="ref-for-lock-concept-name②">名称</a>。</p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="此特性在所有当前的引擎中可用。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock/mode"
                        title="Lock 接口的 mode 只读属性返回请求锁时传递给 LockManager.request() 的访问模式。模式为“exclusive”（默认）或“shared”。">Lock/mode</a>
                </p>
                <p class="all-engines-text">在所有当前的引擎中可用。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4+</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69+</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (旧版)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>无</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>三星 Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export
                id="dom-lock-mode"><code>mode</code></dfn> 获取器的步骤是返回关联的 <a data-link-type="dfn" href="#lock-concept"
                id="ref-for-lock-concept①⑦">锁</a> 的 <a data-link-type="dfn" href="#lock-concept-mode"
                id="ref-for-lock-concept-mode①">模式</a>。</p>
        <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span
                class="content">算法</span><a class="self-link" href="#algorithms"></a></h2>
        <h3 class="heading settled" data-level="4.1" id="algorithm-request-lock"><span class="secno">4.1. </span><span
                class="content">请求锁</span><a class="self-link" href="#algorithm-request-lock"></a></h3>
        <div class="algorithm" data-algorithm="request a lock">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="request-a-lock">请求锁</dfn>，需使用
            <var>promise</var>、<var>agent</var>、<var>clientId</var>、<var>manager</var>、<var>callback</var>、<var>name</var>、<var>mode</var>、<var>ifAvailable</var>、<var>steal</var>
            和 <var>signal</var>：
            <ol>
                <li data-md>
                    <p>让 <var>request</var> 成为一个新的 <a data-link-type="dfn" href="#lock-request"
                            id="ref-for-lock-request⑦">锁请求</a>
                        (<var>agent</var>，<var>clientId</var>，<var>manager</var>，<var>name</var>，<var>mode</var>，<var>callback</var>，<var>promise</var>，<var>signal</var>)。
                    </p>
                <li data-md>
                    <p>如果存在 <var>signal</var>，则将算法 <a data-link-type="dfn" href="#signal-to-abort-the-request"
                            id="ref-for-signal-to-abort-the-request">信号中止请求</a> <var>request</var> 使用 <var>signal</var>
                        添加到 <var>signal</var> 中。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps④">将以下步骤排入队列</a>至 <a data-link-type="dfn"
                            href="#lock-task-queue" id="ref-for-lock-task-queue③">锁任务队列</a>：</p>
                    <ol>
                        <li data-md>
                            <p>让 <var>queueMap</var> 为 <var>manager</var> 的 <a data-link-type="dfn"
                                    href="#lock-manager-lock-request-queue-map"
                                    id="ref-for-lock-manager-lock-request-queue-map②">锁请求队列映射</a>。</p>
                        <li data-md>
                            <p>让 <var>queue</var> 成为从 <var>queueMap</var> 中获取 <var>name</var> 的 <a data-link-type="dfn"
                                    href="#get-the-lock-request-queue"
                                    id="ref-for-get-the-lock-request-queue①">锁请求队列</a> 的结果。</p>
                        <li data-md>
                            <p>让 <var>held</var> 为 <var>manager</var> 的 <a data-link-type="dfn"
                                    href="#lock-manager-held-lock-set"
                                    id="ref-for-lock-manager-held-lock-set①">持有锁集合</a>。</p>
                        <li data-md>
                            <p>如果 <var>steal</var> 为 true，则运行以下步骤：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                                            id="ref-for-list-iterate">对于每个</a> <var>lock</var> 属于 <var>held</var>：</p>
                                    <ol>
                                        <li data-md>
                                            <p>如果 <var>lock</var> 的 <a data-link-type="dfn" href="#lock-concept-name"
                                                    id="ref-for-lock-concept-name③">名称</a> 为 <var>name</var>，则运行以下步骤：
                                            </p>
                                            <ol>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://infra.spec.whatwg.org/#list-remove"
                                                            id="ref-for-list-remove">从</a> <var>held</var> 中 <a
                                                            data-link-type="dfn" href="#lock-concept"
                                                            id="ref-for-lock-concept①⑧">移除锁</a> <var>lock</var>。</p>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#reject"
                                                            id="ref-for-reject">拒绝</a> <var>lock</var> 的 <a
                                                            data-link-type="dfn" href="#lock-concept-released-promise"
                                                            id="ref-for-lock-concept-released-promise⑤">释放承诺</a>，错误为
                                                        "<code
                                                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror②">AbortError</a></code>"
                                                        <code
                                                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code>。
                                                    </p>
                                            </ol>
                                    </ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-prepend"
                                            id="ref-for-list-prepend">将</a> <var>request</var> 前置到 <var>queue</var> 中。
                                    </p>
                            </ol>
                        <li data-md>
                            <p>否则，运行以下步骤：</p>
                            <ol>
                                <li data-md>
                                    <p>如果 <var>ifAvailable</var> 为 true 且 <var>request</var> 不可 <a data-link-type="dfn"
                                            href="#grantable" id="ref-for-grantable">授予</a>，则将以下步骤<a
                                            data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                            id="ref-for-enqueue-the-following-steps⑤">排入队列</a>，在 <var>callback</var> 的<a
                                            data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                                            id="ref-for-relevant-settings-object③">相关设置对象</a>的<a data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"
                                            id="ref-for-responsible-event-loop">负责事件循环</a>中执行：</p>
                                    <ol>
                                        <li data-md>
                                            <p>让 <var>r</var> 成为<a data-link-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#invoke-a-callback-function"
                                                    id="ref-for-invoke-a-callback-function">调用</a>
                                                <var>callback</var>，并将 <code>null</code> 作为唯一参数的结果。
                                            </p>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                                    id="ref-for-resolve①">解决</a> <var>promise</var> 使用
                                                <var>r</var>，并终止这些步骤。
                                            </p>
                                    </ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue"
                                            id="ref-for-queue-enqueue">将</a> <var>request</var> 入列到 <var>queue</var> 中。
                                    </p>
                            </ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                                    id="ref-for-process-the-lock-request-queue">处理锁请求队列</a> <var>queue</var>。</p>
                    </ol>
                <li data-md>
                    <p>返回 <var>request</var>。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.2" id="algorithm-release-lock"><span class="secno">4.2. </span><span
                class="content">释放锁</span><a class="self-link" href="#algorithm-release-lock"></a></h3>
        <div class="algorithm" data-algorithm="release the lock">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="release-the-lock">释放锁</dfn> <var>lock</var>：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert">断言</a>：这些步骤在 <a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue④">锁任务队列</a>中执行。</p>
                <li data-md>
                    <p>让 <var>manager</var> 为 <var>lock</var> 的 <a data-link-type="dfn" href="#lock-concept-manager"
                            id="ref-for-lock-concept-manager">管理器</a>。</p>
                <li data-md>
                    <p>让 <var>queueMap</var> 为 <var>manager</var> 的 <a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map③">锁请求队列映射</a>。</p>
                <li data-md>
                    <p>让 <var>name</var> 为 <var>lock</var> 的 <a data-link-type="dfn" href="#resource-name"
                            id="ref-for-resource-name⑥">资源名称</a>。</p>
                <li data-md>
                    <p>让 <var>queue</var> 成为从 <var>queueMap</var> 中获取 <var>name</var> 的 <a data-link-type="dfn"
                            href="#get-the-lock-request-queue" id="ref-for-get-the-lock-request-queue②">锁请求队列</a> 的结果。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove①">从</a> <var>manager</var> 的 <a data-link-type="dfn"
                            href="#lock-manager-held-lock-set" id="ref-for-lock-manager-held-lock-set②">持有锁集合</a>中移除 <a
                            data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑨">锁</a> <var>lock</var>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                            id="ref-for-process-the-lock-request-queue①">处理锁请求队列</a> <var>queue</var>。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.3" id="algorithm-abort-request"><span class="secno">4.3. </span><span
                class="content">中止请求</span><a class="self-link" href="#algorithm-abort-request"></a></h3>
        <div class="algorithm" data-algorithm="abort the request">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="abort-the-request">中止请求</dfn>
            <var>request</var>：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert①">断言</a>：这些步骤在 <a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑤">锁任务队列</a>中执行。</p>
                <li data-md>
                    <p>让 <var>manager</var> 为 <var>request</var> 的 <a data-link-type="dfn" href="#lock-request-manager"
                            id="ref-for-lock-request-manager①">管理器</a>。</p>
                <li data-md>
                    <p>让 <var>name</var> 为 <var>request</var> 的 <a data-link-type="dfn" href="#lock-request-name"
                            id="ref-for-lock-request-name①">名称</a>。</p>
                <li data-md>
                    <p>让 <var>queueMap</var> 为 <var>manager</var> 的 <a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map④">锁请求队列映射</a>。</p>
                <li data-md>
                    <p>让 <var>queue</var> 成为从 <var>queueMap</var> 中获取 <var>name</var> 的 <a data-link-type="dfn"
                            href="#get-the-lock-request-queue" id="ref-for-get-the-lock-request-queue③">锁请求队列</a> 的结果。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove②">从</a> <var>queue</var> 中移除 <var>request</var>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                            id="ref-for-process-the-lock-request-queue②">处理锁请求队列</a> <var>queue</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="signal to abort the request">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="signal-to-abort-the-request">发送信号中止请求</dfn>
            <var>request</var>，使用 <var>signal</var>：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps⑥">将步骤排入队列</a>，将 <a data-link-type="dfn"
                            href="#abort-the-request" id="ref-for-abort-the-request①">中止请求</a> <var>request</var> 添加到 <a
                            data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue⑥">锁任务队列</a> 中。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">拒绝</a>
                        <var>request</var> 的 <a data-link-type="dfn" href="#lock-request-promise"
                            id="ref-for-lock-request-promise">承诺</a>，使用 <var>signal</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason①">中止原因</a>。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.4" id="algorithm-process-request"><span class="secno">4.4.
            </span><span class="content">处理给定资源名称的锁请求队列</span><a class="self-link"
                href="#algorithm-process-request"></a></h3>
        <div class="algorithm" data-algorithm="process the lock request queue">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="process-the-lock-request-queue">处理锁请求队列</dfn> <var>queue</var>：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert②">断言</a>：这些步骤在 <a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑦">锁任务队列</a>中执行。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate①">对</a> <var>queue</var> 中的每个 <var>request</var>：</p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>request</var> 不是 <a data-link-type="dfn" href="#grantable"
                                    id="ref-for-grantable①">可授予的</a>，则返回。</p>
                            <p class="note" role="note"><span>注意：</span>队列中只有第一个项目是可授予的。因此，如果某个项目不可授予，那么后面的所有项目也自动不可授予。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                                    id="ref-for-list-remove③">从</a> <var>queue</var> 中移除 <var>request</var>。</p>
                        <li data-md>
                            <p>让 <var>agent</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-concept-agent" id="ref-for-lock-concept-agent①">代理</a>。</p>
                        <li data-md>
                            <p>让 <var>manager</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-manager" id="ref-for-lock-request-manager②">管理器</a>。</p>
                        <li data-md>
                            <p>让 <var>clientId</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-clientid" id="ref-for-lock-request-clientid">客户端ID</a>。</p>
                        <li data-md>
                            <p>让 <var>name</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-name" id="ref-for-lock-request-name②">名称</a>。</p>
                        <li data-md>
                            <p>让 <var>mode</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-mode" id="ref-for-lock-request-mode①">模式</a>。</p>
                        <li data-md>
                            <p>让 <var>callback</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-callback" id="ref-for-lock-request-callback">回调函数</a>。</p>
                        <li data-md>
                            <p>让 <var>p</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-promise" id="ref-for-lock-request-promise①">承诺</a>。</p>
                        <li data-md>
                            <p>让 <var>signal</var> 为 <var>request</var> 的 <a data-link-type="dfn"
                                    href="#lock-request-signal" id="ref-for-lock-request-signal">信号</a>。</p>
                        <li data-md>
                            <p>让 <var>waiting</var> 为 <a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#a-new-promise"
                                    id="ref-for-a-new-promise②">一个新的承诺</a>。</p>
                        <li data-md>
                            <p>让 <var>lock</var> 成为一个新的 <a data-link-type="dfn" href="#lock-concept"
                                    id="ref-for-lock-concept②⓪">锁</a>，具有 <a data-link-type="dfn"
                                    href="#lock-concept-agent" id="ref-for-lock-concept-agent②">代理</a>
                                <var>agent</var>，<a data-link-type="dfn" href="#lock-concept-clientid"
                                    id="ref-for-lock-concept-clientid">客户端ID</a> <var>clientId</var>，<a
                                    data-link-type="dfn" href="#lock-concept-manager"
                                    id="ref-for-lock-concept-manager①">管理器</a> <var>manager</var>，<a
                                    data-link-type="dfn" href="#lock-concept-mode"
                                    id="ref-for-lock-concept-mode②">模式</a> <var>mode</var>，<a data-link-type="dfn"
                                    href="#lock-concept-name" id="ref-for-lock-concept-name④">名称</a> <var>name</var>，<a
                                    data-link-type="dfn" href="#lock-concept-released-promise"
                                    id="ref-for-lock-concept-released-promise⑥">释放承诺</a> <var>p</var>，以及 <a
                                    data-link-type="dfn" href="#lock-concept-waiting-promise"
                                    id="ref-for-lock-concept-waiting-promise⑤">等待承诺</a> <var>waiting</var>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                                    id="ref-for-set-append">追加</a> <var>lock</var> 到 <var>manager</var> 的 <a
                                    data-link-type="dfn" href="#lock-manager-held-lock-set"
                                    id="ref-for-lock-manager-held-lock-set③">持有锁集合</a>。</p>
                        <li data-md>
                            <p><a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                    id="ref-for-enqueue-the-following-steps⑦">将以下步骤排入队列</a>，在 <var>callback</var> 的 <a
                                    data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                                    id="ref-for-relevant-settings-object④">相关设置对象</a>的 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"
                                    id="ref-for-responsible-event-loop①">负责事件循环</a>中：</p>
                            <ol>
                                <li data-md>
                                    <p>如果 <var>signal</var> 存在，则运行以下步骤：</p>
                                    <ol>
                                        <li data-md>
                                            <p>如果 <var>signal</var> 被 <a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                                                    id="ref-for-abortsignal-aborted①">中止</a>，则运行以下步骤：</p>
                                            <ol>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                                            id="ref-for-enqueue-the-following-steps⑧">将以下步骤排入队列</a>到 <a
                                                            data-link-type="dfn" href="#lock-task-queue"
                                                            id="ref-for-lock-task-queue⑧">锁任务队列</a>：</p>
                                                    <ol>
                                                        <li data-md>
                                                            <p><a data-link-type="dfn" href="#release-the-lock"
                                                                    id="ref-for-release-the-lock②">释放锁</a>
                                                                <var>lock</var>。
                                                            </p>
                                                    </ol>
                                                <li data-md>
                                                    <p>返回。</p>
                                            </ol>
                                        <li data-md>
                                            <p><a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#abortsignal-remove"
                                                    id="ref-for-abortsignal-remove">移除</a>算法 <a data-link-type="dfn"
                                                    href="#signal-to-abort-the-request"
                                                    id="ref-for-signal-to-abort-the-request①">信号以中止请求</a>
                                                <var>request</var>，从 <var>signal</var> 中。
                                            </p>
                                    </ol>
                                <li data-md>
                                    <p>让 <var>r</var> 为通过 <a data-link-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#invoke-a-callback-function"
                                            id="ref-for-invoke-a-callback-function①">调用</a> <var>callback</var>，并以与
                                        <var>lock</var> 相关联的新 <code
                                            class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock④">Lock</a></code>
                                        对象作为唯一参数的结果。
                                    </p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                            id="ref-for-resolve②">解决</a> <var>waiting</var>，值为 <var>r</var>。</p>
                            </ol>
                    </ol>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.5" id="algorithm-snapshot-state"><span class="secno">4.5. </span><span
                class="content">快照锁状态</span><a class="self-link" href="#algorithm-snapshot-state"></a></h3>
        <div class="algorithm" data-algorithm="snapshot the lock state">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="snapshot-the-lock-state">为
                <var>manager</var> 生成锁状态的快照</dfn>，使用 <var>promise</var>：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert③">断言</a>：这些步骤在 <a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑨">锁任务队列</a>中执行。</p>
                <li data-md>
                    <p>让 <var>pending</var> 为一个新的 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list">列表</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate"
                            id="ref-for-map-iterate">对</a> <var>manager</var> 的 <a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map⑤">锁请求队列映射</a>中的每个 <var>queue</var> 的 <a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values"
                            id="ref-for-map-getting-the-values">值</a>：</p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                                    id="ref-for-list-iterate②">对</a> <var>queue</var> 中的每个 <var>request</var>：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                            id="ref-for-list-append">将</a> «[ "name" → <var>request</var> 的 <a
                                            data-link-type="dfn" href="#lock-request-name"
                                            id="ref-for-lock-request-name③">名称</a>，"mode" → <var>request</var> 的 <a
                                            data-link-type="dfn" href="#lock-request-mode"
                                            id="ref-for-lock-request-mode②">模式</a>，"clientId" → <var>request</var> 的 <a
                                            data-link-type="dfn" href="#lock-request-clientid"
                                            id="ref-for-lock-request-clientid①">客户端ID</a> ]» 添加到 <var>pending</var>。</p>
                            </ol>
                    </ol>
                <li data-md>
                    <p>让 <var>held</var> 为一个新的 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list①">列表</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate③">对</a> <var>manager</var> 的 <a data-link-type="dfn"
                            href="#lock-manager-held-lock-set" id="ref-for-lock-manager-held-lock-set④">持有锁集合</a>中的每个
                        <var>lock</var>：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                    id="ref-for-list-append①">将</a> «[ "name" → <var>lock</var> 的 <a
                                    data-link-type="dfn" href="#lock-concept-name"
                                    id="ref-for-lock-concept-name⑤">名称</a>，"mode" → <var>lock</var> 的 <a
                                    data-link-type="dfn" href="#lock-concept-mode"
                                    id="ref-for-lock-concept-mode③">模式</a>，"clientId" → <var>lock</var> 的 <a
                                    data-link-type="dfn" href="#lock-concept-clientid"
                                    id="ref-for-lock-concept-clientid①">客户端ID</a> ]» 添加到 <var>held</var>。</p>
                    </ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                            id="ref-for-resolve③">解决</a> <var>promise</var>，值为 «[ "held" → <var>held</var>，"pending" →
                        <var>pending</var> ]»。
                    </p>
            </ol>
        </div>
        <aside class="note">
            <p> 对于任何给定的资源，待处理锁请求的快照将按请求的顺序返回；然而，不能保证不同资源之间的请求顺序。例如，如果对资源 A 按顺序进行了 A1 和 A2 请求，对资源 B 按顺序进行了 B1 和 B2 请求，则
                «A1, A2, B1, B2» 和 «A1, B1, A2, B2» 都是快照中待处理列表的可能排序。</p>
            <p> 对于持有锁状态的快照，没有排序保证。</p>
        </aside>
        <h2 class="heading settled" data-level="5" id="usage-considerations"><span class="secno">5. </span><span
                class="content">使用注意事项</span><a class="self-link" href="#usage-considerations"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <h3 class="heading settled" data-level="5.1" id="deadlocks"><span class="secno">5.1. </span><span
                class="content">死锁</span><a class="self-link" href="#deadlocks"></a></h3>
        <p><a href="https://en.wikipedia.org/wiki/Deadlock">死锁</a>是并发计算中的一个概念，通过此 API 可以引入限制在特定 <a data-link-type="dfn"
                href="#lock-manager" id="ref-for-lock-manager⑨">锁管理器</a>的死锁。</p>
        <aside class="example" id="example-deadlocks">
            <a class="self-link" href="#example-deadlocks"></a> 通过使用此 API 可能遇到死锁的一个示例如下。
            <p>脚本 1：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
    <c- c1>// 使用 A 和 B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
            <p>脚本 2：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
    <c- c1>// 使用 A 和 B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
            <p>如果脚本 1 和脚本 2 几乎同时运行，有可能脚本 1 持有锁 A，而脚本 2 持有锁 B，且双方都无法进一步进展 - 出现死锁。这不会影响整个用户代理、暂停标签页或影响同源的其他脚本，但此特定功能将被阻塞。
            </p>
        </aside>
        <p>防止死锁需要小心。一种方法是始终按照严格的顺序获取多个锁。</p>
        <aside class="example" id="example-request-multiple-locks">
            <a class="self-link" href="#example-request-multiple-locks"></a>
            <p>可以使用如下的辅助函数来以一致的顺序请求多个锁。</p>
            <pre class="language-js highlight"><c- k>async</c-> <c- a>function</c-> requestMultiple<c- p>(</c->resources<c- p>,</c-> callback<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> sortedResources <c- o>=</c-> <c- p>[...</c->resources<c- p>];</c->
  sortedResources<c- p>.</c->sort<c- p>();</c-> <c- c1>// 始终按相同顺序请求。</c->

  <c- k>async</c-> <c- a>function</c-> requestNext<c- p>(</c->locks<c- p>)</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->sortedResources<c- p>.</c->shift<c- p>(),</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// 现在持有此锁，加上所有之前请求的锁。</c->
      locks<c- p>.</c->push<c- p>(</c->lock<c- p>);</c->

      <c- c1>// 如果需要，递归请求下一个锁。</c->
      <c- k>if</c-> <c- p>(</c->sortedResources<c- p>.</c->length <c- o>></c-> <c- mf>0</c-><c- p>)</c->
        <c- k>return</c-> <c- k>await</c-> requestNext<c- p>(</c->locks<c- p>);</c->

      <c- c1>// 否则，运行回调。</c->
      <c- k>return</c-> <c- k>await</c-> callback<c- p>(</c->locks<c- p>);</c->

      <c- c1>// 当回调返回（或抛出）时，所有锁将被释放。</c->
    <c- p>});</c->
  <c- p>}</c->
  <c- k>return</c-> <c- k>await</c-> requestNext<c- p>([]);</c->
<c- p>}</c->
</pre>
            <p>实际上，使用多个锁往往不如表面看起来那么简单——库和其他工具往往会无意中模糊它们的使用。</p>
        </aside>
        <h2 class="heading settled" data-level="6" id="security-privacy"><span class="secno">6. </span><span
                class="content">安全和隐私注意事项</span><a class="self-link" href="#security-privacy"></a></h2>
        <h3 class="heading settled" data-level="6.1" id="security-scope"><span class="secno">6.1. </span><span
                class="content">锁的作用域</span><a class="self-link" href="#security-scope"></a></h3>
        <p><a data-link-type="dfn" href="#lock-manager"
                id="ref-for-lock-manager①⓪">锁管理器</a>的作用域定义很重要，因为它定义了一个隐私边界。锁可以用作临时状态保留机制，像存储 API
            一样，也可以用作通信机制，并且其权限不能高于存储设施。对某些服务施加更细粒度的用户代理也必须对其他服务施加相同的粒度；例如，出于隐私原因，对顶级页面（第一方）和同源的跨域
            iframe（第三方）暴露不同存储分区的用户代理也必须同样对锁进行分区。</p>
        <p>这也为 Web 应用程序作者提供了合理的期望；如果对存储资源获取锁，所有同源浏览上下文必须观察到相同的状态。</p>
        <h3 class="heading settled" data-level="6.2" id="private-browsing"><span class="secno">6.2. </span><span
                class="content">隐私浏览</span><a class="self-link" href="#private-browsing"></a></h3>
        <p>每个<a href="https://github.com/w3ctag/private-mode">私密模式</a>浏览会话在此 API
            中被视为一个独立的用户代理。也就是说，在此类会话外请求/持有的锁不会影响此类会话内请求/持有的锁，反之亦然。这防止了网站确定会话是否为“隐私模式”，同时也不允许会话之间通过此类锁进行通信。</p>
        <h3 class="heading settled" data-level="6.3" id="implementation-risks"><span class="secno">6.3. </span><span
                class="content">实现风险</span><a class="self-link" href="#implementation-risks"></a></h3>
        <p>实现时必须确保锁不会跨越不同的来源。如果不这样做，将为在两个不同来源中运行的脚本提供通信侧信道，或允许一个来源中的脚本破坏另一个来源的行为（例如拒绝服务）。</p>
        <h3 class="heading settled" data-level="6.4" id="security-privacy-checklist"><span class="secno">6.4.
            </span><span class="content">检查清单</span><a class="self-link" href="#security-privacy-checklist"></a></h3>
        <p>W3C TAG 为规范编辑者开发了<a
                href="https://www.w3.org/TR/security-privacy-questionnaire/">安全与隐私自我评审问卷</a>以提供信息性答案。回顾以下问题：</p>
        <ul>
            <li data-md>
                <p>本规范不涉及可识别个人身份的信息或高价值数据。</p>
            <li data-md>
                <p>未引入跨浏览会话持续的任何新来源状态。</p>
            <li data-md>
                <p>未向 Web 暴露任何新的跨源持久状态。</p>
            <li data-md>
                <p>未向一个来源暴露其当前无法访问的任何新数据（例如，通过轮询 <a data-link-type="biblio" href="#biblio-indexeddb-2"
                        title="Indexed Database API 2.0">[IndexedDB-2]</a>）。</p>
            <li data-md>
                <p>未启用任何新的脚本执行/加载机制。</p>
            <li data-md>
                <p>本规范不允许来源访问以下任何内容：</p>
                <ul>
                    <li data-md>
                        <p>用户的位置。</p>
                    <li data-md>
                        <p>用户设备上的传感器。</p>
                    <li data-md>
                        <p>用户本地计算环境的各个方面。</p>
                    <li data-md>
                        <p>访问其他设备。</p>
                    <li data-md>
                        <p>对用户代理原生 UI 的任何控制。</p>
                </ul>
            <li data-md>
                <p>未向 Web 暴露任何临时标识符。所有<a data-link-type="dfn" href="#resource-name"
                        id="ref-for-resource-name⑦">资源名称</a>由 Web 应用程序本身提供。</p>
            <li data-md>
                <p>如果区分存储，则用户代理在第一方和第三方上下文中的行为应区分。请参见<a href="#security-scope">§ 6.1 锁的作用域</a>。</p>
            <li data-md>
                <p>在用户代理“隐私模式”上下文中的行为在<a href="#private-browsing">§ 6.2 隐私浏览</a>中描述。</p>
            <li data-md>
                <p>此 API 不会将数据持久化到用户的本地设备中。</p>
            <li data-md>
                <p>此 API 不允许降低默认的安全特性。</p>
        </ul>
        <h2 class="heading settled" data-level="7" id="acknowledgements"><span class="secno">7. </span><span
                class="content">致谢</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p>特别感谢 Alex Russell、Andreas Butler、Anne van Kesteren、Boris Zbarsky、Chris Messina、Darin Fisher、Domenic
            Denicola、Gus Caplan、Harald Alvestrand、Jake Archibald、Kagami Sascha Rosylight、L. David Baron、Luciano
            Pacheco、Marcos Caceres、Ralph Chelala、Raymond Toy、Ryan Fioravanti 和 Victor Costan 对本提案的帮助。</p>
        <p>特别感谢 Tab Atkins, Jr. 创建和维护了用于编写本规范的<a
                href="https://github.com/tabatkins/bikeshed">Bikeshed</a>工具，并提供了总体的编写建议。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档约定</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求是通过描述性断言和 RFC 2119 术语的组合来表达的。在本文件的规范部分中，“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL
            NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”和“OPTIONAL”这些关键词应按照 RFC 2119
            中的描述进行解释。不过，为了可读性，这些词语在本规范中不全以大写字母表示。</p>
        <p>本规范的所有文本都是规范性内容，除非明确标记为非规范性部分、示例或注释。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
        <p>本规范中的示例由“例如”一词引入，或与规范性文本分开，使用 <code>class="example"</code> 进行标记，如下所示：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个信息性示例。</p>
        </div>
        <p>信息性注释以“注意”一词开头，并与规范性文本分开，使用 <code>class="note"</code> 进行标记，如下所示：</p>
        <p class="note" role="note">注意，这是一个信息性注释。</p>
        <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">一致性算法</span><a
                class="self-link" href="#w3c-conformant-algorithms"></a></h3>
        <p>在算法部分以命令形式表述的要求（如“去除所有前导空格字符”或“返回 false 并中止这些步骤”），应根据引入该算法时使用的关键词（如“必须”、“应当”、“可以”等）来解释其含义。</p>
        <p>以算法或特定步骤形式表述的一致性要求可以通过任何方式实现，只要最终结果是等效的即可。特别是，本规范中定义的算法旨在易于理解，而非旨在高效实现。建议实现者进行优化。</p>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#abort-the-request">中止请求</a><span>，见 § 4.3</span>
        <li>代理
            <ul>
                <li><a href="#lock-request-agent">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#lock-concept-agent">锁概念的定义</a><span>，见 § 2.4</span>
            </ul>
        <li><a href="#lock-request-callback">回调</a><span>，见 § 2.5</span>
        <li>客户端 ID
            <ul>
                <li><a href="#lock-request-clientid">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#lock-concept-clientid">锁概念的定义</a><span>，见 § 2.4</span>
                <li><a href="#dom-lockinfo-clientid">LockInfo 的字典成员</a><span>，见 § 3.2</span>
            </ul>
        <li><a href="#dom-lockmode-exclusive">"独占"</a><span>，见 § 3.2</span>
        <li><a href="#get-the-lock-request-queue">获取锁请求队列</a><span>，见 § 2.5</span>
        <li><a href="#grantable">可授予</a><span>，见 § 2.5</span>
        <li><a href="#dom-lockmanagersnapshot-held">已持有</a><span>，见 § 3.2</span>
        <li><a href="#lock-manager-held-lock-set">已持有的锁集合</a><span>，见 § 2.4</span>
        <li><a href="#dom-lockoptions-ifavailable">ifAvailable</a><span>，见 § 3.2</span>
        <li><a href="#lock">锁 (Lock)</a><span>，见 § 3.3</span>
        <li><a href="#lock-concept">锁概念</a><span>，见 § 2.4</span>
        <li><a href="#callbackdef-lockgrantedcallback">LockGrantedCallback</a><span>，见 § 3.2</span>
        <li><a href="#dictdef-lockinfo">LockInfo</a><span>，见 § 3.2</span>
        <li><a href="#lock-manager">锁管理器</a><span>，见 § 2.2</span>
        <li><a href="#lockmanager">LockManager</a><span>，见 § 3.2</span>
        <li><a href="#dictdef-lockmanagersnapshot">LockManagerSnapshot</a><span>，见 § 3.2</span>
        <li><a href="#enumdef-lockmode">LockMode</a><span>，见 § 3.2</span>
        <li><a href="#dictdef-lockoptions">LockOptions</a><span>，见 § 3.2</span>
        <li><a href="#lock-request">锁请求</a><span>，见 § 2.5</span>
        <li><a href="#lock-request-queue">锁请求队列</a><span>，见 § 2.5</span>
        <li><a href="#lock-manager-lock-request-queue-map">锁请求队列映射</a><span>，见 § 2.5</span>
        <li><a href="#dom-navigatorlocks-locks">locks</a><span>，见 § 3.1</span>
        <li><a href="#lock-task-queue">锁任务队列</a><span>，见 § 2</span>
        <li>管理器
            <ul>
                <li><a href="#lock-request-manager">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#lock-concept-manager">锁概念的定义</a><span>，见 § 2.4</span>
            </ul>
        <li>模式
            <ul>
                <li><a href="#dom-lock-mode">Lock 的属性</a><span>，见 § 3.3</span>
                <li><a href="#mode">模式定义</a><span>，见 § 2.3</span>
                <li><a href="#lock-request-mode">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#lock-concept-mode">锁概念的定义</a><span>，见 § 2.4</span>
                <li><a href="#dom-lockinfo-mode">LockInfo 的字典成员</a><span>，见 § 3.2</span>
                <li><a href="#dom-lockoptions-mode">LockOptions 的字典成员</a><span>，见 § 3.2</span>
            </ul>
        <li>名称
            <ul>
                <li><a href="#dom-lock-name">Lock 的属性</a><span>，见 § 3.3</span>
                <li><a href="#lock-request-name">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#lock-concept-name">锁概念的定义</a><span>，见 § 2.4</span>
                <li><a href="#dom-lockinfo-name">LockInfo 的字典成员</a><span>，见 § 3.2</span>
            </ul>
        <li><a href="#navigatorlocks">NavigatorLocks</a><span>，见 § 3.1</span>
        <li><a href="#obtain-a-lock-manager">获取锁管理器</a><span>，见 § 2.2</span>
        <li><a href="#dom-lockmanagersnapshot-pending">待定</a><span>，见 § 3.2</span>
        <li><a href="#process-the-lock-request-queue">处理锁请求队列</a><span>，见 § 4.4</span>
        <li><a href="#lock-request-promise">承诺 (promise)</a><span>，见 § 2.5</span>
        <li><a href="#dom-lockmanager-query">query()</a><span>，见 § 3.2.2</span>
        <li><a href="#lock-concept-released-promise">已释放的承诺</a><span>，见 § 2.4</span>
        <li><a href="#release-the-lock">释放锁</a><span>，见 § 4.2</span>
        <li><a href="#request-a-lock">请求锁</a><span>，见 § 4.1</span>
        <li><a href="#dom-lockmanager-request">request(name, callback)</a><span>，见 § 3.2.1</span>
        <li><a href="#dom-lockmanager-request-name-options-callback">request(name, options, callback)</a><span>，见
                § 3.2.1</span>
        <li><a href="#resource-name">资源名称</a><span>，见 § 2.1</span>
        <li><a href="#dom-lockmode-shared">"共享"</a><span>，见 § 3.2</span>
        <li>信号
            <ul>
                <li><a href="#lock-request-signal">锁请求的定义</a><span>，见 § 2.5</span>
                <li><a href="#dom-lockoptions-signal">LockOptions 的字典成员</a><span>，见 § 3.2</span>
            </ul>
        <li><a href="#signal-to-abort-the-request">信号以中止请求</a><span>，见 § 4.3</span>
        <li><a href="#snapshot-the-lock-state">锁状态快照</a><span>，见 § 4.5</span>
        <li><a href="#dom-lockoptions-steal">steal</a><span>，见 § 3.2</span>
        <li><a href="#terminate-remaining-locks-and-requests">终止剩余锁和请求</a><span>，见 § 2.6</span>
        <li><a href="#lock-concept-waiting-promise">等待的承诺</a><span>，见 § 2.4</span>
        <li><a href="#web-locks-tasks-source">Web 锁任务源</a><span>，见 § 2</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-user-agent">
        <a
            href="https://www.w3.org/TR/CSS2/conform.html#user-agent">https://www.w3.org/TR/CSS2/conform.html#user-agent</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-user-agent">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal">
        <a href="https://dom.spec.whatwg.org/#abortsignal">https://dom.spec.whatwg.org/#abortsignal</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal">3.2. LockManager class</a>
            <li><a href="#ref-for-abortsignal①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-abort-reason">
        <a
            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason">https://dom.spec.whatwg.org/#abortsignal-abort-reason</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-abort-reason">3.2.1. The request() method</a>
            <li><a href="#ref-for-abortsignal-abort-reason①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-aborted">
        <a
            href="https://dom.spec.whatwg.org/#abortsignal-aborted">https://dom.spec.whatwg.org/#abortsignal-aborted</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-aborted">3.2.1. The request() method</a>
            <li><a href="#ref-for-abortsignal-aborted①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-add">
        <a href="https://dom.spec.whatwg.org/#abortsignal-add">https://dom.spec.whatwg.org/#abortsignal-add</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-add">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document">
        <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-remove">
        <a href="https://dom.spec.whatwg.org/#abortsignal-remove">https://dom.spec.whatwg.org/#abortsignal-remove</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-remove">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-agent">
        <a href="https://tc39.github.io/ecma262/#agent">https://tc39.github.io/ecma262/#agent</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-agent">1. Introduction</a> <a href="#ref-for-agent①">(2)</a>
            <li><a href="#ref-for-agent②">2.1. Resources Names</a>
            <li><a href="#ref-for-agent③">2.2. Lock Managers</a>
            <li><a href="#ref-for-agent④">2.4. Locks</a>
            <li><a href="#ref-for-agent⑤">2.6. Termination of Locks</a> <a href="#ref-for-agent⑥">(2)</a>
            <li><a href="#ref-for-agent⑦">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-navigator">
        <a
            href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">https://html.spec.whatwg.org/multipage/system-state.html#navigator</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-navigator">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-workernavigator">
        <a
            href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">https://html.spec.whatwg.org/multipage/workers.html#workernavigator</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-workernavigator">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-integration-with-the-javascript-agent-cluster-formalism">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism">https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-integration-with-the-javascript-agent-cluster-formalism">1. Introduction</a> <a
                    href="#ref-for-integration-with-the-javascript-agent-cluster-formalism①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document-window">
        <a
            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document-window">3.2.1. The request() method</a>
            <li><a href="#ref-for-concept-document-window①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-browsing-context">
        <a
            href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context">https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-browsing-context">2.2. Lock Managers</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-enqueue-the-following-steps">2. Concepts</a>
            <li><a href="#ref-for-enqueue-the-following-steps①">2.4. Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps②">2.6. Termination of Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps③">3.2.2. The query() method</a>
            <li><a href="#ref-for-enqueue-the-following-steps④">4.1. Request a lock</a> <a
                    href="#ref-for-enqueue-the-following-steps⑤">(2)</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑥">4.3. Abort a request</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑦">4.4. Process a lock request queue for a given resource
                    name</a> <a href="#ref-for-enqueue-the-following-steps⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-enqueue-the-following-steps">2. Concepts</a>
            <li><a href="#ref-for-enqueue-the-following-steps①">2.4. Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps②">2.6. Termination of Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps③">3.2.2. The query() method</a>
            <li><a href="#ref-for-enqueue-the-following-steps④">4.1. Request a lock</a> <a
                    href="#ref-for-enqueue-the-following-steps⑤">(2)</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑥">4.3. Abort a request</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑦">4.4. Process a lock request queue for a given resource
                    name</a> <a href="#ref-for-enqueue-the-following-steps⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-environment-settings-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-environment-settings-object">2.2. Lock Managers</a>
            <li><a href="#ref-for-environment-settings-object①">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-fully-active">
        <a
            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active">https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-fully-active">3.2.1. The request() method</a>
            <li><a href="#ref-for-fully-active①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-environment-id">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-environment-id">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-relevant-global">3.2.1. The request() method</a>
            <li><a href="#ref-for-concept-relevant-global①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-relevant-settings-object">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-relevant-settings-object①">3.2.1. The request() method</a>
            <li><a href="#ref-for-relevant-settings-object②">3.2.2. The query() method</a>
            <li><a href="#ref-for-relevant-settings-object③">4.1. Request a lock</a>
            <li><a href="#ref-for-relevant-settings-object④">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-responsible-event-loop">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-responsible-event-loop">4.1. Request a lock</a>
            <li><a href="#ref-for-responsible-event-loop①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-starting-a-new-parallel-queue">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue">https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-starting-a-new-parallel-queue">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-task-source">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-task-source">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-unloading-document-cleanup-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps">https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-unloading-document-cleanup-steps">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-append">
        <a href="https://infra.spec.whatwg.org/#list-append">https://infra.spec.whatwg.org/#list-append</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-append">4.5. Snapshot the lock state</a> <a href="#ref-for-list-append①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-set-append">
        <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-set-append">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-assert">
        <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-assert">4.2. Release a lock</a>
            <li><a href="#ref-for-assert①">4.3. Abort a request</a>
            <li><a href="#ref-for-assert②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-assert③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue-enqueue">
        <a href="https://infra.spec.whatwg.org/#queue-enqueue">https://infra.spec.whatwg.org/#queue-enqueue</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-queue-enqueue">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-exists">
        <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-exists">2.5. Lock Requests</a>
            <li><a href="#ref-for-map-exists①">3.2.1. The request() method</a> <a href="#ref-for-map-exists②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-iterate">
        <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-iterate">4.1. Request a lock</a>
            <li><a href="#ref-for-list-iterate①">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-list-iterate②">4.5. Snapshot the lock state</a> <a
                    href="#ref-for-list-iterate③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-iterate">
        <a href="https://infra.spec.whatwg.org/#map-iterate">https://infra.spec.whatwg.org/#map-iterate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-iterate">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-is-empty">
        <a href="https://infra.spec.whatwg.org/#list-is-empty">https://infra.spec.whatwg.org/#list-is-empty</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-is-empty">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-item">
        <a href="https://infra.spec.whatwg.org/#list-item">https://infra.spec.whatwg.org/#list-item</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-item">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct-item">
        <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-struct-item">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-string">
        <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-string">2.1. Resources Names</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list">
        <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-list">4.5. Snapshot the lock state</a> <a href="#ref-for-list①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-ordered-map">
        <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-ordered-map">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-prepend">
        <a href="https://infra.spec.whatwg.org/#list-prepend">https://infra.spec.whatwg.org/#list-prepend</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-prepend">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue">
        <a href="https://infra.spec.whatwg.org/#queue">https://infra.spec.whatwg.org/#queue</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-queue">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-remove">
        <a href="https://infra.spec.whatwg.org/#list-remove">https://infra.spec.whatwg.org/#list-remove</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-remove">4.1. Request a lock</a>
            <li><a href="#ref-for-list-remove①">4.2. Release a lock</a>
            <li><a href="#ref-for-list-remove②">4.3. Abort a request</a>
            <li><a href="#ref-for-list-remove③">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-ordered-set">
        <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-ordered-set">2.4. Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-set">
        <a href="https://infra.spec.whatwg.org/#map-set">https://infra.spec.whatwg.org/#map-set</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-map-set">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct">
        <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-struct">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-getting-the-values">
        <a
            href="https://infra.spec.whatwg.org/#map-getting-the-values">https://infra.spec.whatwg.org/#map-getting-the-values</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-getting-the-values">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-client">
        <a href="https://www.w3.org/TR/service-workers-1/#client">https://www.w3.org/TR/service-workers-1/#client</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-client">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-client-id">
        <a
            href="https://www.w3.org/TR/service-workers-1/#dom-client-id">https://www.w3.org/TR/service-workers-1/#dom-client-id</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-client-id">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-obtain-a-local-storage-bottle-map">
        <a
            href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map">https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-obtain-a-local-storage-bottle-map">2.2. Lock Managers</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-storage-bottle">
        <a href="https://storage.spec.whatwg.org/#storage-bottle">https://storage.spec.whatwg.org/#storage-bottle</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-storage-bottle">2.2. Lock Managers</a> <a href="#ref-for-storage-bottle①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-storage-bucket">
        <a href="https://storage.spec.whatwg.org/#storage-bucket">https://storage.spec.whatwg.org/#storage-bucket</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-storage-bucket">1. Introduction</a>
            <li><a href="#ref-for-storage-bucket①">2.1. Resources Names</a>
            <li><a href="#ref-for-storage-bucket②">2.2. Lock Managers</a> <a href="#ref-for-storage-bucket③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-aborterror">
        <a href="https://webidl.spec.whatwg.org/#aborterror">https://webidl.spec.whatwg.org/#aborterror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-aborterror">3.2.1. The request() method</a> <a href="#ref-for-aborterror①">(2)</a>
            <li><a href="#ref-for-aborterror②">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMException">
        <a
            href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMException">3.2.1. The request() method</a> <a
                    href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a
                    href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a
                    href="#ref-for-idl-DOMException⑤">(6)</a>
            <li><a href="#ref-for-idl-DOMException⑥">3.2.2. The query() method</a> <a
                    href="#ref-for-idl-DOMException⑦">(2)</a>
            <li><a href="#ref-for-idl-DOMException⑧">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.2. LockManager class</a> <a href="#ref-for-idl-DOMString①">(2)</a> <a
                    href="#ref-for-idl-DOMString②">(3)</a> <a href="#ref-for-idl-DOMString③">(4)</a>
            <li><a href="#ref-for-idl-DOMString④">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">3.2. LockManager class</a>
            <li><a href="#ref-for-Exposed①">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-invalidstateerror">
        <a
            href="https://webidl.spec.whatwg.org/#invalidstateerror">https://webidl.spec.whatwg.org/#invalidstateerror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-invalidstateerror">3.2.1. The request() method</a>
            <li><a href="#ref-for-invalidstateerror①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-notsupportederror">
        <a
            href="https://webidl.spec.whatwg.org/#notsupportederror">https://webidl.spec.whatwg.org/#notsupportederror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-notsupportederror">3.2.1. The request() method</a> <a
                    href="#ref-for-notsupportederror①">(2)</a> <a href="#ref-for-notsupportederror②">(3)</a> <a
                    href="#ref-for-notsupportederror③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-promise">
        <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-promise">3.2. LockManager class</a> <a href="#ref-for-idl-promise①">(2)</a> <a
                    href="#ref-for-idl-promise②">(3)</a> <a href="#ref-for-idl-promise③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-SecureContext">
        <a href="https://webidl.spec.whatwg.org/#SecureContext">https://webidl.spec.whatwg.org/#SecureContext</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-SecureContext">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-SecureContext①">3.2. LockManager class</a>
            <li><a href="#ref-for-SecureContext②">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-securityerror">
        <a href="https://webidl.spec.whatwg.org/#securityerror">https://webidl.spec.whatwg.org/#securityerror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-securityerror">3.2.1. The request() method</a>
            <li><a href="#ref-for-securityerror①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-a-new-promise">
        <a href="https://webidl.spec.whatwg.org/#a-new-promise">https://webidl.spec.whatwg.org/#a-new-promise</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-a-new-promise">3.2.1. The request() method</a>
            <li><a href="#ref-for-a-new-promise①">3.2.2. The query() method</a>
            <li><a href="#ref-for-a-new-promise②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
        <a
            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with">https://webidl.spec.whatwg.org/#a-promise-rejected-with</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-a-promise-rejected-with">3.2.1. The request() method</a> <a
                    href="#ref-for-a-promise-rejected-with①">(2)</a> <a href="#ref-for-a-promise-rejected-with②">(3)</a>
                <a href="#ref-for-a-promise-rejected-with③">(4)</a> <a href="#ref-for-a-promise-rejected-with④">(5)</a>
                <a href="#ref-for-a-promise-rejected-with⑤">(6)</a> <a href="#ref-for-a-promise-rejected-with⑥">(7)</a>
            <li><a href="#ref-for-a-promise-rejected-with⑦">3.2.2. The query() method</a> <a
                    href="#ref-for-a-promise-rejected-with⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-any">
        <a href="https://webidl.spec.whatwg.org/#idl-any">https://webidl.spec.whatwg.org/#idl-any</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-any">3.2. LockManager class</a> <a href="#ref-for-idl-any①">(2)</a> <a
                    href="#ref-for-idl-any②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-boolean">
        <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-boolean">3.2. LockManager class</a> <a href="#ref-for-idl-boolean①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-callback-function">
        <a
            href="https://webidl.spec.whatwg.org/#dfn-callback-function">https://webidl.spec.whatwg.org/#dfn-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-callback-function">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-invoke-a-callback-function">
        <a
            href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">https://webidl.spec.whatwg.org/#invoke-a-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-invoke-a-callback-function">4.1. Request a lock</a>
            <li><a href="#ref-for-invoke-a-callback-function①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-reject">
        <a href="https://webidl.spec.whatwg.org/#reject">https://webidl.spec.whatwg.org/#reject</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-reject">4.1. Request a lock</a>
            <li><a href="#ref-for-reject①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-resolve">
        <a href="https://webidl.spec.whatwg.org/#resolve">https://webidl.spec.whatwg.org/#resolve</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-resolve">2.4. Locks</a>
            <li><a href="#ref-for-resolve①">4.1. Request a lock</a>
            <li><a href="#ref-for-resolve②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-resolve③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-sequence">
        <a href="https://webidl.spec.whatwg.org/#idl-sequence">https://webidl.spec.whatwg.org/#idl-sequence</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-sequence">3.2. LockManager class</a> <a href="#ref-for-idl-sequence①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-this">
        <a href="https://webidl.spec.whatwg.org/#this">https://webidl.spec.whatwg.org/#this</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-this">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-this①">3.2.1. The request() method</a>
            <li><a href="#ref-for-this②">3.2.2. The query() method</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">通过引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li><a data-link-type="biblio">[CSS21]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-user-agent">用户代理</span>
            </ul>
        <li><a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-abortsignal">AbortSignal</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-abort-reason">中止原因</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-aborted">已中止</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-add">添加</span>
                <li><span class="dfn-paneled" id="term-for-concept-document">文档</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-remove">移除</span>
            </ul>
        <li><a data-link-type="biblio">[ECMA262]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-agent">代理</span>
            </ul>
        <li><a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-navigator">Navigator</span>
                <li><span class="dfn-paneled" id="term-for-workernavigator">WorkerNavigator</span>
                <li><span class="dfn-paneled"
                        id="term-for-integration-with-the-javascript-agent-cluster-formalism">代理集群</span>
                <li><span class="dfn-paneled" id="term-for-concept-document-window">关联文档</span>
                <li><span class="dfn-paneled" id="term-for-browsing-context">浏览上下文</span>
                <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps">排队步骤</span>
                <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps①">排队以下步骤</span>
                <li><span class="dfn-paneled" id="term-for-environment-settings-object">环境设置对象</span>
                <li><span class="dfn-paneled" id="term-for-fully-active">完全激活</span>
                <li><span class="dfn-paneled" id="term-for-concept-environment-id">id</span>
                <li><span class="dfn-paneled" id="term-for-concept-relevant-global">相关全局对象</span>
                <li><span class="dfn-paneled" id="term-for-relevant-settings-object">相关设置对象</span>
                <li><span class="dfn-paneled" id="term-for-responsible-event-loop">负责的事件循环</span>
                <li><span class="dfn-paneled" id="term-for-starting-a-new-parallel-queue">启动一个新的并行队列</span>
                <li><span class="dfn-paneled" id="term-for-task-source">任务源</span>
                <li><span class="dfn-paneled" id="term-for-unloading-document-cleanup-steps">卸载文档清理步骤</span>
            </ul>
        <li><a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-list-append">附加 <small>(用于列表)</small></span>
                <li><span class="dfn-paneled" id="term-for-set-append">附加 <small>(用于集合)</small></span>
                <li><span class="dfn-paneled" id="term-for-assert">断言</span>
                <li><span class="dfn-paneled" id="term-for-queue-enqueue">排队</span>
                <li><span class="dfn-paneled" id="term-for-map-exists">存在</span>
                <li><span class="dfn-paneled" id="term-for-list-iterate">遍历 <small>(用于列表)</small></span>
                <li><span class="dfn-paneled" id="term-for-map-iterate">遍历 <small>(用于映射)</small></span>
                <li><span class="dfn-paneled" id="term-for-list-is-empty">为空</span>
                <li><span class="dfn-paneled" id="term-for-list-item">项 <small>(用于列表)</small></span>
                <li><span class="dfn-paneled" id="term-for-struct-item">项 <small>(用于结构)</small></span>
                <li><span class="dfn-paneled" id="term-for-string">JavaScript 字符串</span>
                <li><span class="dfn-paneled" id="term-for-list">列表</span>
                <li><span class="dfn-paneled" id="term-for-ordered-map">映射</span>
                <li><span class="dfn-paneled" id="term-for-list-prepend">前置</span>
                <li><span class="dfn-paneled" id="term-for-queue">队列</span>
                <li><span class="dfn-paneled" id="term-for-list-remove">移除</span>
                <li><span class="dfn-paneled" id="term-for-ordered-set">集合</span>
                <li><span class="dfn-paneled" id="term-for-map-set">设置 <small>(用于映射)</small></span>
                <li><span class="dfn-paneled" id="term-for-struct">结构</span>
                <li><span class="dfn-paneled" id="term-for-map-getting-the-values">获取值</span>
            </ul>
        <li><a data-link-type="biblio">[Service-Workers]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-client">客户端</span>
                <li><span class="dfn-paneled" id="term-for-dom-client-id">id</span>
            </ul>
        <li><a data-link-type="biblio">[Storage]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-obtain-a-local-storage-bottle-map">获取本地存储瓶映射</span>
                <li><span class="dfn-paneled" id="term-for-storage-bottle">存储瓶</span>
                <li><span class="dfn-paneled" id="term-for-storage-bucket">存储桶</span>
            </ul>
        <li><a data-link-type="biblio">[WEBIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-aborterror">AbortError</span>
                <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
                <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
                <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
                <li><span class="dfn-paneled" id="term-for-notsupportederror">NotSupportedError</span>
                <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
                <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
                <li><span class="dfn-paneled" id="term-for-securityerror">SecurityError</span>
                <li><span class="dfn-paneled" id="term-for-a-new-promise">一个新承诺</span>
                <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">一个被拒绝的承诺</span>
                <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
                <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
                <li><span class="dfn-paneled" id="term-for-dfn-callback-function">回调函数</span>
                <li><span class="dfn-paneled" id="term-for-invoke-a-callback-function">调用</span>
                <li><span class="dfn-paneled" id="term-for-reject">拒绝</span>
                <li><span class="dfn-paneled" id="term-for-resolve">解析</span>
                <li><span class="dfn-paneled" id="term-for-idl-sequence">序列</span>
                <li><span class="dfn-paneled" id="term-for-this">this</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性参考文献</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css21">[CSS21]
        <dd>Bert Bos 等人。<a href="https://www.w3.org/TR/CSS21/"><cite>层叠样式表 2.1 版 (CSS 2.1)
                    规范</cite></a>。2011年6月7日。REC。URL: <a
                href="https://www.w3.org/TR/CSS21/">https://www.w3.org/TR/CSS21/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren。<a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>。现行标准。URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren 等人。<a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>。现行标准。URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola。<a href="https://infra.spec.whatwg.org/"><cite>Infra
                    标准</cite></a>。现行标准。URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner。<a
                href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>用于在RFC中表示需求级别的关键字</cite></a>。1997年3月。最佳当前实践。URL:
            <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-storage">[Storage]
        <dd>Anne van Kesteren。<a href="https://storage.spec.whatwg.org/"><cite>存储标准</cite></a>。现行标准。URL: <a
                href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu。<a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>。现行标准。URL: <a
                href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">说明性参考文献</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-indexeddb-2">[IndexedDB-2]
        <dd>Ali Alabbas; Joshua Bell。<a href="https://www.w3.org/TR/IndexedDB-2/"><cite>索引数据库 API
                    2.0</cite></a>。2018年1月30日。REC。URL: <a
                href="https://www.w3.org/TR/IndexedDB-2/">https://www.w3.org/TR/IndexedDB-2/</a>
        <dt id="biblio-service-workers">[Service-Workers]
        <dd>Jake Archibald; Marijn Kruisselbrink。<a href="https://www.w3.org/TR/service-workers/"><cite>Service
                    Workers</cite></a>。2022年7月12日。CR。URL: <a
                href="https://www.w3.org/TR/service-workers/">https://www.w3.org/TR/service-workers/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorlocks"><code><c- g>NavigatorLocks</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lockmanager"><code><c- g>LockManager</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions"><c- n>LockOptions</c-></a> <a href="#dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <a href="#callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock"><c- n>Lock</c-></a>? <a href="#dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code></a>);

<c- b>enum</c-> <a href="#enumdef-lockmode"><code><c- g>LockMode</c-></code></a> { <a href="#dom-lockmode-shared"><code><c- s>"shared"</c-></code></a>, <a href="#dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></a> };

<c- b>dictionary</c-> <a href="#dictdef-lockoptions"><code><c- g>LockOptions</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-default="&quot;exclusive&quot;" data-type="LockMode " href="#dom-lockoptions-mode"><code><c- g>mode</c-></code></a> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></a> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-steal"><code><c- g>steal</c-></code></a> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal " href="#dom-lockoptions-signal"><code><c- g>signal</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-held"><code><c- g>held</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockinfo"><code><c- g>LockInfo</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-name"><code><c- g>name</c-></code></a>;
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-type="LockMode " href="#dom-lockinfo-mode"><code><c- g>mode</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-clientid"><code><c- g>clientId</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lock"><code><c- g>Lock</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode"><c- g>mode</c-></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 在此处完善与 <a data-link-type="biblio" href="#biblio-storage" title="存储标准">[Storage]</a>
            的集成，包括如何从给定的环境中正确获取锁管理器。<a class="issue-return" href="#issue-73644ca1" title="跳转到部分">↵</a></div>
        <div class="issue"> 目前这仅适用于工作者，并且定义不明确，因为没有规范的方法来在工作者终止时执行步骤。<a class="issue-return" href="#issue-9062c3e0"
                title="跳转到部分">↵</a></div>
    </div>
    <aside class="dfn-panel" data-for="lock-task-queue">
        <b><a href="#lock-task-queue">#lock-task-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-task-queue">2.4. Locks</a>
            <li><a href="#ref-for-lock-task-queue①">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-task-queue②">3.2.2. The query() method</a>
            <li><a href="#ref-for-lock-task-queue③">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-task-queue④">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-task-queue⑤">4.3. Abort a request</a> <a href="#ref-for-lock-task-queue⑥">(2)</a>
            <li><a href="#ref-for-lock-task-queue⑦">4.4. Process a lock request queue for a given resource name</a> <a
                    href="#ref-for-lock-task-queue⑧">(2)</a>
            <li><a href="#ref-for-lock-task-queue⑨">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="resource-name">
        <b><a href="#resource-name">#resource-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-resource-name">1. Introduction</a> <a href="#ref-for-resource-name①">(2)</a>
            <li><a href="#ref-for-resource-name②">2.4. Locks</a>
            <li><a href="#ref-for-resource-name③">2.5. Lock Requests</a> <a href="#ref-for-resource-name④">(2)</a>
            <li><a href="#ref-for-resource-name⑤">3.2.1. The request() method</a>
            <li><a href="#ref-for-resource-name⑥">4.2. Release a lock</a>
            <li><a href="#ref-for-resource-name⑦">6.4. Checklist</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager">
        <b><a href="#lock-manager">#lock-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager">2.2. Lock Managers</a> <a href="#ref-for-lock-manager①">(2)</a> <a
                    href="#ref-for-lock-manager②">(3)</a>
            <li><a href="#ref-for-lock-manager③">2.4. Locks</a> <a href="#ref-for-lock-manager④">(2)</a>
            <li><a href="#ref-for-lock-manager⑤">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-manager⑥">3.2. LockManager class</a>
            <li><a href="#ref-for-lock-manager⑦">3.2.2. The query() method</a> <a href="#ref-for-lock-manager⑧">(2)</a>
            <li><a href="#ref-for-lock-manager⑨">5.1. Deadlocks</a>
            <li><a href="#ref-for-lock-manager①⓪">6.1. Lock Scope</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="obtain-a-lock-manager">
        <b><a href="#obtain-a-lock-manager">#obtain-a-lock-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-obtain-a-lock-manager">3.2.1. The request() method</a>
            <li><a href="#ref-for-obtain-a-lock-manager①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="mode">
        <b><a href="#mode">#mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-mode">1. Introduction</a> <a href="#ref-for-mode①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept">
        <b><a href="#lock-concept">#lock-concept</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept">1. Introduction</a>
            <li><a href="#ref-for-lock-concept①">2.2. Lock Managers</a>
            <li><a href="#ref-for-lock-concept②">2.4. Locks</a> <a href="#ref-for-lock-concept③">(2)</a> <a
                    href="#ref-for-lock-concept④">(3)</a> <a href="#ref-for-lock-concept⑤">(4)</a> <a
                    href="#ref-for-lock-concept⑥">(5)</a> <a href="#ref-for-lock-concept⑦">(6)</a> <a
                    href="#ref-for-lock-concept⑧">(7)</a> <a href="#ref-for-lock-concept⑨">(8)</a> <a
                    href="#ref-for-lock-concept①⓪">(9)</a>
            <li><a href="#ref-for-lock-concept①①">2.5. Lock Requests</a> <a href="#ref-for-lock-concept①②">(2)</a> <a
                    href="#ref-for-lock-concept①③">(3)</a>
            <li><a href="#ref-for-lock-concept①④">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-concept①⑤">3.3. Lock class</a> <a href="#ref-for-lock-concept①⑥">(2)</a> <a
                    href="#ref-for-lock-concept①⑦">(3)</a>
            <li><a href="#ref-for-lock-concept①⑧">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept①⑨">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-concept②⓪">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-agent">
        <b><a href="#lock-concept-agent">#lock-concept-agent</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-agent">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-concept-agent①">4.4. Process a lock request queue for a given resource name</a>
                <a href="#ref-for-lock-concept-agent②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-clientid">
        <b><a href="#lock-concept-clientid">#lock-concept-clientid</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-clientid">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-clientid①">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-manager">
        <b><a href="#lock-concept-manager">#lock-concept-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-manager">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-concept-manager①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-name">
        <b><a href="#lock-concept-name">#lock-concept-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-name">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-concept-name①">(2)</a>
            <li><a href="#ref-for-lock-concept-name②">3.3. Lock class</a>
            <li><a href="#ref-for-lock-concept-name③">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept-name④">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-name⑤">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-mode">
        <b><a href="#lock-concept-mode">#lock-concept-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-mode">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-concept-mode①">3.3. Lock class</a>
            <li><a href="#ref-for-lock-concept-mode②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-mode③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-waiting-promise">
        <b><a href="#lock-concept-waiting-promise">#lock-concept-waiting-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-waiting-promise">2.4. Locks</a> <a
                    href="#ref-for-lock-concept-waiting-promise①">(2)</a> <a
                    href="#ref-for-lock-concept-waiting-promise②">(3)</a> <a
                    href="#ref-for-lock-concept-waiting-promise③">(4)</a> <a
                    href="#ref-for-lock-concept-waiting-promise④">(5)</a>
            <li><a href="#ref-for-lock-concept-waiting-promise⑤">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-released-promise">
        <b><a href="#lock-concept-released-promise">#lock-concept-released-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-released-promise">2.4. Locks</a> <a
                    href="#ref-for-lock-concept-released-promise①">(2)</a> <a
                    href="#ref-for-lock-concept-released-promise②">(3)</a> <a
                    href="#ref-for-lock-concept-released-promise③">(4)</a>
            <li><a href="#ref-for-lock-concept-released-promise④">3.2.1. The request() method</a>
            <li><a href="#ref-for-lock-concept-released-promise⑤">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept-released-promise⑥">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager-held-lock-set">
        <b><a href="#lock-manager-held-lock-set">#lock-manager-held-lock-set</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager-held-lock-set">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-manager-held-lock-set①">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-manager-held-lock-set②">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-manager-held-lock-set③">4.4. Process a lock request queue for a given resource
                    name</a>
            <li><a href="#ref-for-lock-manager-held-lock-set④">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request">
        <b><a href="#lock-request">#lock-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request">1. Introduction</a>
            <li><a href="#ref-for-lock-request①">2.2. Lock Managers</a>
            <li><a href="#ref-for-lock-request②">2.5. Lock Requests</a> <a href="#ref-for-lock-request③">(2)</a> <a
                    href="#ref-for-lock-request④">(3)</a>
            <li><a href="#ref-for-lock-request⑤">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-request⑥">3.2. LockManager class</a>
            <li><a href="#ref-for-lock-request⑦">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-agent">
        <b><a href="#lock-request-agent">#lock-request-agent</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-agent">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-clientid">
        <b><a href="#lock-request-clientid">#lock-request-clientid</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-clientid">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-clientid①">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-manager">
        <b><a href="#lock-request-manager">#lock-request-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-manager">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-manager①">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-manager②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-name">
        <b><a href="#lock-request-name">#lock-request-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-name">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-name①">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-name②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-name③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-mode">
        <b><a href="#lock-request-mode">#lock-request-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-mode">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-mode①">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-mode②">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-callback">
        <b><a href="#lock-request-callback">#lock-request-callback</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-callback">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-promise">
        <b><a href="#lock-request-promise">#lock-request-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-promise">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-promise①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-signal">
        <b><a href="#lock-request-signal">#lock-request-signal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-signal">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-queue">
        <b><a href="#lock-request-queue">#lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-queue">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-request-queue①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager-lock-request-queue-map">
        <b><a href="#lock-manager-lock-request-queue-map">#lock-manager-lock-request-queue-map</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-manager-lock-request-queue-map①">(2)</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map②">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map③">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map④">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map⑤">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="get-the-lock-request-queue">
        <b><a href="#get-the-lock-request-queue">#get-the-lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-get-the-lock-request-queue">2.5. Lock Requests</a>
            <li><a href="#ref-for-get-the-lock-request-queue①">4.1. Request a lock</a>
            <li><a href="#ref-for-get-the-lock-request-queue②">4.2. Release a lock</a>
            <li><a href="#ref-for-get-the-lock-request-queue③">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="grantable">
        <b><a href="#grantable">#grantable</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-grantable">4.1. Request a lock</a>
            <li><a href="#ref-for-grantable①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="terminate-remaining-locks-and-requests">
        <b><a
                href="#terminate-remaining-locks-and-requests">#terminate-remaining-locks-and-requests</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-terminate-remaining-locks-and-requests">2.6. Termination of Locks</a> <a
                    href="#ref-for-terminate-remaining-locks-and-requests①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="navigatorlocks">
        <b><a href="#navigatorlocks">#navigatorlocks</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-navigatorlocks">3.1. Navigator Mixins</a> <a href="#ref-for-navigatorlocks①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-navigatorlocks-locks">
        <b><a href="#dom-navigatorlocks-locks">#dom-navigatorlocks-locks</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-navigatorlocks-locks">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lockmanager">
        <b><a href="#lockmanager">#lockmanager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lockmanager">2.4. Locks</a>
            <li><a href="#ref-for-lockmanager①">3.1. Navigator Mixins</a> <a href="#ref-for-lockmanager②">(2)</a> <a
                    href="#ref-for-lockmanager③">(3)</a>
            <li><a href="#ref-for-lockmanager④">3.2. LockManager class</a> <a href="#ref-for-lockmanager⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="callbackdef-lockgrantedcallback">
        <b><a href="#callbackdef-lockgrantedcallback">#callbackdef-lockgrantedcallback</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-callbackdef-lockgrantedcallback">3.2. LockManager class</a> <a
                    href="#ref-for-callbackdef-lockgrantedcallback①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="enumdef-lockmode">
        <b><a href="#enumdef-lockmode">#enumdef-lockmode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-enumdef-lockmode">3.2. LockManager class</a> <a
                    href="#ref-for-enumdef-lockmode①">(2)</a>
            <li><a href="#ref-for-enumdef-lockmode②">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmode-shared">
        <b><a href="#dom-lockmode-shared">#dom-lockmode-shared</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmode-shared">2.3. Modes and Scheduling</a> <a
                    href="#ref-for-dom-lockmode-shared①">(2)</a> <a href="#ref-for-dom-lockmode-shared②">(3)</a>
            <li><a href="#ref-for-dom-lockmode-shared③">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmode-shared④">2.5. Lock Requests</a>
            <li><a href="#ref-for-dom-lockmode-shared⑤">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmode-shared⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmode-exclusive">
        <b><a href="#dom-lockmode-exclusive">#dom-lockmode-exclusive</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmode-exclusive">2.3. Modes and Scheduling</a> <a
                    href="#ref-for-dom-lockmode-exclusive①">(2)</a> <a href="#ref-for-dom-lockmode-exclusive②">(3)</a>
                <a href="#ref-for-dom-lockmode-exclusive③">(4)</a>
            <li><a href="#ref-for-dom-lockmode-exclusive④">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmode-exclusive⑤">2.5. Lock Requests</a> <a
                    href="#ref-for-dom-lockmode-exclusive⑥">(2)</a>
            <li><a href="#ref-for-dom-lockmode-exclusive⑦">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmode-exclusive⑧">(2)</a> <a href="#ref-for-dom-lockmode-exclusive⑨">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockoptions">
        <b><a href="#dictdef-lockoptions">#dictdef-lockoptions</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockoptions">3.2. LockManager class</a>
            <li><a href="#ref-for-dictdef-lockoptions①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-mode">
        <b><a href="#dom-lockoptions-mode">#dom-lockoptions-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-mode">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-ifavailable">
        <b><a href="#dom-lockoptions-ifavailable">#dom-lockoptions-ifavailable</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-ifavailable">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-steal">
        <b><a href="#dom-lockoptions-steal">#dom-lockoptions-steal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-steal">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockoptions-steal①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-signal">
        <b><a href="#dom-lockoptions-signal">#dom-lockoptions-signal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-signal">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockmanagersnapshot">
        <b><a href="#dictdef-lockmanagersnapshot">#dictdef-lockmanagersnapshot</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockmanagersnapshot">3.2. LockManager class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockinfo">
        <b><a href="#dictdef-lockinfo">#dictdef-lockinfo</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockinfo">3.2. LockManager class</a> <a
                    href="#ref-for-dictdef-lockinfo①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-request">
        <b><a href="#dom-lockmanager-request">#dom-lockmanager-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-request">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmanager-request①">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-request②">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmanager-request③">(2)</a> <a href="#ref-for-dom-lockmanager-request④">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-request-name-options-callback">
        <b><a
                href="#dom-lockmanager-request-name-options-callback">#dom-lockmanager-request-name-options-callback</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-request-name-options-callback">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-request-name-options-callback①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-query">
        <b><a href="#dom-lockmanager-query">#dom-lockmanager-query</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-query">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-query①">3.2.2. The query() method</a> <a
                    href="#ref-for-dom-lockmanager-query②">(2)</a> <a href="#ref-for-dom-lockmanager-query③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock">
        <b><a href="#lock">#lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock">3.2. LockManager class</a>
            <li><a href="#ref-for-lock①">3.2.1. The request() method</a>
            <li><a href="#ref-for-lock②">3.3. Lock class</a> <a href="#ref-for-lock③">(2)</a>
            <li><a href="#ref-for-lock④">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lock-name">
        <b><a href="#dom-lock-name">#dom-lock-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lock-name">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lock-mode">
        <b><a href="#dom-lock-mode">#dom-lock-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lock-mode">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="request-a-lock">
        <b><a href="#request-a-lock">#request-a-lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-request-a-lock">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="release-the-lock">
        <b><a href="#release-the-lock">#release-the-lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-release-the-lock">2.4. Locks</a>
            <li><a href="#ref-for-release-the-lock①">2.6. Termination of Locks</a>
            <li><a href="#ref-for-release-the-lock②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="abort-the-request">
        <b><a href="#abort-the-request">#abort-the-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-abort-the-request">2.6. Termination of Locks</a>
            <li><a href="#ref-for-abort-the-request①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="signal-to-abort-the-request">
        <b><a href="#signal-to-abort-the-request">#signal-to-abort-the-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-signal-to-abort-the-request">4.1. Request a lock</a>
            <li><a href="#ref-for-signal-to-abort-the-request①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="process-the-lock-request-queue">
        <b><a href="#process-the-lock-request-queue">#process-the-lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-process-the-lock-request-queue">4.1. Request a lock</a>
            <li><a href="#ref-for-process-the-lock-request-queue①">4.2. Release a lock</a>
            <li><a href="#ref-for-process-the-lock-request-queue②">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="snapshot-the-lock-state">
        <b><a href="#snapshot-the-lock-state">#snapshot-the-lock-state</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-snapshot-the-lock-state">3.2.2. The query() method</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script>/* script-mdn-anno */
        document.body.addEventListener("click", (e) => {
            if (e.target.closest(".mdn-anno-btn")) {
                e.target.closest(".mdn-anno").classList.toggle("wrapped");
            }
        });</script>
    <script>/* script-var-click-highlighting */

        "use strict";
        {
            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script src="/dropdown.js"></script>