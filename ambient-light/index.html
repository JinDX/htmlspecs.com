<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>环境光传感器</title>
    <meta content="WD" name="w3c-status">
    <meta content="Bikeshed version 97a1608be, updated Mon Feb 3 16:09:34 2025 -0800" name="generator">
    <link href="https://www.w3.org/TR/ambient-light/" rel="canonical">
    <meta content="bcd9e1695b5f0365641d328314058384103594c1" name="revision">
    <meta content="dark light" name="color-scheme">
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color] {
            background-color: var(--var-bg);
            box-shadow: 0 0 0 2px var(--var-bg);
        }

        var[data-var-color] {
            --var-bg: #F4D200;
        }

        var[data-var-color="1"] {
            --var-bg: #FF87A2;
        }

        var[data-var-color="2"] {
            --var-bg: #96E885;
        }

        var[data-var-color="3"] {
            --var-bg: #3EEED2;
        }

        var[data-var-color="4"] {
            --var-bg: #EACFB6;
        }

        var[data-var-color="5"] {
            --var-bg: #82DDFF;
        }

        var[data-var-color="6"] {
            --var-vg: #FFBCF2;
        }

        @media (prefers-color-scheme: dark) {
            var[data-var-color] {
                --var-bg: #bc1a00;
            }

            var[data-var-color="1"] {
                --var-bg: #007f00;
            }

            var[data-var-color="2"] {
                --var-bg: #008698;
            }

            var[data-var-color="3"] {
                --var-bg: #7f5b2b;
            }

            var[data-var-color="4"] {
                --var-bg: #004df3;
            }

            var[data-var-color="5"] {
                --var-bg: #a1248a;
            }

            var[data-var-color="6"] {
                --var-vg: #ff0000;
            }
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">环境光传感器</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#WD">W3C 工作草案</a>, <time class="dt-updated"
                datetime="2025-02-12">2025年2月12日</time></p>
        <details open>
            <summary>关于本文档的更多详情</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>此版本：
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2025/WD-ambient-light-20250212/">https://www.w3.org/TR/2025/WD-ambient-light-20250212/</a>
                    <dt>最新发布版本:
                    <dd><a href="https://www.w3.org/TR/ambient-light/">https://www.w3.org/TR/ambient-light/</a>
                    <dt>编辑草案:
                    <dd><a href="https://w3c.github.io/ambient-light/">https://w3c.github.io/ambient-light/</a>
                    <dt>以前版本:
                    <dd><a href="https://www.w3.org/TR/2024/WD-ambient-light-20240124/"
                            rel="prev">https://www.w3.org/TR/2024/WD-ambient-light-20240124/</a>
                    <dt>历史记录:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/ambient-light/">https://www.w3.org/standards/history/ambient-light/</a>
                    <dt>反馈:
                    <dd><span><a
                                href="mailto:public-device-apis@w3.org?subject=%5Bambient-light%5D%20YOUR%20TOPIC%20HERE">public-device-apis@w3.org</a>
                            主题行为 “<kbd>[ambient-light] <i data-lt>… 消息主题 …</i></kbd>” (<a
                                href="https://lists.w3.org/Archives/Public/public-device-apis/"
                                rel="discussion">存档</a>)</span>
                    <dd><a href="https://github.com/w3c/ambient-light/issues/">GitHub</a>
                    <dt>测试套件:
                    <dd><a
                            href="https://github.com/web-platform-tests/wpt/tree/master/ambient-light">https://github.com/web-platform-tests/wpt/tree/master/ambient-light</a>
                    <dt class="editor">编辑者:
                    <dd class="editor p-author h-card vcard" data-editor-id="41974"><a class="p-name fn u-url url"
                            href="https://intel.com/">Anssi Kostiainen</a> (<span class="p-org org">英特尔公司</span>)
                    <dd class="editor p-author h-card vcard" data-editor-id="80407"><a class="p-name fn u-url url"
                            href="https://intel.com/">Rijubrata Bhaumik</a> (<span class="p-org org">英特尔公司</span>)
                    <dt class="editor">前编辑者:
                    <dd class="editor p-author h-card vcard" data-editor-id="60809"><a class="p-name fn u-url url"
                            href="https://tobie.me">Tobie Langel</a> (<span
                            class="p-org org">Codespeaks，曾代表英特尔公司</span>) <a class="u-email email"
                            href="mailto:tobie@codespeaks.com">tobie@codespeaks.com</a>
                    <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url"
                            href="https://mozilla.com/">Doug Turner</a> (<span class="p-org org">Mozilla公司</span>)
                    <dt>问题跟踪:
                    <dd><a href="https://github.com/w3c/ambient-light/milestones/Level%202">第2级问题</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr
                title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a
                href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/copyright/software-license/" rel="license"
                title="W3C Software and Document License">permissive document license</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本规范定义了一个具体的传感器接口，用于监测设备环境的环境光水平或照度。</p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">本文档状态</span></h2>
    <div data-fill-with="status">
        <p><em>本节描述了本文档在发布时的状态。当前 W3C 发布的文档列表及本技术报告的最新修订版可在 <a href="https://www.w3.org/TR/">W3C 技术报告索引
                    https://www.w3.org/TR/</a> 中找到。</em></p>
        <p>本文档由<a href="https://www.w3.org/groups/wg/das">设备与传感器工作组</a>作为工作草案发布，采用<a
                href="https://www.w3.org/policies/process/20231103/#recs-and-notes">推荐轨道</a>。本文档旨在成为 W3C 推荐标准。</p>
        <p>如果您希望对本文档提出意见，请发送至 <a
                href="mailto:public-device-apis@w3.org?Subject=%5Bambient-light%5D%20PUT%20SUBJECT%20HERE">public-device-apis@w3.org</a>
            (<a href="mailto:public-device-apis-request@w3.org?subject=subscribe">订阅</a>, <a
                href="https://lists.w3.org/Archives/Public/public-device-apis/">存档</a>)。发送邮件时，请在主题中包含“ambient-light”，最好像这样：“[ambient-light]
            <em>…评论摘要…</em>”。欢迎所有意见。
        </p>
        <p>作为工作草案发布并不意味着 <abbr
                title="World Wide Web Consortium">W3C</abbr>及其成员的认可。本文档是草稿，可能随时更新、替换或被其他文档废弃。将本文档作为除工作进展外的引用是不合适的。</p>
        <p>本文档由在<a href="https://www.w3.org/policies/patent-policy/">W3C 专利政策</a>下运作的工作组制作。W3C 维护了<a
                href="https://www.w3.org/groups/wg/das/ipr"
                rel="disclosure">与工作组交付物相关的任何专利披露的公开列表</a>；该页面还包括披露专利的说明。个人如果实际了解某项专利，并认为该专利包含<a
                href="https://www.w3.org/policies/patent-policy/#def-essential">必要声明</a>，必须根据<a
                href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">W3C 专利政策第6节</a>披露信息。</p>
        <p>本文档受<a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">2023年11月3日 W3C
                流程文档</a>管辖。</p>
        <p></p>
        <p>设备与传感器工作组正在为本规范进行现代安全和隐私审查，以考虑自2017年10月3日<a
                href="https://github.com/w3c/sensors/issues/299#issue-262392533">横向审查</a>以来，本规范及隐私和安全审查实践的变化。同样，工作组正在更新本规范的技术架构组审查，以适应最新的架构审查实践。
        </p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content">简介</span></a>
                <ol class="toc">
                    <li><a href="#scope"><span class="secno">1.1</span> <span class="content">范围</span></a>
                </ol>
            <li><a href="#examples"><span class="secno">2</span> <span class="content">示例</span></a>
            <li>
                <a href="#security-and-privacy"><span class="secno">3</span> <span class="content">安全与隐私注意事项</span></a>
                <ol class="toc">
                    <li><a href="#reduce-sensor-accuracy"><span class="secno">3.1</span> <span
                                class="content">降低传感器读数精度</span></a>
                </ol>
            <li><a href="#model"><span class="secno">4</span> <span class="content">模型</span></a>
            <li>
                <a href="#api"><span class="secno">5</span> <span class="content">API</span></a>
                <ol class="toc">
                    <li>
                        <a href="#ambient-light-sensor-interface"><span class="secno">5.1</span> <span
                                class="content">环境光传感器接口</span></a>
                        <ol class="toc">
                            <li><a href="#ambient-light-sensor-reading-attribute"><span class="secno">5.1.1</span> <span
                                        class="content">照度属性</span></a>
                        </ol>
                </ol>
            <li>
                <a href="#abstract-operations"><span class="secno">6</span> <span class="content">抽象操作</span></a>
                <ol class="toc">
                    <li><a href="#construct-an-ambient-light-sensor-object"><span class="secno">6.1</span> <span
                                class="content">构造环境光传感器对象</span></a>
                    <li><a href="#ambient-light-threshold-check-algorithm"><span class="secno">6.2</span> <span
                                class="content">环境光阈值检查算法</span></a>
                    <li><a href="#ambient-light-reading-quantization-algorithm"><span class="secno">6.3</span> <span
                                class="content">环境光读数量化算法</span></a>
                </ol>
            <li><a href="#automation"><span class="secno">7</span> <span class="content">自动化</span></a>
            <li><a href="#usecases-requirements"><span class="secno">8</span> <span class="content">用例与需求</span></a>
            <li><a href="#acknowledgements"><span class="secno">9</span> <span class="content">致谢</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span
                                class="content">一致性算法</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用规范定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">简介</span><a class="self-link" href="#intro"></a></h2>
        <p>环境光传感器扩展了通用传感器 API <a data-link-type="biblio" href="#biblio-generic-sensor"
                title="Generic Sensor API">[GENERIC-SENSOR]</a>，以提供设备主要光检测器检测到的环境光水平信息，单位为勒克斯（lux）。</p>
        <h3 class="heading settled" data-level="1.1" id="scope"><span class="secno">1.1. </span><span
                class="content">范围</span><a class="self-link" href="#scope"></a></h3>
        <p>本文档指定了一个 API，旨在满足<a href="#usecases-requirements">用例</a>的需求，这些用例需要精细的照度数据、低延迟，并可能以高频率采样。</p>
        <p>依赖少量照度值的常见用例，例如根据对比度级别或首选配色方案（可能受设备测量的环境光水平影响）来样式化网页，最好使用 <code>prefers-contrast</code> 和
            <code>prefers-color-scheme</code> CSS 媒体特性 <a data-link-type="biblio" href="#biblio-mediaqueries-5"
                title="Media Queries Level 5">[MEDIAQUERIES-5]</a> 以及配套的 <code>matchMedia</code> API <a
                data-link-type="biblio" href="#biblio-cssom-view-1" title="CSSOM View Module">[CSSOM-VIEW-1]</a>，这些用例不在本
            API 的范围内。
        </p>
        <p class="note" role="note"><span class="marker">注意：</span> <a data-link-type="biblio"
                href="#biblio-mediaqueries-5" title="Media Queries Level 5">[MEDIAQUERIES-5]</a> 规范曾包含一个
            <code>light-level</code> 媒体特性，该特性更直接地与环境光读数相关。后来，该特性已从规范中<a
                href="https://github.com/w3c/csswg-drafts/commit/f5b663c27d5a2715239633f4916880563969d770">移除</a>，取而代之的是更高层次的
            <code>prefers-color-scheme</code> 和 <code>prefers-contrast</code> 媒体特性。
        </p>
        <h2 class="heading settled" data-level="2" id="examples"><span class="secno">2. </span><span
                class="content">示例</span><a class="self-link" href="#examples"></a></h2>
        <div class="example" id="example-cdf5e857">
            <a class="self-link" href="#example-cdf5e857"></a> 在此简单示例中，环境光传感器以默认配置创建。每当有新的<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#sensor-reading" id="ref-for-sensor-reading">读数</a>可用时，它会打印到控制台。
            <pre class="highlight"><c- a>const</c-> sensor <c- o>=</c-> <c- ow>new</c-> AmbientLightSensor<c- p>();</c->
sensor<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> console<c- p>.</c->log<c- p>(</c->sensor<c- p>.</c->illuminance<c- p>);</c->
sensor<c- p>.</c->onerror <c- o>=</c-> event <c- p>=></c-> console<c- p>.</c->log<c- p>(</c->event<c- p>.</c->error<c- p>.</c->name<c- p>,</c-> event<c- p>.</c->error<c- p>.</c->message<c- p>);</c->
sensor<c- p>.</c->start<c- p>();</c->
</pre>
        </div>
        <div class="example" id="example-20e631c4">
            <a class="self-link" href="#example-20e631c4"></a> 在此示例中，环境光<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#sensor-reading" id="ref-for-sensor-reading①">传感器读数</a>用于计算 ISO 100
            的曝光值（EV）。首先，我们检查用户代理是否有权限访问环境光<a data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-reading"
                id="ref-for-sensor-reading②">传感器读数</a>。然后，将 <code
                class="idl"><a class="idl-code" data-link-type="attribute" href="#dom-ambientlightsensor-illuminance" id="ref-for-dom-ambientlightsensor-illuminance">illuminance</a></code>
            值转换为最接近的曝光值。
            <pre class="highlight">navigator<c- p>.</c->permissions<c- p>.</c->query<c- p>({</c-> name<c- o>:</c-> <c- t>'ambient-light-sensor'</c-> <c- p>}).</c->then<c- p>(</c->result <c- p>=></c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->result<c- p>.</c->state <c- o>===</c-> <c- t>'denied'</c-><c- p>)</c-> <c- p>{</c->
        console<c- p>.</c->log<c- p>(</c-><c- t>'Permission to use ambient light sensor is denied.'</c-><c- p>);</c->
        <c- k>return</c-><c- p>;</c->
    <c- p>}</c->

    <c- a>const</c-> als <c- o>=</c-> <c- ow>new</c-> AmbientLightSensor<c- p>({</c->frequency<c- o>:</c-> <c- mf>20</c-><c- p>});</c->
    als<c- p>.</c->addEventListener<c- p>(</c-><c- t>'activate'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> console<c- p>.</c->log<c- p>(</c-><c- t>'Ready to measure EV.'</c-><c- p>));</c->
    als<c- p>.</c->addEventListener<c- p>(</c-><c- t>'error'</c-><c- p>,</c-> event <c- p>=></c-> console<c- p>.</c->log<c- p>(</c-><c- sb>`Error: </c-><c- si>${</c->event<c- p>.</c->error<c- p>.</c->name<c- si>}</c-><c- sb>`</c-><c- p>));</c->
    als<c- p>.</c->addEventListener<c- p>(</c-><c- t>'reading'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
        <c- c1>// Defaut ISO value.</c->
        <c- a>const</c-> ISO <c- o>=</c-> <c- mf>100</c-><c- p>;</c->
        <c- c1>// Incident-light calibration constant.</c->
        <c- a>const</c-> C <c- o>=</c-> <c- mf>250</c-><c- p>;</c->

        <c- a>let</c-> EV <c- o>=</c-> Math<c- p>.</c->round<c- p>(</c->Math<c- p>.</c->log2<c- p>((</c->als<c- p>.</c->illuminance <c- o>*</c-> ISO<c- p>)</c-> <c- o>/</c-> C<c- p>));</c->
        console<c- p>.</c->log<c- p>(</c-><c- sb>`Exposure Value (EV) is: </c-><c- si>${</c->EV<c- si>}</c-><c- sb>`</c-><c- p>);</c->
    <c- p>});</c->

    als<c- p>.</c->start<c- p>();</c->
<c- p>});</c->
</pre>
        </div>
        <div class="example" id="example-ad1f42be">
            <a class="self-link" href="#example-ad1f42be"></a> 此示例演示如何将环境光<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#sensor-reading"
                id="ref-for-sensor-reading③">传感器读数</a>映射到推荐的工作场所光照水平。
            <pre class="highlight"><c- a>const</c-> als <c- o>=</c-> <c- ow>new</c-> AmbientLightSensor<c- p>();</c->

als<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    <c- a>let</c-> str <c- o>=</c-> luxToWorkplaceLevel<c- p>(</c->als<c- p>.</c->illuminance<c- p>);</c->
    <c- k>if</c-> <c- p>(</c->str<c- p>)</c-> <c- p>{</c->
        console<c- p>.</c->log<c- p>(</c-><c- sb>`Light level is suitable for: </c-><c- si>${</c->str<c- si>}</c-><c- sb>.`</c-><c- p>);</c->
    <c- p>}</c->
<c- p>};</c->

als<c- p>.</c->start<c- p>();</c->

<c- a>function</c-> luxToWorkplaceLevel<c- p>(</c->lux<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>20</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>100</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'public areas, short visits'</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>100</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>150</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'occasionally performed visual tasks'</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>150</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>250</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'easy office work, classes, homes, theaters'</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>250</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>500</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'normal office work, groceries, laboratories'</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>500</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>1000</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'mechanical workshops, drawing, supermarkets'</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->lux <c- o>></c-> <c- mf>1000</c-> <c- o>&amp;&amp;</c-> lux <c- o>&lt;</c-> <c- mf>5000</c-><c- p>)</c-> <c- p>{</c->
        <c- k>return</c-> <c- t>'detailed drawing work, visual tasks of low contrast'</c-><c- p>;</c->
    <c- p>}</c->

    <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
        </div>
        <h2 class="heading settled" data-level="3" id="security-and-privacy"><span class="secno">3. </span><span
                class="content">安全与隐私注意事项</span><a class="self-link" href="#security-and-privacy"></a></h2>
        <p><a class="tracking-vector" href="https://infra.spec.whatwg.org/#tracking-vector"
                style="color: currentcolor"><svg aria-label="(这是一个追踪向量。)" class="darkmode-aware" height="64" role="img"
                    width="46">
                    <title>这里有一个追踪向量。</title>
                    <use href="#b732b3fe"></use>
                </svg></a> 环境光传感器提供有关设备环境光照条件的信息。潜在的隐私风险包括：</p>
        <ul>
            <li data-md>
                <p>用户画像。环境光传感器可能泄露用户的使用模式和周围环境信息。这些信息可用于增强用户画像和行为分析。</p>
            <li data-md>
                <p>跨设备链接。两个设备可以访问包含相同第三方脚本的网站，该脚本会随着时间关联光照水平。</p>
            <li data-md>
                <p>跨设备通信。一种简单的广播通信方法可以使用设备屏幕或摄像头 LED 闪光灯向附近设备的环境光传感器广播消息。</p>
            <li data-md>
                <p>跨源泄露。屏幕发出的光可能从附近的反射表面反射回传感器。恶意网站可以嵌入来自不同源的资源，并缩放内容以显示特定像素，从而逐像素区分内容。</p>
            <li data-md>
                <p>劫持浏览历史。通过样式化已访问链接来区分与已访问和未访问链接相关的光照水平，例如将已访问链接样式化为黑屏块；未访问链接样式化为白屏。</p>
        </ul>
        <p>如 <a data-link-type="biblio" href="#biblio-alsprivacyanalysis"
                title="Ambient Light Sensors 的隐私分析">[ALSPRIVACYANALYSIS]</a>、<a data-link-type="biblio"
                href="#biblio-pinskimmingviasensor" title="通过环境光传感器进行 PIN 窃取">[PINSKIMMINGVIASENSOR]</a>、<a
                data-link-type="biblio" href="#biblio-stealingsensitivedata"
                title="使用 W3C 环境光传感器 API 窃取敏感浏览器数据">[STEALINGSENSITIVEDATA]</a>、<a data-link-type="biblio"
                href="#biblio-videorecognitionambientlight" title="使用环境光传感器进行视频识别">[VIDEORECOGNITIONAMBIENTLIGHT]</a> 和
            <a data-link-type="biblio" href="#biblio-imagingprivacy" title="环境光传感器的成像隐私威胁">[IMAGINGPRIVACY]</a>
            等作品进一步探讨了这些问题。
        </p>
        <p>为了缓解环境光传感器特有的这些威胁，用户代理必须<a data-link-type="dfn" href="https://w3c.github.io/sensors/#reduce-accuracy"
                id="ref-for-reduce-accuracy">降低传感器读数的精度</a>。用户代理还可以<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#limit-max-frequency" id="ref-for-limit-max-frequency">限制最大采样频率</a>。
        </p>
        <p>这些缓解策略补充了通用传感器 API <a data-link-type="biblio" href="#biblio-generic-sensor"
                title="Generic Sensor API">[GENERIC-SENSOR]</a> 中定义的<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#mitigation-strategies"
                id="ref-for-mitigation-strategies">通用缓解措施</a>。</p>
        <h3 class="heading settled" data-level="3.1" id="reduce-sensor-accuracy"><span class="secno">3.1. </span><span
                class="content">降低传感器读数精度</span><a class="self-link" href="#reduce-sensor-accuracy"></a></h3>
        <p>为了<a data-link-type="dfn" href="https://w3c.github.io/sensors/#reduce-accuracy"
                id="ref-for-reduce-accuracy①">降低传感器读数的精度</a>，本规范定义了一个<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#threshold-check-algorithm"
                id="ref-for-threshold-check-algorithm">阈值检查算法</a>（即<a data-link-type="dfn"
                href="#ambient-light-threshold-check-algorithm"
                id="ref-for-ambient-light-threshold-check-algorithm">环境光阈值检查算法</a>）和一个<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#reading-quantization-algorithm"
                id="ref-for-reading-quantization-algorithm">读数量化算法</a>（即<a data-link-type="dfn"
                href="#ambient-light-reading-quantization-algorithm"
                id="ref-for-ambient-light-reading-quantization-algorithm">环境光读数量化算法</a>）。</p>
        <p>这些算法利用了<a data-link-type="dfn" href="#illuminance-rounding-multiple"
                id="ref-for-illuminance-rounding-multiple">照度舍入倍数</a>和<a data-link-type="dfn"
                href="#illuminance-threshold-value" id="ref-for-illuminance-threshold-value">照度阈值</a>。实现必须遵守以下值的要求：</p>
        <ul>
            <li data-md>
                <p><a data-link-type="dfn" href="#illuminance-rounding-multiple"
                        id="ref-for-illuminance-rounding-multiple①">照度舍入倍数</a>必须至少为 50 勒克斯。</p>
            <li data-md>
                <p><a data-link-type="dfn" href="#illuminance-threshold-value"
                        id="ref-for-illuminance-threshold-value①">照度阈值</a>应至少为<a data-link-type="dfn"
                        href="#illuminance-rounding-multiple" id="ref-for-illuminance-rounding-multiple②">照度舍入倍数</a>的一半。
                </p>
        </ul>
        <p class="note" role="note"><span class="marker">注意：</span> 选择<a data-link-type="dfn"
                href="#illuminance-rounding-multiple"
                id="ref-for-illuminance-rounding-multiple③">照度舍入倍数</a>需要在不暴露过于精确的读数与为 API 用户提供仍然有用的读数之间取得平衡。50 勒克斯作为<a
                data-link-type="dfn" href="#illuminance-rounding-multiple"
                id="ref-for-illuminance-rounding-multiple④">照度舍入倍数</a>的最低值是在<a
                href="https://github.com/w3c/ambient-light/issues/13#issuecomment-302393458">GitHub 问题
                #13</a>中确定的，此前在不同光照条件下收集了不同的环境光水平测量值<a
                href="https://docs.google.com/spreadsheets/d/1vUojkaaif6AmftQmtqra1w9Z7CH00Cn9pb0Ci6v5_Jk">（表格链接）</a>，并证明可以阻止<a
                data-link-type="biblio" href="#biblio-stealingsensitivedata"
                title="使用 W3C 环境光传感器 API 窃取敏感浏览器数据">[STEALINGSENSITIVEDATA]</a>中描述的攻击。此外，50 勒克斯也高于使用环境光传感器读数进行视频识别所需的 5
            勒克斯（<a data-link-type="biblio" href="#biblio-videorecognitionambientlight"
                title="使用环境光传感器进行视频识别">[VIDEORECOGNITIONAMBIENTLIGHT]</a>）。</p>
        <p class="note" role="note"><span class="marker">注意：</span> <a data-link-type="dfn"
                href="#illuminance-threshold-value"
                id="ref-for-illuminance-threshold-value②">照度阈值</a>用于防止泄露读数围绕某个特定值但被量化为不同值的事实。例如，如果<a
                data-link-type="dfn" href="#illuminance-rounding-multiple"
                id="ref-for-illuminance-rounding-multiple⑤">照度舍入倍数</a>为 50，这可以防止原始读数在 24 和 26 之间切换时，照度值在 0 和 50 之间切换。<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#threshold-check-algorithm"
                id="ref-for-threshold-check-algorithm①">阈值检查算法</a>作为辅助指纹缓解策略的有效性尚未得到数学证明，但基于实现经验已被添加到本规范中。更多信息请参见<a
                href="https://crbug.com/1332536">Chromium 问题 1332536</a>和<a href="https://crrev.com/c/3666917">Chromium
                审查 3666917</a>。</p>
        <h2 class="heading settled" data-level="4" id="model"><span class="secno">4. </span><span
                class="content">模型</span><a class="self-link" href="#model"></a></h2>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="ambient-light-sensor">环境光传感器</dfn>的<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-type"
                id="ref-for-sensor-type">传感器类型</a>的关联<code
                class="idl"><a data-link-type="idl" href="https://w3c.github.io/sensors/#sensor" id="ref-for-sensor">传感器</a></code>子类是<code
                class="idl"><a data-link-type="idl" href="#ambientlightsensor" id="ref-for-ambientlightsensor">AmbientLightSensor</a></code>类。
        </p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor">环境光传感器</a>有一个<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#default-sensor"
                id="ref-for-default-sensor">默认传感器</a>，即设备的主要光检测器。</p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor①">环境光传感器</a>是一个<a
                data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-powerful-feature"
                id="ref-for-dfn-powerful-feature">强大功能</a>，其标识由<a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-name" id="ref-for-dfn-name">名称</a> "<dfn
                class="dfn-paneled idl-code" data-dfn-type="permission" data-export
                id="permissiondef-ambient-light-sensor"><code>ambient-light-sensor</code></dfn>" 提供，同时也是其关联的<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-permission-names"
                id="ref-for-sensor-permission-names">传感器权限名称</a>。其<a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm"
                id="ref-for-dfn-permission-revocation-algorithm">权限撤销算法</a>是调用<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#generic-sensor-permission-revocation-algorithm"
                id="ref-for-generic-sensor-permission-revocation-algorithm">通用传感器权限撤销算法</a>并传入 "ambient-light-sensor"
            的结果。</p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor②">环境光传感器</a>是一个由字符串
            "ambient-light-sensor" 标识的<a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"
                id="ref-for-policy-controlled-feature">策略控制功能</a>。其<a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"
                id="ref-for-policy-controlled-feature-default-allowlist">默认允许列表</a>为<code>'self'</code>。</p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor③">环境光传感器</a>有一个<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#virtual-sensor-type"
                id="ref-for-virtual-sensor-type">虚拟传感器类型</a>，即
            "<code><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="ambient-light virtual sensor type" data-noexport id="ambient-light-virtual-sensor-type">ambient-light</dfn></code>"。
        </p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-light-level">当前光照水平</dfn>或<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="illuminance">照度</dfn>是一个表示设备周围环境光水平的值。其单位为勒克斯（lx）<a data-link-type="biblio" href="#biblio-si"
                title="SI Brochure: The International System of Units (SI), 8th edition">[SI]</a>。</p>
        <p class="note" role="note"><span class="marker">注意：</span> 不同设备在相同光线下报告的精确勒克斯值可能不同，这取决于检测方法、传感器结构等差异。</p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor"
                id="ref-for-ambient-light-sensor④">环境光传感器</a>有一个以勒克斯为单位的<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-lt="illuminance rounding multiple" data-noexport
                id="illuminance-rounding-multiple">照度舍入倍数</dfn>，表示照度读数将舍入到的倍数。</p>
        <p><a data-link-type="dfn" href="#ambient-light-sensor"
                id="ref-for-ambient-light-sensor⑤">环境光传感器</a>有一个以勒克斯为单位的<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="illuminance-threshold-value">照度阈值</dfn>，用于<a data-link-type="dfn"
                href="#ambient-light-threshold-check-algorithm"
                id="ref-for-ambient-light-threshold-check-algorithm①">环境光阈值检查算法</a>。</p>
        <p class="note" role="note"><span class="marker">注意：</span> 请参阅<a href="#reduce-sensor-accuracy">§ 3.1
                降低传感器读数精度</a>以了解上述值的最低要求。</p>
        <h2 class="heading settled" data-level="5" id="api"><span class="secno">5. </span><span
                class="content">API</span><a class="self-link" href="#api"></a></h2>
        <h3 class="heading settled" data-level="5.1" id="ambient-light-sensor-interface"><span class="secno">5.1.
            </span><span class="content">环境光传感器接口</span><a class="self-link" href="#ambient-light-sensor-interface"></a>
        </h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="ambientlightsensor"><code><c- g>AmbientLightSensor</c-></code></dfn> : <a data-link-type="idl-name" href="https://w3c.github.io/sensors/#sensor" id="ref-for-sensor①"><c- n>Sensor</c-></a> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="AmbientLightSensor" data-dfn-type="constructor" data-export data-lt="AmbientLightSensor(sensorOptions)|constructor(sensorOptions)|AmbientLightSensor()|constructor()" id="dom-ambientlightsensor-ambientlightsensor"><code><c- g>constructor</c-></code></dfn>(<c- b>optional</c-> <a data-link-type="idl-name" href="https://w3c.github.io/sensors/#dictdef-sensoroptions" id="ref-for-dictdef-sensoroptions"><c- n>SensorOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AmbientLightSensor/AmbientLightSensor(sensorOptions), AmbientLightSensor/constructor(sensorOptions), AmbientLightSensor/AmbientLightSensor(), AmbientLightSensor/constructor()" data-dfn-type="argument" data-export id="dom-ambientlightsensor-ambientlightsensor-sensoroptions-sensoroptions"><code><c- g>sensorOptions</c-></code></dfn> = {});
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="AmbientLightSensor" data-dfn-type="attribute" data-export data-readonly data-type="double?" id="dom-ambientlightsensor-illuminance"><code><c- g>illuminance</c-></code></dfn>;
};
</pre>
        <p>要构造一个<code
                class="idl"><a data-link-type="idl" href="#ambientlightsensor" id="ref-for-ambientlightsensor①">AmbientLightSensor</a></code>对象，用户代理必须调用<a
                data-link-type="dfn" href="#construct-an-ambient-light-sensor-object"
                id="ref-for-construct-an-ambient-light-sensor-object">构造环境光传感器对象</a>抽象操作。</p>
        <h4 class="heading settled" data-level="5.1.1" id="ambient-light-sensor-reading-attribute"><span
                class="secno">5.1.1. </span><span class="content">照度属性</span><a class="self-link"
                href="#ambient-light-sensor-reading-attribute"></a></h4>
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-ambientlightsensor-illuminance" id="ref-for-dom-ambientlightsensor-illuminance①">illuminance</a></code>的
            getter 步骤如下：</p>
        <ol>
            <li data-md>
                <p>令<var>illuminance</var>为调用<a data-link-type="dfn"
                        href="https://w3c.github.io/sensors/#get-value-from-latest-reading"
                        id="ref-for-get-value-from-latest-reading">从最新读数获取值</a>并传入<a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>和"illuminance"作为参数的结果。</p>
            <li data-md>
                <p>返回<var>illuminance</var>。</p>
        </ol>
        <h2 class="heading settled" data-level="6" id="abstract-operations"><span class="secno">6. </span><span
                class="content">抽象操作</span><a class="self-link" href="#abstract-operations"></a></h2>
        <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export data-level="6.1" data-lt="构造环境光传感器对象"
            id="construct-an-ambient-light-sensor-object"><span class="secno">6.1. </span><span
                class="content">构造环境光传感器对象</span><a class="self-link" href="#construct-an-ambient-light-sensor-object"
                id="ref-for-construct-an-ambient-light-sensor-object①"></a></h3>
        <div class="algorithm" data-algorithm="construct an ambient light sensor object">
            <dl>
                <dt data-md>输入
                <dd data-md>
                    <p><var>options</var>，一个<code class="idl"><a data-link-type="idl"
                                href="https://w3c.github.io/sensors/#dictdef-sensoroptions"
                                id="ref-for-dictdef-sensoroptions①">SensorOptions</a></code>对象。</p>
                <dt data-md>输出
                <dd data-md>
                    <p>一个<code class="idl"><a data-link-type="idl" href="#ambientlightsensor"
                                id="ref-for-ambientlightsensor②">AmbientLightSensor</a></code>对象。</p>
            </dl>
            <ol>
                <li data-md>
                    <p>令<var>allowed</var>为调用<a data-link-type="dfn"
                            href="https://w3c.github.io/sensors/#check-sensor-policy-controlled-features"
                            id="ref-for-check-sensor-policy-controlled-features">检查传感器策略控制功能</a>并传入<code class="idl"><a data-link-type="idl" href="#ambientlightsensor"
                                id="ref-for-ambientlightsensor③">AmbientLightSensor</a></code>的结果。</p>
                <li data-md>
                    <p>如果<var>allowed</var>为false，则：</p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw"
                                    id="ref-for-dfn-throw">抛出</a>一个<code class="idl"><a data-link-type="idl"
                                        href="https://webidl.spec.whatwg.org/#securityerror"
                                        id="ref-for-securityerror">SecurityError</a></code> <code class="idl"><a
                                        data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException"
                                        id="ref-for-idl-DOMException">DOMException</a></code>。</p>
                    </ol>
                <li data-md>
                    <p>令<var>ambient_light_sensor</var>为新的<code
                            class="idl"><a data-link-type="idl"
                                href="#ambientlightsensor" id="ref-for-ambientlightsensor④">AmbientLightSensor</a></code>对象。</p>
                <li data-md>
                    <p>调用<a data-link-type="dfn" href="https://w3c.github.io/sensors/#initialize-a-sensor-object"
                            id="ref-for-initialize-a-sensor-object">初始化传感器对象</a>并传入<var>ambient_light_sensor</var>和<var>options</var>。
                    </p>
                <li data-md>
                    <p>返回<var>ambient_light_sensor</var>。</p>
            </ol>
        </div>
        <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="6.2" data-lt="环境光阈值检查算法" data-noexport
            id="ambient-light-threshold-check-algorithm"><span class="secno">6.2. </span><span
                class="content">环境光阈值检查算法</span><a class="self-link" href="#ambient-light-threshold-check-algorithm"
                id="ref-for-ambient-light-threshold-check-algorithm②"></a></h3>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor⑥">环境光传感器</a>的<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-type"
                id="ref-for-sensor-type①">传感器类型</a>定义了以下<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#threshold-check-algorithm"
                id="ref-for-threshold-check-algorithm②">阈值检查算法</a>：</p>
        <div class="algorithm" data-algorithm="ambient light threshold check">
            <dl>
                <dt data-md>输入
                <dd data-md>
                    <p><var>newReading</var>，一个<a data-link-type="dfn"
                            href="https://w3c.github.io/sensors/#sensor-reading" id="ref-for-sensor-reading④">传感器读数</a>
                    </p>
                <dd data-md>
                    <p><var>latestReading</var>，一个<a data-link-type="dfn"
                            href="https://w3c.github.io/sensors/#sensor-reading" id="ref-for-sensor-reading⑤">传感器读数</a>
                    </p>
                <dt data-md>输出
                <dd data-md>
                    <p>一个<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean"
                            id="ref-for-boolean">布尔值</a>，指示读数差异是否足够显著。</p>
            </dl>
            <ol>
                <li data-md>
                    <p>如果<var>newReading</var>["illuminance"]为null，返回true。</p>
                <li data-md>
                    <p>如果<var>latestReading</var>["illuminance"]为null，返回true。</p>
                <li data-md>
                    <p>令<var>newIlluminance</var>为<var>newReading</var>["illuminance"]。</p>
                <li data-md>
                    <p>令<var>latestIlluminance</var>为<var>latestReading</var>["illuminance"]。</p>
                <li data-md>
                    <p>如果<a data-link-type="abstract-op" href="https://tc39.es/ecma262/#eqn-abs"
                            id="ref-for-eqn-abs">abs</a>(<var>latestIlluminance</var> - <var>newIlluminance</var>) &lt;
                        <a data-link-type="dfn" href="#illuminance-threshold-value"
                            id="ref-for-illuminance-threshold-value③">照度阈值</a>，返回false。
                    </p>
                <li data-md>
                    <p>令<var>roundedNewReading</var>为调用<a data-link-type="dfn"
                            href="#ambient-light-reading-quantization-algorithm"
                            id="ref-for-ambient-light-reading-quantization-algorithm①">环境光读数量化算法</a>并传入<var>newIlluminance</var>的结果。
                    </p>
                <li data-md>
                    <p>令<var>roundedLatestReading</var>为调用<a data-link-type="dfn"
                            href="#ambient-light-reading-quantization-algorithm"
                            id="ref-for-ambient-light-reading-quantization-algorithm②">环境光读数量化算法</a>并传入<var>latestIlluminance</var>的结果。
                    </p>
                <li data-md>
                    <p>如果<var>roundedNewReading</var>["illuminance"]和<var>roundedLatestIlluminance</var>["illuminance"]相等，返回false。
                    </p>
                <li data-md>
                    <p>否则，返回true。</p>
            </ol>
        </div>
        <p class="note" role="note"><span class="marker">注意：</span> 此算法调用<a data-link-type="dfn"
                href="#ambient-light-reading-quantization-algorithm"
                id="ref-for-ambient-light-reading-quantization-algorithm③">环境光读数量化算法</a>以确保舍入到相同值的读数不会触发主<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#update-latest-reading"
                id="ref-for-update-latest-reading">更新最新读数</a>算法中的更新。如果不这样做，将向用户表明原始照度读数在范围内至少相差<a data-link-type="dfn"
                href="#illuminance-threshold-value" id="ref-for-illuminance-threshold-value④">照度阈值</a>，但不会舍入到不同的<a
                data-link-type="dfn" href="#illuminance-rounding-multiple"
                id="ref-for-illuminance-rounding-multiple⑥">照度舍入倍数</a>。</p>
        <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="6.3" data-lt="环境光读数量化算法" data-noexport
            id="ambient-light-reading-quantization-algorithm"><span class="secno">6.3. </span><span
                class="content">环境光读数量化算法</span><a class="self-link"
                href="#ambient-light-reading-quantization-algorithm"
                id="ref-for-ambient-light-reading-quantization-algorithm④"></a></h3>
        <p><a data-link-type="dfn" href="#ambient-light-sensor" id="ref-for-ambient-light-sensor⑦">环境光传感器</a>的<a
                data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-type"
                id="ref-for-sensor-type②">传感器类型</a>定义了以下<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#reading-quantization-algorithm"
                id="ref-for-reading-quantization-algorithm①">读数量化算法</a>：</p>
        <div class="algorithm" data-algorithm="ambient light reading quantization">
            <dl>
                <dt data-md>输入
                <dd data-md>
                    <p><var>reading</var>，一个<a data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-reading"
                            id="ref-for-sensor-reading⑥">传感器读数</a></p>
                <dt data-md>输出
                <dd data-md>
                    <p>一个<a data-link-type="dfn" href="https://w3c.github.io/sensors/#sensor-reading"
                            id="ref-for-sensor-reading⑦">传感器读数</a></p>
            </dl>
            <ol>
                <li data-md>
                    <p>令<var>quantizedReading</var>为<var>reading</var>。</p>
                <li data-md>
                    <p>将<var>quantizedReading</var>["illuminance"]设置为<var>reading</var>["illuminance"]最接近的<a
                            data-link-type="dfn" href="#illuminance-rounding-multiple"
                            id="ref-for-illuminance-rounding-multiple⑦">照度舍入倍数</a>的倍数。</p>
                <li data-md>
                    <p>返回<var>quantizedReading</var>。</p>
            </ol>
        </div>
        <h2 class="heading settled" data-level="7" id="automation"><span class="secno">7. </span><span
                class="content">自动化</span><a class="self-link" href="#automation"></a></h2>
        <p>本节通过提供<a data-link-type="dfn" href="#ambient-light-sensor"
                id="ref-for-ambient-light-sensor⑧">环境光传感器</a>特定的虚拟传感器元数据扩展了<a
                href="https://w3c.github.io/sensors/#automation"><cite>通用传感器 API</cite> § 9 自动化</a>。</p>
        <div class="algorithm" data-algorithm="illuminance reading parsing algorithm"> <dfn class="dfn-paneled"
                data-dfn-type="dfn" data-noexport id="illuminance-reading-parsing-algorithm">照度读数解析算法</dfn>，给定一个 JSON
            <code class="idl"><a data-link-type="idl" href="https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object-objects"
                    id="ref-for-sec-object-objects">对象</a></code> <var>parameters</var>，必须返回调用<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#parse-single-value-number-reading"
                id="ref-for-parse-single-value-number-reading">解析单值数字读数</a>并传入<var>parameters</var>和"<code>illuminance</code>"的结果。
        </div>
        <p><a data-link-type="dfn" href="https://w3c.github.io/sensors/#per-type-virtual-sensor-metadata"
                id="ref-for-per-type-virtual-sensor-metadata">按类型虚拟传感器元数据</a><a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">映射</a>必须具有以下<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-entry" id="ref-for-map-entry">条目</a>：</p>
        <dl>
            <dt data-md><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">键</a>
            <dd data-md>
                <p>"<code><a data-link-type="dfn" href="#ambient-light-virtual-sensor-type"
                            id="ref-for-ambient-light-virtual-sensor-type">ambient-light</a></code>"</p>
            <dt data-md><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-value"
                    id="ref-for-map-value">值</a>
            <dd data-md>
                <p>一个<a data-link-type="dfn" href="https://w3c.github.io/sensors/#virtual-sensor-metadata"
                        id="ref-for-virtual-sensor-metadata">虚拟传感器元数据</a>，其<a data-link-type="dfn"
                        href="https://w3c.github.io/sensors/#virtual-sensor-metadata-reading-parsing-algorithm"
                        id="ref-for-virtual-sensor-metadata-reading-parsing-algorithm">读数解析算法</a>是<a
                        data-link-type="dfn" href="#illuminance-reading-parsing-algorithm"
                        id="ref-for-illuminance-reading-parsing-algorithm">照度读数解析算法</a>。</p>
        </dl>
        <h2 class="heading settled" data-level="8" id="usecases-requirements"><span class="secno">8. </span><span
                class="content">用例与需求</span><a class="self-link" href="#usecases-requirements"></a></h2>
        <ul>
            <li data-md>
                <p>一个 Web 应用为智能家居系统提供输入以控制照明。</p>
            <li data-md>
                <p>一个 Web 应用检查工作空间的光照水平是否足够。</p>
            <li data-md>
                <p>一个 Web 应用计算具有手动控制（光圈、快门速度、ISO）的相机设置。</p>
            <li data-md>
                <p>一个 Web 应用检查当前光照水平以确定相机流是否包含足够准确的数据（例如，人类存在验证）。</p>
        </ul>
        <p>虽然某些用例可能受益于获取精确的环境光测量，但将环境光水平波动转换为用户输入事件的用例将受益于更高的<a data-link-type="dfn"
                href="https://w3c.github.io/sensors/#sampling-frequency" id="ref-for-sampling-frequency">采样频率</a>。</p>
        <h2 class="heading settled" data-level="9" id="acknowledgements"><span class="secno">9. </span><span
                class="content">致谢</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p>感谢 Doug Turner 提供初始原型和 Marcos Caceres 提供测试套件。</p>
        <p>感谢 Paul Bakaus 提出的 LightLevelSensor 想法。</p>
        <p>感谢 Mikhail Pozdnyakov 和 Alexander Shalamov 提供用例与需求。</p>
        <p>感谢 Lukasz Olejnik 进行隐私风险评估。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档约定</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求通过描述性断言和 RFC 2119 术语的组合来表达。
            在本文档的规范部分中，
            关键字“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”和“OPTIONAL”
            应按照 RFC 2119 中的描述进行解释。
            然而，为了可读性，
            这些词在本规范中并未全部以大写字母形式出现。</p>
        <p>除明确标记为非规范性部分、示例和注释外，
            本规范的所有文本均为规范性内容。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>本规范中的示例以“例如”开头，
            或通过 <code>class="example"</code> 与规范性文本分开，
            如下所示：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个信息性示例。</p>
        </div>
        <p>信息性注释以“注意”开头，
            并通过 <code>class="note"</code> 与规范性文本分开，
            如下所示：</p>
        <p class="note" role="note">注意，这是一个信息性注释。</p>
        <section>
            <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span
                    class="content">一致性算法</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
            <p>作为算法一部分的命令式要求
                （例如“去除任何前导空格字符”或“返回 false 并中止这些步骤”）
                应按照引入算法时使用的关键字
                （“必须”、“应该”、“可以”等）
                的含义进行解释。</p>
            <p>以算法或具体步骤形式表达的一致性要求
                可以以任何方式实现，
                只要最终结果是等效的即可。
                特别是，本规范中定义的算法
                旨在易于理解，
                并非旨在追求性能。
                鼓励实现者进行优化。</p>
        </section>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#ambient-light-reading-quantization-algorithm">环境光读数量化算法</a><span>，见 § 6.2</span>
        <li><a href="#ambient-light-sensor">环境光传感器</a><span>，见 § 4</span>
        <li><a href="#permissiondef-ambient-light-sensor">ambient-light-sensor</a><span>，见 § 4</span>
        <li><a href="#ambientlightsensor">AmbientLightSensor</a><span>，见 § 5.1</span>
        <li><a href="#dom-ambientlightsensor-ambientlightsensor">AmbientLightSensor()</a><span>，见 § 5.1</span>
        <li><a href="#dom-ambientlightsensor-ambientlightsensor">AmbientLightSensor(sensorOptions)</a><span>，见
                § 5.1</span>
        <li><a href="#ambient-light-threshold-check-algorithm">环境光阈值检查算法</a><span>，见 § 6.1</span>
        <li><a href="#ambient-light-virtual-sensor-type">ambient-light 虚拟传感器类型</a><span>，见 § 4</span>
        <li><a href="#construct-an-ambient-light-sensor-object">构造环境光传感器对象</a><span>，见 § 6</span>
        <li><a href="#dom-ambientlightsensor-ambientlightsensor">constructor()</a><span>，见 § 5.1</span>
        <li><a href="#dom-ambientlightsensor-ambientlightsensor">constructor(sensorOptions)</a><span>，见 § 5.1</span>
        <li><a href="#current-light-level">当前光照水平</a><span>，见 § 4</span>
        <li>
            照度
            <ul>
                <li><a href="#dom-ambientlightsensor-illuminance">AmbientLightSensor 的属性</a><span>，见 § 5.1</span>
                <li><a href="#illuminance">定义</a><span>，见 § 4</span>
            </ul>
        <li><a href="#illuminance-reading-parsing-algorithm">照度读数解析算法</a><span>，见 § 7</span>
        <li><a href="#illuminance-rounding-multiple">照度舍入倍数</a><span>，见 § 4</span>
        <li><a href="#illuminance-threshold-value">照度阈值</a><span>，见 § 4</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用规范定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[ECMASCRIPT]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="a6e67972">Object</span>
                <li><span class="dfn-paneled" id="b01bbc68">abs</span>
            </ul>
        <li>
            <a data-link-type="biblio">[GENERIC-SENSOR]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="1b956603">Sensor</span>
                <li><span class="dfn-paneled" id="207de9db">SensorOptions</span>
                <li><span class="dfn-paneled" id="5822d2f3">检查传感器策略控制功能</span>
                <li><span class="dfn-paneled" id="2797dd43">默认传感器</span>
                <li><span class="dfn-paneled" id="a09cf46b">通用传感器权限撤销算法</span>
                <li><span class="dfn-paneled" id="fd4ad34f">从最新读数获取值</span>
                <li><span class="dfn-paneled" id="0026f53f">初始化传感器对象</span>
                <li><span class="dfn-paneled" id="c79c290a">限制最大采样频率</span>
                <li><span class="dfn-paneled" id="a296510f">缓解策略</span>
                <li><span class="dfn-paneled" id="c1bbb186">解析单值数字读数</span>
                <li><span class="dfn-paneled" id="5d47b5a4">按类型虚拟传感器元数据</span>
                <li><span class="dfn-paneled" id="611c5008">读数解析算法</span>
                <li><span class="dfn-paneled" id="1f45ff31">读数量化算法</span>
                <li><span class="dfn-paneled" id="214e5c65">降低精度</span>
                <li><span class="dfn-paneled" id="6f3f0749">采样频率</span>
                <li><span class="dfn-paneled" id="80bf03eb">传感器权限名称</span>
                <li><span class="dfn-paneled" id="5afb8cab">传感器读数</span>
                <li><span class="dfn-paneled" id="f96b75e9">传感器类型</span>
                <li><span class="dfn-paneled" id="6048fac5">阈值检查算法</span>
                <li><span class="dfn-paneled" id="d8b6acc6">更新最新读数</span>
                <li><span class="dfn-paneled" id="bb15fee5">虚拟传感器元数据</span>
                <li><span class="dfn-paneled" id="4fa114dd">虚拟传感器类型</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="36858240">布尔值</span>
                <li><span class="dfn-paneled" id="8958b003">条目</span>
                <li><span class="dfn-paneled" id="d14a6f26">键</span>
                <li><span class="dfn-paneled" id="3fca5a9e">映射</span>
                <li><span class="dfn-paneled" id="802b0fdd">值</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="e740d7e5">名称</span>
                <li><span class="dfn-paneled" id="409a61ca">权限撤销算法</span>
                <li><span class="dfn-paneled" id="6c2d7879">强大功能</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="1570624a">默认允许列表</span>
                <li><span class="dfn-paneled" id="cc890cc1">策略控制功能</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义以下术语：
            <ul>
                <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
                <li><span class="dfn-paneled" id="c3e881ef">SecurityError</span>
                <li><span class="dfn-paneled" id="8c800cdf">double</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
                <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-ecmascript">[ECMASCRIPT]
        <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript 语言规范</cite></a>。URL: <a
                href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
        <dt id="biblio-generic-sensor">[GENERIC-SENSOR]
        <dd>Rick Waldron. <a href="https://w3c.github.io/sensors/"><cite>通用传感器 API</cite></a>。URL: <a
                href="https://w3c.github.io/sensors/">https://w3c.github.io/sensors/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>基础标准</cite></a>。Living
            Standard。URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-permissions">[PERMISSIONS]
        <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>权限</cite></a>。URL: <a
                href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
        <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
        <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>权限策略</cite></a>。URL: <a
                href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>RFC 中用于指示要求级别的关键字</cite></a>。1997
            年 3 月。最佳当前实践。URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>。Living
            Standard。URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-alsprivacyanalysis">[ALSPRIVACYANALYSIS]
        <dd>Lukasz Olejnik. <a
                href="https://blog.lukaszolejnik.com/privacy-of-ambient-light-sensors/"><cite>环境光传感器的隐私分析</cite></a>。2016
            年 8 月 31 日。URL: <a
                href="https://blog.lukaszolejnik.com/privacy-of-ambient-light-sensors/">https://blog.lukaszolejnik.com/privacy-of-ambient-light-sensors/</a>
        <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
        <dd>Simon Pieters. <a href="https://drafts.csswg.org/cssom-view/"><cite>CSSOM 视图模块</cite></a>。URL: <a
                href="https://drafts.csswg.org/cssom-view/">https://drafts.csswg.org/cssom-view/</a>
        <dt id="biblio-imagingprivacy">[IMAGINGPRIVACY]
        <dd>Yang Liu; et al. <a
                href="https://www.science.org/doi/10.1126/sciadv.adj3608"><cite>环境光传感器的成像隐私威胁</cite></a>。2024 年 1 月 10
            日。URL: <a
                href="https://www.science.org/doi/10.1126/sciadv.adj3608">https://www.science.org/doi/10.1126/sciadv.adj3608</a>
        <dt id="biblio-mediaqueries-5">[MEDIAQUERIES-5]
        <dd>Dean Jackson; et al. <a href="https://drafts.csswg.org/mediaqueries-5/"><cite>媒体查询第 5 级</cite></a>。URL: <a
                href="https://drafts.csswg.org/mediaqueries-5/">https://drafts.csswg.org/mediaqueries-5/</a>
        <dt id="biblio-pinskimmingviasensor">[PINSKIMMINGVIASENSOR]
        <dd>Raphael Spreitzer. <a href="https://arxiv.org/abs/1405.3760"><cite>PIN 窃取：利用移动设备中的环境光传感器</cite></a>。2014 年 5
            月 15 日。URL: <a href="https://arxiv.org/abs/1405.3760">https://arxiv.org/abs/1405.3760</a>
        <dt id="biblio-si">[SI]
        <dd><a href="http://www.bipm.org/en/publications/si-brochure/"><cite>SI 手册：国际单位制 (SI)，第 8 版</cite></a>。2014 年。第
            8 版。URL: <a
                href="http://www.bipm.org/en/publications/si-brochure/">http://www.bipm.org/en/publications/si-brochure/</a>
        <dt id="biblio-stealingsensitivedata">[STEALINGSENSITIVEDATA]
        <dd>Lukasz Olejnik. <a
                href="https://blog.lukaszolejnik.com/stealing-sensitive-browser-data-with-the-w3c-ambient-light-sensor-api/"><cite>使用
                    W3C 环境光传感器 API 窃取敏感浏览器数据</cite></a>。2017 年 4 月 19 日。URL: <a
                href="https://blog.lukaszolejnik.com/stealing-sensitive-browser-data-with-the-w3c-ambient-light-sensor-api/">https://blog.lukaszolejnik.com/stealing-sensitive-browser-data-with-the-w3c-ambient-light-sensor-api/</a>
        <dt id="biblio-videorecognitionambientlight">[VIDEORECOGNITIONAMBIENTLIGHT]
        <dd>Raphael Spreitzer. <a
                href="https://doi.org/10.1109/PERCOM.2016.7456511"><cite>使用环境光传感器进行视频识别</cite></a>。2016 年 4 月 21 日。URL:
            <a href="https://doi.org/10.1109/PERCOM.2016.7456511">https://doi.org/10.1109/PERCOM.2016.7456511</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#ambientlightsensor"><code><c- g>AmbientLightSensor</c-></code></a> : <a data-link-type="idl-name" href="https://w3c.github.io/sensors/#sensor"><c- n>Sensor</c-></a> {
  <a href="#dom-ambientlightsensor-ambientlightsensor"><code><c- g>constructor</c-></code></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="https://w3c.github.io/sensors/#dictdef-sensoroptions"><c- n>SensorOptions</c-></a> <a href="#dom-ambientlightsensor-ambientlightsensor-sensoroptions-sensoroptions"><code><c- g>sensorOptions</c-></code></a> = {});
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>? <a data-readonly data-type="double?" href="#dom-ambientlightsensor-illuminance"><code><c- g>illuminance</c-></code></a>;
};

</pre>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "0026f53f": { "dfnID": "0026f53f", "dfnText": "initialize a sensor object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-initialize-a-sensor-object" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://w3c.github.io/sensors/#initialize-a-sensor-object" },
                "1570624a": { "dfnID": "1570624a", "dfnText": "default allowlist", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature-default-allowlist" }], "title": "4. Model" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "1b956603": { "dfnID": "1b956603", "dfnText": "Sensor", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sensor" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-sensor\u2460" }], "title": "5.1. The AmbientLightSensor Interface" }], "url": "https://w3c.github.io/sensors/#sensor" },
                "1f45ff31": { "dfnID": "1f45ff31", "dfnText": "reading quantization algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reading-quantization-algorithm" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-reading-quantization-algorithm\u2460" }], "title": "6.3. Ambient light reading quantization algorithm" }], "url": "https://w3c.github.io/sensors/#reading-quantization-algorithm" },
                "207de9db": { "dfnID": "207de9db", "dfnText": "SensorOptions", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-sensoroptions" }], "title": "5.1. The AmbientLightSensor Interface" }, { "refs": [{ "id": "ref-for-dictdef-sensoroptions\u2460" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://w3c.github.io/sensors/#dictdef-sensoroptions" },
                "214e5c65": { "dfnID": "214e5c65", "dfnText": "reduce accuracy", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reduce-accuracy" }], "title": "3. Security and Privacy Considerations" }, { "refs": [{ "id": "ref-for-reduce-accuracy\u2460" }], "title": "3.1. Reducing sensor readings accuracy" }], "url": "https://w3c.github.io/sensors/#reduce-accuracy" },
                "2797dd43": { "dfnID": "2797dd43", "dfnText": "default sensor", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-default-sensor" }], "title": "4. Model" }], "url": "https://w3c.github.io/sensors/#default-sensor" },
                "36858240": { "dfnID": "36858240", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-boolean" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "https://infra.spec.whatwg.org/#boolean" },
                "3fca5a9e": { "dfnID": "3fca5a9e", "dfnText": "map", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-map" }], "title": "7. Automation" }], "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }], "title": "5.1.1. The illuminance attribute" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "409a61ca": { "dfnID": "409a61ca", "dfnText": "permission revocation algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-revocation-algorithm" }], "title": "4. Model" }], "url": "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm" },
                "4fa114dd": { "dfnID": "4fa114dd", "dfnText": "virtual sensor type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-virtual-sensor-type" }], "title": "4. Model" }], "url": "https://w3c.github.io/sensors/#virtual-sensor-type" },
                "5822d2f3": { "dfnID": "5822d2f3", "dfnText": "check sensor policy-controlled features", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-check-sensor-policy-controlled-features" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://w3c.github.io/sensors/#check-sensor-policy-controlled-features" },
                "5afb8cab": { "dfnID": "5afb8cab", "dfnText": "sensor reading", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sensor-reading" }, { "id": "ref-for-sensor-reading\u2460" }, { "id": "ref-for-sensor-reading\u2461" }, { "id": "ref-for-sensor-reading\u2462" }], "title": "2. Examples" }, { "refs": [{ "id": "ref-for-sensor-reading\u2463" }, { "id": "ref-for-sensor-reading\u2464" }], "title": "6.2. Ambient light threshold check algorithm" }, { "refs": [{ "id": "ref-for-sensor-reading\u2465" }, { "id": "ref-for-sensor-reading\u2466" }], "title": "6.3. Ambient light reading quantization algorithm" }], "url": "https://w3c.github.io/sensors/#sensor-reading" },
                "5d47b5a4": { "dfnID": "5d47b5a4", "dfnText": "per-type virtual sensor metadata", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-per-type-virtual-sensor-metadata" }], "title": "7. Automation" }], "url": "https://w3c.github.io/sensors/#per-type-virtual-sensor-metadata" },
                "6048fac5": { "dfnID": "6048fac5", "dfnText": "threshold check algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-threshold-check-algorithm" }, { "id": "ref-for-threshold-check-algorithm\u2460" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-threshold-check-algorithm\u2461" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "https://w3c.github.io/sensors/#threshold-check-algorithm" },
                "611c5008": { "dfnID": "611c5008", "dfnText": "reading parsing algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-virtual-sensor-metadata-reading-parsing-algorithm" }], "title": "7. Automation" }], "url": "https://w3c.github.io/sensors/#virtual-sensor-metadata-reading-parsing-algorithm" },
                "6c2d7879": { "dfnID": "6c2d7879", "dfnText": "powerful feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-powerful-feature" }], "title": "4. Model" }], "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "6f3f0749": { "dfnID": "6f3f0749", "dfnText": "sampling frequency", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sampling-frequency" }], "title": "8. Use Cases and Requirements" }], "url": "https://w3c.github.io/sensors/#sampling-frequency" },
                "802b0fdd": { "dfnID": "802b0fdd", "dfnText": "value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-value" }], "title": "7. Automation" }], "url": "https://infra.spec.whatwg.org/#map-value" },
                "80bf03eb": { "dfnID": "80bf03eb", "dfnText": "sensor permission names", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sensor-permission-names" }], "title": "4. Model" }], "url": "https://w3c.github.io/sensors/#sensor-permission-names" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }], "title": "5.1. The AmbientLightSensor Interface" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "8958b003": { "dfnID": "8958b003", "dfnText": "entry", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-entry" }], "title": "7. Automation" }], "url": "https://infra.spec.whatwg.org/#map-entry" },
                "8c800cdf": { "dfnID": "8c800cdf", "dfnText": "double", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-double" }], "title": "5.1. The AmbientLightSensor Interface" }], "url": "https://webidl.spec.whatwg.org/#idl-double" },
                "a09cf46b": { "dfnID": "a09cf46b", "dfnText": "Generic Sensor permission revocation algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generic-sensor-permission-revocation-algorithm" }], "title": "4. Model" }], "url": "https://w3c.github.io/sensors/#generic-sensor-permission-revocation-algorithm" },
                "a296510f": { "dfnID": "a296510f", "dfnText": "mitigation strategies", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-mitigation-strategies" }], "title": "3. Security and Privacy Considerations" }], "url": "https://w3c.github.io/sensors/#mitigation-strategies" },
                "a6e67972": { "dfnID": "a6e67972", "dfnText": "Object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sec-object-objects" }], "title": "7. Automation" }], "url": "https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object-objects" },
                "ambient-light-reading-quantization-algorithm": { "dfnID": "ambient-light-reading-quantization-algorithm", "dfnText": "6.3. Ambient light reading quantization algorithm", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-ambient-light-reading-quantization-algorithm" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-ambient-light-reading-quantization-algorithm\u2460" }, { "id": "ref-for-ambient-light-reading-quantization-algorithm\u2461" }, { "id": "ref-for-ambient-light-reading-quantization-algorithm\u2462" }], "title": "6.2. Ambient light threshold check algorithm" }, { "refs": [{ "id": "ref-for-ambient-light-reading-quantization-algorithm" }], "title": "6.3. Ambient light reading quantization algorithm" }], "url": "#ambient-light-reading-quantization-algorithm" },
                "ambient-light-sensor": { "dfnID": "ambient-light-sensor", "dfnText": "Ambient Light Sensor", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-ambient-light-sensor" }, { "id": "ref-for-ambient-light-sensor\u2460" }, { "id": "ref-for-ambient-light-sensor\u2461" }, { "id": "ref-for-ambient-light-sensor\u2462" }, { "id": "ref-for-ambient-light-sensor\u2463" }, { "id": "ref-for-ambient-light-sensor\u2464" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-ambient-light-sensor\u2465" }], "title": "6.2. Ambient light threshold check algorithm" }, { "refs": [{ "id": "ref-for-ambient-light-sensor\u2466" }], "title": "6.3. Ambient light reading quantization algorithm" }, { "refs": [{ "id": "ref-for-ambient-light-sensor\u2467" }], "title": "7. Automation" }], "url": "#ambient-light-sensor" },
                "ambient-light-threshold-check-algorithm": { "dfnID": "ambient-light-threshold-check-algorithm", "dfnText": "6.2. Ambient light threshold check algorithm", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-ambient-light-threshold-check-algorithm" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-ambient-light-threshold-check-algorithm\u2460" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-ambient-light-threshold-check-algorithm" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "#ambient-light-threshold-check-algorithm" },
                "ambient-light-virtual-sensor-type": { "dfnID": "ambient-light-virtual-sensor-type", "dfnText": "ambient-light", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-ambient-light-virtual-sensor-type" }], "title": "7. Automation" }], "url": "#ambient-light-virtual-sensor-type" },
                "ambientlightsensor": { "dfnID": "ambientlightsensor", "dfnText": "AmbientLightSensor", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-ambientlightsensor" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-ambientlightsensor\u2460" }], "title": "5.1. The AmbientLightSensor Interface" }, { "refs": [{ "id": "ref-for-ambientlightsensor\u2461" }, { "id": "ref-for-ambientlightsensor\u2462" }, { "id": "ref-for-ambientlightsensor\u2463" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "#ambientlightsensor" },
                "b01bbc68": { "dfnID": "b01bbc68", "dfnText": "abs", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eqn-abs" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "https://tc39.es/ecma262/#eqn-abs" },
                "b4cfa5ce": { "dfnID": "b4cfa5ce", "dfnText": "throw", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-throw" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://webidl.spec.whatwg.org/#dfn-throw" },
                "b75bb3bd": { "dfnID": "b75bb3bd", "dfnText": "SecureContext", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-SecureContext" }], "title": "5.1. The AmbientLightSensor Interface" }], "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "bb15fee5": { "dfnID": "bb15fee5", "dfnText": "virtual sensor metadata", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-virtual-sensor-metadata" }], "title": "7. Automation" }], "url": "https://w3c.github.io/sensors/#virtual-sensor-metadata" },
                "c1bbb186": { "dfnID": "c1bbb186", "dfnText": "parse single-value number reading", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-parse-single-value-number-reading" }], "title": "7. Automation" }], "url": "https://w3c.github.io/sensors/#parse-single-value-number-reading" },
                "c3e881ef": { "dfnID": "c3e881ef", "dfnText": "SecurityError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-securityerror" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://webidl.spec.whatwg.org/#securityerror" },
                "c79c290a": { "dfnID": "c79c290a", "dfnText": "limit maximum sampling frequency", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-limit-max-frequency" }], "title": "3. Security and Privacy Considerations" }], "url": "https://w3c.github.io/sensors/#limit-max-frequency" },
                "cc890cc1": { "dfnID": "cc890cc1", "dfnText": "policy-controlled feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature" }], "title": "4. Model" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "construct-an-ambient-light-sensor-object": { "dfnID": "construct-an-ambient-light-sensor-object", "dfnText": "6.1. Construct an ambient light sensor object", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-construct-an-ambient-light-sensor-object" }], "title": "5.1. The AmbientLightSensor Interface" }, { "refs": [{ "id": "ref-for-construct-an-ambient-light-sensor-object" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "#construct-an-ambient-light-sensor-object" },
                "current-light-level": { "dfnID": "current-light-level", "dfnText": "current light level", "external": false, "refSections": [], "url": "#current-light-level" },
                "d14a6f26": { "dfnID": "d14a6f26", "dfnText": "key", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-key" }], "title": "7. Automation" }], "url": "https://infra.spec.whatwg.org/#map-key" },
                "d8b6acc6": { "dfnID": "d8b6acc6", "dfnText": "update latest reading", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-update-latest-reading" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "https://w3c.github.io/sensors/#update-latest-reading" },
                "dca2de17": { "dfnID": "dca2de17", "dfnText": "DOMException", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMException" }], "title": "6.1. Construct an ambient light sensor object" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "dom-ambientlightsensor-ambientlightsensor": { "dfnID": "dom-ambientlightsensor-ambientlightsensor", "dfnText": "constructor", "external": false, "refSections": [], "url": "#dom-ambientlightsensor-ambientlightsensor" },
                "dom-ambientlightsensor-ambientlightsensor-sensoroptions-sensoroptions": { "dfnID": "dom-ambientlightsensor-ambientlightsensor-sensoroptions-sensoroptions", "dfnText": "sensorOptions", "external": false, "refSections": [], "url": "#dom-ambientlightsensor-ambientlightsensor-sensoroptions-sensoroptions" },
                "dom-ambientlightsensor-illuminance": { "dfnID": "dom-ambientlightsensor-illuminance", "dfnText": "illuminance", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-ambientlightsensor-illuminance" }], "title": "2. Examples" }, { "refs": [{ "id": "ref-for-dom-ambientlightsensor-illuminance\u2460" }], "title": "5.1.1. The illuminance attribute" }], "url": "#dom-ambientlightsensor-illuminance" },
                "e740d7e5": { "dfnID": "e740d7e5", "dfnText": "name", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-name" }], "title": "4. Model" }], "url": "https://w3c.github.io/permissions/#dfn-name" },
                "f96b75e9": { "dfnID": "f96b75e9", "dfnText": "sensor type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sensor-type" }], "title": "4. Model" }, { "refs": [{ "id": "ref-for-sensor-type\u2460" }], "title": "6.2. Ambient light threshold check algorithm" }, { "refs": [{ "id": "ref-for-sensor-type\u2461" }], "title": "6.3. Ambient light reading quantization algorithm" }], "url": "https://w3c.github.io/sensors/#sensor-type" },
                "fd4ad34f": { "dfnID": "fd4ad34f", "dfnText": "get value from latest reading", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-get-value-from-latest-reading" }], "title": "5.1.1. The illuminance attribute" }], "url": "https://w3c.github.io/sensors/#get-value-from-latest-reading" },
                "illuminance": { "dfnID": "illuminance", "dfnText": "illuminance", "external": false, "refSections": [], "url": "#illuminance" },
                "illuminance-reading-parsing-algorithm": { "dfnID": "illuminance-reading-parsing-algorithm", "dfnText": "illuminance reading parsing algorithm", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-illuminance-reading-parsing-algorithm" }], "title": "7. Automation" }], "url": "#illuminance-reading-parsing-algorithm" },
                "illuminance-rounding-multiple": { "dfnID": "illuminance-rounding-multiple", "dfnText": "illuminance rounding\nmultiple", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-illuminance-rounding-multiple" }, { "id": "ref-for-illuminance-rounding-multiple\u2460" }, { "id": "ref-for-illuminance-rounding-multiple\u2461" }, { "id": "ref-for-illuminance-rounding-multiple\u2462" }, { "id": "ref-for-illuminance-rounding-multiple\u2463" }, { "id": "ref-for-illuminance-rounding-multiple\u2464" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-illuminance-rounding-multiple\u2465" }], "title": "6.2. Ambient light threshold check algorithm" }, { "refs": [{ "id": "ref-for-illuminance-rounding-multiple\u2466" }], "title": "6.3. Ambient light reading quantization algorithm" }], "url": "#illuminance-rounding-multiple" },
                "illuminance-threshold-value": { "dfnID": "illuminance-threshold-value", "dfnText": "illuminance threshold value", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-illuminance-threshold-value" }, { "id": "ref-for-illuminance-threshold-value\u2460" }, { "id": "ref-for-illuminance-threshold-value\u2461" }], "title": "3.1. Reducing sensor readings accuracy" }, { "refs": [{ "id": "ref-for-illuminance-threshold-value\u2462" }, { "id": "ref-for-illuminance-threshold-value\u2463" }], "title": "6.2. Ambient light threshold check algorithm" }], "url": "#illuminance-threshold-value" },
                "permissiondef-ambient-light-sensor": { "dfnID": "permissiondef-ambient-light-sensor", "dfnText": "ambient-light-sensor", "external": false, "refSections": [], "url": "#permissiondef-ambient-light-sensor" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#ambient-light-reading-quantization-algorithm": { "displayText": "ambient light reading quantization algorithm", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "ambient light reading quantization algorithm", "type": "dfn", "url": "#ambient-light-reading-quantization-algorithm" },
                "#ambient-light-sensor": { "displayText": "ambient light sensor", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "ambient light sensor", "type": "dfn", "url": "#ambient-light-sensor" },
                "#ambient-light-threshold-check-algorithm": { "displayText": "ambient light threshold check algorithm", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "ambient light threshold check algorithm", "type": "dfn", "url": "#ambient-light-threshold-check-algorithm" },
                "#ambient-light-virtual-sensor-type": { "displayText": "ambient-light virtual sensor type", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "ambient-light virtual sensor type", "type": "dfn", "url": "#ambient-light-virtual-sensor-type" },
                "#ambientlightsensor": { "displayText": "AmbientLightSensor", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "AmbientLightSensor", "type": "interface", "url": "#ambientlightsensor" },
                "#construct-an-ambient-light-sensor-object": { "displayText": "construct an ambient light sensor object", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "construct an ambient light sensor object", "type": "dfn", "url": "#construct-an-ambient-light-sensor-object" },
                "#dom-ambientlightsensor-illuminance": { "displayText": "illuminance", "export": true, "for_": ["AmbientLightSensor"], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "illuminance", "type": "attribute", "url": "#dom-ambientlightsensor-illuminance" },
                "#illuminance-reading-parsing-algorithm": { "displayText": "illuminance reading parsing algorithm", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "illuminance reading parsing algorithm", "type": "dfn", "url": "#illuminance-reading-parsing-algorithm" },
                "#illuminance-rounding-multiple": { "displayText": "illuminance rounding multiple", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "illuminance rounding multiple", "type": "dfn", "url": "#illuminance-rounding-multiple" },
                "#illuminance-threshold-value": { "displayText": "illuminance threshold value", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ambient-light", "spec": "ambient-light", "status": "local", "text": "illuminance threshold value", "type": "dfn", "url": "#illuminance-threshold-value" },
                "https://infra.spec.whatwg.org/#boolean": { "displayText": "boolean", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "boolean", "type": "dfn", "url": "https://infra.spec.whatwg.org/#boolean" },
                "https://infra.spec.whatwg.org/#map-entry": { "displayText": "entry", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "entry", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-entry" },
                "https://infra.spec.whatwg.org/#map-key": { "displayText": "key", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "key", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-key" },
                "https://infra.spec.whatwg.org/#map-value": { "displayText": "value", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "value", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-value" },
                "https://infra.spec.whatwg.org/#ordered-map": { "displayText": "map", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "map", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-map" },
                "https://tc39.es/ecma262/#eqn-abs": { "displayText": "abs", "export": true, "for_": [], "level": "262", "normative": true, "shortname": "ecma", "spec": "ecma-262", "status": "anchor-block", "text": "abs", "type": "abstract-op", "url": "https://tc39.es/ecma262/#eqn-abs" },
                "https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object-objects": { "displayText": "Object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "current", "text": "Object", "type": "interface", "url": "https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object-objects" },
                "https://w3c.github.io/permissions/#dfn-name": { "displayText": "name", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "name", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-name" },
                "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm": { "displayText": "permission revocation algorithm", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission revocation algorithm", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm" },
                "https://w3c.github.io/permissions/#dfn-powerful-feature": { "displayText": "powerful feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "powerful feature", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "https://w3c.github.io/sensors/#check-sensor-policy-controlled-features": { "displayText": "check sensor policy-controlled features", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "check sensor policy-controlled features", "type": "dfn", "url": "https://w3c.github.io/sensors/#check-sensor-policy-controlled-features" },
                "https://w3c.github.io/sensors/#default-sensor": { "displayText": "default sensor", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "default sensor", "type": "dfn", "url": "https://w3c.github.io/sensors/#default-sensor" },
                "https://w3c.github.io/sensors/#dictdef-sensoroptions": { "displayText": "SensorOptions", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "SensorOptions", "type": "dictionary", "url": "https://w3c.github.io/sensors/#dictdef-sensoroptions" },
                "https://w3c.github.io/sensors/#generic-sensor-permission-revocation-algorithm": { "displayText": "Generic Sensor permission revocation algorithm", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "generic sensor permission revocation algorithm", "type": "dfn", "url": "https://w3c.github.io/sensors/#generic-sensor-permission-revocation-algorithm" },
                "https://w3c.github.io/sensors/#get-value-from-latest-reading": { "displayText": "get value from latest reading", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "get value from latest reading", "type": "dfn", "url": "https://w3c.github.io/sensors/#get-value-from-latest-reading" },
                "https://w3c.github.io/sensors/#initialize-a-sensor-object": { "displayText": "initialize a sensor object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "initialize a sensor object", "type": "dfn", "url": "https://w3c.github.io/sensors/#initialize-a-sensor-object" },
                "https://w3c.github.io/sensors/#limit-max-frequency": { "displayText": "limit maximum sampling frequency", "export": true, "for_": [], "level": "", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "anchor-block", "text": "limit maximum sampling frequency", "type": "dfn", "url": "https://w3c.github.io/sensors/#limit-max-frequency" },
                "https://w3c.github.io/sensors/#mitigation-strategies": { "displayText": "mitigation strategies", "export": true, "for_": [], "level": "", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "anchor-block", "text": "mitigation strategies", "type": "dfn", "url": "https://w3c.github.io/sensors/#mitigation-strategies" },
                "https://w3c.github.io/sensors/#parse-single-value-number-reading": { "displayText": "parse single-value number reading", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "parse single-value number reading", "type": "dfn", "url": "https://w3c.github.io/sensors/#parse-single-value-number-reading" },
                "https://w3c.github.io/sensors/#per-type-virtual-sensor-metadata": { "displayText": "per-type virtual sensor metadata", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "per-type virtual sensor metadata", "type": "dfn", "url": "https://w3c.github.io/sensors/#per-type-virtual-sensor-metadata" },
                "https://w3c.github.io/sensors/#reading-quantization-algorithm": { "displayText": "reading quantization algorithm", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "reading quantization algorithm", "type": "dfn", "url": "https://w3c.github.io/sensors/#reading-quantization-algorithm" },
                "https://w3c.github.io/sensors/#reduce-accuracy": { "displayText": "reduce accuracy", "export": true, "for_": [], "level": "", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "anchor-block", "text": "reduce accuracy", "type": "dfn", "url": "https://w3c.github.io/sensors/#reduce-accuracy" },
                "https://w3c.github.io/sensors/#sampling-frequency": { "displayText": "sampling frequency", "export": true, "for_": [], "level": "", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "anchor-block", "text": "sampling frequency", "type": "dfn", "url": "https://w3c.github.io/sensors/#sampling-frequency" },
                "https://w3c.github.io/sensors/#sensor": { "displayText": "Sensor", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "Sensor", "type": "interface", "url": "https://w3c.github.io/sensors/#sensor" },
                "https://w3c.github.io/sensors/#sensor-permission-names": { "displayText": "sensor permission names", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "sensor permission names", "type": "dfn", "url": "https://w3c.github.io/sensors/#sensor-permission-names" },
                "https://w3c.github.io/sensors/#sensor-reading": { "displayText": "sensor reading", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "sensor reading", "type": "dfn", "url": "https://w3c.github.io/sensors/#sensor-reading" },
                "https://w3c.github.io/sensors/#sensor-type": { "displayText": "sensor type", "export": true, "for_": [], "level": "", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "anchor-block", "text": "sensor type", "type": "dfn", "url": "https://w3c.github.io/sensors/#sensor-type" },
                "https://w3c.github.io/sensors/#threshold-check-algorithm": { "displayText": "threshold check algorithm", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "threshold check algorithm", "type": "dfn", "url": "https://w3c.github.io/sensors/#threshold-check-algorithm" },
                "https://w3c.github.io/sensors/#update-latest-reading": { "displayText": "update latest reading", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "update latest reading", "type": "dfn", "url": "https://w3c.github.io/sensors/#update-latest-reading" },
                "https://w3c.github.io/sensors/#virtual-sensor-metadata": { "displayText": "virtual sensor metadata", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "virtual sensor metadata", "type": "dfn", "url": "https://w3c.github.io/sensors/#virtual-sensor-metadata" },
                "https://w3c.github.io/sensors/#virtual-sensor-metadata-reading-parsing-algorithm": { "displayText": "reading parsing algorithm", "export": true, "for_": ["virtual sensor metadata"], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "reading parsing algorithm", "type": "dfn", "url": "https://w3c.github.io/sensors/#virtual-sensor-metadata-reading-parsing-algorithm" },
                "https://w3c.github.io/sensors/#virtual-sensor-type": { "displayText": "virtual sensor type", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "generic-sensor", "spec": "generic-sensor", "status": "current", "text": "virtual sensor type", "type": "dfn", "url": "https://w3c.github.io/sensors/#virtual-sensor-type" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature": { "displayText": "policy-controlled feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "policy-controlled feature", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist": { "displayText": "default allowlist", "export": true, "for_": ["policy-controlled feature"], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "default allowlist", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "https://webidl.spec.whatwg.org/#Exposed": { "displayText": "Exposed", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#SecureContext": { "displayText": "SecureContext", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SecureContext", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "https://webidl.spec.whatwg.org/#dfn-throw": { "displayText": "throw", "export": true, "for_": ["exception"], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "throw", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#dfn-throw" },
                "https://webidl.spec.whatwg.org/#idl-DOMException": { "displayText": "DOMException", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMException", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "https://webidl.spec.whatwg.org/#idl-double": { "displayText": "double", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "double", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-double" },
                "https://webidl.spec.whatwg.org/#securityerror": { "displayText": "SecurityError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SecurityError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#securityerror" },
                "https://webidl.spec.whatwg.org/#this": { "displayText": "this", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const ref = refsData[url];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>
    <svg style="display:none" viewBox="0 0 46 64">
        <defs>
            <path
                d="M2 23Q17 -16 40 12M1 35Q17 -20 43 20M2 40Q18 -19 44 25M3 43Q19 -16 45 29M5 46Q20 -12 45 32M5 49Q11 40 15 27T27 16T45 37M5 49Q15 38 19 25T34 27T44 41M6 52Q17 40 21 28T32 29T43 44M6 52Q21 42 23 31T30 32T42 47M7 54Q23 47 24 36T28 34T41 50M8 56Q26 50 26 35Q28 48 40 53M10 58Q24 54 27 45Q30 52 38 55M27 50Q28 53 36 57M25 52Q28 56 31 57M22 55L26 57M10 58L37 57M13 60L32 60M16 62L28 63"
                fill="none" id="b732b3fe" stroke="currentcolor" stroke-dasharray="3,2,35,2,20,2" stroke-linecap="round"
                stroke-linejoin="round"></path>
        </defs>
    </svg>
    <script src="/dropdown.js"></script>