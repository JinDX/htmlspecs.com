<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>RFC 8188 - Encrypted Content-Encoding for HTTP</title>
    <script>
        function getMeta(rfcno, container) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://www.rfc-editor.org/rfc/rfc" + rfcno + ".json", true);
            xhr.onload = function (e) {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var data = JSON.parse(xhr.response);

                        var cont = document.getElementById(container);
                        // empty the container
                        while (cont.firstChild) {
                            cont.removeChild(myNode.firstChild);
                        }

                        var c = data.status;
                        if (c) {
                            var bld = newElementWithText("b", c);
                            cont.appendChild(bld);
                        } else {
                            cont.appendChild(newElementWithText("i", "(document status unknown)"));
                        }

                        c = data.updated_by;
                        if (c && c.length > 0 && c[0] !== null && c[0].length > 0) {
                            cont.appendChild(newElement("br"));
                            cont.appendChild(newText("Updated by: "));
                            appendRfcLinks(cont, c);
                        }

                        c = data.obsoleted_by;
                        if (c && c.length > 0 && c[0] !== null && c[0].length > 0) {
                            cont.appendChild(newElement("br"));
                            cont.appendChild(newText("Obsoleted by: "));
                            appendRfcLinks(cont, c);
                        }

                        c = data.errata_url;
                        if (c) {
                            cont.appendChild(newElement("br"));
                            var link = newElementWithText("a", "errata");
                            link.setAttribute("href", c);
                            var errata = newElementWithText("i", "This document has ");
                            errata.appendChild(link);
                            errata.appendChild(newText("."));
                            cont.appendChild(errata);
                        }

                        cont.style.display = "block";
                    } else {
                        console.error(xhr.statusText);
                    }
                }
            };
            xhr.onerror = function (e) {
                console.error(xhr.status + " " + xhr.statusText);
            };
            xhr.send(null);
        }
        function appendRfcLinks(parent, updates) {
            var template = "https://www.rfc-editor.org/rfc/rfc{rfc}.html";
            for (var i = 0; i < updates.length; i++) {
                var rfc = updates[i].trim().toLowerCase();
                if (rfc.substring(0, 3) == "rfc") {
                    var no = parseInt(rfc.substring(3), 10);

                    var link = newElement("a");
                    link.setAttribute("href", template.replace("{rfc}", no));
                    link.appendChild(newText(no));
                    parent.appendChild(link);
                } else {
                    parent.appendChild(newText(rfc));
                }
                if (i != updates.length - 1) {
                    parent.appendChild(newText(", "));
                }
            }
        }

        // DOM helpers
        function newElement(name) {
            return document.createElement(name);
        }
        function newElementWithText(name, txt) {
            var e = document.createElement(name);
            e.appendChild(newText(txt));
            return e;
        }
        function newText(text) {
            return document.createTextNode(text);
        }
    </script>
    <script>
        function anchorRewrite() {
            map = {};
            if (window.location.hash.length >= 1) {
                var fragid = window.location.hash.substr(1);
                if (fragid) {
                    if (!document.getElementById(fragid)) {
                        var prefix = "rfc.";
                        var mapped = map[fragid];
                        if (mapped) {
                            window.location.hash = mapped;
                        } else if (fragid.indexOf("section-") == 0) {
                            window.location.hash = prefix + "section." + fragid.substring(8).replace("-", ".p.");
                        } else if (fragid.indexOf("appendix-") == 0) {
                            window.location.hash = prefix + "section." + fragid.substring(9).replace("-", ".p.");
                        } else if (fragid.indexOf("s-") == 0) {
                            var postfix = fragid.substring(2);
                            if (postfix.startsWith("abstract")) {
                                window.location.hash = prefix + postfix;
                            } else if (postfix.startsWith("note-")) {
                                window.location.hash = prefix + "note." + postfix.substring(5).replace("-", ".p.");
                            } else {
                                window.location.hash = prefix + "section." + postfix.replace("-", ".p.");
                            }
                        } else if (fragid.indexOf("p-") == 0) {
                            var r = fragid.substring(2);
                            var p = r.indexOf("-");
                            if (p >= 0) {
                                window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
                            }
                        }
                    }
                }
            }
        }
        window.addEventListener('hashchange', anchorRewrite);
        window.addEventListener('DOMContentLoaded', anchorRewrite);
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:type" content="article">
    <meta property="og:title" content="RFC8188">
    <meta property="og:description" content="Encrypted Content-Encoding for HTTP">
    <meta property="og:url" content="https://httpwg.org/specs/rfc8188.html">
    <meta property="og:site_name" content="IETF HTTP Working Group Specifications">
    <meta property="og:image" content="https://httpwg.org/assets/favicon/apple-icon-180x180.png">
    <link rel="stylesheet" type="text/css" href="/assets/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <style type="text/css">
        body {
            padding-top: 80px;
            padding-bottom: 80px;
            position: relative;
        }

        .table.header th,
        .table.header td {
            border-top: none;
            padding: 0;
        }

        #sidebar {
            margin-top: -10px;
            height: 90%;
            overflow-y: auto;
            font-size: 90%;
        }

        #rfc\.meta {
            width: 40%;
            float: right
        }

        .toc ul {
            list-style: none;
        }

        .filename {
            color: rgb(119, 119, 119);
            font-size: 23px;
            font-weight: normal;
            height: auto;
            line-height: 23px;
        }

        dl {
            margin-left: 1em;
        }

        dl.dl-horizontal: {
            margin-left: 0;
        }

        dl>dt {
            float: left;
            margin-right: 1em;
        }

        dl.nohang>dt {
            float: none;
        }

        dl>dd {
            margin-bottom: .5em;
        }

        dl.compact>dd {
            margin-bottom: 0em;
        }

        dl>dd>dl {
            margin-top: 0.5em;
            margin-bottom: 0em;
        }

        ul.empty {
            list-style-type: none;
        }

        ul.empty li {
            margin-top: .5em;
        }

        td.reference {
            padding-right: 1em;
            vertical-align: top;
        }

        .feedback {
            position: fixed;
            bottom: 5px;
            right: 5px;
        }

        .fbbutton {
            margin-left: 5px;
        }

        h1 a,
        h2 a,
        h3 a,
        h4 a,
        h5 a,
        h6 a {
            color: rgb(51, 51, 51);
        }

        span.tt {
            font: 11pt consolas, monospace;
            font-size-adjust: none;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="/assets/site.css">
    <link rel="Contents" href="#rfc.toc">
    <link rel="Author" href="#rfc.authors">
    <link rel="License" href="#rfc.copyrightnotice">
    <link rel="Chapter" title="1 Introduction" href="#rfc.section.1">
    <link rel="Chapter" title="2 The &#34;aes128gcm&#34; HTTP Content Coding" href="#rfc.section.2">
    <link rel="Chapter" title="3 Examples" href="#rfc.section.3">
    <link rel="Chapter" title="4 Security Considerations" href="#rfc.section.4">
    <link rel="Chapter" title="5 IANA Considerations" href="#rfc.section.5">
    <link rel="Chapter" title="6 References" href="#rfc.section.6">
    <link rel="Appendix" title="A JWE Mapping" href="#rfc.section.A">
    <link rel="Appendix" title="Acknowledgements" href="#rfc.section.unnumbered-1">
    <link rel="convertedFrom" href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-encryption-encoding/">
    <link rel="Alternate" title="Plain Text Version" href="http://www.ietf.org/rfc/rfc8188.txt">
    <link rel="Help" title="RFC-Editor's Status Page" href="http://www.rfc-editor.org/info/rfc8188">
    <meta name="viewport" content="initial-scale=1">
    <meta name="generator"
        content="https://github.com/mnot/RFCBootstrap XSLT vendor: Saxonica http://www.saxonica.com/">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.creator" content="Thomson, M.">
    <meta name="dcterms.identifier" content="urn:ietf:rfc:8188">
    <meta name="dcterms.issued" content="2017-06">
    <meta name="dcterms.abstract"
        content="This memo introduces a content coding for HTTP that allows message payloads to be encrypted.">
    <meta name="dcterms.isPartOf" content="urn:issn:2070-1721">
    <meta name="description"
        content="This memo introduces a content coding for HTTP that allows message payloads to be encrypted.">
</head>

<body onload="getMeta(8188,&#34;rfc.meta&#34;);">
    <nav class="navbar navbar-dark bg-dark d-print-none navbar-expand-lg fixed-top ps-3 pe-3" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapse"
                aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <a class="navbar-brand" href="https://httpwg.org/"><img src="https://httpwg.org/assets/http.svg"
                    height="23"></a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse">

            <div class="navbar-nav me-auto">

                <a class="nav-item ms-1 text-white" href="https://httpwg.org/specs/">📄 Documentation</a>

                <div class="dropdown ms-4">
                    <a href="#" class="nav-item dropdown-toggle text-white" data-bs-toggle="dropdown">Work in
                        Progress</a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://httpwg.org/http-extensions/">HTTP Extensions</a></li>
                        <li class="dropdown-item"><a
                                href="https://github.com/httpwg/admin/issues?q=is%3Aissue+is%3Aopen+label%3Aadoption">Future
                                Work</a></li>
                    </ul>
                </div>

                <div class="dropdown ms-4">
                    <a href="#" class="nav-item dropdown-toggle text-white" data-bs-toggle="dropdown">Participate</a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://httpwg.org/about/">About the HTTP Working Group</a>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/CONTRIBUTING.html">Contribution Policy</a>
                        </li>
                        <li class="dropdown-item"><a href="http://datatracker.ietf.org/wg/httpbis/charter/">WG
                                Charter</a></li>
                        <li class="dropdown-item"><a href="http://lists.w3.org/Archives/Public/ietf-http-wg/">Group
                                Mailing List 📨</a></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/wg-materials/">Meeting Materials</a></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/admin/editors/">Document Editor
                                Resources</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </nav>
    <div class="container" id="top">
        <div class="row">
            <div class="col-lg-4 order-last d-none d-lg-block" id="sidebar" role="navigation">
                <div class="navbar">
                    <div class="navbar-brand"><a href="#top"><strong>RFC </strong>8188</a></div><br clear="all">
                    <div class="">
                        <div class="toc ">
                            <ul>
                                <li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#introduction">Introduction</a>
                                    <ul>
                                        <li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#rfc.section.1.1">Requirements Language</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#aes128gcm">The
                                        "aes128gcm" HTTP Content Coding</a>
                                    <ul>
                                        <li><a href="#rfc.section.2.1">2.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#header">Encryption Content-Coding Header</a></li>
                                        <li><a href="#rfc.section.2.2">2.2.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#derivation">Content-Encryption Key Derivation</a></li>
                                        <li><a href="#rfc.section.2.3">2.3.</a>&nbsp;&nbsp;&nbsp;<a href="#nonce">Nonce
                                                Derivation</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a>
                                    <ul>
                                        <li><a href="#rfc.section.3.1">3.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#explicit">Encryption of a Response</a></li>
                                        <li><a href="#rfc.section.3.2">3.2.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#encryption-with-multiple-records">Encryption with Multiple
                                                Records</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#security-considerations">Security Considerations</a>
                                    <ul>
                                        <li><a href="#rfc.section.4.1">4.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#automatic-decryption">Automatic Decryption</a></li>
                                        <li><a href="#rfc.section.4.2">4.2.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#message-truncation">Message Truncation</a></li>
                                        <li><a href="#rfc.section.4.3">4.3.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#key-and-nonce-reuse">Key and Nonce Reuse</a></li>
                                        <li><a href="#rfc.section.4.4">4.4.</a>&nbsp;&nbsp;&nbsp;<a href="#limits">Data
                                                Encryption Limits</a></li>
                                        <li><a href="#rfc.section.4.5">4.5.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#content-integrity">Content Integrity</a></li>
                                        <li><a href="#rfc.section.4.6">4.6.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#leaking-information-in-header-fields">Leaking Information in
                                                Header Fields</a></li>
                                        <li><a href="#rfc.section.4.7">4.7.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#poisoning-storage">Poisoning Storage</a></li>
                                        <li><a href="#rfc.section.4.8">4.8.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#sizing-and-timing-attacks">Sizing and Timing Attacks</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#iana">IANA
                                        Considerations</a>
                                    <ul>
                                        <li><a href="#rfc.section.5.1">5.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#the-aes128gcm-http-content-coding">The "aes128gcm" HTTP Content
                                                Coding</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#rfc.references">References</a>
                                    <ul>
                                        <li><a href="#rfc.section.6.1">6.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#rfc.references.1">Normative References</a></li>
                                        <li><a href="#rfc.section.6.2">6.2.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#rfc.references.2">Informative References</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.A">Appendix A.</a>&nbsp;&nbsp;&nbsp;<a href="#jwe">JWE
                                        Mapping</a></li>
                                <li><a href="#acknowledgements">Acknowledgements</a></li>
                                <li><a href="#rfc.authors">Author's Address</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 order-first main" role="main">
                <header>
                    <table class="table table-condensed header" id="rfc.headerblock">
                        <tbody>
                            <tr>
                                <td class="text-left">Internet Engineering Task Force (IETF)</td>
                                <td class="text-right">M. Thomson</td>
                            </tr>
                            <tr>
                                <td class="text-left">Request for Comments: 8188</td>
                                <td class="text-right">Mozilla</td>
                            </tr>
                            <tr>
                                <td class="text-left">Category: Standards Track</td>
                                <td class="text-right">June 2017</td>
                            </tr>
                            <tr>
                                <td class="text-left">ISSN: 2070-1721</td>
                                <td class="text-right"></td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="rfc.title">
                        <h1>Encrypted Content-Encoding for HTTP</h1>
                    </div>
                </header>
                <hr>
                <h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2>
                <div class="lead">
                    <div id="rfc.abstract.p.1">
                        <p>This memo introduces a content coding for HTTP that allows message payloads to be encrypted.
                        </p>
                    </div>
                </div>
                <aside id="rfc.meta" class="alert alert-info"></aside>
                <section id="rfc.status">
                    <h2><a href="#rfc.status">Status of this Memo</a></h2>
                    <div id="rfc.boilerplate.1.p.1">
                        <p>This is an Internet Standards Track document.</p>
                    </div>
                    <div id="rfc.boilerplate.1.p.2">
                        <p>This document is a product of the Internet Engineering Task Force (IETF). It represents the
                            consensus of the IETF community. It has received public review and has been approved for
                            publication by the Internet Engineering Steering Group (IESG). Further information on
                            Internet Standards is available in <a
                                href="https://www.rfc-editor.org/rfc/rfc7841.html#section-2">Section 2 of RFC 7841</a>.
                        </p>
                    </div>
                    <div id="rfc.boilerplate.1.p.3">
                        <p>Information about the current status of this document, any errata, and how to provide
                            feedback on it may be obtained at <a
                                href="http://www.rfc-editor.org/info/rfc8188">http://www.rfc-editor.org/info/rfc8188</a>.
                        </p>
                    </div>
                </section>
                <section id="rfc.copyrightnotice">
                    <h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2>
                    <div id="rfc.boilerplate.2.p.1">
                        <p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors. All rights
                            reserved.</p>
                    </div>
                    <div id="rfc.boilerplate.2.p.2">
                        <p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF
                            Documents (<a
                                href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in
                            effect on the date of publication of this document. Please review these documents carefully,
                            as they describe your rights and restrictions with respect to this document. Code Components
                            extracted from this document must include Simplified BSD License text as described in
                            Section 4.e of the Trust Legal Provisions and are provided without warranty as described in
                            the Simplified BSD License.</p>
                    </div>
                </section>
                <div class="toc d-lg-none">
                    <ul>
                        <li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a>
                            <ul>
                                <li><a href="#rfc.section.1.1">1.1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#rfc.section.1.1">Requirements Language</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#aes128gcm">The "aes128gcm" HTTP
                                Content Coding</a>
                            <ul>
                                <li><a href="#rfc.section.2.1">2.1.</a>&nbsp;&nbsp;&nbsp;<a href="#header">Encryption
                                        Content-Coding Header</a></li>
                                <li><a href="#rfc.section.2.2">2.2.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#derivation">Content-Encryption Key Derivation</a></li>
                                <li><a href="#rfc.section.2.3">2.3.</a>&nbsp;&nbsp;&nbsp;<a href="#nonce">Nonce
                                        Derivation</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a>
                            <ul>
                                <li><a href="#rfc.section.3.1">3.1.</a>&nbsp;&nbsp;&nbsp;<a href="#explicit">Encryption
                                        of a Response</a></li>
                                <li><a href="#rfc.section.3.2">3.2.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#encryption-with-multiple-records">Encryption with Multiple Records</a>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security
                                Considerations</a>
                            <ul>
                                <li><a href="#rfc.section.4.1">4.1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#automatic-decryption">Automatic Decryption</a></li>
                                <li><a href="#rfc.section.4.2">4.2.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#message-truncation">Message Truncation</a></li>
                                <li><a href="#rfc.section.4.3">4.3.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#key-and-nonce-reuse">Key and Nonce Reuse</a></li>
                                <li><a href="#rfc.section.4.4">4.4.</a>&nbsp;&nbsp;&nbsp;<a href="#limits">Data
                                        Encryption Limits</a></li>
                                <li><a href="#rfc.section.4.5">4.5.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#content-integrity">Content Integrity</a></li>
                                <li><a href="#rfc.section.4.6">4.6.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#leaking-information-in-header-fields">Leaking Information in Header
                                        Fields</a></li>
                                <li><a href="#rfc.section.4.7">4.7.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#poisoning-storage">Poisoning Storage</a></li>
                                <li><a href="#rfc.section.4.8">4.8.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#sizing-and-timing-attacks">Sizing and Timing Attacks</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#iana">IANA Considerations</a>
                            <ul>
                                <li><a href="#rfc.section.5.1">5.1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#the-aes128gcm-http-content-coding">The "aes128gcm" HTTP Content
                                        Coding</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a>
                            <ul>
                                <li><a href="#rfc.section.6.1">6.1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#rfc.references.1">Normative References</a></li>
                                <li><a href="#rfc.section.6.2">6.2.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#rfc.references.2">Informative References</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.A">Appendix A.</a>&nbsp;&nbsp;&nbsp;<a href="#jwe">JWE Mapping</a>
                        </li>
                        <li><a href="#acknowledgements">Acknowledgements</a></li>
                        <li><a href="#rfc.authors">Author's Address</a></li>
                    </ul>
                </div>
                <section id="introduction">
                    <h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a
                            href="#introduction">Introduction</a></h2>
                    <div id="rfc.section.1.p.1">
                        <p>It is sometimes desirable to encrypt the contents of an HTTP message (request or response) so
                            that when the payload is stored (e.g., with an HTTP PUT), only someone with the appropriate
                            key can read it.</p>
                    </div>
                    <div id="rfc.section.1.p.2">
                        <p>For example, it might be necessary to store a file on a server without exposing its contents
                            to that server. Furthermore, that same file could be replicated to other servers (to make it
                            more resistant to server or network failure), downloaded by clients (to make it available
                            offline), etc., without exposing its contents.</p>
                    </div>
                    <div id="rfc.section.1.p.3">
                        <p>These uses are not met by the use of Transport Layer Security (TLS) <a href="#RFC5246"><cite
                                    title="The Transport Layer Security (TLS) Protocol Version 1.2">[RFC5246]</cite></a>,
                            since it only encrypts the channel between the client and server.</p>
                    </div>
                    <div id="rfc.section.1.p.4">
                        <p>This document specifies a content coding (see <a
                                href="https://www.rfc-editor.org/rfc/rfc7231.html#section-3.1.2">Section 3.1.2</a> of <a
                                href="#RFC7231"><cite
                                    title="Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content">[RFC7231]</cite></a>)
                            for HTTP to serve these and other use cases.</p>
                    </div>
                    <div id="rfc.section.1.p.5">
                        <p>This content coding is not a direct adaptation of message-based encryption formats -- such as
                            those that are described by <a href="#RFC4880"><cite
                                    title="OpenPGP Message Format">[RFC4880]</cite></a>, <a href="#RFC5652"><cite
                                    title="Cryptographic Message Syntax (CMS)">[RFC5652]</cite></a>, <a
                                href="#RFC7516"><cite title="JSON Web Encryption (JWE)">[RFC7516]</cite></a>, and <a
                                href="#XMLENC"><cite
                                    title="XML Encryption Syntax and Processing Version 1.1">[XMLENC]</cite></a>. Those
                            formats are not suited to stream processing, which is necessary for HTTP. The format
                            described here follows more closely to the lower-level constructs described in <a
                                href="#RFC5116"><cite
                                    title="An Interface and Algorithms for Authenticated Encryption">[RFC5116]</cite></a>.
                        </p>
                    </div>
                    <div id="rfc.section.1.p.6">
                        <p>To the extent that message-based encryption formats use the same primitives, the format can
                            be considered to be a sequence of encrypted messages with a particular profile. For
                            instance, <a href="#jwe" title="JWE Mapping">Appendix A</a> explains how the format is
                            congruent with a sequence of JSON Web Encryption <a href="#RFC7516"><cite
                                    title="JSON Web Encryption (JWE)">[RFC7516]</cite></a> values with a fixed header.
                        </p>
                    </div>
                    <div id="rfc.section.1.p.7">
                        <p>This mechanism is likely only a small part of a larger design that uses content encryption.
                            How clients and servers acquire and identify keys will depend on the use case. In
                            particular, a key management system is not described.</p>
                    </div>
                    <section id="n-requirements-language">
                        <h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a>&nbsp;<a
                                href="#n-requirements-language">Requirements Language</a></h3>
                        <div id="rfc.section.1.1.p.1">
                            <p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD
                                NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
                                interpreted as described in BCP 14 <a href="#RFC2119"><cite
                                        title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>
                                <a href="#RFC8174"><cite
                                        title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">[RFC8174]</cite></a>
                                when, and only when, they appear in all capitals, as shown here.
                            </p>
                        </div>
                    </section>
                </section>
                <section id="aes128gcm">
                    <h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#aes128gcm">The "aes128gcm"
                            HTTP Content Coding</a></h2>
                    <div id="rfc.section.2.p.1">
                        <p>The "aes128gcm" HTTP content coding indicates that a payload has been encrypted using
                            Advanced Encryption Standard (AES) in Galois/Counter Mode (GCM) as identified as
                            AEAD_AES_128_GCM in <a href="#RFC5116"><cite
                                    title="An Interface and Algorithms for Authenticated Encryption">[RFC5116]</cite></a>,
                            <a href="https://www.rfc-editor.org/rfc/rfc5116.html#section-5.1">Section 5.1</a>. The
                            AEAD_AES_128_GCM algorithm uses a 128-bit content-encryption key.
                        </p>
                    </div>
                    <div id="rfc.section.2.p.2">
                        <p>Using this content coding requires knowledge of a key. How this key is acquired is not
                            defined in this document.</p>
                    </div>
                    <div id="rfc.section.2.p.3">
                        <p>The "aes128gcm" content coding uses a single fixed set of encryption primitives. Cipher
                            agility is achieved by defining a new content-coding scheme. This ensures that only the HTTP
                            Accept-Encoding header field is necessary to negotiate the use of encryption.</p>
                    </div>
                    <div id="rfc.section.2.p.4">
                        <p>The "aes128gcm" content coding uses a fixed record size. The final encoding consists of a
                            header (see <a href="#header" title="Encryption Content-Coding Header">Section 2.1</a>) and
                            zero or more fixed-size encrypted records; the final record can be smaller than the record
                            size.</p>
                    </div>
                    <div id="rfc.section.2.p.5">
                        <p>The record size determines the length of each portion of plaintext that is enciphered. The
                            record size ("rs") is included in the content-coding header (see <a href="#header"
                                title="Encryption Content-Coding Header">Section 2.1</a>).</p>
                    </div>
                    <div id="rfc.figure.1">
                        <div>
                            <pre class="drawing">
+-----------+             content
|   data    |             any length up to rs-17 octets
+-----------+
     |
     v
+-----------+-----+       add a delimiter octet (0x01 or 0x02)
|   data    | pad |       then 0x00-valued octets to rs-16
+-----------+-----+       (or less on the last record)
         |
         v
+--------------------+    encrypt with AEAD_AES_128_GCM;
|    ciphertext      |    final size is rs;
+--------------------+    the last record can be smaller
</pre>
                        </div>
                    </div>
                    <div id="rfc.section.2.p.6">
                        <p>AEAD_AES_128_GCM produces ciphertext 16 octets longer than its input plaintext. Therefore,
                            the unencrypted content of each record is shorter than the record size by 16 octets. Valid
                            records always contain at least a padding delimiter octet and a 16-octet authentication tag.
                        </p>
                    </div>
                    <div id="rfc.section.2.p.7">
                        <p>Each record contains a single padding delimiter octet followed by any number of zero octets.
                            The last record uses a padding delimiter octet set to the value 2, all other records have a
                            padding delimiter octet value of 1.</p>
                    </div>
                    <div id="rfc.section.2.p.8">
                        <p>On decryption, the padding delimiter is the last non-zero-valued octet of the record. A
                            decrypter MUST fail if the record contains no non-zero octet. A decrypter MUST fail if the
                            last record contains a padding delimiter with a value other than 2 or if any record other
                            than the last contains a padding delimiter with a value other than 1.</p>
                    </div>
                    <div id="rfc.section.2.p.9">
                        <p>The nonce for each record is a 96-bit value constructed from the record sequence number and
                            the input-keying material. Nonce derivation is covered in <a href="#nonce"
                                title="Nonce Derivation">Section 2.3</a>.</p>
                    </div>
                    <div id="rfc.section.2.p.10">
                        <p>The additional data passed to each invocation of AEAD_AES_128_GCM is a zero-length octet
                            sequence.</p>
                    </div>
                    <div id="rfc.section.2.p.11">
                        <p>A consequence of this record structure is that range requests <a href="#RFC7233"><cite
                                    title="Hypertext Transfer Protocol (HTTP/1.1): Range Requests">[RFC7233]</cite></a>
                            and random access to encrypted payload bodies are possible at the granularity of the record
                            size. Partial records at the ends of a range cannot be decrypted. Thus, it is best if range
                            requests start and end on record boundaries. However, note that random access to specific
                            parts of encrypted data could be confounded by the presence of padding.</p>
                    </div>
                    <div id="rfc.section.2.p.12">
                        <p>Selecting the record size most appropriate for a given situation requires a trade-off. A
                            smaller record size allows decrypted octets to be released more rapidly, which can be
                            appropriate for applications that depend on responsiveness. Smaller records also reduce the
                            additional data required if random access into the ciphertext is needed.</p>
                    </div>
                    <div id="rfc.section.2.p.13">
                        <p>Applications that don't depend on streaming, random access, or arbitrary padding can use
                            larger records, or even a single record. A larger record size reduces processing and data
                            overheads.</p>
                    </div>
                    <section id="header">
                        <h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a>&nbsp;<a href="#header">Encryption
                                Content-Coding Header</a></h3>
                        <div id="rfc.section.2.1.p.1">
                            <p>The content coding uses a header block that includes all parameters needed to decrypt the
                                content (other than the key). The header block is placed in the body of a message ahead
                                of the sequence of records.</p>
                        </div>
                        <div id="rfc.figure.2">
                            <div>
                                <pre class="drawing">
+-----------+--------+-----------+---------------+
| salt (16) | rs (4) | idlen (1) | keyid (idlen) |
+-----------+--------+-----------+---------------+
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.2.1.p.2">
                            <dl>
                                <dt>salt:</dt>
                                <dd>The "salt" parameter comprises the first 16 octets of the "aes128gcm" content-coding
                                    header. The same "salt" parameter value MUST NOT be reused for two different payload
                                    bodies that have the same input-keying material; generating a random salt for every
                                    application of the content coding ensures that content-encryption key reuse is
                                    highly unlikely.</dd>
                                <dt>rs:</dt>
                                <dd>The "rs" or record size parameter contains an unsigned 32-bit integer in network
                                    byte order that describes the record size in octets. Note that it is, therefore,
                                    impossible to exceed the 2^36-31 limit on plaintext input to AEAD_AES_128_GCM.
                                    Values smaller than 18 are invalid.</dd>
                                <dt>idlen:</dt>
                                <dd>The "idlen" parameter is an unsigned 8-bit integer that defines the length of the
                                    "keyid" parameter.</dd>
                                <dt>keyid:</dt>
                                <dd>The "keyid" parameter can be used to identify the keying material that is used. This
                                    field is the length determined by the "idlen" parameter. Recipients that receive a
                                    message are expected to know how to retrieve keys; the "keyid" parameter might be
                                    input to that process. A "keyid" parameter SHOULD be a UTF-8-encoded <a
                                        href="#RFC3629"><cite
                                            title="UTF-8, a transformation format of ISO 10646">[RFC3629]</cite></a>
                                    string, particularly where the identifier might need to be rendered in a textual
                                    form.</dd>
                            </dl>
                        </div>
                    </section>
                    <section id="derivation">
                        <h3 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a>&nbsp;<a
                                href="#derivation">Content-Encryption Key Derivation</a></h3>
                        <div id="rfc.section.2.2.p.1">
                            <p>In order to allow the reuse of keying material for multiple different HTTP messages, a
                                content-encryption key is derived for each message. The content-encryption key is
                                derived from the "salt" parameter using the HMAC-based key derivation function (HKDF)
                                described in <a href="#RFC5869"><cite
                                        title="HMAC-based Extract-and-Expand Key Derivation Function (HKDF)">[RFC5869]</cite></a>
                                using the SHA-256 hash algorithm <a href="#FIPS180-4"><cite
                                        title="Secure Hash Standard (SHS)">[FIPS180-4]</cite></a>.</p>
                        </div>
                        <div id="rfc.section.2.2.p.2" class="avoidbreakafter">
                            <p>The value of the "salt" parameter is the salt input to the HKDF. The keying material
                                identified by the "keyid" parameter is the input-keying material (IKM) to HKDF.
                                Input-keying material is expected to be provided to recipients separately. The extract
                                phase of HKDF, therefore, produces a pseudorandom key (PRK) as follows:</p>
                        </div>
                        <div id="rfc.figure.3">
                            <div>
                                <pre class="inline">
   PRK = HMAC-SHA-256 (salt, IKM)
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.2.2.p.3" class="avoidbreakafter">
                            <p>The info parameter to HKDF is set to the ASCII-encoded string "Content-Encoding:
                                aes128gcm" and a single zero octet:</p>
                        </div>
                        <div id="rfc.figure.4">
                            <div>
                                <pre class="inline">
   cek_info = "Content-Encoding: aes128gcm" || 0x00
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.2.2.p.4">
                            <dl>
                                <dt>Note(1):</dt>
                                <dd>Concatenation of octet sequences is represented by the <span class="tt">||</span>
                                    operator.</dd>
                                <dt>Note(2):</dt>
                                <dd>The strings used here and in <a href="#nonce" title="Nonce Derivation">Section
                                        2.3</a> do not include a terminating 0x00 octet, as is used in some programming
                                    languages.</dd>
                            </dl>
                        </div>
                        <div id="rfc.section.2.2.p.5" class="avoidbreakafter">
                            <p>AEAD_AES_128_GCM requires a 16-octet (128-bit) content-encryption key (CEK), so the
                                length (L) parameter to HKDF is 16. The second step of HKDF can, therefore, be
                                simplified to the first 16 octets of a single HMAC:</p>
                        </div>
                        <div id="rfc.figure.5">
                            <div>
                                <pre class="inline">
   CEK = HMAC-SHA-256(PRK, cek_info || 0x01)
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="nonce">
                        <h3 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a>&nbsp;<a href="#nonce">Nonce
                                Derivation</a></h3>
                        <div id="rfc.section.2.3.p.1">
                            <p>The nonce input to AEAD_AES_128_GCM is constructed for each record. The nonce for each
                                record is a 12-octet (96-bit) value that is derived from the record sequence number,
                                input-keying material, and "salt" parameter.</p>
                        </div>
                        <div id="rfc.section.2.3.p.2">
                            <p>The input-keying material and "salt" parameter are input to HKDF with different info and
                                length (L) parameters.</p>
                        </div>
                        <div id="rfc.section.2.3.p.3" class="avoidbreakafter">
                            <p>The length (L) parameter is 12 octets. The info parameter for the nonce is the
                                ASCII-encoded string "Content-Encoding: nonce", terminated by a single zero octet:</p>
                        </div>
                        <div id="rfc.figure.6">
                            <div>
                                <pre class="inline">
   nonce_info = "Content-Encoding: nonce" || 0x00
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.2.3.p.4">
                            <p>The result is combined with the record sequence number -- using exclusive or -- to
                                produce the nonce. The record sequence number (SEQ) is a 96-bit unsigned integer in
                                network byte order that starts at zero.</p>
                        </div>
                        <div id="rfc.section.2.3.p.5" class="avoidbreakafter">
                            <p>Thus, the final nonce for each record is a 12-octet value:</p>
                        </div>
                        <div id="rfc.figure.7">
                            <div>
                                <pre class="inline">
   NONCE = HMAC-SHA-256(PRK, nonce_info || 0x01) XOR SEQ
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.2.3.p.6">
                            <p>This nonce construction prevents removal or reordering of records.</p>
                        </div>
                    </section>
                </section>
                <section id="examples">
                    <h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#examples">Examples</a></h2>
                    <div id="rfc.section.3.p.1">
                        <p>This section shows a few examples of the encrypted-content coding.</p>
                    </div>
                    <div id="rfc.section.3.p.2">
                        <p>Note: All binary values in the examples in this section use base64 encoding with URL and
                            filename safe alphabet <a href="#RFC4648"><cite
                                    title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</cite></a>. This
                            includes the bodies of requests. Whitespace and line wrapping is added to fit formatting
                            constraints.</p>
                    </div>
                    <section id="explicit">
                        <h3 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a>&nbsp;<a href="#explicit">Encryption
                                of a Response</a></h3>
                        <div id="rfc.section.3.1.p.1">
                            <p>Here, a successful HTTP GET response has been encrypted. This uses a record size of 4096
                                octets and no padding (just the single-octet padding delimiter), so only a partial
                                record is present. The input-keying material is identified by an empty string (that is,
                                the "keyid" field in the header is zero octets in length).</p>
                        </div>
                        <div id="rfc.section.3.1.p.2">
                            <p>The encrypted data in this example is the UTF-8-encoded string "I am the walrus". The
                                input-keying material is the value "yqdlZ-tYemfogSmv7Ws5PQ" (in base64url). The 54-octet
                                content body contains a single record and is shown here using 71 base64url characters
                                for presentation reasons.</p>
                        </div>
                        <div id="rfc.figure.8">
                            <div>
                                <pre class="text">
HTTP/1.1 200 OK
Content-Type: application/octet-stream
Content-Length: 54
Content-Encoding: aes128gcm

I1BsxtFttlv3u_Oo94xnmwAAEAAA-NAVub2qFgBEuQKRapoZu-IxkIva3MEB1PD-
ly8Thjg
</pre>
                            </div>
                        </div>
                        <div id="rfc.section.3.1.p.3">
                            <p>Note that the media type has been changed to "application/octet-stream" to avoid exposing
                                information about the content. Alternatively (and equivalently), the Content-Type header
                                field can be omitted.</p>
                        </div>
                        <div id="rfc.section.3.1.p.4" class="avoidbreakafter">
                            <p>Intermediate values for this example (all shown using base64url):</p>
                        </div>
                        <div id="rfc.figure.9">
                            <div>
                                <pre class="inline">
salt (from header) = I1BsxtFttlv3u_Oo94xnmw
PRK = zyeH5phsIsgUyd4oiSEIy35x-gIi4aM7y0hCF8mwn9g
CEK = _wniytB-ofscZDh4tbSjHw
NONCE = Bcs8gkIRKLI8GeI8
unencrypted data = SSBhbSB0aGUgd2FscnVzAg
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="encryption-with-multiple-records">
                        <h3 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a>&nbsp;<a
                                href="#encryption-with-multiple-records">Encryption with Multiple Records</a></h3>
                        <div id="rfc.section.3.2.p.1">
                            <p>This example shows the same message with input-keying material of
                                "BO3ZVPxUlnLORbVGMpbT1Q". In this example, the plaintext is split into records of 25
                                octets each (that is, the "rs" field in the header is 25). The first record includes one
                                0x00 padding octet. This means that there are 7 octets of message in the first record
                                and 8 in the second. A key identifier of the UTF-8-encoded string "a1" is also included
                                in the header.</p>
                        </div>
                        <div id="rfc.figure.10">
                            <div>
                                <pre class="text">
HTTP/1.1 200 OK
Content-Length: 73
Content-Encoding: aes128gcm

uNCkWiNYzKTnBN9ji3-qWAAAABkCYTHOG8chz_gnvgOqdGYovxyjuqRyJFjEDyoF
1Fvkj6hQPdPHI51OEUKEpgz3SsLWIqS_uA
</pre>
                            </div>
                        </div>
                    </section>
                </section>
                <section id="security-considerations">
                    <h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a
                            href="#security-considerations">Security Considerations</a></h2>
                    <div id="rfc.section.4.p.1">
                        <p>This mechanism assumes the presence of a key management framework that is used to manage the
                            distribution of keys between valid senders and receivers. Defining key management is part of
                            composing this mechanism into a larger application, protocol, or framework.</p>
                    </div>
                    <div id="rfc.section.4.p.2">
                        <p>Implementation of cryptography -- and key management in particular -- can be difficult. For
                            instance, implementations need to account for the potential for exposing keying material on
                            side channels, such as might be exposed by the time it takes to perform a given operation.
                            The requirements for a good implementation of cryptographic algorithms can change over time.
                        </p>
                    </div>
                    <section id="automatic-decryption">
                        <h3 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a>&nbsp;<a
                                href="#automatic-decryption">Automatic Decryption</a></h3>
                        <div id="rfc.section.4.1.p.1">
                            <p>As a content coding, a "aes128gcm" content coding might be automatically removed by a
                                receiver in a way that is not obvious to the ultimate consumer of a message. Recipients
                                that depend on content-origin authentication using this mechanism MUST reject messages
                                that don't include the "aes128gcm" content coding.</p>
                        </div>
                    </section>
                    <section id="message-truncation">
                        <h3 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a>&nbsp;<a
                                href="#message-truncation">Message Truncation</a></h3>
                        <div id="rfc.section.4.2.p.1">
                            <p>This content encoding is designed to permit the incremental processing of large messages.
                                It also permits random access to plaintext in a limited fashion. The content encoding
                                permits a receiver to detect when a message is truncated.</p>
                        </div>
                        <div id="rfc.section.4.2.p.2">
                            <p>A partially delivered message MUST NOT be processed as though the entire message was
                                successfully delivered. For instance, a partially delivered message cannot be cached as
                                though it were complete.</p>
                        </div>
                        <div id="rfc.section.4.2.p.3">
                            <p>An attacker might exploit willingness to process partial messages to cause a receiver to
                                remain in a specific intermediate state. Implementations performing processing on
                                partial messages need to ensure that any intermediate processing states don't advantage
                                an attacker.</p>
                        </div>
                    </section>
                    <section id="key-and-nonce-reuse">
                        <h3 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a>&nbsp;<a
                                href="#key-and-nonce-reuse">Key and Nonce Reuse</a></h3>
                        <div id="rfc.section.4.3.p.1">
                            <p>Encrypting different plaintext with the same content-encryption key and nonce in AES-GCM
                                is not safe <a href="#RFC5116"><cite
                                        title="An Interface and Algorithms for Authenticated Encryption">[RFC5116]</cite></a>.
                                The scheme defined here uses a fixed progression of nonce values. Thus, a new
                                content-encryption key is needed for every application of the content coding. Since
                                input-keying material can be reused, a unique "salt" parameter is needed to ensure that
                                a content-encryption key is not reused.</p>
                        </div>
                        <div id="rfc.section.4.3.p.2">
                            <p>If a content-encryption key is reused -- that is, if input-keying material and "salt"
                                parameter are reused -- this could expose the plaintext and the authentication key,
                                nullifying the protection offered by encryption. Thus, if the same input-keying material
                                is reused, then the "salt" parameter MUST be unique each time. This ensures that the
                                content-encryption key is not reused. An implementation SHOULD generate a random "salt"
                                parameter for every message.</p>
                        </div>
                    </section>
                    <section id="limits">
                        <h3 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a>&nbsp;<a href="#limits">Data
                                Encryption Limits</a></h3>
                        <div id="rfc.section.4.4.p.1">
                            <p>There are limits to the data that AEAD_AES_128_GCM can encipher. The maximum value for
                                the record size is limited by the size of the "rs" field in the header (see <a
                                    href="#header" title="Encryption Content-Coding Header">Section 2.1</a>), which
                                ensures that the 2^36-31 limit for a single application of AEAD_AES_128_GCM is not
                                reached <a href="#RFC5116"><cite
                                        title="An Interface and Algorithms for Authenticated Encryption">[RFC5116]</cite></a>.
                                In order to preserve a 2^-40 probability of indistinguishability under chosen plaintext
                                attack (IND-CPA), the total amount of plaintext that can be enciphered with the key
                                derived from the same input-keying material and salt MUST be less than 2^44.5 blocks of
                                16 octets <a href="#AEBounds"><cite
                                        title="Limits on Authenticated Encryption Use in TLS">[AEBounds]</cite></a>.</p>
                        </div>
                        <div id="rfc.section.4.4.p.2">
                            <p>If the record size is a multiple of 16 octets, this means that 398 terabytes can be
                                encrypted safely, including padding and overhead. However, if the record size is not a
                                multiple of 16 octets, the total amount of data that can be safely encrypted is reduced
                                because partial AES blocks are encrypted. The worst case is a record size of 18 octets,
                                for which at most 74 terabytes of plaintext can be encrypted, of which at least half is
                                padding.</p>
                        </div>
                    </section>
                    <section id="content-integrity">
                        <h3 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a>&nbsp;<a
                                href="#content-integrity">Content Integrity</a></h3>
                        <div id="rfc.section.4.5.p.1">
                            <p>This mechanism only provides content-origin authentication. The authentication tag only
                                ensures that an entity with access to the content-encryption key produced the encrypted
                                data.</p>
                        </div>
                        <div id="rfc.section.4.5.p.2">
                            <p>Any entity with the content-encryption key can, therefore, produce content that will be
                                accepted as valid. This includes all recipients of the same HTTP message.</p>
                        </div>
                        <div id="rfc.section.4.5.p.3">
                            <p>Furthermore, any entity that is able to modify both the Content-Encoding header field and
                                the HTTP message body can replace the contents. Without the content-encryption key or
                                the input-keying material, modifications to, or replacement of, parts of a payload body
                                are not possible.</p>
                        </div>
                    </section>
                    <section id="leaking-information-in-header-fields">
                        <h3 id="rfc.section.4.6"><a href="#rfc.section.4.6">4.6.</a>&nbsp;<a
                                href="#leaking-information-in-header-fields">Leaking Information in Header Fields</a>
                        </h3>
                        <div id="rfc.section.4.6.p.1">
                            <p>Because only the payload body is encrypted, information exposed in header fields is
                                visible to anyone who can read the HTTP message. This could expose side-channel
                                information.</p>
                        </div>
                        <div id="rfc.section.4.6.p.2">
                            <p>For example, the Content-Type header field can leak information about the payload body.
                            </p>
                        </div>
                        <div id="rfc.section.4.6.p.3" class="avoidbreakafter">
                            <p>There are a number of strategies available to mitigate this threat, depending upon the
                                application's threat model and the users' tolerance for leaked information:</p>
                        </div>
                        <div id="rfc.section.4.6.p.4">
                            <ol>
                                <li>Determine that it is not an issue. For example, if it is expected that all content
                                    stored will be "application/json", or another very common media type, exposing the
                                    Content-Type header field could be an acceptable risk.</li>
                                <li>If it is considered sensitive information and it is possible to determine it through
                                    other means (e.g., out of band, using hints in other representations, etc.), omit
                                    the relevant headers, and/or normalize them. In the case of Content-Type, this could
                                    be accomplished by always sending Content-Type: application/octet-stream (the most
                                    generic media type), or no Content-Type at all.</li>
                                <li>If it is considered sensitive information and it is not possible to convey it
                                    elsewhere, encapsulate the HTTP message using the application/http media type (see
                                    <a href="https://www.rfc-editor.org/rfc/rfc7230.html#section-8.3.2">Section
                                        8.3.2</a> of <a href="#RFC7230"><cite
                                            title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>),
                                    encrypting that as the payload of the "outer" message.
                                </li>
                            </ol>
                        </div>
                    </section>
                    <section id="poisoning-storage">
                        <h3 id="rfc.section.4.7"><a href="#rfc.section.4.7">4.7.</a>&nbsp;<a
                                href="#poisoning-storage">Poisoning Storage</a></h3>
                        <div id="rfc.section.4.7.p.1">
                            <p>This mechanism only offers data-origin authentication; it does not perform authentication
                                or authorization of the message creator, which could still need to be performed (e.g.,
                                by HTTP authentication <a href="#RFC7235"><cite
                                        title="Hypertext Transfer Protocol (HTTP/1.1): Authentication">[RFC7235]</cite></a>).
                            </p>
                        </div>
                        <div id="rfc.section.4.7.p.2">
                            <p>This is especially relevant when an HTTP PUT request is accepted by a server without
                                decrypting the payload; if the request is unauthenticated, it becomes possible for a
                                third party to deny service and/or poison the store.</p>
                        </div>
                    </section>
                    <section id="sizing-and-timing-attacks">
                        <h3 id="rfc.section.4.8"><a href="#rfc.section.4.8">4.8.</a>&nbsp;<a
                                href="#sizing-and-timing-attacks">Sizing and Timing Attacks</a></h3>
                        <div id="rfc.section.4.8.p.1">
                            <p>Applications using this mechanism need to be aware that the size of encrypted messages,
                                as well as their timing, HTTP methods, URIs and so on, may leak sensitive information.
                                See, for example, <a href="#NETFLIX"><cite
                                        title="Identifying HTTPS-Protected Netflix Videos in Real-Time">[NETFLIX]</cite></a>
                                or <a href="#CLINIC"><cite
                                        title="I Know Why You Went to the Clinic: Risks and Realization of HTTPS Traffic Analysis">[CLINIC]</cite></a>.
                            </p>
                        </div>
                        <div id="rfc.section.4.8.p.2">
                            <p>This risk can be mitigated through the use of the padding that this mechanism provides.
                                Alternatively, splitting up content into segments and storing them separately might
                                reduce exposure. HTTP/2 <a href="#RFC7540"><cite
                                        title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>
                                combined with TLS <a href="#RFC5246"><cite
                                        title="The Transport Layer Security (TLS) Protocol Version 1.2">[RFC5246]</cite></a>
                                might be used to hide the size of individual messages.</p>
                        </div>
                        <div id="rfc.section.4.8.p.3">
                            <p>Developing a padding strategy is difficult. A good padding strategy can depend on
                                context. Common strategies include padding to a small set of fixed lengths, padding to
                                multiples of a value, or padding to powers of 2. Even a good strategy can still cause
                                size information to leak if processing activity of a recipient can be observed. This is
                                especially true if the trailing records of a message contain only padding. Distributing
                                non-padding data across records is recommended to avoid leaking size information.</p>
                        </div>
                    </section>
                </section>
                <section id="iana">
                    <h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#iana">IANA Considerations</a>
                    </h2>
                    <section id="the-aes128gcm-http-content-coding">
                        <h3 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a>&nbsp;<a
                                href="#the-aes128gcm-http-content-coding">The "aes128gcm" HTTP Content Coding</a></h3>
                        <div id="rfc.section.5.1.p.1">
                            <p>This memo registers the "aes128gcm" HTTP content coding in the "HTTP Content Coding
                                Registry", as detailed in <a href="#aes128gcm"
                                    title="The &#34;aes128gcm&#34; HTTP Content Coding">Section 2</a>.</p>
                        </div>
                        <div id="rfc.section.5.1.p.2">
                            <ul>
                                <li>Name: aes128gcm</li>
                                <li>Description: AES-GCM encryption with a 128-bit content-encryption key</li>
                                <li>Reference: this specification</li>
                            </ul>
                        </div>
                    </section>
                </section>
                <section id="rfc.references">
                    <h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a> References</h2>
                    <section>
                        <div id="rfc.references.1">
                            <h3 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> Normative References</h3>
                            <dl class="dl-horizontal">
                                <dt id="FIPS180-4">[<a href="#FIPS180-4" class="smpl">FIPS180-4</a>]</dt>
                                <dd>National Institute of Standards and Technology, “<a
                                        href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">Secure Hash
                                        Standard (SHS)</a>”, FIPS PUB 180-4, <a
                                        href="https://dx.doi.org/10.6028/NIST.FIPS180-4">DOI 10.6028/NIST.FIPS180-4</a>,
                                    August 2015, &lt;<a
                                        href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>&gt;.
                                </dd>
                                <dt id="RFC2119">[<a href="#RFC2119" class="smpl">RFC2119</a>]</dt>
                                <dd>Bradner, S., “<a href="https://www.rfc-editor.org/rfc/rfc2119.html">Key words for
                                        use in RFCs to Indicate Requirement Levels</a>”, <a
                                        href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>, RFC 2119, <a
                                        href="https://dx.doi.org/10.17487/RFC2119">DOI 10.17487/RFC2119</a>, March 1997,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.
                                </dd>
                                <dt id="RFC3629">[<a href="#RFC3629" class="smpl">RFC3629</a>]</dt>
                                <dd>Yergeau, F., “<a href="https://www.rfc-editor.org/rfc/rfc3629.html">UTF-8, a
                                        transformation format of ISO 10646</a>”, <a
                                        href="https://www.rfc-editor.org/info/std63">STD 63</a>, RFC 3629, <a
                                        href="https://dx.doi.org/10.17487/RFC3629">DOI 10.17487/RFC3629</a>, November
                                    2003, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc3629">https://www.rfc-editor.org/info/rfc3629</a>&gt;.
                                </dd>
                                <dt id="RFC5116">[<a href="#RFC5116" class="smpl">RFC5116</a>]</dt>
                                <dd>McGrew, D., “<a href="https://www.rfc-editor.org/rfc/rfc5116.html">An Interface and
                                        Algorithms for Authenticated Encryption</a>”, RFC 5116, <a
                                        href="https://dx.doi.org/10.17487/RFC5116">DOI 10.17487/RFC5116</a>, January
                                    2008, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;.
                                </dd>
                                <dt id="RFC5869">[<a href="#RFC5869" class="smpl">RFC5869</a>]</dt>
                                <dd>Krawczyk, H. and P. Eronen, “<a
                                        href="https://www.rfc-editor.org/rfc/rfc5869.html">HMAC-based Extract-and-Expand
                                        Key Derivation Function (HKDF)</a>”, RFC 5869, <a
                                        href="https://dx.doi.org/10.17487/RFC5869">DOI 10.17487/RFC5869</a>, May 2010,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;.
                                </dd>
                                <dt id="RFC7230">[<a href="#RFC7230" class="smpl">RFC7230</a>]</dt>
                                <dd>Fielding, R., Ed. and J. Reschke, Ed., “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7230.html">Hypertext Transfer Protocol
                                        (HTTP/1.1): Message Syntax and Routing</a>”, RFC 7230, <a
                                        href="https://dx.doi.org/10.17487/RFC7230">DOI 10.17487/RFC7230</a>, June 2014,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.
                                </dd>
                                <dt id="RFC7231">[<a href="#RFC7231" class="smpl">RFC7231</a>]</dt>
                                <dd>Fielding, R., Ed. and J. Reschke, Ed., “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7231.html">Hypertext Transfer Protocol
                                        (HTTP/1.1): Semantics and Content</a>”, RFC 7231, <a
                                        href="https://dx.doi.org/10.17487/RFC7231">DOI 10.17487/RFC7231</a>, June 2014,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;.
                                </dd>
                                <dt id="RFC8174">[<a href="#RFC8174" class="smpl">RFC8174</a>]</dt>
                                <dd>Leiba, B., “<a href="https://www.rfc-editor.org/rfc/rfc8174.html">Ambiguity of
                                        Uppercase vs Lowercase in RFC 2119 Key Words</a>”, <a
                                        href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>, RFC 8174, <a
                                        href="https://dx.doi.org/10.17487/RFC8174">DOI 10.17487/RFC8174</a>, May 2017,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.
                                </dd>
                            </dl>
                        </div>
                    </section>
                    <section>
                        <div id="rfc.references.2">
                            <h3 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> Informative References</h3>
                            <dl class="dl-horizontal">
                                <dt id="AEBounds">[<a href="#AEBounds" class="smpl">AEBounds</a>]</dt>
                                <dd>Luykx, A. and K. Paterson, “<a
                                        href="http://www.isg.rhul.ac.uk/~kp/TLS-AEbounds.pdf">Limits on Authenticated
                                        Encryption Use in TLS</a>”, March 2016, &lt;<a
                                        href="http://www.isg.rhul.ac.uk/~kp/TLS-AEbounds.pdf">http://www.isg.rhul.ac.uk/~kp/TLS-AEbounds.pdf</a>&gt;.
                                </dd>
                                <dt id="CLINIC">[<a href="#CLINIC" class="smpl">CLINIC</a>]</dt>
                                <dd>Miller, B., Huang, L., Joseph, A., and J. Tygar, “<a
                                        href="https://arxiv.org/abs/1403.0297">I Know Why You Went to the Clinic: Risks
                                        and Realization of HTTPS Traffic Analysis</a>”, <a
                                        href="https://dx.doi.org/10.1007/978-3-319-08506-7_8">DOI
                                        10.1007/978-3-319-08506-7_8</a>, March 2014, &lt;<a
                                        href="https://arxiv.org/abs/1403.0297">https://arxiv.org/abs/1403.0297</a>&gt;.
                                </dd>
                                <dt id="NETFLIX">[<a href="#NETFLIX" class="smpl">NETFLIX</a>]</dt>
                                <dd>Reed, A. and M. Kranch, “Identifying HTTPS-Protected Netflix Videos in Real-Time”,
                                    Proceedings of the Seventh ACM on Conference on Data and Application Security and
                                    Privacy CODASPY '17, <a href="https://dx.doi.org/10.1145/3029806.3029821">DOI
                                        10.1145/3029806.3029821</a>, 2017.</dd>
                                <dt id="RFC4648">[<a href="#RFC4648" class="smpl">RFC4648</a>]</dt>
                                <dd>Josefsson, S., “<a href="https://www.rfc-editor.org/rfc/rfc4648.html">The Base16,
                                        Base32, and Base64 Data Encodings</a>”, RFC 4648, <a
                                        href="https://dx.doi.org/10.17487/RFC4648">DOI 10.17487/RFC4648</a>, October
                                    2006, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;.
                                </dd>
                                <dt id="RFC4880">[<a href="#RFC4880" class="smpl">RFC4880</a>]</dt>
                                <dd>Callas, J., Donnerhacke, L., Finney, H., Shaw, D., and R. Thayer, “<a
                                        href="https://www.rfc-editor.org/rfc/rfc4880.html">OpenPGP Message Format</a>”,
                                    RFC 4880, <a href="https://dx.doi.org/10.17487/RFC4880">DOI 10.17487/RFC4880</a>,
                                    November 2007, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc4880">https://www.rfc-editor.org/info/rfc4880</a>&gt;.
                                </dd>
                                <dt id="RFC5246">[<a href="#RFC5246" class="smpl">RFC5246</a>]</dt>
                                <dd>Dierks, T. and E. Rescorla, “<a
                                        href="https://www.rfc-editor.org/rfc/rfc5246.html">The Transport Layer Security
                                        (TLS) Protocol Version 1.2</a>”, RFC 5246, <a
                                        href="https://dx.doi.org/10.17487/RFC5246">DOI 10.17487/RFC5246</a>, August
                                    2008, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc5246">https://www.rfc-editor.org/info/rfc5246</a>&gt;.
                                </dd>
                                <dt id="RFC5652">[<a href="#RFC5652" class="smpl">RFC5652</a>]</dt>
                                <dd>Housley, R., “<a href="https://www.rfc-editor.org/rfc/rfc5652.html">Cryptographic
                                        Message Syntax (CMS)</a>”, <a href="https://www.rfc-editor.org/info/std70">STD
                                        70</a>, RFC 5652, <a href="https://dx.doi.org/10.17487/RFC5652">DOI
                                        10.17487/RFC5652</a>, September 2009, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc5652">https://www.rfc-editor.org/info/rfc5652</a>&gt;.
                                </dd>
                                <dt id="RFC7233">[<a href="#RFC7233" class="smpl">RFC7233</a>]</dt>
                                <dd>Fielding, R., Ed., Lafon, Y., Ed., and J. Reschke, Ed., “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7233.html">Hypertext Transfer Protocol
                                        (HTTP/1.1): Range Requests</a>”, RFC 7233, <a
                                        href="https://dx.doi.org/10.17487/RFC7233">DOI 10.17487/RFC7233</a>, June 2014,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7233">https://www.rfc-editor.org/info/rfc7233</a>&gt;.
                                </dd>
                                <dt id="RFC7235">[<a href="#RFC7235" class="smpl">RFC7235</a>]</dt>
                                <dd>Fielding, R., Ed. and J. Reschke, Ed., “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7235.html">Hypertext Transfer Protocol
                                        (HTTP/1.1): Authentication</a>”, RFC 7235, <a
                                        href="https://dx.doi.org/10.17487/RFC7235">DOI 10.17487/RFC7235</a>, June 2014,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7235">https://www.rfc-editor.org/info/rfc7235</a>&gt;.
                                </dd>
                                <dt id="RFC7516">[<a href="#RFC7516" class="smpl">RFC7516</a>]</dt>
                                <dd>Jones, M. and J. Hildebrand, “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7516.html">JSON Web Encryption
                                        (JWE)</a>”, RFC 7516, <a href="https://dx.doi.org/10.17487/RFC7516">DOI
                                        10.17487/RFC7516</a>, May 2015, &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;.
                                </dd>
                                <dt id="RFC7540">[<a href="#RFC7540" class="smpl">RFC7540</a>]</dt>
                                <dd>Belshe, M., Peon, R., and M. Thomson, Ed., “<a
                                        href="https://www.rfc-editor.org/rfc/rfc7540.html">Hypertext Transfer Protocol
                                        Version 2 (HTTP/2)</a>”, RFC 7540, <a
                                        href="https://dx.doi.org/10.17487/RFC7540">DOI 10.17487/RFC7540</a>, May 2015,
                                    &lt;<a
                                        href="https://www.rfc-editor.org/info/rfc7540">https://www.rfc-editor.org/info/rfc7540</a>&gt;.
                                </dd>
                                <dt id="XMLENC">[<a href="#XMLENC" class="smpl">XMLENC</a>]</dt>
                                <dd>Eastlake, D., Reagle, J., Hirsch, F., and T. Roessler, “<a
                                        href="http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411">XML Encryption Syntax
                                        and Processing Version 1.1</a>”, World Wide Web Consortium Recommendation
                                    REC-xmlenc-core1-20130411, April 2013, &lt;<a
                                        href="http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411">http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411</a>&gt;.
                                </dd>
                            </dl>
                        </div>
                    </section>
                </section>
                <section id="jwe">
                    <h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">Appendix A.</a>&nbsp;<a href="#jwe">JWE
                            Mapping</a></h2>
                    <div id="rfc.section.A.p.1" class="avoidbreakafter">
                        <p>The "aes128gcm" content coding can be considered as a sequence of JSON Web Encryption (JWE)
                            <a href="#RFC7516"><cite title="JSON Web Encryption (JWE)">[RFC7516]</cite></a> objects,
                            each corresponding to a single fixed-size record that includes trailing padding. The
                            following transformations are applied to a JWE object that might be expressed using the JWE
                            Compact Serialization:
                        </p>
                    </div>
                    <div id="rfc.section.A.p.2">
                        <ul>
                            <li>The JWE Protected Header is fixed to the value { "alg": "dir", "enc": "A128GCM" },
                                describing direct encryption using AES-GCM with a 128-bit content-encryption key. This
                                header is not transmitted, it is instead implied by the value of the Content-Encoding
                                header field.</li>
                            <li>The JWE Encrypted Key is empty, as stipulated by the direct encryption algorithm.</li>
                            <li>The JWE Initialization Vector ("iv") for each record is set to the exclusive-or of the
                                96-bit record sequence number, starting at zero, and a value derived from the
                                input-keying material (see <a href="#nonce" title="Nonce Derivation">Section 2.3</a>).
                                This value is also not transmitted.</li>
                            <li>The final value is the concatenated header, JWE Ciphertext, and JWE Authentication Tag,
                                all expressed without base64url encoding. The "." separator is omitted, since the length
                                of these fields is known.</li>
                        </ul>
                    </div>
                    <div id="rfc.section.A.p.3" class="avoidbreakafter">
                        <p>Thus, the example in <a href="#explicit" title="Encryption of a Response">Section 3.1</a> can
                            be rendered using the JWE Compact Serialization as:</p>
                    </div>
                    <div id="rfc.figure.11">
                        <div>
                            <pre class="text">
eyAiYWxnIjogImRpciIsICJlbmMiOiAiQTEyOEdDTSIgfQ..Bcs8gkIRKLI8GeI8.
-NAVub2qFgBEuQKRapoZuw.4jGQi9rcwQHU8P6XLxOGOA
</pre>
                        </div>
                    </div>
                    <div id="rfc.section.A.p.4">
                        <p>Where the first line represents the fixed JWE Protected Header, an empty JWE Encrypted Key,
                            and the algorithmically determined JWE Initialization Vector. The second line contains the
                            encoded body, split into JWE Ciphertext and JWE Authentication Tag.</p>
                    </div>
                </section>
                <section id="acknowledgements">
                    <h2 id="rfc.section.unnumbered-1"><a href="#acknowledgements">Acknowledgements</a></h2>
                    <div id="rfc.section.unnumbered-1.p.1">
                        <p>Mark Nottingham was an original author of this document.</p>
                    </div>
                    <div id="rfc.section.unnumbered-1.p.2">
                        <p>The following people provided valuable input: Richard Barnes, David Benjamin, Peter Beverloo,
                            JR Conlin, Mike Jones, Stephen Farrell, Adam Langley, James Manger, John Mattsson, Julian
                            Reschke, Eric Rescorla, Jim Schaad, and Magnus Westerlund.</p>
                    </div>
                </section>
                <section id="rfc.authors" class="avoidbreakinside">
                    <h2><a href="#rfc.authors">Author's Address</a></h2>
                    <address><b>Martin Thomson</b><br>Mozilla<br>EMail: <a
                            href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></address>
                </section>
            </div>
        </div>
    </div>
    <script src="/assets/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/assets/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
</body>

</html>