<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 35.2.2">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>Selection API</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="color-scheme" content="light">
    <meta name="revision" content="04da02f9aa4e5531f1a92e2d8e4c119c6d8eada3">
    <meta name="description" content="This document is a preliminary draft of a specification for the
        Selection API and selection related functionality. It replaces a couple
        of old sections of the HTML
        specification, the selection part of the old 
        DOM Range specification.">
    <link rel="canonical" href="https://www.w3.org/TR/selection-api/">
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "shortName": "selection-api",
  "editors": [
    {
      "name": "Ryosuke Niwa",
      "mailto": "rniwa@apple.com",
      "company": "Apple Inc.",
      "companyURL": "https://www.apple.com/",
      "w3cid": "49910",
      "url": "mailto:rniwa@apple.com"
    }
  ],
  "group": "webediting",
  "testSuiteURI": "https://wpt.fyi/results/selection/",
  "github": "w3c/selection-api",
  "xref": "web-platform",
  "gitRevision": "04da02f9aa4e5531f1a92e2d8e4c119c6d8eada3",
  "publishDate": "2025-01-05",
  "previousMaturity": "WD",
  "previousPublishDate": "2024-12-19",
  "publishISODate": "2025-01-05T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 05 January 2025"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">Selection API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C Working Draft</a> <time
                class="dt-published" datetime="2025-01-05">05 January 2025</time></p>
        <details open="">
            <summary>More details about this document</summary>
            <dl>
                <dt>This version:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2025/WD-selection-api-20250105/">https://www.w3.org/TR/2025/WD-selection-api-20250105/</a>
                </dd>
                <dt>Latest published version:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/selection-api/">https://www.w3.org/TR/selection-api/</a>
                </dd>
                <dt>Latest editor's draft:</dt>
                <dd><a href="https://w3c.github.io/selection-api/">https://w3c.github.io/selection-api/</a></dd>
                <dt>History:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/selection-api/">https://www.w3.org/standards/history/selection-api/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/selection-api/commits/">Commit history</a>
                </dd>
                <dt>Test suite:</dt>
                <dd><a href="https://wpt.fyi/results/selection/">https://wpt.fyi/results/selection/</a></dd>




                <dt>Editor:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="49910">
                    <a class="ed_mailto u-email email p-name" href="mailto:rniwa@apple.com">Ryosuke Niwa</a> (<a
                        class="p-org org h-org" href="https://www.apple.com/">Apple Inc.</a>)
                </dd>


                <dt>Feedback:</dt>
                <dd>
                    <a href="https://github.com/w3c/selection-api/">GitHub w3c/selection-api</a>
                    (<a href="https://github.com/w3c/selection-api/pulls/">pull requests</a>,
                    <a href="https://github.com/w3c/selection-api/issues/new/choose">new issue</a>,
                    <a href="https://github.com/w3c/selection-api/issues/">open issues</a>)
                </dd>


            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2025

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2>Abstract</h2>
        <p>
            This document is a preliminary draft of a specification for the
            Selection API and selection related functionality. It replaces a couple
            of old sections of the <a href="https://www.w3.org/TR/html5/">HTML
                specification</a>, the selection part of the old <a
                href="https://www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/ranges.html">
                DOM Range specification</a>.
        </p>
        <p>
            This document defines APIs for selection, which allows users and
            authors to select a portion of a document or specify a point of
            interest for copy, paste, and other editing operations.
        </p>
    </section>
    <section id="sotd" class="introductory">
        <h2>Status of This Document</h2>
        <p><em>This section describes the status of this
                document at the time of its publication. A list of current <abbr
                    title="World Wide Web Consortium">W3C</abbr>
                publications and the latest revision of this technical report can be found
                in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical
                    reports index</a> at
                https://www.w3.org/TR/.</em></p>
        <p>
            This is work in progress.
        </p>
        <p>
            This document was published by the <a href="https://www.w3.org/groups/wg/webediting">Web Editing Working
                Group</a> as
            a Working Draft using the
            <a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">Recommendation track</a>.
        </p>
        <p>Publication as a Working Draft does not
            imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. </p>
        <p>
            This is a draft document and may be updated, replaced or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other
            than work in progress.

        </p>
        <p>

            This document was produced by a group
            operating under the
            <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                Patent
                Policy</a>.


            <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webediting/ipr">public list of any patent
                disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the <abbr
                    title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.

        </p>
        <p>
            This document is governed by the
            <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">03 November 2023 <abbr
                    title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">Table of Contents</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li>
            <li class="tocline"><a class="tocxref" href="#background"><bdi class="secno">1. </bdi>
                    Background
                </a></li>
            <li class="tocline"><a class="tocxref" href="#definition"><bdi class="secno">2. </bdi>
                    Definition
                </a></li>
            <li class="tocline"><a class="tocxref" href="#selection-interface"><bdi class="secno">3. </bdi>
                    Selection interface
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-other-interfaces"><bdi class="secno">4. </bdi>
                    Extensions to Other Interfaces
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#extensions-to-document-interface"><bdi
                                class="secno">4.1 </bdi>
                            Extensions to <code>Document</code> interface
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#extensions-to-window-interface"><bdi class="secno">4.2
                            </bdi>
                            Extensions to <code>Window</code> interface
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#extensions-to-globaleventhandlers-interface"><bdi
                                class="secno">4.3 </bdi>
                            Extensions to <code>GlobalEventHandlers</code> interface
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#responding-to-dom-mutations"><bdi class="secno">5. </bdi>
                    Responding to DOM Mutations
                </a></li>
            <li class="tocline"><a class="tocxref" href="#user-interactions"><bdi class="secno">6. </bdi>
                    User Interactions
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#selectstart-event"><bdi class="secno">6.1 </bdi>
                            <code><span data-dfn-type="event">selectstart</span></code> event
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#selectionchange-event"><bdi class="secno">6.2 </bdi>
                            <code><span data-dfn-type="event">selectionchange</span></code> event
                        </a>
                        <ol class="toc">
                            <li class="tocline"><a class="tocxref" href="#scheduling-selectionchange-event"><bdi
                                        class="secno">6.2.1 </bdi>
                                    Scheduling <code>selectionchange</code> event
                                </a></li>
                            <li class="tocline"><a class="tocxref" href="#firing-selectionchange-event"><bdi
                                        class="secno">6.2.2 </bdi>
                                    Firing <code>selectionchange</code> event
                                </a></li>
                        </ol>
                    </li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">7. </bdi>Conformance</a></li>
            <li class="tocline"><a class="tocxref" href="#security-and-privacy-considerations"><bdi class="secno">8.
                    </bdi>
                    Security and Privacy considerations
                </a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>
                    Acknowledgements
                </a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>Normative references</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section class="informative" id="background">
        <div class="header-wrapper">
            <h2 id="x1-background"><bdi class="secno">1. </bdi>
                Background
            </h2><a class="self-link" href="#background" aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>
            IE9 and Firefox 6.0a2 allow arbitrary ranges in the selection, which
            follows what this spec originally said. However, this leads to
            unpleasant corner cases that authors, implementers, and spec writers
            all have to deal with, and they don't make any real sense. Chrome 14
            dev and Opera 11.11 aggressively normalize selections, like not letting
            them lie inside empty elements and things like that, but this is also
            viewed as a bad idea, because it takes flexibility away from authors.
        </p>
        <p>
            So I changed the spec to a made-up compromise that allows some
            simplification but doesn't constrain authors much. See <a
                href="https://lists.w3.org/Archives/Public/public-whatwg-archive/2011Jun/0193.html">
                discussion</a>. Basically it would throw exceptions in some places to
            try to stop the selection from containing a range that had a
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> other than
            an Element or Text node, or a boundary
            point that didn't descend from a Document.
        </p>
        <p>
            But this meant getRangeAt() had to start returning a copy, not a
            reference. Also, it would be prone to things failing weirdly in corner
            cases. Perhaps most significantly, all sorts of problems might arise
            when DOM mutations transpire, like if a boundary point's node is
            removed from its parent and the mutation rules would place the new
            boundary point inside a non-Text/Element node. And finally, the
            previously-specified behavior had the advantage of matching two major
            implementations, while the new behavior matched no one. So I changed it
            back.
        </p>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div>
            <div class="">
                <p>
                    See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">bug 15470</a>.
                    IE9, Firefox 12.0a1, Chrome 17 dev, and Opera Next 12.00 alpha all
                    make the range initially null.
                </p>
            </div>
        </div>
    </section>
    <section id="definition">
        <div class="header-wrapper">
            <h2 id="x2-definition"><bdi class="secno">2. </bdi>
                Definition
            </h2><a class="self-link" href="#definition" aria-label="Permalink for Section 2."></a>
        </div>

        <p>
            Every <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> with a <a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">browsing
                context</a> has a unique
            <dfn id="dfn-selection" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">selection</dfn> associated
            with it.
        </p>
        <div class="note" role="note" id="issue-container-generatedID-0">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div>
            <p class="">
                This is a requirement of the HTML spec. IE9 and Opera Next 12.00 alpha
                seem to follow it, while Firefox 12.0a1 and Chrome 17 dev seem not to.
                See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=717339">Mozilla bug</a>,
                <a href="https://bugs.webkit.org/show_bug.cgi?id=76114">WebKit bug</a>.
            </p>
        </div>
        <p>
            This one <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-1">selection</a> must be shared by all the content of the
            <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> (though not by nested <a
                data-link-type="idl" href="https://dom.spec.whatwg.org/#document">documents</a>), including any
            <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#editing-host">editing
                hosts</a> in the <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>.
        </p>
        <p>
            Each <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-2">selection</a> can be associated with a single <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a>.
            When there is no <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
            associated with the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-3">selection</a>, the
            selection is <dfn id="dfn-empty" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">empty</dfn>. The
            selection must be initially
            <a href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-1">empty</a>.
        </p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>Note</span></div>
            <p class="">
                A <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>'s <a
                    href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-4">selection</a> is a singleton object associated
                with that <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>, so it gets
                replaced with a new object when
                <code>Document.open()</code> is called. See <a
                    href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">bug 15470</a>.
                IE9 and Opera Next 12.00 alpha allow the user to reset the range to
                null after the fact by clicking somewhere; Firefox 12.0a1 and Chrome 17
                dev do not. We follow Gecko/WebKit, because it lessens the chance of
                getRangeAt(0) throwing.
            </p>
        </div>
        <p>
            Once a <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-5">selection</a> is associated with a given <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a>, it
            must continue to be associated with that same <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> until this
            specification requires otherwise.
        </p>
        <div class="note" role="note" id="issue-container-generatedID-2">
            <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>Note</span></div>
            <p class="" data-link-for="Selection">
                For instance, if the DOM changes in a way that changes the range's
                boundary points, or a script modifies the boundary points of the range,
                the same range object must continue to be associated with the
                selection. However, if the user changes the selection or a script calls
                <a data-link-type="idl" data-lt="addRange()" href="#dom-selection-addrange" class="internalDFN"
                    id="ref-for-dom-selection-addrange-1"><code>addRange</code></a><code>()</code>, the selection must
                be associated with a new range
                object, as required elsewhere in this specification.
            </p>
        </div>
        <p>
            If the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-6">selection</a>'s <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> is not null and is
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a>, then the caret
            position must be at that
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>'s <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a>. When the
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-7">selection</a>
            is not
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a>, this
            specification does not define the caret
            position; user agents should follow platform conventions in deciding
            whether the caret is at the start of the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-8">selection</a>, the end of
            the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-9">selection</a>, or somewhere else.
        </p>
        <p>
            Each <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-10">selection</a> has a <dfn id="dfn-direction" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">direction</dfn>: <dfn id="dfn-forwards" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">forwards</dfn>,
            <dfn id="dfn-backwards" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">backwards</dfn>, or <dfn
                id="dfn-directionless" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">directionless</dfn>. If
            the user creates
            a <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-11">selection</a> by indicating first one <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> of the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> and then the other (such
            as by clicking on one point and
            dragging to another), and the first indicated <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> is
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-after">after</a> the second,
            then the corresponding
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-12">selection</a> must initially be <a href="#dfn-backwards"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-backwards-1">backwards</a>. If the first
            indicated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> is
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> the
            second, then the corresponding <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-13">selection</a> must initially be
            <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-1">forwards</a>.
            Otherwise, it must be <a href="#dfn-directionless" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-directionless-1">directionless</a>.
        </p>
        <p>
            When the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-14">selection</a>'s <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> is mutated by scripts, e.g.
            via <a data-link-type="method" data-lt="selectNode(node)"
                href="https://dom.spec.whatwg.org/#dom-range-selectnode"><code>selectNode</code></a><code>(<var>node</var>)</code>,
            <a href="#dfn-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-1">direction</a>
            of the
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-15">selection</a> must be preserved.
        </p>
        <p>
            Each <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-16">selection</a>s also have an <dfn id="dfn-anchor" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">anchor</dfn> and a
            <dfn id="dfn-focus" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">focus</dfn>. If the <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-17">selection</a>'s <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> is null, its
            <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-1">anchor</a> and <a
                href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-1">focus</a> are both
            null. If the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-18">selection</a>'s
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is not null and its <a
                href="#dfn-direction" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-direction-2">direction</a> is <a href="#dfn-forwards" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-forwards-2">forwards</a>,
            its <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-2">anchor</a> is
            the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>'s <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a>, and its
            <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-2">focus</a> is the <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a>. Otherwise, its <a
                href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-3">focus</a> is the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> and its <a
                href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-3">anchor</a> is the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a>.
        </p>
        <div class="note" role="note" id="issue-container-generatedID-3">
            <div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>Note</span></div>
            <p class="">
                <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-4">anchor</a> and
                <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-4">focus</a> of <a
                    href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-19">selection</a> need not to be in
                the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                It could be in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree">shadow
                    tree</a> of the same
                <a data-link-type="dfn|abstract-op" href="https://dom.spec.whatwg.org/#document">document</a>.
            </p>
        </div>
        <p>
            Each <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>, <a
                data-link-type="element"
                href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a> element, and <a
                data-link-type="element"
                href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a>
            element
            has a boolean <dfn id="dfn-has-scheduled-selectionchange-event" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">has scheduled selectionchange event</dfn>, which is
            initially false.
        </p>
    </section>
    <section data-dfn-for="Selection" id="selection-interface">
        <div class="header-wrapper">
            <h2 id="x3-selection-interface"><bdi class="secno">3. </bdi>
                Selection interface
            </h2><a class="self-link" href="#selection-interface" aria-label="Permalink for Section 3."></a>
        </div>

        <p>
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-20">Selection</a> interface provides a way to interact with the
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-21">selection</a> associated with each document.
        </p>
        <pre class="idl def" id="webidl-1987235205"><span class="idlHeader"><a class="self-link" href="#webidl-1987235205">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-selection" data-title="Selection">[<span class="extAttr"><a data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>]
interface <dfn data-export="" data-dfn-type="interface" id="dom-selection" data-idl="interface" data-title="Selection" data-dfn-for="" class="idlID" tabindex="0" aria-haspopup="dialog"><code>Selection</code></dfn> {<span data-idl="" class="idlAttribute" id="idl-def-selection-anchornode" data-title="anchorNode" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-anchornode" id="ref-for-dom-selection-anchornode-1"><code>anchorNode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-anchoroffset" data-title="anchorOffset" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-anchoroffset" id="ref-for-dom-selection-anchoroffset-1"><code>anchorOffset</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-focusnode" data-title="focusNode" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-focusnode" id="ref-for-dom-selection-focusnode-1"><code>focusNode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-focusoffset" data-title="focusOffset" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-focusoffset" id="ref-for-dom-selection-focusoffset-1"><code>focusOffset</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-iscollapsed" data-title="isCollapsed" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-iscollapsed" id="ref-for-dom-selection-iscollapsed-1"><code>isCollapsed</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-rangecount" data-title="rangeCount" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-rangecount" id="ref-for-dom-selection-rangecount-1"><code>rangeCount</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-type" data-title="type" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-type" id="ref-for-dom-selection-type-1"><code>type</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-direction" data-title="direction" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-direction" id="ref-for-dom-selection-direction-1"><code>direction</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-selection-getrangeat-index" data-title="getRangeAt" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-getrangeat" id="ref-for-dom-selection-getrangeat-1"><code>getRangeAt</code></a>(<span class="idlType"><a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">index</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-addrange-range" data-title="addRange" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-addrange" id="ref-for-dom-selection-addrange-2"><code>addRange</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <span class="idlParamName">range</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-removerange-range" data-title="removeRange" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-removerange" id="ref-for-dom-selection-removerange-1"><code>removeRange</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <span class="idlParamName">range</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-removeallranges" data-title="removeAllRanges" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-removeallranges" id="ref-for-dom-selection-removeallranges-1"><code>removeAllRanges</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-empty" data-title="empty" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-empty" id="ref-for-dom-selection-empty-1"><code>empty</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-getcomposedranges-options" data-title="getComposedRanges" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence">sequence</a>&lt;<a data-link-type="interface" href="https://dom.spec.whatwg.org/#staticrange">StaticRange</a>&gt;</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-getcomposedranges" id="ref-for-dom-selection-getcomposedranges-1"><code>getComposedRanges</code></a>(optional<span class="idlType"> <a data-link-type="idl" href="#dom-getcomposedrangesoptions" class="internalDFN" id="ref-for-dom-getcomposedrangesoptions-1"><code>GetComposedRangesOptions</code></a></span> <span class="idlParamName">options</span> = {});</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapse-node-offset" data-title="collapse" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapse" id="ref-for-dom-selection-collapse-1"><code>collapse</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-setposition-node-offset" data-title="setPosition" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-setposition" id="ref-for-dom-selection-setposition-1"><code>setPosition</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapsetostart" data-title="collapseToStart" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapsetostart" id="ref-for-dom-selection-collapsetostart-1"><code>collapseToStart</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapsetoend" data-title="collapseToEnd" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapsetoend" id="ref-for-dom-selection-collapsetoend-1"><code>collapseToEnd</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-extend-node-offset" data-title="extend" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-extend" id="ref-for-dom-selection-extend-1"><code>extend</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-setbaseandextent-anchornode-anchoroffset-focusnode-focusoffset" data-title="setBaseAndExtent" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-setbaseandextent" id="ref-for-dom-selection-setbaseandextent-1"><code>setBaseAndExtent</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">anchorNode</span>,<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">anchorOffset</span>,<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">focusNode</span>,<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">focusOffset</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-selectallchildren-node" data-title="selectAllChildren" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-selectallchildren" id="ref-for-dom-selection-selectallchildren-1"><code>selectAllChildren</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-modify-alter-direction-granularity" data-title="modify" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-modify" id="ref-for-dom-selection-modify-1"><code>modify</code></a>(optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">alter</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">direction</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">granularity</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-deletefromdocument" data-title="deleteFromDocument" data-dfn-for="Selection">
  [<span class="extAttr"><a data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">CEReactions</a></span>]<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-deletefromdocument" id="ref-for-dom-selection-deletefromdocument-1"><code>deleteFromDocument</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-containsnode-node-allowpartialcontainment" data-title="containsNode" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-containsnode" id="ref-for-dom-selection-containsnode-1"><code>containsNode</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <span class="idlParamName">allowPartialContainment</span> = false);</span><span data-idl="" class="idlMethod" id="idl-def-selection-anonymous-stringifier" data-title="stringifier" data-dfn-for="Selection">
  <a class="internalDFN" data-link-type="method" href="#dom-selection-stringifier" id="ref-for-dom-selection-stringifier-1"><code>stringifier</code></a>;</span>
};</span><span data-idl="" class="idlDictionary" id="idl-def-getcomposedrangesoptions" data-title="GetComposedRangesOptions">

dictionary <dfn data-export="" data-dfn-type="dictionary" id="dom-getcomposedrangesoptions" data-idl="dictionary" data-title="GetComposedRangesOptions" data-dfn-for="" class="idlID" tabindex="0" aria-haspopup="dialog"><code>GetComposedRangesOptions</code></dfn> {<span data-idl="" class="idlMember" id="idl-def-getcomposedrangesoptions-shadowroots" data-title="shadowRoots" data-dfn-for="GetComposedRangesOptions"><span class="idlType">
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence">sequence</a>&lt;<a data-link-type="interface" href="https://dom.spec.whatwg.org/#shadowroot">ShadowRoot</a>&gt;</span> <dfn data-export="" data-dfn-type="dict-member" id="dom-getcomposedrangesoptions-shadowroots" data-idl="field" data-title="shadowRoots" data-dfn-for="GetComposedRangesOptions" data-type="sequence" class="idlName" tabindex="0" aria-haspopup="dialog"><code>shadowRoots</code></dfn> = [];</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-anchornode" data-idl="attribute"
                    data-title="anchorNode" data-dfn-for="Selection" data-type="Node" data-lt="anchorNode"
                    data-local-lt="Selection.anchorNode" tabindex="0"
                    aria-haspopup="dialog"><code>anchorNode</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return the <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-5">anchor</a> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#boundary-point-node">node</a>
                    of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, or
                    <code>null</code> if the <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-6">anchor</a> is null or
                    <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-7">anchor</a>
                    is not in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-anchoroffset" data-idl="attribute"
                    data-title="anchorOffset" data-dfn-for="Selection" data-type="unsigned long" data-lt="anchorOffset"
                    data-local-lt="Selection.anchorOffset" tabindex="0"
                    aria-haspopup="dialog"><code>anchorOffset</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return the <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-8">anchor</a> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp-offset">offset</a> of <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, or <code>0</code> if
                    the <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-9">anchor</a>
                    is null or <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-10">anchor</a> is not in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-focusnode" data-idl="attribute"
                    data-title="focusNode" data-dfn-for="Selection" data-type="Node" data-lt="focusNode"
                    data-local-lt="Selection.focusNode" tabindex="0" aria-haspopup="dialog"><code>focusNode</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return the <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-5">focus</a> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#boundary-point-node">node</a>
                    of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, or
                    <code>null</code> if the <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-6">focus</a> is null or <a href="#dfn-focus" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-focus-7">focus</a>
                    is not in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-focusoffset" data-idl="attribute"
                    data-title="focusOffset" data-dfn-for="Selection" data-type="unsigned long" data-lt="focusOffset"
                    data-local-lt="Selection.focusOffset" tabindex="0"
                    aria-haspopup="dialog"><code>focusOffset</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return the <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-8">focus</a> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp-offset">offset</a> of <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>, or <code>0</code> if
                    the <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-9">focus</a>
                    is null or <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-10">focus</a> is not in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-iscollapsed" data-idl="attribute"
                    data-title="isCollapsed" data-dfn-for="Selection" data-type="boolean" data-lt="isCollapsed"
                    data-local-lt="Selection.isCollapsed" tabindex="0"
                    aria-haspopup="dialog"><code>isCollapsed</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return true if and only if the
                    <span>anchor</span> and <span>focus</span> are the same (including
                    if both are null). Otherwise it must return false.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-rangecount" data-idl="attribute"
                    data-title="rangeCount" data-dfn-for="Selection" data-type="unsigned long" data-lt="rangeCount"
                    data-local-lt="Selection.rangeCount" tabindex="0"
                    aria-haspopup="dialog"><code>rangeCount</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return <code>0</code> if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> is
                    <a href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-2">empty</a> or
                    either <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-11">focus</a> or <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-11">anchor</a> is not in the
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>,
                    and must return <code>1</code> otherwise.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-type" data-idl="attribute"
                    data-title="type" data-dfn-for="Selection" data-type="DOMString" data-lt="type"
                    data-local-lt="Selection.type" tabindex="0" aria-haspopup="dialog"><code>type</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return <code>"None"</code> if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> is <a href="#dfn-empty" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-empty-3">empty</a> or
                    either <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-12">focus</a> or <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-12">anchor</a> is not in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>,
                    <code>"Caret"</code> if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a>'s <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> is
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a>, and
                    <code>"Range"</code> otherwise.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-direction" data-idl="attribute"
                    data-title="direction" data-dfn-for="Selection" data-type="DOMString" data-lt="direction"
                    data-local-lt="Selection.direction" tabindex="0" aria-haspopup="dialog"><code>direction</code></dfn>
            </dt>
            <dd>
                <p>
                    The attribute must return <code>"none"</code> if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> is <a href="#dfn-empty" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-empty-4">empty</a> or
                    this selection is <a href="#dfn-directionless" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-directionless-2">directionless</a>. <code>"forward"</code> if this
                    selection's direction is <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-forwards-3">forwards</a> and <code>"backward"</code> if this
                    selection's direction is <a href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-backwards-2">backwards</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-getrangeat" data-idl="operation"
                    data-title="getRangeAt()" data-dfn-for="Selection" data-type="Range"
                    data-lt="getRangeAt()|getRangeAt(index)"
                    data-local-lt="Selection.getRangeAt|Selection.getRangeAt()|getRangeAt" tabindex="0"
                    aria-haspopup="dialog"><code>getRangeAt()</code></dfn> method
            </dt>
            <dd>
                <p data-tests="getRangeAt.html">
                    The method must throw an <a data-link-type="exception" data-lt="IndexSizeError"
                        href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a> exception
                    if
                    <var>index</var> is not <code>0</code>, or if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> is
                    <a href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-5">empty</a> or
                    either <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-13">focus</a> or <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-13">anchor</a> is not in the
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>.
                    Otherwise, it must return a reference to (not a
                    copy of) <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                </p>
                <div class="note" role="note" id="issue-container-generatedID-4">
                    <div role="heading" class="note-title marker" id="h-note-4" aria-level="3"><span>Note</span></div>
                    <p class="">
                        Thus subsequent calls of this method returns the same <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a>
                        object if nothing has removed <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s range in the meantime. In
                        particular, <code>getSelection().getRangeAt(0) ===
            getSelection().getRangeAt(0)</code> evaluates to <code>true</code>
                        if the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-22">selection</a> is not <a href="#dfn-empty" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-empty-6">empty</a>.
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-addrange" data-idl="operation"
                    data-title="addRange()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="addRange()|addRange(range)"
                    data-local-lt="Selection.addRange|Selection.addRange()|addRange" tabindex="0"
                    aria-haspopup="dialog"><code>addRange()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> of
                        the <var>range</var>'s boundary points
                        are not the <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>
                        associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>,
                        abort these
                        steps.
                    </li>
                    <li>If <code>rangeCount</code> is not <code>0</code>, abort these
                        steps.
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s range to
                        <var>range</var> by a strong reference
                        (not by making a copy).
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-5">
                    <div role="heading" class="note-title marker" id="h-note-5" aria-level="3"><span>Note</span></div>
                    <p class="">
                        Since <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is
                        added by reference, subsequent calls to
                        <code>getRangeAt(0)</code> returns the same object, and any changes
                        that a script makes to <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> after it is added must be
                        reflected in the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-23">selection</a>, until something else removes or
                        replaces <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>. In
                        particular, the
                        <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-24">selection</a> will contain <var>b</var> as opposed to
                        <var>a</var> after running the following code: <code>var r =
            document.createRange(); r.selectNode(a);
            getSelection().addRange(r); r.selectNode(b);</code>
                    </p>
                </div>
                <div class="note" role="note" id="issue-container-generatedID-6">
                    <div role="heading" class="note-title marker" id="h-note-6" aria-level="3"><span>Note</span></div>
                    <div class="">
                        <p>
                            At Step 2, Chrome 58 and Edge 25 do nothing. Firefox 51 gives you
                            a multi-range selection. At least they keep the exisiting
                            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                        </p>
                        <p>
                            At Step 3, Chrome 58 and Firefox 51 store a reference, as
                            described here. Edge 25 stores a copy. Firefox 51 changes its
                            selection if the <a data-link-type="dfn"
                                href="https://dom.spec.whatwg.org/#concept-range">range</a> is modified.
                        </p>
                    </div>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-removerange" data-idl="operation"
                    data-title="removeRange()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="removeRange()|removeRange(range)"
                    data-local-lt="Selection.removeRange|Selection.removeRange()|removeRange" tabindex="0"
                    aria-haspopup="dialog"><code>removeRange()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must make <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-7">empty</a> by
                    disassociating its
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> if <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is
                    <var>range</var>.
                    Otherwise, it must throw a <a data-link-type="exception" data-lt="NotFoundError"
                        href="https://webidl.spec.whatwg.org/#notfounderror"><code>NotFoundError</code></a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-removeallranges" data-idl="operation"
                    data-title="removeAllRanges()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="removeAllRanges()"
                    data-local-lt="Selection.removeAllRanges|Selection.removeAllRanges()|removeAllRanges" tabindex="0"
                    aria-haspopup="dialog"><code>removeAllRanges()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must make <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-8">empty</a> by
                    disassociating its
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> if <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> has an associated <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-empty" data-idl="operation"
                    data-title="empty()" data-dfn-for="Selection" data-type="undefined" data-lt="empty()"
                    data-local-lt="Selection.empty|Selection.empty()|empty" tabindex="0"
                    aria-haspopup="dialog"><code>empty()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must be an alias, and behave identically, to
                    <code>removeAllRanges()</code>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-getcomposedranges" data-idl="operation"
                    data-title="getComposedRanges()" data-dfn-for="Selection" data-type="sequence"
                    data-lt="getComposedRanges()|getComposedRanges(options)"
                    data-local-lt="Selection.getComposedRanges|Selection.getComposedRanges()|getComposedRanges"
                    tabindex="0" aria-haspopup="dialog"><code>getComposedRanges()</code></dfn> method
            </dt>
            <dd>
                <ol>
                    <li>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is <a
                            href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-empty-9">empty</a>, return an empty array.
                    </li>
                    <li>Otherwise, let <var>startNode</var> be <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-node">start node</a> of
                        the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                        associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>,
                        and let
                        <var>startOffset</var> be <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-offset">start offset</a> of the <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                    </li>
                    <li>While <var>startNode</var> is a <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node">node</a>,
                        <var>startNode</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is a <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-root">shadow root</a>, and
                        <var>startNode</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is not a <a
                            data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> of any of
                        <var>options</var>["<a data-link-type="idl" href="#dom-getcomposedrangesoptions-shadowroots"
                            class="internalDFN"
                            id="ref-for-dom-getcomposedrangesoptions-shadowroots-1"><code>shadowRoots</code></a>"],
                        repeat these steps:
                        <ol>
                            <li>Set <var>startOffset</var> to <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-index">index</a> of
                                <var>startNode</var>'s <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-root">root</a>'s <a
                                    data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host">host</a>.
                            </li>
                            <li>Set <var>startNode</var> to <var>startNode</var>'s
                                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a>'s
                                <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host">host</a>'s <a
                                    data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-parent">parent</a>.
                            </li>
                        </ol>
                    </li>
                    <li>Let <var>endNode</var> be <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-node">end node</a> of the <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                        associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>,
                        and let <var>endOffset</var> be
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end-offset">end
                            offset</a> of the <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                    </li>
                    <li>While <var>endNode</var> is a <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node">node</a>, <var>endNode</var>'s
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is a <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root">shadow
                            root</a>, and <var>endNode</var>'s
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is not a
                        <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> of
                        any of
                        <var>options</var>["<a data-link-type="idl" href="#dom-getcomposedrangesoptions-shadowroots"
                            class="internalDFN"
                            id="ref-for-dom-getcomposedrangesoptions-shadowroots-2"><code>shadowRoots</code></a>"],
                        repeat these steps:
                        <ol>
                            <li>Set <var>endOffset</var> to <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-index">index</a> of
                                <var>endNode</var>'s <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-root">root</a>'s <a
                                    data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host">host</a> plus
                                1.
                            </li>
                            <li>Set <var>endNode</var> to <var>endNode</var>'s
                                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a>'s
                                <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host">host</a>'s <a
                                    data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-parent">parent</a>.
                            </li>
                        </ol>
                    </li>
                    <li>Return an array consisting of new <a data-link-type="interface" data-lt="StaticRange"
                            href="https://dom.spec.whatwg.org/#staticrange"><code>StaticRange</code></a> whose
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start-node">start
                            node</a> is <var>startNode</var>, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-offset">start offset</a> is
                        <var>startOffset</var>, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-node">end node</a> is
                        <var>endNode</var>, and <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-offset">end offset</a> is
                        <var>endOffset</var>.
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapse" data-idl="operation"
                    data-title="collapse()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapse()|collapse(node)|collapse(node, offset)"
                    data-local-lt="Selection.collapse|Selection.collapse()|collapse" tabindex="0"
                    aria-haspopup="dialog"><code>collapse()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If <var>node</var> is null, this method must behave identically
                        as <code>removeAllRanges()</code> and abort these steps.
                    </li>
                    <li>If <var>node</var> is a <a data-link-type="interface" data-lt="DocumentType"
                            href="https://dom.spec.whatwg.org/#documenttype"><code>DocumentType</code></a>, throw an
                        <a data-link-type="exception" data-lt="InvalidNodeTypeError"
                            href="https://webidl.spec.whatwg.org/#invalidnodetypeerror"><code>InvalidNodeTypeError</code></a>
                        exception and abort these steps.
                    </li>
                    <li>The method must throw an <a data-link-type="exception" data-lt="IndexSizeError"
                            href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a>
                        exception if <var>
                            offset</var> is longer than <var>node</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length">length</a> and
                        abort these steps.
                    </li>
                    <li>If <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> associated
                        with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is not a
                        <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> of <var>node</var>, abort
                        these steps.
                    </li>
                    <li>Otherwise, let <var>newRange</var> be a new <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                    </li>
                    <li><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">Set the
                            start</a> the <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start">start</a> and the
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> of
                        <var>newRange</var> to (<var>node</var>,
                        <var>offset</var>).
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to
                        <var>newRange</var>.
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-setposition" data-idl="operation"
                    data-title="setPosition()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="setPosition()|setPosition(node)|setPosition(node, offset)"
                    data-local-lt="Selection.setPosition|Selection.setPosition()|setPosition" tabindex="0"
                    aria-haspopup="dialog"><code>setPosition()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must be an alias, and behave identically, to
                    <code>collapse()</code>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapsetostart" data-idl="operation"
                    data-title="collapseToStart()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapseToStart()"
                    data-local-lt="Selection.collapseToStart|Selection.collapseToStart()|collapseToStart" tabindex="0"
                    aria-haspopup="dialog"><code>collapseToStart()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must throw <a data-link-type="exception" data-lt="InvalidStateError"
                        href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                    exception if the
                    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is <a href="#dfn-empty"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-10">empty</a>. Otherwise, it must
                    create a new
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>, <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the start</a>
                    both its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a>
                    and
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to the <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> of <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>,
                    and then set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to the
                    newly-created
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                </p>
                <div class="note" role="note" id="issue-container-generatedID-7">
                    <div role="heading" class="note-title marker" id="h-note-7" aria-level="3"><span>Note</span></div>
                    <p class="">
                        For collapseToStart/End, IE9 mutates the existing range, while
                        Firefox 9.0a2 and Chrome 15 dev replace it with a new one. The spec
                        follows the majority and replaces it with a new one, leaving the
                        old Range object unchanged.
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapsetoend" data-idl="operation"
                    data-title="collapseToEnd()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapseToEnd()"
                    data-local-lt="Selection.collapseToEnd|Selection.collapseToEnd()|collapseToEnd" tabindex="0"
                    aria-haspopup="dialog"><code>collapseToEnd()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must throw <a data-link-type="exception" data-lt="InvalidStateError"
                        href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                    exception if the
                    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is <a href="#dfn-empty"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-11">empty</a>. Otherwise, it must
                    create a new
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>, <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the start</a>
                    both its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a>
                    and
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to the <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> of <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>, and
                    then set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to the
                    newly-created <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-extend" data-idl="operation"
                    data-title="extend()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="extend()|extend(node)|extend(node, offset)"
                    data-local-lt="Selection.extend|Selection.extend()|extend" tabindex="0"
                    aria-haspopup="dialog"><code>extend()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If the <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>
                        associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is
                        not a
                        <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> of <var>node</var>, abort
                        these steps.
                    </li>
                    <li>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is <a
                            href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-empty-12">empty</a>, throw an <a data-link-type="exception"
                            data-lt="InvalidStateError"
                            href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                        exception and abort these steps.
                    </li>
                    <li>Let <var>oldAnchor</var> and <var>oldFocus</var> be the
                        <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-anchor-14">anchor</a> and <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-14">focus</a>, and let
                        <var>newFocus</var> be the <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> (<var>node</var>,
                        <var>offset</var>).
                    </li>
                    <li>Let <var>newRange</var> be a new <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                    </li>
                    <li>If <var>node</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is not the same as the
                        <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root">root</a>, <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the
                            start</a>
                        <var>newRange</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start">start</a> and <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to
                        <var>newFocus</var>.
                    </li>
                    <li>Otherwise, if <var>oldAnchor</var> is <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a>
                        or equal to <var>newFocus</var>, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the start</a>
                        <var>newRange</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start">start</a> to <var>oldAnchor</var>,
                        then
                        set its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to
                        <var>newFocus</var>.
                    </li>
                    <li>Otherwise, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">set
                            the start</a> <var>newRange</var>'s
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> to
                        <var>newFocus</var>, then set its <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end">end</a>
                        to <var>oldAnchor</var>.
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to
                        <var>newRange</var>.
                    </li>
                    <li>If <var>newFocus</var> is <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a>
                        <var>oldAnchor</var>, set <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a href="#dfn-direction"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-3">direction</a> to
                        <a href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-backwards-3">backwards</a>. Otherwise, set it to <a href="#dfn-forwards"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-4">forwards</a>.
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-8">
                    <div role="heading" class="note-title marker" id="h-note-8" aria-level="3"><span>Note</span></div>
                    <p class="">
                        Reverse-engineered circa January 2011. IE doesn't support it, so
                        I'm relying on Firefox (implemented extend() sometime before 2000)
                        and WebKit (implemented extend() in 2007). I'm mostly ignoring
                        Opera, because gsnedders tells me its implementation isn't
                        compatible. Firefox 12.0a1 seems to mutate the existing range. IE9
                        doesn't support extend(), and it's impossible to tell whether
                        Chrome 17 dev or Opera Next 12.00 alpha mutate or replace, because
                        getRangeAt() returns a copy anyway. Nevertheless, I go against
                        Gecko here, to be consistent with collapse().
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-setbaseandextent" data-idl="operation"
                    data-title="setBaseAndExtent()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="setBaseAndExtent()|setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset)"
                    data-local-lt="Selection.setBaseAndExtent|Selection.setBaseAndExtent()|setBaseAndExtent"
                    tabindex="0" aria-haspopup="dialog"><code>setBaseAndExtent()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If <var>anchorOffset</var> is longer than
                        <var>anchorNode</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length">length</a> or if
                        <var>focusOffset</var> is longer than <var>focusNode</var>'s
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-length">length</a>,
                        throw an <a data-link-type="exception" data-lt="IndexSizeError"
                            href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a>
                        exception and abort
                        these steps.
                    </li>
                    <li>If <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> associated
                        with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is not a
                        <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> of <var>anchorNode</var> or
                        <var>focusNode</var>, abort these steps.
                    </li>
                    <li>Let <var>anchor</var> be the <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a>
                        (<var>anchorNode</var>, <var>anchorOffset</var>) and let
                        <var>focus</var> be the <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a>
                        (<var>focusNode</var>, <var>focusOffset</var>).
                    </li>
                    <li>Let <var>newRange</var> be a new <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a>.
                    </li>
                    <li>If <var>anchor</var> is <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a>
                        <var>focus</var>, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the start</a> the
                        <var>newRange</var>'s
                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> to
                        <var>anchor</var> and its <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to <var>
                            focus</var>. Otherwise, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">set the start</a> them to
                        <var>focus</var> and <var>anchor</var> respectively.
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to
                        <var>newRange</var>.
                    </li>
                    <li>If <var>focus</var> is <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a>
                        <var>anchor</var>, set <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>'s <a href="#dfn-direction"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-4">direction</a> to
                        <a href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-backwards-4">backwards</a>. Otherwise, set it to <a href="#dfn-forwards"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-5">forwards</a>
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-selectallchildren" data-idl="operation"
                    data-title="selectAllChildren()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="selectAllChildren()|selectAllChildren(node)"
                    data-local-lt="Selection.selectAllChildren|Selection.selectAllChildren()|selectAllChildren"
                    tabindex="0" aria-haspopup="dialog"><code>selectAllChildren()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If <var>node</var> is a <a data-link-type="interface" data-lt="DocumentType"
                            href="https://dom.spec.whatwg.org/#documenttype"><code>DocumentType</code></a>, throw an
                        <a data-link-type="exception" data-lt="InvalidNodeTypeError"
                            href="https://webidl.spec.whatwg.org/#invalidnodetypeerror"><code>InvalidNodeTypeError</code></a>
                        exception and abort these steps.
                    </li>
                    <li>If <var>node</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is not the <a
                            data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>
                        associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>,
                        abort these steps.
                    </li>
                    <li>Let <var>newRange</var> be a new <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> and
                        <var>childCount</var> be the number of <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-child">children</a> of
                        <var>node</var>.
                    </li>
                    <li>Set <var>newRange</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start">start</a> to (<var>node</var>,
                        <code>0</code>).
                    </li>
                    <li>Set <var>newRange</var>'s <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end">end</a> to (<var>node</var>,
                        <var>childCount</var>).
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> to
                        <var>newRange</var>.
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            href="#dfn-direction" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-direction-5">direction</a> to <var>forwards</var>.
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-9">
                    <div role="heading" class="note-title marker" id="h-note-9" aria-level="3"><span>Note</span></div>
                    <div class="">
                        <p>
                            Based mostly on Firefox 9.0a2. It has a bug that I didn't
                            reproduce, namely that if you pass a Document as the argument,
                            the end offset becomes 1 instead of the number of children it
                            has. It also throws a RangeException instead of DOMException,
                            because its implementation predated their merging.
                        </p>
                        <p>
                            IE9 behaves similarly but with glitches. It throws "Unspecified
                            error." if the node is detached or display:none, and apparently
                            in some random other cases too. It throws "Invalid argument." for
                            detached comments (only!). Finally, if you pass it a comment, it
                            seems to select the whole comment, unlike with text nodes.
                        </p>
                        <p>
                            Chrome 16 dev behaves as you'd expect given its Selection
                            implementation. It refuses to select anything that's not visible,
                            so it's almost always wrong. Opera 11.50 just does nothing in all
                            my tests, as usual.
                        </p>
                        <p>
                            The new range replaces any existing one, doesn't mutate it. This
                            matches IE9 and Firefox 12.0a1. (Chrome 17 dev and Opera Next
                            12.00 alpha can't be tested, because getRangeAt() returns a copy
                            anyway.)
                        </p>
                    </div>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-modify" data-idl="operation"
                    data-title="modify()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="modify()|modify(alter)|modify(alter, direction)|modify(alter, direction, granularity)"
                    data-local-lt="Selection.modify|Selection.modify()|modify" tabindex="0"
                    aria-haspopup="dialog"><code>modify()</code></dfn> method
            </dt>
            <dd data-cite="css-writing-modes-4">
                <p>
                    The method must follow these steps:
                </p>
                <ol>
                    <li>If <var>alter</var> is not <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match
                        with "extend" or "move", abort these steps.
                    </li>
                    <li>If <var>direction</var> is not <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match with "forward", "backward", "left", or "right", abort these
                        steps.
                    </li>
                    <li>If <var>granularity</var> is not <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match with "character", "word", "sentence", "line", "paragraph",
                        "lineboundary", "sentenceboundary", "paragraphboundary",
                        "documentboundary", abort these steps.
                    </li>
                    <li>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-25">selection</a> is empty, abort these steps.
                    </li>
                    <li>Let <var>effectiveDirection</var> be <a href="#dfn-backwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-backwards-5">backwards</a>.
                    </li>
                    <li>If <var>direction</var> is <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match
                        with "forward", set <var>effectiveDirection</var> to
                        <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-forwards-6">forwards</a>.
                    </li>
                    <li>If <var>direction</var> is <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match
                        with "right" and <a data-link-type="dfn"
                            href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction">inline base
                            direction</a> of <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>
                        <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-26">selection</a>'s <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-15">focus</a> is <a data-link-type="css-value"
                            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-ltr">ltr</a>, set
                        <var>effectiveDirection</var> to <a href="#dfn-forwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-forwards-7">forwards</a>.
                    </li>
                    <li>If <var>direction</var> is <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match
                        with "left" and <a data-link-type="dfn"
                            href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction">inline base
                            direction</a> of <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>
                        <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-27">selection</a>'s <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-16">focus</a> is <a data-link-type="css-value"
                            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-rtl">rtl</a>, set
                        <var>effectiveDirection</var> to <a href="#dfn-forwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-forwards-8">forwards</a>.
                    </li>
                    <li>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-28">selection</a>'s <a href="#dfn-direction" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-direction-6">direction</a> to
                        <var>effectiveDirection</var>.
                    </li>
                    <li>If <var>alter</var> is <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ASCII case-insensitive</a>
                        match with
                        "extend", set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-29">selection</a>'s <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-17">focus</a> to the
                        location as if the user had requested to extend selection by <var>
                            granularity</var>.
                    </li>
                    <li>Otherwise, set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-30">selection</a>'s <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-18">focus</a> and
                        <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-anchor-15">anchor</a> to the location as if the user had requested to move
                        selection by <var>granularity</var>.
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-10">
                    <div role="heading" class="note-title marker" id="h-note-10" aria-level="3"><span>Note</span></div>
                    <p class="">
                        We need to more precisely define what it means to extend or move
                        selection by each granularity.
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-deletefromdocument" data-idl="operation"
                    data-title="deleteFromDocument()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="deleteFromDocument()"
                    data-local-lt="Selection.deleteFromDocument|Selection.deleteFromDocument()|deleteFromDocument"
                    tabindex="0" aria-haspopup="dialog"><code>deleteFromDocument()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must invoke <a data-link-type="method" data-lt="deleteContents()"
                        href="https://dom.spec.whatwg.org/#dom-range-deletecontents"><code>deleteContents</code></a><code>()</code>
                    on <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> if <a
                        data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> is not <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-13">empty</a>
                    and both <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-19">focus</a>
                    and <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-16">anchor</a> are in the <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>. Otherwise the
                    method must do nothing.
                </p>
                <div class="note" role="note" id="issue-container-generatedID-11">
                    <div role="heading" class="note-title marker" id="h-note-11" aria-level="3"><span>Note</span></div>
                    <p class="">
                        This is the one method that actually mutates the range instead of
                        replacing it. This matches IE9 and Firefox 12.0a1. (Chrome 17 dev
                        and Opera Next 12.00 alpha can't be tested, because getRangeAt()
                        returns a copy anyway.)
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-containsnode" data-idl="operation"
                    data-title="containsNode()" data-dfn-for="Selection" data-type="boolean"
                    data-lt="containsNode()|containsNode(node)|containsNode(node, allowPartialContainment)"
                    data-local-lt="Selection.containsNode|Selection.containsNode()|containsNode" tabindex="0"
                    aria-haspopup="dialog"><code>containsNode()</code></dfn> method
            </dt>
            <dd>
                <p>
                    The method must return <code>false</code> if <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> is
                    <a href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-14">empty</a> or
                    if <var>node</var>'s <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> is not the
                    document associated with <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a>.
                </p>
                <p>
                    Otherwise, if <var>allowPartialContainment</var> is
                    <code>false</code>, the method must return <code>true</code> if and
                    only if <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> of
                    its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> or
                    visually equivalent to the first <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp">boundary
                        point</a> in the <var>node</var> <strong>and</strong> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-end">end</a>
                    of its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-after">after</a> or
                    visually
                    equivalent to the last <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> in the
                    <var>node</var>.
                </p>
                <p>
                    If <var>allowPartialContainment</var> is <code>true</code>, the
                    method must return <code>true</code> if and only if <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-start">start</a>
                    of its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> is <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> or
                    visually
                    equivalent to the last <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> in the <var>node</var>
                    <strong>and</strong> <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-end">end</a> of its <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> is
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-after">after</a> or
                    visually equivalent to the first
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> in
                    the <var>node</var>.
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-stringifier" data-idl="operation"
                    data-title="stringifier" data-dfn-for="Selection" data-type="" data-lt="stringifier()"
                    data-local-lt="Selection.stringifier|Selection.stringifier()|stringifier" tabindex="0"
                    aria-haspopup="dialog"><code>stringifier</code></dfn>
            </dt>
            <dd>
                <p>
                    The stringification must return the string, which is the
                    concatenation of the rendered text if there is a <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a>
                    associated with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>.
                </p>
                <p>
                    If the selection is within a <a data-link-type="element"
                        href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a>
                    or <a data-link-type="element"
                        href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a>
                    element, it must return the selected substring in its value.
                </p>
            </dd>
        </dl>
        <div class="note" role="note" id="issue-container-generatedID-12">
            <div role="heading" class="note-title marker" id="h-note-12" aria-level="3"><span>Note</span></div>
            <p class="">
                See also <a href="https://mxr.mozilla.org/mozilla/source/content/base/public/nsISelection.idl">
                    nsISelection.idl</a> from Gecko. This spec doesn't have everything from
                there yet, in particular selectionLanguageChange() and containsNode()
                are missing. They are missing because I couldn't work out how to define
                them in terms of Ranges.
            </p>
        </div>
        <div class="note" role="note" id="issue-container-generatedID-13">
            <div role="heading" class="note-title marker" id="h-note-13" aria-level="3"><span>Note</span></div>
            <div class="">
                <p>
                    Originally, the Selection interface was a Netscape feature. The
                    original implementation was carried on into Gecko (Firefox), and the
                    feature was later implemented independently by other browser engines.
                    The Netscape implementation always allowed multiple ranges in a
                    single selection, for instance so the user could select a column of a
                    table However, multi-range selections proved to be an unpleasant
                    corner case that web developers didn't know about and even Gecko
                    developers rarely handled correctly. Other browser engines never
                    implemented the feature, and clamped selections to a single range in
                    various incompatible fashions.
                </p>
                <p>
                    This specification follows non-Gecko engines in restricting
                    selections to at most one range, but the API was still originally
                    designed for selections with arbitrary numbers of ranges. This
                    explains oddities like the coexistence of <code>removeRange()</code>
                    and <code>removeAllRanges()</code>, and a <code>getRangeAt()</code>
                    method that takes an integer argument that must always be zero.
                </p>
            </div>
        </div>
        <p>
            All of the members of the <a data-link-type="idl" data-lt="Selection" href="#dom-selection"
                class="internalDFN" id="ref-for-dom-selection-1"><code>Selection</code></a> interface are defined in
            terms
            of operations on the
            <code><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a></code> object (if
            any)
            represented by the object. These operations can raise exceptions, as
            defined for the <a data-link-type="interface" data-lt="Range"
                href="https://dom.spec.whatwg.org/#range"><code>Range</code></a> interface; this can therefore result in
            the
            members of the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-31">Selection</a> interface raising exceptions as well,
            in addition to any explicitly called out above.
        </p>
    </section>
    <section id="extensions-to-other-interfaces">
        <div class="header-wrapper">
            <h2 id="x4-extensions-to-other-interfaces"><bdi class="secno">4. </bdi>
                Extensions to Other Interfaces
            </h2><a class="self-link" href="#extensions-to-other-interfaces" aria-label="Permalink for Section 4."></a>
        </div>

        <p>
            This specification extends several interfaces to provide entry points
            to the interfaces defined in this specification.
        </p>
        <section data-dfn-for="Document" id="extensions-to-document-interface">
            <div class="header-wrapper">
                <h3 id="x4-1-extensions-to-document-interface"><bdi class="secno">4.1 </bdi>
                    Extensions to <code>Document</code> interface
                </h3><a class="self-link" href="#extensions-to-document-interface"
                    aria-label="Permalink for Section 4.1"></a>
            </div>

            <p>
                The
                <code><dfn data-plurals="documents" id="dom-document" data-idl="interface" data-title="Document" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://dom.spec.whatwg.org/#document">Document</a></dfn></code>
                interface is defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>].
            </p>
            <pre class="idl def" data-cite="WEBIDL HTML" id="webidl-313315997"><span class="idlHeader"><a class="self-link" href="#webidl-313315997">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-document-partial-1" data-title="Document">partial interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-document"><code>Document</code></a> {<span data-idl="" class="idlMethod" id="idl-def-document-getselection" data-title="getSelection" data-dfn-for="Document"><span class="idlType">
  <a data-link-type="idl" href="#dom-selection" class="internalDFN" id="ref-for-dom-selection-2"><code>Selection</code></a>?</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-document-getselection" id="ref-for-dom-document-getselection-1"><code>getSelection</code></a>();</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="method" id="dom-document-getselection" data-idl="operation"
                        data-title="getSelection()" data-dfn-for="Document" data-type="Selection"
                        data-lt="getSelection()"
                        data-local-lt="Document.getSelection|Document.getSelection()|getSelection" tabindex="0"
                        aria-haspopup="dialog"><code>getSelection()</code></dfn> method
                </dt>
                <dd>
                    <p>
                        The method must return the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-32">selection</a> associated with
                        <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> if <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> has an associated
                        <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">browsing
                            context</a>, and it must return <code>null</code> otherwise.
                    </p>
                </dd>
            </dl>
        </section>
        <section data-dfn-for="Window" data-link-for="Window" id="extensions-to-window-interface">
            <div class="header-wrapper">
                <h3 id="x4-2-extensions-to-window-interface"><bdi class="secno">4.2 </bdi>
                    Extensions to <code>Window</code> interface
                </h3><a class="self-link" href="#extensions-to-window-interface"
                    aria-label="Permalink for Section 4.2"></a>
            </div>

            <p>
                The
                <code><dfn id="dom-window" data-idl="interface" data-title="Window" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a></dfn></code>
                interface is
                defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>].
            </p>
            <pre class="idl def" id="webidl-1016100280"><span class="idlHeader"><a class="self-link" href="#webidl-1016100280">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-window-partial-1" data-title="Window">partial interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-window"><code>Window</code></a> {<span data-idl="" class="idlMethod" id="idl-def-window-getselection" data-title="getSelection" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="idl" href="#dom-selection" class="internalDFN" id="ref-for-dom-selection-3"><code>Selection</code></a>?</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-getselection" id="ref-for-dom-window-getselection-1"><code>getSelection</code></a>();</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="method" id="dom-window-getselection" data-idl="operation"
                        data-title="getSelection()" data-dfn-for="Window" data-type="Selection" data-lt="getSelection()"
                        data-local-lt="Window.getSelection|Window.getSelection()|getSelection" tabindex="0"
                        aria-haspopup="dialog"><code>getSelection()</code></dfn> method
                </dt>
                <dd>
                    <p>
                        The method must invoke and return the result of
                        <a data-link-type="idl" data-lt="getSelection()" href="#dom-document-getselection"
                            class="internalDFN"
                            id="ref-for-dom-document-getselection-2"><code>getSelection</code></a><code>()</code> on <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a>'s <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>.<a
                            data-link-type="idl" href="https://dom.spec.whatwg.org/#document"><code>document</code></a>
                        attribute.
                    </p>
                </dd>
            </dl>
        </section>
        <section data-dfn-for="GlobalEventHandlers" id="extensions-to-globaleventhandlers-interface">
            <div class="header-wrapper">
                <h3 id="x4-3-extensions-to-globaleventhandlers-interface"><bdi class="secno">4.3 </bdi>
                    Extensions to <code>GlobalEventHandlers</code> interface
                </h3><a class="self-link" href="#extensions-to-globaleventhandlers-interface"
                    aria-label="Permalink for Section 4.3"></a>
            </div>

            <p>
                The
                <code><dfn id="dom-globaleventhandlers" data-idl="interface mixin" data-title="GlobalEventHandlers" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#globaleventhandlers">GlobalEventHandlers</a></dfn></code>
                interface is defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>].
            </p>
            <pre class="idl def" id="webidl-1185742786"><span class="idlHeader"><a class="self-link" href="#webidl-1185742786">WebIDL</a></span><code><span data-idl="" class="idlInterface mixin" id="idl-def-globaleventhandlers-partial-1" data-title="GlobalEventHandlers">partial interface mixin <a class="internalDFN idlID" data-link-type="interface" href="#dom-globaleventhandlers"><code>GlobalEventHandlers</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-globaleventhandlers-onselectstart" data-title="onselectstart" data-dfn-for="GlobalEventHandlers">
  attribute<span class="idlType"> <a data-link-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-globaleventhandlers-onselectstart" id="ref-for-dom-globaleventhandlers-onselectstart-1"><code>onselectstart</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-globaleventhandlers-onselectionchange" data-title="onselectionchange" data-dfn-for="GlobalEventHandlers">
  attribute<span class="idlType"> <a data-link-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-globaleventhandlers-onselectionchange" id="ref-for-dom-globaleventhandlers-onselectionchange-1"><code>onselectionchange</code></a>;</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="attribute" id="dom-globaleventhandlers-onselectstart"
                        data-idl="attribute" data-title="onselectstart" data-dfn-for="GlobalEventHandlers"
                        data-type="EventHandler" data-lt="onselectstart"
                        data-local-lt="GlobalEventHandlers.onselectstart" tabindex="0"
                        aria-haspopup="dialog"><code>onselectstart</code></dfn>
                </dt>
                <dd>
                    <p>
                        The attribute must be an <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">event
                            handler IDL attribute</a> for
                        the <a href="#dfn-selectstart" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selectstart-1"><code>selectstart</code></a> event supported by all <a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#html-elements">HTML
                            elements</a>, <a data-link-type="idl" data-lt="Document"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> objects, and <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        objects.
                    </p>
                </dd>
                <dt>
                    <dfn data-export="" data-dfn-type="attribute" id="dom-globaleventhandlers-onselectionchange"
                        data-idl="attribute" data-title="onselectionchange" data-dfn-for="GlobalEventHandlers"
                        data-type="EventHandler" data-lt="onselectionchange"
                        data-local-lt="GlobalEventHandlers.onselectionchange" tabindex="0"
                        aria-haspopup="dialog"><code>onselectionchange</code></dfn>
                </dt>
                <dd>
                    <p>
                        The attribute must be an <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">event
                            handler IDL attribute</a> for
                        the <a href="#dfn-selectionchange" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selectionchange-1"><code>selectionchange</code></a> event supported by all
                        <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#html-elements">HTML
                            elements</a>, <a data-link-type="idl" data-lt="Document"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> objects, and <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        objects.
                    </p>
                </dd>
            </dl>
        </section>
    </section>
    <section id="responding-to-dom-mutations">
        <div class="header-wrapper">
            <h2 id="x5-responding-to-dom-mutations"><bdi class="secno">5. </bdi>
                Responding to DOM Mutations
            </h2><a class="self-link" href="#responding-to-dom-mutations" aria-label="Permalink for Section 5."></a>
        </div>

        <p>
            When the user agent is to <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-cd-replace">replace data</a> or <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-cd-substring">substring data</a> on <a
                data-link-type="interface" data-lt="CharacterData"
                href="https://dom.spec.whatwg.org/#characterdata"><code>CharacterData</code></a>, the user agent must
            update the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> associated with <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-33">selection</a> of the <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-document">node document</a> of the <a
                data-link-type="interface" data-lt="CharacterData"
                href="https://dom.spec.whatwg.org/#characterdata"><code>CharacterData</code></a> as if it's a <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live range</a>.
        </p>
        <p>
            When the user agent is to split a <a data-link-type="interface" data-lt="Text"
                href="https://dom.spec.whatwg.org/#text"><code>Text</code></a> <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node">node</a>, the user agent
            must update the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
            associated with <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-34">selection</a> of the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a> of the
            <a data-link-type="interface" data-lt="Text" href="https://dom.spec.whatwg.org/#text"><code>Text</code></a>
            as if it's a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live range</a>.
        </p>
        <p>
            When the user agent is to run steps for <code>normalize()</code>
            method, the user agent must update the <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> associated with
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-35">selection</a> of the <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-document">node document</a> of <a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this">this</a> as if it's a
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live range</a>.
        </p>
        <p>
            When the user agent is to <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-remove">remove</a> or <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-insert">insert</a> a <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node">node</a>, the user
            agent must update the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
            associated with <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-36">selection</a> of
            the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a> of
            the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node">node</a> as if it's a <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live
                range</a>.
        </p>
    </section>
    <section id="user-interactions">
        <div class="header-wrapper">
            <h2 id="x6-user-interactions"><bdi class="secno">6. </bdi>
                User Interactions
            </h2><a class="self-link" href="#user-interactions" aria-label="Permalink for Section 6."></a>
        </div>

        <p>
            The user agent should allow the user to change the <a href="#dfn-selection" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-selection-37">selection</a>
            associated with the <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">active document</a>.
            If the user makes
            any modification to a <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-38">selection</a>, the user agent must create a
            new <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> with suitable <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> and <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> of the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> and associate the <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-39">selection</a> with this new
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> (not modify the existing
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>), and set update
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-40">selection</a>'s <a href="#dfn-direction" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-direction-7">direction</a> to <a href="#dfn-forwards"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-9">forwards</a> if the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> is <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> or equal to
            the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a>, <a
                href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-backwards-6">backwards</a> if if the <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-end">end</a> is <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> the <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-start">start</a>, or <a href="#dfn-directionless"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directionless-3">directionless</a> if the
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> and the <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> cannot be ordered due
            to the
            platform convention.
        </p>
        <p>
            The user agent must not make a <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-41">selection</a> <a href="#dfn-empty" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-empty-15">empty</a> if it was
            not already <a href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-empty-16">empty</a> in response to any user actions (e.g. clicking
            on a non-editable region).
        </p>
        <div class="note" role="note" id="issue-container-generatedID-14">
            <div role="heading" class="note-title marker" id="h-note-14" aria-level="3"><span>Note</span></div>
            <p class="">
                See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">bug
                    15470</a>. IE9 and Opera Next 12.00 alpha allow the user to reset the
                range to null after the fact by clicking somewhere; Firefox 12.0a1 and
                Chrome 17 dev do not. I follow Gecko/WebKit, because it lessens the
                chance of getRangeAt(0) throwing.
            </p>
        </div>
        <section id="selectstart-event">
            <div class="header-wrapper">
                <h3 id="x6-1-selectstart-event"><bdi class="secno">6.1 </bdi>
                    <code><dfn data-dfn-type="event" id="dfn-selectstart" tabindex="0" aria-haspopup="dialog" data-export="">selectstart</dfn></code>
                    event
                </h3><a class="self-link" href="#selectstart-event" aria-label="Permalink for Section 6.1"></a>
            </div>

            <p>
                When the user agent is about to associate a new range
                <var>newRange</var> to the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-42">selection</a> in response to a user
                initiated action, the user agent must <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a> named
                <code>selectstart</code>, which bubbles and is cancelable, at the
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node">node</a> associated with
                the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> of
                <var>newRange</var>'s <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range-start">start</a> prior to changing the selection
                if the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-43">selection</a> was previously <a href="#dfn-empty" class="internalDFN"
                    data-link-type="dfn" id="ref-for-dfn-empty-17">empty</a> or the previously
                associated range was <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a>.
            </p>
            <p>
                If the event is canceled, the user agent must not change the
                <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-44">selection</a>.
            </p>
            <p>
                The user agent must not <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a> when the user agent sets
                the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-45">selection</a> <a href="#dfn-empty" class="internalDFN"
                    data-link-type="dfn" id="ref-for-dfn-empty-18">empty</a>.
            </p>
        </section>
        <section id="selectionchange-event">
            <div class="header-wrapper">
                <h3 id="x6-2-selectionchange-event"><bdi class="secno">6.2 </bdi>
                    <code><dfn data-dfn-type="event" id="dfn-selectionchange" tabindex="0" aria-haspopup="dialog" data-export="">selectionchange</dfn></code>
                    event
                </h3><a class="self-link" href="#selectionchange-event" aria-label="Permalink for Section 6.2"></a>
            </div>

            <p>
                When the <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-46">selection</a> is dissociated with its <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range">range</a>,
                associated with a new <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range">range</a>, or the associated <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>'s
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a> is
                mutated either by the user or the content
                script, the user agent must <a href="#dfn-schedule-a-selectionchange-event" class="internalDFN"
                    data-link-type="dfn" id="ref-for-dfn-schedule-a-selectionchange-event-1">schedule a selectionchange
                    event</a>
                on <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>.
            </p>
            <p>
                When an
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a></code>
                or
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a></code>
                element provide a text selection
                and its selection changes (in either extent or <a data-link-type="dfn|abstract-op" href="#dfn-direction"
                    class="internalDFN" id="ref-for-dfn-direction-8">direction</a>), the
                user agent must <a href="#dfn-schedule-a-selectionchange-event" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-schedule-a-selectionchange-event-2">schedule a selectionchange event</a> on the
                element.
            </p>
            <section id="scheduling-selectionchange-event">
                <div class="header-wrapper">
                    <h4 id="x6-2-1-scheduling-selectionchange-event"><bdi class="secno">6.2.1 </bdi>
                        Scheduling <code>selectionchange</code> event
                    </h4><a class="self-link" href="#scheduling-selectionchange-event"
                        aria-label="Permalink for Section 6.2.1"></a>
                </div>

                <p>
                    To <dfn id="dfn-schedule-a-selectionchange-event" tabindex="0" aria-haspopup="dialog"
                        data-dfn-type="dfn">schedule a selectionchange event</dfn> on a node
                    <var>target</var>, run these steps:
                </p>
                <ol>
                    <li>If <var>target</var>'s <a href="#dfn-has-scheduled-selectionchange-event" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-has-scheduled-selectionchange-event-1">has scheduled
                            selectionchange
                            event</a> is true, abort these steps.
                    </li>
                    <li>
                        <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a>
                        on the <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user
                            interaction task source</a> to
                        <a href="#dfn-fire-a-selectionchange-event" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-fire-a-selectionchange-event-1">fire a selectionchange event</a> on
                        <var>target</var>.
                    </li>
                </ol>
            </section>
            <section id="firing-selectionchange-event">
                <div class="header-wrapper">
                    <h4 id="x6-2-2-firing-selectionchange-event"><bdi class="secno">6.2.2 </bdi>
                        Firing <code>selectionchange</code> event
                    </h4><a class="self-link" href="#firing-selectionchange-event"
                        aria-label="Permalink for Section 6.2.2"></a>
                </div>

                <p>
                    To <dfn id="dfn-fire-a-selectionchange-event" tabindex="0" aria-haspopup="dialog"
                        data-dfn-type="dfn">fire a selectionchange event</dfn> on a node
                    <var>target</var>, run these steps:
                </p>
                <ol>
                    <li>Set <var>target</var>'s <a href="#dfn-has-scheduled-selectionchange-event" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-has-scheduled-selectionchange-event-2">has scheduled
                            selectionchange
                            event</a> to false.
                    </li>
                    <li>If <var>target</var> is an element, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a> named
                        <code>selectionchange</code>, which bubbles and not cancelable, at
                        <var>target</var>.
                    </li>
                    <li>Otherwise, if <var>target</var> is a document, <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-event-fire">fire an
                            event</a> named <code>selectionchange</code>, which does not bubble
                        and not cancelable, at <var>target</var>.
                    </li>
                </ol>
            </section>
        </section>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x7-conformance"><bdi class="secno">7. </bdi>Conformance</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 7."></a>
        </div>
        <p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this
            specification are non-normative. Everything else in this specification is normative.</p>
        <p>
            This specification defines conformance criteria that apply to a single
            product: the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent">user agent</a> that
            implements the interfaces that it
            contains.
        </p>
    </section>
    <section id="security-and-privacy-considerations">
        <div class="header-wrapper">
            <h2 id="x8-security-and-privacy-considerations"><bdi class="secno">8. </bdi>
                Security and Privacy considerations
            </h2><a class="self-link" href="#security-and-privacy-considerations"
                aria-label="Permalink for Section 8."></a>
        </div>

        <p>
            There are no known security considerations for this standard.
        </p>
        <p>
            To mitigate potential privacy risks of exposing user's use of assistive
            technologies, for example, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent">user
                agent</a> may elect to emulate mouse
            and keyboard events typically associated with <a href="#dfn-selectstart" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-selectstart-2"><code>selectstart</code></a> or
            <a href="#dfn-selectionchange" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selectionchange-2"><code>selectionchange</code></a> events when the user opts to modify
            the
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-47">selection</a> of a document.
        </p>
    </section>
    <section class="appendix" id="acknowledgements">
        <div class="header-wrapper">
            <h2 id="a-acknowledgements"><bdi class="secno">A. </bdi>
                Acknowledgements
            </h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Appendix A."></a>
        </div>

        <p>
            Many thanks to
        </p>
        <ul>
            <li>Aryeh Gregor, who is the original author of this specification as
                well as <a href="https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html">HTML Editing
                    API specification</a>
            </li>
            <li>Contributors to the <a href="https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html">HTML Editing
                    API specification</a> - Ehsan Akhgari, Tab Atkins, Mathias Bynens, Tim
                Down, Markus Ernst, Daniel Glazman, Tali Gregor (née Fuss), Stig
                Halvorsen, Jeff Harris, Ian Hickson, Cameron Heavon-Jones, Anne van
                Kesteren, Alfonso Martínez de Lizarrondo, Glenn Maynard, Ms2ger, Robert
                O'Callahan, Julie Parent, Simon Pieters, Michael A. Puls II, Rich
                Schwerdtfeger, Jonas Sicking, Henri Sivonen, Smylers, Hallvord R. M.
                Steen, Roland Steiner, Annie Sullivan, timeless, Ojan Vafai, Brett
                Zamir, and Boris Zbarsky for their feedback, participation, or other
                helpful contributions
            </li>
        </ul>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>References</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>Normative references</h3><a
                    class="self-link" href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-css-writing-modes-4">[css-writing-modes-4]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>.
                    Elika Etemad; Koji Ishii. W3C. 30 July 2019. W3C Candidate Recommendation. URL: <a
                        href="https://www.w3.org/TR/css-writing-modes-4/">https://www.w3.org/TR/css-writing-modes-4/</a>
                </dd>
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-html">[HTML]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Dominic Farolino; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. Living
                    Standard. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-infra">[infra]</dt>
                <dd>
                    <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Anne van Kesteren; Domenic
                    Denicola. WHATWG. Living Standard. URL: <a
                        href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-url">[url]</dt>
                <dd>
                    <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-webidl">[WEBIDL]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. Living Standard. URL: <a
                        href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selection"
        aria-label="Links in this document to definition: selection">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selection"
                aria-label="Permalink for definition: selection. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selection-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-selection-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-selection-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-selection-7" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-selection-8" title="Reference 8">(8)</a> <a href="#ref-for-dfn-selection-9"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-selection-10" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-selection-11" title="Reference 11">(11)</a> <a href="#ref-for-dfn-selection-12"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-selection-13" title="Reference 13">(13)</a> <a
                    href="#ref-for-dfn-selection-14" title="Reference 14">(14)</a> <a href="#ref-for-dfn-selection-15"
                    title="Reference 15">(15)</a> <a href="#ref-for-dfn-selection-16" title="Reference 16">(16)</a> <a
                    href="#ref-for-dfn-selection-17" title="Reference 17">(17)</a> <a href="#ref-for-dfn-selection-18"
                    title="Reference 18">(18)</a> <a href="#ref-for-dfn-selection-19" title="Reference 19">(19)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-20" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-selection-21" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-22"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-23" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-24" title="Reference 5">(5)</a> <a href="#ref-for-dfn-selection-25"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-selection-26" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-selection-27" title="Reference 8">(8)</a> <a href="#ref-for-dfn-selection-28"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-selection-29" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-selection-30" title="Reference 11">(11)</a> <a href="#ref-for-dfn-selection-31"
                    title="Reference 12">(12)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-32" title="§ 4.1 Extensions to Document interface">§ 4.1 Extensions to
                    Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-33" title="§ 5. Responding to DOM Mutations">§ 5. Responding to DOM
                    Mutations</a> <a href="#ref-for-dfn-selection-34" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-selection-35" title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-36"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-37" title="§ 6. User Interactions">§ 6. User Interactions</a> <a
                    href="#ref-for-dfn-selection-38" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-39"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-40" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-41" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-42" title="§ 6.1 selectstart event">§ 6.1 selectstart event</a> <a
                    href="#ref-for-dfn-selection-43" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-44"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-45" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-46" title="§ 6.2 selectionchange event">§ 6.2 selectionchange event</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-47" title="§ 8. Security and Privacy considerations">§ 8. Security and
                    Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-empty"
        aria-label="Links in this document to definition: empty">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-empty"
                aria-label="Permalink for definition: empty. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-empty-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-2" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-empty-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-empty-4"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-empty-5" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-empty-6" title="Reference 5">(5)</a> <a href="#ref-for-dfn-empty-7"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-empty-8" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-empty-9" title="Reference 8">(8)</a> <a href="#ref-for-dfn-empty-10"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-empty-11" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-empty-12" title="Reference 11">(11)</a> <a href="#ref-for-dfn-empty-13"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-empty-14" title="Reference 13">(13)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-15" title="§ 6. User Interactions">§ 6. User Interactions</a> <a
                    href="#ref-for-dfn-empty-16" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-17" title="§ 6.1 selectstart event">§ 6.1 selectstart event</a> <a
                    href="#ref-for-dfn-empty-18" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-direction"
        aria-label="Links in this document to definition: direction">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-direction"
                aria-label="Permalink for definition: direction. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-direction-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-direction-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-3" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-direction-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-direction-5"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-direction-6" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-7" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-8" title="§ 6.2 selectionchange event">§ 6.2 selectionchange event</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-forwards"
        aria-label="Links in this document to definition: forwards">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-forwards"
                aria-label="Permalink for definition: forwards. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-forwards-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-forwards-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-forwards-3" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-forwards-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-forwards-5"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-forwards-6" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-forwards-7" title="Reference 5">(5)</a> <a href="#ref-for-dfn-forwards-8"
                    title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-forwards-9" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-backwards"
        aria-label="Links in this document to definition: backwards">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-backwards"
                aria-label="Permalink for definition: backwards. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-backwards-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-backwards-2" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-backwards-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-backwards-4"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-backwards-5" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-backwards-6" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-directionless"
        aria-label="Links in this document to definition: directionless">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-directionless"
                aria-label="Permalink for definition: directionless. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-directionless-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-directionless-2" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-directionless-3" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-anchor"
        aria-label="Links in this document to definition: anchor">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-anchor"
                aria-label="Permalink for definition: anchor. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-anchor-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-anchor-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-anchor-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-anchor-4" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-anchor-5" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-anchor-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-anchor-7"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-anchor-8" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-anchor-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-anchor-10"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-anchor-11" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-anchor-12" title="Reference 8">(8)</a> <a href="#ref-for-dfn-anchor-13"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-anchor-14" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-anchor-15" title="Reference 11">(11)</a> <a href="#ref-for-dfn-anchor-16"
                    title="Reference 12">(12)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-focus"
        aria-label="Links in this document to definition: focus">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-focus"
                aria-label="Permalink for definition: focus. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-focus-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-focus-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-focus-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-focus-4" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-focus-5" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-focus-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-focus-7"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-focus-8" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-focus-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-focus-10"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-focus-11" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-focus-12" title="Reference 8">(8)</a> <a href="#ref-for-dfn-focus-13"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-focus-14" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-focus-15" title="Reference 11">(11)</a> <a href="#ref-for-dfn-focus-16"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-focus-17" title="Reference 13">(13)</a> <a
                    href="#ref-for-dfn-focus-18" title="Reference 14">(14)</a> <a href="#ref-for-dfn-focus-19"
                    title="Reference 15">(15)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-has-scheduled-selectionchange-event"
        aria-label="Links in this document to definition: has scheduled selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-has-scheduled-selectionchange-event"
                aria-label="Permalink for definition: has scheduled selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-has-scheduled-selectionchange-event-1"
                    title="§ 6.2.1 Scheduling selectionchange event">§ 6.2.1 Scheduling selectionchange event</a>
            </li>
            <li>
                <a href="#ref-for-dfn-has-scheduled-selectionchange-event-2"
                    title="§ 6.2.2 Firing selectionchange event">§ 6.2.2 Firing selectionchange event</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection"
        aria-label="Links in this document to definition: Selection">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection"
                aria-label="Permalink for definition: Selection. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-2" title="§ 4.1 Extensions to Document interface">§ 4.1 Extensions to
                    Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-3" title="§ 4.2 Extensions to Window interface">§ 4.2 Extensions to
                    Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-getcomposedrangesoptions"
        aria-label="Links in this document to definition: GetComposedRangesOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-getcomposedrangesoptions"
                aria-label="Permalink for definition: GetComposedRangesOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-getcomposedrangesoptions-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-getcomposedrangesoptions-shadowroots"
        aria-label="Links in this document to definition: shadowRoots">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-getcomposedrangesoptions-shadowroots"
                aria-label="Permalink for definition: shadowRoots. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-getcomposedrangesoptions-shadowroots-1" title="§ 3. Selection interface">§ 3.
                    Selection interface</a> <a href="#ref-for-dom-getcomposedrangesoptions-shadowroots-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-anchornode"
        aria-label="Links in this document to definition: anchorNode">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-anchornode"
                aria-label="Permalink for definition: anchorNode. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-anchornode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-anchoroffset"
        aria-label="Links in this document to definition: anchorOffset">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-anchoroffset"
                aria-label="Permalink for definition: anchorOffset. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-anchoroffset-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-focusnode"
        aria-label="Links in this document to definition: focusNode">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-focusnode"
                aria-label="Permalink for definition: focusNode. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-focusnode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-focusoffset"
        aria-label="Links in this document to definition: focusOffset">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-focusoffset"
                aria-label="Permalink for definition: focusOffset. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-focusoffset-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-iscollapsed"
        aria-label="Links in this document to definition: isCollapsed">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-iscollapsed"
                aria-label="Permalink for definition: isCollapsed. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-iscollapsed-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-rangecount"
        aria-label="Links in this document to definition: rangeCount">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-rangecount"
                aria-label="Permalink for definition: rangeCount. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-rangecount-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-type"
        aria-label="Links in this document to definition: type">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-type"
                aria-label="Permalink for definition: type. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-type-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-direction"
        aria-label="Links in this document to definition: direction">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-direction"
                aria-label="Permalink for definition: direction. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-direction-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-getrangeat"
        aria-label="Links in this document to definition: getRangeAt()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-getrangeat"
                aria-label="Permalink for definition: getRangeAt(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-getrangeat-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-addrange"
        aria-label="Links in this document to definition: addRange()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-addrange"
                aria-label="Permalink for definition: addRange(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-addrange-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-addrange-2" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-removerange"
        aria-label="Links in this document to definition: removeRange()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-removerange"
                aria-label="Permalink for definition: removeRange(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-removerange-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-removeallranges"
        aria-label="Links in this document to definition: removeAllRanges()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-removeallranges"
                aria-label="Permalink for definition: removeAllRanges(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-removeallranges-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-empty"
        aria-label="Links in this document to definition: empty()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-empty"
                aria-label="Permalink for definition: empty(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-empty-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-getcomposedranges"
        aria-label="Links in this document to definition: getComposedRanges()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-getcomposedranges"
                aria-label="Permalink for definition: getComposedRanges(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-getcomposedranges-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapse"
        aria-label="Links in this document to definition: collapse()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapse"
                aria-label="Permalink for definition: collapse(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapse-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-setposition"
        aria-label="Links in this document to definition: setPosition()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-setposition"
                aria-label="Permalink for definition: setPosition(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-setposition-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapsetostart"
        aria-label="Links in this document to definition: collapseToStart()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapsetostart"
                aria-label="Permalink for definition: collapseToStart(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapsetostart-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapsetoend"
        aria-label="Links in this document to definition: collapseToEnd()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapsetoend"
                aria-label="Permalink for definition: collapseToEnd(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapsetoend-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-extend"
        aria-label="Links in this document to definition: extend()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-extend"
                aria-label="Permalink for definition: extend(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-extend-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-setbaseandextent"
        aria-label="Links in this document to definition: setBaseAndExtent()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-setbaseandextent"
                aria-label="Permalink for definition: setBaseAndExtent(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-setbaseandextent-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-selectallchildren"
        aria-label="Links in this document to definition: selectAllChildren()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-selectallchildren"
                aria-label="Permalink for definition: selectAllChildren(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-selectallchildren-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-modify"
        aria-label="Links in this document to definition: modify()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-modify"
                aria-label="Permalink for definition: modify(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-modify-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-deletefromdocument"
        aria-label="Links in this document to definition: deleteFromDocument()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-deletefromdocument"
                aria-label="Permalink for definition: deleteFromDocument(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-deletefromdocument-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-containsnode"
        aria-label="Links in this document to definition: containsNode()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-containsnode"
                aria-label="Permalink for definition: containsNode(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-containsnode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-stringifier"
        aria-label="Links in this document to definition: stringifier">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-stringifier"
                aria-label="Permalink for definition: stringifier. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-stringifier-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-getselection"
        aria-label="Links in this document to definition: getSelection()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-getselection"
                aria-label="Permalink for definition: getSelection(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-313315997">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-getselection-1" title="§ 4.1 Extensions to Document interface">§ 4.1
                    Extensions to Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-document-getselection-2" title="§ 4.2 Extensions to Window interface">§ 4.2
                    Extensions to Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-getselection"
        aria-label="Links in this document to definition: getSelection()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-getselection"
                aria-label="Permalink for definition: getSelection(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1016100280">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-getselection-1" title="§ 4.2 Extensions to Window interface">§ 4.2
                    Extensions to Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-globaleventhandlers-onselectstart"
        aria-label="Links in this document to definition: onselectstart">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-globaleventhandlers-onselectstart"
                aria-label="Permalink for definition: onselectstart. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1185742786">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-globaleventhandlers-onselectstart-1"
                    title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3 Extensions to GlobalEventHandlers
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-globaleventhandlers-onselectionchange"
        aria-label="Links in this document to definition: onselectionchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-globaleventhandlers-onselectionchange"
                aria-label="Permalink for definition: onselectionchange. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1185742786">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-globaleventhandlers-onselectionchange-1"
                    title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3 Extensions to GlobalEventHandlers
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selectstart"
        aria-label="Links in this document to definition: selectstart">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selectstart"
                aria-label="Permalink for definition: selectstart. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selectstart-1" title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3
                    Extensions to GlobalEventHandlers interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selectstart-2" title="§ 8. Security and Privacy considerations">§ 8. Security and
                    Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selectionchange"
        aria-label="Links in this document to definition: selectionchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selectionchange"
                aria-label="Permalink for definition: selectionchange. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selectionchange-1" title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3
                    Extensions to GlobalEventHandlers interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selectionchange-2" title="§ 8. Security and Privacy considerations">§ 8. Security
                    and Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-schedule-a-selectionchange-event"
        aria-label="Links in this document to definition: schedule a selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-schedule-a-selectionchange-event"
                aria-label="Permalink for definition: schedule a selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-schedule-a-selectionchange-event-1" title="§ 6.2 selectionchange event">§ 6.2
                    selectionchange event</a> <a href="#ref-for-dfn-schedule-a-selectionchange-event-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-fire-a-selectionchange-event"
        aria-label="Links in this document to definition: fire a selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-fire-a-selectionchange-event"
                aria-label="Permalink for definition: fire a selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-fire-a-selectionchange-event-1" title="§ 6.2.1 Scheduling selectionchange event">§
                    6.2.1 Scheduling selectionchange event</a>
            </li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
</body>

</html>