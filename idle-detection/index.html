<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>空闲检测 API</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
    <!-- <meta content="Bikeshed version ac5ea272d, updated Fri Dec 6 15:45:15 2024 -0800" name="generator"> -->
    <link href="https://wicg.github.io/idle-detection/" rel="canonical">
    <link href="https://wicg.github.io/idle-detection/logo-idle.png" rel="icon">
    <!-- <meta content="183730b9a7a73e015866d5296c7e957aafe19463" name="revision"> -->
    <meta content="dark light" name="color-scheme">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">
    <style>
        table {
            border-collapse: collapse;
            border-left-style: hidden;
            border-right-style: hidden;
            text-align: left;
        }

        table td,
        table th {
            border: 1px solid black;
            padding: 3px;
        }
    </style>
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-mdn-anno */
        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
            --mdn-pass: green;
            --mdn-fail: red;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --mdn-bg: #222;
                --mdn-shadow: #444;
                --mdn-nosupport-text: #666;
                --mdn-pass: #690;
                --mdn-fail: #d22;
            }
        }

        .mdn-anno {
            background: var(--mdn-bg, #EEE);
            border-radius: .25em;
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            color: var(--text, black);
            font: 1em sans-serif;
            hyphens: none;
            max-width: min-content;
            overflow: hidden;
            padding: 0.2em;
            position: absolute;
            right: 0.3em;
            top: auto;
            white-space: nowrap;
            word-wrap: normal;
            z-index: 8;
        }

        .mdn-anno.unpositioned {
            display: none;
        }

        .mdn-anno.overlapping-main {
            opacity: .2;
            transition: opacity .1s;
        }

        .mdn-anno[open] {
            opacity: 1;
            z-index: 9;
            min-width: 9em;
        }

        .mdn-anno:hover {
            opacity: 1;
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>summary {
            font-weight: normal;
            text-align: right;
            cursor: pointer;
            display: block;
        }

        .mdn-anno>summary>.less-than-two-engines-flag {
            color: var(--mdn-fail);
            padding-right: 2px;
        }

        .mdn-anno>summary>.all-engines-flag {
            color: var(--mdn-pass);
            padding-right: 2px;
        }

        .mdn-anno>summary>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: var(--mdn-fail);
        }

        .mdn-anno>.feature>.all-engines-text {
            color: var(--mdn-pass);
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color] {
            background-color: var(--var-bg);
            box-shadow: 0 0 0 2px var(--var-bg);
        }

        var[data-var-color] {
            --var-bg: #F4D200;
        }

        var[data-var-color="1"] {
            --var-bg: #FF87A2;
        }

        var[data-var-color="2"] {
            --var-bg: #96E885;
        }

        var[data-var-color="3"] {
            --var-bg: #3EEED2;
        }

        var[data-var-color="4"] {
            --var-bg: #EACFB6;
        }

        var[data-var-color="5"] {
            --var-bg: #82DDFF;
        }

        var[data-var-color="6"] {
            --var-vg: #FFBCF2;
        }

        @media (prefers-color-scheme: dark) {
            var[data-var-color] {
                --var-bg: #bc1a00;
            }

            var[data-var-color="1"] {
                --var-bg: #007f00;
            }

            var[data-var-color="2"] {
                --var-bg: #008698;
            }

            var[data-var-color="3"] {
                --var-bg: #7f5b2b;
            }

            var[data-var-color="4"] {
                --var-bg: #004df3;
            }

            var[data-var-color="5"] {
                --var-bg: #a1248a;
            }

            var[data-var-color="6"] {
                --var-vg: #ff0000;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-wpt */
        :root {
            --wpt-border: hsl(0, 0%, 60%);
            --wpt-bg: hsl(0, 0%, 95%);
            --wpt-text: var(--text);
            --wptheading-text: hsl(0, 0%, 30%);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --wpt-border: hsl(0, 0%, 30%);
                --wpt-bg: var(--borderedblock-bg);
                --wpt-text: var(--text);
                --wptheading-text: hsl(0, 0%, 60%);
            }
        }

        .wpt-tests-block {
            list-style: none;
            border-left: .5em solid var(--wpt-border);
            background: var(--wpt-bg);
            color: var(--wpt-text);
            margin: 1em auto;
            padding: .5em;
        }

        .wpt-tests-block summary {
            color: var(--wptheading-text);
            font-weight: normal;
            text-transform: uppercase;
        }

        .wpt-tests-block summary::marker {
            color: var(--wpt-border);
        }

        .wpt-tests-block summary:hover::marker {
            color: var(--wpt-text);
        }

        /*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
        .wpt-tests-block:not([open]) {
            padding: 0;
            border: none;
            background: none;
            font-size: 0.75em;
            line-height: 1;
            position: relative;
            margin: 1em 0 0;
        }

        .wpt-tests-block:not([open]) summary {
            position: absolute;
            right: 0;
            bottom: 0;
        }

        /*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
        .wpt-tests-block:not([open]):last-child {
            padding-bottom: 1px;
            margin-bottom: -1px;
        }

        /*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
        li:not(:last-child)>.wpt-tests-block:not([open]):last-child,
        dd:not(:last-child)>.wpt-tests-block:not([open]):last-child {
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .wpt-tests-block:not([open]):not(:hover) {
            opacity: 0.5;
        }

        .wpt-tests-list {
            list-style: none;
            display: grid;
            margin: 0;
            padding: 0;
            grid-template-columns: 1fr max-content auto auto;
            grid-column-gap: .5em;
        }

        .wpt-tests-block hr:last-child {
            display: none;
        }

        .wpt-test {
            display: contents;
        }

        .wpt-test>a {
            text-decoration: underline;
            border: none;
        }

        .wpt-test>.wpt-name {
            grid-column: 1;
        }

        .wpt-test>.wpt-results {
            grid-column: 2;
        }

        .wpt-test>.wpt-live {
            grid-column: 3;
        }

        .wpt-test>.wpt-source {
            grid-column: 4;
        }

        .wpt-test>.wpt-results {
            display: flex;
            gap: .1em;
        }

        .wpt-test .wpt-result {
            display: inline-block;
            height: 1em;
            width: 1em;
            border-radius: 50%;
            position: relative;
        }
    </style>

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">空闲检测 API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">社区小组草案报告</a>, <time class="dt-updated"
                datetime="2025-01-08">2025年1月8日</time></p>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>本版本:
                <dd><a class="u-url"
                        href="https://wicg.github.io/idle-detection/">https://wicg.github.io/idle-detection/</a>
                <dt>问题跟踪:
                <dd><a href="https://github.com/WICG/idle-detection/issues/">GitHub</a>
                <dt class="editor">编辑:
                <dd class="editor p-author h-card vcard" data-editor-id="83788"><a class="p-name fn u-email email"
                        href="mailto:reillyg@google.com">Reilly Grant</a> (<a class="p-org org"
                        href="https://www.google.com">Google LLC</a>)
                <dt>测试套件:
                <dd class="wpt-overview"><a
                        href="https://wpt.fyi/results/idle-detection/">https://wpt.fyi/results/idle-detection/</a>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2025 the Contributors to the Idle Detection API Specification, published by the <a
                href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a
                href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement
                (CLA)</a>.
            A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本文档定义了用于观察系统范围内用户在场信号的 Web 平台 API。</p>
    </div>
    <div data-fill-with="at-risk"></div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文档状态</span>
    </h2>
    <div data-fill-with="status">
        <p> 本规范由 <a href="https://www.w3.org/community/wicg/">Web 平台孵化社区组</a> 发布。
            它不是 W3C 标准，也不在 W3C 标准进程中。

            请注意，根据 <a href="https://www.w3.org/community/about/agreements/cla/">W3C 社区贡献者许可协议
                (CLA)</a>，有有限的选择退出权利，并适用其他条件。

            了解更多关于 <a href="http://www.w3.org/community/">W3C 社区和业务组</a> 的信息。 </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#introduction"><span class="secno">1</span> <span class="content">介绍</span></a>
                <ol class="toc">
                    <li><a href="#alternatives-considered"><span class="secno">1.1</span> <span
                                class="content">备选方案考虑</span></a>
                </ol>
            <li>
                <a href="#api"><span class="secno">2</span> <span class="content">用户在场状态观察</span></a>
                <ol class="toc">
                    <li>
                        <a href="#api-model"><span class="secno">2.1</span> <span class="content">模型</span></a>
                        <ol class="toc">
                            <li><a href="#api-useridlestate"><span class="secno">2.1.1</span> <span class="content">
                                        <code class="idl"><span>UserIdleState</span></code> 枚举</span></a>
                            <li><a href="#api-screenidlestate"><span class="secno">2.1.2</span> <span
                                        class="content"><code class="idl"><span>ScreenIdleState</span></code>
                                        枚举</span></a>
                        </ol>
                    <li><a href="#api-permissions"><span class="secno">2.2</span> <span class="content">权限</span></a>
                    <li><a href="#api-permissions-policy"><span class="secno">2.3</span> <span
                                class="content">权限策略</span></a>
                    <li>
                        <a href="#api-idledetector"><span class="secno">2.4</span> <span class="content"><code
                                    class="idl"><span>IdleDetector</span></code> 接口</span></a>
                        <ol class="toc">
                            <li><a href="#api-idledetector-userstate"><span class="secno">2.4.1</span> <span
                                        class="content"><code class="idl"><span>userState</span></code>
                                        属性</span></a>
                            <li><a href="#api-idledetector-screenstate"><span class="secno">2.4.2</span> <span
                                        class="content"><code class="idl"><span>screenState</span></code>
                                        属性</span></a>
                            <li><a href="#api-idledetector-onchange"><span class="secno">2.4.3</span> <span
                                        class="content"><code class="idl"><span>onchange</span></code>
                                        属性</span></a>
                            <li><a href="#api-idledetector-requestpermission"><span class="secno">2.4.4</span> <span
                                        class="content"><code class="idl"><span>requestPermission()</span></code>
                                        方法</span></a>
                            <li><a href="#api-idledetector-start"><span class="secno">2.4.5</span> <span
                                        class="content"><code class="idl"><span>start()</span></code> 方法</span></a>
                            <li><a href="#state-changes"><span class="secno">2.4.6</span> <span class="content">响应
                                        状态变化</span></a>
                        </ol>
                </ol>
            <li>
                <a href="#security-and-privacy"><span class="secno">3</span> <span class="content">安全与隐私注意事项</span></a>
                <ol class="toc">
                    <li><a href="#privacy-cross-origin-leakage"><span class="secno">3.1</span> <span
                                class="content">跨源信息泄露</span></a>
                    <li><a href="#privacy-behavior-tracking"><span class="secno">3.2</span> <span
                                class="content">行为跟踪</span></a>
                    <li><a href="#privacy-user-coercion"><span class="secno">3.3</span> <span
                                class="content">用户强制授权</span></a>
                </ol>
            <li><a href="#accessibility"><span class="secno">4</span> <span class="content">可访问性注意事项</span></a>
            <li><a href="#internationalization"><span class="secno">5</span> <span class="content">国际化注意事项</span></a>
            <li><a href="#acknowledgements"><span class="secno">6</span> <span class="content">致谢</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档
                                约定</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">本规范
                                定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">引用
                                定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性
                                参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考性
                                参考文献</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span
                class="content">介绍</span><a class="self-link" href="#introduction"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>利用现有的能力，页面能够判断当前是否对用户可见（通过 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" id="ref-for-dom-document-hidden">hidden</a></code>
            属性和 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange" id="ref-for-dom-document-onvisibilitychange">onvisibilitychange</a></code>
            事件）。还可以通过监听 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove" id="ref-for-handler-onmousemove">onmousemove</a></code>、
            <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress" id="ref-for-handler-onkeypress">onkeypress</a></code>
            以及其他用户输入触发的事件来了解用户最近是否与页面进行了交互。虽然这些事件可以充分反映用户对某个页面的参与，但它们并不能完整地反映用户是否仍然在设备旁。例如，如果 <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" id="ref-for-dom-document-hidden①">hidden</a></code>
            为 <code>true</code>，那么设备的屏幕保护程序可能已激活，或者用户可能切换到了其他应用。如果为
            <code>false</code>，但最近没有输入事件，则用户可能离开了电脑去喝咖啡，或者在页面旁边的另一个窗口编辑文档。
        </p>
        <p>区分这些情况对于能够在多设备（如桌面和智能手机）上推送通知的应用很重要。如果通知发到了错误的设备或造成干扰，用户会感到沮丧。例如，如果用户从包含消息应用的标签页切换到文档编辑页面，消息应用由于无法观察到用户仍在使用设备，可能会认为用户离开了去喝咖啡，于是开始向手机推送通知，导致手机震动分散注意力，而不是在桌面显示通知或递增徽章数。
        </p>
        <h3 class="heading settled" data-level="1.1" id="alternatives-considered"><span class="secno">1.1. </span><span
                class="content">备选方案考虑</span><a class="self-link" href="#alternatives-considered"></a>
        </h3>
        <p>一种替代方案是通过允许通知被标记为“在活跃时隐藏”或“在空闲时隐藏”，并不允许页面观察通知实际是否显示来保护这些信息。但这种方法的问题在于，前述智能通知路由需要观察用户在场信号，并基于用户所有设备的状态做集中决策。
        </p>
        <p>例如，当消息应用检测到自己不再可见时，可以在用户离开去喝咖啡时将通知路由到用户的移动设备，同时将桌面通知标记为“在活跃时隐藏”。如果用户其实还在桌前，只是使用了其他应用，那么他们就会收到移动设备上那些令人分心的通知，本提案试图避免这种情况，无论桌面是否成功屏蔽这些通知。成功屏蔽重复和干扰性通知需要多设备协同。
        </p>
        <p>允许通知被隐藏还会破坏实现者对 <a data-link-type="biblio" href="#biblio-push-api" title="Push API">[PUSH-API]</a>
            用于静默后台任务的防范措施。</p>
        <h2 class="heading settled" data-level="2" id="api"><span class="secno">2. </span><span
                class="content">用户在场状态观察</span><a class="self-link" href="#api"></a></h2>
        <h3 class="heading settled" data-level="2.1" id="api-model"><span class="secno">2.1. </span><span
                class="content">模型</span><a class="self-link" href="#api-model"></a></h3>
        <p>本规范从两个维度定义用户在场模型：空闲状态和屏幕锁定。</p>
        <h4 class="heading settled" data-level="2.1.1" id="api-useridlestate"><span class="secno">2.1.1. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#enumdef-useridlestate" id="ref-for-enumdef-useridlestate">UserIdleState</a></code>
                枚举</span><a class="self-link" href="#api-useridlestate"></a></h4>
        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-useridlestate"><code><c- g>UserIdleState</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="UserIdleState" data-dfn-type="enum-value" data-export id="dom-useridlestate-active"><code><c- s>"active"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="UserIdleState" data-dfn-type="enum-value" data-export id="dom-useridlestate-idle"><code><c- s>"idle"</c-></code></dfn>
};
</pre>
        <dl>
            <dt data-md><code
                    class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active">"active"</a></code>
            <dd data-md>
                <p>表示用户在最近 <code
                        class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold">threshold</a></code>
                    毫秒内有与设备交互。</p>
            <dt data-md><code
                    class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle">"idle"</a></code>
            <dd data-md>
                <p>表示用户至少在 <code
                        class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold①">threshold</a></code>
                    毫秒内未与设备交互。</p>
        </dl>
        <h4 class="heading settled" data-level="2.1.2" id="api-screenidlestate"><span class="secno">2.1.2. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#enumdef-screenidlestate" id="ref-for-enumdef-screenidlestate">ScreenIdleState</a></code>
                枚举</span><a class="self-link" href="#api-screenidlestate"></a></h4>
        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-screenidlestate"><code><c- g>ScreenIdleState</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="ScreenIdleState" data-dfn-type="enum-value" data-export id="dom-screenidlestate-locked"><code><c- s>"locked"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="ScreenIdleState" data-dfn-type="enum-value" data-export id="dom-screenidlestate-unlocked"><code><c- s>"unlocked"</c-></code></dfn>
};
</pre>
        <dl>
            <dt data-md><code
                    class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked">"locked"</a></code>
            <dd data-md>
                <p>表示设备已开启屏幕保护或锁屏，内容无法被看到或交互。</p>
            <dt data-md><code
                    class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked">"unlocked"</a></code>
            <dd data-md>
                <p>表示设备可以显示内容并能进行交互。</p>
        </dl>
        <h3 class="heading settled" data-level="2.2" id="api-permissions"><span class="secno">2.2. </span><span
                class="content">权限</span><a class="self-link" href="#api-permissions"></a></h3>
        <p><dfn class="dfn-paneled idl-code" data-dfn-type="permission" data-export
                id="permissiondef-idle-detection"><code>"idle-detection"</code></dfn> 权限是 <a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-default-powerful-feature"
                id="ref-for-dfn-default-powerful-feature">默认强大功能</a>。</p>
        <h3 class="heading settled" data-level="2.3" id="api-permissions-policy"><span class="secno">2.3. </span><span
                class="content">权限策略</span><a class="self-link" href="#api-permissions-policy"></a></h3>
        <p>本规范定义了由字符串 <code>"idle-detection"</code> 标识的 <a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"
                id="ref-for-policy-controlled-feature">策略控制功能</a>。其 <a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"
                id="ref-for-policy-controlled-feature-default-allowlist">默认允许列表</a>为 <code>'self'</code>。
        </p>
        <div class="note" role="note">
            <code>'self'</code> 作为 <a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"
                id="ref-for-policy-controlled-feature-default-allowlist①">默认允许列表</a>
            允许同源嵌套框架默认使用此功能，但阻止第三方内容访问。
            <p>可以通过在 <code>iframe</code> 元素上添加 <code>allow="idle-detection"</code> 属性来有选择地启用第三方使用：</p>
            <div class="example" id="example-45553a3a">
                <a class="self-link" href="#example-45553a3a"></a>
                <pre class="language-html highlight"><c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.com"</c-> <c- e>allow</c-><c- o>=</c-><c- s>"idle-detection"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
</pre>
            </div>
            <p>也可以通过在 HTTP 响应头中指定权限策略，完全禁止第一方上下文使用此功能：</p>
            <div class="example" id="example-9e9c9d17">
                <a class="self-link" href="#example-9e9c9d17"></a>
                <pre class="language-http highlight">Permissions-Policy: idle-detection 'none'
</pre>
            </div>
            <p>更多详情参见 <a data-link-type="biblio" href="#biblio-permissions-policy"
                    title="Permissions Policy">[PERMISSIONS-POLICY]</a>。</p>
        </div>
        <h3 class="heading settled" data-level="2.4" id="api-idledetector"><span class="secno">2.4. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector">IdleDetector</a></code>
                接口</span><a class="self-link" href="#api-idledetector"></a></h3>
        <pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-idleoptions"><code><c- g>IdleOptions</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IdleOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long" id="dom-idleoptions-threshold"><code><c- g>threshold</c-></code></dfn>;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IdleOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal" id="dom-idleoptions-signal"><code><c- g>signal</c-></code></dfn>;
};

[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>,
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)
] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="idledetector"><code><c- g>IdleDetector</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="constructor" data-export data-lt="IdleDetector()|constructor()" id="dom-idledetector-idledetector"><code><c- g>constructor</c-></code></dfn>();
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-useridlestate" id="ref-for-enumdef-useridlestate①"><c- n>UserIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="UserIdleState?" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate"><c- g>userState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-screenidlestate" id="ref-for-enumdef-screenidlestate①"><c- n>ScreenIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="ScreenIdleState?" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate"><c- g>screenState</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-idledetector-onchange" id="ref-for-dom-idledetector-onchange"><c- g>onchange</c-></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->] <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/permissions/#dom-permissionstate" id="ref-for-dom-permissionstate"><c- n>PermissionState</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-requestpermission" id="ref-for-dom-idledetector-requestpermission"><c- g>requestPermission</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start"><c- g>start</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-idleoptions" id="ref-for-dictdef-idleoptions"><c- n>IdleOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector/start(options), IdleDetector/start()" data-dfn-type="argument" data-export id="dom-idledetector-start-options-options"><code><c- g>options</c-></code></dfn> = {});
};
</pre>
        <p><code
                class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector①">IdleDetector</a></code>
            的实例通过下表描述的 <a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots"
                id="ref-for-sec-object-internal-methods-and-internal-slots">内部槽</a>创建：</p>
        <table>
            <tbody>
                <tr>
                    <th><a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots"
                            id="ref-for-sec-object-internal-methods-and-internal-slots①">内部槽</a>
                    <th>初始值
                    <th>说明（非规范性）
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute"
                            data-export id="dom-idledetector-state-slot"><code>[[state]]</code></dfn>
                    <td><code>"stopped"</code>
                    <td>跟踪 <code
                            class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector②">IdleDetector</a></code>
                        的激活状态
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute"
                            data-export id="dom-idledetector-threshold-slot"><code>[[threshold]]</code></dfn>
                    <td><code>undefined</code>
                    <td>已配置的空闲检测阈值
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute"
                            data-export id="dom-idledetector-userstate-slot"><code>[[userState]]</code></dfn>
                    <td><code>null</code>
                    <td>最近一次已知用户空闲状态
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute"
                            data-export id="dom-idledetector-screenstate-slot"><code>[[screenState]]</code></dfn>
                    <td><code>null</code>
                    <td>最近一次已知屏幕空闲状态
        </table>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>测试</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/idle-detection/idlharness-worker.https.window.js"
                        title="idle-detection/idlharness-worker.https.window.js">idlharness-worker.https.window.js</a>
                    <a class="wpt-live"
                        href="https://wpt.live/idle-detection/idlharness-worker.https.window.js"><small>（在线测试）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idlharness-worker.https.window.js"><small>（源码）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/idle-detection/idlharness.https.window.js"
                        title="idle-detection/idlharness.https.window.js">idlharness.https.window.js</a> <a
                        class="wpt-live"
                        href="https://wpt.live/idle-detection/idlharness.https.window.js"><small>（在线测试）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idlharness.https.window.js"><small>（源码）</small></a>
            </ul>
        </details>
        <p>该接口上的方法通常是异步完成的，会将任务排入 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="idle-detection-task-source">idle detection task source</dfn> 队列。</p>
        <h4 class="heading settled" data-level="2.4.1" id="api-idledetector-userstate"><span class="secno">2.4.1.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate①">userState</a></code>
                属性</span><a class="self-link" href="#api-idledetector-userstate"></a></h4>
        <div class="algorithm" data-algorithm="userState" data-algorithm-for="IdleDetector">
            <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export
                id="dom-idledetector-userstate"><code>userState</code></dfn> 获取步骤如下：
            <ol>
                <li data-md>
                    <p>返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this">this</a>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot">[[userState]]</a></code>。
                    </p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="2.4.2" id="api-idledetector-screenstate"><span class="secno">2.4.2.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate①">screenState</a></code>
                属性</span><a class="self-link" href="#api-idledetector-screenstate"></a></h4>
        <div class="algorithm" data-algorithm="screenState" data-algorithm-for="IdleDetector">
            <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export
                id="dom-idledetector-screenstate"><code>screenState</code></dfn> 获取步骤如下：
            <ol>
                <li data-md>
                    <p>返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①">this</a>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot">[[screenState]]</a></code>。
                    </p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="2.4.3" id="api-idledetector-onchange"><span class="secno">2.4.3.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-onchange" id="ref-for-dom-idledetector-onchange①">onchange</a></code>
                属性</span><a class="self-link" href="#api-idledetector-onchange"></a></h4>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export
                id="dom-idledetector-onchange"><code>onchange</code></dfn> 是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"
                id="ref-for-event-handler-idl-attributes">事件处理程序 IDL
                属性</a>，用于 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change">change</a></code>
            事件类型。</p>
        <h4 class="heading settled" data-level="2.4.4" id="api-idledetector-requestpermission"><span
                class="secno">2.4.4. </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-requestpermission" id="ref-for-dom-idledetector-requestpermission①">requestPermission()</a></code>
                方法</span><a class="self-link" href="#api-idledetector-requestpermission"></a></h4>
        <div class="algorithm" data-algorithm="requestPermission()" data-algorithm-for="IdleDetector">
            <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="method" data-export
                id="dom-idledetector-requestpermission"><code>requestPermission()</code></dfn> 方法步骤如下：
            <ol>
                <li data-md>
                    <p>如果 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this②">this</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global">相关全局对象</a>的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window">关联文档</a>不是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active">完全激活</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with">一个被拒绝的 promise</a>，异常为
                        "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>。
                    </p>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-detached-frame.https.html"
                                    title="idle-detection/idle-detection-detached-frame.https.html">idle-detection-detached-frame.https.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-detached-frame.https.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-detached-frame.https.html"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p>如果 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global①">相关全局对象</a>没有 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation"
                            id="ref-for-transient-activation">瞬时激活</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with①">一个被拒绝的 promise</a>，异常为 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>令 <var>result</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">一个新的
                            promise</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel">并行</a>执行：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>permissionState</var> 为 <a data-link-type="dfn"
                                    href="https://w3c.github.io/permissions/#dfn-request-permission-to-use"
                                    id="ref-for-dfn-request-permission-to-use">请求使用权限</a> <a class="idl-code"
                                    data-link-type="permission" href="#permissiondef-idle-detection"
                                    id="ref-for-permissiondef-idle-detection">"idle-detection"</a> 的结果。</p>
                        <li data-md>
                            <p><a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                                    id="ref-for-queue-a-global-task">在</a> <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                                    id="ref-for-concept-relevant-global②">相关全局对象</a>上使用 <a data-link-type="dfn"
                                    href="#idle-detection-task-source" id="ref-for-idle-detection-task-source">idle
                                    detection task source</a>
                                将 <var>result</var> 以 <var>permissionState</var> 进行 resolve。
                            </p>
                    </ol>
                <li data-md>
                    <p>返回 <var>result</var>。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="2.4.5" id="api-idledetector-start"><span class="secno">2.4.5.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start①">start()</a></code>
                方法</span><a class="self-link" href="#api-idledetector-start"></a></h4>
        <div class="algorithm" data-algorithm="start(options)" data-algorithm-for="IdleDetector">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="method" data-export
                    data-lt="start(options)|start()"
                    id="dom-idledetector-start"><code>start(<var>options</var>)</code></dfn> 方法的步骤如下：</p>
            <ol>
                <li data-md>
                    <p>令 <var>document</var> 为 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this⑤">this</a> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global③">相关全局对象</a>的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window①">关联
                            Document</a>。</p>
                <li data-md>
                    <p>如果 <var>document</var> 不是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active①">完全激活</a>，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with②">一个被拒绝的 promise</a>，异常为
                        "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>。
                    </p>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-detached-frame.https.html"
                                    title="idle-detection/idle-detection-detached-frame.https.html">idle-detection-detached-frame.https.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-detached-frame.https.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-detached-frame.https.html"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p>如果 <var>document</var> 没有 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use"
                            id="ref-for-allowed-to-use">允许使用</a> <a class="idl-code" data-link-type="permission"
                            href="#permissiondef-idle-detection"
                            id="ref-for-permissiondef-idle-detection①">"idle-detection"</a>，
                        则返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with③">一个被拒绝的 promise</a>，异常为 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>。
                    </p>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-permissions-policy-attribute-redirect-on-load.https.sub.html"
                                    title="idle-detection/idle-detection-allowed-by-permissions-policy-attribute-redirect-on-load.https.sub.html">idle-detection-allowed-by-permissions-policy-attribute-redirect-on-load.https.sub.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-allowed-by-permissions-policy-attribute-redirect-on-load.https.sub.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-permissions-policy-attribute-redirect-on-load.https.sub.html"><small>（源码）</small></a>
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-permissions-policy-attribute.https.sub.html"
                                    title="idle-detection/idle-detection-allowed-by-permissions-policy-attribute.https.sub.html">idle-detection-allowed-by-permissions-policy-attribute.https.sub.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-allowed-by-permissions-policy-attribute.https.sub.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-permissions-policy-attribute.https.sub.html"><small>（源码）</small></a>
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-permissions-policy.https.sub.html"
                                    title="idle-detection/idle-detection-allowed-by-permissions-policy.https.sub.html">idle-detection-allowed-by-permissions-policy.https.sub.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-allowed-by-permissions-policy.https.sub.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-permissions-policy.https.sub.html"><small>（源码）</small></a>
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-default-permissions-policy.https.sub.html"
                                    title="idle-detection/idle-detection-default-permissions-policy.https.sub.html">idle-detection-default-permissions-policy.https.sub.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-default-permissions-policy.https.sub.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-default-permissions-policy.https.sub.html"><small>（源码）</small></a>
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/idle-detection-disabled-by-permissions-policy.https.sub.html"
                                    title="idle-detection/idle-detection-disabled-by-permissions-policy.https.sub.html">idle-detection-disabled-by-permissions-policy.https.sub.html</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/idle-detection-disabled-by-permissions-policy.https.sub.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-disabled-by-permissions-policy.https.sub.html"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p>如果 <var>this</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot">[[state]]</a></code>
                        不是 <code>"stopped"</code>，
                        则返回 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with④">一个被拒绝的 promise</a>，异常为 "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>。
                    </p>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/interceptor.https.html"
                                    title="idle-detection/interceptor.https.html">interceptor.https.html</a> <a
                                    class="wpt-live"
                                    href="https://wpt.live/idle-detection/interceptor.https.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p>设置 <var>this</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot①">[[state]]</a></code>
                        为 <code>"starting"</code>。</p>
                <li data-md>
                    <p>如果 <var>options</var>[<code
                            class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold②">"threshold"</a></code>]
                        小于 60,000，则返回 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑤">一个被拒绝的 promise</a>，异常为 <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>。
                    </p>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/basics.tentative.https.window.js"
                                    title="idle-detection/basics.tentative.https.window.js">basics.tentative.https.window.js</a>
                                <a class="wpt-live"
                                    href="https://wpt.live/idle-detection/basics.tentative.https.window.js"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/basics.tentative.https.window.js"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p>令 <var>result</var> 为 <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">一个新的
                            promise</a>。</p>
                <li data-md>
                    <p>如果 <var>options</var>["<code
                            class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal">signal</a></code>"]
                        存在，则执行以下子步骤：</p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>options</var>["<code
                                    class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal①">signal</a></code>"]
                                已 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                                    id="ref-for-abortsignal-aborted">中止</a>，则 <a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">拒绝</a>
                                <var>result</var>，原因为 <var>options</var>["<code
                                    class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal②">signal</a></code>"]
                                的
                                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                                    id="ref-for-abortsignal-abort-reason">中止原因</a>，并返回 <var>result</var>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add"
                                    id="ref-for-abortsignal-add">为</a>
                                <var>options</var>["<code
                                    class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal③">signal</a></code>"]
                                添加以下中止步骤：
                            </p>
                            <ol>
                                <li data-md>
                                    <p>设置 <var>this</var>.<code
                                            class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot②">[[state]]</a></code>
                                        为 <code>"stopped"</code>。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                                            id="ref-for-reject①">拒绝</a> <var>result</var>，原因为
                                        <var>options</var>["<code
                                            class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal④">signal</a></code>"]
                                        的
                                        <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                                            id="ref-for-abortsignal-abort-reason①">中止原因</a>。
                                    </p>
                            </ol>
                    </ol>
                    <details class="wpt-tests-block" dir="ltr" lang="en" open>
                        <summary>测试</summary>
                        <ul class="wpt-tests-list">
                            <li class="wpt-test"><a class="wpt-name"
                                    href="https://wpt.fyi/results/idle-detection/interceptor.https.html"
                                    title="idle-detection/interceptor.https.html">interceptor.https.html</a> <a
                                    class="wpt-live"
                                    href="https://wpt.live/idle-detection/interceptor.https.html"><small>（在线测试）</small></a>
                                <a class="wpt-source"
                                    href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>（源码）</small></a>
                        </ul>
                    </details>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel①">并行</a>执行：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>permissionState</var> 为 <a data-link-type="dfn"
                                    href="https://w3c.github.io/permissions/#dfn-permission-state"
                                    id="ref-for-dfn-permission-state">权限状态</a>
                                <code>"idle-detection"</code>。
                            </p>
                            <details class="wpt-tests-block" dir="ltr" lang="en" open>
                                <summary>测试</summary>
                                <ul class="wpt-tests-list">
                                    <li class="wpt-test"><a class="wpt-name"
                                            href="https://wpt.fyi/results/idle-detection/idle-permission.tentative.https.window.js"
                                            title="idle-detection/idle-permission.tentative.https.window.js">idle-permission.tentative.https.window.js</a>
                                        <a class="wpt-live"
                                            href="https://wpt.live/idle-detection/idle-permission.tentative.https.window.js"><small>（在线测试）</small></a>
                                        <a class="wpt-source"
                                            href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-permission.tentative.https.window.js"><small>（源码）</small></a>
                                </ul>
                            </details>
                        <li data-md>
                            <p><a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                                    id="ref-for-queue-a-global-task①">在</a> <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                                    id="ref-for-concept-relevant-global④">相关全局对象</a>（<a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>）上使用 <a
                                    data-link-type="dfn" href="#idle-detection-task-source"
                                    id="ref-for-idle-detection-task-source①">idle
                                    detection task source</a> 执行以下步骤：</p>
                            <ol>
                                <li data-md>
                                    <p>如果 <var>permissionState</var> 为 <code>"denied"</code>，</p>
                                    <ol>
                                        <li data-md>
                                            <p>设置 <var>this</var>.<code
                                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot③">[[state]]</a></code>
                                                为 <code>"stopped"</code>。</p>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                                                    id="ref-for-reject②">拒绝</a> <var>result</var>，异常为 "<code
                                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror②">NotAllowedError</a></code>"
                                                <code
                                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>。
                                            </p>
                                    </ol>
                                <li data-md>
                                    <p>否则，</p>
                                    <ol>
                                        <li data-md>
                                            <p>如果 <var>this</var>.<code
                                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot④">[[state]]</a></code>
                                                为 <code>"stopped"</code>，则终止这些步骤。</p>
                                        <li data-md>
                                            <p>设置 <var>this</var>.<code
                                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot⑤">[[state]]</a></code>
                                                为 <code>"started"</code>。</p>
                                        <li data-md>
                                            <p>设置 <var>this</var>.<code
                                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-threshold-slot" id="ref-for-dom-idledetector-threshold-slot">[[threshold]]</a></code>
                                                为 <var>options</var>["<code
                                                    class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold③">threshold</a></code>"]。
                                            </p>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                                    id="ref-for-resolve①">解决</a> <var>result</var>。</p>
                                    </ol>
                            </ol>
                    </ol>
                <li data-md>
                    <p>返回 <var>result</var>。</p>
            </ol>
            <p class="note" role="note"><span class="marker">注意：</span> 上述步骤是<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                    id="ref-for-in-parallel②">并行</a>执行的，以便实现异步检查权限状态。</p>
        </div>
        <div class="example" id="example-eaf26322">
            <a class="self-link" href="#example-eaf26322"></a>
            <p>可以通过在 <code
                    class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector③">IdleDetector</a></code>
                构造函数是否存在于 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>
                对象上来检测此 API 是否可用。</p>
            <pre class="language-js highlight"><c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- p>(</c-><c- t>'IdleDetector'</c-> <c- ow>in</c-> window<c- p>))</c-> <c- p>{</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'Idle detection is not available.'</c-><c- p>);</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
            <p>如果 <a class="idl-code" data-link-type="permission" href="#permissiondef-idle-detection"
                    id="ref-for-permissiondef-idle-detection②">"idle-detection"</a> 权限
                未被 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                    id="ref-for-dfn-granted">授予</a>，则调用 <code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start②">start()</a></code>
                会失败。</p>
            <pre class="language-js highlight"><c- k>if</c-> <c- p>((</c-><c- k>await</c-> IdleDetector<c- p>.</c->requestPermission<c- p>())</c-> <c- o>!==</c-> <c- t>'granted'</c-><c- p>)</c-> <c- p>{</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'Idle detection permission not granted.'</c-><c- p>);</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
            <p>可以配置一组选项，用于控制 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent"
                    id="ref-for-user-agent">用户代理</a>
                判断用户何时变为空闲的阈值。</p>
            <pre class="language-js highlight"><c- a>const</c-> controller <c- o>=</c-> <c- ow>new</c-> AbortController<c- p>();</c->
<c- a>const</c-> signal <c- o>=</c-> controller<c- p>.</c->signal<c- p>;</c->

<c- a>const</c-> options <c- o>=</c-> <c- p>{</c->
  threshold<c- o>:</c-> <c- mf>60</c->_000<c- p>,</c->
  signal<c- p>,</c->
<c- p>};</c->
</pre>
            <p>现在可以创建并启动 <code
                    class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector④">IdleDetector</a></code>。添加
                <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change①">"change"</a></code>
                事件的监听器。当 <code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate②">userState</a></code>
                或 <code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate②">screenState</a></code>
                属性发生变化时将会触发。
            </p>
            <pre class="language-js highlight"><c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> idleDetector <c- o>=</c-> <c- ow>new</c-> IdleDetector<c- p>();</c->
  idleDetector<c- p>.</c->addEventListener<c- p>(</c-><c- t>'change'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    console<c- p>.</c->log<c- p>(</c-><c- sb>`Idle change: </c-><c- si>${</c->idleDetector<c- p>.</c->userState<c- si>}</c-><c- sb>, </c-><c- si>${</c->idleDetector<c- p>.</c->screenState<c- si>}</c-><c- sb>.`</c-><c- p>);</c->
  <c- p>});</c->
  <c- k>await</c-> idleDetector<c- p>.</c->start<c- p>(</c->options<c- p>);</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'IdleDetector is active.'</c-><c- p>);</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
  <c- c1>// 处理初始化错误，如权限被拒绝、</c->
  <c- c1>// 在顶层框架之外运行等。</c->
  console<c- p>.</c->error<c- p>(</c->err<c- p>.</c->name<c- p>,</c-> err<c- p>.</c->message<c- p>);</c->
<c- p>}</c->
</pre>
            <p>页面之后可以通过移除事件监听器或使用传给 <code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code>
                的 <code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start③">start()</a></code>
                方法取消对状态变化事件的关注。
            </p>
            <pre class="language-js highlight">controller<c- p>.</c->abort<c- p>();</c->
console<c- p>.</c->log<c- p>(</c-><c- t>'IdleDetector is stopped.'</c-><c- p>);</c->
</pre>
        </div>
        <h4 class="heading settled" data-level="2.4.6" id="state-changes"><span class="secno">2.4.6. </span><span
                class="content">响应状态变化</span><a class="self-link" href="#state-changes"></a></h4>
        <div class="algorithm" data-algorithm="state changes">
            <p>对于每个 <code
                    class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector⑤">IdleDetector</a></code>
                实例 <var>detector</var>，当 <var>detector</var>.<code
                    class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot⑥">[[state]]</a></code>
                为 <code>"started"</code> 时，<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent"
                    id="ref-for-user-agent①">用户代理</a>必须持续监控如下条件：</p>
            <ul>
                <li data-md>
                    <p>如果 <var>detector</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot①">[[userState]]</a></code>
                        为 <code
                            class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active①">"active"</a></code>
                        且用户在最近 <var>detector</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-threshold-slot" id="ref-for-dom-idledetector-threshold-slot①">[[threshold]]</a></code>
                        毫秒内没有与设备交互，则必须在 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                            id="ref-for-queue-a-global-task②">相关全局对象</a>（<var>detector</var>）上使用 <a data-link-type="dfn"
                            href="#idle-detection-task-source" id="ref-for-idle-detection-task-source②">idle detection
                            task source</a> 执行如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>设置 <var>detector</var>.<code
                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot②">[[userState]]</a></code>
                                为 <code
                                    class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle①">"idle"</a></code>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                                    id="ref-for-concept-event-fire">触发事件</a>，名称为 <code
                                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change②">"change"</a></code>
                                ，目标为 <var>detector</var>。</p>
                    </ol>
                <li data-md>
                    <p>如果 <var>detector</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot③">[[userState]]</a></code>
                        为 <code
                            class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle②">"idle"</a></code>
                        且用户与设备交互，则必须在 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                            id="ref-for-queue-a-global-task③">相关全局对象</a>（<var>detector</var>）上使用 <a data-link-type="dfn"
                            href="#idle-detection-task-source" id="ref-for-idle-detection-task-source③">idle detection
                            task source</a> 执行如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>设置 <var>detector</var>.<code
                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot④">[[userState]]</a></code>
                                为 <code
                                    class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active②">"active"</a></code>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                                    id="ref-for-concept-event-fire①">触发事件</a>，名称为 <code
                                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change③">"change"</a></code>
                                ，目标为 <var>detector</var>。</p>
                    </ol>
                <li data-md>
                    <p>如果 <var>detector</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot①">[[screenState]]</a></code>
                        为 <code
                            class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked①">"unlocked"</a></code>
                        且屏幕被锁定，则必须在 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                            id="ref-for-queue-a-global-task④">相关全局对象</a>（<var>detector</var>）上使用 <a data-link-type="dfn"
                            href="#idle-detection-task-source" id="ref-for-idle-detection-task-source④">idle detection
                            task source</a> 执行如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>设置 <var>detector</var>.<code
                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot②">[[screenState]]</a></code>
                                为 <code
                                    class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked①">"locked"</a></code>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                                    id="ref-for-concept-event-fire②">触发事件</a>，名称为 <code
                                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change④">"change"</a></code>
                                ，目标为 <var>detector</var>。</p>
                    </ol>
                <li data-md>
                    <p>如果 <var>detector</var>.<code
                            class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot③">[[screenState]]</a></code>
                        为 <code
                            class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked②">"locked"</a></code>
                        且屏幕被解锁，则必须在 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                            id="ref-for-queue-a-global-task⑤">相关全局对象</a>（<var>detector</var>）上使用 <a data-link-type="dfn"
                            href="#idle-detection-task-source" id="ref-for-idle-detection-task-source⑤">idle detection
                            task source</a> 执行如下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>设置 <var>detector</var>.<code
                                    class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot④">[[screenState]]</a></code>
                                为 <code
                                    class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked②">"unlocked"</a></code>。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                                    id="ref-for-concept-event-fire③">触发事件</a>，名称为 <code
                                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change⑤">"change"</a></code>
                                ，目标为 <var>detector</var>。</p>
                    </ol>
            </ul>
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>测试</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/idle-detection/interceptor.https.html"
                        title="idle-detection/interceptor.https.html">interceptor.https.html</a> <a class="wpt-live"
                        href="https://wpt.live/idle-detection/interceptor.https.html"><small>（在线测试）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>（源码）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/idle-detection/page-visibility.https.html"
                        title="idle-detection/page-visibility.https.html">page-visibility.https.html</a> <a
                        class="wpt-live"
                        href="https://wpt.live/idle-detection/page-visibility.https.html"><small>（在线测试）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/page-visibility.https.html"><small>（源码）</small></a>
            </ul>
        </details>
        <h2 class="heading settled" data-level="3" id="security-and-privacy"><span class="secno">3. </span><span
                class="content">安全与隐私注意事项</span><a class="self-link" href="#security-and-privacy"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <h3 class="heading settled" data-level="3.1" id="privacy-cross-origin-leakage"><span class="secno">3.1.
            </span><span class="content">跨域信息泄露</span><a class="self-link" href="#privacy-cross-origin-leakage"></a>
        </h3>
        <p>该接口暴露了全局系统属性的状态，因此必须注意防止其被用作跨域通信或身份识别通道。类似的担忧在 <a data-link-type="biblio" href="#biblio-device-orientation"
                title="Device Orientation and Motion">[DEVICE-ORIENTATION]</a> 和 <a data-link-type="biblio"
                href="#biblio-geolocation" title="Geolocation">[GEOLOCATION]</a>
            等规范中也存在，这些规范通过要求页面处于可见或聚焦上下文来缓解风险。这可以防止多个来源同时观察全局状态。但这些缓解措施在这里并不适用，因为本规范的目的正是允许在模糊和隐藏上下文下进行有限的追踪。一个恶意页面可以在检测到用户空闲或活跃时通知追踪服务器。如果用户访问的多个页面都通知同一个服务器，服务器可以利用事件的时间猜测哪些会话属于同一个用户，因为事件会大致同时到达。
        </p>
        <p>为减少可访问该接口的独立上下文数量，本规范将其限制在顶层和同源上下文。可以通过 <a data-link-type="biblio" href="#biblio-permissions-policy"
                title="Permissions Policy">[PERMISSIONS-POLICY]</a> 委托访问给跨域上下文。</p>
        <p>为了进一步减少上下文数量，本规范要求页面获取 <a class="idl-code" data-link-type="permission" href="#permissiondef-idle-detection"
                id="ref-for-permissiondef-idle-detection③">"idle-detection"</a>
            权限。用户代理应告知用户此权限授予的能力，并鼓励他们只将其授权给有合理用途的可信站点。
        </p>
        <p>实现“隐私浏览”模式的浏览器不应在启用该模式的上下文中允许此能力。但实现时应注意避免通过缺失该能力来判断隐私模式已启用。可以通过拒绝授予 <a class="idl-code"
                data-link-type="permission" href="#permissiondef-idle-detection"
                id="ref-for-permissiondef-idle-detection④">"idle-detection"</a>
            权限，但自动关闭权限请求对话框时延迟一段随机时间，使其看起来像是用户操作，从而实现。
        </p>
        <h3 class="heading settled" data-level="3.2" id="privacy-behavior-tracking"><span class="secno">3.2.
            </span><span class="content">行为跟踪</span><a class="self-link" href="#privacy-behavior-tracking"></a></h3>
        <p>虽然该接口不会提供触发 <code
                class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle③">"idle"</a></code>
            到 <code
                class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active③">"active"</a></code>
            状态转换的具体用户交互细节，但如果阈值设置过短，这些事件仍可以用于检测如打字等行为。因此本规范将请求阈值限制为至少 60 秒。
        </p>
        <p>前述的权限要求也有助于缓解该接口可用于构建用户与设备互动时间画像的普遍担忧。</p>
        <h3 class="heading settled" data-level="3.3" id="privacy-user-coercion"><span class="secno">3.3. </span><span
                class="content">用户强制授权</span><a class="self-link" href="#privacy-user-coercion"></a></h3>
        <p>网站可能要求用户 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                id="ref-for-dfn-granted③">授权</a> <a class="idl-code" data-link-type="permission"
                href="#permissiondef-idle-detection" id="ref-for-permissiondef-idle-detection⑤">"idle-detection"</a> <a
                data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission"
                id="ref-for-dfn-permission">权限</a>才能解锁某些功能。例如，考试网站可能将此权限作为反作弊机制的一部分，检测用户是否在其他窗口查阅了禁止的参考资料。这类“附加合同”现象也出现在通知、FIDO
            认证和 DRM 标识等权限上。
        </p>
        <p>一种潜在的缓解方法是设计接口，使网站无法判断用户是 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                id="ref-for-dfn-granted④">授权</a>还是 <a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-denied"
                id="ref-for-dfn-denied">拒绝</a>该权限。实现可以拒绝确认用户是否空闲，将网站限制为只能获取现有信号。这种缓解手段可能会被检测出来，因为不太可能有用户长时间未与页面互动却仍然与其他内容持续交互。实现还可以插入模拟空闲切换事件，使其符合页面可用的其他信号下的合理行为。
        </p>
        <p>本规范并不强制采用此类缓解措施，因为它可能导致网站根据虚假数据采取行动时产生糟糕的用户体验。例如，之前提到的消息应用可能不会向用户的移动设备推送通知，因为它认为收到的信号表示用户仍在桌面端。由于网站无法检测自己处于这种状态，无法直接建议用户采取行动来摆脱该状态。
        </p>
        <p>此类网站造成的损害有限，因为只有用户访问该页面时才可能被跟踪。跨多个来源的跟踪需要每个参与网站都发起权限请求。</p>
        <h2 class="heading settled" data-level="4" id="accessibility"><span class="secno">4. </span><span
                class="content">可访问性注意事项</span><a class="self-link" href="#accessibility"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>有身体或认知障碍的用户可能需要更多时间与用户代理和内容交互。实现不应允许区分此类用户，也不应比现有 UI 事件观察进一步限制他们与内容的交互能力。例如，应该确保辅助技术的交互也计入用户为活跃状态。
        </p>
        <p>使用权限也要求用户代理提供用于请求和管理该权限的用户界面元素。任何此类界面都必须以无障碍工具为设计考量。例如，描述请求能力的界面应为屏幕阅读器等工具提供相同的说明。
        </p>
        <h2 class="heading settled" data-level="5" id="internationalization"><span class="secno">5. </span><span
                class="content">国际化注意事项</span><a class="self-link" href="#internationalization"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>本规范所述接口的国际化相关内容有限，但使用权限要求用户代理提供界面元素以支持权限请求和管理。用户代理在此场景下展示的任何内容都应翻译为用户的母语。</p>
        <h2 class="heading settled" data-level="6" id="acknowledgements"><span class="secno">6. </span><span
                class="content">致谢</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>特别感谢
            Kenneth Christiansen、
            Samuel Goto、
            Ayu Ishii 以及
            Thomas Steiner
            在本提案制定过程中给予的帮助。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档约定</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求通过描述性断言和 RFC 2119 术语组合表达。
            规范性部分中的关键词 “MUST”、 “MUST NOT”、 “REQUIRED”、 “SHALL”、 “SHALL NOT”、 “SHOULD”、 “SHOULD NOT”、 “RECOMMENDED”、
            “MAY” 和 “OPTIONAL”
            均按照 RFC 2119 的定义解释。
            但为提高可读性，本规范未将这些词全部大写。</p>
        <p>除显示为非规范性内容、示例和注释的章节外，本规范其余内容均为规范性内容。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>本规范中的示例以 “例如” 开头，
            或通过 <code>class="example"</code> 与规范性文本区分，
            如下：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个信息性示例。</p>
        </div>
        <p>信息性注释以 “注意” 开头，
            并通过 <code>class="note"</code> 与规范性文本区分，
            如下：</p>
        <p class="note" role="note">注意，这是一个信息性注释。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>测试</summary>
            <p>与本规范内容相关的测试可能以 “测试” 区块展示，如本例。
                此类区块均为非规范性内容。</p>
            <ul class="wpt-tests-list"></ul>
            <hr>
        </details>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#dom-useridlestate-active">"active"</a><span>, 在 § 2.1.1</span>
        <li><a href="#dom-idledetector-idledetector">constructor()</a><span>, 在 § 2.4</span>
        <li><a href="#dom-useridlestate-idle">"idle"</a><span>, 在 § 2.1.1</span>
        <li><a href="#permissiondef-idle-detection">"idle-detection"</a><span>, 在 § 2.2</span>
        <li><a href="#idle-detection-task-source">idle detection task source</a><span>, 在 § 2.4</span>
        <li><a href="#idledetector">IdleDetector</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idledetector-idledetector">IdleDetector()</a><span>, 在 § 2.4</span>
        <li><a href="#dictdef-idleoptions">IdleOptions</a><span>, 在 § 2.4</span>
        <li><a href="#dom-screenidlestate-locked">"locked"</a><span>, 在 § 2.1.2</span>
        <li><a href="#dom-idledetector-onchange">onchange</a><span>, 在 § 2.4.3</span>
        <li><a href="#dom-idledetector-requestpermission">requestPermission()</a><span>, 在 § 2.4.4</span>
        <li><a href="#enumdef-screenidlestate">ScreenIdleState</a><span>, 在 § 2.1.2</span>
        <li><a href="#dom-idledetector-screenstate-slot">[[screenState]]</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idledetector-screenstate">screenState</a><span>, 在 § 2.4.2</span>
        <li><a href="#dom-idleoptions-signal">signal</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idledetector-start">start()</a><span>, 在 § 2.4.5</span>
        <li><a href="#dom-idledetector-start">start(options)</a><span>, 在 § 2.4.5</span>
        <li><a href="#dom-idledetector-state-slot">[[state]]</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idledetector-threshold-slot">[[threshold]]</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idleoptions-threshold">threshold</a><span>, 在 § 2.4</span>
        <li><a href="#dom-screenidlestate-unlocked">"unlocked"</a><span>, 在 § 2.1.2</span>
        <li><a href="#enumdef-useridlestate">UserIdleState</a><span>, 在 § 2.1.1</span>
        <li><a href="#dom-idledetector-userstate-slot">[[userState]]</a><span>, 在 § 2.4</span>
        <li><a href="#dom-idledetector-userstate">userState</a><span>, 在 § 2.4.1</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="cca3cdb2">AbortSignal</span>
                <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
                <li><span class="dfn-paneled" id="28e64574">abort reason</span>
                <li><span class="dfn-paneled" id="535dd335">aborted</span>
                <li><span class="dfn-paneled" id="87bc23a5">add</span>
                <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ECMASCRIPT]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="c15f1628">internal slot</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FETCH]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="7691dbb6">"iframe"</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
                <li><span class="dfn-paneled" id="5d7209e9">Window</span>
                <li><span class="dfn-paneled" id="3610bd67">allowed to use</span>
                <li><span class="dfn-paneled" id="3349d69f">associated Document</span>
                <li><span class="dfn-paneled" id="2b619939">change</span>
                <li><span class="dfn-paneled" id="03675365">event handler IDL attribute</span>
                <li><span class="dfn-paneled" id="0e3ba9f8">fully active</span>
                <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
                <li><span class="dfn-paneled" id="384a2229">onkeypress</span>
                <li><span class="dfn-paneled" id="541116eb">onmousemove</span>
                <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
                <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
                <li><span class="dfn-paneled" id="47fe679e">transient activation</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PAGE-VISIBILITY-2]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="ac36400f">hidden</span>
                <li><span class="dfn-paneled" id="922b9e73">onvisibilitychange</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="6c3bee60">PermissionState</span>
                <li><span class="dfn-paneled" id="ba1bd741">default powerful feature</span>
                <li><span class="dfn-paneled" id="fb4878d7">denied</span>
                <li><span class="dfn-paneled" id="0d96931f">grant</span>
                <li><span class="dfn-paneled" id="6821ab89">granted</span>
                <li><span class="dfn-paneled" id="3f5a365a">permission</span>
                <li><span class="dfn-paneled" id="d124397f">permission state</span>
                <li><span class="dfn-paneled" id="d357c753">requesting permission to use</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS-POLICY]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
                <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
                <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
                <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
                <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
                <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
                <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
                <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
                <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
                <li><span class="dfn-paneled" id="b262501e">reject</span>
                <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
                <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
                <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性参考文献</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. 现行标准. URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-ecmascript">[ECMASCRIPT]
        <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript 语言规范</cite></a>. URL: <a
                href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren 等. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>. 现行标准. URL:
            <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren, Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    标准</cite></a>. 现行标准. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-page-visibility-2">[PAGE-VISIBILITY-2]
        <dd>Ilya Grigorik, Marcos Caceres. <a href="https://w3c.github.io/page-visibility/"><cite>页面可见性 Level
                    2</cite></a>. URL: <a
                href="https://w3c.github.io/page-visibility/">https://w3c.github.io/page-visibility/</a>
        <dt id="biblio-permissions">[PERMISSIONS]
        <dd>Marcos Caceres, Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>权限</cite></a>. URL:
            <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
        <dt id="biblio-permissions-policy">[PERMISSIONS-POLICY]
        <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>权限策略</cite></a>. URL: <a
                href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>用于表述需求级别的关键字</cite></a>. 1997 年 3
            月. 最佳当前实践. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen, Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. 现行标准. URL: <a
                href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考性参考文献</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-device-orientation">[DEVICE-ORIENTATION]
        <dd>Marcos Caceres, Reilly Grant. <a href="https://w3c.github.io/deviceorientation/"><cite>设备方向与运动</cite></a>.
            URL: <a href="https://w3c.github.io/deviceorientation/">https://w3c.github.io/deviceorientation/</a>
        <dt id="biblio-fetch">[FETCH]
        <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch 标准</cite></a>. 现行标准. URL: <a
                href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
        <dt id="biblio-geolocation">[GEOLOCATION]
        <dd>Marcos Caceres, Reilly Grant. <a href="https://w3c.github.io/geolocation/"><cite>地理定位</cite></a>.
            URL: <a href="https://w3c.github.io/geolocation/">https://w3c.github.io/geolocation/</a>
        <dt id="biblio-push-api">[PUSH-API]
        <dd>Peter Beverloo, Martin Thomson, Marcos Caceres. <a href="https://w3c.github.io/push-api/"><cite>推送
                    API</cite></a>. URL: <a href="https://w3c.github.io/push-api/">https://w3c.github.io/push-api/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-useridlestate"><code><c- g>UserIdleState</c-></code></a> {
    <a href="#dom-useridlestate-active"><code><c- s>"active"</c-></code></a>,
    <a href="#dom-useridlestate-idle"><code><c- s>"idle"</c-></code></a>
};

<c- b>enum</c-> <a href="#enumdef-screenidlestate"><code><c- g>ScreenIdleState</c-></code></a> {
    <a href="#dom-screenidlestate-locked"><code><c- s>"locked"</c-></code></a>,
    <a href="#dom-screenidlestate-unlocked"><code><c- s>"unlocked"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-idleoptions"><code><c- g>IdleOptions</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long" href="#dom-idleoptions-threshold"><code><c- g>threshold</c-></code></a>;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal" href="#dom-idleoptions-signal"><code><c- g>signal</c-></code></a>;
};

[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>,
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)
] <c- b>interface</c-> <a href="#idledetector"><code><c- g>IdleDetector</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  <a href="#dom-idledetector-idledetector"><code><c- g>constructor</c-></code></a>();
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-useridlestate"><c- n>UserIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="UserIdleState?" href="#dom-idledetector-userstate"><c- g>userState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-screenidlestate"><c- n>ScreenIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="ScreenIdleState?" href="#dom-idledetector-screenstate"><c- g>screenState</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-idledetector-onchange"><c- g>onchange</c-></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->] <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/permissions/#dom-permissionstate"><c- n>PermissionState</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-requestpermission"><c- g>requestPermission</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-start"><c- g>start</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-idleoptions"><c- n>IdleOptions</c-></a> <a href="#dom-idledetector-start-options-options"><code><c- g>options</c-></code></a> = {});
};

</pre>
    <details class="mdn-anno unpositioned" data-anno-for="dom-idledetector-idledetector">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/IdleDetector"
                    title="The IdleDetector() constructor creates a new IdleDetector object which provides events indicating when the user is no longer interacting with their device or the screen has locked.">IdleDetector/IdleDetector</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector-onchange">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/change_event"
                    title="The change event of the IdleDetector interface fires when the value of userState or screenState has changed.">IdleDetector/change_event</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector-requestpermission">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/requestPermission_static"
                    title="The requestPermission() static method of the IdleDetector interface returns a Promise that resolves with a string when the user has chosen whether to grant the origin access to their idle state. Resolves with &quot;granted&quot; on acceptance and &quot;denied&quot; on refusal.">IdleDetector/requestPermission_static</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector-screenstate">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/screenState"
                    title="The screenState read-only property of the IdleDetector interface returns a string indicating whether the screen is locked, one of &quot;locked&quot; or &quot;unlocked&quot;.">IdleDetector/screenState</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector-start">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/start"
                    title="The start() method of the IdleDetector interface returns a Promise that resolves when the detector starts listening for changes in the user&apos;s idle state. This method takes an optional options object with the threshold in milliseconds where inactivity should be reported and signal for an AbortSignal to abort the idle detector.">IdleDetector/start</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector-userstate">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector/userState"
                    title="The userState read-only property of the IdleDetector interface returns a string indicating whether the user has interacted with the device since the call to start().">IdleDetector/userState</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-idledetector">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IdleDetector"
                    title="The IdleDetector interface of the Idle Detection API provides methods and events for detecting user activity on a device or screen.">IdleDetector</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="api-permissions-policy">
        <summary><b class="less-than-two-engines-flag"
                title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Permissions-Policy/idle-detection"
                    title="The HTTP Permissions-Policy header idle-detection directive controls whether the current document is allowed to use the Idle Detection API to detect when users are interacting with their devices, for example to report &quot;available&quot;/&quot;away&quot; status in chat applications.">Headers/Permissions-Policy/idle-detection</a>
            </p>
            <p class="less-than-two-engines-text">In only one current engine.</p>
            <div class="support">
                <span class="firefox no"><span>Firefox</span><span>None</span></span><span
                    class="safari no"><span>Safari</span><span>None</span></span><span
                    class="chrome yes"><span>Chrome</span><span>94+</span></span>
                <hr>
                <span class="opera no"><span>Opera</span><span>?</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>94+</span></span>
                <hr>
                <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
            </div>
        </div>
    </details>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "03675365": { "dfnID": "03675365", "dfnText": "event handler IDL attribute", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handler-idl-attributes" }], "title": "2.4.3. onchange attribute" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "0d96931f": { "dfnID": "0d96931f", "dfnText": "grant", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-granted" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-dfn-granted\u2460" }, { "id": "ref-for-dfn-granted\u2461" }], "title": "3.1. Cross-origin information leakage" }, { "refs": [{ "id": "ref-for-dfn-granted\u2462" }, { "id": "ref-for-dfn-granted\u2463" }], "title": "3.3. User coercion" }], "url": "https://w3c.github.io/permissions/#dfn-granted" },
                "0e3ba9f8": { "dfnID": "0e3ba9f8", "dfnText": "fully active", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-fully-active" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-fully-active\u2460" }], "title": "2.4.5. start() method" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active" },
                "1570624a": { "dfnID": "1570624a", "dfnText": "default allowlist", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature-default-allowlist" }, { "id": "ref-for-policy-controlled-feature-default-allowlist\u2460" }], "title": "2.3. Permissions policy" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "28e64574": { "dfnID": "28e64574", "dfnText": "abort reason", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-abort-reason" }, { "id": "ref-for-abortsignal-abort-reason\u2460" }], "title": "2.4.5. start() method" }], "url": "https://dom.spec.whatwg.org/#abortsignal-abort-reason" },
                "2b619939": { "dfnID": "2b619939", "dfnText": "change", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-change" }], "title": "2.4.3. onchange attribute" }, { "refs": [{ "id": "ref-for-event-change\u2460" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-event-change\u2461" }, { "id": "ref-for-event-change\u2462" }, { "id": "ref-for-event-change\u2463" }, { "id": "ref-for-event-change\u2464" }], "title": "2.4.6. Reacting to state changes" }], "url": "https://html.spec.whatwg.org/multipage/indices.html#event-change" },
                "2bc0cdf4": { "dfnID": "2bc0cdf4", "dfnText": "EventTarget", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eventtarget" }], "title": "2.4. The IdleDetector interface" }], "url": "https://dom.spec.whatwg.org/#eventtarget" },
                "3349d69f": { "dfnID": "3349d69f", "dfnText": "associated Document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-window" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-concept-document-window\u2460" }], "title": "2.4.5. start() method" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "3610bd67": { "dfnID": "3610bd67", "dfnText": "allowed to use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-allowed-to-use" }], "title": "2.4.5. start() method" }], "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" },
                "384a2229": { "dfnID": "384a2229", "dfnText": "onkeypress", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-handler-onkeypress" }], "title": "1. Introduction" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress" },
                "3b90bdcd": { "dfnID": "3b90bdcd", "dfnText": "resolve", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-resolve" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-resolve\u2460" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#resolve" },
                "3f5a365a": { "dfnID": "3f5a365a", "dfnText": "permission", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission" }], "title": "3.3. User coercion" }], "url": "https://w3c.github.io/permissions/#dfn-permission" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }], "title": "2.4.1. userState attribute" }, { "refs": [{ "id": "ref-for-this\u2460" }], "title": "2.4.2. screenState attribute" }, { "refs": [{ "id": "ref-for-this\u2461" }, { "id": "ref-for-this\u2462" }, { "id": "ref-for-this\u2463" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-this\u2464" }, { "id": "ref-for-this\u2465" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "47fe679e": { "dfnID": "47fe679e", "dfnText": "transient activation", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-transient-activation" }], "title": "2.4.4. requestPermission() method" }], "url": "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" },
                "48438eb3": { "dfnID": "48438eb3", "dfnText": "queue a global task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-global-task" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-queue-a-global-task\u2460" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-queue-a-global-task\u2461" }, { "id": "ref-for-queue-a-global-task\u2462" }, { "id": "ref-for-queue-a-global-task\u2463" }, { "id": "ref-for-queue-a-global-task\u2464" }], "title": "2.4.6. Reacting to state changes" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "535dd335": { "dfnID": "535dd335", "dfnText": "aborted", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-aborted" }], "title": "2.4.5. start() method" }], "url": "https://dom.spec.whatwg.org/#abortsignal-aborted" },
                "541116eb": { "dfnID": "541116eb", "dfnText": "onmousemove", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-handler-onmousemove" }], "title": "1. Introduction" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove" },
                "5d7209e9": { "dfnID": "5d7209e9", "dfnText": "Window", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-window" }], "title": "2.4.5. start() method" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "5f90bbfb": { "dfnID": "5f90bbfb", "dfnText": "undefined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-undefined" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "5fd23811": { "dfnID": "5fd23811", "dfnText": "fire an event", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-event-fire" }, { "id": "ref-for-concept-event-fire\u2460" }, { "id": "ref-for-concept-event-fire\u2461" }, { "id": "ref-for-concept-event-fire\u2462" }], "title": "2.4.6. Reacting to state changes" }], "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "6821ab89": { "dfnID": "6821ab89", "dfnText": "granted", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-granted" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-dfn-granted\u2460" }, { "id": "ref-for-dfn-granted\u2461" }], "title": "3.1. Cross-origin information leakage" }, { "refs": [{ "id": "ref-for-dfn-granted\u2462" }, { "id": "ref-for-dfn-granted\u2463" }], "title": "3.3. User coercion" }], "url": "https://w3c.github.io/permissions/#dfn-granted" },
                "6c3bee60": { "dfnID": "6c3bee60", "dfnText": "PermissionState", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-permissionstate" }], "title": "2.4. The IdleDetector interface" }], "url": "https://w3c.github.io/permissions/#dom-permissionstate" },
                "6d19ac93": { "dfnID": "6d19ac93", "dfnText": "user agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-user-agent" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-user-agent\u2460" }], "title": "2.4.6. Reacting to state changes" }], "url": "https://infra.spec.whatwg.org/#user-agent" },
                "7691dbb6": { "dfnID": "7691dbb6", "dfnText": "\"iframe\"", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-requestdestination-iframe" }], "title": "2.3. Permissions policy" }], "url": "https://fetch.spec.whatwg.org/#dom-requestdestination-iframe" },
                "797018a7": { "dfnID": "797018a7", "dfnText": "InvalidStateError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-invalidstateerror" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-invalidstateerror\u2460" }, { "id": "ref-for-invalidstateerror\u2461" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "82ca3efc": { "dfnID": "82ca3efc", "dfnText": "TypeError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-exceptiondef-typeerror" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror" },
                "87bc23a5": { "dfnID": "87bc23a5", "dfnText": "add", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal-add" }], "title": "2.4.5. start() method" }], "url": "https://dom.spec.whatwg.org/#abortsignal-add" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }, { "id": "ref-for-Exposed\u2460" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "922b9e73": { "dfnID": "922b9e73", "dfnText": "onvisibilitychange", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-onvisibilitychange" }], "title": "1. Introduction" }], "url": "https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange" },
                "a72449dd": { "dfnID": "a72449dd", "dfnText": "in parallel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-in-parallel" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-in-parallel\u2460" }, { "id": "ref-for-in-parallel\u2461" }], "title": "2.4.5. start() method" }], "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "ac36400f": { "dfnID": "ac36400f", "dfnText": "hidden", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-hidden" }, { "id": "ref-for-dom-document-hidden\u2460" }], "title": "1. Introduction" }], "url": "https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" },
                "b262501e": { "dfnID": "b262501e", "dfnText": "reject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reject" }, { "id": "ref-for-reject\u2460" }, { "id": "ref-for-reject\u2461" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#reject" },
                "b75bb3bd": { "dfnID": "b75bb3bd", "dfnText": "SecureContext", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-SecureContext" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "ba1bd741": { "dfnID": "ba1bd741", "dfnText": "default powerful feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-default-powerful-feature" }], "title": "2.2. Permissions" }], "url": "https://w3c.github.io/permissions/#dfn-default-powerful-feature" },
                "ba556545": { "dfnID": "ba556545", "dfnText": "NotAllowedError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-notallowederror" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-notallowederror\u2460" }, { "id": "ref-for-notallowederror\u2461" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "bdbd19d1": { "dfnID": "bdbd19d1", "dfnText": "Promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-promise" }, { "id": "ref-for-idl-promise\u2460" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "c01cbda0": { "dfnID": "c01cbda0", "dfnText": "EnforceRange", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-EnforceRange" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#EnforceRange" },
                "c15f1628": { "dfnID": "c15f1628", "dfnText": "internal slot", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sec-object-internal-methods-and-internal-slots" }, { "id": "ref-for-sec-object-internal-methods-and-internal-slots\u2460" }], "title": "2.4. The IdleDetector interface" }], "url": "https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" },
                "cc890cc1": { "dfnID": "cc890cc1", "dfnText": "policy-controlled feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature" }], "title": "2.3. Permissions policy" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "cca3cdb2": { "dfnID": "cca3cdb2", "dfnText": "AbortSignal", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-abortsignal" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-abortsignal\u2460" }], "title": "2.4.5. start() method" }], "url": "https://dom.spec.whatwg.org/#abortsignal" },
                "d0b4a948": { "dfnID": "d0b4a948", "dfnText": "a promise rejected with", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-a-promise-rejected-with" }, { "id": "ref-for-a-promise-rejected-with\u2460" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-a-promise-rejected-with\u2461" }, { "id": "ref-for-a-promise-rejected-with\u2462" }, { "id": "ref-for-a-promise-rejected-with\u2463" }, { "id": "ref-for-a-promise-rejected-with\u2464" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with" },
                "d124397f": { "dfnID": "d124397f", "dfnText": "permission state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-state" }], "title": "2.4.5. start() method" }], "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "d357c753": { "dfnID": "d357c753", "dfnText": "requesting permission to use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-request-permission-to-use" }], "title": "2.4.4. requestPermission() method" }], "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "dacde8b5": { "dfnID": "dacde8b5", "dfnText": "a new promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-a-new-promise" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-a-new-promise\u2460" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "dca2de17": { "dfnID": "dca2de17", "dfnText": "DOMException", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMException" }, { "id": "ref-for-idl-DOMException\u2460" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-idl-DOMException\u2461" }, { "id": "ref-for-idl-DOMException\u2462" }, { "id": "ref-for-idl-DOMException\u2463" }, { "id": "ref-for-idl-DOMException\u2464" }], "title": "2.4.5. start() method" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "dictdef-idleoptions": { "dfnID": "dictdef-idleoptions", "dfnText": "IdleOptions", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-idleoptions" }], "title": "2.4. The IdleDetector interface" }], "url": "#dictdef-idleoptions" },
                "dom-idledetector-idledetector": { "dfnID": "dom-idledetector-idledetector", "dfnText": "constructor", "external": false, "refSections": [], "url": "#dom-idledetector-idledetector" },
                "dom-idledetector-onchange": { "dfnID": "dom-idledetector-onchange", "dfnText": "onchange", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-onchange" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-dom-idledetector-onchange\u2460" }], "title": "2.4.3. onchange attribute" }], "url": "#dom-idledetector-onchange" },
                "dom-idledetector-requestpermission": { "dfnID": "dom-idledetector-requestpermission", "dfnText": "requestPermission()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-requestpermission" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-dom-idledetector-requestpermission\u2460" }], "title": "2.4.4. requestPermission() method" }], "url": "#dom-idledetector-requestpermission" },
                "dom-idledetector-screenstate": { "dfnID": "dom-idledetector-screenstate", "dfnText": "screenState", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-screenstate" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-dom-idledetector-screenstate\u2460" }], "title": "2.4.2. screenState attribute" }, { "refs": [{ "id": "ref-for-dom-idledetector-screenstate\u2461" }], "title": "2.4.5. start() method" }], "url": "#dom-idledetector-screenstate" },
                "dom-idledetector-screenstate-slot": { "dfnID": "dom-idledetector-screenstate-slot", "dfnText": "[[screenState]]", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-screenstate-slot" }], "title": "2.4.2. screenState attribute" }, { "refs": [{ "id": "ref-for-dom-idledetector-screenstate-slot\u2460" }, { "id": "ref-for-dom-idledetector-screenstate-slot\u2461" }, { "id": "ref-for-dom-idledetector-screenstate-slot\u2462" }, { "id": "ref-for-dom-idledetector-screenstate-slot\u2463" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-idledetector-screenstate-slot" },
                "dom-idledetector-start": { "dfnID": "dom-idledetector-start", "dfnText": "start(options)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-start" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-dom-idledetector-start\u2460" }, { "id": "ref-for-dom-idledetector-start\u2461" }, { "id": "ref-for-dom-idledetector-start\u2462" }], "title": "2.4.5. start() method" }], "url": "#dom-idledetector-start" },
                "dom-idledetector-start-options-options": { "dfnID": "dom-idledetector-start-options-options", "dfnText": "options", "external": false, "refSections": [], "url": "#dom-idledetector-start-options-options" },
                "dom-idledetector-state-slot": { "dfnID": "dom-idledetector-state-slot", "dfnText": "[[state]]", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-state-slot" }, { "id": "ref-for-dom-idledetector-state-slot\u2460" }, { "id": "ref-for-dom-idledetector-state-slot\u2461" }, { "id": "ref-for-dom-idledetector-state-slot\u2462" }, { "id": "ref-for-dom-idledetector-state-slot\u2463" }, { "id": "ref-for-dom-idledetector-state-slot\u2464" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-dom-idledetector-state-slot\u2465" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-idledetector-state-slot" },
                "dom-idledetector-threshold-slot": { "dfnID": "dom-idledetector-threshold-slot", "dfnText": "[[threshold]]", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-threshold-slot" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-dom-idledetector-threshold-slot\u2460" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-idledetector-threshold-slot" },
                "dom-idledetector-userstate": { "dfnID": "dom-idledetector-userstate", "dfnText": "userState", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-userstate" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-dom-idledetector-userstate\u2460" }], "title": "2.4.1. userState attribute" }, { "refs": [{ "id": "ref-for-dom-idledetector-userstate\u2461" }], "title": "2.4.5. start() method" }], "url": "#dom-idledetector-userstate" },
                "dom-idledetector-userstate-slot": { "dfnID": "dom-idledetector-userstate-slot", "dfnText": "[[userState]]", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idledetector-userstate-slot" }], "title": "2.4.1. userState attribute" }, { "refs": [{ "id": "ref-for-dom-idledetector-userstate-slot\u2460" }, { "id": "ref-for-dom-idledetector-userstate-slot\u2461" }, { "id": "ref-for-dom-idledetector-userstate-slot\u2462" }, { "id": "ref-for-dom-idledetector-userstate-slot\u2463" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-idledetector-userstate-slot" },
                "dom-idleoptions-signal": { "dfnID": "dom-idleoptions-signal", "dfnText": "signal", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idleoptions-signal" }, { "id": "ref-for-dom-idleoptions-signal\u2460" }, { "id": "ref-for-dom-idleoptions-signal\u2461" }, { "id": "ref-for-dom-idleoptions-signal\u2462" }, { "id": "ref-for-dom-idleoptions-signal\u2463" }], "title": "2.4.5. start() method" }], "url": "#dom-idleoptions-signal" },
                "dom-idleoptions-threshold": { "dfnID": "dom-idleoptions-threshold", "dfnText": "threshold", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-idleoptions-threshold" }, { "id": "ref-for-dom-idleoptions-threshold\u2460" }], "title": "2.1.1. The UserIdleState enum" }, { "refs": [{ "id": "ref-for-dom-idleoptions-threshold\u2461" }, { "id": "ref-for-dom-idleoptions-threshold\u2462" }], "title": "2.4.5. start() method" }], "url": "#dom-idleoptions-threshold" },
                "dom-screenidlestate-locked": { "dfnID": "dom-screenidlestate-locked", "dfnText": "\"locked\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-screenidlestate-locked" }], "title": "2.1.2. The ScreenIdleState enum" }, { "refs": [{ "id": "ref-for-dom-screenidlestate-locked\u2460" }, { "id": "ref-for-dom-screenidlestate-locked\u2461" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-screenidlestate-locked" },
                "dom-screenidlestate-unlocked": { "dfnID": "dom-screenidlestate-unlocked", "dfnText": "\"unlocked\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-screenidlestate-unlocked" }], "title": "2.1.2. The ScreenIdleState enum" }, { "refs": [{ "id": "ref-for-dom-screenidlestate-unlocked\u2460" }, { "id": "ref-for-dom-screenidlestate-unlocked\u2461" }], "title": "2.4.6. Reacting to state changes" }], "url": "#dom-screenidlestate-unlocked" },
                "dom-useridlestate-active": { "dfnID": "dom-useridlestate-active", "dfnText": "\"active\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-useridlestate-active" }], "title": "2.1.1. The UserIdleState enum" }, { "refs": [{ "id": "ref-for-dom-useridlestate-active\u2460" }, { "id": "ref-for-dom-useridlestate-active\u2461" }], "title": "2.4.6. Reacting to state changes" }, { "refs": [{ "id": "ref-for-dom-useridlestate-active\u2462" }], "title": "3.2. Behavior tracking" }], "url": "#dom-useridlestate-active" },
                "dom-useridlestate-idle": { "dfnID": "dom-useridlestate-idle", "dfnText": "\"idle\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-useridlestate-idle" }], "title": "2.1.1. The UserIdleState enum" }, { "refs": [{ "id": "ref-for-dom-useridlestate-idle\u2460" }, { "id": "ref-for-dom-useridlestate-idle\u2461" }], "title": "2.4.6. Reacting to state changes" }, { "refs": [{ "id": "ref-for-dom-useridlestate-idle\u2462" }], "title": "3.2. Behavior tracking" }], "url": "#dom-useridlestate-idle" },
                "e99bd18e": { "dfnID": "e99bd18e", "dfnText": "relevant global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-global" }, { "id": "ref-for-concept-relevant-global\u2460" }, { "id": "ref-for-concept-relevant-global\u2461" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-concept-relevant-global\u2462" }, { "id": "ref-for-concept-relevant-global\u2463" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-concept-relevant-global\u2464" }, { "id": "ref-for-concept-relevant-global\u2465" }, { "id": "ref-for-concept-relevant-global\u2466" }, { "id": "ref-for-concept-relevant-global\u2467" }], "title": "2.4.6. Reacting to state changes" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "enumdef-screenidlestate": { "dfnID": "enumdef-screenidlestate", "dfnText": "ScreenIdleState", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-enumdef-screenidlestate" }], "title": "2.1.2. The ScreenIdleState enum" }, { "refs": [{ "id": "ref-for-enumdef-screenidlestate\u2460" }], "title": "2.4. The IdleDetector interface" }], "url": "#enumdef-screenidlestate" },
                "enumdef-useridlestate": { "dfnID": "enumdef-useridlestate", "dfnText": "UserIdleState", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-enumdef-useridlestate" }], "title": "2.1.1. The UserIdleState enum" }, { "refs": [{ "id": "ref-for-enumdef-useridlestate\u2460" }], "title": "2.4. The IdleDetector interface" }], "url": "#enumdef-useridlestate" },
                "f0951476": { "dfnID": "f0951476", "dfnText": "EventHandler", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eventhandler" }], "title": "2.4. The IdleDetector interface" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "f14b47b8": { "dfnID": "f14b47b8", "dfnText": "unsigned long long", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-unsigned-long-long" }], "title": "2.4. The IdleDetector interface" }], "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "fb4878d7": { "dfnID": "fb4878d7", "dfnText": "denied", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-denied" }], "title": "3.3. User coercion" }], "url": "https://w3c.github.io/permissions/#dfn-denied" },
                "idle-detection-task-source": { "dfnID": "idle-detection-task-source", "dfnText": "idle detection task source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-idle-detection-task-source" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-idle-detection-task-source\u2460" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-idle-detection-task-source\u2461" }, { "id": "ref-for-idle-detection-task-source\u2462" }, { "id": "ref-for-idle-detection-task-source\u2463" }, { "id": "ref-for-idle-detection-task-source\u2464" }], "title": "2.4.6. Reacting to state changes" }], "url": "#idle-detection-task-source" },
                "idledetector": { "dfnID": "idledetector", "dfnText": "IdleDetector", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-idledetector" }, { "id": "ref-for-idledetector\u2460" }, { "id": "ref-for-idledetector\u2461" }], "title": "2.4. The IdleDetector interface" }, { "refs": [{ "id": "ref-for-idledetector\u2462" }, { "id": "ref-for-idledetector\u2463" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-idledetector\u2464" }], "title": "2.4.6. Reacting to state changes" }], "url": "#idledetector" },
                "permissiondef-idle-detection": { "dfnID": "permissiondef-idle-detection", "dfnText": "\"idle-detection\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-permissiondef-idle-detection" }], "title": "2.4.4. requestPermission() method" }, { "refs": [{ "id": "ref-for-permissiondef-idle-detection\u2460" }, { "id": "ref-for-permissiondef-idle-detection\u2461" }], "title": "2.4.5. start() method" }, { "refs": [{ "id": "ref-for-permissiondef-idle-detection\u2462" }, { "id": "ref-for-permissiondef-idle-detection\u2463" }], "title": "3.1. Cross-origin information leakage" }, { "refs": [{ "id": "ref-for-permissiondef-idle-detection\u2464" }], "title": "3.3. User coercion" }], "url": "#permissiondef-idle-detection" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-position-annos */
        "use strict";
        {
            function repositionAnnoPanels() {
                const panels = [...document.querySelectorAll("[data-anno-for]")];
                hydratePanels(panels);
                let vSoFar = 0;
                for (const panel of panels.sort(cmpTops)) {
                    if (panel.top < vSoFar) {
                        panel.top = vSoFar;
                        panel.style.top = vSoFar + "px";
                    }
                    vSoFar = panel.top + panel.height + 15;
                }
            }
            function hydratePanels(panels) {
                const main = document.querySelector("main");
                let mainRect;
                if (main) mainRect = main.getBoundingClientRect();
                // First display them all, if they're not already visible.
                for (const panel of panels) {
                    panel.classList.remove("unpositioned");
                }
                // Measure them all
                for (const panel of panels) {
                    const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
                    if (!dfn) {
                        console.log("Can't find the annotation panel target:", panel);
                        continue;
                    }
                    panel.dfn = dfn;
                    panel.top = window.scrollY + dfn.getBoundingClientRect().top;
                    let panelRect = panel.getBoundingClientRect();
                    panel.height = panelRect.height;
                    if (main) {
                        panel.overlappingMain = panelRect.left < mainRect.right;
                    } else {
                        panel.overlappingMain = false;
                    }
                }
                // And finally position them
                for (const panel of panels) {
                    const dfn = panel.dfn;
                    if (!dfn) continue;
                    panel.style.top = panel.top + "px";
                    panel.classList.toggle("overlapping-main", panel.overlappingMain);
                }
            }

            function cmpTops(a, b) {
                return a.top - b.top;
            }

            window.addEventListener("load", repositionAnnoPanels);
            window.addEventListener("resize", repositionAnnoPanels);
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#dictdef-idleoptions": { "displayText": "IdleOptions", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "IdleOptions", "type": "dictionary", "url": "#dictdef-idleoptions" },
                "#dom-idledetector-onchange": { "displayText": "onchange", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "onchange", "type": "attribute", "url": "#dom-idledetector-onchange" },
                "#dom-idledetector-requestpermission": { "displayText": "requestPermission()", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "requestPermission()", "type": "method", "url": "#dom-idledetector-requestpermission" },
                "#dom-idledetector-screenstate": { "displayText": "screenState", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "screenState", "type": "attribute", "url": "#dom-idledetector-screenstate" },
                "#dom-idledetector-screenstate-slot": { "displayText": "[[screenState]]", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "[[screenState]]", "type": "attribute", "url": "#dom-idledetector-screenstate-slot" },
                "#dom-idledetector-start": { "displayText": "start(options)", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "start(options)", "type": "method", "url": "#dom-idledetector-start" },
                "#dom-idledetector-state-slot": { "displayText": "[[state]]", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "[[state]]", "type": "attribute", "url": "#dom-idledetector-state-slot" },
                "#dom-idledetector-threshold-slot": { "displayText": "[[threshold]]", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "[[threshold]]", "type": "attribute", "url": "#dom-idledetector-threshold-slot" },
                "#dom-idledetector-userstate": { "displayText": "userState", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "userState", "type": "attribute", "url": "#dom-idledetector-userstate" },
                "#dom-idledetector-userstate-slot": { "displayText": "[[userState]]", "export": true, "for_": ["IdleDetector"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "[[userState]]", "type": "attribute", "url": "#dom-idledetector-userstate-slot" },
                "#dom-idleoptions-signal": { "displayText": "signal", "export": true, "for_": ["IdleOptions"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "signal", "type": "dict-member", "url": "#dom-idleoptions-signal" },
                "#dom-idleoptions-threshold": { "displayText": "threshold", "export": true, "for_": ["IdleOptions"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "threshold", "type": "dict-member", "url": "#dom-idleoptions-threshold" },
                "#dom-screenidlestate-locked": { "displayText": "\"locked\"", "export": true, "for_": ["ScreenIdleState"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "\"locked\"", "type": "enum-value", "url": "#dom-screenidlestate-locked" },
                "#dom-screenidlestate-unlocked": { "displayText": "\"unlocked\"", "export": true, "for_": ["ScreenIdleState"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "\"unlocked\"", "type": "enum-value", "url": "#dom-screenidlestate-unlocked" },
                "#dom-useridlestate-active": { "displayText": "\"active\"", "export": true, "for_": ["UserIdleState"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "\"active\"", "type": "enum-value", "url": "#dom-useridlestate-active" },
                "#dom-useridlestate-idle": { "displayText": "\"idle\"", "export": true, "for_": ["UserIdleState"], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "\"idle\"", "type": "enum-value", "url": "#dom-useridlestate-idle" },
                "#enumdef-screenidlestate": { "displayText": "ScreenIdleState", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "ScreenIdleState", "type": "enum", "url": "#enumdef-screenidlestate" },
                "#enumdef-useridlestate": { "displayText": "UserIdleState", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "UserIdleState", "type": "enum", "url": "#enumdef-useridlestate" },
                "#idle-detection-task-source": { "displayText": "idle detection task source", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "idle detection task source", "type": "dfn", "url": "#idle-detection-task-source" },
                "#idledetector": { "displayText": "IdleDetector", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "IdleDetector", "type": "interface", "url": "#idledetector" },
                "#permissiondef-idle-detection": { "displayText": "\"idle-detection\"", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "idle-detection", "spec": "idle-detection-1", "status": "local", "text": "\"idle-detection\"", "type": "permission", "url": "#permissiondef-idle-detection" },
                "https://dom.spec.whatwg.org/#abortsignal": { "displayText": "AbortSignal", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "AbortSignal", "type": "interface", "url": "https://dom.spec.whatwg.org/#abortsignal" },
                "https://dom.spec.whatwg.org/#abortsignal-abort-reason": { "displayText": "abort reason", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "abort reason", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-abort-reason" },
                "https://dom.spec.whatwg.org/#abortsignal-aborted": { "displayText": "aborted", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "aborted", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-aborted" },
                "https://dom.spec.whatwg.org/#abortsignal-add": { "displayText": "add", "export": true, "for_": ["AbortSignal"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "add", "type": "dfn", "url": "https://dom.spec.whatwg.org/#abortsignal-add" },
                "https://dom.spec.whatwg.org/#concept-event-fire": { "displayText": "fire an event", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "fire an event", "type": "dfn", "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "https://dom.spec.whatwg.org/#eventtarget": { "displayText": "EventTarget", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "EventTarget", "type": "interface", "url": "https://dom.spec.whatwg.org/#eventtarget" },
                "https://fetch.spec.whatwg.org/#dom-requestdestination-iframe": { "displayText": "\"iframe\"", "export": true, "for_": ["RequestDestination"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "\"iframe\"", "type": "enum-value", "url": "https://fetch.spec.whatwg.org/#dom-requestdestination-iframe" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active": { "displayText": "fully active", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "fully active", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active" },
                "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use": { "displayText": "allowed to use", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "allowed to use", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" },
                "https://html.spec.whatwg.org/multipage/indices.html#event-change": { "displayText": "change", "export": true, "for_": ["HTMLElement"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "change", "type": "event", "url": "https://html.spec.whatwg.org/multipage/indices.html#event-change" },
                "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": { "displayText": "in parallel", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "in parallel", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation": { "displayText": "transient activation", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "transient activation", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": { "displayText": "associated Document", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "associated document", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": { "displayText": "Window", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "Window", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": { "displayText": "relevant global object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes": { "displayText": "event handler IDL attribute", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler idl attribute", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": { "displayText": "EventHandler", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "EventHandler", "type": "typedef", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress": { "displayText": "onkeypress", "export": true, "for_": ["HTMLElement", "Document", "Window", "GlobalEventHandlers"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "onkeypress", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove": { "displayText": "onmousemove", "export": true, "for_": ["HTMLElement", "Document", "Window", "GlobalEventHandlers"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "onmousemove", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": { "displayText": "queue a global task", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "queue a global task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "https://infra.spec.whatwg.org/#user-agent": { "displayText": "user agent", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "user agent", "type": "dfn", "url": "https://infra.spec.whatwg.org/#user-agent" },
                "https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots": { "displayText": "internal slot", "export": true, "for_": [], "level": "", "normative": true, "shortname": "ecmascript", "spec": "ecmascript", "status": "anchor-block", "text": "internal slot", "type": "dfn", "url": "https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" },
                "https://w3c.github.io/permissions/#dfn-default-powerful-feature": { "displayText": "default powerful feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "default powerful feature", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-default-powerful-feature" },
                "https://w3c.github.io/permissions/#dfn-denied": { "displayText": "denied", "export": true, "for_": ["permission"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "denied", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-denied" },
                "https://w3c.github.io/permissions/#dfn-granted": { "displayText": "granted", "export": true, "for_": ["permission"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "granted", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-granted" },
                "https://w3c.github.io/permissions/#dfn-permission": { "displayText": "permission", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission" },
                "https://w3c.github.io/permissions/#dfn-permission-state": { "displayText": "permission state", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission state", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "https://w3c.github.io/permissions/#dfn-request-permission-to-use": { "displayText": "requesting permission to use", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "requesting permission to use", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "https://w3c.github.io/permissions/#dom-permissionstate": { "displayText": "PermissionState", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "PermissionState", "type": "enum", "url": "https://w3c.github.io/permissions/#dom-permissionstate" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature": { "displayText": "policy-controlled feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "policy-controlled feature", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist": { "displayText": "default allowlist", "export": true, "for_": ["policy-controlled feature"], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "default allowlist", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "https://webidl.spec.whatwg.org/#EnforceRange": { "displayText": "EnforceRange", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "EnforceRange", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#EnforceRange" },
                "https://webidl.spec.whatwg.org/#Exposed": { "displayText": "Exposed", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#SecureContext": { "displayText": "SecureContext", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SecureContext", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#SecureContext" },
                "https://webidl.spec.whatwg.org/#a-new-promise": { "displayText": "a new promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "a new promise", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "https://webidl.spec.whatwg.org/#a-promise-rejected-with": { "displayText": "a promise rejected with", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "a promise rejected with", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with" },
                "https://webidl.spec.whatwg.org/#exceptiondef-typeerror": { "displayText": "TypeError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "TypeError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror" },
                "https://webidl.spec.whatwg.org/#idl-DOMException": { "displayText": "DOMException", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMException", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "https://webidl.spec.whatwg.org/#idl-promise": { "displayText": "Promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Promise", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "https://webidl.spec.whatwg.org/#idl-undefined": { "displayText": "undefined", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "undefined", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "https://webidl.spec.whatwg.org/#idl-unsigned-long-long": { "displayText": "unsigned long long", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "unsigned long long", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "https://webidl.spec.whatwg.org/#invalidstateerror": { "displayText": "InvalidStateError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "InvalidStateError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "https://webidl.spec.whatwg.org/#notallowederror": { "displayText": "NotAllowedError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "NotAllowedError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "https://webidl.spec.whatwg.org/#reject": { "displayText": "reject", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "reject", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#reject" },
                "https://webidl.spec.whatwg.org/#resolve": { "displayText": "resolve", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "resolve", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#resolve" },
                "https://webidl.spec.whatwg.org/#this": { "displayText": "this", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
                "https://www.w3.org/TR/page-visibility-2/#dom-document-hidden": { "displayText": "hidden", "export": true, "for_": ["Document"], "level": "2", "normative": true, "shortname": "page-visibility", "spec": "page-visibility-2", "status": "anchor-block", "text": "hidden", "type": "attribute", "url": "https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" },
                "https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange": { "displayText": "onvisibilitychange", "export": true, "for_": ["Document"], "level": "2", "normative": true, "shortname": "page-visibility", "spec": "page-visibility-2", "status": "anchor-block", "text": "onvisibilitychange", "type": "attribute", "url": "https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const ref = refsData[url];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>
    <script>/* Boilerplate: script-wpt */
        "use strict";
        {
            let wptData = {
                "paths": ["/idle-detection/"],
            };

            document.addEventListener("DOMContentLoaded", async () => {
                if (wptData.paths.length == 0) return;

                const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
                const runs = await (await fetch(runsUrl)).json();

                let testResults = [];
                for (const pathPrefix of wptData.paths) {
                    const pathResults = await (await fetch("https://wpt.fyi/api/search", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            "run_ids": runs.map(x => x.id),
                            "query": { "path": pathPrefix },
                        })
                    })).json();
                    testResults = testResults.concat(pathResults.results);
                }

                const browsers = runs.map(x => ({ name: x.browser_name, version: x.browser_version, passes: 0, total: 0 }));
                const resultsFromPath = new Map(testResults.map(result => {
                    const testPath = result.test;
                    const passes = result.legacy_status.map(x => [x.passes, x.total]);
                    return [testPath, passes];
                }));
                const seenTests = new Set();
                document.querySelectorAll(".wpt-name").forEach(nameEl => {
                    const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
                    if (!passData) {
                        console.log("Couldn't find test in results:", nameEl);
                        return
                    }
                    const numTests = passData[0][1];
                    if (numTests > 1) {
                        nameEl.insertAdjacentElement("beforeend",
                            mk.small({}, ` (${numTests} tests)`));
                    }
                    if (passData == undefined) return;
                    const resultsEl = mk.span({ "class": "wpt-results" },
                        ...passData.map((p, i) => mk.span(
                            {
                                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                                "class": "wpt-result",
                                "style": `background: conic-gradient(forestgreen ${p[0] / p[1] * 360}deg, darkred 0deg);`,
                            })),
                    );
                    nameEl.insertAdjacentElement("afterend", resultsEl);

                    // Only update the summary pass/total count if we haven't seen this
                    // test before, to support authors listing the same test multiple times
                    // in a spec.
                    if (!seenTests.has(nameEl.getAttribute("title"))) {
                        seenTests.add(nameEl.getAttribute("title"));
                        passData.forEach((p, i) => {
                            browsers[i].passes += p[0];
                            browsers[i].total += p[1];
                        });
                    }
                });
                const overview = document.querySelector(".wpt-overview");
                if (overview) {
                    overview.appendChild(mk.ul({}, ...browsers.map(formatWptResult)));
                    document.head.appendChild(mk.style({},
                        `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
                }
            });

            function formatWptResult({ name, version, passes, total }) {
                const passRate = passes / total;
                let passClass = "";
                if (passRate == 0) passClass = "passes-none";
                else if (passRate < .2) passClass = "passes-hardly";
                else if (passRate < .4) passClass = "passes-a-few";
                else if (passRate < .6) passClass = "passes-half";
                else if (passRate < .8) passClass = "passes-lots";
                else if (passRate < 1) passClass = "passes-most";
                else passClass = "passes-all";

                name = name[0].toUpperCase() + name.slice(1);
                const shortVersion = /^\d+/.exec(version);
                const icon = []

                if (name == "Chrome") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/chrome_64x64.png" }));
                if (name == "Edge") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/edge_64x64.png" }));
                if (name == "Safari") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/safari_64x64.png" }));
                if (name == "Firefox") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/firefox_64x64.png" }));

                return mk.li({ "class": passClass },
                    mk.nobr({ 'class': 'browser' }, ...icon, ` ${name} ${shortVersion}`),
                    mk.br(),
                    mk.nobr({ 'class': 'pass-rate' }, `${passes}/${total}`)
                );
            }
        }
    </script>
    <script src="/dropdown.js"></script>