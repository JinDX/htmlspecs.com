<!DOCTYPE html>
<html dir="ltr" lang="zh-hans">

<head>
    <meta charset="utf-8">
    <!-- <meta name="generator" content="ReSpec 19.0.1"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        /* --- EXAMPLES --- */
        div.example-title {
            min-width: 7.5em;
            color: #b9ab2d;
        }

        div.example-title span {
            text-transform: uppercase;
        }

        aside.example,
        div.example,
        div.illegal-example {
            padding: 0.5em;
            margin: 1em 0;
            position: relative;
            clear: both;
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: black
        }

        aside.example,
        div.example {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid;
            border-color: #e0cb52;
            background: #fcfaee;
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff;
        }

        aside.example div.example div.example-title {
            color: #999;
        }
    </style>
    <style>
        /* --- ISSUES/NOTES --- */
        div.issue-title,
        div.note-title,
        div.ednote-title,
        div.warning-title {
            padding-right: 1em;
            min-width: 7.5em;
            color: #b9ab2d;
        }

        div.issue-title {
            color: #e05252;
        }

        div.note-title,
        div.ednote-title {
            color: #2b2;
        }

        div.warning-title {
            color: #f22;
        }

        div.issue-title span,
        div.note-title span,
        div.ednote-title span,
        div.warning-title span {
            text-transform: uppercase;
        }

        div.note,
        div.issue,
        div.ednote,
        div.warning {
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .note>p:first-child,
        .ednote>p:first-child,
        .issue>p:first-child,
        .warning>p:first-child {
            margin-top: 0
        }

        .issue,
        .note,
        .ednote,
        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid;
        }

        div.issue,
        div.note,
        div.ednote,
        div.warning {
            padding: 1em 1.2em 0.5em;
            margin: 1em 0;
            position: relative;
            clear: both;
        }

        span.note,
        span.ednote,
        span.issue,
        span.warning {
            padding: .1em .5em .15em;
        }

        .issue {
            border-color: #e05252;
            background: #fbe9e9;
        }

        .note,
        .ednote {
            border-color: #52e052;
            background: #e9fbe9;
        }

        .warning {
            border-color: #f11;
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
        }

        .warning-title:before {
            content: "⚠";
            /*U+26A0 WARNING SIGN*/
            font-size: 3em;
            float: left;
            height: 100%;
            padding-right: .3em;
            vertical-align: top;
            margin-top: -0.5em;
        }

        li.task-list-item {
            list-style: none;
        }

        input.task-list-item-checkbox {
            margin: 0 0.35em 0.25em -1.6em;
            vertical-align: middle;
        }
    </style>
    <title>ActivityPub</title>



    <style>
        img {
            max-width: 100%;
        }
    </style>
    <style id="respec-mainstyle">
        /*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

        /* Override code highlighter background */
        .hljs {
            background: transparent !important;
        }

        /* --- INLINES --- */
        h1 abbr,
        h2 abbr,
        h3 abbr,
        h4 abbr,
        h5 abbr,
        h6 abbr,
        a abbr {
            border: none;
        }

        dfn {
            font-weight: bold;
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none;
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none;
        }

        a.bibref {
            text-decoration: none;
        }

        cite .bibref {
            font-style: normal;
        }

        code {
            color: #c83500;
        }

        th code {
            color: inherit;
        }

        /* --- TOC --- */

        .toc a,
        .tof a {
            text-decoration: none;
        }

        a .secno,
        a .figno {
            color: #000;
        }

        ul.tof,
        ol.tof {
            list-style: none outside none;
        }

        .caption {
            margin-top: 0.5em;
            font-style: italic;
        }

        /* --- TABLE --- */

        table.simple {
            border-spacing: 0;
            border-collapse: collapse;
            border-bottom: 3px solid #005a9c;
        }

        .simple th {
            background: #005a9c;
            color: #fff;
            padding: 3px 5px;
            text-align: left;
        }

        .simple th[scope="row"] {
            background: inherit;
            color: inherit;
            border-top: 1px solid #ddd;
        }

        .simple td {
            padding: 3px 10px;
            border-top: 1px solid #ddd;
        }

        .simple tr:nth-child(even) {
            background: #f0f6ff;
        }

        /* --- DL --- */

        .section dd>p:first-child {
            margin-top: 0;
        }

        .section dd>p:last-child {
            margin-bottom: 0;
        }

        .section dd {
            margin-bottom: 1em;
        }

        .section dl.attrs dd,
        .section dl.eldef dd {
            margin-bottom: 0;
        }

        #issue-summary>ul,
        .respec-dfn-list {
            column-count: 2;
        }

        #issue-summary li,
        .respec-dfn-list li {
            list-style: none;
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top;
        }

        details.respec-tests-details>* {
            padding-right: 2em;
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: white;
            padding-bottom: .5em;
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em;
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -0.3em;
        }

        details.respec-tests-details>li {
            padding-left: 1em;
        }

        @media print {
            .removeOnSave {
                display: none;
            }
        }
    </style>
    <style>
        /*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

        .hljs {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            color: #333;
            background: #f8f8f8;
        }

        .hljs-comment,
        .hljs-quote {
            color: #998;
            font-style: italic;
        }

        .hljs-keyword,
        .hljs-selector-tag,
        .hljs-subst {
            color: #333;
            font-weight: bold;
        }

        .hljs-number,
        .hljs-literal,
        .hljs-variable,
        .hljs-template-variable,
        .hljs-tag .hljs-attr {
            color: #008080;
        }

        .hljs-string,
        .hljs-doctag {
            color: #d14;
        }

        .hljs-title,
        .hljs-section,
        .hljs-selector-id {
            color: #900;
            font-weight: bold;
        }

        .hljs-subst {
            font-weight: normal;
        }

        .hljs-type,
        .hljs-class .hljs-title {
            color: #458;
            font-weight: bold;
        }

        .hljs-tag,
        .hljs-name,
        .hljs-attribute {
            color: #000080;
            font-weight: normal;
        }

        .hljs-regexp,
        .hljs-link {
            color: #009926;
        }

        .hljs-symbol,
        .hljs-bullet {
            color: #990073;
        }

        .hljs-built_in,
        .hljs-builtin-name {
            color: #0086b3;
        }

        .hljs-meta {
            color: #999;
            font-weight: bold;
        }

        .hljs-deletion {
            background: #fdd;
        }

        .hljs-addition {
            background: #dfd;
        }

        .hljs-emphasis {
            font-style: italic;
        }

        .hljs-strong {
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-REC">
    <link rel="canonical" href="https://www.w3.org/TR/activitypub/">
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "REC",
  "publishDate": "2018-01-23",
  "previousPublishDate": "2017-12-05",
  "previousMaturity": "PR",
  "license": "w3c-software-doc",
  "shortName": "activitypub",
  "wg": "Social Web Working Group",
  "wgURI": "https://www.w3.org/Social/WG",
  "wgPublicList": "public-socialweb",
  "wgPatentURI": "https://www.w3.org/2004/01/pp-impl/72531/status",
  "edDraftURI": "https://w3c.github.io/activitypub/",
  "testSuiteURI": "https://test.activitypub.rocks/",
  "errata": "https://www.w3.org/wiki/ActivityPub_errata",
  "implementationReportURI": "https://activitypub.rocks/implementation-report",
  "otherLinks": [
    {
      "key": "Repository",
      "data": [
        {
          "value": "Git repository",
          "href": "https://github.com/w3c/activitypub"
        },
        {
          "value": "Issues",
          "href": "https://github.com/w3c/activitypub/issues"
        },
        {
          "value": "Commits",
          "href": "https://github.com/w3c/activitypub/commits/gh-pages"
        }
      ]
    }
  ],
  "editors": [
    {
      "name": "Christine Lemmer-Webber",
      "url": "https://dustycloud.org/",
      "w3cid": "57007"
    },
    {
      "name": "Jessica Tallon",
      "url": "https://tsyesika.se",
      "w3cid": "72695"
    }
  ],
  "authors": [
    {
      "name": "Christine Lemmer-Webber",
      "url": "https://dustycloud.org/"
    },
    {
      "name": "Jessica Tallon",
      "url": "https://tsyesika.se"
    },
    {
      "name": "Erin Shepherd",
      "url": "http://erinshepherd.net/"
    },
    {
      "name": "Amy Guy",
      "url": "https://rhiaro.co.uk/"
    },
    {
      "name": "Evan Prodromou",
      "url": "https://en.wikipedia.org/wiki/Evan_Prodromou"
    }
  ],
  "localBiblio": {
    "ActivityStreams": {
      "title": "Activity Streams 2.0",
      "href": "https://www.w3.org/TR/activitystreams-core/",
      "authors": [
        "J. Snell"
      ],
      "status": "Editors Draft",
      "publisher": "ActivityStreams Working Group"
    },
    "Activity-Vocabulary": {
      "title": "Activity Vocabulary",
      "href": "https://www.w3.org/TR/activitystreams-vocabulary/",
      "authors": [
        "J. Snell"
      ],
      "status": "Editors Draft",
      "publisher": "ActivityStreams Working Group"
    },
    "OAuth-Server-Metadata": {
      "title": "OAuth 2.0 Authorization Server Metadata",
      "href": "https://tools.ietf.org/html/draft-ietf-oauth-discovery-06",
      "authors": [
        "M. Jones",
        "N. Sakimura",
        "J. Bradley"
      ],
      "status": "Internet-Draft",
      "publisher": "OAuth Working Group"
    }
  },
  "publishISODate": "2018-01-23T00:00:00.000Z",
  "generatedSubtitle": "Recommendation 23 January 2018"
}</script>
    <meta name="description"
        content="ActivityPub 协议是一种去中心化的社交网络协议，基于 [ActivityStreams] 2.0 数据格式。它提供客户端到服务器的 API，用于创建、更新和删除内容，同时也提供服务器间联邦 API，用于分发通知和内容。">
</head>

<body aria-busy="false" class="h-entry">
    <div class="head">
        <p>
            <a class="logo" href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C"
                    alt="W3C" width="72" height="48"></a>
        </p>
        <p><!--_hyper: 682859076;--></p>
        <h1 class="title p-name" id="title">ActivityPub</h1>
        <h2 id="w3c-recommendation-23-january-2018"><abbr title="World Wide Web Consortium">W3C</abbr> 推荐规范
            <time class="dt-published" datetime="2018-01-23">2018年1月23日</time>
        </h2>
        <dl>
            <dt>本版本：</dt>
            <dd><a class="u-url"
                    href="https://www.w3.org/TR/2018/REC-activitypub-20180123/">https://www.w3.org/TR/2018/REC-activitypub-20180123/</a>
            </dd>
            <dt>最新发布版本：</dt>
            <dd><a href="https://www.w3.org/TR/activitypub/">https://www.w3.org/TR/activitypub/</a></dd>
            <dt>最新编辑草案：</dt>
            <dd><a href="https://w3c.github.io/activitypub/">https://w3c.github.io/activitypub/</a></dd>
            <dt>测试套件：</dt>
            <dd><a href="https://test.activitypub.rocks/">https://test.activitypub.rocks/</a></dd>
            <dt>实现报告：</dt>
            <dd><a
                    href="https://activitypub.rocks/implementation-report">https://activitypub.rocks/implementation-report</a>
            </dd>
            <dt>上一个版本：</dt>
            <dd><a
                    href="https://www.w3.org/TR/2017/PR-activitypub-20171205/">https://www.w3.org/TR/2017/PR-activitypub-20171205/</a>
            </dd>
            <dt>编辑：</dt>
            <dd class="p-author h-card vcard" data-editor-id="57007"><a class="u-url url p-name fn"
                    href="https://dustycloud.org/">Christine Lemmer-Webber</a></dd>
            <dd class="p-author h-card vcard" data-editor-id="72695"><a class="u-url url p-name fn"
                    href="https://tsyesika.se">Jessica Tallon</a></dd>

            <dt>作者：</dt>
            <dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://dustycloud.org/">Christine
                    Lemmer-Webber</a></dd>
            <dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://tsyesika.se">Jessica
                    Tallon</a></dd>
            <dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="http://erinshepherd.net/">Erin
                    Shepherd</a></dd>
            <dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://rhiaro.co.uk/">Amy Guy</a>
            </dd>
            <dd class="p-author h-card vcard"><a class="u-url url p-name fn"
                    href="https://en.wikipedia.org/wiki/Evan_Prodromou">Evan Prodromou</a></dd>

            <dt>代码仓库：</dt>
            <dd>
                <a href="https://github.com/w3c/activitypub">
                    Git 仓库
                </a>
            </dd>
            <dd>
                <a href="https://github.com/w3c/activitypub/issues">
                    问题
                </a>
            </dd>
            <dd>
                <a href="https://github.com/w3c/activitypub/commits/gh-pages">
                    提交记录
                </a>
            </dd>
        </dl>
        <p>
            请查阅 <a href="https://www.w3.org/wiki/ActivityPub_errata"><strong>勘误</strong></a>，了解自发布以来报告的所有错误或问题。
        </p>
        <p>
            另见 <a href="https://www.w3.org/2003/03/Translations/byTechnology?technology=activitypub">
                <strong>翻译</strong></a>。
        </p>
        <p class="copyright">
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
            2018

            <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
            (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
            <a href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
            <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>).
            <abbr title="World Wide Web Consortium">W3C</abbr> <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive
                document license</a>
            rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2 id="abstract-0">摘要</h2>
        <p>
            ActivityPub 协议是一种去中心化的社交网络协议，
            基于 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 2.0 数据格式。
            它提供客户端到服务器的 API，用于创建、更新和删除内容，
            还提供服务器到服务器的联邦 API，用于推送通知和内容。
        </p>
    </section>

    <section id="sotd" class="introductory">
        <h2 id="status-of-this-document">本文档状态</h2>
        <p>
            <em>本节描述了本文档在发布时的状态。其他文档可能会取代本文件。当前 <abbr title="World Wide Web Consortium">W3C</abbr>
                发布文档和本技术报告的最新版本可在 <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr>
                    技术报告索引</a> https://www.w3.org/TR/ 查询。</em>
        </p>
        <p>
            本文档由 <a href="https://www.w3.org/Social/WG">Social Web 工作组</a> 作为推荐规范发布。
        </p>
        <p>
            欢迎所有相关方通过工作组的
            <a href="https://github.com/w3c/activitypub/issues">Issue tracker</a>
            提交实现报告、漏洞报告和其他意见。
            这些内容将由
            <a href="https://www.w3.org/wiki/SocialCG">Social Web 社区组</a>
            讨论，并在本规范后续版本中加以考虑。
        </p>
        <p>
            请参阅工作组的 <a href="https://activitypub.rocks/implementation-report">实现报告</a>。
        </p>
        <p>
            本文档经 <abbr title="World Wide Web Consortium">W3C</abbr> 会员、软件开发者、其他 <abbr
                title="World Wide Web Consortium">W3C</abbr>
            组织及相关方审议，由 W3C 董事确认为 <abbr title="World Wide Web Consortium">W3C</abbr> 推荐规范。
            本文档内容稳定，可作为参考材料或被其他文档引用。W3C 制定推荐规范的角色在于引起对规范的关注并促进其广泛部署，从而提升 Web 的功能和互操作性。
        </p>
        <p>
            本文档由
            遵守
            <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                专利政策</a> 的小组编写。
            <abbr title="World Wide Web Consortium">W3C</abbr> 维护一份与本组交付物相关的 <a
                href="https://www.w3.org/2004/01/pp-impl/72531/status" rel="disclosure">专利声明公开列表</a>，
            该页面也包含披露专利的说明。任何实际知晓含有<a
                href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">必要权利要求</a>的专利的人士，须根据
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C 专利政策第6节</a>披露信息。
        </p>
        <p>本文件受 <a id="w3c_process_revision" href="https://www.w3.org/2017/Process-20170301/">2017年3月1日 <abbr
                    title="World Wide Web Consortium">W3C</abbr> 流程文件</a>管理。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目录</h2>
        <ol class="toc">
            <li class="tocline"><a href="#Overview" class="tocxref"><span class="secno">1. </span>概述</a>
                <ol class="toc">
                    <li class="tocline"><a href="#social-web-working-group" class="tocxref"><span class="secno">1.1
                            </span>Social Web 工作组</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">2. </span>一致性</a>
                <ol class="toc">
                    <li class="tocline"><a href="#specification-profiles" class="tocxref"><span class="secno">2.1
                            </span>规范配置</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#obj" class="tocxref"><span class="secno">3. </span>对象</a>
                <ol class="toc">
                    <li class="tocline"><a href="#obj-id" class="tocxref"><span class="secno">3.1 </span>对象标识符</a></li>
                    <li class="tocline"><a href="#retrieving-objects" class="tocxref"><span class="secno">3.2
                            </span>获取对象</a></li>
                    <li class="tocline"><a href="#source-property" class="tocxref"><span class="secno">3.3 </span>source
                            属性</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#actors" class="tocxref"><span class="secno">4. </span>参与者</a>
                <ol class="toc">
                    <li class="tocline"><a href="#actor-objects" class="tocxref"><span class="secno">4.1
                            </span><i>Actor</i> 对象</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#collections" class="tocxref"><span class="secno">5. </span>集合</a>
                <ol class="toc">
                    <li class="tocline"><a href="#outbox" class="tocxref"><span class="secno">5.1 </span>Outbox</a></li>
                    <li class="tocline"><a href="#inbox" class="tocxref"><span class="secno">5.2 </span>Inbox</a></li>
                    <li class="tocline"><a href="#followers" class="tocxref"><span class="secno">5.3 </span>Followers
                            Collection</a>
                    </li>
                    <li class="tocline"><a href="#following" class="tocxref"><span class="secno">5.4 </span>Following
                            Collection</a>
                    </li>
                    <li class="tocline"><a href="#liked" class="tocxref"><span class="secno">5.5 </span>Liked
                            Collection</a></li>
                    <li class="tocline"><a href="#public-addressing" class="tocxref"><span class="secno">5.6
                            </span>公开寻址</a></li>
                    <li class="tocline"><a href="#likes" class="tocxref"><span class="secno">5.7 </span>Likes
                            Collection</a></li>
                    <li class="tocline"><a href="#shares" class="tocxref"><span class="secno">5.8 </span>Shares
                            Collection</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#client-to-server-interactions" class="tocxref"><span class="secno">6.
                    </span>客户端到服务器交互</a>
                <ol class="toc">
                    <li class="tocline"><a href="#client-addressing" class="tocxref"><span class="secno">6.1
                            </span>客户端寻址</a></li>
                    <li class="tocline"><a href="#create-activity-outbox" class="tocxref"><span class="secno">6.2
                            </span>Create Activity</a>
                        <ol class="toc">
                            <li class="tocline"><a href="#object-without-create" class="tocxref"><span
                                        class="secno">6.2.1 </span>无 Create Activity 的对象创建</a></li>
                        </ol>
                    </li>
                    <li class="tocline"><a href="#update-activity-outbox" class="tocxref"><span class="secno">6.3
                            </span>Update Activity</a>
                        <ol class="toc">
                            <li class="tocline"><a href="#partial-updates" class="tocxref"><span class="secno">6.3.1
                                    </span>部分更新</a></li>
                        </ol>
                    </li>
                    <li class="tocline"><a href="#delete-activity-outbox" class="tocxref"><span class="secno">6.4
                            </span>Delete Activity</a></li>
                    <li class="tocline"><a href="#follow-activity-outbox" class="tocxref"><span class="secno">6.5
                            </span>Follow Activity</a></li>
                    <li class="tocline"><a href="#add-activity-outbox" class="tocxref"><span class="secno">6.6
                            </span>Add Activity</a></li>
                    <li class="tocline"><a href="#remove-activity-outbox" class="tocxref"><span class="secno">6.7
                            </span>Remove Activity</a></li>
                    <li class="tocline"><a href="#like-activity-outbox" class="tocxref"><span class="secno">6.8
                            </span>Like Activity</a></li>
                    <li class="tocline"><a href="#block-activity-outbox" class="tocxref"><span class="secno">6.9
                            </span>Block Activity</a></li>
                    <li class="tocline"><a href="#undo-activity-outbox" class="tocxref"><span class="secno">6.10
                            </span>Undo Activity</a></li>
                    <li class="tocline"><a href="#client-to-server-outbox-delivery" class="tocxref"><span
                                class="secno">6.11 </span>投递</a></li>
                    <li class="tocline"><a href="#uploading-media" class="tocxref"><span class="secno">6.12
                            </span>媒体上传</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#server-to-server-interactions" class="tocxref"><span class="secno">7.
                    </span>服务器到服务器交互</a>
                <ol class="toc">
                    <li class="tocline"><a href="#delivery" class="tocxref"><span class="secno">7.1 </span>投递</a>
                        <ol class="toc">
                            <li class="tocline"><a href="#outbox-delivery" class="tocxref"><span class="secno">7.1.1
                                    </span>服务器到服务器 outbox 投递要求</a></li>
                            <li class="tocline"><a href="#inbox-forwarding" class="tocxref"><span class="secno">7.1.2
                                    </span>inbox 转发</a></li>
                            <li class="tocline"><a href="#shared-inbox-delivery" class="tocxref"><span
                                        class="secno">7.1.3 </span>共享收件箱投递</a></li>
                        </ol>
                    </li>
                    <li class="tocline"><a href="#create-activity-inbox" class="tocxref"><span class="secno">7.2
                            </span>Create Activity</a></li>
                    <li class="tocline"><a href="#update-activity-inbox" class="tocxref"><span class="secno">7.3
                            </span>Update Activity</a></li>
                    <li class="tocline"><a href="#delete-activity-inbox" class="tocxref"><span class="secno">7.4
                            </span>Delete Activity</a></li>
                    <li class="tocline"><a href="#follow-activity-inbox" class="tocxref"><span class="secno">7.5
                            </span>Follow Activity</a></li>
                    <li class="tocline"><a href="#accept-activity-inbox" class="tocxref"><span class="secno">7.6
                            </span>Accept Activity</a></li>
                    <li class="tocline"><a href="#reject-activity-inbox" class="tocxref"><span class="secno">7.7
                            </span>Reject Activity</a></li>
                    <li class="tocline"><a href="#add-activity-inbox" class="tocxref"><span class="secno">7.8
                            </span>Add Activity</a></li>
                    <li class="tocline"><a href="#remove-activity-inbox" class="tocxref"><span class="secno">7.9
                            </span>Remove Activity</a></li>
                    <li class="tocline"><a href="#like-activity-inbox" class="tocxref"><span class="secno">7.10
                            </span>Like Activity</a></li>
                    <li class="tocline"><a href="#announce-activity-inbox" class="tocxref"><span class="secno">7.11
                            </span>Announce Activity（分享）</a></li>
                    <li class="tocline"><a href="#undo-activity-inbox" class="tocxref"><span class="secno">7.12
                            </span>Undo Activity</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#i18n-concerns" class="tocxref"><span class="secno">A.
                    </span>国际化</a></li>
            <li class="tocline"><a href="#security-considerations" class="tocxref"><span class="secno">B.
                    </span>安全性注意事项</a>
                <ol class="toc">
                    <li class="tocline"><a href="#authorization" class="tocxref"><span class="secno">B.1
                            </span>认证与授权</a></li>
                    <li class="tocline"><a href="#security-verification" class="tocxref"><span class="secno">B.2
                            </span>验证</a></li>
                    <li class="tocline"><a href="#security-localhost" class="tocxref"><span class="secno">B.3
                            </span>访问本地 URI</a></li>
                    <li class="tocline"><a href="#security-uri-schemes" class="tocxref"><span class="secno">B.4
                            </span>URI 方案</a></li>
                    <li class="tocline"><a href="#security-recursive-objects" class="tocxref"><span class="secno">B.5
                            </span>递归对象</a></li>
                    <li class="tocline"><a href="#security-spam" class="tocxref"><span class="secno">B.6 </span>垃圾信息</a>
                    </li>
                    <li class="tocline"><a href="#security-federation-dos" class="tocxref"><span class="secno">B.7
                            </span>联邦拒绝服务攻击</a></li>
                    <li class="tocline"><a href="#security-c2s-ratelimiting" class="tocxref"><span class="secno">B.8
                            </span>客户端-服务器 限流</a></li>
                    <li class="tocline"><a href="#security-c2s-response-dos" class="tocxref"><span class="secno">B.9
                            </span>客户端-服务器 响应拒绝服务</a></li>
                    <li class="tocline"><a href="#security-sanitizing-content" class="tocxref"><span class="secno">B.10
                            </span>内容净化</a></li>
                    <li class="tocline"><a href="#security-not-displaying-bto-bcc" class="tocxref"><span
                                class="secno">B.11 </span>不显示 bto 和 bcc 属性</a></li>
                </ol>
            </li>
            <li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">C.
                    </span>致谢</a></li>
            <li class="tocline"><a href="#references" class="tocxref"><span class="secno">D. </span>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">D.1
                            </span>规范性引用</a></li>
                    <li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">D.2
                            </span>补充性引用</a></li>
                </ol>
            </li>
        </ol>
    </nav>

    <section id="Overview">
        <!--OddPage-->
        <h2 id="x1-overview"><span class="secno">1. </span>概述</h2>

        <p>ActivityPub 提供了两层协议：</p>

        <ul>
            <li>
                <b>服务器到服务器的联邦协议</b>
                （让去中心化网站可以共享信息）
            </li>
            <li>
                <b>客户端到服务器协议</b>
                （允许用户，包括真实用户、机器人和其他自动化进程，
                通过其在服务器上的帐号，用手机、桌面或网页应用等方式与 ActivityPub 通信）
            </li>
        </ul>

        <p>
            ActivityPub 的实现可以只实现其中一个，也可以同时实现两者。
            不过，一旦你实现了其中一个，距离实现另一个就只差几步，并且两者兼得有很多好处（你的站点能成为去中心化社交网络的一部分，并能使用跨众多社交网站通用的客户端及库）。
        </p>

        <p>
            在 ActivityPub 中，用户通过其在服务器上的帐号以 "<a href="#actors">actors</a>"（参与者）表示。
            用户在不同服务器上的帐号对应不同的 actor。
            每个 Actor 拥有：
        </p>

        <ul>
            <li><b>一个 <code>inbox</code>：</b> 接收来自外界的信息的方式</li>
            <li><b>一个 <code>outbox</code>：</b> 向他人发送消息的方式</li>
        </ul>

        <p>
            <img src="https://www.w3.org/TR/activitypub/illustration/tutorial-1.png" alt="Actor with inbox and outbox">
        </p>

        <p>
            它们是端点，实际上只是列在 ActivityPub actor 的 ActivityStreams 描述里的 URL。
            （后文将详细介绍 ActivityStreams）。
        </p>

        <p>
            下面是我们好友 Alyssa P. Hacker 的记录示例：
        </p>

        <div class="example">
            <div class="example-title marker"><span>示例 1</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{<span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
 <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
 <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
 <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Alyssa P. Hacker"</span>,
 <span class="hljs-attr">"preferredUsername"</span>: <span class="hljs-string">"alyssa"</span>,
 <span class="hljs-attr">"summary"</span>: <span class="hljs-string">"Lisp 爱好者，来自 MIT"</span>,
 <span class="hljs-attr">"inbox"</span>: <span class="hljs-string">"https://social.example/alyssa/inbox/"</span>,
 <span class="hljs-attr">"outbox"</span>: <span class="hljs-string">"https://social.example/alyssa/outbox/"</span>,
 <span class="hljs-attr">"followers"</span>: <span class="hljs-string">"https://social.example/alyssa/followers/"</span>,
 <span class="hljs-attr">"following"</span>: <span class="hljs-string">"https://social.example/alyssa/following/"</span>,
 <span class="hljs-attr">"liked"</span>: <span class="hljs-string">"https://social.example/alyssa/liked/"</span>}</pre>
        </div>

        <p>
            ActivityPub 使用 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 作为其词汇集合。
            这很好，因为 ActivityStreams 已包含几乎所有表达社交网络活动和内容流转常见需求的术语。
            很可能你所需的词汇已经被定义，但即便没有，还可以通过 [<cite><a class="bibref" href="#bib-JSON-LD">JSON-LD</a></cite>] 扩展。
            如果你了解 JSON-LD，就可以用 JSON-LD 提供的强大链接数据手段。
            如果不了解也没关系，JSON-LD 文档与 ActivityStreams 可以看作普通 JSON 理解。
            （只有你要加扩展时，JSON-LD 的优势才真正体现出来）。
        </p>

        <p>
            好的。
            假如 Alyssa 要和朋友们聊天，朋友也想找她！
            幸运的是有了 "inbox" 和 "outbox" 能帮忙。
            这两个端点对 GET 和 POST 的行为是不同的。
            我们来看看它们如何工作：
        </p>

        <p>
            <img src="https://www.w3.org/TR/activitypub/illustration/tutorial-2.png"
                alt="Actor with messages flowing from rest of world to inbox and from outbox to rest of world">
        </p>

        <p>
            简单回顾一下：
        </p>

        <ul>
            <li>
                你可以向某人 inbox 执行 POST 以发送消息
                （仅用于服务器间/联邦通信... 这就是联邦！）
            </li>
            <li>
                你可以 GET 自己的 inbox 以读取最新消息
                （客户端到服务器；类似读你的社交网络流）
            </li>
            <li>
                你可以 POST 到 outbox 向世界发送消息
                （客户端到服务器）
            </li>
            <li>
                你可以 GET 某人的 outbox 查看其发布的消息（至少能看到你获得授权的内容）。
                （客户端到服务器和/或服务器到服务器）
            </li>
        </ul>

        <p>
            当然，如果只能靠 GET 别人的 outbox 查看内容，这个联邦协议就太低效了！
            实际上，联邦通常是服务器直接将 actor 产生的消息 POST 到其他服务器的 inbox。
        </p>

        <p>
            看个例子！
            Alyssa 想联系她的好友 Ben Bitdiddle。
            她前不久借给他一本书，现在要确认他能归还。
            这就是她作为 ActivityStreams 对象写的消息：
        </p>

        <div class="example">
            <div class="example-title marker"><span>示例 2</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{<span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
 <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
 <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://chatty.example/ben/"</span>],
 <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
 <span class="hljs-attr">"content"</span>: <span class="hljs-string">"嘿，你看完我借你的那本书了吗？"</span>}</pre>
        </div>

        <p>
            这是写给 Ben 的便笺。
            她把它 POST 到自己的 outbox。
        </p>

        <p>
            <img src="https://www.w3.org/TR/activitypub/illustration/tutorial-3.png"
                alt="Actor posting message to outbox">
        </p>

        <p>
            因为这不是一个 activity（活动）对象，服务器识别到这是一条新建的对象，因此会体贴地把它包裹在 Create activity 里。
            （ActivityPub 传递的活动通常都是某 actor 对某个对象采取某种 action，这里就是 Person 发布 Create 类型的 Note）。
        </p>


        <div class="example">
            <div class="example-title marker"><span>示例 3</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{<span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
 <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Create"</span>,
 <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/posts/a29a6843-9feb-4c74-a7f7-081b9c9201d3"</span>,
 <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://chatty.example/ben/"</span>],
 <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
 <span class="hljs-attr">"object"</span>: {<span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/posts/49e2d03d-b53a-4c4c-a95c-94a6abf45a19"</span>,
            <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
            <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://chatty.example/ben/"</span>],
            <span class="hljs-attr">"content"</span>: <span class="hljs-string">"嘿，你看完我借你的那本书了吗？"</span>}}</pre>
        </div>

        <p>
            Alyssa 的服务器查询 Ben 的 ActivityStreams actor 对象，找到了他的 inbox 端点，并把对象 POST 到 Ben 的 inbox。
        </p>

        <p>
            <img src="https://www.w3.org/TR/activitypub/illustration/tutorial-4.png"
                alt="Server posting to remote actor's inbox">
        </p>

        <p>
            技术上来说，这分为两个步骤：一个是客户端到服务器，一个是服务器到服务器（联邦）。
            但结合起来看，我们可以把这抽象成一次 outbox 到 inbox 的流畅提交过程：
        </p>

        <p>
            <img src="https://www.w3.org/TR/activitypub/illustration/tutorial-5.png"
                alt="Note flowing from one actor's outbox to other actor's inbox">
        </p>

        <p>
            很棒！
            过了一会，Alyssa 查看自己收到了哪些新消息。
            她的手机通过 GET 轮询自己的 inbox，看见好友们发的视频、姐姐发的侄子照片，
            还看到了如下内容：
        </p>

        <div class="example">
            <div class="example-title marker"><span>示例 4</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{"@context": "https://www.w3.org/ns/activitystreams",
 "type": "Create",
 "id": "https://chatty.example/ben/p/51086",
 "to": ["https://social.example/alyssa/"],
 "actor": "https://chatty.example/ben/",
 "object": {"type": "Note",
            "id": "https://chatty.example/ben/p/51085",
            "attributedTo": "https://chatty.example/ben/",
            "to": ["https://social.example/alyssa/"],
            "inReplyTo": "https://social.example/alyssa/posts/49e2d03d-b53a-4c4c-a95c-94a6abf45a19",
            "content": "&lt;p&gt;啊、好的，不好意思，明天还你。&lt;/p&gt;
                        &lt;p&gt;我最近在回顾寄存机那部分内容，已经有段时间没实现了。&lt;/p&gt;"}}</pre>
        </div>

        <p>Alyssa 如释重负，顺手点赞了 Ben 的帖子：</p>

        <div class="example">
            <div class="example-title marker"><span>示例 5</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{<span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
 <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Like"</span>,
 <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/posts/5312e10e-5110-42e5-a09b-934882b3ecec"</span>,
 <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://chatty.example/ben/"</span>],
 <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
 <span class="hljs-attr">"object"</span>: <span class="hljs-string">"https://chatty.example/ben/p/51086"</span>}</pre>
        </div>

        <p>
            她把这个消息 POST 到了自己的 outbox。
            （因为是 activity 她的服务器知道不需要再包一层 Create 对象）。
        </p>

        <p>
            开心之余，她又发了一条公开消息给所有粉丝。
            很快，下面这条消息广播给了全部 followers 集合成员，
            由于包含特殊的 Public 组，实际上对任何人可读。
        </p>

        <div class="example">
            <div class="example-title marker"><span>示例 6</span></div>
            <pre class="highlight json hljs" aria-busy="false" aria-live="polite">{<span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
 <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Create"</span>,
 <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/posts/9282e9cc-14d0-42b3-a758-d6aeca6c876b"</span>,
 <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://social.example/alyssa/followers/"</span>,
        <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>],
 <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
 <span class="hljs-attr">"object"</span>: {<span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://social.example/alyssa/posts/d18c55d4-8a63-4181-9745-4e6cf7938fa1"</span>,
            <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://social.example/alyssa/"</span>,
            <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://social.example/alyssa/followers/"</span>,
                   <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>],
            <span class="hljs-attr">"content"</span>: <span class="hljs-string">"把书借给朋友很开心，能拿回来更开心！:)"</span>}}</pre>
        </div>

        <section id="social-web-working-group" inlist="" rel="schema:hasPart" resource="#social-web-working-group">
            <h3 property="schema:name" id="x1-1-social-web-working-group"><span class="secno">1.1 </span>Social Web 工作组
            </h3>
            <div datatype="rdf:HTML" property="schema:description">
                <p>
                    <a href="#Overview">ActivityPub</a> 是 Social Web 工作组制定的多个相关规范之一。
                    对其他可选实现方式和补充协议感兴趣的实现者应查阅 [<cite><a class="bibref" href="#bib-Micropub">Micropub</a></cite>] 及
                    总览文档
                    [<cite><a class="bibref" href="#bib-Social-Web-Protocols">Social-Web-Protocols</a></cite>]。
                </p>
            </div>
        </section>
    </section>

    <section id="conformance"><!--OddPage-->
        <h2 id="x2-conformance"><span class="secno">2. </span>一致性</h2>
        <p>
            除了标明为非规范性的部分，所有创作指南、图示、示例和注释都属非规范范畴。本规范剩余所有内容均为规范性。
        </p>
        <p id="respecRFC2119">以下关键词 <em class="rfc2119">MAY</em>、<em class="rfc2119">MUST</em>、<em class="rfc2119">MUST
                NOT</em>、<em class="rfc2119">SHOULD</em> 以及 <em class="rfc2119">SHOULD NOT</em>
            的含义应按照 [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>] 定义理解。
        </p>

        <section id="specification-profiles">
            <h3 id="x2-1-specification-profiles"><span class="secno">2.1 </span>规范配置</h3>
            <p>
                本规范定义了两个密切关联并互有交互的协议：
            </p>
            <dl>
                <dt>客户端到服务器协议，或 "Social API"</dt>
                <dd>
                    该协议允许客户端<em>代表</em>用户行动。
                    例如，手机 App 可用该协议与用户的 actor 社交流交互。
                </dd>
                <dt>服务器到服务器协议，或 "联邦协议"</dt>
                <dd>
                    本协议用以在不同服务器的 actor 之间分发活动，将他们编织进同一社交图谱。
                </dd>
            </dl>
            <p>
                ActivityPub 设计思路是，只要任一协议实现，支持另一个的成本极低。
                但服务器可选实现其中任意一个。
                因此有三类一致性级别：
            </p>
            <dl>
                <dt>ActivityPub 兼容客户端</dt>
                <dd>
                    适用于实现客户端到服务器协议的全部客户端部分的任何实现。
                </dd>
                <dt>ActivityPub 兼容服务器</dt>
                <dd>
                    适用于实现客户端到服务器协议的全部服务器部分的任何实现。
                </dd>
                <dt>ActivityPub 兼容联邦服务器</dt>
                <dd>
                    适用于实现全部联邦协议部分的任何实现。
                </dd>
            </dl>
            <p>
                如果某部分只适用于联邦协议实现，会在规范中特别说明。
                此外，每当有具体要求时，会说明要求适用于客户端、服务器（针对客户端-服务器协议）或服务器到服务器协议中的发送/接收服务器。
            </p>
        </section>
    </section>

    <section id="obj">
        <!--OddPage-->
        <h2 id="x3-objects"><span class="secno">3. </span>对象</h2>
        <p>
            对象是 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 和 ActivityPub 的核心概念。
            对象常常被包裹在 Activity 中，位于集合的流中，而集合自身又是对象的子类。
            具体见 [<cite><a class="bibref" href="#bib-Activity-Vocabulary">Activity-Vocabulary</a></cite>] 文档，特别是
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#types">核心类别</a>；
            ActivityPub 与该词汇的映射非常紧密。
        </p>
        <p>
            除了 ActivityStreams 定义的术语，ActivityPub 还扩展了部分术语。
            这些术语都包含在 ActivityPub 的
            <a href="https://www.w3.org/TR/json-ld/#the-context">JSON-LD context</a>
            <code>https://www.w3.org/ns/activitystreams</code>。
            实现方 <em class="rfc2119" title="SHOULD">建议</em>在对象定义中包含 ActivityPub context。
            亦 <em class="rfc2119" title="MAY">可以</em>按需追加额外 context。
        </p>
        <p>
            ActivityPub 与 <a href="https://www.w3.org/TR/activitystreams-core/#urls">
                ActivityStreams 的 URI / IRI 约定</a>完全一致。
        </p>
        <p>
            服务器 <em class="rfc2119" title="SHOULD">建议</em>对收到的内容进行校验，防止内容伪造攻击。
            （服务器至少要判断对象内容与源头一致，更好则能校验签名）。
            本文档对校验机制未作强制规定，但具体建议和最佳实践请见 <a href="#security-considerations">安全性注意事项</a>。
        </p>
        <div class="informative">
            例如，example.com 收到如下 activity
            <div class="example">
                <div class="example-title marker"><span>示例 7</span></div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Like"</span>,
  <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://example.net/~mallory"</span>,
  <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://hatchat.example/sarah/"</span>,
         <span class="hljs-string">"https://example.com/peeps/john/"</span>],
  <span class="hljs-attr">"object"</span>: {
    <span class="hljs-attr">"@context"</span>: {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"en"</span>},
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.org/~alice/note/23"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
    <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://example.org/~alice"</span>,
    <span class="hljs-attr">"content"</span>: <span class="hljs-string">"I'm a goat"</span>
  }
}</pre>
            </div>
            那么它应当去 dereference <code>id</code>，确保该对象真实存在，并判断对象没有被伪造。
            （在该例里 Mallory 可能冒充由 Alice 发布的对象）。
        </div>
        <section id="obj-id">
            <h3 id="x3-1-object-identifiers"><span class="secno">3.1 </span>对象标识符</h3>
            <p>
                [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 的所有对象应具唯一全局标识。
                ActivityPub 进一步要求，所有通过 ActivityPub 协议分发的对象<em class="rfc2119" title="MUST">必须</em>具唯一全局标识，
                除非它们有意为临时对象（如某些聊天消息或游戏通知，仅短暂存在，无需可查询）。
                标识符需符合如下之一：
            </p>
            <ol>
                <li>
                    可公开 dereference 的 URI，比如 HTTPS URI，且授权域归属其原服务器。
                    （对外内容<em class="rfc2119" title="SHOULD">建议</em>使用 HTTPS URI）。
                </li>
                <li>
                    明确标记为 JSON <code>null</code>，此时是匿名对象（属于父上下文一部分）
                </li>
            </ol>
            <p>
                服务器间通信时，活动需<em class="rfc2119" title="MUST">必须</em>带标识符，除非活动本就为临时事务。
                而客户端到服务器通信时，服务器收到未指定 <code>id</code> 的 outbox 对象，
                <em class="rfc2119" title="SHOULD">建议</em>给其分配 actor 命名空间下的对象 ID 并附加到对象上。
            </p>
            <p>所有对象都有下列属性：</p>
            <dl>
                <dt>id</dt>
                <dd>
                    对象的唯一全局标识符（临时对象可省略）。
                </dd>
                <dt>type</dt>
                <dd>
                    对象的类型。
                </dd>
            </dl>
        </section>

        <section id="retrieving-objects">
            <h3 id="x3-2-retrieving-objects"><span class="secno">3.2 </span>获取对象</h3>
            <p>
                可用 HTTP GET 方法根据对象的<code>id</code>属性 dereference，获取活动。
                服务器<em class="rfc2119" title="MAY">可以</em>按 [<cite><a class="bibref"
                        href="#bib-RFC7231">RFC7231</a></cite>] 所述实现 HTTP 内容协商，
                选择响应类型，
                但<em class="rfc2119" title="MUST">必须</em>对
                <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
                提供 ActivityStreams 对象的表示，
                并且<em class="rfc2119" title="SHOULD">建议</em>对 <code>application/activity+json</code> 也提供 ActivityStreams
                表示。
                客户端<em class="rfc2119" title="MUST">必须</em>用 Accept 头带上
                <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
                类型以便获取该活动。
            </p>
            <p>
                服务器<em class="rfc2119" title="MAY">可以</em>对未满足上述要求的请求采取其他在合理范围内的行为。
                （如实现遗留协议，或对同一 URI 可返回 HTML 及 ActivityStreams 表示）。
            </p>
            <p>
                服务器<em class="rfc2119" title="MAY">可以</em>要求按
                <a href="#authorization" class="sec-ref"><span class="secno">B.1</span> <span
                        class="sec-title">身份验证与授权</span></a> 的说明进行授权，也可实现自有授权规则。
                服务器<em class="rfc2119" title="SHOULD">建议</em>对未通过授权校验的请求返回合适的 HTTP 错误码，若对象为私有可给 403 Forbidden。
                若服务器不希望泄漏私有目标 existence，<em class="rfc2119" title="MAY">可以</em>直接返回 404 Not Found。
            </p>
        </section>

        <section id="source-property">
            <h3 id="x3-3-the-source-property"><span class="secno">3.3 </span>source 属性</h3>
            <p>
                除了 [<cite><a class="bibref" href="#bib-Activity-Vocabulary">Activity-Vocabulary</a></cite>]
                定义的所有属性，ActivityPub 在 <code>Object</code> 上新增 <code>source</code> 属性。
                <code>source</code> 属性用于指示 <code>content</code> 标记是由什么源内容转换而来，作为溯源之用，也便于客户端未来再次编辑。
                一般来说，<code>source</code> 到 <code>content</code> 的转换由客户端完成，反向则不然。
            </p>
            <p>
                <code>source</code> 的值本身是对象，包含自有的 <code>content</code> 和 <code>mediaType</code> 字段，表明源内容信息。
            </p>
            <div class="example">
                <div class="example-title marker"><span>示例 8</span></div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: [<span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
               {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"en"</span>}],
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"http://postparty.example/p/2415"</span>,
  <span class="hljs-attr">"content"</span>: <span class="hljs-string">"&lt;p&gt;我 &lt;em&gt;真的&lt;/em&gt;喜欢草莓！&lt;/p&gt;"</span>,
  <span class="hljs-attr">"source"</span>: {
    <span class="hljs-attr">"content"</span>: <span class="hljs-string">"I *really* like strawberries!"</span>,
    <span class="hljs-attr">"mediaType"</span>: <span class="hljs-string">"text/markdown"</span>}
}</pre>
            </div>
            <div class="note">
                <div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>注</span><span
                        style="text-transform: none">：当客户端无法正确处理 mediaType 时怎么办？</span></div>
                <div class="">
                    <p>
                        通常最好让用户用自己最初写文章时的源格式进行编辑。
                        但并非所有客户端都能优雅支持所有源类型，既然由客户端负责从 <code>source</code> 转 <code>content</code>，
                        就有可能有些客户端可用的 media type，另一些并不识别。
                        虽然可直接让用户编辑 <code>content</code> 而忽略 source，不过这样任何将来修订都会丢失原 <code>source</code> 的最好形态。
                        客户端因此应弹出最小程度的提示，告知原始源格式无法识别，编辑将丢失原格式。
                    </p>
                    <p>
                        例如 Alyssa P. Hacker 喜欢用她自己写的 Emacs 客户端通过 ActivityPub 博客发表内容，用 <a href="http://orgmode.org/">Org
                            mode</a>。
                        后来她换了手机客户端编辑，手机端不认识 <code>text/x-org</code> 也不会渲染，只好用文本框让她直接编辑 <code>content</code>。
                        编辑区上方弹窗提示：“这段内容原本用我们不支持的标记语言写，若你编辑，原文会丢失！”
                        Alyssa 觉得为修个拼写错误失去 org-mode 标记不值，决定到家后再用 Emacs 修。
                    </p>
                </div>
            </div>
        </section>
    </section>

    <section id="actors">
        <!--OddPage-->
        <h2 id="x4-actors"><span class="secno">4. </span>参与者（Actors）</h2>
        <p>
            ActivityPub 的参与者通常是
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#actor-types">
                ActivityStreams 中的 Actor 类型</a>之一，
            但不必然如此。例如，
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-profile">
                Profile</a> 对象
            也可以用作参与者，或者采用 ActivityStreams 扩展中的类型。
            参与者的<a href="#retrieving-objects">获取方式</a>与 ActivityPub 中其他对象相同。
            和其他 ActivityStreams 对象一样，参与者拥有 <code>id</code>，它是一个 URI。
            当直接在用户界面输入（如登录表单）时，建议支持简化命名方式。
            为此，ID 归一化<em class="rfc2119" title="SHOULD">建议</em>按如下方式执行：
        </p>
        <ol>
            <li>
                如果输入的 ID 是有效的 URI，则直接使用即可。
            </li>
            <li>
                如果看起来用户只是忘记添加 URI 的协议头，而其它内容无误，例如
                <code>example.org/alice/</code>，客户端<em class="rfc2119" title="MAY">可以</em>尝试补全默认协议，推荐
                <code>https</code>。
            </li>
            <li>
                否则，应视为无效输入。
            </li>
        </ol>

        <p>
            一旦确定了参与者 URI，应进行 dereference。
        </p>

        <div class="note">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>注</span></div>
            <div class="">
                ActivityPub 并未规定“用户”与参与者之间的具体关系，可以有多种配置方式。
                一个 Actor 可以由多个用户或组织共同控制；同理，一个用户或组织也可控制多个参与者。Actor 也可以表示一段软件、机器人或自动化进程。
                更详细的“用户”建模，例如将归属于同一实体的多个参与者关联在一起，或让一个参与者通过多个不同资料视角展现，都由具体实现决定。
            </div>
        </div>

        <section id="actor-objects">
            <h3 id="x4-1-actor-objects"><span class="secno">4.1 </span><i>Actor</i> 对象</h3>
            <p>
                除了<a href="#obj-id" class="sec-ref"><span class="secno">3.1</span> <span
                        class="sec-title">对象标识符</span></a>要求的属性外，Actor 对象<em class="rfc2119" title="MUST">必须</em>具备以下属性：
            </p>
            <dl>
                <dt id="inbox-property">inbox</dt>
                <dd>
                    指向一个 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>]
                    <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                        <code>OrderedCollection</code></a>
                    ，包含该参与者接收到的所有消息；详见
                    <a href="#inbox" class="sec-ref"><span class="secno">5.2</span> <span
                            class="sec-title">Inbox</span></a>。
                </dd>
                <dt id="outbox-property">outbox</dt>
                <dd>
                    指向一个 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>]
                    <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                        <code>OrderedCollection</code></a>
                    ，包含该参与者产生的所有消息；详见
                    <a href="#outbox" class="sec-ref"><span class="secno">5.1</span> <span
                            class="sec-title">Outbox</span></a>。
                </dd>
            </dl>
            <p>
                实现<em class="rfc2119" title="SHOULD">建议</em>另外提供以下属性：
            </p>
            <dl>
                <dt id="following-property">following</dt>
                <dd>
                    指向一个 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>]
                    集合，表示本参与者关注的对象；
                    详见 <a href="#following" class="sec-ref"><span class="secno">5.4</span> <span
                            class="sec-title">Following Collection</span></a>
                </dd>
                <dt id="followers-property">followers</dt>
                <dd>
                    指向一个 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 集合，表示关注本参与者的人；
                    详见 <a href="#followers" class="sec-ref"><span class="secno">5.3</span> <span
                            class="sec-title">Followers Collection</span></a>。
                </dd>
            </dl>
            <p>
                实现<em class="rfc2119" title="MAY">可以</em>再补充下列属性：
            </p>
            <dl>
                <dt id="liked-property">liked</dt>
                <dd>
                    指向一个 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>]
                    集合，包含该参与者点赞过的对象；
                    详见 <a href="#liked" class="sec-ref"><span class="secno">5.5</span> <span class="sec-title">Liked
                            Collection</span></a>。
                </dd>
            </dl>
            <div class="example">
                <div class="example-title marker"><span>示例 9</span></div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: [<span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
               {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"ja"</span>}],
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://kenzoishii.example.com/"</span>,
  <span class="hljs-attr">"following"</span>: <span class="hljs-string">"https://kenzoishii.example.com/following.json"</span>,
  <span class="hljs-attr">"followers"</span>: <span class="hljs-string">"https://kenzoishii.example.com/followers.json"</span>,
  <span class="hljs-attr">"liked"</span>: <span class="hljs-string">"https://kenzoishii.example.com/liked.json"</span>,
  <span class="hljs-attr">"inbox"</span>: <span class="hljs-string">"https://kenzoishii.example.com/inbox.json"</span>,
  <span class="hljs-attr">"outbox"</span>: <span class="hljs-string">"https://kenzoishii.example.com/feed.json"</span>,
  <span class="hljs-attr">"preferredUsername"</span>: <span class="hljs-string">"kenzoishii"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"石井健蔵"</span>,
  <span class="hljs-attr">"summary"</span>: <span class="hljs-string">"この方はただの例です"</span>,
  <span class="hljs-attr">"icon"</span>: [
    <span class="hljs-string">"https://kenzoishii.example.com/image/165987aklre4"</span>
  ]
}</pre>
            </div>
            <p>实现<em class="rfc2119" title="MAY">可以</em>进一步提供以下属性：</p>
            <dl>
                <dt id="streams-property">streams</dt>
                <dd>
                    一个补充集合的列表，可能对用户有参考价值。
                </dd>
                <dt id="preferredUsername">preferredUsername</dt>
                <dd>
                    可用来指代该参与者的短用户名，无唯一性保证。
                </dd>
                <dt id="endpoints">endpoints</dt>
                <dd>
                    一个 json 对象，映射了额外（一般为服务端/域全局）的端点，这些可能对该参与者或引用者有用。
                    此 mapping 可以嵌入 actor 文档，也可链至带这些属性的 JSON-LD 文档。
                </dd>
            </dl>

            <p>
                <code>endpoints</code> mapping <em class="rfc2119" title="MAY">可以</em>包含如下属性：
            </p>
            <dl>
                <dt id="proxyUrl">proxyUrl</dt>
                <dd>
                    端点 URI，允许该参与者的客户端访问需认证的远程 ActivityStreams 对象。
                    用法：客户端 POST 一个 <code>x-www-form-urlencoded</code> 格式的 <code>id</code> 参数，
                    值为请求 ActivityStreams 对象的 <code>id</code>。
                </dd>
                <dt id="oauthAuthorizationEndpoint">oauthAuthorizationEndpoint</dt>
                <dd>
                    如果认证使用 OAuth 2.0 令牌 [<cite><a class="bibref" href="#bib-RFC6749">RFC6749</a></cite>]
                    [<cite><a class="bibref" href="#bib-RFC6750">RFC6750</a></cite>]，
                    该端点为浏览器认证用户获取授权凭证的 URI，用于
                    <a href="#client-to-server-interactions">客户端到服务器交互</a>。
                </dd>
                <dt id="oauthTokenEndpoint">oauthTokenEndpoint</dt>
                <dd>
                    如果认证使用 OAuth 2.0 令牌 [<cite><a class="bibref" href="#bib-RFC6749">RFC6749</a></cite>]
                    [<cite><a class="bibref" href="#bib-RFC6750">RFC6750</a></cite>]，
                    该端点为客户端获取访问令牌的 URI，用于
                    <a href="#client-to-server-interactions">客户端到服务器交互</a>。
                </dd>
                <dt id="provideClientKey">provideClientKey</dt>
                <dd>
                    如果使用 Linked Data Signatures 或 HTTP Signatures 做认证/授权，该端点为浏览器认证用户授权客户端公钥提供 URI，
                    用于 <a href="#client-to-server-interactions">客户端到服务器交互</a>。
                </dd>
                <dt id="signClientKey">signClientKey</dt>
                <dd>
                    如果使用 Linked Data Signatures 或 HTTP Signatures 做认证/授权，该端点为客户端密钥由 actor 密钥签名授权一段时间、代表用户操作外部服务器时提供 URI。
                </dd>
                <dt id="sharedInbox">sharedInbox</dt>
                <dd>
                    可选端点
                    <a href="#shared-inbox-delivery">
                        用于大范围推送面向公开与粉丝的活动</a>。
                    <code>sharedInbox</code> 端点<em class="rfc2119" title="SHOULD">建议</em>也是公开可读
                    <code>OrderedCollection</code>，只包含指向 <a href="#public-addressing">Public</a>
                    特殊集合的对象。
                    读取 <code>sharedInbox</code> 端点<em class="rfc2119" title="MUST NOT">禁止</em>展现非指向 <code>Public</code>
                    的对象。
                </dd>
            </dl>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>注</span></div>
                <div class="" id="as2-actor-properties">
                    <p>
                        作为 ActivityPub 的上游词汇，任何适用的
                        [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 属性都可用于
                        ActivityPub Actor。
                        这里特别重点列举一些 ActivityStreams 属性，说明其在 ActivityPub 实现中的用法。
                    </p>

                    <dl>
                        <dt id="url-property">url</dt>
                        <dd>
                            指向 actor 的“简介网页”，若不同于 <code>id</code> 字段。
                        </dd>
                        <dt id="name-property">name</dt>
                        <dd>
                            actor 的“昵称”或“显示名”。
                        </dd>
                        <dt id="summary-property">summary</dt>
                        <dd>用户自我简介、个人简介。</dd>
                        <dt id="icon-property">icon</dt>
                        <dd>
                            指向用户头像图片或 Image 对象的链接（可为缩略图）。
                        </dd>
                    </dl>
                </div>
            </div>
            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>注</span></div>
                <p class="" id="actor-text-direction">
                    包含自然语言值的属性，
                    如 <code>name</code>、<code>preferredUsername</code> 或 <code>summary</code>
                    ，均遵循
                    <a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">
                        ActivityStreams 中定义的自然语言支持机制</a>。
                </p>
            </div>
        </section>
    </section>

    <section id="collections">
        <!--OddPage-->
        <h2 id="x5-collections"><span class="secno">5. </span>集合（Collections）</h2>
        <p>
            [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 定义了 collection（集合）概念；
            ActivityPub 定义了几种带特殊行为的集合。
            注意 ActivityPub 利用
            <a href="https://www.w3.org/TR/activitystreams-core/#paging">
                ActivityStreams 分页机制</a>
            遍历大对象集。
        </p>

        <p>
            注意，这些集合有的明确类型为
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                <code>OrderedCollection</code></a>
            ，部分则允许为
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                <code>Collection</code></a>
            或
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                <code>OrderedCollection</code></a>
            。
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                <code>OrderedCollection</code></a>
            <em class="rfc2119" title="MUST">必须</em>始终以逆时间顺序展现。
        </p>

        <div class="note">
            <div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>注</span></div>
            <p class="">
                用于排序逆时间顺序的属性定义是实现细节，未固定。许多 SQL 风格数据库会用自增主键作标识，这在多数场合适于插入顺序。
                也可在其他数据库用插入时间戳。关键是要保证新项目在前，顺序不乱。
                不建议用频繁变动的字段（如“上次更新时间戳”）排序。
            </p>
        </div>

        <section id="outbox">
            <h3 id="x5-1-outbox"><span class="secno">5.1 </span>Outbox</h3>
            <p>
                outbox 可通过 <a href="#actors">actor</a> 资料里的 <code>outbox</code> 属性发现。
                <code>outbox</code> 字段<em class="rfc2119" title="MUST">必须</em>为一个
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>。
            </p>
            <p>
                outbox 数据流包含用户已发布的活动，其内容是否可见还受请求者权限影响（即 outbox 的内容必须根据阅读者的权限过滤）。
                若某用户未含
                <a href="#authorization">授权信息</a>，服务端仅应返回所有 <a href="#public-addressing">Public</a>
                帖子。
                这也许就是用户发布所有相关对象，但数量多少由服务器实现自行决定。
            </p>
            <p>
                outbox 支持 HTTP POST，详细行为见
                <a href="#client-to-server-interactions">客户端到服务器交互</a>。
            </p>
        </section>

        <section id="inbox">
            <h3 id="x5-2-inbox"><span class="secno">5.2 </span>Inbox</h3>

            <p>
                inbox 可通过 <a href="#actors">actor</a> 资料的 <code>inbox</code> 字段发现。
                <code>inbox</code> 字段<em class="rfc2119" title="MUST">必须</em>是
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>。
            </p>

            <p>
                inbox 数据流包含参与者接收到的所有活动。
                服务器<em class="rfc2119" title="SHOULD">建议</em>根据请求者权限过滤内容。
                一般说，inbox 的所有者能访问全部内容。依据访问控制，部分内容对公共公开，部分内容仅授权用户可见。
                非 owner 用户按访问权限限制。
            </p>

            <p>
                服务端<em class="rfc2119" title="MUST">必须</em>对返回的 inbox 活动去重。若某活动既发给了 actor
                的粉丝，又发给了其中一位关注者且两端都命中，极易产生重复。实现必须按 <code>id</code> 比较，丢弃已收录的活动，避免重复。
            </p>

            <p>
                联邦服务器的参与者 inbox 支持 HTTP POST，详细行为见 <a href="#delivery">Delivery</a>。
                非联邦服务器<em class="rfc2119" title="SHOULD">建议</em>遇 POST 请求返回 405 Method Not Allowed。
            </p>
        </section>

        <section id="followers">
            <h3 id="x5-3-followers-collection"><span class="secno">5.3 </span>Followers Collection</h3>
            <p>
                每个<a href="#actors">actor</a><em class="rfc2119" title="SHOULD">建议</em>拥有 <code>followers</code>
                集合。
                该集合包括所有向该参与者发送过
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-follow">Follow</a>
                活动的用户，作为
                <a href="#follow-activity-outbox">副作用</a>添加。
                这里可查所有关注该 actor 的人。
                <code>followers</code> 集合<em class="rfc2119" title="MUST">必须</em>为
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>
                或
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                    <code>Collection</code></a>
                ，并<em class="rfc2119" title="MAY">可以</em>结合权限过滤。
            </p>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-4" aria-level="4"><span>注</span><span
                        style="text-transform: none">：通知投递默认目标</span></div>
                <p class="">
                    follow 行为一般代表希望看到 actor 的动态，因此 Followers 集合是通知
                    <a href="#delivery">delivery</a>的合理默认目标。
                </p>
            </div>
        </section>

        <section id="following">
            <h3 id="x5-4-following-collection"><span class="secno">5.4 </span>Following Collection</h3>
            <p>
                每个 actor <em class="rfc2119" title="SHOULD">建议</em>拥有 <code>following</code> 集合。
                其列出演员已关注的所有人，均为
                <a href="#follow-activity-outbox">副作用</a>追加。
                <code>following</code> 集合<em class="rfc2119" title="MUST">必须</em>为
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>
                或
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                    <code>Collection</code></a>
                ，<em class="rfc2119" title="MAY">可以</em>结合权限过滤。
            </p>
        </section>

        <section id="liked">
            <h3 id="x5-5-liked-collection"><span class="secno">5.5 </span>Liked Collection</h3>
            <p>
                每个 actor <em class="rfc2119" title="MAY">可以</em>拥有 <code>liked</code> 集合。
                该集合是所有该 actor <code>Like</code>
                活动对象的集合，均为<a href="#like-activity-outbox">副作用</a>追加。
                <code>liked</code> 集合<em class="rfc2119" title="MUST">必须</em>为
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>
                或
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                    <code>Collection</code></a>
                ，<em class="rfc2119" title="MAY">可以</em>结合权限过滤。
            </p>
        </section>

        <section id="public-addressing">
            <h3 id="x5-6-public-addressing"><span class="secno">5.6 </span>公开寻址</h3>
            <p>
                除了 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>]
                集合和对象外，
                Activity 还可寻址特殊 "public" 集合，其标识为
                <code>https://www.w3.org/ns/activitystreams#Public</code>。
                例如：
            </p>
            <div class="example">
                <div class="example-title marker"><span>示例 10</span></div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Collection"</span>
}</pre>
            </div>
            <p>
                发往该特殊 URI 的 Activity 应无认证限制对所有用户可访问。
                实现<em class="rfc2119" title="MUST NOT">禁止</em>将实际活动直接投递给"public"集合；
                该集合不能接收内容。
                不过，actor<em class="rfc2119" title="MAY">可以</em>定义
                <a href="#sharedInbox"><code>sharedInbox</code></a>
                端点，提升公共/粉丝消息的投递效率；详见
                <a href="#shared-inbox-delivery" class="sec-ref"><span class="secno">7.1.3</span> <span
                        class="sec-title">共享收件箱投递</span></a>。
            </p>
            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>注</span></div>
                <div class="">
                    <p>
                        用 ActivityStreams 的 JSON-LD context
                        简化对象时，<code>https://www.w3.org/ns/activitystreams#Public</code>
                        可被简化为 <code>Public</code> 或 <code>as:Public</code>，三者均为 Public 集合的有效表示。
                        只将对象视作普通 JSON 处理而不转换 context 的实现要兼容所有三者写法。
                    </p>
                </div>
            </div>
        </section>

        <section id="likes">
            <h3 id="x5-7-likes-collection"><span class="secno">5.7 </span>Likes Collection</h3>
            <p>
                每个对象<em class="rfc2119" title="MAY">可以</em>有 <code>likes</code> 集合。
                该集合包含所有以该对象为 <code>object</code> 的 <code>Like</code>
                活动，为<a href="#like-activity-inbox">副作用</a>自动添加。
                <code>likes</code> 集合<em class="rfc2119" title="MUST">必须</em>为
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>
                或
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                    <code>Collection</code></a>
                ，<em class="rfc2119" title="MAY">可以</em>结合权限过滤。
            </p>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>注</span></div>
                <div class="">
                    <p>
                        注意不要混淆
                        <a href="#likes"><code>likes</code></a>
                        与类似命名、但不同的
                        <a href="#liked"><code>liked</code></a> 集合。
                        总结如下：
                    </p>

                    <ul>
                        <li>
                            <b>liked:</b>
                            仅为 actor 的属性。
                            该集合包含<i>actor 发出的</i>所有 <code>Like</code> 活动，
                            通过<a href="#like-activity-outbox">
                                投递到 outbox 的副作用</a>添加。
                        </li>

                        <li>
                            <b>likes:</b>
                            可为任何对象的属性。
                            该集合包含所有以此对象为 <code>object</code> 的 <code>Like</code> 活动，
                            通过<a href="#like-activity-inbox">
                                投递到 inbox 的副作用</a>添加。
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="shares">
            <h3 id="x5-8-shares-collection"><span class="secno">5.8 </span>Shares Collection</h3>
            <p>
                每个对象<em class="rfc2119" title="MAY">可以</em>有 <code>shares</code> 集合。
                这集合包含所有以此对象为 <code>object</code> 的 <code>Announce</code> 活动，
                为<a href="#announce-activity-inbox">副作用</a>添加。
                <code>shares</code> 集合<em class="rfc2119" title="MUST">必须</em>为
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
                    <code>OrderedCollection</code></a>
                或
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
                    <code>Collection</code></a>
                ，<em class="rfc2119" title="MAY">可以</em>结合权限过滤。
            </p>
        </section>
    </section>

    <section id="client-to-server-interactions">
        <!--OddPage-->
        <h2 id="x6-client-to-server-interactions"><span class="secno">6. </span>客户端到服务器交互</h2>
        <p>
            由 [<cite><a class="bibref" href="#bib-ActivityStreams">ActivityStreams</a></cite>] 定义的
            Activity，是在社交图谱中创建、修改和分享内容的核心机制。
        </p>

        <p>
            客户端与服务器的交互通过客户端将 Activity 提交到参与者的<a href="#outbox">outbox</a>实现。
            为此，客户端<em class="rfc2119" title="MUST">必须</em>从其<a href="#actor-objects">个人资料</a>中发现 outbox 的 URL，然后<em
                class="rfc2119" title="MUST">必须</em>对该 URL 发起 HTTP <code>POST</code>请求，Content-Type
            为<code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>。
            服务器<em class="rfc2119" title="MAY">可以</em>将 Content-Type 或 Accept
            头为<code>application/activity+json</code>视为等同于<code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>对待。
            请求<em class="rfc2119" title="MUST">必须</em>用 outbox 所属用户的身份凭证进行认证。
            <code>POST</code>请求体<em class="rfc2119" title="MUST">必须</em>包含一个 Activity（<em class="rfc2119"
                title="MAY">可以</em>包含嵌套对象），或一个非 Activity 对象（<a href="#object-without-create">服务器会自动包裹成 Create
                activity</a>）。
        </p>
        <div class="example">
            <div class="example-title marker"><span>示例 11</span><span style="text-transform: none">：提交 Activity 到
                    Outbox</span></div>
            <pre class="hljs http" aria-busy="false" aria-live="polite"><span class="hljs-keyword">POST</span> <span class="hljs-string">/outbox/</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: dustycloud.org
<span class="hljs-attribute">Authorization</span>: Bearer XXXXXXXXXXX
<span class="hljs-attribute">Content-Type</span>: application/ld+json; profile="https://www.w3.org/ns/activitystreams"

<span class="json">{
  <span class="hljs-attr">"@context"</span>: [<span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
               {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"en"</span>}],
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Like"</span>,
  <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://dustycloud.org/chris/"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Chris liked 'Minimal ActivityPub update client'"</span>,
  <span class="hljs-attr">"object"</span>: <span class="hljs-string">"https://rhiaro.co.uk/2016/05/minimal-activitypub"</span>,
  <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://rhiaro.co.uk/#amy"</span>,
         <span class="hljs-string">"https://dustycloud.org/followers"</span>,
         <span class="hljs-string">"https://rhiaro.co.uk/followers/"</span>],
  <span class="hljs-attr">"cc"</span>: <span class="hljs-string">"https://e14n.com/evan"</span>
}</span></pre>
        </div>

        <p>
            如果 Activity 的 <code>id</code> 字段有值，服务器<em class="rfc2119" title="MUST">必须</em>忽略该值并为其生成新的 <code>id</code>。
            服务器<em class="rfc2119" title="MUST">必须</em>返回 <code>201 Created</code>，除非该 activity 是临时的，否则<em
                class="rfc2119" title="MUST">必须</em>在 <code>Location</code> 头返回新 <code>id</code>。
        </p>
        <div class="example">
            <div class="example-title marker"><span>示例 12</span><span style="text-transform: none">：Outbox 对 Activity
                    的响应</span></div>
            <pre class="hljs http" aria-busy="false" aria-live="polite">HTTP/1.1 <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Location</span>: https://dustycloud.org/likes/345</pre>
        </div>

        <p id="remove-bto-bcc-before-delivery">
            服务器<em class="rfc2119" title="MUST">必须</em>在分发前移除 ActivityStreams 对象的 <code>bto</code> 和/或 <code>bcc</code>
            属性，但<em class="rfc2119" title="MUST">必须</em>用它们原本保存的地址信息判断 <a href="#delivery">投递</a>时的收件人。
        </p>

        <p>
            服务器<em class="rfc2119" title="MUST">必须</em>把该 Activity 加入<a href="#outbox">outbox</a>集合。
            根据 Activity 类型，服务器可能还需要执行其他副作用操作。
            （但不能保证 Activity 何时出现在 outbox，中间可能有延迟，也可能随时删除）。
            具体副作用见后续各 Activity 说明。
        </p>

        <p>
            尝试向未实现客户端到服务器支持的服务器提交对象，<em class="rfc2119" title="SHOULD">建议</em>返回 <code>405 Method Not Allowed</code> 响应。
        </p>

        <p>
            HTTP 缓存机制 [<cite><a class="bibref" href="#bib-RFC7234">RFC7234</a></cite>] 在客户端与服务器响应中，<em class="rfc2119"
                title="SHOULD">建议</em>按需支持。
        </p>

        <section id="client-addressing">
            <h3 id="x6-1-client-addressing"><span class="secno">6.1 </span>客户端寻址</h3>
            <p>
                <strong>客户端</strong>负责为新 Activity 合理寻址（指定收件人）。
                在一定程度上这取决于客户端具体实现，但需注意服务器只会向<code>to</code>、<code>bto</code>、<code>cc</code>、<code>bcc</code>、<code>audience</code>
                字段指定的收件人分发 Activity。
            </p>
            <p>
                <a href="#followers">Followers 集合</a>和/或<a href="#public-addressing">Public 集合</a>是新 Activity 默认寻址的好选择。
            </p>
            <p>
                客户端<em class="rfc2119" title="SHOULD">建议</em>遍历新 Activity 附带对象的
                <code>object</code>、<code>target</code>、<code>inReplyTo</code>、<code>tag</code> 字段，获取它们的
                <code>actor</code> 或 <code>attributedTo</code> 属性，还<em class="rfc2119"
                    title="MAY">可以</em>获取其地址信息，并将这些加入新 Activity 的 <code>to</code> 或 <code>cc</code> 字段。
                客户端<em class="rfc2119" title="MAY">可以</em>递归遍历嵌套对象，如递归时<em class="rfc2119"
                    title="SHOULD">建议</em>设置递归深度限制。
                （注意不建议“展开”被寻址的 actor 集合作为单独收件人）。
            </p>
            <p>
                客户端<em class="rfc2119" title="MAY">可以</em>为用户在界面提供修改寻址的机会。
            </p>
            <p>
                例如 Chris 对 Amy 这篇文章点赞：
            </p>

            <div class="example">
                <div class="example-title marker"><span>示例 13</span><span style="text-transform: none">：一篇文章</span>
                </div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: [<span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
               {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"en-GB"</span>}],
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://rhiaro.co.uk/2016/05/minimal-activitypub"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Article"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Minimal ActivityPub update client"</span>,
  <span class="hljs-attr">"content"</span>: <span class="hljs-string">"Today I finished morph, a client for posting ActivityStreams2..."</span>,
  <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://rhiaro.co.uk/#amy"</span>,
  <span class="hljs-attr">"to"</span>: <span class="hljs-string">"https://rhiaro.co.uk/followers/"</span>,
  <span class="hljs-attr">"cc"</span>: <span class="hljs-string">"https://e14n.com/evan"</span>
}</pre>
            </div>

            <p>客户端产生如下 Like：</p>

            <div class="example">
                <div class="example-title marker"><span>示例 14</span><span style="text-transform: none">：对文章点赞</span>
                </div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: [<span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
               {<span class="hljs-attr">"@language"</span>: <span class="hljs-string">"en"</span>}],
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Like"</span>,
  <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://dustycloud.org/chris/"</span>,
  <span class="hljs-attr">"summary"</span>: <span class="hljs-string">"Chris liked 'Minimal ActivityPub update client'"</span>,
  <span class="hljs-attr">"object"</span>: <span class="hljs-string">"https://rhiaro.co.uk/2016/05/minimal-activitypub"</span>,
  <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://rhiaro.co.uk/#amy"</span>,
         <span class="hljs-string">"https://dustycloud.org/followers"</span>,
         <span class="hljs-string">"https://rhiaro.co.uk/followers/"</span>],
  <span class="hljs-attr">"cc"</span>: <span class="hljs-string">"https://e14n.com/evan"</span>
}</pre>
            </div>

            <p>接收的 outbox 可据此将消息投递给 Chris（点赞者）的粉丝、Amy、Amy 的粉丝和收到原始文章的 Evan。</p>

            <p>
                客户端向 <code>outbox</code> 提交如下活动时<em class="rfc2119" title="MUST">必须</em>在 activity 中提供
                <code>object</code> 属性：
                <code>Create</code>、<code>Update</code>、<code>Delete</code>、
                <code>Follow</code>、<code>Add</code>、<code>Remove</code>、
                <code>Like</code>、<code>Block</code>、<code>Undo</code>。
                另外针对 <code>Add</code>、<code>Remove</code>，还<em class="rfc2119" title="MUST">必须</em>一同提交
                <code>target</code> 属性。
            </p>

        </section>


        <section id="create-activity-outbox">
            <h3 id="x6-2-create-activity"><span class="secno">6.2 </span>Create Activity</h3>
            <p>
                <code>Create</code> 活动用于发布新对象。
                其副作用是 activity 中嵌入的对象（在 <code>object</code> 属性中）被创建。
            </p>
            <p>
                <code>Create</code> 活动被提交时，活动的 <code>actor</code><em class="rfc2119" title="SHOULD">建议</em>复制到
                <code>object</code> 的 <code>attributedTo</code> 字段。
            </p>
            <p>
                Create activity 与包裹对象的地址信息不一致容易让人困惑。因此服务器<em class="rfc2119" title="SHOULD">建议</em>在最初分发时，将 Create
                activity 的收件人复制到 <code>object</code>，或将 <code>object</code> 的收件人复制给外层 Create。
                之后如 <code>object</code> 的收件人发生变更无需同步到 Create 的地址（如后续通过 <code>Update</code> activity）。
            </p>

            <section id="object-without-create">
                <h4 id="x6-2-1-object-creation-without-a-create-activity"><span class="secno">6.2.1 </span>无 Create
                    Activity 的对象创建</h4>
                <p>
                    客户端到服务器时，也可直接提交一个对象，无需外层包裹 activity。
                    服务器<em class="rfc2119" title="MUST">必须</em>接收有效的 [<cite><a class="bibref"
                            href="#bib-ActivityStreams">ActivityStreams</a></cite>] 对象，只要它不是 Activity 的子类型，即可直接 POST 至
                    outbox。
                    之后服务器<em class="rfc2119" title="MUST">必须</em>用该对象作为 <a href="#create-activity-outbox">Create
                        Activity</a> 的 <code>object</code>，自动包裹一层。
                    如非临时对象，服务器还<em class="rfc2119" title="MUST">必须</em>为外层 Create 和被包裹对象都分配 <code>id</code>。
                </p>

                <div class="note">
                    <div role="heading" class="note-title marker" id="h-note-7" aria-level="5"><span>注</span></div>
                    <p class="">
                        服务器返回的 <code>Location</code> 应为新的 Create 活动的 URL，而非对象本身。
                    </p>
                </div>

                <p>
                    对象中指定的 <code>to</code>、<code>bto</code>、<code>cc</code>、<code>bcc</code>、<code>audience</code>
                    字段，服务器<em class="rfc2119" title="MUST">必须</em>同步复制到新的 Create activity。
                </p>

                <div class="example">
                    <div class="example-title marker"><span>示例 15</span><span style="text-transform: none">：带 audience
                            定向属性的对象</span></div>
                    <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
  <span class="hljs-attr">"content"</span>: <span class="hljs-string">"This is a note"</span>,
  <span class="hljs-attr">"published"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>,
  <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://example.org/~john/"</span>],
  <span class="hljs-attr">"cc"</span>: [<span class="hljs-string">"https://example.com/~erik/followers"</span>,
         <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>]
}</pre>
                </div>

                上例提交后可被转化为：
                <div class="example">
                    <div class="example-title marker"><span>示例 16</span><span style="text-transform: none">：服务器生成的
                            Create Activity 包裹体</span></div>
                    <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Create"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.net/~mallory/87374"</span>,
  <span class="hljs-attr">"actor"</span>: <span class="hljs-string">"https://example.net/~mallory"</span>,
  <span class="hljs-attr">"object"</span>: {
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/~mallory/note/72"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Note"</span>,
    <span class="hljs-attr">"attributedTo"</span>: <span class="hljs-string">"https://example.net/~mallory"</span>,
    <span class="hljs-attr">"content"</span>: <span class="hljs-string">"This is a note"</span>,
    <span class="hljs-attr">"published"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>,
    <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://example.org/~john/"</span>],
    <span class="hljs-attr">"cc"</span>: [<span class="hljs-string">"https://example.com/~erik/followers"</span>,
           <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>]
  },
  <span class="hljs-attr">"published"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>,
  <span class="hljs-attr">"to"</span>: [<span class="hljs-string">"https://example.org/~john/"</span>],
  <span class="hljs-attr">"cc"</span>: [<span class="hljs-string">"https://example.com/~erik/followers"</span>,
         <span class="hljs-string">"https://www.w3.org/ns/activitystreams#Public"</span>]
}</pre>
                </div>
            </section>
        </section>
        <section id="update-activity-outbox">
            <h3 id="x6-3-update-activity"><span class="secno">6.3 </span>Update Activity</h3>
            <p>
                <code>Update</code> 活动用于修改已有对象。
                副作用是<code>object</code><em class="rfc2119" title="MUST">必须</em>被修改为更新活动中定义的新结构，前提是 actor 有权限。
            </p>

            <section id="partial-updates">
                <h4 id="x6-3-1-partial-updates"><span class="secno">6.3.1 </span>部分更新</h4>
                <p>
                    对于客户端-服务器交互，更新为部分更新；仅替换顶层字段中的任意键值，新值覆盖旧值。
                    若值为 JSON 的 <code>null</code>，表示该字段应从服务器上的对象表示中删除。
                </p>
                <p>
                    注意此行为仅适用客户端 POST 到服务器。服务器间通信和服务器到客户端推送应携带更新后的完整对象表示。
                    见 <a href="#update-activity-inbox">服务器间 Update 活动说明</a> 了解详情。
                </p>
            </section>
        </section>
        <section id="delete-activity-outbox">
            <h3 id="x6-4-delete-activity"><span class="secno">6.4 </span>Delete Activity</h3>
            <p>
                <code>Delete</code> 活动用于删除已有对象。
                其副作用是服务器<em class="rfc2119" title="MAY">可以</em>把 <code>object</code> 替换为 <code>Tombstone</code>
                对象，以在引用已删除对象的活动中显示。
                当请求已删除对象时，若响应体为 <code>Tombstone</code>，服务器<em class="rfc2119" title="SHOULD">建议</em>返回 HTTP 410
                Gone，否则返回 404 Not Found。
            </p>

            <p>被删除的对象示例：</p>
            <div class="example">
                <div class="example-title marker"><span>示例 17</span></div>
                <pre class="hljs json" aria-busy="false" aria-live="polite">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.w3.org/ns/activitystreams"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/~alice/note/72"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Tombstone"</span>,
  <span class="hljs-attr">"published"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>,
  <span class="hljs-attr">"updated"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>,
  <span class="hljs-attr">"deleted"</span>: <span class="hljs-string">"2015-02-10T15:04:55Z"</span>
}</pre>
            </div>
        </section>
        <section id="follow-activity-outbox">
            <h3 id="x6-5-follow-activity"><span class="secno">6.5 </span>Follow Activity</h3>
            <p>
                <code>Follow</code> 活动用于订阅其他用户的动态。
            </p>
            <p>
                该活动进入<strong>outbox</strong>的副作用是，当随后收到以该 <code>Follow</code> activity 作为 object 的 <code>Accept</code>
                activity 时，服务器<em class="rfc2119" title="SHOULD">建议</em>把 <code>object</code> 添加到 <code>actor</code> 的<a
                    href="#following"><code>following</code> 集合</a>中。
            </p>
        </section>
        <section id="add-activity-outbox">
            <h3 id="x6-6-add-activity"><span class="secno">6.6 </span>Add Activity</h3>
            <p>
                当 <code>Add</code> 活动进入<strong>outbox</strong>时，服务器<em class="rfc2119" title="SHOULD">建议</em>将
                <code>object</code> 添加到 <code>target</code> 字段指定的集合，除非：
            </p>
            <ul>
                <li>
                    <code>target</code> 不属于接收服务器，因而无权操作。
                </li>
                <li>
                    <code>object</code> 被服务器认为不能被添加到 <code>target</code> 集合（其他原因，由服务器自行裁决）。
                </li>
            </ul>
        </section>
        <section id="remove-activity-outbox">
            <h3 id="x6-7-remove-activity"><span class="secno">6.7 </span>Remove Activity</h3>
            <p>
                <code>Remove</code> 活动进入<strong>outbox</strong>时，服务器<em class="rfc2119" title="SHOULD">建议</em>将
                <code>object</code> 从 <code>target</code> 集合中移除，除非：
            </p>
            <ul>
                <li>
                    <code>target</code> 不属于接收服务器，因而无权操作。
                </li>
                <li>
                    <code>object</code> 不允许被移除出 <code>target</code> 集合（由服务器自行裁决）。
                </li>
            </ul>
        </section>
        <section id="like-activity-outbox">
            <h3 id="x6-8-like-activity"><span class="secno">6.8 </span>Like Activity</h3>
            <p>
                <code>Like</code> 活动表示 <code>actor</code> 点赞了 <code>object</code>。
            </p>
            <p>
                该活动进入<strong>outbox</strong>的副作用是，服务器<em class="rfc2119" title="SHOULD">建议</em>将 <code>object</code> 添加到
                <code>actor</code> 的<a href="#liked"><code>liked</code> 集合</a>中。
            </p>
        </section>
        <section id="block-activity-outbox">
            <h3 id="x6-9-block-activity"><span class="secno">6.9 </span>Block Activity</h3>
            <p>
                <code>Block</code> 活动表示发布该活动的 actor 不希望 <code>object</code> 属性指向的另一个 actor 能与自己发布的对象互动。
                服务器<em class="rfc2119" title="SHOULD">建议</em>阻止被屏蔽用户对 actor 发布对象的任何交互。
            </p>
            <p>
                服务器<em class="rfc2119" title="SHOULD NOT">不建议</em>向 <code>object</code> 投递 Block 活动。
            </p>
        </section>
        <section id="undo-activity-outbox">
            <h3 id="x6-10-undo-activity"><span class="secno">6.10 </span>Undo Activity</h3>
            <p>
                <code>Undo</code> 活动用于撤销之前的操作。
                参见 Activity Vocabulary 文档
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
                    逆活动和“Undo”</a>。
                例如 <code>Undo</code> 可撤销 <code>Like</code>、<code>Follow</code> 或 <code>Block</code>。
                撤销活动与被撤销操作<em class="rfc2119" title="MUST">必须</em>为同一 actor。
                应尽可能撤销相应副作用。
                比如撤销 <code>Like</code>，那么所有计数应相应减一。
            </p>

            <p>
                某些情况存在明确“逆操作”活动应优先用之。
                基于 <code>Create</code> 的活动用 <code>Delete</code>，<code>Add</code> 用 <code>Remove</code>。
            </p>
        </section>

        <section id="client-to-server-outbox-delivery">
            <h3 id="x6-11-delivery"><span class="secno">6.11 </span>投递</h3>
            <p>
                联邦服务器<em class="rfc2119" title="MUST">必须</em>按<a href="#outbox-delivery">outbox
                    投递规则</a>，对所有发布到<strong>outbox</strong>的 Activity 进行投递。
            </p>
        </section>

        <section id="uploading-media" class="informative">
            <h3 id="x6-12-uploading-media"><span class="secno">6.12 </span>媒体上传</h3>
            <p><em>本节为非规范性内容。</em></p>
            <p>
                服务器<em class="rfc2119" title="MAY">可以</em>支持上传可以被活动引用的文档类型（如图片、视频等二进制数据），但具体机制不在本 ActivityPub 版本范围内。
                社交 Web 社区组正在 <a href="https://www.w3.org/wiki/SocialCG/ActivityPub/MediaUpload">ActivityPub Media Upload
                    report</a>中完善协议。
            </p>
        </section>
    </section>

    <section id="server-to-server-interactions">
        <!--OddPage-->
        <h2 id="x7-server-to-server-interactions"><span class="secno">7. </span>服务器到服务器交互</h2>
        <p>
            服务器通过向参与者的 <a href="#inbox">inbox</a> 端点推送活动，与其它服务器通信并在社交网络内传播信息。
            发送到网络上的 Activity <em class="rfc2119" title="SHOULD">建议</em>带有 <code>id</code>，除非设计为临时（这时 <em class="rfc2119"
                title="MAY">可以</em>省略 <code>id</code>）。
        </p>
        <p>
            <code>POST</code> 请求（如发送至 inbox）<em class="rfc2119" title="MUST">必须</em>带有 Content-Type：
            <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>，
            <code>GET</code> 请求（参见 <a href="#retrieving-objects" class="sec-ref"><span class="secno">3.2</span> <span
                    class="sec-title">对象获取</span></a>）要带 Accept 头：
            <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>。
            服务器<em class="rfc2119" title="SHOULD">建议</em>将 Content-Type 或 Accept 头为
            <code>application/activity+json</code> 视为等同于
            <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> 用于服务器间交互。
        </p>
        <p>
            为了让更新在社交网络内传播，Activity 会投递给合适的收件人。
            首先通过对象间的引用关系递归找到目标 actor，再插入该 actor 的 <em>inbox</em>（<a href="#delivery">投递</a>）。
            这样收件服务器可以：
        </p>
        <ul>
            <li>
                执行与该 Activity 相关的副作用（比如，actor 点赞对象会让对象的点赞数更新）；
            </li>
            <li>
                再次向原对象的收件人递送这些 Activity，确保更新能贯穿整个社交图谱（详见 <a href="#inbox-forwarding">
                    inbox 投递</a>）。
            </li>
        </ul>
        <p>常见触发投递的场景包括：</p>
        <ul>
            <li>
                actor 的 <a href="#outbox">outbox</a> 产生 Activity，收件人是<a href="#followers">Followers 集合</a>。
            </li>
            <li>
                actor 的 <a href="#outbox">outbox</a> 产生 Activity，收件人是直接指定的用户。
            </li>
            <li>
                actor 的 <a href="#outbox">outbox</a> 产生 Activity，收件人为用户自定义集合。
            </li>
            <li>
                actor 的 <a href="#outbox">outbox</a> 或 <a href="#inbox">inbox</a> 创建活动并引用了其他对象。
            </li>
        </ul>

        <p>
            向其它服务器的 <code>inbox</code> 或 <code>sharedInbox</code> 投递 activity 时，服务器<em class="rfc2119"
                title="MUST">必须</em>在 activity 中提供 <code>object</code> 属性：
            <code>Create</code>、<code>Update</code>、<code>Delete</code>、
            <code>Follow</code>、<code>Add</code>、<code>Remove</code>、
            <code>Like</code>、<code>Block</code>、<code>Undo</code>。
            此外，发送下列活动时，<em class="rfc2119" title="MUST">必须</em>一同提供 <code>target</code>
            属性：<code>Add</code>、<code>Remove</code>。
        </p>

        <p>
            HTTP 缓存机制 [<cite><a class="bibref" href="#bib-RFC7234">RFC7234</a></cite>] <em class="rfc2119"
                title="SHOULD">建议</em>在适当时支持，可用于处理服务器响应和接收。
        </p>

        <section id="delivery">
            <h3 id="x7-1-delivery"><span class="secno">7.1 </span>投递</h3>

            <p><i>
                    下述内容仅适用于实现了服务器间联邦通信的服务器。
                </i></p>

            <p>
                活动投递给目标（即<a href="#actors">actor</a>）时，首先查找目标 actor 的 inbox，然后将 activity post 到该 inbox。
                投递目标通过查阅
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#audienceTargeting">
                    ActivityStreams 的 audience targeting</a>
                字段决定，即 <code>to</code>、<code>bto</code>、<code>cc</code>、<code>bcc</code> 和 <code>audience</code>。
            </p>

            <p>
                获取 <a href="#inbox">inbox</a> 的方法：<a href="#retrieving-objects">检索目标 actor 的 JSON-LD 表示</a>，然后查找
                <code>inbox</code> 属性。
                若收件人为 <code>Collection</code> 或 <code>OrderedCollection</code>，服务器<em class="rfc2119"
                    title="MUST">必须</em>用用户的凭证 dereference 该集合，并为集合内每项查找 inbox。
                服务器<em class="rfc2119" title="MUST">必须</em>限制集合递归查找的层数，<em class="rfc2119" title="MAY">可以</em>只查一层。
            </p>

            <p>
                服务器<em class="rfc2119" title="MUST">必须</em>对最终收件人去重；还<em class="rfc2119" title="MUST">必须</em>排除 activity
                的 <code>actor</code> 本人，也就是说，不应把 activity 推送给自己。
            </p>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-8" aria-level="4"><span>注</span><span
                        style="text-transform: none">：静默和私有活动</span></div>
                <p class="">
                    若无收件人指定该怎么办未明确定义，但建议如无收件人，则对象应完全私有，访问权限应受限。
                    若对象仅发送到 "public" 集合，则不会投递给任何 actor，但可在 actor 的 outbox 公开浏览。
                </p>
            </div>

            <p>
                然后向 <a href="#inbox">inbox</a> 发起带用户认证信息的 HTTP POST，请求体为 Activity。
                收件方将该 Activity 作为 <a href="#inbox">inbox</a> OrderedCollection 的 <code>item</code> 添加进去。
                向非联邦服务器的 inbox 投递时，<em class="rfc2119" title="SHOULD">建议</em>返回 <code>405 Method Not Allowed</code>。
            </p>

            <p>
                联邦服务器向第三方服务器投递推荐异步进行，如因网络故障导致失败<em class="rfc2119" title="SHOULD">建议</em>自动重试。
            </p>

            <p>
                <strong>注意：</strong>同源 actor 之间的 Activity 分发可以选择任何内部机制，不一定使用 HTTP。
            </p>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>注</span><span
                        style="text-transform: none">：与 Linked Data Notifications (LDN) 关系</span></div>
                <p class="" id="ldn-relationship">
                    虽然不要求理解本规范需先读此内容，但需要说明 ActivityPub 的投递机制与
                    <a href="https://www.w3.org/TR/ldn/">Linked Data Notifications</a>
                    存在重叠，两者可以互操作。
                    特别是 <code>inbox</code> 属性在 ActivityPub 和 LDN 中都是一样的，本规范描述的投递机制同样被 LDN 支持。
                    LDN 支持多种 RDF 序列化格式，并不要求 ActivityPub 实现支持，但希望更好兼容 LDN 的系统可考虑支持更多格式。
                </p>
            </div>

            <section id="outbox-delivery">
                <h4 id="x7-1-1-outbox-delivery-requirements-for-server-to-server"><span class="secno">7.1.1
                    </span>服务器到服务器 outbox 投递要求</h4>
                <p>
                    当对象被投递到 <a href="#outbox">outbox</a>
                    （适用于既实现<a href="#client-to-server-interactions">客户端-服务器交互</a>
                    又实现<a href="#server-to-server-interactions">服务器-服务器交互</a>的服务器），
                    服务器<em class="rfc2119" title="MUST">必须</em>投递到：
                </p>
                <ul>
                    <li>
                        <code>to</code>、<code>bto</code>、<code>cc</code>、<code>bcc</code> 或 <code>audience</code>
                        字段，且其值为该 actor 拥有的单个或集合。
                    </li>
                </ul>
                <p>
                    这些字段已经被<a href="#client-addressing">客户端寻址逻辑</a>预先填充。
                </p>
            </section>

            <section id="inbox-forwarding">
                <h4 id="x7-1-2-forwarding-from-inbox"><span class="secno">7.1.2 </span>inbox 转发</h4>

                <div class="note">
                    <div role="heading" class="note-title marker" id="h-note-10" aria-level="5"><span>注</span><span
                            style="text-transform: none">：为避免“幽灵回复”问题而转发</span></div>
                    <div class="">
                        <p>
                            下节内容为了解决在联邦网络中偶尔出现的“ghost replies（幽灵回复）”问题。
                            其问题最好通过实际例子说明。
                        </p>

                        <p>
                            Alyssa 发了个她在会议上成功报告论文的帖子，收件人是她的 followers 集合，包括她的朋友 Ben。
                            Ben 回帖祝贺她，并同样将 Alyssa 的 followers 集合作为收件人。
                            但 Ben 无权看到 Alyssa 的 followers 成员，因此他的服务器无法将消息转发给他们。
                            若无这个转发机制，Alyssa 再回复 Ben，Alyssa 的粉丝就会看到她直接回复 Ben，然而 Ben 的内容根本没显示，这让人很困惑！
                        </p>
                    </div>
                </div>

                <p>
                    当 Activity 到达 <a href="#inbox">inbox</a> 后，服务器需将它转发给原发布方无法直达的收件人。
                    为此，服务器<em class="rfc2119" title="MUST">必须</em>仅在下面三个条件都满足时，针对 <code>to</code>、<code>cc</code> 和/或
                    <code>audience</code> 的值再次<a href="#delivery">投递</a>：
                </p>
                <ul>
                    <li>这是服务器首次收到该 Activity。</li>
                    <li>
                        <code>to</code>、<code>cc</code> 和/或 <code>audience</code> 指向本服务器拥有的集合。
                    </li>
                    <li>
                        <code>inReplyTo</code>、<code>object</code>、<code>target</code> 和/或 <code>tag</code> 中的对象属于本服务器。
                        服务器<em class="rfc2119" title="SHOULD">建议</em>递归检查这些字段值，寻找属于本服务器的对象，并<em class="rfc2119"
                            title="SHOULD">建议</em>限制最大递归层数（如话题已深入，粉丝不再关心与自身无关的内容）。
                        服务器<em class="rfc2119" title="MUST">必须</em>仅对原始对象的
                        <code>to</code>、<code>cc</code>、<code>audience</code> 转发，不采集递归对象的新收件人（以防收件人为客户端故意更改）。
                    </li>
                </ul>
                <p>
                    服务器<em class="rfc2119" title="MAY">可以</em>按实现规则过滤投递对象（如垃圾信息过滤）。
                </p>
            </section>

            <section id="shared-inbox-delivery">
                <h4 id="x7-1-3-shared-inbox-delivery"><span class="secno">7.1.3 </span>共享收件箱投递</h4>
                <p>
                    对于托管多个 actor 的服务器，向所有粉丝逐个投递会带来大量消息。
                    有些服务器还需展示“已知网络”中全部公开消息。
                    因此 ActivityPub 提供了这个可选机制满足两需求。
                </p>
                <p>
                    当对象要发给本 actor 粉丝时，服务器<em class="rfc2119" title="MAY">可以</em>把拥有相同<a
                        href="#sharedInbox">sharedInbox</a>的所有粉丝合并，统一将对象投递到该 <code>sharedInbox</code>，以减少实际独立收件人数量。
                    这种情况下，远端服务器将实际完成具体 inbox 的分发。
                </p>
                <p>
                    另外，如向 <a href="#public-addressing">Public</a> 特殊集合寻址，服务器<em class="rfc2119"
                        title="MAY">可以</em>将对象分发给全网络已知的所有 <code>sharedInbox</code> 端点。
                </p>
                <p>
                    源服务器向 <code>sharedInbox</code> 发送公开活动时，<em class="rfc2119" title="MUST">必须</em>保证那些无
                    <code>sharedInbox</code> 汇总或不能通过 <code>sharedInbox</code> 获取的 actor 及集合，依然可以按
                    <code>to</code>、<code>bto</code>、<code>cc</code>、<code>bcc</code>、<code>audience</code> 单独投递，确保都能收到。
                </p>
            </section>
        </section>

        <section id="create-activity-inbox">
            <h3 id="x7-2-create-activity"><span class="secno">7.2 </span>Create Activity</h3>
            <p>
                收到 <code>Create</code> 活动添加到 <code>inbox</code>，理论上副作用极少；活动会显示在 actor 的
                <code>inbox</code>，通常服务器会在本地保存活动及对象的表示。
                不过这和一般接收 inbox 活动的处理并无不同。
            </p>
        </section>

        <section id="update-activity-inbox">
            <h3 id="x7-3-update-activity"><span class="secno">7.3 </span>Update Activity</h3>
            <p>
                服务器间的 <code>Update</code> 活动，接收服务器<em class="rfc2119" title="SHOULD">建议</em>用 Activity 中新对象内容替换本地相同
                <code>id</code> 的 <code>object</code> 副本。
                与 <a href="#update-activity-outbox">客户端到服务器交互</a>不同，此为全量替换而非部分更新。
            </p>
            <p>
                接收服务器<em class="rfc2119" title="MUST">必须</em>确保 <code>Update</code> 活动有权修改该 <code>object</code>。最小条件为
                <code>Update</code> 及其对象必须同源。
            </p>
        </section>

        <section id="delete-activity-inbox">
            <h3 id="x7-4-delete-activity"><span class="secno">7.4 </span>Delete Activity</h3>
            <p>
                收到该活动的副作用为（假定 <code>object</code> 属于发送方 actor / 服务器），接收服务器<em class="rfc2119" title="SHOULD">建议</em>移除等
                <code>id</code> 对象的本地副本，并<em class="rfc2119" title="MAY">可以</em>用 <code>Tombstone</code> 替换之。
            </p>
            <p>
                （注意 ActivityPub 无法<em>强制</em>远端服务器根据活动删除接收对象副本，协议仅限于原始发送服务器→远端）。
            </p>
        </section>

        <section id="follow-activity-inbox">
            <h3 id="x7-5-follow-activity"><span class="secno">7.5 </span>Follow Activity</h3>

            <p>
                收到该活动添加到 <strong>inbox</strong> 时，服务器<em class="rfc2119" title="SHOULD">建议</em>生成 <code>Accept</code> 或
                <code>Reject</code> 活动，并将其作为该 <code>Follow</code> 的 <code>object</code> 投递给 <code>Follow</code> 的 actor。
                <code>Accept</code> 或 <code>Reject</code><em class="rfc2119" title="MAY">可以</em>自动生成，也<em
                    class="rfc2119" title="MAY">可以</em>经用户审核后手动。
                服务器<em class="rfc2119" title="MAY">可以</em>选择不明确回应
                <code>Reject</code>，但实现需知这样会导致提交方服务器处于中间态。例如为了保护用户隐私而不返回 <code>Reject</code>。
            </p>

            <p>
                如果收到一个引用该 <code>Follow</code> 为 object 的 <code>Accept</code>，服务器<em class="rfc2119"
                    title="SHOULD">建议</em>将该 actor 加入 object actor 的<a href="#followers">Followers 集合</a>。
                若收到 <code>Reject</code>，服务器<em class="rfc2119" title="MUST NOT">禁止</em>将 actor 添加到 object actor 的<a
                    href="#followers">Followers 集合</a>。
            </p>

            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-11" aria-level="4"><span>注</span></div>
                <div class="">
                    <p>
                        有时 Follow 订阅可能成功，但以后会因为网络原因长时间无法送达 follower。
                        实现需考虑，并不能保证网络中的 actor 始终可达，应合理处理。
                        例如长达半年的投递都不可达，服务器可合理地从 <code>followers</code> 清除该订阅者。
                        所采用策略和时长由服务器自行决定。
                    </p>
                </div>
            </div>
        </section>

        <section id="accept-activity-inbox">
            <h3 id="x7-6-accept-activity"><span class="secno">7.6 </span>Accept Activity</h3>
            <p>
                接收 inbox 中 <code>Accept</code> 的副作用取决于收到的 <code>object</code> 类型，也可用于本文件未描述的类型（如 <code>Offer</code>）。
            </p>

            <p>
                如果 <code>Accept</code> 的 <code>object</code> 为事先发送的 <code>Follow</code> 活动，服务器<em class="rfc2119"
                    title="SHOULD">建议</em>将 actor 加入接收者的<a href="#following">Following 集合</a>。
            </p>
        </section>

        <section id="reject-activity-inbox">
            <h3 id="x7-7-reject-activity"><span class="secno">7.7 </span>Reject Activity</h3>
            <p>
                接收 inbox 中 <code>Reject</code> 的副作用取决于收到的 <code>object</code> 类型，也可用于本文件未描述的类型（如 <code>Offer</code>）。
            </p>

            <p>
                如果 <code>Reject</code> 的 <code>object</code> 为事先发送的 <code>Follow</code> 活动，这意味着收件人未批准 Follow 请求。服务器<em
                    class="rfc2119" title="MUST NOT">禁止</em>将 actor 加入接收者的<a href="#following">Following 集合</a>。
            </p>
        </section>

        <section id="add-activity-inbox">
            <h3 id="x7-8-add-activity"><span class="secno">7.8 </span>Add Activity</h3>
            <p>
                收到 <code>Add</code> 活动进入 <strong>inbox</strong> 时，服务器<em class="rfc2119" title="SHOULD">建议</em>将
                <code>object</code> 添加到 <code>target</code> 指定的集合，除非：
            </p>
            <ul>
                <li>
                    <code>target</code> 不归接收服务器所有，因此无权修改。
                </li>
                <li>
                    出于其它原因，不可将 <code>object</code> 添加到 <code>target</code> 集合，由接收服务器裁决。
                </li>
            </ul>
        </section>
        <section id="remove-activity-inbox">
            <h3 id="x7-9-remove-activity"><span class="secno">7.9 </span>Remove Activity</h3>
            <p>
                收到 <code>Remove</code> 活动进入 <strong>inbox</strong> 时，服务器<em class="rfc2119" title="SHOULD">建议</em>将
                <code>object</code> 从 <code>target</code> 指定集合移除，除非：
            </p>
            <ul>
                <li>
                    <code>target</code> 不归接收服务器所有，因此无权修改。
                </li>
                <li>
                    出于其它原因，不能将 <code>object</code> 从 <code>target</code> 集合移除，由接收服务器裁决。
                </li>
            </ul>
        </section>
        <section id="like-activity-inbox">
            <h3 id="x7-10-like-activity"><span class="secno">7.10 </span>Like Activity</h3>
            <p>
                收到该活动进入 <strong>inbox</strong> 的副作用为，服务器<em class="rfc2119" title="SHOULD">建议</em>增加对象的点赞数，将收到的活动加进 <a
                    href="#likes"><code>likes</code></a> 集合（如有）。
            </p>
        </section>
        <section id="announce-activity-inbox">
            <h3 id="x7-11-announce-activity-sharing"><span class="secno">7.11 </span>Announce Activity（分享）</h3>
            <p>
                收到 <code>Announce</code> 活动进入 <strong>inbox</strong> 时，服务器<em class="rfc2119" title="SHOULD">建议</em>增加对象
                share 次数，将收到的活动加进 <a href="#shares"><code>shares</code></a> 集合（如有）。
            </p>
            <div class="note">
                <div role="heading" class="note-title marker" id="h-note-12" aria-level="4"><span>注</span></div>
                <div class="">
                    <code>Announce</code> 活动实际上就是其他社交网络中的“分享”“转发”或“boost”。
                </div>
            </div>
        </section>
        <section id="undo-activity-inbox">
            <h3 id="x7-12-undo-activity"><span class="secno">7.12 </span>Undo Activity</h3>
            <p>
                <code>Undo</code> 活动用于撤销上一次活动的副作用。参见 ActivityStreams 文档
                <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
                    逆向活动与“Undo”</a>。
                <code>Undo</code> 活动的范围和约束与
                <a href="#undo-activity-outbox">
                    客户端-服务器交互上下文下的 Undo 活动</a>
                一致，但用于联邦场景。
            </p>
        </section>
    </section>

    <section id="i18n-concerns" class="appendix informative">
        <!--OddPage-->
        <h2 id="a-internationalization"><span class="secno">A. </span>国际化</h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>
            在一个联邦网络中，构建全球用户基础是非常重要的。
            <a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">
                ActivityStreams 提供了内容国际化的相关工具</a>，应尽可能加以利用。
            不过，实现上有时难以确定为用户生成内容指定哪个
            <a href="https://www.w3.org/TR/activitystreams-core/#defaultlangcontext">
                <code>@language</code> 属性</a>。
            <a href="https://www.w3.org/International/"><abbr title="World Wide Web Consortium">W3C</abbr>
                国际化小组</a>
            提供了
            <a href="https://www.w3.org/International/wiki/LanguageDetection">
                语言检测的指导</a>。
        </p>
    </section>

    <section id="security-considerations" class="appendix informative">
        <!--OddPage-->
        <h2 id="b-security-considerations"><span class="secno">B. </span>安全性注意事项</h2>
        <p><em>本节为非规范性内容。</em></p>

        <section id="authorization">
            <h3 id="b-1-authentication-and-authorization"><span class="secno">B.1 </span>认证与授权</h3>
            <p>
                ActivityPub 在两个场景下用到身份认证：一是客户端到服务器认证，二是在联邦实现中服务器互相认证。
            </p>

            <p>
                很遗憾，在标准制定时，并未有广泛认同的认证机制。
                更多认证实现方向可参见
                <a href="https://www.w3.org/wiki/SocialCG/ActivityPub/Authentication_Authorization">Social Web Community
                    Group 关于认证与授权最佳实践报告</a>。
            </p>

        </section>

        <section id="security-verification">
            <h3 id="b-2-verification"><span class="secno">B.2 </span>验证</h3>
            <p>
                服务器不应信任客户端上传内容，联邦服务器也应对来自非原始来源的内容做某种校验，不能轻信。
            </p>
            <p>
                服务器应确保新内容确实由声明的 actor 所发，并检查 actor 是否有权限更新声明的资源。
                参见
                <a href="#obj" class="sec-ref"><span class="secno">3.</span> <span class="sec-title">对象</span></a>
                以及 <a href="#authorization" class="sec-ref"><span class="secno">B.1</span> <span
                        class="sec-title">认证与授权</span></a>。
            </p>
        </section>

        <section id="security-localhost">
            <h3 id="b-3-accessing-localhost-uris"><span class="secno">B.3 </span>访问本地 URI</h3>
            <p>
                开发时用本地进程测试很方便。
                但生产环境下允许客户端或服务器访问本地 URI 是很危险的。
                对本地 URI 做未授权请求可能无意中访问或修改到原本仅本地主机可用的受保护资源。
            </p>
            <p>
                若你的 ActivityPub 服务器或客户端为开发便捷而允许访问本地 URI，建议将此设置为默认关闭的配置项。
            </p>
        </section>

        <section id="security-uri-schemes">
            <h3 id="b-4-uri-schemes"><span class="secno">B.4 </span>URI 方案</h3>
            <p>
                除了 <code>http</code> 和 <code>https</code>，还有许多类型的 URI。
                有些库处理不同 URI scheme 时会尝试“聪明地”引用某些不合规范的 scheme，比如 <code>file</code>。
                客户端和服务器开发者应仔细检查库处理请求的方式，最好只白名单安全的 URI 类型，如 <code>http</code> 和 <code>https</code>。
            </p>
        </section>

        <section id="security-recursive-objects">
            <h3 id="b-5-recursive-objects"><span class="secno">B.5 </span>递归对象</h3>
            <p>
                服务器在解析对象时应限制递归深度，或特殊处理带递归引用的 ActivityStreams 对象。
                否则可能导致拒绝服务类安全漏洞。
            </p>
        </section>

        <section id="security-spam">
            <h3 id="b-6-spam"><span class="secno">B.6 </span>垃圾信息</h3>
            <p>
                任何网络都难免有垃圾信息，在联邦网络中尤为如此。
                ActivityPub 未指定防垃圾内容机制，但建议服务器对本地不受信任用户及任何远端用户内容都加某种反垃圾处理。
            </p>
        </section>

        <section id="security-federation-dos">
            <h3 id="b-7-federation-denial-of-service"><span class="secno">B.7 </span>联邦拒绝服务攻击</h3>
            <p>
                服务器应有机制防范来自其他联邦服务器的拒绝服务攻击（DOS）。
                比如可使用限流规则。
                对涉及副作用的 activity，服务器应特别注意实现防护。
                服务器 <em class="rfc2119" title="SHOULD">建议</em>采用自适应重试（如指数退避）来避免请求过度拖垮目标服务器。
            </p>
        </section>

        <section id="security-c2s-ratelimiting">
            <h3 id="b-8-client-to-server-ratelimiting"><span class="secno">B.8 </span>客户端-服务器限流</h3>
            <p>
                服务器应对 API 客户端做限流管理。
                这样做有两个好处：
            </p>
            <ol>
                <li>
                    防止恶意客户端发起拒绝服务攻击服务器。
                </li>
                <li>
                    保证服务器不会因分发过多 activity 而触发其他服务器的<a href="#security-federation-dos">拒绝服务保护</a>。
                </li>
            </ol>
            <p></p>
        </section>

        <section id="security-c2s-response-dos">
            <h3 id="b-9-client-to-server-response-denial-of-service"><span class="secno">B.9 </span>客户端-服务器响应拒绝服务</h3>
            <p>
                为防止客户端被超大集合内容拖垮，服务器应限制返回集合页的大小。
                客户端自身也应限制愿意处理的响应内容大小，比如强制超时和报错，以防接入恶意或被攻破的服务器。
            </p>
        </section>

        <section id="security-sanitizing-content">
            <h3 id="b-10-sanitizing-content"><span class="secno">B.10 </span>内容净化</h3>
            <p>
                任何渲染到浏览器（或富文本应用）的 activity 字段都应规范净化，移除危险标记，防止 XSS 攻击。
            </p>
        </section>

        <section id="security-not-displaying-bto-bcc">
            <h3 id="b-11-not-displaying-bto-and-bcc-properties"><span class="secno">B.11 </span>不显示 bto 和 bcc 属性</h3>
            <p>
                <code>bto</code> 和 <code>bcc</code>
                <a href="#remove-bto-bcc-before-delivery">已要求分发前移除</a>，
                但服务器可以自行决定如何内部存储。
                但由于 <code>bto</code> 和 <code>bcc</code> 仅供原作者知晓，服务器在展示内容时也应省略这些属性。
            </p>
        </section>
    </section>

    <section class="appendix informative" id="acknowledgements">
        <!--OddPage-->
        <h2 id="c-acknowledgements"><span class="secno">C. </span>致谢</h2>
        <p><em>本节为非规范性内容。</em></p>
        <p>
            本规范源自多个社区多年在 Web 联邦领域的深耕与经验。
            尤其是 <a href="https://www.w3.org/community/ostatus/wiki/Main_Page">OStatus</a>
            和
            <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>
            ，以 StatusNet（现 GNU Social）和 Pump.io 为代表，为本规范贡献了大量实践，但最主要的推动者仍是 Evan Prodromou，没有他的持续付出，ActivityPub
            不可能有今天的样子。
        </p>

        <p>
            Erin Shepherd 撰写了初版规范，灵感来自
            <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>
            文档，内容几乎完全重写，不过主观点沿用，只是从 ActivityStreams 1 切换到了 ActivityStreams 2。
        </p>

        <p>
            当标准移交到 <abbr title="World Wide Web Consortium">W3C</abbr> Social 工作组后，Jessica Tallon 与 Christine
            Lemmer-Webber 担任编辑，她们完成了从 Erin Shepherd 版规范到 ActivityPub 现状的大部分结构和文本重构。
            本文档大部分内容都在 Working Group 漫长反馈期内重新编写和梳理。
        </p>

        <p>
            ActivityPub 的最终形态离不开 <abbr title="World Wide Web Consortium">W3C</abbr> Social 工作组众多成员的精心投入。
            特别感谢 Amy Guy，她为组内文档互相关联和 [<cite><a class="bibref"
                    href="#bib-Social-Web-Protocols">Social-Web-Protocols</a></cite>] 的整体梳理做出了最大贡献。
            Amy 还与 Christopher Allan Webber 一起，用为期四天的马拉松推进规范大重构，这推动了客户端到服务器与服务器组件之间的分离，以及与 [<cite><a class="bibref"
                    href="#bib-LDN">LDN</a></cite>] 等规范关系的澄清和其他诸多改进。
            特别感谢 Benjamin Goering 制作实现报告模板。
            也要感谢 mray 绘制的精彩教程插画（与本规范采用同一许可证）。
        </p>

        <p>
            许多人也通过细致审阅助力了 ActivityPub，特别致谢：
            Aaron Parecki,
            AJ Jordan,
            Benjamin Goering,
            Caleb Langeslag,
            Elsa Balderrama,
            elf Pavlik,
            Eugen Rochko,
            Erik Wilde,
            Jason Robinson,
            Manu Sporny,
            Michael Vogel,
            Mike Macgirvin,
            nightpool,
            Puck Meerburg,
            Sandro Hawke,
            Sarven Capadisli,
            Tantek Çelik 和
            Yuri Volkov。
        </p>

        <p>
            本文献给地球上的所有人——你们应该享有沟通自由；希望我们为这项权利和目标的推进尽了绵薄之力。
        </p>
    </section>


    <section id="references" class="appendix"><!--OddPage-->
        <h2 id="d-references"><span class="secno">D. </span>参考文献</h2>
        <section id="normative-references">
            <h3 id="d-1-normative-references"><span class="secno">D.1 </span>规范性引用</h3>
            <dl class="bibliography">
                <dt id="bib-Activity-Vocabulary">[Activity-Vocabulary]</dt>
                <dd><a href="https://www.w3.org/TR/activitystreams-vocabulary/"><cite>Activity 词汇表</cite></a>. J.
                    Snell. ActivityStreams 工作组. 编辑草案. URL: <a
                        href="https://www.w3.org/TR/activitystreams-vocabulary/">https://www.w3.org/TR/activitystreams-vocabulary/</a>
                </dd>
                <dt id="bib-ActivityStreams">[ActivityStreams]</dt>
                <dd><a href="https://www.w3.org/TR/activitystreams-core/"><cite>Activity Streams 2.0</cite></a>. J.
                    Snell. ActivityStreams 工作组. 编辑草案. URL: <a
                        href="https://www.w3.org/TR/activitystreams-core/">https://www.w3.org/TR/activitystreams-core/</a>
                </dd>
                <dt id="bib-JSON-LD">[JSON-LD]</dt>
                <dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>. Manu Sporny; Gregg Kellogg;
                    Markus Lanthaler. W3C. 2014年1月16日. W3C 推荐. URL: <a
                        href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a>
                </dd>
                <dt id="bib-LDN">[LDN]</dt>
                <dd><a href="https://www.w3.org/TR/ldn/"><cite>链接数据通知 (LDN)</cite></a>. Sarven Capadisli;
                    Amy Guy. W3C. 2017年5月2日. W3C 推荐. URL: <a
                        href="https://www.w3.org/TR/ldn/">https://www.w3.org/TR/ldn/</a>
                </dd>
                <dt id="bib-RFC2119">[RFC2119]</dt>
                <dd><a href="https://tools.ietf.org/html/rfc2119"><cite>RFC 规范性用词需求定义</cite></a>. S. Bradner. IETF.
                    1997年3月. 最佳当前实践. URL: <a
                        href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
                </dd>
                <dt id="bib-RFC7231">[RFC7231]</dt>
                <dd><a href="https://tools.ietf.org/html/rfc7231"><cite>超文本传输协议 (HTTP/1.1)：语义与内容</cite></a>. R.
                    Fielding, Ed.; J. Reschke, Ed.. IETF. 2014年6月.
                    提案标准. URL: <a href="https://tools.ietf.org/html/rfc7231">https://tools.ietf.org/html/rfc7231</a>
                </dd>
                <dt id="bib-RFC7234">[RFC7234]</dt>
                <dd><a href="https://tools.ietf.org/html/rfc7234"><cite>超文本传输协议 (HTTP/1.1)：缓存机制</cite></a>. R. Fielding,
                    Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. IETF. 2014年6月.
                    提案标准. URL: <a href="https://tools.ietf.org/html/rfc7234">https://tools.ietf.org/html/rfc7234</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <h3 id="d-2-informative-references"><span class="secno">D.2 </span>补充性引用</h3>
            <dl class="bibliography">
                <dt id="bib-Micropub">[Micropub]</dt>
                <dd><a href="https://www.w3.org/TR/micropub/"><cite>Micropub</cite></a>. Aaron Parecki. W3C. 2017年5月23日.
                    W3C 推荐. URL: <a href="https://www.w3.org/TR/micropub/">https://www.w3.org/TR/micropub/</a>
                </dd>
                <dt id="bib-RFC6749">[RFC6749]</dt>
                <dd><a href="https://tools.ietf.org/html/rfc6749"><cite>OAuth 2.0 授权框架</cite></a>. D. Hardt, Ed.. IETF.
                    2012年10月. 提案标准. URL: <a
                        href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a>
                </dd>
                <dt id="bib-RFC6750">[RFC6750]</dt>
                <dd><a href="https://tools.ietf.org/html/rfc6750"><cite>OAuth 2.0 授权框架：Bearer Token 使用</cite></a>. M.
                    Jones; D. Hardt. IETF. 2012年10月. 提案标准. URL: <a
                        href="https://tools.ietf.org/html/rfc6750">https://tools.ietf.org/html/rfc6750</a>
                </dd>
                <dt id="bib-Social-Web-Protocols">[Social-Web-Protocols]</dt>
                <dd><a href="https://www.w3.org/TR/social-web-protocols/"><cite>社交 Web 协议</cite></a>. Amy
                    Guy. W3C. 2017年12月25日. W3C 注释. URL: <a
                        href="https://www.w3.org/TR/social-web-protocols/">https://www.w3.org/TR/social-web-protocols/</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top"><a href="#toc"><abbr title="返回目录">↑</abbr></a></p>
    <script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    <script src="/dropdown.js"></script>
</body>

</html>