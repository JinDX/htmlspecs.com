<!doctype html>
<html lang="zh-hans">

<head>
    <meta charset="utf-8">
    <title>存储访问 API</title>
    <meta content="width=device-width" name="viewport">
    <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
    <!-- <meta content="Bikeshed version 3f621ba99, updated Mon Jul 28 15:38:36 2025 -0700" name="generator"> -->
    <link href="https://privacycg.github.io/storage-access/" rel="canonical">
    <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
    <!-- <meta content="03af52d120e8f2ccb566c79597b7de8a31284b66" name="revision"> -->
    <meta content="dark light" name="color-scheme">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">
    <style>
        .XXX {
            color: #E50000;
            font-weight: bold;
        }

        .XXX::before {
            content: "TODO: ";
        }
    </style>
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color] {
            background-color: var(--var-bg);
            box-shadow: 0 0 0 2px var(--var-bg);
        }

        var[data-var-color] {
            --var-bg: #F4D200;
        }

        var[data-var-color="1"] {
            --var-bg: #FF87A2;
        }

        var[data-var-color="2"] {
            --var-bg: #96E885;
        }

        var[data-var-color="3"] {
            --var-bg: #3EEED2;
        }

        var[data-var-color="4"] {
            --var-bg: #EACFB6;
        }

        var[data-var-color="5"] {
            --var-bg: #82DDFF;
        }

        var[data-var-color="6"] {
            --var-vg: #FFBCF2;
        }

        @media (prefers-color-scheme: dark) {
            var[data-var-color] {
                --var-bg: #bc1a00;
            }

            var[data-var-color="1"] {
                --var-bg: #007f00;
            }

            var[data-var-color="2"] {
                --var-bg: #008698;
            }

            var[data-var-color="3"] {
                --var-bg: #7f5b2b;
            }

            var[data-var-color="4"] {
                --var-bg: #004df3;
            }

            var[data-var-color="5"] {
                --var-bg: #a1248a;
            }

            var[data-var-color="6"] {
                --var-vg: #ff0000;
            }
        }
    </style>

<body>
    <header>
        <h1 class="no-ref" id="title">存储访问 API</h1>
        <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">社区组草案报告，
                <time datetime="2025-10-18">2025年10月18日</time></span></h2>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>本版本：
                <dd><a class="u-url"
                        href="https://privacycg.github.io/storage-access/">https://privacycg.github.io/storage-access/</a>
                <dt>问题追踪：
                <dd><a href="https://github.com/privacycg/storage-access/issues/">GitHub</a>
                <dd><a href="#issues-index">规范内追踪</a>
                <dt class="editor">编辑者：
                <dd class="editor p-author h-card vcard" data-editor-id="135256"><a class="p-name fn u-email email"
                        href="mailto:bvandersloot@mozilla.com">Benjamin VanderSloot</a> (<a class="p-org org"
                        href="https://mozilla.org">Mozilla</a>)
                <dd class="editor p-author h-card vcard" data-editor-id="120436"><a class="p-name fn u-email email"
                        href="mailto:johannhof@google.com">Johann Hofmann</a> (<a class="p-org org"
                        href="https://google.com">Google</a>)
                <dd class="editor p-author h-card vcard" data-editor-id="38001"><a class="p-name fn u-email email"
                        href="mailto:annevk@annevk.nl">Anne van Kesteren</a> (<a class="p-org org"
                        href="https://apple.com">Apple 公司</a>)
                <dt class="editor">前编辑者：
                <dd class="editor p-author h-card vcard" data-editor-id="89478"><a class="p-name fn u-email email"
                        href="mailto:wilander@apple.com">John Wilander</a> (<a class="p-org org"
                        href="https://apple.com">Apple 公司</a>)
                <dd class="editor p-author h-card vcard" data-editor-id="40614"><a class="p-name fn u-email email"
                        href="mailto:hober@apple.com">Theresa O’Connor</a> (<a class="p-org org"
                        href="https://apple.com">Apple 公司</a>)
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2025 the Contributors to “The Storage Access API”, published by the <a
                href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.

            This document is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
                Attribution 4.0 International License</a>.

            Contributions to this document are made under the <a
                href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement
                (CLA)</a>.
        </p>
        <hr title="Separator for header">
    </header>
    <div data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>存储访问 API 使 iframe 中的内容能够请求访问网站数据（如 Cookie）。</p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文档状态</span>
    </h2>
    <div data-fill-with="status">
        <p>本规范计划合并入 HTML Living Standard。它既不是 WHATWG Living Standard，也不在 W3C 的标准流程中。</p>
        <p>本规范由 <a href="http://www.w3.org/community/privacycg/">隐私社区组</a>发布。请注意，根据 <a
                href="http://www.w3.org/community/about/agreements/cla/">W3C 社区贡献者许可协议（CLA）</a>，有有限的选择退出权以及其他适用条件。了解更多
            <a href="http://www.w3.org/community/">W3C 社区和业务组</a> 信息。
        </p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#intro"><span class="secno">1</span> <span class="content">简介</span></a>
            <li><a href="#infra"><span class="secno">2</span> <span class="content">基础设施</span></a>
            <li>
                <a href="#the-storage-access-api"><span class="secno">3</span> <span class="content">存储访问 API</span></a>
                <ol class="toc">
                    <li><a href="#ua-state"><span class="secno">3.1</span> <span
                                class="content">与存储访问相关的用户代理状态更改</span></a>
                    <li><a href="#the-document-object"><span class="secno">3.2</span> <span class="content">
                                <code class="idl"><span>Document</span></code> 的变更</span></a>
                    <li><a href="#navigation"><span class="secno">3.3</span> <span class="content">导航相关的更改</span></a>
                    <li>
                        <a href="#fetch-integration"><span class="secno">3.4</span> <span class="content">与 Fetch
                                的集成</span></a>
                        <ol class="toc">
                            <li><a href="#fetching"><span class="secno">3.4.1</span> <span
                                        class="content">获取流程</span></a>
                            <li><a href="#http-redirect-fetch"><span class="secno">3.4.2</span> <span
                                        class="content">HTTP 重定向获取</span></a>
                        </ol>
                    <li>
                        <a href="#storage"><span class="secno">3.5</span> <span class="content">对各类客户端存储机制的更改</span></a>
                        <ol class="toc">
                            <li><a href="#cookies"><span class="secno">3.5.1</span> <span
                                        class="content">Cookie</span></a>
                        </ol>
                    <li><a href="#sandboxing-storage-access"><span class="secno">3.6</span> <span
                                class="content">存储访问的沙箱机制</span></a>
                </ol>
            <li><a href="#permissions-integration"><span class="secno">4</span> <span class="content">权限集成</span></a>
            <li><a href="#permissions-policy-integration"><span class="secno">5</span> <span
                        class="content">权限策略集成</span></a>
            <li>
                <a href="#privacy"><span class="secno">6</span> <span class="content">隐私相关考量</span></a>
                <ol class="toc">
                    <li><a href="#site-scope"><span class="secno">6.1</span> <span class="content">权限范围</span></a>
                </ol>
            <li>
                <a href="#security"><span class="secno">7</span> <span class="content">安全性考量</span></a>
                <ol class="toc">
                    <li><a href="#reputation"><span class="secno">7.1</span> <span class="content">声誉攻击</span></a>
                    <li><a href="#notification"><span class="secno">7.2</span> <span class="content">通知滥用</span></a>
                </ol>
            <li>
                <a href="#automation"><span class="secno">8</span> <span class="content">自动化</span></a>
                <ol class="toc">
                    <li><a href="#set-storage-access-command"><span class="secno">8.1</span> <span
                                class="content">设置存储访问</span></a>
                </ol>
            <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">致谢</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档规范</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">补充性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <section class="non-normative">
            <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                    class="content">简介</span><a class="self-link" href="#intro"></a></h2>
            <p><em>本节为非规范性内容。</em></p>
            <p>用户代理有时会阻止某些
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>
                内的内容访问客户端存储机制（如 cookie）中的数据。这可能会导致依赖客户端存储访问的嵌入内容出现问题。
            </p>
            <p>存储访问 API 使
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code>
                内的内容可以请求并获得其客户端存储的访问权限，以便依赖客户端存储访问的嵌入内容能够在此类用户代理中正常工作。<a data-link-type="biblio"
                    href="#biblio-storage-access-intro"
                    title="Introducing Storage Access API">[STORAGE-ACCESS-INTRO]</a>
            </p>
        </section>
        <h2 class="heading settled" data-level="2" id="infra"><span class="secno">2. </span><span
                class="content">基础设施</span><a class="self-link" href="#infra"></a></h2>
        <p>本规范依赖 Infra 标准。<a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
        <h2 class="heading settled" data-level="3" id="the-storage-access-api"><span class="secno">3. </span><span
                class="content">存储访问 API</span><a class="self-link" href="#the-storage-access-api"></a>
        </h2>
        <p>本规范定义了一种方法，用于查询一个<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>
            当前是否有权访问其<a data-link-type="dfn" href="#unpartitioned-data" id="ref-for-unpartitioned-data">未分区数据</a>（<code
                class="idl"><a data-link-type="idl" href="#dom-document-hasstorageaccess" id="ref-for-dom-document-hasstorageaccess">hasStorageAccess()</a></code>），
            以及一个可用于请求访问其<a data-link-type="dfn" href="#unpartitioned-data"
                id="ref-for-unpartitioned-data①">未分区数据</a>的方法（<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess">requestStorageAccess()</a></code>）。
        </p>
        <div class="example" id="example-a7805ce9">
            <a class="self-link" href="#example-a7805ce9"></a>


            <p>Alex 访问 <code>https://social.example/</code>。页面设置了一个 cookie。该 cookie 在
                <a data-link-type="dfn" href="#first-party-site-context"
                    id="ref-for-first-party-site-context">一方网站上下文</a>中被设置。
            </p>
            <p>之后，Alex 访问 <code>https://video.example/</code>，该页面嵌入了一个加载
                <code>https://social.example/heart-button</code>
                的
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element②">iframe</a></code>。
                在这种情况下，
                <code>social.example</code> 的 <code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>
                <var>doc</var> 处于<a data-link-type="dfn" href="#third-party-context"
                    id="ref-for-third-party-context">第三方上下文</a>，而之前设置的 cookie 是否可在 <var>doc</var><code>.</code><code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" id="ref-for-dom-document-cookie">cookie</a></code>
                中访问，取决于用户代理的存储访问策略。
            </p>
            <p>
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element③">iframe</a></code>
                内的脚本可以调用 <var>doc</var><code>.</code><code
                    class="idl"><a data-link-type="idl" href="#dom-document-hasstorageaccess" id="ref-for-dom-document-hasstorageaccess①">hasStorageAccess()</a></code>
                以判断是否拥有 cookie 访问权限。如果没有访问权限，则可以通过调用 <var>doc</var><code>.</code><code
                    class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess①">requestStorageAccess()</a></code>
                请求访问。
            </p>
        </div>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="unpartitioned-data">未分区数据</dfn>
            是指若一个<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site"
                id="ref-for-site">网站</a>在<a data-link-type="dfn" href="#first-party-site-context"
                id="ref-for-first-party-site-context①">一方网站上下文</a>中加载时可访问的客户端存储数据。</p>
        <p>
            <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code>
            处于<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="first-party-site-context">一方网站上下文</dfn>，如果它是<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                id="ref-for-nav-document">顶级浏览上下文</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"
                id="ref-for-top-level-browsing-context">活动文档</a>。否则，如果它是<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                id="ref-for-nav-document①">活动文档</a>，且其<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"
                id="ref-for-concept-settings-object-origin">origin</a>与<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"
                id="ref-for-concept-environment-top-level-origin">顶级 origin</a>相同，它也处于<a data-link-type="dfn"
                href="#first-party-site-context" id="ref-for-first-party-site-context②">一方网站上下文</a>（需满足<a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                id="ref-for-relevant-settings-object">相关设置对象</a>的 origin 与顶级 origin <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site">同站</a>）。
        </p>
        <p>
            <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>
            若不处于<a data-link-type="dfn" href="#first-party-site-context"
                id="ref-for-first-party-site-context③">一方网站上下文</a>，则处于<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="third-party-context">第三方上下文</dfn>。
        </p>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access">判断用户代理是否明确允许未分区
                cookie 访问</dfn>，给定一个由两个<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①">网站</a>组成的<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple"
                id="ref-for-tuple">元组</a><var>tuple</var>，请执行以下步骤。该算法返回 "<code>none</code>"、"<code>allow</code>" 或
            "<code>disallow</code>"。</p>
        <p class="note" role="note"><span class="marker">注意：</span>用户代理的设置可能通过网站白名单、用户更改全局浏览器配置或类似的自定义覆盖方式，明确允许或拒绝未分区
            cookie 访问。</p>
        <ol>
            <li data-md>
                <p>如用户代理未对 <var>tuple</var> 拥有未分区 cookie 访问的明确设置，则返回"<code>none</code>"。
                </p>
            <li data-md>
                <p>如用户代理的设置对 <var>tuple</var> 明确允许未分区 cookie 访问，则返回"<code>allow</code>"。</p>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                        id="ref-for-assert">断言</a>：用户代理的设置对 <var>tuple</var> 明确拒绝未分区 cookie 访问。</p>
            <li data-md>
                <p>返回"<code>disallow</code>"。</p>
        </ol>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="determine-the-fedcm-site-connection-status">判断 FedCM 站点连接状态</dfn>，给定 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin">origin</a> <var>embedder</var> 和 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin①">origin</a> <var>identityProvider</var>，执行以下步骤。此算法返回<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">布尔值</a>。
        </p>
        <ol>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                        id="ref-for-list-iterate">对于</a> <a data-link-type="dfn"
                        href="https://w3c-fedid.github.io/FedCM/#browser-connected-accounts-set"
                        id="ref-for-browser-connected-accounts-set">已连接账户集</a>中的每个 <var>item</var>：</p>
                <ol>
                    <li data-md>
                        <p>令 (<var>rp</var>, <var>idp</var>, <var>account</var>) 为 <var>item</var>。</p>
                    <li data-md>
                        <p>如 <var>rp</var> 与 <var>embedder</var> <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site"
                                id="ref-for-same-site①">同站</a>，且 <var>idp</var> 与 <var>identityProvider</var> <a
                                data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site"
                                id="ref-for-same-site②">同站</a>，则返回 true。
                        </p>
                </ol>
            <li data-md>
                <p>返回 false。</p>
        </ol>
        <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="determine-the-effective-fedcm-connection-status">判断有效 FedCM 连接状态</dfn>，给定<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin②">origin</a> <var>embedder</var>，<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin③">origin</a> <var>identityProvider</var>，<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code>
            <var>doc</var>，执行以下步骤。该算法返回<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean"
                id="ref-for-boolean①">布尔值</a>。
        </p>
        <ol>
            <li data-md>
                <p>令 <var>policyStatus</var> 表示 <var>doc</var> 是否<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use"
                        id="ref-for-allowed-to-use">被允许使用</a> "<code>identity-credentials-get</code>"。</p>
            <li data-md>
                <p>如 <var>policyStatus</var> 为 "Disabled"，返回 false。</p>
            <li data-md>
                <p>令 <var>connected</var> 为根据 <a data-link-type="dfn" href="#determine-the-fedcm-site-connection-status"
                        id="ref-for-determine-the-fedcm-site-connection-status">判断站点连接状态</a>算法，传入 <var>embedder</var> 和
                    <var>identityProvider</var> 的结果。
                </p>
            <li data-md>
                <p>如 <var>connected</var> 为 false，返回 false。</p>
            <li data-md>
                <p>令 <var>preventSilentAccess</var> 表示 <a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">用户代理</a>的<a
                        data-link-type="dfn"
                        href="https://w3c.github.io/webappsec-credential-management/#concept-credential-store"
                        id="ref-for-concept-credential-store">凭据存储</a>中
                    <a data-link-type="dfn"
                        href="https://w3c.github.io/webappsec-credential-management/#origin-prevent-silent-access-flag"
                        id="ref-for-origin-prevent-silent-access-flag">origin-防静默访问标志</a>
                    对于 <var>embedder</var> 的值。
                </p>
            <li data-md>
                <p>如 <var>preventSilentAccess</var> 为真，返回 false。</p>
            <li data-md>
                <p>返回 true。</p>
        </ol>
        <h3 class="heading settled" data-level="3.1" id="ua-state"><span class="secno">3.1. </span><span
                class="content">与存储访问相关的用户代理状态更改</span><a class="self-link" href="#ua-state"></a></h3>
        <p>按如下方式修改 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#environment"
                id="ref-for-environment">environment</a> 的定义：</p>
        <ol>
            <li data-md>
                <p>新增名为 <dfn class="dfn-paneled" data-dfn-for="environment" data-dfn-type="dfn" data-noexport
                        id="environment-has-storage-access">has storage access</dfn> 的成员，类型为 <a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean②">布尔值</a>。</p>
        </ol>
        <p>按如下方式修改 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params"
                id="ref-for-source-snapshot-params">source snapshot params</a> 的定义：</p>
        <ol>
            <li data-md>
                <p>新增名为 <dfn class="dfn-paneled" data-dfn-for="source snapshot params" data-dfn-type="dfn" data-noexport
                        id="source-snapshot-params-has-storage-access">has storage
                        access</dfn> 的成员，类型为 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean"
                        id="ref-for-boolean③">布尔值</a>。</p>
            <li data-md>
                <p>新增名为 <dfn class="dfn-paneled" data-dfn-for="source snapshot params" data-dfn-type="dfn" data-noexport
                        id="source-snapshot-params-environment-id">environment id</dfn>
                    的成员，类型为 opaque <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string"
                        id="ref-for-string">字符串</a>。</p>
        </ol>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-access-eligibility">存储访问资格</dfn> 可以为
            "<dfn class="dfn-paneled" data-dfn-for="storage access eligibility" data-dfn-type="dfn" data-noexport
                id="storage-access-eligibility-unset">unset</dfn>"、"<dfn class="dfn-paneled"
                data-dfn-for="storage access eligibility" data-dfn-type="dfn" data-noexport
                id="storage-access-eligibility-ineligible">ineligible</dfn>" 或 "<dfn class="dfn-paneled"
                data-dfn-for="storage access eligibility" data-dfn-type="dfn" data-noexport
                id="storage-access-eligibility-eligible">eligible</dfn>"。</p>
        <p>
            <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request">请求</a>拥有一个<a data-link-type="dfn" href="#storage-access-eligibility"
                id="ref-for-storage-access-eligibility">存储访问资格</a>
            <dfn class="dfn-paneled" data-dfn-for="request" data-dfn-type="dfn" data-noexport
                id="request-eligible-for-storage-access">eligible for storage-access</dfn>。其初始值为
            "<code><a data-link-type="dfn" href="#storage-access-eligibility-unset" id="ref-for-storage-access-eligibility-unset">unset</a></code>"。
        </p>
        <p class="note" role="note"><span class="marker">注意：</span>一个<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">请求</a>的<a
                data-link-type="dfn" href="#storage-access-eligibility"
                id="ref-for-storage-access-eligibility①">存储访问资格</a>
            指示在评估此<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request②">请求</a>应包含哪些 cookie 时，
            是否应考虑此前授予的 "<a class="idl-code" data-link-type="permission" href="#permissiondef-storage-access"
                id="ref-for-permissiondef-storage-access"><code>storage-access</code></a>" 权限。
            特别要注意，<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess②">requestStorageAccess</a></code>
            完成以及<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#environment"
                id="ref-for-environment①">environment</a> 的 <a data-link-type="dfn"
                href="#environment-has-storage-access" id="ref-for-environment-has-storage-access">has storage
                access</a>
            被设为 true 后，并不是该 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request③">environment</a>中发起的所有请求都应携带未分区 cookie。
            <br>
            <br>
            例如，假设用户正在访问 https://top.com，该页面嵌入了来自 https://embed.com 的
            <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element④">iframe</a></code>，
            且该 iframe 中脚本已调用 <code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess③">requestStorageAccess</a></code>
            并已 resolve。如果该 iframe 随后去 fetch https://3p.com 的资源，该请求不会通过存储访问 API 附带 cookie。
        </p>
        <div class="algorithm" data-algorithm="determine the initial storage-access eligibility">

            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="determine-the-initial-storage-access-eligibility">判断初始存储访问资格</dfn>，给定<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request④">请求</a>
            <var>request</var>，执行以下步骤：

            <ol>
                <li data-md>
                    <p>如果 <var>request</var> 的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-client"
                            id="ref-for-concept-request-client">client</a> 为 null，则返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-unset" id="ref-for-storage-access-eligibility-unset①">unset</a></code>"。
                    </p>
                <li data-md>
                    <p>如果 <var>request</var> 的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-client"
                            id="ref-for-concept-request-client①">client</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/#TODO" id="ref-for-TODO">祖先链</a>不是
                        "<code>cross-site</code>"，则返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-unset" id="ref-for-storage-access-eligibility-unset②">unset</a></code>"。
                    </p>
            </ol>
            <p class="issue" id="issue-ad55531e"><a class="self-link" href="#issue-ad55531e"></a> “ancestry” 的概念正通过
                <a href="https://github.com/whatwg/html/pull/11133">https://github.com/whatwg/html/pull/11133</a> 被添加到
                HTML 规范
            </p>
            <ol>
                <li data-md>
                    <p>如果 <var>request</var> 的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-client"
                            id="ref-for-concept-request-client②">client</a> 的<a data-link-type="dfn"
                            href="#environment-has-storage-access" id="ref-for-environment-has-storage-access①">has
                            storage access</a> 为 false，则返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-ineligible" id="ref-for-storage-access-eligibility-ineligible">ineligible</a></code>"。
                    </p>
                <li data-md>
                    <p>如果 <var>request</var> 的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin">origin</a>与 <var>request</var>的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-url"
                            id="ref-for-concept-request-url">url</a> 的 <a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin①">origin</a> 不同源，则返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-ineligible" id="ref-for-storage-access-eligibility-ineligible①">ineligible</a></code>"。
                    </p>
                <li data-md>
                    <p>令 <var>allowed</var> 为执行 <a data-link-type="abstract-op"
                            href="https://w3c.github.io/webappsec-permissions-policy/#should-request-be-allowed-to-use-feature"
                            id="ref-for-should-request-be-allowed-to-use-feature">Should request be allowed to use
                            feature?</a>，参数为 "<a class="idl-code" data-link-type="permission"
                            href="#permissiondef-storage-access"
                            id="ref-for-permissiondef-storage-access①"><code>storage-access</code></a>" 和
                        <var>request</var>，得到的结果。
                    </p>
                <li data-md>
                    <p>如果 <var>allowed</var> 为 false，则返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-ineligible" id="ref-for-storage-access-eligibility-ineligible②">ineligible</a></code>"。
                    </p>
                <li data-md>
                    <p>返回
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-eligible" id="ref-for-storage-access-eligibility-eligible">eligible</a></code>"。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.2" id="the-document-object"><span class="secno">3.2. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑤">Document</a></code>
                的变更</span><a class="self-link" href="#the-document-object"></a></h3>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑥"><c- g>Document</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-document-hasstorageaccess" id="ref-for-dom-document-hasstorageaccess②"><c- g>hasStorageAccess</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess④"><c- g>requestStorageAccess</c-></a>();
};
</pre>
        <p>在 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑦">Document</a></code>
            <var>doc</var> 上调用 <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="method"
                data-export id="dom-document-hasstorageaccess"><code>hasStorageAccess()</code></dfn> 方法时，必须执行以下步骤：
        </p>
        <ol>
            <li data-md>
                <p>令 <var>p</var> 为 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                        id="ref-for-a-new-promise">一个新的 promise</a>。</p>
            <li data-md>
                <p>如果 <var>doc</var> 不是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                        id="ref-for-fully-active">完全激活</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>如果 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-origin"
                        id="ref-for-concept-document-origin">origin</a> 是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"
                        id="ref-for-concept-origin-opaque">不透明来源</a>，则用 false 解析 <var>p</var> 并返回 <var>p</var>。</p>
            <li data-md>
                <p>令 <var>global</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                        id="ref-for-concept-relevant-global">相关全局对象</a>。</p>
            <li data-md>
                <p>如果 <var>global</var> 不是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                        id="ref-for-secure-context">安全上下文</a>，则用 false 解析 <var>p</var> 并返回 <var>p</var>。</p>
            <li data-md>
                <p>如果 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"
                        id="ref-for-concept-environment-top-level-origin①">顶级来源</a> 是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"
                        id="ref-for-concept-origin-opaque①">不透明来源</a>，则用 false 解析 <var>p</var> 并返回 <var>p</var>。</p>
            <li data-md>
                <p>令 <var>browsingContext</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"
                        id="ref-for-concept-document-bc">浏览上下文</a>。</p>
            <li data-md>
                <p>令 <var>topLevelSite</var> 为通过 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                        id="ref-for-obtain-a-site">从</a> <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"
                        id="ref-for-concept-environment-top-level-origin②">顶级来源</a> 的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                        id="ref-for-relevant-settings-object②">相关设置对象</a> 获取的站点结果。</p>
            <li data-md>
                <p>令 <var>embeddedSite</var> 为通过 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                        id="ref-for-obtain-a-site①">从</a> <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-origin"
                        id="ref-for-concept-document-origin①">origin</a> 获取的站点结果。</p>
            <li data-md>
                <p>按如下步骤 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                        id="ref-for-in-parallel">并行运行</a>：</p>
                <ol>
                    <li data-md>
                        <p>令 <var>explicitSetting</var> 为使用 (<var>topLevelSite</var>, <var>embeddedSite</var>) 调用 <a
                                data-link-type="dfn"
                                href="#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access"
                                id="ref-for-determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access">判断用户代理是否明确允许未分区
                                cookie 访问</a> 的结果。</p>
                    <li data-md>
                        <p>令 <var>permissionState</var> 为使用 "<a class="idl-code" data-link-type="permission"
                                href="#permissiondef-storage-access"
                                id="ref-for-permissiondef-storage-access②"><code>storage-access</code></a>" 及
                            <var>global</var> 执行<a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state"
                                id="ref-for-dfn-getting-the-current-permission-state">获取当前权限状态</a>的结果。
                        </p>
                    <li data-md>
                        <p><a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"
                                id="ref-for-queue-a-global-task">在</a> <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source"
                                id="ref-for-networking-task-source">网络任务源</a> 上为 <var>global</var> 排队全局任务：</p>
                        <ol>
                            <li data-md>
                                <p>若 <var>explicitSetting</var> 为 "<code>disallow</code>"，用 false 解析 <var>p</var>。</p>
                            <li data-md>
                                <p>若 <var>explicitSetting</var> 为 "<code>allow</code>"，用 true 解析 <var>p</var>。</p>
                            <li data-md>
                                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                        id="ref-for-assert①">断言</a>：<var>explicitSetting</var> 为 "<code>none</code>"。
                                </p>
                            <li data-md>
                                <p>若 <var>browsingContext</var> 是 <a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"
                                        id="ref-for-top-level-browsing-context①">顶级浏览上下文</a>，用 true 解析 <var>p</var>。</p>
                            <li data-md>
                                <p>若 <var>browsingContext</var> 与其<a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"
                                        id="ref-for-top-level-browsing-context②">顶级浏览上下文</a>的<a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                                        id="ref-for-nav-document②">活动文档</a>属于相同权限主体，则用 true 解析 <var>p</var>。</p>
                                <p class="issue" id="issue-396d9a1a"><a class="self-link" href="#issue-396d9a1a"></a>
                                    “same authority” 为未来定义概念的占位符（允许用户代理在执行 <a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/browsers.html#same-site"
                                        id="ref-for-same-site③">同站</a> 检查时增加如父文档为跨站点等额外安全考量），详见 <a
                                        href="https://github.com/whatwg/storage/issues/142#issuecomment-1122147159">whatwg/storage#142</a>。
                                    实际上，这可能涉及对 <a data-link-type="dfn"
                                        href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11#section-5.2.1"
                                        id="ref-for-section-5.2.1">cookie 站点</a> 的比较，或与顶级文档进行一次 <a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/browsers.html#same-site"
                                        id="ref-for-same-site④">same site</a> 检查。</p>
                            <li data-md>
                                <p>若 <var>permissionState</var> 为 <a data-link-type="dfn"
                                        href="https://w3c.github.io/permissions/#dfn-granted"
                                        id="ref-for-dfn-granted">granted</a>，用 <var>global</var> 的<a
                                        data-link-type="dfn" href="#environment-has-storage-access"
                                        id="ref-for-environment-has-storage-access②">has storage access</a> 解析
                                    <var>p</var>。
                                </p>
                                <p class="note" role="note"><span class="marker">注意：</span>此处全局的存储访问权限状态优先于本地 <a
                                        data-link-type="dfn" href="#environment-has-storage-access"
                                        id="ref-for-environment-has-storage-access③">has storage access</a>
                                    标志，以便于立即响应用户在设置中撤回权限的选择。</p>
                            <li data-md>
                                <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                        id="ref-for-resolve⑧">用 false 解析</a> <var>p</var>。</p>
                        </ol>
                </ol>
            <li data-md>
                <p>返回 <var>p</var>。</p>
        </ol>
        <p>在 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑧">Document</a></code>
            <var>doc</var> 上调用 <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="method"
                data-export id="dom-document-requeststorageaccess"><code>requestStorageAccess()</code></dfn>
            方法时，必须执行以下步骤：
        </p>
        <ol>
            <li data-md>
                <p>令 <var>p</var> 为 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                        id="ref-for-a-new-promise①">一个新的 promise</a>。</p>
            <li data-md>
                <p>如果 <var>doc</var> 不是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                        id="ref-for-fully-active①">完全激活</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>令 <var>global</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                        id="ref-for-concept-relevant-global①">相关全局对象</a>。</p>
            <li data-md>
                <p>令 <var>settings</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                        id="ref-for-relevant-settings-object③">相关设置对象</a>。</p>
            <li data-md>
                <p>如果 <var>global</var> 不是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                        id="ref-for-secure-context①">安全上下文</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>如果 <var>doc</var> 不被允许使用 "<code>storage-access</code>"，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>如果 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-origin"
                        id="ref-for-concept-document-origin②">origin</a> 是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"
                        id="ref-for-concept-origin-opaque②">不透明来源</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror②">NotAllowedError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>如果 <var>settings</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"
                        id="ref-for-concept-environment-top-level-origin③">顶级来源</a> 是 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque"
                        id="ref-for-concept-origin-opaque③">不透明来源</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror③">NotAllowedError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>如果 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set"
                        id="ref-for-active-sandboxing-flag-set">活动沙箱标志集</a>包含 <a data-link-type="dfn"
                        href="#sandbox-storage-access-by-user-activation-flag"
                        id="ref-for-sandbox-storage-access-by-user-activation-flag">通过用户激活获取存储访问的沙箱标志</a>，则用
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror④">NotAllowedError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>
                    拒绝 <var>p</var> 并返回 <var>p</var>。
                </p>
            <li data-md>
                <p>令 <var>browsingContext</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"
                        id="ref-for-concept-document-bc①">浏览上下文</a>。</p>
            <li data-md>
                <p>令 <var>topLevelOrigin</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin"
                        id="ref-for-concept-environment-top-level-origin④">相关设置对象</a>的顶级来源。</p>
            <li data-md>
                <p>令 <var>topLevelSite</var> 为从 <var>topLevelOrigin</var> <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                        id="ref-for-obtain-a-site②">获取的站点</a>。</p>
            <li data-md>
                <p>令 <var>embeddedOrigin</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-origin"
                        id="ref-for-concept-document-origin③">origin</a>。</p>
            <li data-md>
                <p>令 <var>embeddedSite</var> 为从 <var>embeddedOrigin</var> <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                        id="ref-for-obtain-a-site③">获取的站点</a>。</p>
            <li data-md>
                <p>令 <var>has transient activation</var> 表示 <var>doc</var> 的 <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>
                    对象是否具有<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation"
                        id="ref-for-transient-activation">短暂激活</a>。</p>
            <li data-md>
                <p>按如下步骤 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                        id="ref-for-in-parallel①">并行运行</a>：</p>
                <ol>
                    <li data-md>
                        <p>令 <var>process permission state</var> 为一算法，给定 <a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-permission-state"
                                id="ref-for-dfn-permission-state">权限状态</a> <var>state</var> 时，执行以下步骤：</p>
                        <ol>
                            <li data-md>
                                <p>在 <a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source"
                                        id="ref-for-networking-task-source①">网络任务源</a> 上为 <var>global</var>
                                    排队全局任务：</p>
                                <ol>
                                    <li data-md>
                                        <p>若 <var>state</var> 为 <a data-link-type="dfn"
                                                href="https://w3c.github.io/permissions/#dfn-granted"
                                                id="ref-for-dfn-granted①">granted</a>：</p>
                                        <ol>
                                            <li data-md>
                                                <p>将 <var>global</var> 的 <a data-link-type="dfn"
                                                        href="#environment-has-storage-access"
                                                        id="ref-for-environment-has-storage-access④">has storage
                                                        access</a> 设为 true。</p>
                                            <li data-md>
                                                <p>用 <code
                                                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①">undefined</a></code>
                                                    解析 <var>p</var>。</p>
                                        </ol>
                                    <li data-md>
                                        <p>否则：</p>
                                        <ol>
                                            <li data-md>
                                                <p>对 <var>global</var> <a data-link-type="dfn"
                                                        href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation"
                                                        id="ref-for-consume-user-activation">消费用户激活</a>。</p>
                                            <li data-md>
                                                <p>用
                                                    "<code
                                                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror⑤">NotAllowedError</a></code>"
                                                    <code
                                                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>
                                                    拒绝 <var>p</var>。
                                                </p>
                                        </ol>
                                </ol>
                        </ol>
                    <li data-md>
                        <p>令 <var>explicitSetting</var> 为使用 (<var>topLevelSite</var>, <var>embeddedSite</var>) 调用 <a
                                data-link-type="dfn"
                                href="#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access"
                                id="ref-for-determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access①">判断用户代理是否明确允许未分区
                                cookie 访问</a> 的结果。</p>
                    <li data-md>
                        <p>若 <var>explicitSetting</var> 为 "<code>disallow</code>"：</p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied"
                                        id="ref-for-dfn-denied">denied</a> 调用 <var>process permission state</var>。</p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>若 <var>explicitSetting</var> 为 "<code>allow</code>"：</p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                                        id="ref-for-dfn-granted②">granted</a> 调用 <var>process permission state</var>。
                                </p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                id="ref-for-assert②">断言</a>：<var>explicitSetting</var> 为 "<code>none</code>"。</p>
                    <li data-md>
                        <p>如果 <var>browsingContext</var> 是 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"
                                id="ref-for-top-level-browsing-context③">顶级浏览上下文</a>：</p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                                        id="ref-for-dfn-granted③">granted</a> 调用 <var>process permission state</var>。
                                </p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>如果 <var>embeddedSite</var> 与 <var>topLevelSite</var> <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site"
                                id="ref-for-concept-site-same-site">同站</a>：</p>
                        <p class="note" role="note"><span class="marker">注：</span> 这里有意用 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site"
                                id="ref-for-concept-site-same-site①">same site</a> 检查，以便嵌入站点在出于安全但非隐私原因受限存储访问的情况下，可自行调用
                            <code>requestStorageAccess()</code>
                            获得访问，无需最终用户参与。
                        </p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                                        id="ref-for-dfn-granted④">granted</a> 调用 <var>process permission state</var>。
                                </p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>令 <var>previous permission state</var> 为使用 "<a class="idl-code" data-link-type="permission"
                                href="#permissiondef-storage-access"
                                id="ref-for-permissiondef-storage-access③"><code>storage-access</code></a>" 及
                            <var>global</var> 执行 <a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state"
                                id="ref-for-dfn-getting-the-current-permission-state①">获取当前权限状态</a>的结果。
                        </p>
                    <li data-md>
                        <p>如果 <var>previous permission state</var> 不是 <a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-prompt" id="ref-for-dfn-prompt">prompt</a>：
                        </p>
                        <ol>
                            <li data-md>
                                <p>以 <var>previous permission state</var> 调用 <var>process permission state</var>。</p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>令 <var>connected</var> 为以 <var>topLevelOrigin</var>、<var>embeddedOrigin</var>、
                            <var>doc</var> 调用 <a data-link-type="dfn"
                                href="#determine-the-effective-fedcm-connection-status"
                                id="ref-for-determine-the-effective-fedcm-connection-status">判断有效 FedCM 连接状态</a> 的结果。
                        </p>
                    <li data-md>
                        <p>若 <var>connected</var>：</p>
                        <p class="note" role="note"><span class="marker">注：</span> 鼓励用户代理追踪因已存在 FedCM
                            连接而允许存储访问的（站点，站点）元组，
                            以便访问 cookie 时再次核查该列表，从而防止攻击者诱导 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/#environment"
                                id="ref-for-environment③">environment</a> 使用错误的 <a data-link-type="dfn"
                                href="#environment-has-storage-access" id="ref-for-environment-has-storage-access⑤">has
                                storage access</a> 位。</p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted"
                                        id="ref-for-dfn-granted⑤">granted</a> 调用 <var>process permission state</var>。
                                </p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>若 <var>has transient activation</var> 为 false：</p>
                        <ol>
                            <li data-md>
                                <p>以 <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied"
                                        id="ref-for-dfn-denied①">denied</a> 调用 <var>process permission state</var>。</p>
                            <li data-md>
                                <p>中止后续步骤。</p>
                        </ol>
                    <li data-md>
                        <p>令 <var>permissionState</var> 为对 "<a class="idl-code" data-link-type="permission"
                                href="#permissiondef-storage-access"
                                id="ref-for-permissiondef-storage-access④"><code>storage-access</code></a>"
                            <a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-request-permission-to-use"
                                id="ref-for-dfn-request-permission-to-use">请求权限</a>的结果。
                        </p>
                        <p class="note" role="note"><span class="marker">注：</span> 请求权限时是否弹框由用户代理实现决定，尤其对
                            <code>storage-access</code>，用户代理常有自定义规则可在不弹框时直接允许或拒绝。
                        </p>
                    <li data-md>
                        <p>以 <var>permissionState</var> 调用 <var>process permission state</var>。</p>
                </ol>
            <li data-md>
                <p>返回 <var>p</var>。</p>
        </ol>
        <p class="note" role="note"><span class="marker">注：</span>本算法设计意图是始终要求用户激活后才设置 storage-access
            权限。虽然用户代理可基于自定义启发规则在未激活时设权限，本规范强烈反对此做法，以免导致互操作问题。</p>
        <h3 class="heading settled" data-level="3.3" id="navigation"><span class="secno">3.3. </span><span
                class="content">导航相关的更改</span><a class="self-link" href="#navigation"></a></h3>
        <p>当<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#snapshotting-source-snapshot-params"
                id="ref-for-snapshotting-source-snapshot-params">快照化源快照参数</a>时：</p>
        <ol>
            <li data-md>
                <p>将<a data-link-type="dfn" href="#source-snapshot-params-has-storage-access"
                        id="ref-for-source-snapshot-params-has-storage-access">has storage access</a>设置为
                    <var>sourceDocument</var>的<a data-link-type="dfn" href="#source-snapshot-params-has-storage-access"
                        id="ref-for-source-snapshot-params-has-storage-access①">has storage access</a>。
                </p>
            <li data-md>
                <p>将<a data-link-type="dfn" href="#source-snapshot-params-environment-id"
                        id="ref-for-source-snapshot-params-environment-id">environment id</a>设置为
                    <var>sourceDocument</var>的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                        id="ref-for-relevant-settings-object⑤">relevant settings object</a>的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id"
                        id="ref-for-concept-environment-id">id</a>。
                </p>
        </ol>
        <p>对于<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"
                id="ref-for-create-navigation-params-by-fetching">通过 fetch 创建导航参数</a>算法，在第3步插入以下内容：</p>
        <ol>
            <li data-md>
                <p>令<var>originalURL</var>为<var>entry</var>的URL。</p>
        </ol>
        <p>当在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"
                id="ref-for-create-navigation-params-by-fetching①">通过 fetch 创建导航参数</a>中创建<var>request</var>的<a
                data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client"
                id="ref-for-concept-request-reserved-client">reserved client</a>时：</p>
        <ol>
            <li data-md>
                <p>如果全部满足以下条件，则将<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-reserved-client"
                        id="ref-for-concept-request-reserved-client①">reserved client</a>的<a data-link-type="dfn"
                        href="#environment-has-storage-access" id="ref-for-environment-has-storage-access⑥">has storage
                        access</a>设置为<var>sourceSnapshotParams</var>的<a data-link-type="dfn"
                        href="#source-snapshot-params-has-storage-access"
                        id="ref-for-source-snapshot-params-has-storage-access②">has storage access</a>：</p>
                <ol>
                    <li data-md>
                        <p><var>sourceSnapshotParams</var>的<a data-link-type="dfn"
                                href="#source-snapshot-params-environment-id"
                                id="ref-for-source-snapshot-params-environment-id①">environment id</a>等于
                            <var>navigable</var>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                                id="ref-for-nav-document③">活动文档</a>的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                                id="ref-for-relevant-settings-object⑥">relevant settings object</a>的<a
                                data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id"
                                id="ref-for-concept-environment-id①">id</a>。
                        </p>
                    <li data-md>
                        <p><var>originalURL</var>的<a data-link-type="dfn"
                                href="https://url.spec.whatwg.org/#concept-url-origin"
                                id="ref-for-concept-url-origin②">origin</a>与<var>currentURL</var>的<a
                                data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin"
                                id="ref-for-concept-url-origin③">origin</a>同源。</p>
                    <li data-md>
                        <p><var>response</var>为null或<var>response</var>的<a data-link-type="dfn"
                                href="https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects"
                                id="ref-for-response-has-cross-origin-redirects">has-cross-origin-redirects</a>为false。
                        </p>
                </ol>
            <li data-md>
                <p>否则，将<var>request</var>的<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-reserved-client"
                        id="ref-for-concept-request-reserved-client②">reserved client</a>的<a data-link-type="dfn"
                        href="#environment-has-storage-access" id="ref-for-environment-has-storage-access⑦">has storage
                        access</a>设置为false。</p>
        </ol>
        <p>当<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#set-up-a-window-environment-settings-object"
                id="ref-for-set-up-a-window-environment-settings-object">设置窗口环境设置对象</a>时：</p>
        <ol>
            <li data-md>
                <p>将<var>settings object</var>的<a data-link-type="dfn" href="#environment-has-storage-access"
                        id="ref-for-environment-has-storage-access⑧">has storage access</a>设置为<var>reserved
                        environment</var>的<a data-link-type="dfn" href="#environment-has-storage-access"
                        id="ref-for-environment-has-storage-access⑨">has storage access</a>。</p>
        </ol>
        <h3 class="heading settled" data-level="3.4" id="fetch-integration"><span class="secno">3.4. </span><span
                class="content">与 Fetch 的集成</span><a class="self-link" href="#fetch-integration"></a></h3>
        <h4 class="heading settled" data-level="3.4.1" id="fetching"><span class="secno">3.4.1. </span><span
                class="content">获取流程</span><a class="self-link" href="#fetching"></a></h4>
        <p>在<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch"
                id="ref-for-concept-fetch">fetch</a>的第14步后插入新步骤：</p>
        <div class="algorithm" data-algorithm="modified fetching">
            <ol start="15">
                <li data-md>
                    <p>将<var>request</var>的<a data-link-type="dfn" href="#request-eligible-for-storage-access"
                            id="ref-for-request-eligible-for-storage-access">eligible for storage-access</a>设置为
                        <a data-link-type="dfn" href="#determine-the-initial-storage-access-eligibility"
                            id="ref-for-determine-the-initial-storage-access-eligibility">判断初始存储访问资格</a>算法对<var>request</var>的结果。
                    </p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.4.2" id="http-redirect-fetch"><span class="secno">3.4.2. </span><span
                class="content">HTTP 重定向获取</span><a class="self-link" href="#http-redirect-fetch"></a></h4>
        <p>在<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-redirect-fetch"
                id="ref-for-concept-http-redirect-fetch">HTTP-redirect fetch</a>的第17步后插入新步骤：</p>
        <div class="algorithm" data-algorithm="modified HTTP-redirect fetch">
            <ol start="18">
                <li data-md>
                    <p>如果<var>request</var>的<a data-link-type="dfn" href="#request-eligible-for-storage-access"
                            id="ref-for-request-eligible-for-storage-access①">eligible for storage-access</a>不是
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-unset" id="ref-for-storage-access-eligibility-unset③">unset</a></code>"，
                        且<var>locationURL</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin④">origin</a>与<var>request</var>的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-current-url"
                            id="ref-for-concept-request-current-url">current URL</a>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin⑤">origin</a>不同源，则将<var>request</var>的<a data-link-type="dfn"
                            href="#request-eligible-for-storage-access"
                            id="ref-for-request-eligible-for-storage-access②">eligible for storage-access</a>设置为
                        "<code><a data-link-type="dfn" href="#storage-access-eligibility-ineligible" id="ref-for-storage-access-eligibility-ineligible③">ineligible</a></code>"。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.5" id="storage"><span class="secno">3.5. </span><span
                class="content">各类客户端存储机制的更改</span><a class="self-link" href="#storage"></a></h3>
        <p>该 API 仅影响 HTTP Cookie。API 的未来版本可能会影响其他客户端状态。<a data-link-type="biblio" href="#biblio-rfc6265"
                title="HTTP State Management Mechanism">[RFC6265]</a></p>
        <h4 class="heading settled" data-level="3.5.1" id="cookies"><span class="secno">3.5.1. </span><span
                class="content">Cookie</span><a class="self-link" href="#cookies"></a></h4>
        <p>本 API 旨在配合阻止<a data-link-type="dfn" href="#third-party-context"
                id="ref-for-third-party-context①">第三方上下文</a>未分区 Cookie 访问的环境和用户代理配置使用。于当前文档发布时，该机制尚未集成到<a
                data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"
                id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a>与<code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" id="ref-for-dom-document-cookie①">cookie</a></code>算法中。
            为促进相关集成，<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265#section-5.3"
                id="ref-for-section-5.3">cookie 存储</a>将需支持关于请求顶级/嵌入站点及该<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request⑤">请求</a>是否拥有存储访问的信息（以决定是否附加跨站/分区/不附加 Cookie），并通过访问在本规范中定义的<a
                data-link-type="dfn" href="#request-eligible-for-storage-access"
                id="ref-for-request-eligible-for-storage-access③">eligible for storage-access</a>标志获悉该信息。</p>
        <p>一旦 Cookie 存储允许获取存储访问信息，我们将更新<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"
                id="ref-for-concept-http-network-or-cache-fetch①">HTTP-network-or-cache fetch</a>与<code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" id="ref-for-dom-document-cookie②">cookie</a></code>，
            在获取 Cookie 时，将<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request⑦">请求</a>的<a data-link-type="dfn" href="#request-eligible-for-storage-access"
                id="ref-for-request-eligible-for-storage-access④">eligible for storage-access</a>传递给<a
                data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265#section-5.3"
                id="ref-for-section-5.3①">cookie 存储</a>。</p>
        <p>从<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6265#section-5.3"
                id="ref-for-section-5.3②">cookie 存储</a>通过存储访问获取未分区 Cookie 时，用户代理仍会遵循 <code>SameSite</code> 限制（即在<a
                data-link-type="dfn" href="#third-party-context" id="ref-for-third-party-context②">第三方上下文</a>中不会附加
            <code>SameSite=Strict</code> 或 <code>SameSite=Lax</code> 的 Cookie）。
        </p>
        <p class="note" role="note"><span class="marker">注意：</span>用户代理可能对<code>SameSite</code> Cookie 属性有不同默认值，这会导致未设置
            <code>SameSite</code> 属性的未分区 Cookie
            在某些用户代理（默认 <code>SameSite=None</code>）请求时会被附加，而在其他用户代理（默认 <code>SameSite=Lax</code>）不会。建议 Web 开发者为自己的 Cookie
            显式设置 <code>SameSite</code> 属性以避免问题。
        </p>
        <h3 class="heading settled" data-level="3.6" id="sandboxing-storage-access"><span class="secno">3.6.
            </span><span class="content">存储访问的沙箱机制</span><a class="self-link" href="#sandboxing-storage-access"></a>
        </h3>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#sandboxing-flag-set"
                id="ref-for-sandboxing-flag-set">沙箱标志集合</a>具备一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="sandbox-storage-access-by-user-activation-flag">允许用户激活后存储访问的沙箱标志</dfn>。该标志会阻止内容请求存储访问。</p>
        <p>在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive"
                id="ref-for-parse-a-sandboxing-directive">解析沙箱指令</a>算法第3步下方，添加如下内容：</p>
        <ul>
            <li>添加<a data-link-type="dfn" href="#sandbox-storage-access-by-user-activation-flag"
                    id="ref-for-sandbox-storage-access-by-user-activation-flag①">允许用户激活后存储访问的沙箱标志</a>，除非<var>tokens</var>包含<dfn
                    class="dfn-paneled" data-dfn-for="iframe/sandbox" data-dfn-type="attr-value" data-export
                    id="attr-valuedef-iframe-sandbox-allow-storage-access-by-user-activation"><code>allow-storage-access-by-user-activation</code></dfn>关键字。
        </ul>
        <h2 class="heading settled" data-level="4" id="permissions-integration"><span class="secno">4. </span><span
                class="content">权限集成</span><a class="self-link" href="#permissions-integration"></a>
        </h2>
        <p>存储访问 API 定义了一个由<a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-name"
                id="ref-for-dfn-name">名字</a>
            "<dfn class="dfn-paneled idl-code" data-dfn-type="permission" data-export
                id="permissiondef-storage-access"><code>storage-access</code></dfn>" 标识的<a data-link-type="dfn"
                href="https://w3c.github.io/permissions/#dfn-powerful-feature"
                id="ref-for-dfn-powerful-feature">强特性</a>。它定义了以下与权限相关的算法：</p>
        <dl>
            <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-query-algorithm"
                    id="ref-for-dfn-permission-query-algorithm">权限查询算法</a>
            <dd>
                查询 "<a class="idl-code" data-link-type="permission" href="#permissiondef-storage-access"
                    id="ref-for-permissiondef-storage-access⑤"><code>storage-access</code></a>" 权限时，给定
                <code
                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor" id="ref-for-dom-permissiondescriptor">PermissionDescriptor</a></code>
                <var>permissionDesc</var> 与 <code
                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus" id="ref-for-dom-permissionstatus">PermissionStatus</a></code>
                <var>status</var>：
                <ol>
                    <li data-md>
                        <p>将<var>status</var>的<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state">state</a></code>
                            设置为<var>permissionDesc</var>的<a data-link-type="dfn"
                                href="https://w3c.github.io/permissions/#dfn-permission-state"
                                id="ref-for-dfn-permission-state①">permission state</a>。</p>
                    <li data-md>
                        <p>如<var>status</var>的<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state①">state</a></code>
                            为<a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied"
                                id="ref-for-dfn-denied②">denied</a>，则设置<var>status</var>的<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state②">state</a></code>
                            为<a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-prompt"
                                id="ref-for-dfn-prompt①">prompt</a>。</p>
                        <p class="note" role="note"><span
                                class="marker">注意：</span>权限状态“denied”不会暴露，以避免开发者获知用户决定，防止对用户进行报复或频繁重复弹窗影响体验。</p>
                </ol>
            <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key-type"
                    id="ref-for-dfn-permission-key-type">权限键类型</a>
            <dd>
                "<a class="idl-code" data-link-type="permission" href="#permissiondef-storage-access"
                    id="ref-for-permissiondef-storage-access⑥"><code>storage-access</code></a>" 特性的<a
                    data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key"
                    id="ref-for-dfn-permission-key">权限键</a>为：由一个<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site②">站点</a> <dfn
                    class="dfn-paneled" data-dfn-for="permission key" data-dfn-type="dfn" data-noexport
                    id="permission-key-top-level">top-level</dfn>和一个<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site③">站点</a> <dfn
                    class="dfn-paneled" data-dfn-for="permission key" data-dfn-type="dfn" data-noexport
                    id="permission-key-requester">请求者</dfn>组成的<a data-link-type="dfn"
                    href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">元组</a>。

                <div class="example" id="example-82f4f666">
                    <a class="self-link" href="#example-82f4f666"></a>
                    <p><code>(("https", "news.example"), ("https", "social.example"))</code> 是 "<a class="idl-code"
                            data-link-type="permission" href="#permissiondef-storage-access"
                            id="ref-for-permissiondef-storage-access⑦"><code>storage-access</code></a>" 的<a
                            data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key"
                            id="ref-for-dfn-permission-key①">权限键</a>，其<a data-link-type="dfn"
                            href="#permission-key-top-level" id="ref-for-permission-key-top-level">top-level</a>为
                        <code>("https", "news.example")</code>，其<a data-link-type="dfn" href="#permission-key-requester"
                            id="ref-for-permission-key-requester">请求者</a>为
                        <code>("https", "social.example")</code>。
                    </p>
                </div>
            <dt><a data-link-type="dfn"
                    href="https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm"
                    id="ref-for-dfn-permission-key-generation-algorithm">权限键生成算法</a>
            <dd>
                为 "<a class="idl-code" data-link-type="permission" href="#permissiondef-storage-access"
                    id="ref-for-permissiondef-storage-access⑧"><code>storage-access</code></a>" 特性生成权限键时，给定<a
                    data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                    id="ref-for-concept-origin④">origin</a> <var>origin</var> 和 <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                    id="ref-for-concept-origin⑤">origin</a> <var>embeddedOrigin</var>：
                <ol>
                    <li data-md>
                        <p>令<var>topLevelSite</var>为从<var>origin</var><a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                                id="ref-for-obtain-a-site④">获取的站点</a>。</p>
                    <li data-md>
                        <p>令<var>embeddedSite</var>为从<var>embeddedOrigin</var><a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                                id="ref-for-obtain-a-site⑤">获取的站点</a>。</p>
                    <li data-md>
                        <p>返回(<var>topLevelSite</var>, <var>embeddedSite</var>)。</p>
                </ol>
            <dt><a data-link-type="dfn"
                    href="https://w3c.github.io/permissions/#dfn-permission-key-comparison-algorithm"
                    id="ref-for-dfn-permission-key-comparison-algorithm">权限键比较算法</a>
            <dd>
                比较 "<a class="idl-code" data-link-type="permission" href="#permissiondef-storage-access"
                    id="ref-for-permissiondef-storage-access⑨"><code>storage-access</code></a>" 特性的两个<a
                    data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key"
                    id="ref-for-dfn-permission-key③">权限键</a> <var>key1</var> 和 <var>key2</var> 时，执行：
                <ol>
                    <li data-md>
                        <p>如<var>key1</var>的<a data-link-type="dfn" href="#permission-key-top-level"
                                id="ref-for-permission-key-top-level①">top-level</a>与<var>key2</var>的<a
                                data-link-type="dfn" href="#permission-key-top-level"
                                id="ref-for-permission-key-top-level②">top-level</a>不同站，则返回false。</p>
                    <li data-md>
                        <p>如<var>key1</var>的<a data-link-type="dfn" href="#permission-key-requester"
                                id="ref-for-permission-key-requester①">请求者</a>与<var>key2</var>的<a data-link-type="dfn"
                                href="#permission-key-requester"
                                id="ref-for-permission-key-requester②">请求者</a>不同站，则返回false。</p>
                    <li data-md>
                        <p>返回true。</p>
                </ol>
        </dl>
        <h2 class="heading settled" data-level="5" id="permissions-policy-integration"><span class="secno">5.
            </span><span class="content">权限策略集成</span><a class="self-link" href="#permissions-policy-integration"></a>
        </h2>
        <p>存储访问 API 定义了由字符串<code>"storage-access"</code>标识的<a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"
                id="ref-for-policy-controlled-feature">策略可控特性</a>。其<a data-link-type="dfn"
                href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"
                id="ref-for-policy-controlled-feature-default-allowlist">默认允许清单</a>为<code>"*"</code>。</p>
        <p class="note" role="note"><span class="marker">注意：</span><code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑨">Document</a></code>的<a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy"
                id="ref-for-concept-document-permissions-policy">权限策略</a>决定了该文档内的内容是否能通过<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑤">requestStorageAccess()</a></code>请求存储访问。
            如果在任一文档中被禁用，则该文档里调用<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑥">requestStorageAccess()</a></code>将会被拒绝。
        </p>
        <h2 class="heading settled" data-level="6" id="privacy"><span class="secno">6. </span><span
                class="content">隐私相关考量</span><a class="self-link" href="#privacy"></a></h2>
        <p>存储访问 API 有助于移除跨站 Cookie。特别是它允许身份验证嵌入场景继续工作。因此，该 API 为开发者重新获得跨站 Cookie 访问（但会受附加约束）提供了一条路径。</p>
        <p>嵌套<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⓪">Document</a></code>
            调用<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑦">requestStorageAccess()</a></code>并获得
            resolved
            <code
                class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②">Promise</a></code>
            后，
            可获得与其作为<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                id="ref-for-nav-document④">顶级浏览上下文</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                id="ref-for-top-level-browsing-context④">活动文档</a>一致的 Cookie。借助这些 Cookie，可对服务器进行身份认证并加载用户相关信息。
        </p>
        <p>虽然该功能伴随第三方滥用于跟踪的风险，但 API 的明确目标之一和关键设计原则，就是不削弱跨站 Cookie
            废弃带来的隐私提升。重要的是，与废弃前相比，隐私性不会变差。这归因于规范中未使用平台特有信息防止无状态跟踪，唯一新增的状态是仅限于<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site④">嵌入站点与被嵌入</a>
            <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①①">Document</a></code>之间权限声明。
        </p>
        <p>当默认已弃用跨站 Cookie 时，隐私考虑更具挑战。问题是何时及如何允许使用存储访问 API 让无 Cookie（或分区 Cookie）的嵌套<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①②">Document</a></code>
            回到废弃前状态，获得其<a data-link-type="dfn" href="#unpartitioned-data" id="ref-for-unpartitioned-data②">未分区数据</a>访问权。
        </p>
        <p>理想情况下，嵌套<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①③">Document</a></code>
            仅在满足以下条件时才能获得其<a data-link-type="dfn" href="#unpartitioned-data"
                id="ref-for-unpartitioned-data③">未分区数据</a>访问权：</p>
        <ol>
            <li data-md>
                <p>用户与嵌套<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①④">Document</a></code>发生交互
                </p>
            <li data-md>
                <p>该嵌套<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⑤">Document</a></code>被嵌入者允许使用
                    API</p>
            <li data-md>
                <p>嵌套<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⑥">Document</a></code>为<a
                        data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                        id="ref-for-secure-context②">安全上下文</a></p>
            <li data-md>
                <p>用户明确、分组授权被嵌入方使用其 Cookie</p>
            <li data-md>
                <p>不会因频繁请求 <code>storage-access</code> 权限导致用户疲劳，进而削弱用户主动授权的效力</p>
        </ol>
        <p>规定要求实现方保证前三点。这有助于保证用户知晓嵌套<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⑦">Document</a></code>内容、嵌入者未拒绝其认证、跨站点
            Cookie 不会暴露给网络攻击者。</p>
        <p>最后两点存在矛盾。理想中，用户会在每次<code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑧">requestStorageAccess()</a></code>调用时都被提示。
            但，这将允许页面频繁弹窗，有违合理体验。因此用户代理需防止过度弹窗。</p>
        <figure id="example-prompt">
            <img alt="A modal dialog box which states 'Do you want to allow “video.example” to use cookies and website data while browsing “news.example”? This will allow “video.example” to track your activity.' and which has two buttons, “Don’t Allow” and “Allow”."
                height="266" src="https://privacycg.github.io/storage-access/images/storage-access-prompt.png"
                width="840">
            <figcaption>一段示例授权弹窗，用于站点调用<code>document.</code><code
                    class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑨">requestStorageAccess()</a></code>时显示给用户。
            </figcaption>
        </figure>
        <p>因此，最后两点反映了关键妥协。只要满足其他要求，允许在授予或拒绝<a data-link-type="dfn" href="#unpartitioned-data"
                id="ref-for-unpartitioned-data④">未分区数据</a>访问时采用<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#implementation-defined"
                id="ref-for-implementation-defined">实现自定义</a>行为，无需用户介入。此妥协会较弱化第4点隐私保障，但决定权归实现方，甚至可使 API
            总无法获得存储访问。然而，这对满足第5点——在实现方就两点妥协持有差异立场时——是必要的。</p>
        <p>开发者体验会因用户代理在<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined"
                id="ref-for-implementation-defined①">实现自定义</a>行为上差异较大而受损。因此用户代理应当尽量减少或统一静默授权和拒绝。</p>
        <h3 class="heading settled" data-level="6.1" id="site-scope"><span class="secno">6.1. </span><span
                class="content">权限范围</span><a class="self-link" href="#site-scope"></a></h3>
        <p>本 API 设计中的另一个权衡点是，"<code>storage-access</code>" 权限应以什么为主键：<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin⑥">origin</a> 还是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site⑤">site</a>。我们选择了<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site"
                id="ref-for-site⑥">site</a>，因为我们认为它们在隐私上是可接受的边界，同时也支持 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site"
                id="ref-for-concept-site-same-site④">same site</a> 与 cross-origin 嵌套 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⑨">Documents</a></code>
            在同一页面只需一次用户授权弹窗的用例。
        </p>
        <h2 class="heading settled" data-level="7" id="security"><span class="secno">7. </span><span
                class="content">安全性考量</span><a class="self-link" href="#security"></a></h2>
        <p>即便与跨站 Cookie 移除后的平台相比，本规范也不应削弱 Web 平台的安全属性。第三方 Cookie 的移除有可能增进安全性，特别是在缓解依赖认证请求的攻击（如 CSRF）方面。我们不希望 Storage
            Access API 成为此类攻击的突破口。</p>
        <p>因此，我们将“<code>storage-access</code>”权限的影响局限于：只对调用了 <a data-link-type="dfn" href="#unpartitioned-data"
                id="ref-for-unpartitioned-data⑤">未分区数据</a> 访问的嵌入 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②⓪">Document</a></code>
            生效，且权限只在该嵌入
            <code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess①⓪">requestStorageAccess()</a></code>
            并未跨 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin⑦">origin</a> 边界导航前持续。这确保了只有页面主动调用 <code
                class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess①①">requestStorageAccess()</a></code>
            的 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin⑧">origin</a> 才能发起认证请求，并且被嵌入页面可通过 Content Security Policy 的
            "<code>frame-ancestors</code>"
            指令控制允许的嵌入方，从而为安全保留 origin 范围上的控制能力。
        </p>
        <h3 class="heading settled" data-level="7.1" id="reputation"><span class="secno">7.1. </span><span
                class="content">声誉攻击</span><a class="self-link" href="#reputation"></a></h3>
        <p>这同样能有效防止另一种攻击：针对被嵌入方声誉的攻击。我们认为任何跨站认证请求都可能对被嵌入方带来声誉风险，尤其是在用户更注重隐私的今天。因此，第一方或同级跨站点导致嵌入资源带上用户认证 Cookie
            的请求，就构成对该跨站点所有者声誉的攻击。这也是为何本 API 必须运行在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                id="ref-for-secure-context③">安全上下文</a>中，以防网络攻击者诱使被嵌入方调用本 API。</p>
        <p>嵌入页面可以通过权限策略和嵌套 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②②">Document</a></code>
            沙箱化来控制哪些嵌套文档可被认证，甚至哪些可以显示权限请求。</p>
        <h3 class="heading settled" data-level="7.2" id="notification"><span class="secno">7.2. </span><span
                class="content">通知滥用</span><a class="self-link" href="#notification"></a></h3>
        <p>在定义 Storage Access API 时同样考虑了通知滥用。具体来说，我们要求用户必须与嵌套 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②④">Document</a></code>
            交互，在权限被拒绝时消耗这次激活，从而限制展示权限弹窗的条件。这可以缓解像“用户刚拒绝即反复请求权限”这类攻击。</p>
        <h2 class="heading settled" data-level="8" id="automation"><span class="secno">8. </span><span
                class="content">自动化</span><a class="self-link" href="#automation"></a></h2>
        <p>为支持用户代理自动化和应用测试，本文定义了如下 <a data-link-type="dfn"
                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-extension-commands"
                id="ref-for-dfn-extension-commands">扩展命令</a>，以便于<a data-link-type="biblio" href="#biblio-webdriver"
                title="WebDriver">[WebDriver]</a> 规范集成。</p>
        <h3 class="heading settled" data-level="8.1" id="set-storage-access-command"><span class="secno">8.1.
            </span><span class="content">设置存储访问</span><a class="self-link" href="#set-storage-access-command"></a></h3>
        <table>
            <tbody>
                <tr>
                    <th>HTTP 方法
                    <th>URI 模板
                <tr>
                    <td>POST
                    <td>/session/{session id}/storageaccess
        </table>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="set-storage-access">Set Storage Access</dfn>
            <a data-link-type="dfn" href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-extension-commands"
                id="ref-for-dfn-extension-commands①">扩展命令</a>可修改<a data-link-type="dfn"
                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context"
                id="ref-for-dfn-current-browsing-context">当前浏览上下文</a>的存储访问策略。
        </p>
        <p><a data-link-type="dfn" href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-remote-end-steps"
                id="ref-for-dfn-remote-end-steps">远端步骤</a>如下：</p>
        <ol>
            <li data-md>
                <p>令 <var>blocked</var> 为通过 <a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-getting-properties"
                        id="ref-for-dfn-getting-properties">获取属性</a>从 <var>parameters</var> 读取 <code>blocked</code> 的值。
                </p>
            <li data-md>
                <p>如果 <var>blocked</var> 不是 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean"
                        id="ref-for-boolean④">布尔值</a>，则返回带有<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error"
                        id="ref-for-dfn-error">WebDriver 错误</a>和 <a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code"
                        id="ref-for-dfn-error-code">WebDriver 错误码</a>
                    <a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-invalid-argument"
                        id="ref-for-dfn-invalid-argument">invalid argument</a>。
                </p>
            <li data-md>
                <p>令 <var>embedded origin</var> 为通过 <a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-getting-properties"
                        id="ref-for-dfn-getting-properties①">获取属性</a>从 <var>parameters</var> 读取 <code>origin</code> 的值。
                </p>
            <li data-md>
                <p>如 <var>embedded origin</var> 不是单个 U+002A 星号(*)，则：</p>
                <ol>
                    <li data-md>
                        <p>令 <var>parsedURL</var> 为对 <var>embedded origin</var> 执行 <a data-link-type="dfn"
                                href="https://url.spec.whatwg.org/#concept-url-parser"
                                id="ref-for-concept-url-parser">URL 解析器</a>的结果。</p>
                    <li data-md>
                        <p>若 <var>parsedURL</var> 失败，则返回带有<a data-link-type="dfn"
                                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error"
                                id="ref-for-dfn-error①">WebDriver 错误</a>和 <a data-link-type="dfn"
                                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code"
                                id="ref-for-dfn-error-code①">WebDriver 错误码</a>
                            <a data-link-type="dfn"
                                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-invalid-argument"
                                id="ref-for-dfn-invalid-argument①">invalid argument</a>。
                        </p>
                    <li data-md>
                        <p>将 <var>embedded origin</var> 设为 <var>parsedURL</var> 的 <a data-link-type="dfn"
                                href="https://url.spec.whatwg.org/#concept-url-origin"
                                id="ref-for-concept-url-origin⑥">origin</a>。</p>
                </ol>
            <li data-md>
                <p>如<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context"
                        id="ref-for-dfn-current-browsing-context①">当前浏览上下文</a>不是<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"
                        id="ref-for-top-level-browsing-context⑤">顶级浏览上下文</a>，则返回带有<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error"
                        id="ref-for-dfn-error②">WebDriver 错误</a>和<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code"
                        id="ref-for-dfn-error-code②">WebDriver 错误码</a>
                    <a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unsupported-operation"
                        id="ref-for-dfn-unsupported-operation">unsupported operation</a>。
                </p>
            <li data-md>
                <p>令 <var>doc</var> 为<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context"
                        id="ref-for-dfn-current-browsing-context②">当前浏览上下文</a>的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                        id="ref-for-nav-document⑤">活动文档</a>。</p>
            <li data-md>
                <p>令 <var>settings</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                        id="ref-for-relevant-settings-object⑦">相关设置对象</a>。</p>
            <li data-md>
                <p>令 <var>top-level site</var> 为<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site"
                        id="ref-for-obtain-a-site⑥">从</a><var>settings</var>的<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"
                        id="ref-for-concept-settings-object-origin①">origin</a>获得的站点。</p>
            <li data-md>
                <p>如果 <var>embedded origin</var> 是单个星号(*)，则：</p>
                <ol>
                    <li data-md>
                        <p>如 <var>blocked</var> 为 <code>true</code>：</p>
                        <ol>
                            <li data-md>
                                <p>运行<a data-link-type="dfn"
                                        href="https://infra.spec.whatwg.org/#implementation-defined"
                                        id="ref-for-implementation-defined②">实现自定义</a>的步骤集，确保在 <var>top-level site</var>
                                    的<a data-link-type="dfn" href="#third-party-context"
                                        id="ref-for-third-party-context③">第三方上下文</a>中，没有任何站点可以访问自身的<a
                                        data-link-type="dfn" href="#unpartitioned-data"
                                        id="ref-for-unpartitioned-data⑥">未分区数据</a>。</p>
                        </ol>
                    <li data-md>
                        <p>否则如 <var>blocked</var> 为 <code>false</code>：</p>
                        <ol>
                            <li data-md>
                                <p>运行<a data-link-type="dfn"
                                        href="https://infra.spec.whatwg.org/#implementation-defined"
                                        id="ref-for-implementation-defined③">实现自定义</a>的步骤集，确保在 <var>top-level site</var>
                                    的<a data-link-type="dfn" href="#third-party-context"
                                        id="ref-for-third-party-context④">第三方上下文</a>中，任何站点均可访问自身的<a data-link-type="dfn"
                                        href="#unpartitioned-data" id="ref-for-unpartitioned-data⑦">未分区数据</a>。</p>
                        </ol>
                </ol>
            <li data-md>
                <p>否则：</p>
                <ol>
                    <li data-md>
                        <p>如 <var>embedded origin</var> 与 <var>settings</var> 的 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"
                                id="ref-for-concept-settings-object-origin②">origin</a> <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site"
                                id="ref-for-same-site⑤">同站</a>，则返回带有
                            <a data-link-type="dfn" href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error"
                                id="ref-for-dfn-error③">WebDriver 错误</a>和<a data-link-type="dfn"
                                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code"
                                id="ref-for-dfn-error-code③">错误码</a>
                            <a data-link-type="dfn"
                                href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unsupported-operation"
                                id="ref-for-dfn-unsupported-operation①">unsupported operation</a>。
                        </p>
                    <li data-md>
                        <p>如<var>blocked</var>为<code>true</code>：</p>
                        <ol>
                            <li data-md>
                                <p>运行<a data-link-type="dfn"
                                        href="https://infra.spec.whatwg.org/#implementation-defined"
                                        id="ref-for-implementation-defined④">实现自定义</a>的步骤集，确保<var>embedded
                                        origin</var>在<var>top-level site</var>的<a data-link-type="dfn"
                                        href="#third-party-context"
                                        id="ref-for-third-party-context⑤">第三方上下文</a>中无法访问自身的<a data-link-type="dfn"
                                        href="#unpartitioned-data" id="ref-for-unpartitioned-data⑧">未分区数据</a>。</p>
                        </ol>
                    <li data-md>
                        <p>否则如<var>blocked</var>为<code>false</code>：</p>
                        <ol>
                            <li data-md>
                                <p>运行<a data-link-type="dfn"
                                        href="https://infra.spec.whatwg.org/#implementation-defined"
                                        id="ref-for-implementation-defined⑤">实现自定义</a>的步骤集，确保<var>embedded
                                        origin</var>在<var>top-level site</var>的<a data-link-type="dfn"
                                        href="#third-party-context"
                                        id="ref-for-third-party-context⑥">第三方上下文</a>中可以访问自身的<a data-link-type="dfn"
                                        href="#unpartitioned-data" id="ref-for-unpartitioned-data⑨">未分区数据</a>。</p>
                        </ol>
                </ol>
            <li data-md>
                <p>如上述<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined"
                        id="ref-for-implementation-defined⑥">实现自定义</a>步骤集失败，则返回带有<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error"
                        id="ref-for-dfn-error④">WebDriver 错误</a>和<a data-link-type="dfn"
                        href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code"
                        id="ref-for-dfn-error-code④">错误码</a>
                    <a data-link-type="dfn" href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unknown-error"
                        id="ref-for-dfn-unknown-error">unknown error</a>。
                </p>
            <li data-md>
                <p>返回<a data-link-type="dfn" href="https://w3c.github.io/webdriver/webdriver-spec.html#dfn-success"
                        id="ref-for-dfn-success">success</a>，数据为<code>null</code>。</p>
        </ol>
        <h2 class="no-num heading settled" id="acknowledgements"><span class="content">致谢</span><a class="self-link"
                href="#acknowledgements"></a></h2>
        <p>本规范基于前任编辑 John Wilander（存储访问 API 的发明者）和 Theresa O’Connor（撰写了大量初稿内容）创造的基础之上。我们感谢他们的贡献与创意。</p>
        <p>特别感谢
            Anne van Kesteren、
            Ben Kelly、
            Brad Girardeau、
            Brad Hill、
            Brady Eidson、
            Brandon Maslen、
            Chris Mills、
            Dave Longley、
            Domenic Denicola、
            Ehsan Akhgari、
            Geoffrey Garen、
            Jack Frankland、
            James Coleman、
            James Hartig、
            Jeffrey Yasskin、
            Kushal Dave、
            Luís Rudge、
            Maciej Stachowiak、
            Matias Woloski、
            Mike O’Neill、
            Mike West、
            Pete Snyder、
            Rob Stone、
            Stefan Leyhane、
            Steven Englehardt、
            Travis Leithead、
            Yan Zhu、
            Zach Edwards、
            以及所有在 <a href="https://github.com/whatwg/html/issues/3338">whatwg/html#3338</a>、<a
                href="https://github.com/privacycg/proposals/issues/2">privacycg/proposals#2</a> 和 <a
                href="https://github.com/privacycg/storage-access/issues">privacycg/storage-access/issues</a>
            回复过本提案的朋友们。
        </p>
        <p>感谢 <a href="https://webkit.org/">WebKit 开源项目</a>允许我们使用 <a href="#example-prompt">存储访问 API 提示</a> 图片，该图片最初<a
                href="https://webkit.org/blog/8311/intelligent-tracking-prevention-2-0/">发布于 webkit.org</a>。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档规范</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求通过描述性断言和 RFC 2119 术语的组合表达。
            规范性部分中的关键词：“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”
            和“OPTIONAL”
            应按照 RFC 2119 的说明解释。
            但为增强可读性，本规范未对这些词全部使用大写字母。
        </p>
        <p>除非明确标注为非规范性、示例或备注的章节，否则本规范全部文本均为规范性内容。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>规范中的示例会以“例如”开头，或通过 <code>class="example"</code> 与规范性文本区分开，如下所示：
        </p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个说明性示例。</p>
        </div>
        <p>非规范性备注以“注（Note）”开头，并通过 <code>class="note"</code> 与规范正文区分，如下所示：
        </p>
        <p class="note" role="note">注，这是一个说明性备注。</p>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a
                href="#attr-valuedef-iframe-sandbox-allow-storage-access-by-user-activation">allow-storage-access-by-user-activation</a><span>，见
                § 3.6</span>
        <li><a href="#determine-the-effective-fedcm-connection-status">determine the effective FedCM connection
                status</a><span>，见 § 3</span>
        <li><a href="#determine-the-fedcm-site-connection-status">determine the FedCM site connection status</a><span>，见
                § 3</span>
        <li><a href="#determine-the-initial-storage-access-eligibility">determine the initial storage-access
                eligibility</a><span>，见 § 3.1</span>
        <li><a href="#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access">determine whether
                the user agent explicitly allows unpartitioned cookie access</a><span>，见 § 3</span>
        <li><a href="#storage-access-eligibility-eligible">eligible</a><span>，见 § 3.1</span>
        <li><a href="#request-eligible-for-storage-access">eligible for storage-access</a><span>，见 § 3.1</span>
        <li><a href="#source-snapshot-params-environment-id">environment id</a><span>，见 § 3.1</span>
        <li><a href="#first-party-site-context">first-party-site context</a><span>，见 § 3</span>
        <li>
            has storage access
            <ul>
                <li><a href="#environment-has-storage-access">dfn for environment</a><span>，见 § 3.1</span>
                <li><a href="#source-snapshot-params-has-storage-access">dfn for source snapshot params</a><span>，见
                        § 3.1</span>
            </ul>
        <li><a href="#dom-document-hasstorageaccess">hasStorageAccess()</a><span>，见 § 3.2</span>
        <li><a href="#storage-access-eligibility-ineligible">ineligible</a><span>，见 § 3.1</span>
        <li><a href="#permission-key-requester">requester</a><span>，见 § 4</span>
        <li><a href="#dom-document-requeststorageaccess">requestStorageAccess()</a><span>，见 § 3.2</span>
        <li><a href="#sandbox-storage-access-by-user-activation-flag">sandbox storage access by user activation
                flag</a><span>，见 § 3.6</span>
        <li><a href="#set-storage-access">Set Storage Access</a><span>，见 § 8.1</span>
        <li><a href="#permissiondef-storage-access">storage-access</a><span>，见 § 4</span>
        <li><a href="#storage-access-eligibility">storage access eligibility</a><span>，见 § 3.1</span>
        <li><a href="#third-party-context">third party context</a><span>，见 § 3</span>
        <li><a href="#permission-key-top-level">top-level</a><span>，见 § 4</span>
        <li><a href="#unpartitioned-data">Unpartitioned data</a><span>，见 § 3</span>
        <li><a href="#storage-access-eligibility-unset">unset</a><span>，见 § 3.1</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CREDENTIAL-MANAGEMENT-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="434cbb10">credential store</span>
                <li><span class="dfn-paneled" id="f52ea2e1">prevent silent access flag</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="85394472">Document</span>
                <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FEDCM-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="1cdbf0c6">connected accounts set</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FETCH]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="857d5516">client</span>
                <li><span class="dfn-paneled" id="3f2ca4de">current URL</span>
                <li><span class="dfn-paneled" id="a33db89a">fetch</span>
                <li><span class="dfn-paneled" id="5a330bbb">has-cross-origin-redirects</span>
                <li><span class="dfn-paneled" id="980528b0">http-network-or-cache fetch</span>
                <li><span class="dfn-paneled" id="8acee9c8">http-redirect fetch</span>
                <li><span class="dfn-paneled" id="55213b5b">request</span>
                <li><span class="dfn-paneled" id="abe352cd">reserved client</span>
                <li><span class="dfn-paneled" id="dc1cd39b">URL</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="5d7209e9">Window</span>
                <li><span class="dfn-paneled" id="35972864">active document</span>
                <li><span class="dfn-paneled" id="27e10eaf">active sandboxing flag set</span>
                <li><span class="dfn-paneled" id="3610bd67">allowed to use</span>
                <li><span class="dfn-paneled" id="45fae3a4">ancestry</span>
                <li><span class="dfn-paneled" id="3b2ff63e">browsing context</span>
                <li><span class="dfn-paneled" id="aca22383">consume user activation</span>
                <li><span class="dfn-paneled" id="a1e6e861">cookie</span>
                <li><span class="dfn-paneled" id="07ad3048">create navigation params by fetching</span>
                <li><span class="dfn-paneled" id="0e5e4e32">environment</span>
                <li><span class="dfn-paneled" id="0e3ba9f8">fully active</span>
                <li><span class="dfn-paneled" id="73a186aa">id</span>
                <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
                <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
                <li><span class="dfn-paneled" id="b6ae4501">networking task source</span>
                <li><span class="dfn-paneled" id="602b1a68">obtain a site</span>
                <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
                <li><span class="dfn-paneled" id="086e3aff">origin</span>
                <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings
                            object)</small></span>
                <li><span class="dfn-paneled" id="53f0ea4e">parse a sandboxing directive</span>
                <li><span class="dfn-paneled" id="a41102eb">permissions policy</span>
                <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
                <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
                <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
                <li><span class="dfn-paneled" id="7393da89">same origin</span>
                <li><span class="dfn-paneled" id="feac4ab3">same site</span>
                <li><span class="dfn-paneled" id="f0482ed2">same site <small>(for site)</small></span>
                <li><span class="dfn-paneled" id="457a6f4c">sandboxing flag set</span>
                <li><span class="dfn-paneled" id="65181da8">secure context</span>
                <li><span class="dfn-paneled" id="66f104fd">set up a window environment settings object</span>
                <li><span class="dfn-paneled" id="fb9bb722">site</span>
                <li><span class="dfn-paneled" id="42f00e01">snapshotting source snapshot params</span>
                <li><span class="dfn-paneled" id="77093875">source snapshot params</span>
                <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
                <li><span class="dfn-paneled" id="c63519ed">top-level origin</span>
                <li><span class="dfn-paneled" id="47fe679e">transient activation</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="77b4c09a">assert</span>
                <li><span class="dfn-paneled" id="36858240">boolean</span>
                <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
                <li><span class="dfn-paneled" id="f02cd417">iterate</span>
                <li><span class="dfn-paneled" id="0698d556">string</span>
                <li><span class="dfn-paneled" id="0e8de730">tuple</span>
                <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="ebb01253">PermissionDescriptor</span>
                <li><span class="dfn-paneled" id="dbf8e074">PermissionStatus</span>
                <li><span class="dfn-paneled" id="fb4878d7">denied</span>
                <li><span class="dfn-paneled" id="33438879">getting the current permission state</span>
                <li><span class="dfn-paneled" id="6821ab89">granted</span>
                <li><span class="dfn-paneled" id="e740d7e5">name</span>
                <li><span class="dfn-paneled" id="2f495016">permission key</span>
                <li><span class="dfn-paneled" id="a98e2e2c">permission key comparison algorithm</span>
                <li><span class="dfn-paneled" id="951ae231">permission key generation algorithm</span>
                <li><span class="dfn-paneled" id="79bfe9df">permission key type</span>
                <li><span class="dfn-paneled" id="7ee1f942">permission query algorithm</span>
                <li><span class="dfn-paneled" id="d124397f">permission state</span>
                <li><span class="dfn-paneled" id="6c2d7879">powerful feature</span>
                <li><span class="dfn-paneled" id="b2915302">prompt</span>
                <li><span class="dfn-paneled" id="d357c753">requesting permission to use</span>
                <li><span class="dfn-paneled" id="620f832e">state</span>
            </ul>
        <li>
            <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="c7141347">Should request be allowed to use feature?</span>
                <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
                <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
            </ul>
        <li>
            <a data-link-type="biblio">[RFC6265]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="19353784">cookie store</span>
            </ul>
        <li>
            <a data-link-type="biblio">[RFC6265BIS]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="b8623307">site for cookies</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="959ad97b">origin</span>
                <li><span class="dfn-paneled" id="ca3ca4ae">URL parser</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WebDriver]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="d695a1e4">current browsing context</span>
                <li><span class="dfn-paneled" id="64eb4e66">extension command</span>
                <li><span class="dfn-paneled" id="ae66758d">getting a property</span>
                <li><span class="dfn-paneled" id="48968b5b">invalid argument</span>
                <li><span class="dfn-paneled" id="5661b7f6">remote end steps</span>
                <li><span class="dfn-paneled" id="986c69cd">success</span>
                <li><span class="dfn-paneled" id="2dfbf26c">unknown error</span>
                <li><span class="dfn-paneled" id="87b50d92">unsupported operation</span>
                <li><span class="dfn-paneled" id="991d0ba3">WebDriver error</span>
                <li><span class="dfn-paneled" id="c45850fd">WebDriver error code</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
                <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
                <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
                <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
                <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
                <li><span class="dfn-paneled" id="5372cca8">boolean</span>
                <li><span class="dfn-paneled" id="b262501e">reject</span>
                <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
                <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]
        <dd>Nina Satragno; Marcos Caceres. <a
                href="https://w3c.github.io/webappsec-credential-management/"><cite>Credential Management Level
                    1</cite></a>. URL: <a
                href="https://w3c.github.io/webappsec-credential-management/">https://w3c.github.io/webappsec-credential-management/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard.
            URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-fedcm-1">[FEDCM-1]
        <dd>Nicolas Pena Moreno. <a href="https://w3c-fedid.github.io/FedCM/"><cite>Federated Credential Management
                    API</cite></a>. URL: <a
                href="https://w3c-fedid.github.io/FedCM/">https://w3c-fedid.github.io/FedCM/</a>
        <dt id="biblio-fetch">[FETCH]
        <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living
            Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
            Living Standard. URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    Standard</cite></a>. Living Standard. URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-permissions">[PERMISSIONS]
        <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>Permissions</cite></a>. URL:
            <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
        <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
        <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions
                    Policy</cite></a>. URL: <a
                href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-rfc6265">[RFC6265]
        <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>.
            April 2011. Proposed Standard. URL: <a
                href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
        <dt id="biblio-rfc6265bis">[RFC6265BIS]
        <dd><a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis"><cite>Cookies: HTTP State
                    Management Mechanism</cite></a>. Editor's Draft. URL: <a
                href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis">https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard.
            URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
        <dt id="biblio-webdriver">[WebDriver]
        <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a
                href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living
            Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">补充性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-storage-access-intro">[STORAGE-ACCESS-INTRO]
        <dd>John Wilander. <a href="https://webkit.org/blog/8124/introducing-storage-access-api/"><cite>Introducing
                    Storage Access API</cite></a>. February 2018. Blog post. URL: <a
                href="https://webkit.org/blog/8124/introducing-storage-access-api/">https://webkit.org/blog/8124/introducing-storage-access-api/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-document-hasstorageaccess"><c- g>hasStorageAccess</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-document-requeststorageaccess"><c- g>requestStorageAccess</c-></a>();
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> "ancestry" 概念正在 HTML 中补充添加，详见 <a
                href="https://github.com/whatwg/html/pull/11133">https://github.com/whatwg/html/pull/11133</a> <a
                class="issue-return" href="#issue-ad55531e" title="Jump to section">↵</a></div>
        <div class="issue"> 此处的 "same authority" 是未来用于允许用户代理在执行 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site">同站</a>
            检查时，兼顾诸如存在跨站父文档等附加安全属性的概念占位符，详情见 <a
                href="https://github.com/whatwg/storage/issues/142#issuecomment-1122147159">whatwg/storage#142</a>。实践中，这可能涉及对
            <a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11#section-5.2.1">cookie
                站点</a>的比较，或与顶级文档做一次 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#same-site">same site</a> 检查。<a
                class="issue-return" href="#issue-396d9a1a" title="Jump to section">↵</a>
        </div>
    </div>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "0698d556": { "dfnID": "0698d556", "dfnText": "string", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-string" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://infra.spec.whatwg.org/#string" },
                "07ad3048": { "dfnID": "07ad3048", "dfnText": "create navigation params by fetching", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-create-navigation-params-by-fetching" }, { "id": "ref-for-create-navigation-params-by-fetching\u2460" }], "title": "3.3. Changes to navigation" }], "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching" },
                "086e3aff": { "dfnID": "086e3aff", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin" }, { "id": "ref-for-concept-origin\u2460" }, { "id": "ref-for-concept-origin\u2461" }, { "id": "ref-for-concept-origin\u2462" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-concept-origin\u2463" }, { "id": "ref-for-concept-origin\u2464" }], "title": "4. Permissions Integration" }, { "refs": [{ "id": "ref-for-concept-origin\u2465" }], "title": "6.1. Permission scope" }, { "refs": [{ "id": "ref-for-concept-origin\u2466" }, { "id": "ref-for-concept-origin\u2467" }, { "id": "ref-for-concept-origin\u2468" }], "title": "7. Security considerations" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "0e3ba9f8": { "dfnID": "0e3ba9f8", "dfnText": "fully active", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-fully-active" }, { "id": "ref-for-fully-active\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active" },
                "0e5e4e32": { "dfnID": "0e5e4e32", "dfnText": "environment", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-environment" }, { "id": "ref-for-environment\u2460" }, { "id": "ref-for-environment\u2461" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-environment\u2462" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/#environment" },
                "0e8de730": { "dfnID": "0e8de730", "dfnText": "tuple", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-tuple" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-tuple\u2460" }], "title": "4. Permissions Integration" }], "url": "https://infra.spec.whatwg.org/#tuple" },
                "1570624a": { "dfnID": "1570624a", "dfnText": "default allowlist", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature-default-allowlist" }], "title": "5. Permissions Policy Integration" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "19353784": { "dfnID": "19353784", "dfnText": "cookie store", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-5.3" }, { "id": "ref-for-section-5.3\u2460" }, { "id": "ref-for-section-5.3\u2461" }], "title": "3.5.1. Cookies" }], "url": "https://tools.ietf.org/html/rfc6265#section-5.3" },
                "1cdbf0c6": { "dfnID": "1cdbf0c6", "dfnText": "connected accounts set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-browser-connected-accounts-set" }], "title": "3. The Storage Access API" }], "url": "https://w3c-fedid.github.io/FedCM/#browser-connected-accounts-set" },
                "27e10eaf": { "dfnID": "27e10eaf", "dfnText": "active sandboxing flag set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-active-sandboxing-flag-set" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set" },
                "2dfbf26c": { "dfnID": "2dfbf26c", "dfnText": "unknown error", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-unknown-error" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unknown-error" },
                "2f495016": { "dfnID": "2f495016", "dfnText": "permission key", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-key" }, { "id": "ref-for-dfn-permission-key\u2460" }, { "id": "ref-for-dfn-permission-key\u2461" }, { "id": "ref-for-dfn-permission-key\u2462" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-key" },
                "33438879": { "dfnID": "33438879", "dfnText": "getting the current permission state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-getting-the-current-permission-state" }, { "id": "ref-for-dfn-getting-the-current-permission-state\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state" },
                "35972864": { "dfnID": "35972864", "dfnText": "active document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-nav-document" }, { "id": "ref-for-nav-document\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-nav-document\u2461" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-nav-document\u2462" }], "title": "3.3. Changes to navigation" }, { "refs": [{ "id": "ref-for-nav-document\u2463" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-nav-document\u2464" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" },
                "3610bd67": { "dfnID": "3610bd67", "dfnText": "allowed to use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-allowed-to-use" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-allowed-to-use\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" },
                "36858240": { "dfnID": "36858240", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-boolean" }, { "id": "ref-for-boolean\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-boolean\u2461" }, { "id": "ref-for-boolean\u2462" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-boolean\u2463" }], "title": "8.1. Set Storage Access" }], "url": "https://infra.spec.whatwg.org/#boolean" },
                "3b2ff63e": { "dfnID": "3b2ff63e", "dfnText": "browsing context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-bc" }, { "id": "ref-for-concept-document-bc\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" },
                "3b90bdcd": { "dfnID": "3b90bdcd", "dfnText": "resolve", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-resolve" }, { "id": "ref-for-resolve\u2460" }, { "id": "ref-for-resolve\u2461" }, { "id": "ref-for-resolve\u2462" }, { "id": "ref-for-resolve\u2463" }, { "id": "ref-for-resolve\u2464" }, { "id": "ref-for-resolve\u2465" }, { "id": "ref-for-resolve\u2466" }, { "id": "ref-for-resolve\u2467" }, { "id": "ref-for-resolve\u2468" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#resolve" },
                "3f2ca4de": { "dfnID": "3f2ca4de", "dfnText": "current URL", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-current-url" }], "title": "3.4.2. HTTP-redirect-fetch" }], "url": "https://fetch.spec.whatwg.org/#concept-request-current-url" },
                "42f00e01": { "dfnID": "42f00e01", "dfnText": "snapshotting source snapshot params", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-snapshotting-source-snapshot-params" }], "title": "3.3. Changes to navigation" }], "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#snapshotting-source-snapshot-params" },
                "434cbb10": { "dfnID": "434cbb10", "dfnText": "credential store", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-credential-store" }], "title": "3. The Storage Access API" }], "url": "https://w3c.github.io/webappsec-credential-management/#concept-credential-store" },
                "43ac8374": { "dfnID": "43ac8374", "dfnText": "origin (for environment settings object)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-settings-object-origin" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-concept-settings-object-origin\u2460" }, { "id": "ref-for-concept-settings-object-origin\u2461" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" },
                "457a6f4c": { "dfnID": "457a6f4c", "dfnText": "sandboxing flag set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-sandboxing-flag-set" }], "title": "3.6. Sandboxing storage access" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#sandboxing-flag-set" },
                "45fae3a4": { "dfnID": "45fae3a4", "dfnText": "ancestry", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-TODO" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://html.spec.whatwg.org/multipage/#TODO" },
                "47fe679e": { "dfnID": "47fe679e", "dfnText": "transient activation", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-transient-activation" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" },
                "48438eb3": { "dfnID": "48438eb3", "dfnText": "queue a global task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-global-task" }, { "id": "ref-for-queue-a-global-task\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "48968b5b": { "dfnID": "48968b5b", "dfnText": "invalid argument", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-invalid-argument" }, { "id": "ref-for-dfn-invalid-argument\u2460" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-invalid-argument" },
                "5372cca8": { "dfnID": "5372cca8", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-boolean" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "53f0ea4e": { "dfnID": "53f0ea4e", "dfnText": "parse a sandboxing directive", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-parse-a-sandboxing-directive" }], "title": "3.6. Sandboxing storage access" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive" },
                "55213b5b": { "dfnID": "55213b5b", "dfnText": "request", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request" }, { "id": "ref-for-concept-request\u2460" }, { "id": "ref-for-concept-request\u2461" }, { "id": "ref-for-concept-request\u2462" }, { "id": "ref-for-concept-request\u2463" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-concept-request\u2464" }, { "id": "ref-for-concept-request\u2465" }, { "id": "ref-for-concept-request\u2466" }], "title": "3.5.1. Cookies" }], "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "5661b7f6": { "dfnID": "5661b7f6", "dfnText": "remote end steps", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-remote-end-steps" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-remote-end-steps" },
                "5a330bbb": { "dfnID": "5a330bbb", "dfnText": "has-cross-origin-redirects", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-response-has-cross-origin-redirects" }], "title": "3.3. Changes to navigation" }], "url": "https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects" },
                "5d7209e9": { "dfnID": "5d7209e9", "dfnText": "Window", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-window" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "5f90bbfb": { "dfnID": "5f90bbfb", "dfnText": "undefined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-undefined" }, { "id": "ref-for-idl-undefined\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "602b1a68": { "dfnID": "602b1a68", "dfnText": "obtain a site", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-obtain-a-site" }, { "id": "ref-for-obtain-a-site\u2460" }, { "id": "ref-for-obtain-a-site\u2461" }, { "id": "ref-for-obtain-a-site\u2462" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-obtain-a-site\u2463" }, { "id": "ref-for-obtain-a-site\u2464" }], "title": "4. Permissions Integration" }, { "refs": [{ "id": "ref-for-obtain-a-site\u2465" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" },
                "620f832e": { "dfnID": "620f832e", "dfnText": "state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-permissionstatus-state" }, { "id": "ref-for-dom-permissionstatus-state\u2460" }, { "id": "ref-for-dom-permissionstatus-state\u2461" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dom-permissionstatus-state" },
                "64eb4e66": { "dfnID": "64eb4e66", "dfnText": "extension command", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-extension-commands" }], "title": "8. Automation" }, { "refs": [{ "id": "ref-for-dfn-extension-commands\u2460" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-extension-commands" },
                "65181da8": { "dfnID": "65181da8", "dfnText": "secure context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-secure-context" }, { "id": "ref-for-secure-context\u2460" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-secure-context\u2461" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-secure-context\u2462" }], "title": "7.1. Reputational attacks" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" },
                "66f104fd": { "dfnID": "66f104fd", "dfnText": "set up a window environment settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-set-up-a-window-environment-settings-object" }], "title": "3.3. Changes to navigation" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#set-up-a-window-environment-settings-object" },
                "6821ab89": { "dfnID": "6821ab89", "dfnText": "granted", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-granted" }, { "id": "ref-for-dfn-granted\u2460" }, { "id": "ref-for-dfn-granted\u2461" }, { "id": "ref-for-dfn-granted\u2462" }, { "id": "ref-for-dfn-granted\u2463" }, { "id": "ref-for-dfn-granted\u2464" }], "title": "3.2. Changes to Document" }], "url": "https://w3c.github.io/permissions/#dfn-granted" },
                "6c2d7879": { "dfnID": "6c2d7879", "dfnText": "powerful feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-powerful-feature" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "6d19ac93": { "dfnID": "6d19ac93", "dfnText": "user agent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-user-agent" }], "title": "3. The Storage Access API" }], "url": "https://infra.spec.whatwg.org/#user-agent" },
                "7393da89": { "dfnID": "7393da89", "dfnText": "same origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-same-origin" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-same-origin\u2460" }], "title": "3.3. Changes to navigation" }, { "refs": [{ "id": "ref-for-same-origin\u2461" }], "title": "3.4.2. HTTP-redirect-fetch" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "73a186aa": { "dfnID": "73a186aa", "dfnText": "id", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-environment-id" }, { "id": "ref-for-concept-environment-id\u2460" }], "title": "3.3. Changes to navigation" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" },
                "77093875": { "dfnID": "77093875", "dfnText": "source snapshot params", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-source-snapshot-params" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params" },
                "77b4c09a": { "dfnID": "77b4c09a", "dfnText": "assert", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-assert" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-assert\u2460" }, { "id": "ref-for-assert\u2461" }], "title": "3.2. Changes to Document" }], "url": "https://infra.spec.whatwg.org/#assert" },
                "797018a7": { "dfnID": "797018a7", "dfnText": "InvalidStateError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-invalidstateerror" }, { "id": "ref-for-invalidstateerror\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "79bfe9df": { "dfnID": "79bfe9df", "dfnText": "permission key type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-key-type" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-key-type" },
                "7ee1f942": { "dfnID": "7ee1f942", "dfnText": "permission query algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-query-algorithm" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-query-algorithm" },
                "85394472": { "dfnID": "85394472", "dfnText": "Document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-document" }, { "id": "ref-for-document\u2460" }, { "id": "ref-for-document\u2461" }, { "id": "ref-for-document\u2462" }, { "id": "ref-for-document\u2463" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-document\u2464" }, { "id": "ref-for-document\u2465" }, { "id": "ref-for-document\u2466" }, { "id": "ref-for-document\u2467" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-document\u2468" }], "title": "5. Permissions Policy Integration" }, { "refs": [{ "id": "ref-for-document\u2460\u24ea" }, { "id": "ref-for-document\u2460\u2460" }, { "id": "ref-for-document\u2460\u2461" }, { "id": "ref-for-document\u2460\u2462" }, { "id": "ref-for-document\u2460\u2463" }, { "id": "ref-for-document\u2460\u2464" }, { "id": "ref-for-document\u2460\u2465" }, { "id": "ref-for-document\u2460\u2466" }, { "id": "ref-for-document\u2460\u2467" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-document\u2460\u2468" }], "title": "6.1. Permission scope" }, { "refs": [{ "id": "ref-for-document\u2461\u24ea" }, { "id": "ref-for-document\u2461\u2460" }], "title": "7. Security considerations" }, { "refs": [{ "id": "ref-for-document\u2461\u2461" }, { "id": "ref-for-document\u2461\u2462" }], "title": "7.1. Reputational attacks" }, { "refs": [{ "id": "ref-for-document\u2461\u2463" }], "title": "7.2. Notification abuse" }], "url": "https://dom.spec.whatwg.org/#document" },
                "857d5516": { "dfnID": "857d5516", "dfnText": "client", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-client" }, { "id": "ref-for-concept-request-client\u2460" }, { "id": "ref-for-concept-request-client\u2461" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "860300d4": { "dfnID": "860300d4", "dfnText": "implementation-defined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-implementation-defined" }, { "id": "ref-for-implementation-defined\u2460" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-implementation-defined\u2461" }, { "id": "ref-for-implementation-defined\u2462" }, { "id": "ref-for-implementation-defined\u2463" }, { "id": "ref-for-implementation-defined\u2464" }, { "id": "ref-for-implementation-defined\u2465" }], "title": "8.1. Set Storage Access" }], "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "87b50d92": { "dfnID": "87b50d92", "dfnText": "unsupported operation", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-unsupported-operation" }, { "id": "ref-for-dfn-unsupported-operation\u2460" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unsupported-operation" },
                "87fcd40c": { "dfnID": "87fcd40c", "dfnText": "iframe", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-the-iframe-element" }, { "id": "ref-for-the-iframe-element\u2460" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-the-iframe-element\u2461" }, { "id": "ref-for-the-iframe-element\u2462" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-the-iframe-element\u2463" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" },
                "8acee9c8": { "dfnID": "8acee9c8", "dfnText": "http-redirect fetch", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-http-redirect-fetch" }], "title": "3.4.2. HTTP-redirect-fetch" }], "url": "https://fetch.spec.whatwg.org/#concept-http-redirect-fetch" },
                "951ae231": { "dfnID": "951ae231", "dfnText": "permission key generation algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-key-generation-algorithm" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm" },
                "959ad97b": { "dfnID": "959ad97b", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-origin" }, { "id": "ref-for-concept-url-origin\u2460" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-concept-url-origin\u2461" }, { "id": "ref-for-concept-url-origin\u2462" }], "title": "3.3. Changes to navigation" }, { "refs": [{ "id": "ref-for-concept-url-origin\u2463" }, { "id": "ref-for-concept-url-origin\u2464" }], "title": "3.4.2. HTTP-redirect-fetch" }, { "refs": [{ "id": "ref-for-concept-url-origin\u2465" }], "title": "8.1. Set Storage Access" }], "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "980528b0": { "dfnID": "980528b0", "dfnText": "http-network-or-cache fetch", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-http-network-or-cache-fetch" }, { "id": "ref-for-concept-http-network-or-cache-fetch\u2460" }], "title": "3.5.1. Cookies" }], "url": "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" },
                "986c69cd": { "dfnID": "986c69cd", "dfnText": "success", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-success" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-success" },
                "991d0ba3": { "dfnID": "991d0ba3", "dfnText": "WebDriver error", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-error" }, { "id": "ref-for-dfn-error\u2460" }, { "id": "ref-for-dfn-error\u2461" }, { "id": "ref-for-dfn-error\u2462" }, { "id": "ref-for-dfn-error\u2463" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error" },
                "9c4c1e66": { "dfnID": "9c4c1e66", "dfnText": "relevant settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-relevant-settings-object" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-relevant-settings-object\u2460" }, { "id": "ref-for-relevant-settings-object\u2461" }, { "id": "ref-for-relevant-settings-object\u2462" }, { "id": "ref-for-relevant-settings-object\u2463" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-relevant-settings-object\u2464" }, { "id": "ref-for-relevant-settings-object\u2465" }], "title": "3.3. Changes to navigation" }, { "refs": [{ "id": "ref-for-relevant-settings-object\u2466" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "a1e6e861": { "dfnID": "a1e6e861", "dfnText": "cookie", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-cookie" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-dom-document-cookie\u2460" }, { "id": "ref-for-dom-document-cookie\u2461" }], "title": "3.5.1. Cookies" }], "url": "https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" },
                "a33db89a": { "dfnID": "a33db89a", "dfnText": "fetch", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-fetch" }], "title": "3.4.1. Fetching" }], "url": "https://fetch.spec.whatwg.org/#concept-fetch" },
                "a41102eb": { "dfnID": "a41102eb", "dfnText": "permissions policy", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-permissions-policy" }], "title": "5. Permissions Policy Integration" }], "url": "https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy" },
                "a72449dd": { "dfnID": "a72449dd", "dfnText": "in parallel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-in-parallel" }, { "id": "ref-for-in-parallel\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "a98e2e2c": { "dfnID": "a98e2e2c", "dfnText": "permission key comparison algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-key-comparison-algorithm" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-key-comparison-algorithm" },
                "abe352cd": { "dfnID": "abe352cd", "dfnText": "reserved client", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-reserved-client" }, { "id": "ref-for-concept-request-reserved-client\u2460" }, { "id": "ref-for-concept-request-reserved-client\u2461" }], "title": "3.3. Changes to navigation" }], "url": "https://fetch.spec.whatwg.org/#concept-request-reserved-client" },
                "aca22383": { "dfnID": "aca22383", "dfnText": "consume user activation", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-consume-user-activation" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" },
                "ae2a6342": { "dfnID": "ae2a6342", "dfnText": "top-level browsing context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-top-level-browsing-context" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-top-level-browsing-context\u2460" }, { "id": "ref-for-top-level-browsing-context\u2461" }, { "id": "ref-for-top-level-browsing-context\u2462" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-top-level-browsing-context\u2463" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-top-level-browsing-context\u2464" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" },
                "ae66758d": { "dfnID": "ae66758d", "dfnText": "getting a property", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-getting-properties" }, { "id": "ref-for-dfn-getting-properties\u2460" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-getting-properties" },
                "attr-valuedef-iframe-sandbox-allow-storage-access-by-user-activation": { "dfnID": "attr-valuedef-iframe-sandbox-allow-storage-access-by-user-activation", "dfnText": "allow-storage-access-by-user-activation", "external": false, "refSections": [], "url": "#attr-valuedef-iframe-sandbox-allow-storage-access-by-user-activation" },
                "b01b1359": { "dfnID": "b01b1359", "dfnText": "opaque origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin-opaque" }, { "id": "ref-for-concept-origin-opaque\u2460" }, { "id": "ref-for-concept-origin-opaque\u2461" }, { "id": "ref-for-concept-origin-opaque\u2462" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" },
                "b262501e": { "dfnID": "b262501e", "dfnText": "reject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reject" }, { "id": "ref-for-reject\u2460" }, { "id": "ref-for-reject\u2461" }, { "id": "ref-for-reject\u2462" }, { "id": "ref-for-reject\u2463" }, { "id": "ref-for-reject\u2464" }, { "id": "ref-for-reject\u2465" }, { "id": "ref-for-reject\u2466" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#reject" },
                "b2915302": { "dfnID": "b2915302", "dfnText": "prompt", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-prompt" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-dfn-prompt\u2460" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-prompt" },
                "b6ae4501": { "dfnID": "b6ae4501", "dfnText": "networking task source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-networking-task-source" }, { "id": "ref-for-networking-task-source\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" },
                "b8623307": { "dfnID": "b8623307", "dfnText": "site for cookies", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-5.2.1" }], "title": "3.2. Changes to Document" }], "url": "https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11#section-5.2.1" },
                "ba556545": { "dfnID": "ba556545", "dfnText": "NotAllowedError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-notallowederror" }, { "id": "ref-for-notallowederror\u2460" }, { "id": "ref-for-notallowederror\u2461" }, { "id": "ref-for-notallowederror\u2462" }, { "id": "ref-for-notallowederror\u2463" }, { "id": "ref-for-notallowederror\u2464" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "bdbd19d1": { "dfnID": "bdbd19d1", "dfnText": "Promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-promise" }, { "id": "ref-for-idl-promise\u2460" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-idl-promise\u2461" }], "title": "6. Privacy considerations" }], "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "c45850fd": { "dfnID": "c45850fd", "dfnText": "WebDriver error code", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-error-code" }, { "id": "ref-for-dfn-error-code\u2460" }, { "id": "ref-for-dfn-error-code\u2461" }, { "id": "ref-for-dfn-error-code\u2462" }, { "id": "ref-for-dfn-error-code\u2463" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code" },
                "c62cd7cf": { "dfnID": "c62cd7cf", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-origin" }, { "id": "ref-for-concept-document-origin\u2460" }, { "id": "ref-for-concept-document-origin\u2461" }, { "id": "ref-for-concept-document-origin\u2462" }], "title": "3.2. Changes to Document" }], "url": "https://dom.spec.whatwg.org/#concept-document-origin" },
                "c63519ed": { "dfnID": "c63519ed", "dfnText": "top-level origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-environment-top-level-origin" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-concept-environment-top-level-origin\u2460" }, { "id": "ref-for-concept-environment-top-level-origin\u2461" }, { "id": "ref-for-concept-environment-top-level-origin\u2462" }, { "id": "ref-for-concept-environment-top-level-origin\u2463" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" },
                "c7141347": { "dfnID": "c7141347", "dfnText": "Should request be allowed to use feature?", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-should-request-be-allowed-to-use-feature" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#should-request-be-allowed-to-use-feature" },
                "ca3ca4ae": { "dfnID": "ca3ca4ae", "dfnText": "URL parser", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-parser" }], "title": "8.1. Set Storage Access" }], "url": "https://url.spec.whatwg.org/#concept-url-parser" },
                "cc890cc1": { "dfnID": "cc890cc1", "dfnText": "policy-controlled feature", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-controlled-feature" }], "title": "5. Permissions Policy Integration" }], "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "d124397f": { "dfnID": "d124397f", "dfnText": "permission state", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-permission-state" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-dfn-permission-state\u2460" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "d357c753": { "dfnID": "d357c753", "dfnText": "requesting permission to use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-request-permission-to-use" }], "title": "3.2. Changes to Document" }], "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "d695a1e4": { "dfnID": "d695a1e4", "dfnText": "current browsing context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-current-browsing-context" }, { "id": "ref-for-dfn-current-browsing-context\u2460" }, { "id": "ref-for-dfn-current-browsing-context\u2461" }], "title": "8.1. Set Storage Access" }], "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context" },
                "dacde8b5": { "dfnID": "dacde8b5", "dfnText": "a new promise", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-a-new-promise" }, { "id": "ref-for-a-new-promise\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "dbf8e074": { "dfnID": "dbf8e074", "dfnText": "PermissionStatus", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-permissionstatus" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dom-permissionstatus" },
                "dc1cd39b": { "dfnID": "dc1cd39b", "dfnText": "URL", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-url" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "dca2de17": { "dfnID": "dca2de17", "dfnText": "DOMException", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMException" }, { "id": "ref-for-idl-DOMException\u2460" }, { "id": "ref-for-idl-DOMException\u2461" }, { "id": "ref-for-idl-DOMException\u2462" }, { "id": "ref-for-idl-DOMException\u2463" }, { "id": "ref-for-idl-DOMException\u2464" }, { "id": "ref-for-idl-DOMException\u2465" }, { "id": "ref-for-idl-DOMException\u2466" }], "title": "3.2. Changes to Document" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "determine-the-effective-fedcm-connection-status": { "dfnID": "determine-the-effective-fedcm-connection-status", "dfnText": "determine the effective FedCM connection status", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-determine-the-effective-fedcm-connection-status" }], "title": "3.2. Changes to Document" }], "url": "#determine-the-effective-fedcm-connection-status" },
                "determine-the-fedcm-site-connection-status": { "dfnID": "determine-the-fedcm-site-connection-status", "dfnText": "determine the FedCM site connection status", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-determine-the-fedcm-site-connection-status" }], "title": "3. The Storage Access API" }], "url": "#determine-the-fedcm-site-connection-status" },
                "determine-the-initial-storage-access-eligibility": { "dfnID": "determine-the-initial-storage-access-eligibility", "dfnText": "determine the initial storage-access eligibility", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-determine-the-initial-storage-access-eligibility" }], "title": "3.4.1. Fetching" }], "url": "#determine-the-initial-storage-access-eligibility" },
                "determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access": { "dfnID": "determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access", "dfnText": "determine whether the user agent explicitly allows unpartitioned cookie access", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access" }, { "id": "ref-for-determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access\u2460" }], "title": "3.2. Changes to Document" }], "url": "#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access" },
                "dom-document-hasstorageaccess": { "dfnID": "dom-document-hasstorageaccess", "dfnText": "hasStorageAccess()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-hasstorageaccess" }, { "id": "ref-for-dom-document-hasstorageaccess\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-dom-document-hasstorageaccess\u2461" }], "title": "3.2. Changes to Document" }], "url": "#dom-document-hasstorageaccess" },
                "dom-document-requeststorageaccess": { "dfnID": "dom-document-requeststorageaccess", "dfnText": "requestStorageAccess()", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-requeststorageaccess" }, { "id": "ref-for-dom-document-requeststorageaccess\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-dom-document-requeststorageaccess\u2461" }, { "id": "ref-for-dom-document-requeststorageaccess\u2462" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-dom-document-requeststorageaccess\u2463" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-dom-document-requeststorageaccess\u2464" }, { "id": "ref-for-dom-document-requeststorageaccess\u2465" }], "title": "5. Permissions Policy Integration" }, { "refs": [{ "id": "ref-for-dom-document-requeststorageaccess\u2466" }, { "id": "ref-for-dom-document-requeststorageaccess\u2467" }, { "id": "ref-for-dom-document-requeststorageaccess\u2468" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-dom-document-requeststorageaccess\u2460\u24ea" }, { "id": "ref-for-dom-document-requeststorageaccess\u2460\u2460" }], "title": "7. Security considerations" }], "url": "#dom-document-requeststorageaccess" },
                "e740d7e5": { "dfnID": "e740d7e5", "dfnText": "name", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-name" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-name" },
                "e99bd18e": { "dfnID": "e99bd18e", "dfnText": "relevant global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-global" }, { "id": "ref-for-concept-relevant-global\u2460" }], "title": "3.2. Changes to Document" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "ebb01253": { "dfnID": "ebb01253", "dfnText": "PermissionDescriptor", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-permissiondescriptor" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dom-permissiondescriptor" },
                "environment-has-storage-access": { "dfnID": "environment-has-storage-access", "dfnText": "has storage access", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-environment-has-storage-access" }, { "id": "ref-for-environment-has-storage-access\u2460" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-environment-has-storage-access\u2461" }, { "id": "ref-for-environment-has-storage-access\u2462" }, { "id": "ref-for-environment-has-storage-access\u2463" }, { "id": "ref-for-environment-has-storage-access\u2464" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-environment-has-storage-access\u2465" }, { "id": "ref-for-environment-has-storage-access\u2466" }, { "id": "ref-for-environment-has-storage-access\u2467" }, { "id": "ref-for-environment-has-storage-access\u2468" }], "title": "3.3. Changes to navigation" }], "url": "#environment-has-storage-access" },
                "f02cd417": { "dfnID": "f02cd417", "dfnText": "iterate", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-iterate" }], "title": "3. The Storage Access API" }], "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "f0482ed2": { "dfnID": "f0482ed2", "dfnText": "same site (for site)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-site-same-site" }, { "id": "ref-for-concept-site-same-site\u2460" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-concept-site-same-site\u2461" }, { "id": "ref-for-concept-site-same-site\u2462" }], "title": "4. Permissions Integration" }, { "refs": [{ "id": "ref-for-concept-site-same-site\u2463" }], "title": "6.1. Permission scope" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" },
                "f52ea2e1": { "dfnID": "f52ea2e1", "dfnText": "prevent silent access flag", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-origin-prevent-silent-access-flag" }], "title": "3. The Storage Access API" }], "url": "https://w3c.github.io/webappsec-credential-management/#origin-prevent-silent-access-flag" },
                "fb4878d7": { "dfnID": "fb4878d7", "dfnText": "denied", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-denied" }, { "id": "ref-for-dfn-denied\u2460" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-dfn-denied\u2461" }], "title": "4. Permissions Integration" }], "url": "https://w3c.github.io/permissions/#dfn-denied" },
                "fb9bb722": { "dfnID": "fb9bb722", "dfnText": "site", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-site" }, { "id": "ref-for-site\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-site\u2461" }, { "id": "ref-for-site\u2462" }], "title": "4. Permissions Integration" }, { "refs": [{ "id": "ref-for-site\u2463" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-site\u2464" }, { "id": "ref-for-site\u2465" }], "title": "6.1. Permission scope" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#site" },
                "feac4ab3": { "dfnID": "feac4ab3", "dfnText": "same site", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-same-site" }, { "id": "ref-for-same-site\u2460" }, { "id": "ref-for-same-site\u2461" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-same-site\u2462" }, { "id": "ref-for-same-site\u2463" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-same-site\u2464" }], "title": "8.1. Set Storage Access" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-site" },
                "first-party-site-context": { "dfnID": "first-party-site-context", "dfnText": "first-party-site context", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-first-party-site-context" }, { "id": "ref-for-first-party-site-context\u2460" }, { "id": "ref-for-first-party-site-context\u2461" }, { "id": "ref-for-first-party-site-context\u2462" }], "title": "3. The Storage Access API" }], "url": "#first-party-site-context" },
                "permission-key-requester": { "dfnID": "permission-key-requester", "dfnText": "requester", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-permission-key-requester" }, { "id": "ref-for-permission-key-requester\u2460" }, { "id": "ref-for-permission-key-requester\u2461" }], "title": "4. Permissions Integration" }], "url": "#permission-key-requester" },
                "permission-key-top-level": { "dfnID": "permission-key-top-level", "dfnText": "top-level", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-permission-key-top-level" }, { "id": "ref-for-permission-key-top-level\u2460" }, { "id": "ref-for-permission-key-top-level\u2461" }], "title": "4. Permissions Integration" }], "url": "#permission-key-top-level" },
                "permissiondef-storage-access": { "dfnID": "permissiondef-storage-access", "dfnText": "storage-access", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-permissiondef-storage-access" }, { "id": "ref-for-permissiondef-storage-access\u2460" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-permissiondef-storage-access\u2461" }, { "id": "ref-for-permissiondef-storage-access\u2462" }, { "id": "ref-for-permissiondef-storage-access\u2463" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-permissiondef-storage-access\u2464" }, { "id": "ref-for-permissiondef-storage-access\u2465" }, { "id": "ref-for-permissiondef-storage-access\u2466" }, { "id": "ref-for-permissiondef-storage-access\u2467" }, { "id": "ref-for-permissiondef-storage-access\u2468" }], "title": "4. Permissions Integration" }], "url": "#permissiondef-storage-access" },
                "request-eligible-for-storage-access": { "dfnID": "request-eligible-for-storage-access", "dfnText": "eligible for storage-access", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-request-eligible-for-storage-access" }], "title": "3.4.1. Fetching" }, { "refs": [{ "id": "ref-for-request-eligible-for-storage-access\u2460" }, { "id": "ref-for-request-eligible-for-storage-access\u2461" }], "title": "3.4.2. HTTP-redirect-fetch" }, { "refs": [{ "id": "ref-for-request-eligible-for-storage-access\u2462" }, { "id": "ref-for-request-eligible-for-storage-access\u2463" }], "title": "3.5.1. Cookies" }], "url": "#request-eligible-for-storage-access" },
                "sandbox-storage-access-by-user-activation-flag": { "dfnID": "sandbox-storage-access-by-user-activation-flag", "dfnText": "sandbox storage access by user activation flag", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-sandbox-storage-access-by-user-activation-flag" }], "title": "3.2. Changes to Document" }, { "refs": [{ "id": "ref-for-sandbox-storage-access-by-user-activation-flag\u2460" }], "title": "3.6. Sandboxing storage access" }], "url": "#sandbox-storage-access-by-user-activation-flag" },
                "set-storage-access": { "dfnID": "set-storage-access", "dfnText": "Set Storage Access", "external": false, "refSections": [], "url": "#set-storage-access" },
                "source-snapshot-params-environment-id": { "dfnID": "source-snapshot-params-environment-id", "dfnText": "environment id", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-source-snapshot-params-environment-id" }, { "id": "ref-for-source-snapshot-params-environment-id\u2460" }], "title": "3.3. Changes to navigation" }], "url": "#source-snapshot-params-environment-id" },
                "source-snapshot-params-has-storage-access": { "dfnID": "source-snapshot-params-has-storage-access", "dfnText": "has storage access", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-source-snapshot-params-has-storage-access" }, { "id": "ref-for-source-snapshot-params-has-storage-access\u2460" }, { "id": "ref-for-source-snapshot-params-has-storage-access\u2461" }], "title": "3.3. Changes to navigation" }], "url": "#source-snapshot-params-has-storage-access" },
                "storage-access-eligibility": { "dfnID": "storage-access-eligibility", "dfnText": "storage access eligibility", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-access-eligibility" }, { "id": "ref-for-storage-access-eligibility\u2460" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "#storage-access-eligibility" },
                "storage-access-eligibility-eligible": { "dfnID": "storage-access-eligibility-eligible", "dfnText": "eligible", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-access-eligibility-eligible" }], "title": "3.1. Changes to user agent state related to storage access" }], "url": "#storage-access-eligibility-eligible" },
                "storage-access-eligibility-ineligible": { "dfnID": "storage-access-eligibility-ineligible", "dfnText": "ineligible", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-access-eligibility-ineligible" }, { "id": "ref-for-storage-access-eligibility-ineligible\u2460" }, { "id": "ref-for-storage-access-eligibility-ineligible\u2461" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-storage-access-eligibility-ineligible\u2462" }], "title": "3.4.2. HTTP-redirect-fetch" }], "url": "#storage-access-eligibility-ineligible" },
                "storage-access-eligibility-unset": { "dfnID": "storage-access-eligibility-unset", "dfnText": "unset", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-storage-access-eligibility-unset" }, { "id": "ref-for-storage-access-eligibility-unset\u2460" }, { "id": "ref-for-storage-access-eligibility-unset\u2461" }], "title": "3.1. Changes to user agent state related to storage access" }, { "refs": [{ "id": "ref-for-storage-access-eligibility-unset\u2462" }], "title": "3.4.2. HTTP-redirect-fetch" }], "url": "#storage-access-eligibility-unset" },
                "third-party-context": { "dfnID": "third-party-context", "dfnText": "third party context", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-third-party-context" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-third-party-context\u2460" }, { "id": "ref-for-third-party-context\u2461" }], "title": "3.5.1. Cookies" }, { "refs": [{ "id": "ref-for-third-party-context\u2462" }, { "id": "ref-for-third-party-context\u2463" }, { "id": "ref-for-third-party-context\u2464" }, { "id": "ref-for-third-party-context\u2465" }], "title": "8.1. Set Storage Access" }], "url": "#third-party-context" },
                "unpartitioned-data": { "dfnID": "unpartitioned-data", "dfnText": "Unpartitioned data", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-unpartitioned-data" }, { "id": "ref-for-unpartitioned-data\u2460" }], "title": "3. The Storage Access API" }, { "refs": [{ "id": "ref-for-unpartitioned-data\u2461" }, { "id": "ref-for-unpartitioned-data\u2462" }, { "id": "ref-for-unpartitioned-data\u2463" }], "title": "6. Privacy considerations" }, { "refs": [{ "id": "ref-for-unpartitioned-data\u2464" }], "title": "7. Security considerations" }, { "refs": [{ "id": "ref-for-unpartitioned-data\u2465" }, { "id": "ref-for-unpartitioned-data\u2466" }, { "id": "ref-for-unpartitioned-data\u2467" }, { "id": "ref-for-unpartitioned-data\u2468" }], "title": "8.1. Set Storage Access" }], "url": "#unpartitioned-data" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#determine-the-effective-fedcm-connection-status": { "displayText": "determine the effective fedcm connection status", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "determine the effective fedcm connection status", "type": "dfn", "url": "#determine-the-effective-fedcm-connection-status" },
                "#determine-the-fedcm-site-connection-status": { "displayText": "determine the fedcm site connection status", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "determine the fedcm site connection status", "type": "dfn", "url": "#determine-the-fedcm-site-connection-status" },
                "#determine-the-initial-storage-access-eligibility": { "displayText": "determine the initial storage-access eligibility", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "determine the initial storage-access eligibility", "type": "dfn", "url": "#determine-the-initial-storage-access-eligibility" },
                "#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access": { "displayText": "determine whether the user agent explicitly allows unpartitioned cookie access", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "determine whether the user agent explicitly allows unpartitioned cookie access", "type": "dfn", "url": "#determine-whether-the-user-agent-explicitly-allows-unpartitioned-cookie-access" },
                "#dom-document-hasstorageaccess": { "displayText": "hasStorageAccess()", "export": true, "for_": ["Document"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "hasStorageAccess()", "type": "method", "url": "#dom-document-hasstorageaccess" },
                "#dom-document-requeststorageaccess": { "displayText": "requestStorageAccess()", "export": true, "for_": ["Document"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "requestStorageAccess()", "type": "method", "url": "#dom-document-requeststorageaccess" },
                "#environment-has-storage-access": { "displayText": "has storage access", "export": true, "for_": ["environment"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "has storage access", "type": "dfn", "url": "#environment-has-storage-access" },
                "#first-party-site-context": { "displayText": "first-party-site context", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "first-party-site context", "type": "dfn", "url": "#first-party-site-context" },
                "#permission-key-requester": { "displayText": "requester", "export": true, "for_": ["permission key"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "requester", "type": "dfn", "url": "#permission-key-requester" },
                "#permission-key-top-level": { "displayText": "top-level", "export": true, "for_": ["permission key"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "top-level", "type": "dfn", "url": "#permission-key-top-level" },
                "#permissiondef-storage-access": { "displayText": "storage-access", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "storage-access", "type": "permission", "url": "#permissiondef-storage-access" },
                "#request-eligible-for-storage-access": { "displayText": "eligible for storage-access", "export": true, "for_": ["request"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "eligible for storage-access", "type": "dfn", "url": "#request-eligible-for-storage-access" },
                "#sandbox-storage-access-by-user-activation-flag": { "displayText": "sandbox storage access by user activation flag", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "sandbox storage access by user activation flag", "type": "dfn", "url": "#sandbox-storage-access-by-user-activation-flag" },
                "#source-snapshot-params-environment-id": { "displayText": "environment id", "export": true, "for_": ["source snapshot params"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "environment id", "type": "dfn", "url": "#source-snapshot-params-environment-id" },
                "#source-snapshot-params-has-storage-access": { "displayText": "has storage access", "export": true, "for_": ["source snapshot params"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "has storage access", "type": "dfn", "url": "#source-snapshot-params-has-storage-access" },
                "#storage-access-eligibility": { "displayText": "storage access eligibility", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "storage access eligibility", "type": "dfn", "url": "#storage-access-eligibility" },
                "#storage-access-eligibility-eligible": { "displayText": "eligible", "export": true, "for_": ["storage access eligibility"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "eligible", "type": "dfn", "url": "#storage-access-eligibility-eligible" },
                "#storage-access-eligibility-ineligible": { "displayText": "ineligible", "export": true, "for_": ["storage access eligibility"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "ineligible", "type": "dfn", "url": "#storage-access-eligibility-ineligible" },
                "#storage-access-eligibility-unset": { "displayText": "unset", "export": true, "for_": ["storage access eligibility"], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "unset", "type": "dfn", "url": "#storage-access-eligibility-unset" },
                "#third-party-context": { "displayText": "third party context", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "third party context", "type": "dfn", "url": "#third-party-context" },
                "#unpartitioned-data": { "displayText": "unpartitioned data", "export": true, "for_": [], "level": "", "normative": true, "shortname": "storage-access", "spec": "storage-access", "status": "local", "text": "unpartitioned data", "type": "dfn", "url": "#unpartitioned-data" },
                "https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11#section-5.2.1": { "displayText": "site for cookies", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6265bis", "spec": "rfc6265bis", "status": "anchor-block", "text": "site for cookies", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11#section-5.2.1" },
                "https://dom.spec.whatwg.org/#concept-document-origin": { "displayText": "origin", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "origin", "type": "dfn", "url": "https://dom.spec.whatwg.org/#concept-document-origin" },
                "https://dom.spec.whatwg.org/#document": { "displayText": "Document", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "Document", "type": "interface", "url": "https://dom.spec.whatwg.org/#document" },
                "https://fetch.spec.whatwg.org/#concept-fetch": { "displayText": "fetch", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "fetch", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-fetch" },
                "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch": { "displayText": "http-network-or-cache fetch", "export": true, "for_": [], "level": "", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "anchor-block", "text": "http-network-or-cache fetch", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" },
                "https://fetch.spec.whatwg.org/#concept-http-redirect-fetch": { "displayText": "http-redirect fetch", "export": true, "for_": [], "level": "", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "anchor-block", "text": "http-redirect fetch", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-http-redirect-fetch" },
                "https://fetch.spec.whatwg.org/#concept-request": { "displayText": "request", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "request", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "https://fetch.spec.whatwg.org/#concept-request-client": { "displayText": "client", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "client", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "https://fetch.spec.whatwg.org/#concept-request-current-url": { "displayText": "current URL", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "current url", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-current-url" },
                "https://fetch.spec.whatwg.org/#concept-request-reserved-client": { "displayText": "reserved client", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "reserved client", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-reserved-client" },
                "https://fetch.spec.whatwg.org/#concept-request-url": { "displayText": "URL", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "url", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects": { "displayText": "has-cross-origin-redirects", "export": true, "for_": ["response"], "level": "", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "anchor-block", "text": "has-cross-origin-redirects", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects" },
                "https://html.spec.whatwg.org/multipage/#TODO": { "displayText": "ancestry", "export": true, "for_": ["environment"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "ancestry", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/#TODO" },
                "https://html.spec.whatwg.org/multipage/#environment": { "displayText": "environment", "export": true, "for_": [], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "environment", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/#environment" },
                "https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set": { "displayText": "active sandboxing flag set", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "active sandboxing flag set", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": { "displayText": "origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque": { "displayText": "opaque origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "opaque origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site": { "displayText": "same site", "export": true, "for_": ["site"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "same site", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" },
                "https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site": { "displayText": "obtain a site", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "obtain a site", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" },
                "https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive": { "displayText": "parse a sandboxing directive", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "parse a sandboxing directive", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive" },
                "https://html.spec.whatwg.org/multipage/browsers.html#same-origin": { "displayText": "same origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "same origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "https://html.spec.whatwg.org/multipage/browsers.html#same-site": { "displayText": "same site", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "same site", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-site" },
                "https://html.spec.whatwg.org/multipage/browsers.html#sandboxing-flag-set": { "displayText": "sandboxing flag set", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "sandboxing flag set", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#sandboxing-flag-set" },
                "https://html.spec.whatwg.org/multipage/browsers.html#site": { "displayText": "site", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "site", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#site" },
                "https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching": { "displayText": "create navigation params by fetching", "export": true, "for_": [], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "create navigation params by fetching", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching" },
                "https://html.spec.whatwg.org/multipage/browsing-the-web.html#snapshotting-source-snapshot-params": { "displayText": "snapshotting source snapshot params", "export": true, "for_": [], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "snapshotting source snapshot params", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#snapshotting-source-snapshot-params" },
                "https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params": { "displayText": "source snapshot params", "export": true, "for_": [], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "source snapshot params", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc": { "displayText": "browsing context", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "browsing context", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active": { "displayText": "fully active", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "fully active", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document": { "displayText": "active document", "export": true, "for_": ["navigable"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "active document", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" },
                "https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context": { "displayText": "top-level browsing context", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "top-level browsing context", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" },
                "https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy": { "displayText": "permissions policy", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "permissions policy", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy" },
                "https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie": { "displayText": "cookie", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "cookie", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" },
                "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use": { "displayText": "allowed to use", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "allowed to use", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" },
                "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element": { "displayText": "iframe", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "iframe", "type": "element", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" },
                "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": { "displayText": "in parallel", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "in parallel", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation": { "displayText": "consume user activation", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "consume user activation", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" },
                "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation": { "displayText": "transient activation", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "transient activation", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#set-up-a-window-environment-settings-object": { "displayText": "set up a window environment settings object", "export": true, "for_": [], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "set up a window environment settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#set-up-a-window-environment-settings-object" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": { "displayText": "Window", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "Window", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id": { "displayText": "id", "export": true, "for_": ["environment"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "id", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin": { "displayText": "top-level origin", "export": true, "for_": ["environment"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "top-level origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": { "displayText": "relevant global object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": { "displayText": "origin", "export": true, "for_": ["environment settings object"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source": { "displayText": "networking task source", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "networking task source", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": { "displayText": "queue a global task", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "queue a global task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": { "displayText": "relevant settings object", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context": { "displayText": "secure context", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "secure context", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" },
                "https://infra.spec.whatwg.org/#assert": { "displayText": "assert", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "assert", "type": "dfn", "url": "https://infra.spec.whatwg.org/#assert" },
                "https://infra.spec.whatwg.org/#boolean": { "displayText": "boolean", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "boolean", "type": "dfn", "url": "https://infra.spec.whatwg.org/#boolean" },
                "https://infra.spec.whatwg.org/#implementation-defined": { "displayText": "implementation-defined", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "implementation-defined", "type": "dfn", "url": "https://infra.spec.whatwg.org/#implementation-defined" },
                "https://infra.spec.whatwg.org/#list-iterate": { "displayText": "iterate", "export": true, "for_": ["list", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "iterate", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "https://infra.spec.whatwg.org/#string": { "displayText": "string", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "string", "type": "dfn", "url": "https://infra.spec.whatwg.org/#string" },
                "https://infra.spec.whatwg.org/#tuple": { "displayText": "tuple", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "tuple", "type": "dfn", "url": "https://infra.spec.whatwg.org/#tuple" },
                "https://infra.spec.whatwg.org/#user-agent": { "displayText": "user agent", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "user agent", "type": "dfn", "url": "https://infra.spec.whatwg.org/#user-agent" },
                "https://tools.ietf.org/html/rfc6265#section-5.3": { "displayText": "cookie store", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6265", "spec": "rfc6265", "status": "anchor-block", "text": "cookie store", "type": "dfn", "url": "https://tools.ietf.org/html/rfc6265#section-5.3" },
                "https://url.spec.whatwg.org/#concept-url-origin": { "displayText": "origin", "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "origin", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "https://url.spec.whatwg.org/#concept-url-parser": { "displayText": "URL parser", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "url parser", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-parser" },
                "https://w3c-fedid.github.io/FedCM/#browser-connected-accounts-set": { "displayText": "connected accounts set", "export": true, "for_": [], "level": "", "normative": true, "shortname": "fedcm", "spec": "fedcm", "status": "anchor-block", "text": "connected accounts set", "type": "dfn", "url": "https://w3c-fedid.github.io/FedCM/#browser-connected-accounts-set" },
                "https://w3c.github.io/permissions/#dfn-denied": { "displayText": "denied", "export": true, "for_": ["permission"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "denied", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-denied" },
                "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state": { "displayText": "getting the current permission state", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "getting the current permission state", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-getting-the-current-permission-state" },
                "https://w3c.github.io/permissions/#dfn-granted": { "displayText": "granted", "export": true, "for_": ["permission"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "granted", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-granted" },
                "https://w3c.github.io/permissions/#dfn-name": { "displayText": "name", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "name", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-name" },
                "https://w3c.github.io/permissions/#dfn-permission-key": { "displayText": "permission key", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission key", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-key" },
                "https://w3c.github.io/permissions/#dfn-permission-key-comparison-algorithm": { "displayText": "permission key comparison algorithm", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission key comparison algorithm", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-key-comparison-algorithm" },
                "https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm": { "displayText": "permission key generation algorithm", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission key generation algorithm", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm" },
                "https://w3c.github.io/permissions/#dfn-permission-key-type": { "displayText": "permission key type", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission key type", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-key-type" },
                "https://w3c.github.io/permissions/#dfn-permission-query-algorithm": { "displayText": "permission query algorithm", "export": true, "for_": ["powerful feature"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission query algorithm", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-query-algorithm" },
                "https://w3c.github.io/permissions/#dfn-permission-state": { "displayText": "permission state", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "permission state", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-permission-state" },
                "https://w3c.github.io/permissions/#dfn-powerful-feature": { "displayText": "powerful feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "powerful feature", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-powerful-feature" },
                "https://w3c.github.io/permissions/#dfn-prompt": { "displayText": "prompt", "export": true, "for_": ["permission"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "prompt", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-prompt" },
                "https://w3c.github.io/permissions/#dfn-request-permission-to-use": { "displayText": "requesting permission to use", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "requesting permission to use", "type": "dfn", "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use" },
                "https://w3c.github.io/permissions/#dom-permissiondescriptor": { "displayText": "PermissionDescriptor", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "PermissionDescriptor", "type": "dictionary", "url": "https://w3c.github.io/permissions/#dom-permissiondescriptor" },
                "https://w3c.github.io/permissions/#dom-permissionstatus": { "displayText": "PermissionStatus", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "PermissionStatus", "type": "interface", "url": "https://w3c.github.io/permissions/#dom-permissionstatus" },
                "https://w3c.github.io/permissions/#dom-permissionstatus-state": { "displayText": "state", "export": true, "for_": ["PermissionStatus"], "level": "1", "normative": true, "shortname": "permissions", "spec": "permissions", "status": "current", "text": "state", "type": "attribute", "url": "https://w3c.github.io/permissions/#dom-permissionstatus-state" },
                "https://w3c.github.io/webappsec-credential-management/#concept-credential-store": { "displayText": "credential store", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "credential-management", "spec": "credential-management-1", "status": "current", "text": "credential store", "type": "dfn", "url": "https://w3c.github.io/webappsec-credential-management/#concept-credential-store" },
                "https://w3c.github.io/webappsec-credential-management/#origin-prevent-silent-access-flag": { "displayText": "prevent silent access flag", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "credential-management", "spec": "credential-management-1", "status": "anchor-block", "text": "prevent silent access flag", "type": "dfn", "url": "https://w3c.github.io/webappsec-credential-management/#origin-prevent-silent-access-flag" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature": { "displayText": "policy-controlled feature", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "policy-controlled feature", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" },
                "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist": { "displayText": "default allowlist", "export": true, "for_": ["policy-controlled feature"], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "default allowlist", "type": "dfn", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" },
                "https://w3c.github.io/webappsec-permissions-policy/#should-request-be-allowed-to-use-feature": { "displayText": "Should request be allowed to use feature?", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "permissions-policy", "spec": "permissions-policy-1", "status": "current", "text": "Should request be allowed to use feature?", "type": "abstract-op", "url": "https://w3c.github.io/webappsec-permissions-policy/#should-request-be-allowed-to-use-feature" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context": { "displayText": "current browsing context", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "current browsing context", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-current-browsing-context" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error": { "displayText": "WebDriver error", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "webdriver error", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code": { "displayText": "WebDriver error code", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "webdriver error code", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-error-code" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-extension-commands": { "displayText": "extension command", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "extension command", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-extension-commands" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-getting-properties": { "displayText": "getting a property", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "getting a property", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-getting-properties" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-invalid-argument": { "displayText": "invalid argument", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "invalid argument", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-invalid-argument" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-remote-end-steps": { "displayText": "remote end steps", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "remote end steps", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-remote-end-steps" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-success": { "displayText": "success", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "success", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-success" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unknown-error": { "displayText": "unknown error", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "unknown error", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unknown-error" },
                "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unsupported-operation": { "displayText": "unsupported operation", "export": true, "for_": [], "level": "", "normative": true, "shortname": "webdriver", "spec": "webdriver", "status": "anchor-block", "text": "unsupported operation", "type": "dfn", "url": "https://w3c.github.io/webdriver/webdriver-spec.html#dfn-unsupported-operation" },
                "https://webidl.spec.whatwg.org/#a-new-promise": { "displayText": "a new promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "a new promise", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#a-new-promise" },
                "https://webidl.spec.whatwg.org/#idl-DOMException": { "displayText": "DOMException", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMException", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "https://webidl.spec.whatwg.org/#idl-boolean": { "displayText": "boolean", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "boolean", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "https://webidl.spec.whatwg.org/#idl-promise": { "displayText": "Promise", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Promise", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-promise" },
                "https://webidl.spec.whatwg.org/#idl-undefined": { "displayText": "undefined", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "undefined", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "https://webidl.spec.whatwg.org/#invalidstateerror": { "displayText": "InvalidStateError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "InvalidStateError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "https://webidl.spec.whatwg.org/#notallowederror": { "displayText": "NotAllowedError", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "NotAllowedError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#notallowederror" },
                "https://webidl.spec.whatwg.org/#reject": { "displayText": "reject", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "reject", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#reject" },
                "https://webidl.spec.whatwg.org/#resolve": { "displayText": "resolve", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "resolve", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#resolve" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const refHintKey = link.getAttribute("data-refhint-key");
                let key = url;
                if (refHintKey) {
                    key = refHintKey + "_" + url;
                }
                const ref = refsData[key];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>
    <script src="/dropdown.js"></script>