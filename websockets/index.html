<!doctype html>
<html lang="zh-hans">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="#3c790a" name="theme-color">
    <meta content="light dark" name="color-scheme">
    <title>WebSockets 标准</title>
    <link crossorigin href="https://resources.whatwg.org/standard-shared-with-dev.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/standard.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/spec.css" rel="stylesheet">
    <link crossorigin href="https://resources.whatwg.org/logo-websockets.svg" rel="icon">
    <script crossorigin defer src="https://resources.whatwg.org/commit-snapshot-shortcut-key.js"></script>
    <meta content="Bikeshed version 4416b18d5, updated Tue Jan 2 15:52:39 2024 -0800" name="generator">
    <meta content="7b748d313427d66108aa5c6906ef1c9a9219703d" name="revision">
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-mdn-anno */
        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
            --mdn-pass: green;
            --mdn-fail: red;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --mdn-bg: #222;
                --mdn-shadow: #444;
                --mdn-nosupport-text: #666;
                --mdn-pass: #690;
                --mdn-fail: #d22;
            }
        }

        .mdn-anno {
            background: var(--mdn-bg, #EEE);
            border-radius: .25em;
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            color: var(--text, black);
            font: 1em sans-serif;
            hyphens: none;
            max-width: min-content;
            overflow: hidden;
            padding: 0.2em;
            position: absolute;
            right: 0.3em;
            top: auto;
            white-space: nowrap;
            word-wrap: normal;
            z-index: 8;
        }

        .mdn-anno.unpositioned {
            display: none;
        }

        .mdn-anno.overlapping-main {
            opacity: .2;
            transition: opacity .1s;
        }

        .mdn-anno[open] {
            opacity: 1;
            z-index: 9;
            min-width: 9em;
        }

        .mdn-anno:hover {
            opacity: 1;
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>summary {
            font-weight: normal;
            text-align: right;
            cursor: pointer;
            display: block;
        }

        .mdn-anno>summary>.less-than-two-engines-flag {
            color: var(--mdn-fail);
            padding-right: 2px;
        }

        .mdn-anno>summary>.all-engines-flag {
            color: var(--mdn-pass);
            padding-right: 2px;
        }

        .mdn-anno>summary>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: var(--mdn-fail);
        }

        .mdn-anno>.feature>.all-engines-text {
            color: var(--mdn-pass);
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
        [data-algorithm] var {
            cursor: pointer;
        }

        var[data-var-color="0"] {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var[data-var-color="1"] {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var[data-var-color="2"] {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var[data-var-color="3"] {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var[data-var-color="4"] {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var[data-var-color="5"] {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var[data-var-color="6"] {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>

<body class="h-entry status-LS">
    <div class="head">
        <a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" crossorigin height="100"
                src="https://resources.whatwg.org/logo-websockets.svg"> </a>
        <hgroup>
            <h1 class="p-name no-ref" id="title">WebSockets</h1>
            <p id="subtitle">现行标准 — 最后更新于 <time class="dt-updated" datetime="2024-01-24">2024年1月24日</time> </p>
        </hgroup>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>参与:
                <dd><a href="https://github.com/whatwg/websockets">GitHub whatwg/websockets</a> (<a
                        href="https://github.com/whatwg/websockets/issues/new/choose">新问题</a>, <a
                        href="https://github.com/whatwg/websockets/issues">未解决问题</a>)
                <dd><a href="https://whatwg.org/chat">在 Matrix 上聊天</a>
                <dt>提交记录:
                <dd><a href="https://github.com/whatwg/websockets/commits">GitHub whatwg/websockets/commits</a>
                <dd><a href="/commit-snapshots/7b748d313427d66108aa5c6906ef1c9a9219703d/"
                        id="commit-snapshot-link">此提交的快照</a>
                <dd><a href="https://twitter.com/whatsockets">@whatsockets</a>
                <dt>测试:
                <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/websockets">web-platform-tests
                        websockets/</a> (<a
                        href="https://github.com/web-platform-tests/wpt/labels/websockets">正在进行的工作</a>)
                <dt>翻译 <small>（非规范性）</small>:
                <dd><span title="日语"><a href="https://triple-underscore.github.io/WebSocket-ja.html" hreflang="ja"
                            lang="ja" rel="alternate">日本語</a></span>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本规范提供了API，使得Web应用程序能够与服务器端进程保持双向通信。</p>
    </div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#network-intro"><span class="secno">1</span> <span class="content">介绍</span></a>
            <li>
                <a href="#websocket-protocol"><span class="secno">2</span> <span class="content">WebSocket
                        协议变更</span></a>
                <ol class="toc">
                    <li><a href="#websocket-connections"><span class="secno">2.1</span> <span
                                class="content">连接</span></a>
                    <li><a href="#websocket-opening-handshake"><span class="secno">2.2</span> <span
                                class="content">开启握手</span></a>
                </ol>
            <li>
                <a href="#the-websocket-interface"><span class="secno">3</span> <span class="content"><code
                            class="idl"><span>WebSocket</span></code> 接口</span></a>
                <ol class="toc">
                    <li><a href="#interface-definition"><span class="secno">3.1</span> <span
                                class="content">接口定义</span></a>
                </ol>
            <li><a href="#feedback-from-the-protocol"><span class="secno">4</span> <span
                        class="content">来自协议的反馈</span></a>
            <li><a href="#ping-and-pong-frames"><span class="secno">5</span> <span class="content">Ping 和 Pong
                        帧</span></a>
            <li><a href="#the-closeevent-interface"><span class="secno">6</span> <span class="content"><code
                            class="idl"><span>CloseEvent</span></code> 接口</span></a>
            <li><a href="#garbage-collection"><span class="secno">7</span> <span class="content">垃圾回收</span></a>
            <li><a href="#acks"><span class="secno"></span> <span class="content">致谢</span></a>
            <li><a href="#ipr"><span class="secno"></span> <span class="content">知识产权</span></a>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="network-intro"><span class="secno">1. </span><span
                class="content">介绍</span><a class="self-link" href="#network-intro"></a></h2>
        <div class="non-normative">
            <p><em>本节为非规范性内容。</em></p>
            <p>为了使Web应用程序能够与服务器端进程保持双向通信，本规范引入了<code
                    class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket">WebSocket</a></code>接口。
            </p>
            <p class="note" role="note">此接口不允许对底层网络进行原始访问。例如，不能使用此接口来实现一个IRC客户端，而不通过自定义服务器代理消息。</p>
        </div>

        <h2 class="heading settled" data-level="2" id="websocket-protocol"><span class="secno">2. </span><span
                class="content">WebSocket 协议变更</span><a class="self-link" href="#websocket-protocol"></a></h2>
        <div class="note" role="note">
            本节替换了 WebSocket 协议开启握手客户端要求的部分内容，以将其与 <cite>Fetch</cite> 中定义的算法集成在一起。这样，CSP、Cookie、HSTS 和其他
            <cite>Fetch</cite> 相关的协议将在一个地方处理。理想情况下，RFC 应该用这种语言进行更新，但这从来都不容易。下面定义的
            <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①">WebSocket</a></code> API
            使用了这种语言。<a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a> <a
                data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[FETCH]</a>
            <p>其工作原理是通过用一个与 <cite>Fetch</cite> 集成的新算法替换 WebSocket 协议的“建立 WebSocket 连接”算法。“建立 WebSocket
                连接”由三个算法组成：设置连接、创建并传输握手请求，以及验证握手响应。这种分层与 <cite>Fetch</cite>
                不同，后者首先创建握手，然后设置连接并传输握手，最后验证响应。在阅读这些更改时请牢记这一点。
            </p>
        </div>

        <h3 class="heading settled" data-level="2.1" id="websocket-connections"><span class="secno">2.1. </span><span
                class="content">连接</span><a class="self-link" href="#websocket-connections"></a></h3>
        <div class="algorithm" data-algorithm="obtain a WebSocket connection">
            <p>为了<dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="concept-websocket-connection-obtain">获取一个
                    WebSocket 连接</dfn>，给定一个
                <var>url</var>，执行以下步骤：
            </p>
            <ol>
                <li data-md>
                    <p>令<var>host</var>为<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host">host</a>。
                    </p>
                <li data-md>
                    <p>令<var>port</var>为<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-port" id="ref-for-concept-url-port">端口</a>。
                    </p>
                <li data-md>
                    <p>令<var>资源名称</var>为 U+002F (/)，后跟<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-path"
                            id="ref-for-concept-url-path">路径</a>中的字符串（包括空字符串，如果有的话），字符串之间用 U+002F (/) 分隔。</p>
                <li data-md>
                    <p>如果<var>url</var>的<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query"
                            id="ref-for-concept-url-query">查询</a>非空，将 U+003F (?) 和<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-query"
                            id="ref-for-concept-url-query①">查询</a>追加到<var>资源名称</var>中。
                    </p>
                <li data-md>
                    <p>令<var>secure</var>为 false，如果<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme">scheme</a>为 "<code>http</code>"；否则为 true。</p>
                <li data-md>
                    <p>按照 The WebSocket Protocol 的<a href="https://datatracker.ietf.org/doc/html/rfc6455#section-4.1">第
                            4.1 节</a>中第一个步骤集合中的第 2 至 5 步的要求，建立一个<a data-link-type="dfn"
                            href="#concept-websocket-connection-obtain"
                            id="ref-for-concept-websocket-connection-obtain">WebSocket 连接</a>，传递
                        <var>host</var>、<var>port</var>、<var>资源名称</var>和<var>secure</var>。<a data-link-type="biblio"
                            href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                    </p>
                <li data-md>
                    <p>如果建立了连接，则返回它，否则返回失败。</p>
            </ol>
            <p class="note" role="note">尽管结构略有不同，属性不同，因此不可共享，但 WebSocket 连接与“普通”<a data-link-type="dfn"
                    href="https://fetch.spec.whatwg.org/#concept-connection" id="ref-for-concept-connection">连接</a>非常接近。
            </p>
        </div>

        <h3 class="heading settled" data-level="2.2" id="websocket-opening-handshake"><span class="secno">2.2.
            </span><span class="content">开启握手</span><a class="self-link" href="#websocket-opening-handshake"></a></h3>
        <div class="algorithm" data-algorithm="establish a WebSocket connection">
            <p>为了<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-websocket-establish">建立
                    一个 WebSocket 连接</dfn>，给定一个<var>url</var>、<var>protocols</var>和<var>client</var>，执行以下步骤：</p>
            <ol>
                <li data-md>
                    <p>令<var>requestURL</var>为<var>url</var>的副本，如果<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme①">scheme</a>是"<code>ws</code>"，则将其<var>scheme</var>设置为"<code>http</code>"，否则设置为"<code>https</code>"。
                    </p>
                    <p class="note no-backref" role="note">这种 scheme 的更改对于与<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-fetch"
                            id="ref-for-concept-fetch">fetch</a>的良好集成至关重要。例如，没有它，HSTS 将无法工作。实际上，WebSocket 没有独特的 scheme
                        是没有实际理由的，这是一个遗留的产物。<a data-link-type="biblio" href="#biblio-hsts"
                            title="HTTP Strict Transport Security (HSTS)">[HSTS]</a> </p>
                <li data-md>
                    <p>令<var>request</var>为一个新的<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request"
                            id="ref-for-concept-request">请求</a>，其<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-url"
                            id="ref-for-concept-request-url">URL</a>为<var>requestURL</var>，<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-client"
                            id="ref-for-concept-request-client">客户端</a>为<var>client</var>，<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#request-service-workers-mode"
                            id="ref-for-request-service-workers-mode">service-workers 模式</a>为"<code>none</code>"，
                        <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer"
                            id="ref-for-concept-request-referrer">referrer</a>为"<code>no-referrer</code>"，<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode"
                            id="ref-for-concept-request-mode">模式</a>为"<code>websocket</code>"，<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode"
                            id="ref-for-concept-request-credentials-mode">凭据模式</a>为"<code>include</code>"，<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode"
                            id="ref-for-concept-request-cache-mode">缓存模式</a>为"<code>no-store</code>"，
                        并且<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode"
                            id="ref-for-concept-request-redirect-mode">重定向模式</a>为"<code>error</code>"。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append"
                            id="ref-for-concept-header-list-append">追加</a>(`<code>Upgrade</code>`，`<code>websocket</code>`)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list">header 列表</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append"
                            id="ref-for-concept-header-list-append①">追加</a>(`<code>Connection</code>`，`<code>Upgrade</code>`)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list①">header 列表</a>。</p>
                <li data-md>
                    <p>令<var>keyValue</var>为一个随机选择的 16 字节值的 nonce，已<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#forgiving-base64-encode"
                            id="ref-for-forgiving-base64-encode">宽容的 Base64 编码</a>并<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#isomorphic-encode"
                            id="ref-for-isomorphic-encode">同构编码</a>。
                    </p>
                    <p class="example" id="example-random-value"><a class="self-link"
                            href="#example-random-value"></a>如果随机选择的值是字节序列 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09
                        0x0a 0x0b 0x0c 0x0d 0x0e 0x0f 0x10，<var>keyValue</var>将被宽容的 Base64
                        编码为"<code>AQIDBAUGBwgJCgsMDQ4PEC==</code>"并同构编码为`<code>AQIDBAUGBwgJCgsMDQ4PEC==</code>`。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append"
                            id="ref-for-concept-header-list-append②">追加</a>(`<code>Sec-WebSocket-Key</code>`，<var>keyValue</var>)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list②">header 列表</a>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append"
                            id="ref-for-concept-header-list-append③">追加</a>(`<code>Sec-WebSocket-Version</code>`，`<code>13</code>`)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list③">header 列表</a>。</p>
                <li data-md>
                    <p>对于<var>protocols</var>中的每一个<var>protocol</var>，<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#concept-header-list-combine"
                            id="ref-for-concept-header-list-combine">合并</a>(`<code>Sec-WebSocket-Protocol</code>`，<var>protocol</var>)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list④">header 列表</a>。
                    </p>
                <li data-md>
                    <p>令<var>permessageDeflate</var>为用户代理定义的"<code>permessage-deflate</code>"扩展<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#header-value" id="ref-for-header-value">header 值</a>。<a
                            data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                    <p class="example" id="example-permessage-deflate"><a class="self-link"
                            href="#example-permessage-deflate"></a>`<code>permessage-deflate; client_max_window_bits</code>`
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append"
                            id="ref-for-concept-header-list-append④">追加</a>
                        (`<code>Sec-WebSocket-Extensions</code>`，<var>permessageDeflate</var>)到<var>request</var>的<a
                            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                            id="ref-for-concept-request-header-list⑤">header 列表</a>。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch"
                            id="ref-for-concept-fetch①">Fetch</a> <var>request</var>，并将<a data-link-type="dfn"
                            href="https://fetch.spec.whatwg.org/#fetch-useparallelqueue"
                            id="ref-for-fetch-useparallelqueue"><i>useParallelQueue</i></a>设置为 true，
                        并给予<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response"
                            id="ref-for-process-response"><i>processResponse</i></a>这些步骤，其中<var>response</var>为：</p>
                    <ol>
                        <li data-md>
                            <p>如果<var>response</var>是<a data-link-type="dfn"
                                    href="https://fetch.spec.whatwg.org/#concept-network-error"
                                    id="ref-for-concept-network-error">网络错误</a>或其<a data-link-type="dfn"
                                    href="https://fetch.spec.whatwg.org/#concept-response-status"
                                    id="ref-for-concept-response-status">状态</a>不是 101，<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7">WebSocket 连接失败</a>。</p>
                        <li data-md>
                            <p>如果<var>protocols</var>不是空列表，并且<a data-link-type="dfn"
                                    href="https://fetch.spec.whatwg.org/#extract-header-list-values"
                                    id="ref-for-extract-header-list-values">提取 header 列表值</a>时，给定
                                `<code>Sec-WebSocket-Protocol</code>` 和 <var>response</var>的<a data-link-type="dfn"
                                    href="https://fetch.spec.whatwg.org/#concept-request-header-list"
                                    id="ref-for-concept-request-header-list⑥">header 列表</a>结果为 null、失败或空字节序列，则<a
                                    data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7①">WebSocket 连接失败</a>。</p>
                            <p class="note" role="note">这与 The WebSocket Protocol 中定义的对该 header
                                的检查不同。后者仅涵盖客户端未请求的子协议。而本条款涵盖客户端请求但服务器未确认的子协议。</p>
                        <li data-md>
                            <p>按照 The WebSocket Protocol 中的<a
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-4.1">第 4.1
                                    节</a>中最后一个步骤集合中的第 2 至 6 步的要求，验证<var>response</var>。这将导致<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7②">WebSocket 连接失败</a>或<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">WebSocket
                                    连接已建立</a>。
                            </p>
                    </ol>
            </ol>
        </div>
        <p><a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                id="ref-for-section-7.1.7③">WebSocket 连接失败</a>和<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①">WebSocket
                连接已建立</a>由 The WebSocket Protocol 定义。<a data-link-type="biblio" href="#biblio-wsp"
                title="The WebSocket Protocol">[WSP]</a>
        </p>
        <p class="warning">不跟随重定向且此握手通常受限的原因是，因为在 Web 浏览器环境中可能引入严重的安全问题。例如，考虑一个在某一路径上有 WebSocket 服务器的 host，并且在另一路径上有开放的
            HTTP 重定向器。突然之间，任何可以给定特定 WebSocket URL 的脚本都可能被欺骗与互联网上的任何 host 通信（甚至可能共享机密信息），即使该脚本检查了 URL 是否具有正确的主机名。</p>

        <h2 class="heading settled" data-level="3" id="the-websocket-interface"><span class="secno">3. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②">WebSocket</a></code>
                接口</span><a class="self-link" href="#the-websocket-interface"></a></h2>
        <h3 class="heading settled" data-level="3.1" id="interface-definition"><span class="secno">3.1. </span><span
                class="content">接口定义</span><a class="self-link" href="#interface-definition"></a></h3>
        <p> <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket③">WebSocket</a></code> 类的
            Web IDL 定义如下所示：</p>

        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-binarytype"><code><c- g>BinaryType</c-></code></dfn> { <a class="idl-code" data-link-type="enum-value" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob"><c- s>"blob"</c-></a>, <a class="idl-code" data-link-type="enum-value" href="#dom-binarytype-arraybuffer" id="ref-for-dom-binarytype-arraybuffer"><c- s>"arraybuffer"</c-></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="websocket"><code><c- g>WebSocket</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-websocket-websocket" id="ref-for-dom-websocket-websocket"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket/WebSocket(url, protocols), WebSocket/constructor(url, protocols), WebSocket/WebSocket(url), WebSocket/constructor(url)" data-dfn-type="argument" data-export id="dom-websocket-websocket-url-protocols-url"><code><c- g>url</c-></code></dfn>, <c- b>optional</c-> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a>>) <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket/WebSocket(url, protocols), WebSocket/constructor(url, protocols), WebSocket/WebSocket(url), WebSocket/constructor(url)" data-dfn-type="argument" data-export id="dom-websocket-websocket-url-protocols-protocols"><code><c- g>protocols</c-></code></dfn> = []);
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-websocket-url" id="ref-for-dom-websocket-url"><c- g>url</c-></a>;

  // ready state
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-connecting" id="ref-for-dom-websocket-connecting"><c- g>CONNECTING</c-></a> = 0;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short①"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-open" id="ref-for-dom-websocket-open"><c- g>OPEN</c-></a> = 1;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short②"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing"><c- g>CLOSING</c-></a> = 2;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short③"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-closed" id="ref-for-dom-websocket-closed"><c- g>CLOSED</c-></a> = 3;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short④"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate"><c- g>readyState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned long long" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount"><c- g>bufferedAmount</c-></a>;

  // networking
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onopen" id="ref-for-dom-websocket-onopen"><c- g>onopen</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onerror" id="ref-for-dom-websocket-onerror"><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onclose" id="ref-for-dom-websocket-onclose"><c- g>onclose</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions"><c- g>extensions</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol"><c- g>protocol</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-close" id="ref-for-dom-websocket-close"><c- g>close</c-></a>(<c- b>optional</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Clamp" id="ref-for-Clamp"><c- g>Clamp</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑤"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket/close(code, reason), WebSocket/close(code), WebSocket/close()" data-dfn-type="argument" data-export id="dom-websocket-close-code-reason-code"><code><c- g>code</c-></code></dfn>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket/close(code, reason), WebSocket/close(code), WebSocket/close()" data-dfn-type="argument" data-export id="dom-websocket-close-code-reason-reason"><code><c- g>reason</c-></code></dfn>);

  // messaging
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onmessage" id="ref-for-dom-websocket-onmessage"><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-binarytype" id="ref-for-enumdef-binarytype"><c- n>BinaryType</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BinaryType" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype"><c- g>binaryType</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-send" id="ref-for-dom-websocket-send"><c- g>send</c-></a>((<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource"><c- n>BufferSource</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob"><c- n>Blob</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket/send(data)" data-dfn-type="argument" data-export id="dom-websocket-send-data-data"><code><c- g>data</c-></code></dfn>);
};
</pre>
        <p>每个<code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket④">WebSocket</a></code>
            对象都有一个关联的<dfn class="dfn-paneled" data-dfn-for="WebSocket" data-dfn-type="dfn" data-lt="internal-url"
                data-noexport id="websocket-internal-url">url</dfn>，
            它是一个<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL
                记录</a>。</p>
        <p>每个<code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑤">WebSocket</a></code>
            对象都有一个关联的<dfn class="dfn-paneled" data-dfn-for="WebSocket" data-dfn-type="dfn" data-noexport
                id="websocket-binary-type">binary type</dfn>，
            它是一个<code
                class="idl"><a data-link-type="idl" href="#enumdef-binarytype" id="ref-for-enumdef-binarytype①">BinaryType</a></code>。它的初始值必须为"<code
                class="idl"><a data-link-type="idl" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob①">blob</a></code>"。
        </p>
        <p>每个<code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑥">WebSocket</a></code>
            对象都有一个关联的<dfn class="dfn-paneled" data-dfn-for="WebSocket" data-dfn-type="dfn" data-noexport
                id="websocket-ready-state">ready state</dfn>，它是表示连接状态的数字。初始状态必须为<code
                class="idl"><a data-link-type="idl" href="#dom-websocket-connecting" id="ref-for-dom-websocket-connecting①">CONNECTING</a></code>
            (0)。
            它可以具有以下值：</p>
        <dl>
            <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export
                    id="dom-websocket-connecting"><code>CONNECTING</code></dfn> (数值 0)
            <dd data-md>
                <p>连接尚未建立。</p>
            <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export
                    id="dom-websocket-open"><code>OPEN</code></dfn> (数值 1)
            <dd data-md>
                <p><a data-link-type="dfn"
                        href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                        id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and②">WebSocket
                        连接已建立</a>并且可以进行通信。</p>
            <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export
                    id="dom-websocket-closing"><code>CLOSING</code></dfn> (数值 2)
            <dd data-md>
                <p>连接正在进行关闭握手，或已调用<code
                        class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close①">close()</a></code>方法。
                </p>
            <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export
                    id="dom-websocket-closed"><code>CLOSED</code></dfn> (数值 3)
            <dd data-md>
                <p>连接已关闭或无法打开。</p>
        </dl>
        <dl class="domintro non-normative">
            <dt data-md>
                <code><var>socket</var> = new <code class="idl"><a data-link-type="idl" href="#dom-websocket-websocket" id="ref-for-dom-websocket-websocket①">WebSocket</a></code>(<var>url</var>
                [, <var>protocols</var> ])</code>
            <dd data-md>
                <p>创建一个新的<code
                        class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑦">WebSocket</a></code>
                    对象，并立即建立关联的 WebSocket 连接。</p>
                <p><var>url</var> 是一个字符串，指定建立连接的<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                        id="ref-for-concept-url①">URL</a>。
                    仅允许 "<code>ws</code>"、"<code>wss</code>"、"<code>http</code>" 和 "<code>https</code>" scheme；其他 scheme
                    将导致
                    "<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror">SyntaxError</a></code>"
                    <code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>。
                    带有<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment"
                        id="ref-for-concept-url-fragment">片段</a>的 URL 总会导致此类异常。
                </p>
                <p><var>protocols</var> 是一个字符串或字符串数组。如果它是一个字符串，则相当于仅包含该字符串的数组；如果省略，则相当于空数组。
                    数组中的每个字符串都是一个子协议名称。仅当服务器报告已选择这些子协议之一时，连接才会建立。子协议名称必须符合 The WebSocket protocol 中定义的 `<a
                        data-link-type="http-header" href="https://datatracker.ietf.org/doc/html/rfc6455#section-11.3.4"
                        id="ref-for-section-11.3.4"><code>Sec-WebSocket-Protocol</code></a>` 字段的值组成元素的要求。<a
                        data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="method" href="#dom-websocket-send" id="ref-for-dom-websocket-send①">send</a>(<var>data</var>)</code>
            <dd data-md>
                <p>使用 WebSocket 连接传输<var>data</var>。<var>data</var>可以是一个字符串，一个<code
                        class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob①">Blob</a></code>，
                    一个<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer">ArrayBuffer</a></code>，
                    或一个<code
                        class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#ArrayBufferView" id="ref-for-ArrayBufferView">ArrayBufferView</a></code>。
                </p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="method" href="#dom-websocket-close" id="ref-for-dom-websocket-close②">close</a>([ <var>code</var> ] [, <var>reason</var> ])</code>
            <dd data-md>
                <p>关闭 WebSocket 连接，可选地使用<var>code</var>作为<a data-link-type="dfn"
                        href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5"
                        id="ref-for-section-7.1.5">WebSocket 连接关闭代码</a>和<var>reason</var>作为<a data-link-type="dfn"
                        href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6"
                        id="ref-for-section-7.1.6">WebSocket 连接关闭原因</a>。</p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-url" id="ref-for-dom-websocket-url①">url</a></code>
            <dd data-md>
                <p>返回用于建立 WebSocket 连接的<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                        id="ref-for-concept-url②">URL</a>。</p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①">readyState</a></code>
            <dd data-md>
                <p>返回 WebSocket 连接的状态。它可以具有上述值。</p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount①">bufferedAmount</a></code>
            <dd data-md>
                <p>返回已通过<code
                        class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send②">send()</a></code>排队但尚未传输到网络的应用程序数据（UTF-8
                    文本和二进制数据）的字节数。</p>
                <p>如果 WebSocket 连接已关闭，此属性的值将仅在每次调用<code
                        class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send③">send()</a></code>方法时增加。（连接关闭后，该数字不会重置为零。）
                </p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions①">extensions</a></code>
            <dd data-md>
                <p>返回服务器选择的扩展（如果有）。</p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol①">protocol</a></code>
            <dd data-md>
                <p>返回服务器选择的子协议（如果有）。它可以与构造函数第二个参数的数组形式一起使用，以执行子协议协商。</p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype①">binaryType</a></code>
            <dd data-md>
                <p>返回一个字符串，指示从<var>socket</var>中获取的二进制数据如何暴露给脚本：</p>
                <dl>
                    <dt data-md>"<code
                            class="idl"><a data-link-type="idl" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob②">blob</a></code>"
                    <dd data-md>
                        <p>二进制数据以<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob②">Blob</a></code>形式返回。
                        </p>
                    <dt data-md>"<code
                            class="idl"><a data-link-type="idl" href="#dom-binarytype-arraybuffer" id="ref-for-dom-binarytype-arraybuffer①">arraybuffer</a></code>"
                    <dd data-md>
                        <p>二进制数据以<code
                                class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer①">ArrayBuffer</a></code>形式返回。
                        </p>
                </dl>
                <p>默认值为"<code
                        class="idl"><a data-link-type="idl" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob③">blob</a></code>"。
                </p>
            <dt data-md>
                <code><var>socket</var>.<a class="idl-code" data-link-type="attribute" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype②">binaryType</a> = <var>value</var></code>
            <dd data-md>
                <p>更改二进制数据的返回方式。</p>
        </dl>
        <div class="algorithm" data-algorithm="WebSocket(url, protocols)" data-algorithm-for="WebSocket">
            <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="constructor" data-export
                data-lt="WebSocket(url, protocols)|constructor(url, protocols)|WebSocket(url)|constructor(url)"
                id="dom-websocket-websocket"><code>new WebSocket(<var>url</var>, <var>protocols</var>)</code></dfn>构造函数步骤如下：
            <ol>
                <li data-md>
                    <p>令<var>baseURL</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this">this</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object">相关设置对象</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url"
                            id="ref-for-api-base-url">API 基础 URL</a>。</p>
                <li data-md>
                    <p>令<var>urlRecord</var>为通过将<var>url</var>与<var>baseURL</var>一起应用<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL
                            解析器</a>后的结果。</p>
                <li data-md>
                    <p>如果<var>urlRecord</var>失败，则抛出"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror①">SyntaxError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果<var>urlRecord</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme③">scheme</a>是"<code>http</code>"，则将<var>urlRecord</var>的<a
                            data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme④">scheme</a>设置为"<code>ws</code>"。
                    </p>
                <li data-md>
                    <p>否则，如果<var>urlRecord</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme⑤">scheme</a>是"<code>https</code>"，则将<var>urlRecord</var>的<a
                            data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme⑥">scheme</a>设置为"<code>wss</code>"。
                    </p>
                <li data-md>
                    <p>如果<var>urlRecord</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme"
                            id="ref-for-concept-url-scheme⑦">scheme</a>不是"<code><a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.1" id="ref-for-section-11.1.1">ws</a></code>"
                        或"<code><a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.2" id="ref-for-section-11.1.2">wss</a></code>"，
                        则抛出"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror②">SyntaxError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果<var>urlRecord</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-fragment"
                            id="ref-for-concept-url-fragment①">片段</a>不为 null，则抛出"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror③">SyntaxError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果<var>protocols</var>是一个字符串，则将<var>protocols</var>设置为仅包含该字符串的序列。</p>
                <li data-md>
                    <p>如果<var>protocols</var>中的任何值出现多次或以其他方式不符合 The WebSocket protocol 中定义的 `<a
                            data-link-type="http-header"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#section-11.3.4"
                            id="ref-for-section-11.3.4①"><code>Sec-WebSocket-Protocol</code></a>` 字段的值组成元素的要求，
                        则抛出"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror④">SyntaxError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>。
                        <a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                    </p>
                <li data-md>
                    <p>将<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①">this</a>的<a data-link-type="dfn" href="#websocket-internal-url"
                            id="ref-for-websocket-internal-url">url</a>设置为<var>urlRecord</var>。</p>
                <li data-md>
                    <p>令<var>client</var>为<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this②">this</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object①">相关设置对象</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                            id="ref-for-in-parallel">并行</a>执行以下步骤：</p>
                    <ol>
                        <li data-md>
                            <p>给定<var>urlRecord</var>、<var>protocols</var>和<var>client</var>，<a data-link-type="dfn"
                                    href="#concept-websocket-establish" id="ref-for-concept-websocket-establish">建立
                                    WebSocket 连接</a>。<a data-link-type="biblio" href="#biblio-fetch"
                                    title="Fetch Standard">[FETCH]</a>
                            </p>
                            <p class="note" role="note">如果<a data-link-type="dfn" href="#concept-websocket-establish"
                                    id="ref-for-concept-websocket-establish①">建立 WebSocket 连接</a>算法失败，它会触发<a
                                    data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7④">WebSocket 连接失败</a>算法，
                                然后调用<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1">关闭 WebSocket 连接</a>算法，
                                然后确定<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4"
                                    id="ref-for-section-7.1.4">WebSocket 连接已关闭</a>，
                                并会触发<code
                                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close">close</a></code>事件，<a
                                    href="#closeWebSocket">如下所述</a>。
                            </p>
                    </ol>
            </ol>
        </div>

        <hr>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-url"><code>url</code></dfn>的 getter 步骤是返回<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>的<a data-link-type="dfn"
                href="#websocket-internal-url" id="ref-for-websocket-internal-url①">url</a>，并<a data-link-type="dfn"
                href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer">序列化</a>。
        </p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-readystate"><code>readyState</code></dfn>的 getter 步骤是返回<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>的<a data-link-type="dfn"
                href="#websocket-ready-state" id="ref-for-websocket-ready-state">ready state</a>。
        </p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-extensions"><code>extensions</code></dfn>属性最初必须返回空字符串。在<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and③">WebSocket
                连接建立</a>后，其值可能会发生变化，如下所述。</p>
        <p></p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-protocol"><code>protocol</code></dfn>属性最初必须返回空字符串。在<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and④">WebSocket
                连接建立</a>后，其值可能会发生变化，如下所述。</p>
        <div class="algorithm" data-algorithm="close(code, reason)" data-algorithm-for="WebSocket">
            <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="method" data-export
                data-lt="close(code, reason)|close(code)|close()"
                id="dom-websocket-close"><code>close(<var>code</var>, <var>reason</var>)</code></dfn>方法的步骤如下：
            <ol>
                <li data-md>
                    <p>如果<var>code</var>存在，但既不是等于 1000 的整数也不是在 3000 到 4999 之间（含）的整数，则抛出一个"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror">InvalidAccessError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>如果<var>reason</var>存在，则执行以下子步骤：</p>
                    <ol>
                        <li data-md>
                            <p>令<var>reasonBytes</var>为<a data-link-type="dfn"
                                    href="https://encoding.spec.whatwg.org/#utf-8-encode"
                                    id="ref-for-utf-8-encode">编码</a><var>reason</var>的结果。</p>
                        <li data-md>
                            <p>如果<var>reasonBytes</var>超过 123 字节，则抛出一个"<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror⑤">SyntaxError</a></code>"
                                <code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>。
                            </p>
                    </ol>
                <li data-md>
                    <p>从以下列表中运行第一个匹配步骤：</p>
                    <dl class="switch">
                        <dt data-md>如果<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                                id="ref-for-this⑤">this</a>的<a data-link-type="dfn" href="#websocket-ready-state"
                                id="ref-for-websocket-ready-state①">ready state</a>是<code
                                class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing①">CLOSING</a></code>
                            (2) 或<code
                                class="idl"><a data-link-type="idl" href="#dom-websocket-closed" id="ref-for-dom-websocket-closed①">CLOSED</a></code>
                            (3)
                        <dd data-md>
                            <p>什么也不做。</p>
                            <p class="note" role="note">连接已经在关闭中或已经关闭。如果尚未关闭，则最终会触发<code
                                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close①">close</a></code>事件，<a
                                    href="#closeWebSocket">如下所述</a>。</p>
                        <dt data-md>如果 WebSocket 连接尚未<a data-link-type="dfn"
                                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and⑤">建立</a>
                            <a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                        <dd data-md>
                            <p><a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7⑤">WebSocket 连接失败</a>并将<a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>的<a
                                    data-link-type="dfn" href="#websocket-ready-state"
                                    id="ref-for-websocket-ready-state②">ready state</a>设置为<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing②">CLOSING</a></code>
                                (2)。<a data-link-type="biblio" href="#biblio-wsp"
                                    title="The WebSocket Protocol">[WSP]</a></p>
                            <p class="note" role="note"><a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                                    id="ref-for-section-7.1.7⑥">WebSocket 连接失败</a>算法调用<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1①">关闭 WebSocket 连接</a>算法，
                                然后确定<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4"
                                    id="ref-for-section-7.1.4①">WebSocket 连接已关闭</a>，
                                这会触发<code
                                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close②">close</a></code>事件，<a
                                    href="#closeWebSocket">如下所述</a>。
                            </p>
                        <dt data-md>如果 WebSocket 关闭握手尚未<a data-link-type="dfn"
                                href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                id="ref-for-section-7.1.3">开始</a><a data-link-type="biblio" href="#biblio-wsp"
                                title="The WebSocket Protocol">[WSP]</a>
                        <dd data-md>
                            <p><a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2"
                                    id="ref-for-section-7.1.2">启动 WebSocket 关闭握手</a>并将<a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>的<a
                                    data-link-type="dfn" href="#websocket-ready-state"
                                    id="ref-for-websocket-ready-state③">ready state</a>设置为<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing③">CLOSING</a></code>
                                (2)。<a data-link-type="biblio" href="#biblio-wsp"
                                    title="The WebSocket Protocol">[WSP]</a></p>
                            <p>如果<var>code</var>和<var>reason</var>都不存在，WebSocket Close 消息必须没有正文。</p>
                            <p class="note" role="note">The WebSocket Protocol 错误地指出状态码是<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2"
                                    id="ref-for-section-7.1.2①">启动 WebSocket 关闭握手</a>算法的<span
                                    class="allow-2119">必需</span>项。</p>
                            <p>如果<var>code</var>存在，则在 WebSocket Close 消息中使用的状态码必须是<var>code</var>给出的整数。<a
                                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                            </p>
                            <p>如果<var>reason</var>也存在，则<var>reasonBytes</var>必须在 Close 消息中的状态码之后提供。<a
                                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                            </p>
                            <p class="note" role="note"><a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2"
                                    id="ref-for-section-7.1.2②">启动 WebSocket 关闭握手</a>算法最终会调用<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1②">关闭 WebSocket 连接</a>算法，
                                然后确定<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4"
                                    id="ref-for-section-7.1.4②">WebSocket 连接已关闭</a>，
                                这会触发<code
                                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close③">close</a></code>事件，<a
                                    href="#closeWebSocket">如下所述</a>。 </p>
                        <dt data-md>否则
                        <dd data-md>
                            <p>将<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                                    id="ref-for-this⑧">this</a>的<a data-link-type="dfn" href="#websocket-ready-state"
                                    id="ref-for-websocket-ready-state④">ready state</a>设置为<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing④">CLOSING</a></code>
                                (2)。</p>
                            <p class="note" role="note"><a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                    id="ref-for-section-7.1.3①">WebSocket 关闭握手已开始</a>，最终会调用<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1③">关闭 WebSocket 连接</a>算法，
                                然后确定<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4"
                                    id="ref-for-section-7.1.4③">WebSocket 连接已关闭</a>，
                                从而会触发<code
                                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close④">close</a></code>事件，<a
                                    href="#closeWebSocket">如下所述</a>。</p>
                    </dl>
            </ol>
        </div>
        <p class="note" role="note"><code
                class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close③">close()</a></code>
            方法在启动 WebSocket 关闭握手之前不会丢弃之前发送的消息——即使在实际操作中，用户代理仍在忙于发送这些消息，握手也只会在消息发送后开始。</p>
        <hr>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-bufferedamount"><code>bufferedAmount</code></dfn>的 getter 步骤是返回使用<code
                class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send④">send()</a></code>排队的应用程序数据（UTF-8
            文本和二进制数据）的字节数，
            但截至<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop">事件循环</a>上次达到<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" id="ref-for-step1">步骤 1</a>时，
            这些数据尚未传输到网络。（因此这包括在当前任务执行期间发送的任何文本，无论用户代理是否能够在脚本执行期间<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"
                id="ref-for-in-parallel①">并行</a>传输文本。）这不包括协议产生的帧开销，或操作系统或网络硬件的缓冲。</p>
        <div class="example" id="buffered-amount-example">
            <a class="self-link" href="#buffered-amount-example"></a>
            <p>在这个简单的示例中，<code
                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount②">bufferedAmount</a></code>
                属性用于确保更新发送的频率为每 50 毫秒一次，或者在网络能够处理此频率时，按网络能够处理的速度发送更新。</p>
            <pre class="highlight"><c- a>var</c-> socket <c- o>=</c-> <c- ow>new</c-> WebSocket<c- p>(</c-><c- t>'ws://game.example.com:12010/updates'</c-><c- p>);</c->
socket<c- p>.</c->onopen <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
  setInterval<c- p>(</c-><c- a>function</c-><c- p>()</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->socket<c- p>.</c->bufferedAmount <c- o>==</c-> <c- mf>0</c-><c- p>)</c->
      socket<c- p>.</c->send<c- p>(</c->getUpdateData<c- p>());</c->
  <c- p>},</c-> <c- mf>50</c-><c- p>);</c->
<c- p>};</c->
</pre>
            <p><code
                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount③">bufferedAmount</a></code>
                属性还可以用于饱和网络，而不会以高于网络能处理的速度发送数据，尽管这需要更仔细地监控属性随时间的变化。</p>
        </div>
        <hr>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                id="dom-websocket-binarytype"><code>binaryType</code></dfn>的 getter 步骤是返回<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>的<a data-link-type="dfn"
                href="#websocket-binary-type" id="ref-for-websocket-binary-type">binary type</a>。
        </p>
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype③">binaryType</a></code>
            的 setter 步骤是将<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                id="ref-for-this①⓪">this</a>的<a data-link-type="dfn" href="#websocket-binary-type"
                id="ref-for-websocket-binary-type①">binary type</a>设置为<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#the-given-value" id="ref-for-the-given-value">给定值</a>。
        </p>
        <p class="note" role="note">用户代理可以将<a data-link-type="dfn" href="#websocket-binary-type"
                id="ref-for-websocket-binary-type②">binary type</a>用作处理传入二进制数据的提示：如果它是"<code
                class="idl"><a data-link-type="idl" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob④">blob</a></code>"，
            则可以安全地将其传输到磁盘；如果它是"<code
                class="idl"><a data-link-type="idl" href="#dom-binarytype-arraybuffer" id="ref-for-dom-binarytype-arraybuffer②">arraybuffer</a></code>"，
            则将数据保存在内存中可能更有效率。当然，鼓励用户代理使用更细微的启发式方法来决定是否将传入的数据保存在内存中，例如基于数据的大小或脚本在最后一刻更改属性的频率。这一点尤其重要，因为在用户代理接收到数据之后但在用户代理触发事件之前更改属性是完全可能的。
        </p>
        <div class="algorithm" data-algorithm="send(data)" data-algorithm-for="WebSocket">
            <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="method" data-export
                id="dom-websocket-send"><code>send(<var>data</var>)</code></dfn>方法的步骤如下：
            <ol>
                <li data-md>
                    <p>如果<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①①">this</a>的<a data-link-type="dfn" href="#websocket-ready-state"
                            id="ref-for-websocket-ready-state⑤">ready state</a>是<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-connecting" id="ref-for-dom-websocket-connecting②">CONNECTING</a></code>，
                        则抛出一个
                        "<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>。
                    </p>
                <li data-md>
                    <p>从以下列表中运行适当的步骤集：</p>
                    <dl>
                        <dt data-md>如果<var>data</var>是字符串
                        <dd data-md>
                            <p>如果<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and⑥">WebSocket
                                    连接已建立</a>并且<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                    id="ref-for-section-7.1.3②">WebSocket 关闭握手尚未开始</a>，
                                则用户代理必须<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_"
                                    id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_">发送由<var>data</var>参数组成的
                                    WebSocket 消息</a>，使用文本帧操作码；
                                如果无法发送数据，例如因为它需要缓冲但缓冲区已满，则用户代理必须<a data-link-type="dfn" href="#flagged-as-full"
                                    id="ref-for-flagged-as-full">将 WebSocket 标记为已满</a>，然后<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1④">关闭 WebSocket 连接</a>。任何以字符串参数调用此方法且未抛出异常的操作都必须增加<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount④">bufferedAmount</a></code>属性，
                                增加的数量为将参数表达为 UTF-8 所需的字节数。<a data-link-type="biblio" href="#biblio-unicode"
                                    title="The Unicode Standard">[UNICODE]</a> <a data-link-type="biblio"
                                    href="#biblio-encoding" title="Encoding Standard">[ENCODING]</a> <a
                                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                            </p>
                        <dt data-md>如果<var>data</var>是<code
                                class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob③">Blob</a></code>对象
                        <dd data-md>
                            <p>如果<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and⑦">WebSocket
                                    连接已建立</a>，并且<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                    id="ref-for-section-7.1.3③">WebSocket 关闭握手尚未开始</a>，
                                则用户代理必须<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_"
                                    id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_①">发送由<var>data</var>组成的
                                    WebSocket 消息</a>，使用二进制帧操作码；
                                如果无法发送数据，例如因为它需要缓冲但缓冲区已满，则用户代理必须<a data-link-type="dfn" href="#flagged-as-full"
                                    id="ref-for-flagged-as-full①">将 WebSocket 标记为已满</a>，然后<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1⑤">关闭 WebSocket 连接</a>。要发送的数据是<code
                                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob④">Blob</a></code>对象表示的原始数据。
                                任何以<code
                                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑤">Blob</a></code>参数调用此方法且未抛出异常的操作都必须
                                按照<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑤">bufferedAmount</a></code>属性增加<code
                                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑥">Blob</a></code>对象的原始数据大小，以字节为单位。<a
                                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                                <a data-link-type="biblio" href="#biblio-fileapi" title="File API">[FILEAPI]</a>
                            </p>
                        <dt data-md>如果<var>data</var>是<code
                                class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer②">ArrayBuffer</a></code>
                        <dd data-md>
                            <p>如果<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and⑧">WebSocket
                                    连接已建立</a>，并且<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                    id="ref-for-section-7.1.3④">WebSocket 关闭握手尚未开始</a>，
                                则用户代理必须<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_"
                                    id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_②">发送由<var>data</var>组成的
                                    WebSocket 消息</a>，使用二进制帧操作码；
                                如果无法发送数据，例如因为它需要缓冲但缓冲区已满，则用户代理必须<a data-link-type="dfn" href="#flagged-as-full"
                                    id="ref-for-flagged-as-full②">将 WebSocket 标记为已满</a>，然后<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1⑥">关闭 WebSocket 连接</a>。要发送的数据是缓冲区中<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer③">ArrayBuffer</a></code>对象描述的数据。
                                任何以<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer④">ArrayBuffer</a></code>参数调用此方法且未抛出异常的操作都必须
                                按照<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑥">bufferedAmount</a></code>属性增加<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑤">ArrayBuffer</a></code>的长度（以字节为单位）。<a
                                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                            </p>
                        <dt data-md>如果<var>data</var>是<code
                                class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#ArrayBufferView" id="ref-for-ArrayBufferView①">ArrayBufferView</a></code>
                        <dd data-md>
                            <p>如果<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and⑨">WebSocket
                                    连接已建立</a>，并且<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                                    id="ref-for-section-7.1.3⑤">WebSocket 关闭握手尚未开始</a>，
                                则用户代理必须<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_"
                                    id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_③">发送由<var>data</var>组成的
                                    WebSocket 消息</a>，使用二进制帧操作码；
                                如果无法发送数据，例如因为它需要缓冲但缓冲区已满，则用户代理必须<a data-link-type="dfn" href="#flagged-as-full"
                                    id="ref-for-flagged-as-full③">将 WebSocket 标记为已满</a>，然后<a data-link-type="dfn"
                                    href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1"
                                    id="ref-for-section-7.1.1⑦">关闭 WebSocket 连接</a>。要发送的数据是<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑥">ArrayBuffer</a></code>对象中<var>data</var>引用的缓冲区部分的数据。
                                任何以此类参数调用此方法且未抛出异常的操作都必须按照<code
                                    class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑦">bufferedAmount</a></code>属性
                                按照<var>data</var>缓冲区的长度（以字节为单位）增加该属性的值。<a data-link-type="biblio" href="#biblio-wsp"
                                    title="The WebSocket Protocol">[WSP]</a>
                            </p>
                    </dl>
            </ol>
        </div>

        <hr>
        <p>以下是所有实现<code
                class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑧">WebSocket</a></code>接口的对象必须支持的<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers"
                id="ref-for-event-handlers">事件处理程序</a>（及其对应的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type"
                id="ref-for-event-handler-event-type">事件处理程序事件类型</a>），作为<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"
                id="ref-for-event-handler-idl-attributes">事件处理程序 IDL 属性</a>：</p>
        <table>
            <thead>
                <tr>
                    <th><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers"
                            id="ref-for-event-handlers①">事件处理程序</a>
                    <th><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type"
                            id="ref-for-event-handler-event-type①">事件处理程序事件类型</a>
            <tbody>
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                            id="dom-websocket-onopen"><code>onopen</code></dfn>
                    <td> <code
                            class="idl"><a data-link-type="idl" href="#eventdef-websocket-open" id="ref-for-eventdef-websocket-open">open</a></code>
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                            id="dom-websocket-onmessage"><code>onmessage</code></dfn>
                    <td> <code
                            class="idl"><a data-link-type="idl" href="#eventdef-websocket-message" id="ref-for-eventdef-websocket-message">message</a></code>
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                            id="dom-websocket-onerror"><code>onerror</code></dfn>
                    <td> <code
                            class="idl"><a data-link-type="idl" href="#eventdef-websocket-error" id="ref-for-eventdef-websocket-error">error</a></code>
                <tr>
                    <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export
                            id="dom-websocket-onclose"><code>onclose</code></dfn>
                    <td> <code
                            class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close⑤">close</a></code>
        </table>

        <h2 class="heading settled" data-level="4" id="feedback-from-the-protocol"><span class="secno">4. </span><span
                class="content">来自协议的反馈</span><a class="self-link" href="#feedback-from-the-protocol"></a></h2>
        <p>当<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①⓪">WebSocket
                连接已建立</a>时，用户代理必须<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                id="ref-for-queue-a-task">排队一个任务</a>来运行这些步骤：</p>
        <div class="algorithm" data-algorithm="handle connection establishment">
            <ol>
                <li data-md>
                    <p>将<a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state⑥">ready
                            state</a>更改为<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-open" id="ref-for-dom-websocket-open①">OPEN</a></code>
                        (1)。</p>
                <li data-md>
                    <p>如果不是空值，将<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions②">extensions</a></code>属性的值更改为<a
                            data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                            id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①①">使用中的扩展</a>。<a
                            data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                <li data-md>
                    <p>如果不是空值，将<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol②">protocol</a></code>属性的值更改为<a
                            data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_"
                            id="ref-for-page-19:~:text=_Subprotocol%20In,Use_">使用中的子协议</a>。<a data-link-type="biblio"
                            href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire">触发</a>在<code
                            class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑨">WebSocket</a></code>对象上的一个名为<dfn
                            class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="event" data-export
                            id="eventdef-websocket-open"><code>open</code></dfn>的事件。</p>
            </ol>
            <p class="note" role="note">由于上述算法是作为<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                    id="ref-for-queue-a-task①">任务排队</a>的，因此在<a data-link-type="dfn"
                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                    id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①②">WebSocket
                    连接已建立</a>与脚本设置<code
                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-open" id="ref-for-eventdef-websocket-open①">open</a></code>事件的事件侦听器之间不存在竞争条件。
            </p>
        </div>
        <hr>
        <div class="algorithm" data-algorithm="handle a WebSocket message">
            <p>当接收到类型为<var>type</var>和数据为<var>data</var>的<a data-link-type="dfn"
                    href="https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_"
                    id="ref-for-page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_">WebSocket
                    消息</a>时，用户代理必须<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                    id="ref-for-queue-a-task②">排队一个任务</a>，以遵循以下步骤：<a data-link-type="biblio" href="#biblio-wsp"
                    title="The WebSocket Protocol">[WSP]</a></p>
            <ol>
                <li data-md>
                    <p>如果<a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state⑦">ready
                            state</a>不是<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-open" id="ref-for-dom-websocket-open②">OPEN</a></code>
                        (1)，则返回。</p>
                <li data-md>
                    <p>根据<var>type</var>和<a data-link-type="dfn" href="#websocket-binary-type"
                            id="ref-for-websocket-binary-type③">binary type</a>的情况来确定<var>dataForEvent</var>：</p>
                    <dl class="switch">
                        <dt data-md><var>type</var>表示数据为文本
                        <dd data-md>
                            <p>一个包含<var>data</var>的新<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④">DOMString</a></code>
                            </p>
                        <dt data-md><var>type</var>表示数据为二进制且<a data-link-type="dfn" href="#websocket-binary-type"
                                id="ref-for-websocket-binary-type④">binary type</a>为
                            <dfn class="dfn-paneled idl-code" data-dfn-for="BinaryType" data-dfn-type="enum-value"
                                data-export id="dom-binarytype-blob"><code>"blob"</code></dfn>
                        <dd data-md>
                            <p>一个在<code
                                    class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⓪">WebSocket</a></code>对象的<a
                                    data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"
                                    id="ref-for-concept-relevant-realm">相关领域</a>中创建的新<code
                                    class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑦">Blob</a></code>对象，
                                表示<var>data</var>为其原始数据<a data-link-type="biblio" href="#biblio-fileapi"
                                    title="File API">[FILEAPI]</a></p>
                        <dt data-md><var>type</var>表示数据为二进制且<a data-link-type="dfn" href="#websocket-binary-type"
                                id="ref-for-websocket-binary-type⑤">binary type</a>为
                            <dfn class="dfn-paneled idl-code" data-dfn-for="BinaryType" data-dfn-type="enum-value"
                                data-export id="dom-binarytype-arraybuffer"><code>"arraybuffer"</code></dfn>
                        <dd data-md>
                            <p>一个在<code
                                    class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①①">WebSocket</a></code>对象的<a
                                    data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"
                                    id="ref-for-concept-relevant-realm①">相关领域</a>中创建的新<code
                                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑦">ArrayBuffer</a></code>对象，
                                其内容为<var>data</var></p>
                    </dl>
                <li data-md>
                    <p>使用<code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code>，<a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire①">触发</a>在<code
                            class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①②">WebSocket</a></code>对象上的一个名为<dfn
                            class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="event" data-export
                            id="eventdef-websocket-message"><code>message</code></dfn>的事件，
                        <code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code>属性初始化为<a
                            data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer"
                            id="ref-for-concept-url-serializer①">序列化</a><code
                            class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①③">WebSocket</a></code>对象的<a
                            data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                            id="ref-for-concept-url③">url</a>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-origin"
                            id="ref-for-concept-url-origin">源</a>，<code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code>属性初始化为<var>dataForEvent</var>。
                    </p>
            </ol>
            <p class="note" role="note">建议用户代理在运行任务之前检查是否可以有效地执行上述步骤，在准备缓冲区时从其他<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue"
                    id="ref-for-task-queue">任务队列</a>中挑选任务。
                例如，如果当数据到达时<a data-link-type="dfn" href="#websocket-binary-type"
                    id="ref-for-websocket-binary-type⑥">binary type</a>为"<code
                    class="idl"><a data-link-type="idl" href="#dom-binarytype-blob" id="ref-for-dom-binarytype-blob⑤">blob</a></code>"，
                并且用户代理将所有数据缓存到磁盘，但在运行上述特定消息的<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task">任务</a>之前脚本将<a data-link-type="dfn" href="#websocket-binary-type"
                    id="ref-for-websocket-binary-type⑦">binary
                    type</a>切换为"<code
                    class="idl"><a data-link-type="idl" href="#dom-binarytype-arraybuffer" id="ref-for-dom-binarytype-arraybuffer③">arraybuffer</a></code>"，
                则用户代理会希望在运行此<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                    id="ref-for-concept-task①">任务</a>之前将数据分页回 RAM，以避免在创建<code
                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑧">ArrayBuffer</a></code>对象时阻塞主线程。
            </p>
        </div>
        <div class="example" id="message-example">
            <a class="self-link" href="#message-example"></a>
            <p>下面是如何在文本帧的情况下定义<code
                    class="idl"><a data-link-type="idl" href="#eventdef-websocket-message" id="ref-for-eventdef-websocket-message①">message</a></code>事件处理程序的示例：
            </p>
            <pre class="highlight">mysocket<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'on'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOn<c- p>();</c->
  <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'off'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOff<c- p>();</c->
  <c- p>}</c->
<c- p>};</c->
</pre>
            <p>此处的协议很简单，服务器仅发送“on”或“off”消息。</p>
        </div>
        <hr>
        <p>当<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                id="ref-for-section-7.1.3⑥">WebSocket 关闭握手启动</a>时，用户代理必须<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                id="ref-for-queue-a-task③">排队一个任务</a>将<a data-link-type="dfn" href="#websocket-ready-state"
                id="ref-for-websocket-ready-state⑧">ready state</a>更改为<code
                class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing⑤">CLOSING</a></code>
            (2)。(如果<code
                class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close④">close()</a></code>方法
            被调用，当此任务运行时，<a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state⑨">ready
                state</a>将已经设置为<code
                class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing⑥">CLOSING</a></code>
            (2))。<a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
        <hr>
        <p id="closeWebSocket">当<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4④">WebSocket
                连接关闭</a>时，可能是<a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-41:~:text=closed-,_cleanly_."
                id="ref-for-page-41:~:text=closed-,_cleanly_.">干净地关闭</a>，用户代理必须<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                id="ref-for-queue-a-task④">排队一个任务</a>来运行以下子步骤：</p>
        <div class="algorithm" data-algorithm="handle connection close">
            <ol>
                <li data-md>
                    <p>将<a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state①⓪">ready
                            state</a>更改为<code
                            class="idl"><a data-link-type="idl" href="#dom-websocket-closed" id="ref-for-dom-websocket-closed②">CLOSED</a></code>
                        (3)。</p>
                <li data-md>
                    <p>如果用户代理需要<a data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                            id="ref-for-section-7.1.7⑦">WebSocket 连接失败</a>，或者如果<a data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4"
                            id="ref-for-section-7.1.4⑤">WebSocket 连接关闭</a>是在被标记为<dfn class="dfn-paneled"
                            data-dfn-type="dfn" data-lt="flagged as full" data-noexport
                            id="flagged-as-full">已满</dfn>之后发生的，<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire②">触发一个事件</a>，在<code
                            class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①④">WebSocket</a></code>对象上命名为<dfn
                            class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="event" data-export
                            id="eventdef-websocket-error"><code>error</code></dfn>的事件。<a data-link-type="biblio"
                            href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire③">触发一个事件</a>，命名为 <dfn class="dfn-paneled idl-code"
                            data-dfn-for="WebSocket" data-dfn-type="event" data-export
                            id="eventdef-websocket-close"><code>close</code></dfn>，在 <code
                            class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑤">WebSocket</a></code>
                        对象上，
                        使用 <code
                            class="idl"><a data-link-type="idl" href="#closeevent" id="ref-for-closeevent">CloseEvent</a></code>，将
                        <code
                            class="idl"><a data-link-type="idl" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean">wasClean</a></code>
                        属性初始化为 true，如果连接 <a data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#page-41:~:text=closed-,_cleanly_."
                            id="ref-for-page-41:~:text=closed-,_cleanly_.①">干净地</a> 关闭，否则为 false，并将 <code
                            class="idl"><a data-link-type="idl" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code">code</a></code>
                        属性初始化为 <a data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5"
                            id="ref-for-section-7.1.5①">WebSocket 连接关闭代码</a>，并将 <code
                            class="idl"><a data-link-type="idl" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason">reason</a></code>
                        属性初始化为将 <a data-link-type="dfn"
                            href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom"
                            id="ref-for-utf-8-decode-without-bom">UTF-8 解码无 BOM</a> 应用于 <a data-link-type="dfn"
                            href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6"
                            id="ref-for-section-7.1.6①">WebSocket 连接关闭原因</a> 的结果。 <a data-link-type="biblio"
                            href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>

            </ol>
        </div>
        <div class="warning">
            <p>用户代理不得以任何方式向脚本传达失败信息，这将使脚本能够区分以下情况：</p>
            <ul>
                <li data-md>
                    <p>无法解析其主机名的服务器。</p>
                <li data-md>
                    <p>无法成功路由数据包的服务器。</p>
                <li data-md>
                    <p>在指定端口拒绝连接的服务器。</p>
                <li data-md>
                    <p>未能正确执行 TLS 握手的服务器（例如，无法验证服务器证书）。</p>
                <li data-md>
                    <p>未完成打开握手的服务器（例如，因为它不是 WebSocket 服务器）。</p>
                <li data-md>
                    <p>发送了正确打开握手的 WebSocket 服务器，但指定的选项导致客户端断开连接（例如，服务器指定了客户端未提供的子协议）。</p>
                <li data-md>
                    <p>在成功完成打开握手后突然关闭连接的 WebSocket 服务器。</p>
            </ul>
            <p>在所有这些情况下，<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5"
                    id="ref-for-section-7.1.5②">WebSocket 连接关闭代码</a>将为1006，正如<cite>WebSocket Protocol</cite>所要求的。<a
                    data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
            <p>允许脚本区分这些情况将使脚本能够在攻击前探测用户的本地网络。</p>
            <p class="note" role="note">特别是，这意味着代码1015不会被用户代理使用（除非服务器在其关闭帧中错误地使用了它，当然）。</p>
        </div>
        <hr>
        <p>在本节中排队的所有<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"
                id="ref-for-concept-task②">任务</a>的<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source">任务源</a>是<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="websocket-task-source">WebSocket 任务源</dfn>。</p>

        <h2 class="heading settled" data-level="5" id="ping-and-pong-frames"><span class="secno">5. </span><span
                class="content">Ping 和 Pong 帧</span><a class="self-link" href="#ping-and-pong-frames"></a></h2>
        <p><cite>WebSocket 协议</cite>定义了可用于保持连接、心跳检测、网络状态探测、延迟测量等用途的 Ping 和 Pong 帧。这些帧目前未在 API 中暴露。</p>
        <p>用户代理可以根据需要发送 ping 和未请求的 pong 帧，例如为了保持本地网络 NAT 映射、检测失败的连接或向用户显示延迟指标。用户代理不得使用 ping 或未请求的 pong
            来帮助服务器；假定服务器会在适当的时候请求 pong，以满足服务器的需求。</p>

        <h2 class="heading settled" data-level="6" id="the-closeevent-interface"><span class="secno">6. </span><span
                class="content">CloseEvent 接口</span><a class="self-link" href="#the-closeevent-interface"></a></h2>
        <p><code
                class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑥">WebSocket</a></code>对象使用<code
                class="idl"><a data-link-type="idl" href="#closeevent" id="ref-for-closeevent②">CloseEvent</a></code>接口处理<code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close⑥">close</a></code>事件：
        </p>

        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="closeevent"><code><c- g>CloseEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="constructor" data-export data-lt="CloseEvent(type, eventInitDict)|constructor(type, eventInitDict)|CloseEvent(type)|constructor(type)" id="dom-closeevent-closeevent"><code><c- g>constructor</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent/CloseEvent(type, eventInitDict), CloseEvent/constructor(type, eventInitDict), CloseEvent/CloseEvent(type), CloseEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-closeevent-closeevent-type-eventinitdict-type"><code><c- g>type</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-closeeventinit" id="ref-for-dictdef-closeeventinit"><c- n>CloseEventInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent/CloseEvent(type, eventInitDict), CloseEvent/constructor(type, eventInitDict), CloseEvent/CloseEvent(type), CloseEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-closeevent-closeevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></dfn> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean①"><c- g>wasClean</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑥"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code①"><c- g>code</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString④"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason①"><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-closeeventinit"><code><c- g>CloseEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-closeeventinit-wasclean"><code><c- g>wasClean</c-></code></dfn> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑦"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="unsigned short " id="dom-closeeventinit-code"><code><c- g>code</c-></code></dfn> = 0;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑤"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;&quot;" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="USVString " id="dom-closeeventinit-reason"><code><c- g>reason</c-></code></dfn> = "";
};
</pre>
        <dl class="domintro">
            <dt data-md><var>event</var> . <code
                    class="idl"><a data-link-type="idl" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean②">wasClean</a></code>
            <dd data-md>
                <p>如果连接已清理关闭，则返回 true；否则返回 false。</p>
            <dt data-md><var>event</var> . <code
                    class="idl"><a data-link-type="idl" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code②">code</a></code>
            <dd data-md>
                <p>返回服务器提供的 WebSocket 连接关闭代码。</p>
            <dt data-md><var>event</var> . <code
                    class="idl"><a data-link-type="idl" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason②">reason</a></code>
            <dd data-md>
                <p>返回服务器提供的 WebSocket 连接关闭原因。</p>
        </dl>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export
                id="dom-closeevent-wasclean"><code>wasClean</code></dfn> 属性必须返回初始化时的值。它表示连接是否已清理关闭。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export
                id="dom-closeevent-code"><code>code</code></dfn> 属性必须返回初始化时的值。它表示服务器提供的 WebSocket 连接关闭代码。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export
                id="dom-closeevent-reason"><code>reason</code></dfn> 属性必须返回初始化时的值。它表示服务器提供的 WebSocket 连接关闭原因。</p>

        <h2 class="heading settled" data-level="7" id="garbage-collection"><span class="secno">7. </span><span
                class="content">垃圾回收</span><a class="self-link" href="#garbage-collection"></a></h2>
        <p><code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑦">WebSocket</a></code>
            对象，其 <a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state①①">就绪状态</a>
            被设置为 <code
                class="idl"><a data-link-type="idl" href="#dom-websocket-connecting" id="ref-for-dom-websocket-connecting③">CONNECTING</a></code>
            (0) 时，
            当 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop①">事件循环</a>
            上次达到 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1"
                id="ref-for-step1①">步骤1</a> 时，
            如果注册了任何 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-open" id="ref-for-eventdef-websocket-open②">open</a></code>
            事件、<code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-message" id="ref-for-eventdef-websocket-message②">message</a></code>
            事件、<code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-error" id="ref-for-eventdef-websocket-error①">error</a></code>
            事件或 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close⑦">close</a></code>
            事件的事件监听器，则不能进行垃圾回收。</p>
        <p><code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑧">WebSocket</a></code>
            对象，其 <a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state①②">就绪状态</a>
            被设置为 <code
                class="idl"><a data-link-type="idl" href="#dom-websocket-open" id="ref-for-dom-websocket-open③">OPEN</a></code>
            (1) 时，
            当 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop②">事件循环</a>
            上次达到 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1"
                id="ref-for-step1②">步骤1</a> 时，
            如果注册了任何 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-message" id="ref-for-eventdef-websocket-message③">message</a></code>
            事件、<code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-error" id="ref-for-eventdef-websocket-error②">error</a></code>
            事件或 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close⑧">close</a></code>
            事件的事件监听器，则不能进行垃圾回收。</p>
        <p><code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑨">WebSocket</a></code>
            对象，其 <a data-link-type="dfn" href="#websocket-ready-state" id="ref-for-websocket-ready-state①③">就绪状态</a>
            被设置为 <code
                class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing⑦">CLOSING</a></code>
            (2) 时，
            当 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"
                id="ref-for-event-loop③">事件循环</a>
            上次达到 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1"
                id="ref-for-step1③">步骤1</a> 时，
            如果注册了任何 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-error" id="ref-for-eventdef-websocket-error③">error</a></code>
            事件或 <code
                class="idl"><a data-link-type="idl" href="#eventdef-websocket-close" id="ref-for-eventdef-websocket-close⑨">close</a></code>
            事件的事件监听器，则不能进行垃圾回收。</p>
        <p>如果一个 <code
                class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②⓪">WebSocket</a></code>
            对象与 <a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①③">已建立的连接</a>
            有待传输到网络的数据，则不能进行垃圾回收。<a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
        </p>
        <p>如果一个 <code
                class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②①">WebSocket</a></code>
            对象在其连接仍然打开时被垃圾回收，用户代理必须 <a data-link-type="dfn"
                href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2③">启动
                WebSocket 关闭握手</a>，并且不为关闭消息提供状态代码。<a data-link-type="biblio" href="#biblio-wsp"
                title="The WebSocket Protocol">[WSP]</a></p>
        <hr>
        <p>如果用户代理要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="make-disappear">消失</dfn> 一个 <code
                class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②②">WebSocket</a></code>
            对象（当 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">文档</a></code>
            对象消失时会发生这种情况），用户代理必须遵循以下列表中的第一组适当步骤：</p>
        <div class="algorithm" data-algorithm="to make disappear">
            <dl class="switch">
                <dt data-md>如果 WebSocket 连接尚未 <a data-link-type="dfn"
                        href="https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and"
                        id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①④">建立</a>
                    <a data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a>
                <dd data-md>
                    <p><a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7"
                            id="ref-for-section-7.1.7⑧">使 WebSocket 连接失败</a>。<a data-link-type="biblio"
                            href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                <dt data-md>如果 WebSocket 关闭握手尚未 <a data-link-type="dfn"
                        href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3"
                        id="ref-for-section-7.1.3⑦">启动</a> <a data-link-type="biblio" href="#biblio-wsp"
                        title="The WebSocket Protocol">[WSP]</a>
                <dd data-md>
                    <p><a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2"
                            id="ref-for-section-7.1.2④">启动 WebSocket 关闭握手</a>，WebSocket 关闭消息中使用的状态代码为 1001。<a
                            data-link-type="biblio" href="#biblio-wsp" title="The WebSocket Protocol">[WSP]</a></p>
                <dt data-md>否则
                <dd data-md>
                    <p>不执行任何操作。</p>
            </dl>
        </div>
        <h2 class="no-num heading settled" id="acks"><span class="content">致谢</span><a class="self-link"
                href="#acks"></a></h2>
        <p>在 2021 年创建此标准之前，此处的文本在 <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a> 和 <a
                href="https://fetch.spec.whatwg.org/">Fetch Standard</a> 中维护。感谢所有为开发规范做出贡献的贡献者，特别是作为原作者的 Ian Hickson 和
            Anne van Kesteren。</p>
        <p>感谢 devsnek 和 平野裕 (Yutaka Hirano) 在 WebSockets Standard 创建后所做的贡献。</p>
        <p>此标准由 Adam Rice (<a href="https://google.com">Google</a>, <a
                href="mailto:ricea@chromium.org">ricea@chromium.org</a>) 编写。</p>
        <h2 class="no-num heading settled" id="ipr"><span class="content">知识产权</span><a class="self-link"
                href="#ipr"></a></h2>
        <p>版权所有 © WHATWG (Apple, Google, Mozilla, Microsoft)。本作品采用 <a
                href="https://creativecommons.org/licenses/by/4.0/" rel="license">知识共享署名 4.0 国际许可协议</a>
            进行许可。至于它的某些部分被纳入源代码中，这些部分在源代码中按照 <a href="https://opensource.org/licenses/BSD-3-Clause" rel="license">BSD
                3-Clause License</a> 进行许可。</p>
        <p>这是现行标准。那些对专利审查版感兴趣的人可以查看 <a href="/review-drafts/2023-09/">现行标准审查草案</a>。</p>
    </main>
    <script>
        // "use strict";
        // if ("serviceWorker" in navigator) {
        //     navigator.serviceWorker.register("/service-worker.js");
        // }
    </script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#dom-binarytype-arraybuffer">"arraybuffer"</a><span>，在 § 4</span>
        <li><a href="#websocket-binary-type">binary type</a><span>，在 § 3.1</span>
        <li><a href="#enumdef-binarytype">BinaryType</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-binarytype">binaryType</a><span>，在 § 3.1</span>
        <li><a href="#dom-binarytype-blob">"blob"</a><span>，在 § 4</span>
        <li><a href="#dom-websocket-bufferedamount">bufferedAmount</a><span>，在 § 3.1</span>
        <li><a href="#eventdef-websocket-close">close</a><span>，在 § 4</span>
        <li><a href="#dom-websocket-close">close()</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-close">close(code)</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-close">close(code, reason)</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-closed">CLOSED</a><span>，在 § 3.1</span>
        <li><a href="#closeevent">CloseEvent</a><span>，在 § 6</span>
        <li><a href="#dictdef-closeeventinit">CloseEventInit</a><span>，在 § 6</span>
        <li><a href="#dom-closeevent-closeevent">CloseEvent(type)</a><span>，在 § 6</span>
        <li><a href="#dom-closeevent-closeevent">CloseEvent(type, eventInitDict)</a><span>，在 § 6</span>
        <li><a href="#dom-websocket-closing">CLOSING</a><span>，在 § 3.1</span>
        <li>
            code
            <ul>
                <li><a href="#dom-closeevent-code">CloseEvent 的属性</a><span>，在 § 6</span>
                <li><a href="#dom-closeeventinit-code">CloseEventInit 的字典成员</a><span>，在 § 6</span>
            </ul>
        <li><a href="#dom-websocket-connecting">CONNECTING</a><span>，在 § 3.1</span>
        <li><a href="#dom-closeevent-closeevent">构造函数 (type)</a><span>，在 § 6</span>
        <li><a href="#dom-closeevent-closeevent">构造函数 (type, eventInitDict)</a><span>，在 § 6</span>
        <li><a href="#dom-websocket-websocket">构造函数 (url)</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-websocket">构造函数 (url, protocols)</a><span>，在 § 3.1</span>
        <li><a href="#eventdef-websocket-error">error</a><span>，在 § 4</span>
        <li><a href="#concept-websocket-establish">建立 WebSocket 连接</a><span>，在 § 2.2</span>
        <li><a href="#dom-websocket-extensions">extensions</a><span>，在 § 3.1</span>
        <li><a href="#flagged-as-full">标记为已满</a><span>，在 § 4</span>
        <li><a href="#websocket-internal-url">内部 URL</a><span>，在 § 3.1</span>
        <li><a href="#make-disappear">消失</a><span>，在 § 7</span>
        <li><a href="#eventdef-websocket-message">message</a><span>，在 § 4</span>
        <li><a href="#concept-websocket-connection-obtain">获取 WebSocket 连接</a><span>，在 § 2.1</span>
        <li><a href="#dom-websocket-onclose">onclose</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-onerror">onerror</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-onmessage">onmessage</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-onopen">onopen</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-open">OPEN</a><span>，在 § 3.1</span>
        <li><a href="#eventdef-websocket-open">open</a><span>，在 § 4</span>
        <li><a href="#dom-websocket-protocol">protocol</a><span>，在 § 3.1</span>
        <li><a href="#websocket-ready-state">就绪状态</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-readystate">readyState</a><span>，在 § 3.1</span>
        <li>
            reason
            <ul>
                <li><a href="#dom-closeevent-reason">CloseEvent 的属性</a><span>，在 § 6</span>
                <li><a href="#dom-closeeventinit-reason">CloseEventInit 的字典成员</a><span>，在 § 6</span>
            </ul>
        <li><a href="#dom-websocket-send">send(data)</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-url">url</a><span>，在 § 3.1</span>
        <li>
            wasClean
            <ul>
                <li><a href="#dom-closeevent-wasclean">CloseEvent 的属性</a><span>，在 § 6</span>
                <li><a href="#dom-closeeventinit-wasclean">CloseEventInit 的字典成员</a><span>，在 § 6</span>
            </ul>
        <li><a href="#websocket">WebSocket</a><span>，在 § 3.1</span>
        <li><a href="#websocket-task-source">WebSocket 任务源</a><span>，在 § 4</span>
        <li><a href="#dom-websocket-websocket">WebSocket(url)</a><span>，在 § 3.1</span>
        <li><a href="#dom-websocket-websocket">WebSocket(url, protocols)</a><span>，在 § 3.1</span>
    </ul>

    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[DOM]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="85394472">Document</span>
                <li><span class="dfn-paneled" id="129bdae8">Event</span>
                <li><span class="dfn-paneled" id="44a7708c">EventInit</span>
                <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
                <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ENCODING]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="a3033be5">utf-8 decode without bom</span>
                <li><span class="dfn-paneled" id="0303e8e5">utf-8 encode</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FETCH]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="a6a8ec88">append</span>
                <li><span class="dfn-paneled" id="688f9669">cache mode</span>
                <li><span class="dfn-paneled" id="857d5516">client</span>
                <li><span class="dfn-paneled" id="0a52a8b4">combine</span>
                <li><span class="dfn-paneled" id="697965b2">connection</span>
                <li><span class="dfn-paneled" id="902380f7">credentials mode</span>
                <li><span class="dfn-paneled" id="3be1d4ac">extracting header list values</span>
                <li><span class="dfn-paneled" id="a33db89a">fetch</span>
                <li><span class="dfn-paneled" id="6ee0eab1">header list</span>
                <li><span class="dfn-paneled" id="c07f8014">header value</span>
                <li><span class="dfn-paneled" id="cb98f71f">mode</span>
                <li><span class="dfn-paneled" id="eb1b1af3">network error</span>
                <li><span class="dfn-paneled" id="bd2fe71e">processresponse</span>
                <li><span class="dfn-paneled" id="64b62ea0">redirect mode</span>
                <li><span class="dfn-paneled" id="358f1dbd">referrer</span>
                <li><span class="dfn-paneled" id="55213b5b">request</span>
                <li><span class="dfn-paneled" id="6d1db60d">service-workers mode</span>
                <li><span class="dfn-paneled" id="a1d47575">status</span>
                <li><span class="dfn-paneled" id="dc1cd39b">url</span>
                <li><span class="dfn-paneled" id="2c8ec3a8">useparallelqueue</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FILEAPI]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="b7d73f5b">Blob</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
                <li><span class="dfn-paneled" id="3e8c0e5f">MessageEvent</span>
                <li><span class="dfn-paneled" id="1b5b1c0c">api base url</span>
                <li><span class="dfn-paneled" id="3700794f">data</span>
                <li><span class="dfn-paneled" id="6a5a59a0">event handler</span>
                <li><span class="dfn-paneled" id="9d386f55">event handler event type</span>
                <li><span class="dfn-paneled" id="03675365">event handler idl attribute</span>
                <li><span class="dfn-paneled" id="c6d19e56">event loop</span>
                <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
                <li><span class="dfn-paneled" id="e0eefdd9">origin</span>
                <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
                <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
                <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
                <li><span class="dfn-paneled" id="683cb370">step 1</span>
                <li><span class="dfn-paneled" id="e270bd2a">task</span>
                <li><span class="dfn-paneled" id="80726755">task queues</span>
                <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="b012ccb2">forgiving-base64 encode</span>
                <li><span class="dfn-paneled" id="16b1470a">isomorphic encode</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="ed948033">fragment</span>
                <li><span class="dfn-paneled" id="b85ee3be">host</span>
                <li><span class="dfn-paneled" id="959ad97b">origin</span>
                <li><span class="dfn-paneled" id="c0868016">path</span>
                <li><span class="dfn-paneled" id="852ada56">port</span>
                <li><span class="dfn-paneled" id="3ab2ec8b">query</span>
                <li><span class="dfn-paneled" id="3a711be7">scheme</span>
                <li><span class="dfn-paneled" id="dcffbccd">url</span>
                <li><span class="dfn-paneled" id="ca3ca4ae">url parser</span>
                <li><span class="dfn-paneled" id="a8c7461b">url record</span>
                <li><span class="dfn-paneled" id="5442ea33">url serializer</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="2f8afbfe">ArrayBuffer</span>
                <li><span class="dfn-paneled" id="6c9ab516">ArrayBufferView</span>
                <li><span class="dfn-paneled" id="3aff2fb3">BufferSource</span>
                <li><span class="dfn-paneled" id="f89c7d0d">Clamp</span>
                <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
                <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="37afd48d">InvalidAccessError</span>
                <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
                <li><span class="dfn-paneled" id="be2d2b4c">SyntaxError</span>
                <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
                <li><span class="dfn-paneled" id="5372cca8">boolean</span>
                <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
                <li><span class="dfn-paneled" id="3b5f2424">the given value</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
                <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
                <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
                <li><span class="dfn-paneled" id="450958f7">unsigned short</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WSP]</a>定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="1172cc05">a websocket message has been received</span>
                <li><span class="dfn-paneled" id="e746eb27">cleanly</span>
                <li><span class="dfn-paneled" id="ae698447">close the websocket connection</span>
                <li><span class="dfn-paneled" id="a7100bf9">established</span>
                <li><span class="dfn-paneled" id="cd622903">extensions in use</span>
                <li><span class="dfn-paneled" id="2bd00413">fail the websocket connection</span>
                <li><span class="dfn-paneled" id="28bb6bc9">sec-websocket-protocol</span>
                <li><span class="dfn-paneled" id="f9982e17">send a websocket message</span>
                <li><span class="dfn-paneled" id="a4fa4138">start the websocket closing handshake</span>
                <li><span class="dfn-paneled" id="7eb570ba">subprotocol in use</span>
                <li><span class="dfn-paneled" id="b75eba20">the websocket closing handshake is started</span>
                <li><span class="dfn-paneled" id="a37b7863">the websocket connection close code</span>
                <li><span class="dfn-paneled" id="a0841248">the websocket connection close reason</span>
                <li><span class="dfn-paneled" id="c9b060e8">the websocket connection is closed</span>
                <li><span class="dfn-paneled" id="4e3cd62b">the websocket connection is established</span>
                <li><span class="dfn-paneled" id="33680a76">ws</span>
                <li><span class="dfn-paneled" id="7d0af9ea">wss</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. 现行标准.
            URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-encoding">[ENCODING]
        <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/"><cite>编码标准</cite></a>. 现行标准.
            URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
        <dt id="biblio-fetch">[FETCH]
        <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch 标准</cite></a>. 现行标准.
            URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
        <dt id="biblio-fileapi">[FILEAPI]
        <dd>Marijn Kruisselbrink. <a href="https://w3c.github.io/FileAPI/"><cite>文件 API</cite></a>. URL: <a
                href="https://w3c.github.io/FileAPI/">https://w3c.github.io/FileAPI/</a>
        <dt id="biblio-hsts">[HSTS]
        <dd>J. Hodges; C. Jackson; A. Barth. <a href="https://www.rfc-editor.org/rfc/rfc6797"><cite>HTTP 严格传输安全
                    (HSTS)</cite></a>. 2012年11月. 提议标准. URL: <a
                href="https://www.rfc-editor.org/rfc/rfc6797">https://www.rfc-editor.org/rfc/rfc6797</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 等. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>.
            现行标准. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>基础结构标准</cite></a>. 现行标准.
            URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-unicode">[UNICODE]
        <dd><a href="https://www.unicode.org/versions/latest/"><cite>Unicode 标准</cite></a>. URL: <a
                href="https://www.unicode.org/versions/latest/">https://www.unicode.org/versions/latest/</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL 标准</cite></a>. 现行标准.
            URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. 现行标准. URL: <a
                href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
        <dt id="biblio-wsp">[WSP]
        <dd>I. Fette; A. Melnikov. <a href="https://www.rfc-editor.org/rfc/rfc6455"><cite>WebSocket 协议</cite></a>.
            2011年12月. 提议标准. URL: <a
                href="https://www.rfc-editor.org/rfc/rfc6455">https://www.rfc-editor.org/rfc/rfc6455</a>
    </dl>

    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-binarytype"><code><c- g>BinaryType</c-></code></a> { <a class="idl-code" data-link-type="enum-value" href="#dom-binarytype-blob"><c- s>"blob"</c-></a>, <a class="idl-code" data-link-type="enum-value" href="#dom-binarytype-arraybuffer"><c- s>"arraybuffer"</c-></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#websocket"><code><c- g>WebSocket</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-websocket-websocket"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-websocket-websocket-url-protocols-url"><code><c- g>url</c-></code></a>, <c- b>optional</c-> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>>) <a href="#dom-websocket-websocket-url-protocols-protocols"><code><c- g>protocols</c-></code></a> = []);
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-websocket-url"><c- g>url</c-></a>;

  // ready state
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-connecting"><c- g>CONNECTING</c-></a> = 0;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-open"><c- g>OPEN</c-></a> = 1;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-closing"><c- g>CLOSING</c-></a> = 2;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="const" href="#dom-websocket-closed"><c- g>CLOSED</c-></a> = 3;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-websocket-readystate"><c- g>readyState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned long long" href="#dom-websocket-bufferedamount"><c- g>bufferedAmount</c-></a>;

  // networking
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onopen"><c- g>onopen</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onerror"><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onclose"><c- g>onclose</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-extensions"><c- g>extensions</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-protocol"><c- g>protocol</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-close"><c- g>close</c-></a>(<c- b>optional</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Clamp"><c- g>Clamp</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-close-code-reason-code"><code><c- g>code</c-></code></a>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-websocket-close-code-reason-reason"><code><c- g>reason</c-></code></a>);

  // messaging
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onmessage"><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-binarytype"><c- n>BinaryType</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BinaryType" href="#dom-websocket-binarytype"><c- g>binaryType</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-send"><c- g>send</c-></a>((<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource"><c- n>BufferSource</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob"><c- n>Blob</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>) <a href="#dom-websocket-send-data-data"><code><c- g>data</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#closeevent"><code><c- g>CloseEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
  <a href="#dom-closeevent-closeevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-closeevent-closeevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-closeeventinit"><c- n>CloseEventInit</c-></a> <a href="#dom-closeevent-closeevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-closeevent-wasclean"><c- g>wasClean</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-closeevent-code"><c- g>code</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-closeevent-reason"><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-closeeventinit"><code><c- g>CloseEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-closeeventinit-wasclean"><code><c- g>wasClean</c-></code></a> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a data-default="0" data-type="unsigned short " href="#dom-closeeventinit-code"><code><c- g>code</c-></code></a> = 0;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-default="&quot;&quot;" data-type="USVString " href="#dom-closeeventinit-reason"><code><c- g>reason</c-></code></a> = "";
};

</pre>
    <details class="mdn-anno unpositioned" data-anno-for="dom-closeevent-closeevent">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent/CloseEvent"
                    title="The CloseEvent() constructor creates a new CloseEvent object.">CloseEvent/CloseEvent</a></p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>11+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>16+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>14+</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-closeevent-code②">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent/code"
                    title="The code read-only property of the CloseEvent interface returns a WebSocket connection close code indicating the reason the server gave for closing the connection.">CloseEvent/code</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>8+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-closeevent-reason②">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent/reason"
                    title="The reason read-only property of the CloseEvent interface returns the WebSocket connection close reason the server gave for closing the connection; that is, a concise human-readable prose explanation for the closure.">CloseEvent/reason</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>8+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-closeevent-wasclean②">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent/wasClean"
                    title="The wasClean read-only property of the CloseEvent interface returns true if the connection closed cleanly.">CloseEvent/wasClean</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>8+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="the-closeevent-interface">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent"
                    title="A CloseEvent is sent to clients using WebSockets when the connection is closed. This is delivered to the listener indicated by the WebSocket object&apos;s onclose attribute.">CloseEvent</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>8+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android yes"><span>Firefox for Android</span><span>8+</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-websocket①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/WebSocket"
                    title="The WebSocket() constructor returns a new WebSocket object.">WebSocket/WebSocket</a></p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>11+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-binarytype①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/binaryType"
                    title="The WebSocket.binaryType property controls the type of binary data being received over the WebSocket connection.">WebSocket/binaryType</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>11+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-bufferedamount①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/bufferedAmount"
                    title="The WebSocket.bufferedAmount read-only property returns the number of bytes of data that have been queued using calls to send() but not yet transmitted to the network. This value resets to zero once all queued data has been sent. This value does not reset to zero when the connection is closed; if you keep calling send(), this will continue to climb.">WebSocket/bufferedAmount</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-close①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/close"
                    title="The WebSocket.close() method closes the WebSocket connection or connection attempt, if any. If the connection is already CLOSED, this method does nothing.">WebSocket/close</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-websocket-onclose">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/close_event"
                    title="The close event is fired when a connection with a WebSocket is closed.">WebSocket/close_event</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android yes"><span>Android WebView</span><span>37+</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-websocket-onerror">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/error_event"
                    title="The error event is fired when a connection with a WebSocket has been closed due to an error (some data couldn&apos;t be sent for example).">WebSocket/error_event</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android yes"><span>Android WebView</span><span>37+</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-extensions①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/extensions"
                    title="The WebSocket.extensions read-only property returns the extensions selected by the server. This is currently only the empty string or a list of extensions as negotiated by the connection.">WebSocket/extensions</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>8+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>16+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-websocket-onmessage">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/message_event"
                    title="The message event is fired when data is received through a WebSocket.">WebSocket/message_event</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android yes"><span>Android WebView</span><span>37+</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="dom-websocket-onopen">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/open_event"
                    title="The open event is fired when a connection with a WebSocket is opened.">WebSocket/open_event</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android yes"><span>Android WebView</span><span>37+</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-protocol①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/protocol"
                    title="The WebSocket.protocol read-only property returns the name of the sub-protocol the server selected; this will be one of the strings specified in the protocols parameter when creating the WebSocket object, or the empty string if no connection is established.">WebSocket/protocol</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>15+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-readystate①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/readyState"
                    title="The WebSocket.readyState read-only property returns the current state of the WebSocket connection.">WebSocket/readyState</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-send①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send"
                    title="The WebSocket.send() method enqueues the specified data to be transmitted to the server over the WebSocket connection, increasing the value of bufferedAmount by the number of bytes needed to contain the data. If the data can&apos;t be sent (for example, because it needs to be buffered but the buffer is full), the socket is closed automatically. The browser will throw an exception if you call send() when the connection is in the CONNECTING state. If you call send() when the connection is in the CLOSING or CLOSED states, the browser will silently discard the data.">WebSocket/send</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>18+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-websocket-url①">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/url"
                    title="The WebSocket.url read-only property returns the absolute URL of the WebSocket as resolved by the constructor.">WebSocket/url</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>7+</span></span><span
                    class="safari yes"><span>Safari</span><span>6+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>18+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie no"><span>IE</span><span>None</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <details class="mdn-anno unpositioned" data-anno-for="the-websocket-interface">
        <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span>
        </summary>
        <div class="feature">
            <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket"
                    title="The WebSocket object provides the API for creating and managing a WebSocket connection to a server, as well as for sending and receiving data on the connection.">WebSocket</a>
            </p>
            <p class="all-engines-text">In all current engines.</p>
            <div class="support">
                <span class="firefox yes"><span>Firefox</span><span>11+</span></span><span
                    class="safari yes"><span>Safari</span><span>5+</span></span><span
                    class="chrome yes"><span>Chrome</span><span>5+</span></span>
                <hr>
                <span class="opera yes"><span>Opera</span><span>12.1+</span></span><span
                    class="edge_blink yes"><span>Edge</span><span>79+</span></span>
                <hr>
                <span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span
                    class="ie yes"><span>IE</span><span>10+</span></span>
                <hr>
                <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                    class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                    class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                    class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                    class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                    class="opera_android yes"><span>Opera Mobile</span><span>12.1+</span></span>
            </div>
        </div>
    </details>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "0303e8e5": { "dfnID": "0303e8e5", "dfnText": "utf-8 encode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-utf-8-encode" }], "title": "3.1. Interface definition" }], "url": "https://encoding.spec.whatwg.org/#utf-8-encode" },
                "03675365": { "dfnID": "03675365", "dfnText": "event handler idl attribute", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handler-idl-attributes" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "0a52a8b4": { "dfnID": "0a52a8b4", "dfnText": "combine", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-header-list-combine" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-header-list-combine" },
                "1172cc05": { "dfnID": "1172cc05", "dfnText": "a websocket message has been received", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_" },
                "129bdae8": { "dfnID": "129bdae8", "dfnText": "Event", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event" }], "title": "6. The CloseEvent interface" }], "url": "https://dom.spec.whatwg.org/#event" },
                "16b1470a": { "dfnID": "16b1470a", "dfnText": "isomorphic encode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-isomorphic-encode" }], "title": "2.2. Opening handshake" }], "url": "https://infra.spec.whatwg.org/#isomorphic-encode" },
                "1b5b1c0c": { "dfnID": "1b5b1c0c", "dfnText": "api base url", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-api-base-url" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" },
                "28bb6bc9": { "dfnID": "28bb6bc9", "dfnText": "sec-websocket-protocol", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-11.3.4" }, { "id": "ref-for-section-11.3.4\u2460" }], "title": "3.1. Interface definition" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.3.4" },
                "2bc0cdf4": { "dfnID": "2bc0cdf4", "dfnText": "EventTarget", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eventtarget" }], "title": "3.1. Interface definition" }], "url": "https://dom.spec.whatwg.org/#eventtarget" },
                "2bd00413": { "dfnID": "2bd00413", "dfnText": "fail the websocket connection", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.7" }, { "id": "ref-for-section-7.1.7\u2460" }, { "id": "ref-for-section-7.1.7\u2461" }, { "id": "ref-for-section-7.1.7\u2462" }], "title": "2.2. Opening handshake" }, { "refs": [{ "id": "ref-for-section-7.1.7\u2463" }, { "id": "ref-for-section-7.1.7\u2464" }, { "id": "ref-for-section-7.1.7\u2465" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.7\u2466" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-section-7.1.7\u2467" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7" },
                "2c8ec3a8": { "dfnID": "2c8ec3a8", "dfnText": "useparallelqueue", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-fetch-useparallelqueue" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#fetch-useparallelqueue" },
                "2f8afbfe": { "dfnID": "2f8afbfe", "dfnText": "ArrayBuffer", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-ArrayBuffer" }, { "id": "ref-for-idl-ArrayBuffer\u2460" }, { "id": "ref-for-idl-ArrayBuffer\u2461" }, { "id": "ref-for-idl-ArrayBuffer\u2462" }, { "id": "ref-for-idl-ArrayBuffer\u2463" }, { "id": "ref-for-idl-ArrayBuffer\u2464" }, { "id": "ref-for-idl-ArrayBuffer\u2465" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-idl-ArrayBuffer\u2466" }, { "id": "ref-for-idl-ArrayBuffer\u2467" }], "title": "4. Feedback from the protocol" }], "url": "https://webidl.spec.whatwg.org/#idl-ArrayBuffer" },
                "33680a76": { "dfnID": "33680a76", "dfnText": "ws", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-11.1.1" }], "title": "3.1. Interface definition" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.1" },
                "358f1dbd": { "dfnID": "358f1dbd", "dfnText": "referrer", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-referrer" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-referrer" },
                "3700794f": { "dfnID": "3700794f", "dfnText": "data", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-messageevent-data" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" },
                "37afd48d": { "dfnID": "37afd48d", "dfnText": "InvalidAccessError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-invalidaccesserror" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#invalidaccesserror" },
                "3a711be7": { "dfnID": "3a711be7", "dfnText": "scheme", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-scheme" }], "title": "2.1. Connections" }, { "refs": [{ "id": "ref-for-concept-url-scheme\u2460" }, { "id": "ref-for-concept-url-scheme\u2461" }], "title": "2.2. Opening handshake" }, { "refs": [{ "id": "ref-for-concept-url-scheme\u2462" }, { "id": "ref-for-concept-url-scheme\u2463" }, { "id": "ref-for-concept-url-scheme\u2464" }, { "id": "ref-for-concept-url-scheme\u2465" }, { "id": "ref-for-concept-url-scheme\u2466" }], "title": "3.1. Interface definition" }], "url": "https://url.spec.whatwg.org/#concept-url-scheme" },
                "3ab2ec8b": { "dfnID": "3ab2ec8b", "dfnText": "query", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-query" }, { "id": "ref-for-concept-url-query\u2460" }], "title": "2.1. Connections" }], "url": "https://url.spec.whatwg.org/#concept-url-query" },
                "3aff2fb3": { "dfnID": "3aff2fb3", "dfnText": "BufferSource", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-BufferSource" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#BufferSource" },
                "3b5f2424": { "dfnID": "3b5f2424", "dfnText": "the given value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-the-given-value" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#the-given-value" },
                "3be1d4ac": { "dfnID": "3be1d4ac", "dfnText": "extracting header list values", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-extract-header-list-values" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#extract-header-list-values" },
                "3e8c0e5f": { "dfnID": "3e8c0e5f", "dfnText": "MessageEvent", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-messageevent" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/comms.html#messageevent" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }, { "id": "ref-for-this\u2460" }, { "id": "ref-for-this\u2461" }, { "id": "ref-for-this\u2462" }, { "id": "ref-for-this\u2463" }, { "id": "ref-for-this\u2464" }, { "id": "ref-for-this\u2465" }, { "id": "ref-for-this\u2466" }, { "id": "ref-for-this\u2467" }, { "id": "ref-for-this\u2468" }, { "id": "ref-for-this\u2460\u24ea" }, { "id": "ref-for-this\u2460\u2460" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "44a7708c": { "dfnID": "44a7708c", "dfnText": "EventInit", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-eventinit" }], "title": "6. The CloseEvent interface" }], "url": "https://dom.spec.whatwg.org/#dictdef-eventinit" },
                "450958f7": { "dfnID": "450958f7", "dfnText": "unsigned short", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-unsigned-short" }, { "id": "ref-for-idl-unsigned-short\u2460" }, { "id": "ref-for-idl-unsigned-short\u2461" }, { "id": "ref-for-idl-unsigned-short\u2462" }, { "id": "ref-for-idl-unsigned-short\u2463" }, { "id": "ref-for-idl-unsigned-short\u2464" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-idl-unsigned-short\u2465" }, { "id": "ref-for-idl-unsigned-short\u2466" }], "title": "6. The CloseEvent interface" }], "url": "https://webidl.spec.whatwg.org/#idl-unsigned-short" },
                "4e3cd62b": { "dfnID": "4e3cd62b", "dfnText": "the websocket connection is established", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460" }], "title": "2.2. Opening handshake" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2461" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2463" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2464" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2465" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2466" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2467" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2468" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u24ea" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2460" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2461" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2463" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" },
                "5372cca8": { "dfnID": "5372cca8", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-boolean" }, { "id": "ref-for-idl-boolean\u2460" }], "title": "6. The CloseEvent interface" }], "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "5442ea33": { "dfnID": "5442ea33", "dfnText": "url serializer", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-serializer" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-concept-url-serializer\u2460" }], "title": "4. Feedback from the protocol" }], "url": "https://url.spec.whatwg.org/#concept-url-serializer" },
                "55213b5b": { "dfnID": "55213b5b", "dfnText": "request", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "5991ccfb": { "dfnID": "5991ccfb", "dfnText": "relevant realm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-relevant-realm" }, { "id": "ref-for-concept-relevant-realm\u2460" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" },
                "5f90bbfb": { "dfnID": "5f90bbfb", "dfnText": "undefined", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-undefined" }, { "id": "ref-for-idl-undefined\u2460" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "5fd23811": { "dfnID": "5fd23811", "dfnText": "fire an event", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-event-fire" }, { "id": "ref-for-concept-event-fire\u2460" }, { "id": "ref-for-concept-event-fire\u2461" }, { "id": "ref-for-concept-event-fire\u2462" }], "title": "4. Feedback from the protocol" }], "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "64b62ea0": { "dfnID": "64b62ea0", "dfnText": "redirect mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-redirect-mode" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-redirect-mode" },
                "683cb370": { "dfnID": "683cb370", "dfnText": "step 1", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-step1" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-step1\u2460" }, { "id": "ref-for-step1\u2461" }, { "id": "ref-for-step1\u2462" }], "title": "7. Garbage collection" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#step1" },
                "688f9669": { "dfnID": "688f9669", "dfnText": "cache mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-cache-mode" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-cache-mode" },
                "697965b2": { "dfnID": "697965b2", "dfnText": "connection", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-connection" }], "title": "2.1. Connections" }], "url": "https://fetch.spec.whatwg.org/#concept-connection" },
                "6a5a59a0": { "dfnID": "6a5a59a0", "dfnText": "event handler", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handlers" }, { "id": "ref-for-event-handlers\u2460" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" },
                "6c9ab516": { "dfnID": "6c9ab516", "dfnText": "ArrayBufferView", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ArrayBufferView" }, { "id": "ref-for-ArrayBufferView\u2460" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#ArrayBufferView" },
                "6d1db60d": { "dfnID": "6d1db60d", "dfnText": "service-workers mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-request-service-workers-mode" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#request-service-workers-mode" },
                "6ee0eab1": { "dfnID": "6ee0eab1", "dfnText": "header list", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-header-list" }, { "id": "ref-for-concept-request-header-list\u2460" }, { "id": "ref-for-concept-request-header-list\u2461" }, { "id": "ref-for-concept-request-header-list\u2462" }, { "id": "ref-for-concept-request-header-list\u2463" }, { "id": "ref-for-concept-request-header-list\u2464" }, { "id": "ref-for-concept-request-header-list\u2465" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-header-list" },
                "797018a7": { "dfnID": "797018a7", "dfnText": "InvalidStateError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-invalidstateerror" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "7d0af9ea": { "dfnID": "7d0af9ea", "dfnText": "wss", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-11.1.2" }], "title": "3.1. Interface definition" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.2" },
                "7eb570ba": { "dfnID": "7eb570ba", "dfnText": "subprotocol in use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-19:~:text=_Subprotocol%20In,Use_" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_" },
                "80726755": { "dfnID": "80726755", "dfnText": "task queues", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-task-queue" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" },
                "852ada56": { "dfnID": "852ada56", "dfnText": "port", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-port" }], "title": "2.1. Connections" }], "url": "https://url.spec.whatwg.org/#concept-url-port" },
                "85394472": { "dfnID": "85394472", "dfnText": "Document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-document" }], "title": "7. Garbage collection" }], "url": "https://dom.spec.whatwg.org/#document" },
                "857d5516": { "dfnID": "857d5516", "dfnText": "client", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-client" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "8855a9aa": { "dfnID": "8855a9aa", "dfnText": "DOMString", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMString" }, { "id": "ref-for-idl-DOMString\u2460" }, { "id": "ref-for-idl-DOMString\u2461" }, { "id": "ref-for-idl-DOMString\u2462" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-idl-DOMString\u2463" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-idl-DOMString\u2464" }], "title": "6. The CloseEvent interface" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMString" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-Exposed\u2460" }], "title": "6. The CloseEvent interface" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "902380f7": { "dfnID": "902380f7", "dfnText": "credentials mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-credentials-mode" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-credentials-mode" },
                "959ad97b": { "dfnID": "959ad97b", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-origin" }], "title": "4. Feedback from the protocol" }], "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "9a517a7d": { "dfnID": "9a517a7d", "dfnText": "queue a task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-queue-a-task" }, { "id": "ref-for-queue-a-task\u2460" }, { "id": "ref-for-queue-a-task\u2461" }, { "id": "ref-for-queue-a-task\u2462" }, { "id": "ref-for-queue-a-task\u2463" }, { "id": "ref-for-queue-a-task\u2464" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" },
                "9c4c1e66": { "dfnID": "9c4c1e66", "dfnText": "relevant settings object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-relevant-settings-object" }, { "id": "ref-for-relevant-settings-object\u2460" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "9cce47fd": { "dfnID": "9cce47fd", "dfnText": "sequence", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-sequence" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#idl-sequence" },
                "9d386f55": { "dfnID": "9d386f55", "dfnText": "event handler event type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-handler-event-type" }, { "id": "ref-for-event-handler-event-type\u2460" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" },
                "a0841248": { "dfnID": "a0841248", "dfnText": "the websocket connection close reason", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.6" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.6\u2460" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6" },
                "a1d47575": { "dfnID": "a1d47575", "dfnText": "status", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-response-status" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-response-status" },
                "a3033be5": { "dfnID": "a3033be5", "dfnText": "utf-8 decode without bom", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-utf-8-decode-without-bom" }], "title": "4. Feedback from the protocol" }], "url": "https://encoding.spec.whatwg.org/#utf-8-decode-without-bom" },
                "a33db89a": { "dfnID": "a33db89a", "dfnText": "fetch", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-fetch" }, { "id": "ref-for-concept-fetch\u2460" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-fetch" },
                "a37b7863": { "dfnID": "a37b7863", "dfnText": "the websocket connection close code", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.5" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.5\u2460" }, { "id": "ref-for-section-7.1.5\u2461" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5" },
                "a4fa4138": { "dfnID": "a4fa4138", "dfnText": "start the websocket closing handshake", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.2" }, { "id": "ref-for-section-7.1.2\u2460" }, { "id": "ref-for-section-7.1.2\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.2\u2462" }, { "id": "ref-for-section-7.1.2\u2463" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2" },
                "a6a8ec88": { "dfnID": "a6a8ec88", "dfnText": "append", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-header-list-append" }, { "id": "ref-for-concept-header-list-append\u2460" }, { "id": "ref-for-concept-header-list-append\u2461" }, { "id": "ref-for-concept-header-list-append\u2462" }, { "id": "ref-for-concept-header-list-append\u2463" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-header-list-append" },
                "a7100bf9": { "dfnID": "a7100bf9", "dfnText": "established", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460" }], "title": "2.2. Opening handshake" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2461" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2463" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2464" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2465" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2466" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2467" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2468" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u24ea" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2460" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2461" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2463" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" },
                "a72449dd": { "dfnID": "a72449dd", "dfnText": "in parallel", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-in-parallel" }, { "id": "ref-for-in-parallel\u2460" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "a8c7461b": { "dfnID": "a8c7461b", "dfnText": "url record", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url" }, { "id": "ref-for-concept-url\u2460" }, { "id": "ref-for-concept-url\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-concept-url\u2462" }], "title": "4. Feedback from the protocol" }], "url": "https://url.spec.whatwg.org/#concept-url" },
                "ae698447": { "dfnID": "ae698447", "dfnText": "close the websocket connection", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.1" }, { "id": "ref-for-section-7.1.1\u2460" }, { "id": "ref-for-section-7.1.1\u2461" }, { "id": "ref-for-section-7.1.1\u2462" }, { "id": "ref-for-section-7.1.1\u2463" }, { "id": "ref-for-section-7.1.1\u2464" }, { "id": "ref-for-section-7.1.1\u2465" }, { "id": "ref-for-section-7.1.1\u2466" }], "title": "3.1. Interface definition" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1" },
                "b012ccb2": { "dfnID": "b012ccb2", "dfnText": "forgiving-base64 encode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-forgiving-base64-encode" }], "title": "2.2. Opening handshake" }], "url": "https://infra.spec.whatwg.org/#forgiving-base64-encode" },
                "b0d7f3c3": { "dfnID": "b0d7f3c3", "dfnText": "USVString", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-USVString" }, { "id": "ref-for-idl-USVString\u2460" }, { "id": "ref-for-idl-USVString\u2461" }, { "id": "ref-for-idl-USVString\u2462" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-idl-USVString\u2463" }, { "id": "ref-for-idl-USVString\u2464" }], "title": "6. The CloseEvent interface" }], "url": "https://webidl.spec.whatwg.org/#idl-USVString" },
                "b75eba20": { "dfnID": "b75eba20", "dfnText": "the websocket closing handshake is started", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.3" }, { "id": "ref-for-section-7.1.3\u2460" }, { "id": "ref-for-section-7.1.3\u2461" }, { "id": "ref-for-section-7.1.3\u2462" }, { "id": "ref-for-section-7.1.3\u2463" }, { "id": "ref-for-section-7.1.3\u2464" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.3\u2465" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-section-7.1.3\u2466" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3" },
                "b7d73f5b": { "dfnID": "b7d73f5b", "dfnText": "Blob", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dfn-Blob" }, { "id": "ref-for-dfn-Blob\u2460" }, { "id": "ref-for-dfn-Blob\u2461" }, { "id": "ref-for-dfn-Blob\u2462" }, { "id": "ref-for-dfn-Blob\u2463" }, { "id": "ref-for-dfn-Blob\u2464" }, { "id": "ref-for-dfn-Blob\u2465" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dfn-Blob\u2466" }], "title": "4. Feedback from the protocol" }], "url": "https://w3c.github.io/FileAPI/#dfn-Blob" },
                "b85ee3be": { "dfnID": "b85ee3be", "dfnText": "host", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-host" }], "title": "2.1. Connections" }], "url": "https://url.spec.whatwg.org/#concept-url-host" },
                "bd2fe71e": { "dfnID": "bd2fe71e", "dfnText": "processresponse", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-process-response" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#process-response" },
                "be2d2b4c": { "dfnID": "be2d2b4c", "dfnText": "SyntaxError", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-syntaxerror" }, { "id": "ref-for-syntaxerror\u2460" }, { "id": "ref-for-syntaxerror\u2461" }, { "id": "ref-for-syntaxerror\u2462" }, { "id": "ref-for-syntaxerror\u2463" }, { "id": "ref-for-syntaxerror\u2464" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#syntaxerror" },
                "c07f8014": { "dfnID": "c07f8014", "dfnText": "header value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-header-value" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#header-value" },
                "c0868016": { "dfnID": "c0868016", "dfnText": "path", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-path" }], "title": "2.1. Connections" }], "url": "https://url.spec.whatwg.org/#concept-url-path" },
                "c3b2d08c": { "dfnID": "c3b2d08c", "dfnText": "task source", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-task-source" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "c6d19e56": { "dfnID": "c6d19e56", "dfnText": "event loop", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-event-loop" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-event-loop\u2460" }, { "id": "ref-for-event-loop\u2461" }, { "id": "ref-for-event-loop\u2462" }], "title": "7. Garbage collection" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" },
                "c9b060e8": { "dfnID": "c9b060e8", "dfnText": "the websocket connection is closed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-7.1.4" }, { "id": "ref-for-section-7.1.4\u2460" }, { "id": "ref-for-section-7.1.4\u2461" }, { "id": "ref-for-section-7.1.4\u2462" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-section-7.1.4\u2463" }, { "id": "ref-for-section-7.1.4\u2464" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4" },
                "ca3ca4ae": { "dfnID": "ca3ca4ae", "dfnText": "url parser", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-parser" }], "title": "3.1. Interface definition" }], "url": "https://url.spec.whatwg.org/#concept-url-parser" },
                "cb98f71f": { "dfnID": "cb98f71f", "dfnText": "mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-mode" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-mode" },
                "cd622903": { "dfnID": "cd622903", "dfnText": "extensions in use", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460" }], "title": "2.2. Opening handshake" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2461" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2463" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2464" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2465" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2466" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2467" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2468" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u24ea" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2460" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2461" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2462" }, { "id": "ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and\u2460\u2463" }], "title": "7. Garbage collection" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" },
                "closeevent": { "dfnID": "closeevent", "dfnText": "CloseEvent", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-closeevent" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-closeevent\u2460" }, { "id": "ref-for-closeevent\u2461" }], "title": "6. The CloseEvent interface" }], "url": "#closeevent" },
                "concept-websocket-connection-obtain": { "dfnID": "concept-websocket-connection-obtain", "dfnText": "obtain a WebSocket connection", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-concept-websocket-connection-obtain" }], "title": "2.1. Connections" }], "url": "#concept-websocket-connection-obtain" },
                "concept-websocket-establish": { "dfnID": "concept-websocket-establish", "dfnText": "establish a WebSocket connection", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-concept-websocket-establish" }, { "id": "ref-for-concept-websocket-establish\u2460" }], "title": "3.1. Interface definition" }], "url": "#concept-websocket-establish" },
                "dc1cd39b": { "dfnID": "dc1cd39b", "dfnText": "url", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-url" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "dca2de17": { "dfnID": "dca2de17", "dfnText": "DOMException", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-DOMException" }, { "id": "ref-for-idl-DOMException\u2460" }, { "id": "ref-for-idl-DOMException\u2461" }, { "id": "ref-for-idl-DOMException\u2462" }, { "id": "ref-for-idl-DOMException\u2463" }, { "id": "ref-for-idl-DOMException\u2464" }, { "id": "ref-for-idl-DOMException\u2465" }, { "id": "ref-for-idl-DOMException\u2466" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "dcffbccd": { "dfnID": "dcffbccd", "dfnText": "url", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url" }, { "id": "ref-for-concept-url\u2460" }, { "id": "ref-for-concept-url\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-concept-url\u2462" }], "title": "4. Feedback from the protocol" }], "url": "https://url.spec.whatwg.org/#concept-url" },
                "dictdef-closeeventinit": { "dfnID": "dictdef-closeeventinit", "dfnText": "CloseEventInit", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-closeeventinit" }], "title": "6. The CloseEvent interface" }], "url": "#dictdef-closeeventinit" },
                "dom-binarytype-arraybuffer": { "dfnID": "dom-binarytype-arraybuffer", "dfnText": "\"arraybuffer\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-binarytype-arraybuffer" }, { "id": "ref-for-dom-binarytype-arraybuffer\u2460" }, { "id": "ref-for-dom-binarytype-arraybuffer\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-binarytype-arraybuffer\u2462" }], "title": "4. Feedback from the protocol" }], "url": "#dom-binarytype-arraybuffer" },
                "dom-binarytype-blob": { "dfnID": "dom-binarytype-blob", "dfnText": "\"blob\"", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-binarytype-blob" }, { "id": "ref-for-dom-binarytype-blob\u2460" }, { "id": "ref-for-dom-binarytype-blob\u2461" }, { "id": "ref-for-dom-binarytype-blob\u2462" }, { "id": "ref-for-dom-binarytype-blob\u2463" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-binarytype-blob\u2464" }], "title": "4. Feedback from the protocol" }], "url": "#dom-binarytype-blob" },
                "dom-closeevent-closeevent": { "dfnID": "dom-closeevent-closeevent", "dfnText": "constructor", "external": false, "refSections": [], "url": "#dom-closeevent-closeevent" },
                "dom-closeevent-closeevent-type-eventinitdict-eventinitdict": { "dfnID": "dom-closeevent-closeevent-type-eventinitdict-eventinitdict", "dfnText": "eventInitDict", "external": false, "refSections": [], "url": "#dom-closeevent-closeevent-type-eventinitdict-eventinitdict" },
                "dom-closeevent-closeevent-type-eventinitdict-type": { "dfnID": "dom-closeevent-closeevent-type-eventinitdict-type", "dfnText": "type", "external": false, "refSections": [], "url": "#dom-closeevent-closeevent-type-eventinitdict-type" },
                "dom-closeevent-code": { "dfnID": "dom-closeevent-code", "dfnText": "code", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-closeevent-code" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-dom-closeevent-code\u2460" }, { "id": "ref-for-dom-closeevent-code\u2461" }], "title": "6. The CloseEvent interface" }], "url": "#dom-closeevent-code" },
                "dom-closeevent-reason": { "dfnID": "dom-closeevent-reason", "dfnText": "reason", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-closeevent-reason" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-dom-closeevent-reason\u2460" }, { "id": "ref-for-dom-closeevent-reason\u2461" }], "title": "6. The CloseEvent interface" }], "url": "#dom-closeevent-reason" },
                "dom-closeevent-wasclean": { "dfnID": "dom-closeevent-wasclean", "dfnText": "wasClean", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-closeevent-wasclean" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-dom-closeevent-wasclean\u2460" }, { "id": "ref-for-dom-closeevent-wasclean\u2461" }], "title": "6. The CloseEvent interface" }], "url": "#dom-closeevent-wasclean" },
                "dom-closeeventinit-code": { "dfnID": "dom-closeeventinit-code", "dfnText": "code", "external": false, "refSections": [], "url": "#dom-closeeventinit-code" },
                "dom-closeeventinit-reason": { "dfnID": "dom-closeeventinit-reason", "dfnText": "reason", "external": false, "refSections": [], "url": "#dom-closeeventinit-reason" },
                "dom-closeeventinit-wasclean": { "dfnID": "dom-closeeventinit-wasclean", "dfnText": "wasClean", "external": false, "refSections": [], "url": "#dom-closeeventinit-wasclean" },
                "dom-websocket-binarytype": { "dfnID": "dom-websocket-binarytype", "dfnText": "binaryType", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-binarytype" }, { "id": "ref-for-dom-websocket-binarytype\u2460" }, { "id": "ref-for-dom-websocket-binarytype\u2461" }, { "id": "ref-for-dom-websocket-binarytype\u2462" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-binarytype" },
                "dom-websocket-bufferedamount": { "dfnID": "dom-websocket-bufferedamount", "dfnText": "bufferedAmount", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-bufferedamount" }, { "id": "ref-for-dom-websocket-bufferedamount\u2460" }, { "id": "ref-for-dom-websocket-bufferedamount\u2461" }, { "id": "ref-for-dom-websocket-bufferedamount\u2462" }, { "id": "ref-for-dom-websocket-bufferedamount\u2463" }, { "id": "ref-for-dom-websocket-bufferedamount\u2464" }, { "id": "ref-for-dom-websocket-bufferedamount\u2465" }, { "id": "ref-for-dom-websocket-bufferedamount\u2466" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-bufferedamount" },
                "dom-websocket-close": { "dfnID": "dom-websocket-close", "dfnText": "close(code, reason)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-close" }, { "id": "ref-for-dom-websocket-close\u2460" }, { "id": "ref-for-dom-websocket-close\u2461" }, { "id": "ref-for-dom-websocket-close\u2462" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-close\u2463" }], "title": "4. Feedback from the protocol" }], "url": "#dom-websocket-close" },
                "dom-websocket-close-code-reason-code": { "dfnID": "dom-websocket-close-code-reason-code", "dfnText": "code", "external": false, "refSections": [], "url": "#dom-websocket-close-code-reason-code" },
                "dom-websocket-close-code-reason-reason": { "dfnID": "dom-websocket-close-code-reason-reason", "dfnText": "reason", "external": false, "refSections": [], "url": "#dom-websocket-close-code-reason-reason" },
                "dom-websocket-closed": { "dfnID": "dom-websocket-closed", "dfnText": "CLOSED", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-closed" }, { "id": "ref-for-dom-websocket-closed\u2460" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-closed\u2461" }], "title": "4. Feedback from the protocol" }], "url": "#dom-websocket-closed" },
                "dom-websocket-closing": { "dfnID": "dom-websocket-closing", "dfnText": "CLOSING", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-closing" }, { "id": "ref-for-dom-websocket-closing\u2460" }, { "id": "ref-for-dom-websocket-closing\u2461" }, { "id": "ref-for-dom-websocket-closing\u2462" }, { "id": "ref-for-dom-websocket-closing\u2463" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-closing\u2464" }, { "id": "ref-for-dom-websocket-closing\u2465" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-dom-websocket-closing\u2466" }], "title": "7. Garbage collection" }], "url": "#dom-websocket-closing" },
                "dom-websocket-connecting": { "dfnID": "dom-websocket-connecting", "dfnText": "CONNECTING", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-connecting" }, { "id": "ref-for-dom-websocket-connecting\u2460" }, { "id": "ref-for-dom-websocket-connecting\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-connecting\u2462" }], "title": "7. Garbage collection" }], "url": "#dom-websocket-connecting" },
                "dom-websocket-extensions": { "dfnID": "dom-websocket-extensions", "dfnText": "extensions", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-extensions" }, { "id": "ref-for-dom-websocket-extensions\u2460" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-extensions\u2461" }], "title": "4. Feedback from the protocol" }], "url": "#dom-websocket-extensions" },
                "dom-websocket-onclose": { "dfnID": "dom-websocket-onclose", "dfnText": "onclose", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-onclose" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-onclose" },
                "dom-websocket-onerror": { "dfnID": "dom-websocket-onerror", "dfnText": "onerror", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-onerror" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-onerror" },
                "dom-websocket-onmessage": { "dfnID": "dom-websocket-onmessage", "dfnText": "onmessage", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-onmessage" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-onmessage" },
                "dom-websocket-onopen": { "dfnID": "dom-websocket-onopen", "dfnText": "onopen", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-onopen" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-onopen" },
                "dom-websocket-open": { "dfnID": "dom-websocket-open", "dfnText": "OPEN", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-open" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-open\u2460" }, { "id": "ref-for-dom-websocket-open\u2461" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-dom-websocket-open\u2462" }], "title": "7. Garbage collection" }], "url": "#dom-websocket-open" },
                "dom-websocket-protocol": { "dfnID": "dom-websocket-protocol", "dfnText": "protocol", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-protocol" }, { "id": "ref-for-dom-websocket-protocol\u2460" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-dom-websocket-protocol\u2461" }], "title": "4. Feedback from the protocol" }], "url": "#dom-websocket-protocol" },
                "dom-websocket-readystate": { "dfnID": "dom-websocket-readystate", "dfnText": "readyState", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-readystate" }, { "id": "ref-for-dom-websocket-readystate\u2460" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-readystate" },
                "dom-websocket-send": { "dfnID": "dom-websocket-send", "dfnText": "send(data)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-send" }, { "id": "ref-for-dom-websocket-send\u2460" }, { "id": "ref-for-dom-websocket-send\u2461" }, { "id": "ref-for-dom-websocket-send\u2462" }, { "id": "ref-for-dom-websocket-send\u2463" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-send" },
                "dom-websocket-send-data-data": { "dfnID": "dom-websocket-send-data-data", "dfnText": "data", "external": false, "refSections": [], "url": "#dom-websocket-send-data-data" },
                "dom-websocket-url": { "dfnID": "dom-websocket-url", "dfnText": "url", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-url" }, { "id": "ref-for-dom-websocket-url\u2460" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-url" },
                "dom-websocket-websocket": { "dfnID": "dom-websocket-websocket", "dfnText": "new\n WebSocket(url, protocols)", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-websocket-websocket" }, { "id": "ref-for-dom-websocket-websocket\u2460" }], "title": "3.1. Interface definition" }], "url": "#dom-websocket-websocket" },
                "dom-websocket-websocket-url-protocols-protocols": { "dfnID": "dom-websocket-websocket-url-protocols-protocols", "dfnText": "protocols", "external": false, "refSections": [], "url": "#dom-websocket-websocket-url-protocols-protocols" },
                "dom-websocket-websocket-url-protocols-url": { "dfnID": "dom-websocket-websocket-url-protocols-url", "dfnText": "url", "external": false, "refSections": [], "url": "#dom-websocket-websocket-url-protocols-url" },
                "e0eefdd9": { "dfnID": "e0eefdd9", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-messageevent-origin" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" },
                "e270bd2a": { "dfnID": "e270bd2a", "dfnText": "task", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-task" }, { "id": "ref-for-concept-task\u2460" }, { "id": "ref-for-concept-task\u2461" }], "title": "4. Feedback from the protocol" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "e746eb27": { "dfnID": "e746eb27", "dfnText": "cleanly", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-41:~:text=closed-,_cleanly_." }, { "id": "ref-for-page-41:~:text=closed-,_cleanly_.\u2460" }], "title": "4. Feedback from the protocol" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-41:~:text=closed-,_cleanly_." },
                "eb1b1af3": { "dfnID": "eb1b1af3", "dfnText": "network error", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-network-error" }], "title": "2.2. Opening handshake" }], "url": "https://fetch.spec.whatwg.org/#concept-network-error" },
                "ed948033": { "dfnID": "ed948033", "dfnText": "fragment", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url-fragment" }, { "id": "ref-for-concept-url-fragment\u2460" }], "title": "3.1. Interface definition" }], "url": "https://url.spec.whatwg.org/#concept-url-fragment" },
                "enumdef-binarytype": { "dfnID": "enumdef-binarytype", "dfnText": "BinaryType", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-enumdef-binarytype" }, { "id": "ref-for-enumdef-binarytype\u2460" }], "title": "3.1. Interface definition" }], "url": "#enumdef-binarytype" },
                "eventdef-websocket-close": { "dfnID": "eventdef-websocket-close", "dfnText": "close", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-eventdef-websocket-close" }, { "id": "ref-for-eventdef-websocket-close\u2460" }, { "id": "ref-for-eventdef-websocket-close\u2461" }, { "id": "ref-for-eventdef-websocket-close\u2462" }, { "id": "ref-for-eventdef-websocket-close\u2463" }, { "id": "ref-for-eventdef-websocket-close\u2464" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-eventdef-websocket-close\u2465" }], "title": "6. The CloseEvent interface" }, { "refs": [{ "id": "ref-for-eventdef-websocket-close\u2466" }, { "id": "ref-for-eventdef-websocket-close\u2467" }, { "id": "ref-for-eventdef-websocket-close\u2468" }], "title": "7. Garbage collection" }], "url": "#eventdef-websocket-close" },
                "eventdef-websocket-error": { "dfnID": "eventdef-websocket-error", "dfnText": "error", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-eventdef-websocket-error" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-eventdef-websocket-error\u2460" }, { "id": "ref-for-eventdef-websocket-error\u2461" }, { "id": "ref-for-eventdef-websocket-error\u2462" }], "title": "7. Garbage collection" }], "url": "#eventdef-websocket-error" },
                "eventdef-websocket-message": { "dfnID": "eventdef-websocket-message", "dfnText": "message", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-eventdef-websocket-message" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-eventdef-websocket-message\u2460" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-eventdef-websocket-message\u2461" }, { "id": "ref-for-eventdef-websocket-message\u2462" }], "title": "7. Garbage collection" }], "url": "#eventdef-websocket-message" },
                "eventdef-websocket-open": { "dfnID": "eventdef-websocket-open", "dfnText": "open", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-eventdef-websocket-open" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-eventdef-websocket-open\u2460" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-eventdef-websocket-open\u2461" }], "title": "7. Garbage collection" }], "url": "#eventdef-websocket-open" },
                "f0951476": { "dfnID": "f0951476", "dfnText": "EventHandler", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-eventhandler" }, { "id": "ref-for-eventhandler\u2460" }, { "id": "ref-for-eventhandler\u2461" }, { "id": "ref-for-eventhandler\u2462" }], "title": "3.1. Interface definition" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "f14b47b8": { "dfnID": "f14b47b8", "dfnText": "unsigned long long", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-unsigned-long-long" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "f89c7d0d": { "dfnID": "f89c7d0d", "dfnText": "Clamp", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Clamp" }], "title": "3.1. Interface definition" }], "url": "https://webidl.spec.whatwg.org/#Clamp" },
                "f9982e17": { "dfnID": "f9982e17", "dfnText": "send a websocket message", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" }, { "id": "ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_\u2460" }, { "id": "ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_\u2461" }, { "id": "ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_\u2462" }], "title": "3.1. Interface definition" }], "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" },
                "flagged-as-full": { "dfnID": "flagged-as-full", "dfnText": "flagged\n  as full", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-flagged-as-full" }, { "id": "ref-for-flagged-as-full\u2460" }, { "id": "ref-for-flagged-as-full\u2461" }, { "id": "ref-for-flagged-as-full\u2462" }], "title": "3.1. Interface definition" }], "url": "#flagged-as-full" },
                "make-disappear": { "dfnID": "make-disappear", "dfnText": "make disappear", "external": false, "refSections": [], "url": "#make-disappear" },
                "websocket": { "dfnID": "websocket", "dfnText": "WebSocket", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-websocket" }], "title": "1. Introduction" }, { "refs": [{ "id": "ref-for-websocket\u2460" }], "title": "2. WebSocket protocol alterations" }, { "refs": [{ "id": "ref-for-websocket\u2461" }], "title": "3. The WebSocket interface" }, { "refs": [{ "id": "ref-for-websocket\u2462" }, { "id": "ref-for-websocket\u2463" }, { "id": "ref-for-websocket\u2464" }, { "id": "ref-for-websocket\u2465" }, { "id": "ref-for-websocket\u2466" }, { "id": "ref-for-websocket\u2467" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-websocket\u2468" }, { "id": "ref-for-websocket\u2460\u24ea" }, { "id": "ref-for-websocket\u2460\u2460" }, { "id": "ref-for-websocket\u2460\u2461" }, { "id": "ref-for-websocket\u2460\u2462" }, { "id": "ref-for-websocket\u2460\u2463" }, { "id": "ref-for-websocket\u2460\u2464" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-websocket\u2460\u2465" }], "title": "6. The CloseEvent interface" }, { "refs": [{ "id": "ref-for-websocket\u2460\u2466" }, { "id": "ref-for-websocket\u2460\u2467" }, { "id": "ref-for-websocket\u2460\u2468" }, { "id": "ref-for-websocket\u2461\u24ea" }, { "id": "ref-for-websocket\u2461\u2460" }, { "id": "ref-for-websocket\u2461\u2461" }], "title": "7. Garbage collection" }], "url": "#websocket" },
                "websocket-binary-type": { "dfnID": "websocket-binary-type", "dfnText": "binary type", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-websocket-binary-type" }, { "id": "ref-for-websocket-binary-type\u2460" }, { "id": "ref-for-websocket-binary-type\u2461" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-websocket-binary-type\u2462" }, { "id": "ref-for-websocket-binary-type\u2463" }, { "id": "ref-for-websocket-binary-type\u2464" }, { "id": "ref-for-websocket-binary-type\u2465" }, { "id": "ref-for-websocket-binary-type\u2466" }], "title": "4. Feedback from the protocol" }], "url": "#websocket-binary-type" },
                "websocket-internal-url": { "dfnID": "websocket-internal-url", "dfnText": "url", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-websocket-internal-url" }, { "id": "ref-for-websocket-internal-url\u2460" }], "title": "3.1. Interface definition" }], "url": "#websocket-internal-url" },
                "websocket-ready-state": { "dfnID": "websocket-ready-state", "dfnText": "ready state", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-websocket-ready-state" }, { "id": "ref-for-websocket-ready-state\u2460" }, { "id": "ref-for-websocket-ready-state\u2461" }, { "id": "ref-for-websocket-ready-state\u2462" }, { "id": "ref-for-websocket-ready-state\u2463" }, { "id": "ref-for-websocket-ready-state\u2464" }], "title": "3.1. Interface definition" }, { "refs": [{ "id": "ref-for-websocket-ready-state\u2465" }, { "id": "ref-for-websocket-ready-state\u2466" }, { "id": "ref-for-websocket-ready-state\u2467" }, { "id": "ref-for-websocket-ready-state\u2468" }, { "id": "ref-for-websocket-ready-state\u2460\u24ea" }], "title": "4. Feedback from the protocol" }, { "refs": [{ "id": "ref-for-websocket-ready-state\u2460\u2460" }, { "id": "ref-for-websocket-ready-state\u2460\u2461" }, { "id": "ref-for-websocket-ready-state\u2460\u2462" }], "title": "7. Garbage collection" }], "url": "#websocket-ready-state" },
                "websocket-task-source": { "dfnID": "websocket-task-source", "dfnText": "WebSocket task source", "external": false, "refSections": [], "url": "#websocket-task-source" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getRootLevelAbsolutePosition(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // Returns the root-level absolute position {left and top} of element.
            function getRootLevelAbsolutePosition(el) {
                const boundsRect = el.getBoundingClientRect();
                let xPos = 0;
                let yPos = 0;

                while (el) {
                    let xScroll = el.scrollLeft;
                    let yScroll = el.scrollTop;

                    // Ignore scrolling of body.
                    if (el.tagName === "BODY") {
                        xScroll = 0;
                        yScroll = 0;
                    }
                    xPos += (el.offsetLeft - xScroll + el.clientLeft);
                    yPos += (el.offsetTop - yScroll + el.clientTop);

                    el = el.offsetParent;
                }
                return {
                    left: xPos,
                    top: yPos,
                    right: xPos + boundsRect.width,
                    bottom: yPos + boundsRect.height,
                };
            }

            function scrolledIntoView(element) {
                const rect = element.getBoundingClientRect();
                return (
                    rect.top > 0 &&
                    rect.bottom < window.innerHeight
                );
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        // Maybe prevent default scroll.
                        if (scrolledIntoView(dest)) {
                            event.preventDefault();
                        }
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-position-annos */
        "use strict";
        {
            function repositionAnnoPanels() {
                const panels = [...document.querySelectorAll("[data-anno-for]")];
                hydratePanels(panels);
                let vSoFar = 0;
                for (const panel of panels.sort(cmpTops)) {
                    if (panel.top < vSoFar) {
                        panel.top = vSoFar;
                        panel.style.top = vSoFar + "px";
                    }
                    vSoFar = panel.top + panel.height + 15;
                }
            }
            function hydratePanels(panels) {
                const main = document.querySelector("main");
                let mainRect;
                if (main) mainRect = main.getBoundingClientRect();
                // First display them all, if they're not already visible.
                for (const panel of panels) {
                    panel.classList.remove("unpositioned");
                }
                // Measure them all
                for (const panel of panels) {
                    const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
                    if (!dfn) {
                        console.log("Can't find the annotation panel target:", panel);
                        continue;
                    }
                    panel.dfn = dfn;
                    panel.top = window.scrollY + dfn.getBoundingClientRect().top;
                    let panelRect = panel.getBoundingClientRect();
                    panel.height = panelRect.height;
                    if (main) {
                        panel.overlappingMain = panelRect.left < mainRect.right;
                    } else {
                        panel.overlappingMain = false;
                    }
                }
                // And finally position them
                for (const panel of panels) {
                    const dfn = panel.dfn;
                    if (!dfn) continue;
                    panel.style.top = panel.top + "px";
                    panel.classList.toggle("overlapping-main", panel.overlappingMain);
                }
            }

            function cmpTops(a, b) {
                return a.top - b.top;
            }

            window.addEventListener("load", repositionAnnoPanels);
            window.addEventListener("resize", repositionAnnoPanels);
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#closeevent": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "CloseEvent", "type": "interface", "url": "#closeevent" },
                "#concept-websocket-connection-obtain": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "obtain a websocket connection", "type": "dfn", "url": "#concept-websocket-connection-obtain" },
                "#concept-websocket-establish": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "establish a websocket connection", "type": "dfn", "url": "#concept-websocket-establish" },
                "#dictdef-closeeventinit": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "CloseEventInit", "type": "dictionary", "url": "#dictdef-closeeventinit" },
                "#dom-binarytype-arraybuffer": { "export": true, "for_": ["BinaryType"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "\"arraybuffer\"", "type": "enum-value", "url": "#dom-binarytype-arraybuffer" },
                "#dom-binarytype-blob": { "export": true, "for_": ["BinaryType"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "\"blob\"", "type": "enum-value", "url": "#dom-binarytype-blob" },
                "#dom-closeevent-code": { "export": true, "for_": ["CloseEvent"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "code", "type": "attribute", "url": "#dom-closeevent-code" },
                "#dom-closeevent-reason": { "export": true, "for_": ["CloseEvent"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "reason", "type": "attribute", "url": "#dom-closeevent-reason" },
                "#dom-closeevent-wasclean": { "export": true, "for_": ["CloseEvent"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "wasClean", "type": "attribute", "url": "#dom-closeevent-wasclean" },
                "#dom-websocket-binarytype": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "binaryType", "type": "attribute", "url": "#dom-websocket-binarytype" },
                "#dom-websocket-bufferedamount": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "bufferedAmount", "type": "attribute", "url": "#dom-websocket-bufferedamount" },
                "#dom-websocket-close": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "close(code, reason)", "type": "method", "url": "#dom-websocket-close" },
                "#dom-websocket-closed": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "CLOSED", "type": "const", "url": "#dom-websocket-closed" },
                "#dom-websocket-closing": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "CLOSING", "type": "const", "url": "#dom-websocket-closing" },
                "#dom-websocket-connecting": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "CONNECTING", "type": "const", "url": "#dom-websocket-connecting" },
                "#dom-websocket-extensions": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "extensions", "type": "attribute", "url": "#dom-websocket-extensions" },
                "#dom-websocket-onclose": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "onclose", "type": "attribute", "url": "#dom-websocket-onclose" },
                "#dom-websocket-onerror": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "onerror", "type": "attribute", "url": "#dom-websocket-onerror" },
                "#dom-websocket-onmessage": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "onmessage", "type": "attribute", "url": "#dom-websocket-onmessage" },
                "#dom-websocket-onopen": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "onopen", "type": "attribute", "url": "#dom-websocket-onopen" },
                "#dom-websocket-open": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "OPEN", "type": "const", "url": "#dom-websocket-open" },
                "#dom-websocket-protocol": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "protocol", "type": "attribute", "url": "#dom-websocket-protocol" },
                "#dom-websocket-readystate": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "readyState", "type": "attribute", "url": "#dom-websocket-readystate" },
                "#dom-websocket-send": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "send(data)", "type": "method", "url": "#dom-websocket-send" },
                "#dom-websocket-url": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "url", "type": "attribute", "url": "#dom-websocket-url" },
                "#dom-websocket-websocket": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "WebSocket(url, protocols)", "type": "constructor", "url": "#dom-websocket-websocket" },
                "#enumdef-binarytype": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "BinaryType", "type": "enum", "url": "#enumdef-binarytype" },
                "#eventdef-websocket-close": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "close", "type": "event", "url": "#eventdef-websocket-close" },
                "#eventdef-websocket-error": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "error", "type": "event", "url": "#eventdef-websocket-error" },
                "#eventdef-websocket-message": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "message", "type": "event", "url": "#eventdef-websocket-message" },
                "#eventdef-websocket-open": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "open", "type": "event", "url": "#eventdef-websocket-open" },
                "#flagged-as-full": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "flagged as full", "type": "dfn", "url": "#flagged-as-full" },
                "#websocket": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "WebSocket", "type": "interface", "url": "#websocket" },
                "#websocket-binary-type": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "binary type", "type": "dfn", "url": "#websocket-binary-type" },
                "#websocket-internal-url": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "internal-url", "type": "dfn", "url": "#websocket-internal-url" },
                "#websocket-ready-state": { "export": true, "for_": ["WebSocket"], "level": "", "normative": true, "shortname": "websockets", "spec": "websockets", "status": "local", "text": "ready state", "type": "dfn", "url": "#websocket-ready-state" },
                "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "subprotocol in use", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_" },
                "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "the websocket connection is established", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" },
                "https://datatracker.ietf.org/doc/html/rfc6455#page-41:~:text=closed-,_cleanly_.": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "cleanly", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-41:~:text=closed-,_cleanly_." },
                "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "a websocket message has been received", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_" },
                "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "send a websocket message", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.1": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "ws", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.1" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.2": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "wss", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.2" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-11.3.4": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "sec-websocket-protocol", "type": "http-header", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-11.3.4" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "close the websocket connection", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.1" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "start the websocket closing handshake", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "the websocket closing handshake is started", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.3" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "the websocket connection is closed", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "the websocket connection close code", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "the websocket connection close reason", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6" },
                "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7": { "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc6455", "spec": "rfc6455", "status": "anchor-block", "text": "fail the websocket connection", "type": "dfn", "url": "https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7" },
                "https://dom.spec.whatwg.org/#concept-event-fire": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "fire an event", "type": "dfn", "url": "https://dom.spec.whatwg.org/#concept-event-fire" },
                "https://dom.spec.whatwg.org/#dictdef-eventinit": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "EventInit", "type": "dictionary", "url": "https://dom.spec.whatwg.org/#dictdef-eventinit" },
                "https://dom.spec.whatwg.org/#document": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "Document", "type": "interface", "url": "https://dom.spec.whatwg.org/#document" },
                "https://dom.spec.whatwg.org/#event": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "Event", "type": "interface", "url": "https://dom.spec.whatwg.org/#event" },
                "https://dom.spec.whatwg.org/#eventtarget": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "EventTarget", "type": "interface", "url": "https://dom.spec.whatwg.org/#eventtarget" },
                "https://encoding.spec.whatwg.org/#utf-8-decode-without-bom": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "encoding", "spec": "encoding", "status": "current", "text": "utf-8 decode without bom", "type": "dfn", "url": "https://encoding.spec.whatwg.org/#utf-8-decode-without-bom" },
                "https://encoding.spec.whatwg.org/#utf-8-encode": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "encoding", "spec": "encoding", "status": "current", "text": "utf-8 encode", "type": "dfn", "url": "https://encoding.spec.whatwg.org/#utf-8-encode" },
                "https://fetch.spec.whatwg.org/#concept-connection": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "connection", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-connection" },
                "https://fetch.spec.whatwg.org/#concept-fetch": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "fetch", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-fetch" },
                "https://fetch.spec.whatwg.org/#concept-header-list-append": { "export": true, "for_": ["header list"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "append", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-header-list-append" },
                "https://fetch.spec.whatwg.org/#concept-header-list-combine": { "export": true, "for_": ["header list"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "combine", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-header-list-combine" },
                "https://fetch.spec.whatwg.org/#concept-network-error": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "network error", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-network-error" },
                "https://fetch.spec.whatwg.org/#concept-request": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "request", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "https://fetch.spec.whatwg.org/#concept-request-cache-mode": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "cache mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-cache-mode" },
                "https://fetch.spec.whatwg.org/#concept-request-client": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "client", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "https://fetch.spec.whatwg.org/#concept-request-credentials-mode": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "credentials mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-credentials-mode" },
                "https://fetch.spec.whatwg.org/#concept-request-header-list": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header list", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-header-list" },
                "https://fetch.spec.whatwg.org/#concept-request-mode": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-mode" },
                "https://fetch.spec.whatwg.org/#concept-request-redirect-mode": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "redirect mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-redirect-mode" },
                "https://fetch.spec.whatwg.org/#concept-request-referrer": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "referrer", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-referrer" },
                "https://fetch.spec.whatwg.org/#concept-request-url": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "url", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "https://fetch.spec.whatwg.org/#concept-response-status": { "export": true, "for_": ["response"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "status", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-response-status" },
                "https://fetch.spec.whatwg.org/#extract-header-list-values": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "extracting header list values", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#extract-header-list-values" },
                "https://fetch.spec.whatwg.org/#fetch-useparallelqueue": { "export": true, "for_": ["fetch"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "useparallelqueue", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#fetch-useparallelqueue" },
                "https://fetch.spec.whatwg.org/#header-value": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header value", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#header-value" },
                "https://fetch.spec.whatwg.org/#process-response": { "export": true, "for_": ["fetch"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "processresponse", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#process-response" },
                "https://fetch.spec.whatwg.org/#request-service-workers-mode": { "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "service-workers mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#request-service-workers-mode" },
                "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data": { "export": true, "for_": ["MessageEvent"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "data", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" },
                "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin": { "export": true, "for_": ["MessageEvent"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "attribute", "url": "https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" },
                "https://html.spec.whatwg.org/multipage/comms.html#messageevent": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "MessageEvent", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/comms.html#messageevent" },
                "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "in parallel", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url": { "export": true, "for_": ["environment settings object"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "api base url", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant realm", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler event type", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler idl attribute", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event handler", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "event loop", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "EventHandler", "type": "typedef", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "queue a task", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "relevant settings object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#step1": { "export": true, "for_": ["event loop"], "level": "", "normative": true, "shortname": "html", "spec": "html", "status": "anchor-block", "text": "step 1", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#step1" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue": { "export": false, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task queues", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#task-source": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "task source", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source" },
                "https://infra.spec.whatwg.org/#forgiving-base64-encode": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "forgiving-base64 encode", "type": "dfn", "url": "https://infra.spec.whatwg.org/#forgiving-base64-encode" },
                "https://infra.spec.whatwg.org/#isomorphic-encode": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "isomorphic encode", "type": "dfn", "url": "https://infra.spec.whatwg.org/#isomorphic-encode" },
                "https://url.spec.whatwg.org/#concept-url": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "url record", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url" },
                "https://url.spec.whatwg.org/#concept-url-fragment": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "fragment", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-fragment" },
                "https://url.spec.whatwg.org/#concept-url-host": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "host", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-host" },
                "https://url.spec.whatwg.org/#concept-url-origin": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "origin", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-origin" },
                "https://url.spec.whatwg.org/#concept-url-parser": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "url parser", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-parser" },
                "https://url.spec.whatwg.org/#concept-url-path": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "path", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-path" },
                "https://url.spec.whatwg.org/#concept-url-port": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "port", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-port" },
                "https://url.spec.whatwg.org/#concept-url-query": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "query", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-query" },
                "https://url.spec.whatwg.org/#concept-url-scheme": { "export": true, "for_": ["url"], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "scheme", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-scheme" },
                "https://url.spec.whatwg.org/#concept-url-serializer": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "url serializer", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url-serializer" },
                "https://w3c.github.io/FileAPI/#dfn-Blob": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fileapi", "spec": "fileapi", "status": "current", "text": "Blob", "type": "interface", "url": "https://w3c.github.io/FileAPI/#dfn-Blob" },
                "https://webidl.spec.whatwg.org/#ArrayBufferView": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "ArrayBufferView", "type": "typedef", "url": "https://webidl.spec.whatwg.org/#ArrayBufferView" },
                "https://webidl.spec.whatwg.org/#BufferSource": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "BufferSource", "type": "typedef", "url": "https://webidl.spec.whatwg.org/#BufferSource" },
                "https://webidl.spec.whatwg.org/#Clamp": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Clamp", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Clamp" },
                "https://webidl.spec.whatwg.org/#Exposed": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#idl-ArrayBuffer": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "ArrayBuffer", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-ArrayBuffer" },
                "https://webidl.spec.whatwg.org/#idl-DOMException": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMException", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMException" },
                "https://webidl.spec.whatwg.org/#idl-DOMString": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "DOMString", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-DOMString" },
                "https://webidl.spec.whatwg.org/#idl-USVString": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "USVString", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-USVString" },
                "https://webidl.spec.whatwg.org/#idl-boolean": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "boolean", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "https://webidl.spec.whatwg.org/#idl-sequence": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "sequence", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#idl-sequence" },
                "https://webidl.spec.whatwg.org/#idl-undefined": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "undefined", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-undefined" },
                "https://webidl.spec.whatwg.org/#idl-unsigned-long-long": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "unsigned long long", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long" },
                "https://webidl.spec.whatwg.org/#idl-unsigned-short": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "unsigned short", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-short" },
                "https://webidl.spec.whatwg.org/#invalidaccesserror": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "InvalidAccessError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#invalidaccesserror" },
                "https://webidl.spec.whatwg.org/#invalidstateerror": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "InvalidStateError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#invalidstateerror" },
                "https://webidl.spec.whatwg.org/#syntaxerror": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SyntaxError", "type": "exception", "url": "https://webidl.spec.whatwg.org/#syntaxerror" },
                "https://webidl.spec.whatwg.org/#the-given-value": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "the given value", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#the-given-value" },
                "https://webidl.spec.whatwg.org/#this": { "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.text != linkText) {
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.text)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const ref = refsData[url];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getRootLevelAbsolutePosition(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getRootLevelAbsolutePosition(el) {
                const boundsRect = el.getBoundingClientRect();
                let xPos = 0;
                let yPos = 0;

                while (el) {
                    let xScroll = el.scrollLeft;
                    let yScroll = el.scrollTop;

                    // Ignore scrolling of body.
                    if (el.tagName === "BODY") {
                        xScroll = 0;
                        yScroll = 0;
                    }
                    xPos += (el.offsetLeft - xScroll + el.clientLeft);
                    yPos += (el.offsetTop - yScroll + el.clientTop);

                    el = el.offsetParent;
                }
                return {
                    left: xPos,
                    top: yPos,
                    right: xPos + boundsRect.width,
                    bottom: yPos + boundsRect.height,
                };
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mouseover", e => {
                    let link = e.target.closest("a");
                    if (link) showRefHint(link);
                });
                document.body.addEventListener("focus", e => {
                    let link = e.target.closest("a");
                    if (link) showRefHint(link);
                });

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all link panels.
                    hideAllRefHints();
                });
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        "use strict";
        {
            /*
            Color-choosing design:
            
            * Colors are ordered by goodness.
            * On clicking a var, give it the earliest color
                with the lowest usage in the algorithm.
            * On re-clicking, re-use the var's most recent color
                if that's not currently being used elsewhere.
            */

            const COLOR_COUNT = 7;

            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });

            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = findAlgoContainer(v);

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const varName = nameFromVar(v);
                if (!v.hasAttribute("data-var-color")) {
                    const newColor = chooseHighlightColor(algoContainer, v);
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.setAttribute("data-var-color", newColor);
                            el.setAttribute("data-var-last-color", newColor);
                        }
                    }
                } else {
                    for (const el of algoContainer.querySelectorAll("var")) {
                        if (nameFromVar(el) == varName) {
                            el.removeAttribute("data-var-color");
                        }
                    }
                }
            }
            function findAlgoContainer(el) {
                while (el != document.body) {
                    if (el.hasAttribute("data-algorithm")) return el;
                    el = el.parentNode;
                }
                return null;
            }
            function nameFromVar(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function colorCountsFromContainer(container) {
                const namesFromColor = Array.from({ length: COLOR_COUNT }, x => new Set());
                for (let v of container.querySelectorAll("var[data-var-color]")) {
                    let color = +v.getAttribute("data-var-color");
                    namesFromColor[color].add(nameFromVar(v));
                }

                return namesFromColor.map(x => x.size);
            }
            function leastUsedColor(colors) {
                // Find the earliest color with the lowest count.
                let minCount = Infinity;
                let minColor = null;
                for (var i = 0; i < colors.length; i++) {
                    if (colors[i] < minCount) {
                        minColor = i;
                        minCount = colors[i];
                    }
                }
                return minColor;
            }
            function chooseHighlightColor(container, v) {
                const colorCounts = colorCountsFromContainer(container);
                if (v.hasAttribute("data-var-last-color")) {
                    let color = +v.getAttribute("data-var-last-color");
                    if (colorCounts[color] == 0) return color;
                }
                return leastUsedColor(colorCounts);
            }
        }
    </script>