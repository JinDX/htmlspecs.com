<!DOCTYPE html>
<html lang="zh-hans">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 32.1.6">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        :is(aside, div).example {
            border-left-width: .5em;
            border-left-style: solid;
            border-color: #e0cb52;
            background: #fcfaee
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }

        .example pre {
            background-color: rgba(0, 0, 0, .03)
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .warning {
            border-color: #f11;
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            color: #fff;
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            color: #000;
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>虚拟键盘 API</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        :is(h1, h2, h3, h4, h5, h6, a) abbr {
            border: none
        }

        dfn {
            font-weight: 700
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        code {
            color: #c63501
        }

        th code {
            color: inherit
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        .toc a,
        .tof a {
            text-decoration: none
        }

        a .figno,
        a .secno {
            color: #000
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        table.simple {
            border-spacing: 0;
            border-collapse: collapse;
            border-bottom: 3px solid #005a9c
        }

        .simple th {
            background: #005a9c;
            color: #fff;
            padding: 3px 5px;
            text-align: left
        }

        .simple th a {
            color: #fff;
            padding: 3px 5px;
            text-align: left
        }

        .simple th[scope=row] {
            background: inherit;
            color: inherit;
            border-top: 1px solid #ddd
        }

        .simple td {
            padding: 3px 10px;
            border-top: 1px solid #ddd
        }

        .simple tr:nth-child(even) {
            background: #f0f6ff
        }

        .section dd>p:first-child {
            margin-top: 0
        }

        .section dd>p:last-child {
            margin-bottom: 0
        }

        .section dd {
            margin-bottom: 1em
        }

        .section dl.attrs dd,
        .section dl.eldef dd {
            margin-bottom: 0
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="description" content="虚拟键盘 API 为开发者提供了更大的控制权，能够控制虚拟键盘 (VK) 的可见性，并能够更好地适应虚拟键盘可见性变化时网页布局的调整。">
    <link rel="canonical" href="https://www.w3.org/TR/virtual-keyboard/">
    <style>
        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            background: #fafafa
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #000
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #000;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
      "github": {
        "repoURL": "w3c/virtual-keyboard",
        "branch": "main"
      },
      "specStatus": "WD",
      "shortName": "virtual-keyboard",
      "editors": [
        {
          "name": "Anupam Snigdha",
          "mailto": "snianu@microsoft.com",
          "company": "Microsoft Corporation",
          "w3cid": 126950,
          "url": "mailto:snianu@microsoft.com"
        }
      ],
      "formerEditors": [
        {
          "name": "Grisha Lyukshin",
          "mailto": "glyuk@microsoft.com",
          "company": "Microsoft Corporation",
          "w3cid": 78883,
          "url": "mailto:glyuk@microsoft.com"
        }
      ],
      "wgPublicList": "public-editing-tf",
      "group": "webediting",
      "edDraftURI": "https://w3c.github.io/virtual-keyboard/",
      "previousPublishDate": "2021-09-28",
      "previousMaturity": "WD",
      "xref": [
        "WebIDL",
        "DOM",
        "HTML",
        "geometry-1"
      ],
      "publishDate": "2022-05-05",
      "publishISODate": "2022-05-05T00:00:00.000Z",
      "generatedSubtitle": "W3C Working Draft 05 May 2022"
    }</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL WebIDL DOM HTML geometry-1">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">虚拟键盘 API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C 工作草案</a> <time class="dt-published"
                datetime="2022-05-05">2022年5月5日</time></p>
        <details open="">
            <summary>更多关于此文档的详细信息</summary>
            <dl>
                <dt>此版本:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2022/WD-virtual-keyboard-20220505/">https://www.w3.org/TR/2022/WD-virtual-keyboard-20220505/</a>
                </dd>
                <dt>最新发布版本:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/virtual-keyboard/">https://www.w3.org/TR/virtual-keyboard/</a>
                </dd>
                <dt>最新编辑草案:</dt>
                <dd><a href="https://w3c.github.io/virtual-keyboard/">https://w3c.github.io/virtual-keyboard/</a></dd>
                <dt>历史:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/virtual-keyboard">https://www.w3.org/standards/history/virtual-keyboard</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/virtual-keyboard/commits/main">提交历史</a>
                </dd>

                <dt>编辑:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="126950">
                    <a class="ed_mailto u-email email p-name" href="mailto:snianu@microsoft.com">Anupam Snigdha</a>
                    (<span class="p-org org h-org">微软公司</span>)
                </dd>
                <dt>
                    前任编辑:
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="78883">
                    <a class="ed_mailto u-email email p-name" href="mailto:glyuk@microsoft.com">Grisha Lyukshin</a>
                    (<span class="p-org org h-org">微软公司</span>)
                </dd>

                <dt>反馈:</dt>
                <dd>
                    <a href="https://github.com/w3c/virtual-keyboard/">GitHub w3c/virtual-keyboard</a>
                    (<a href="https://github.com/w3c/virtual-keyboard/pulls/">拉取请求</a>,
                    <a href="https://github.com/w3c/virtual-keyboard/issues/new/choose">新问题</a>,
                    <a href="https://github.com/w3c/virtual-keyboard/issues/">开放问题</a>)
                </dd>
                <dd><a
                        href="mailto:public-editing-tf@w3.org?subject=%5Bvirtual-keyboard%5D%20YOUR%20TOPIC%20HERE">public-editing-tf@w3.org</a>
                    邮件主题 <kbd>[virtual-keyboard] <em>… 话题 …</em></kbd> (<a rel="discussion"
                        href="https://lists.w3.org/Archives/Public/public-editing-tf">档案</a>)</dd>
            </dl>
        </details>

        <p class="copyright">
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">版权</a>
            ©
            2022

            <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">麻省理工学院</abbr></a>,
            <a href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">欧洲信息与数学研究联盟</abbr></a>, <a
                href="https://www.keio.ac.jp/">庆应义塾大学</a>,
            <a href="https://ev.buaa.edu.cn/">北京航空航天大学</a>). W3C
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">责任声明</a>,
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">商标</a> 和
            <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document"
                title="W3C 软件与文档许可声明">许可文档</a> 规则适用。
        </p>
        <hr title="页眉分隔线">
    </div>

    <section id="abstract" class="introductory">
        <h2>摘要</h2>
        <p>
            <a data-link-type="idl" data-lt="VirtualKeyboard" href="#dom-virtualkeyboard" class="internalDFN"
                id="ref-for-dom-virtualkeyboard-1"><code>VirtualKeyboard</code></a> API 为开发者提供了更大的控制权，能够控制虚拟键盘 (VK)
            的可见性，并能够更好地适应虚拟键盘可见性变化时网页布局的调整。
        </p>
    </section>
    <section id="sotd" class="introductory">
        <h2>本文档状态</h2>
        <p><em>本节描述了本文档在发布时的状态。当前 <abbr title="World Wide Web Consortium">W3C</abbr> 出版物列表及本技术报告的最新修订版可在 <a
                    href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> 技术报告索引</a>找到，网址为
                https://www.w3.org/TR/。</em></p>
        <p>
        </p>
        <p>
            本文档由<a href="https://www.w3.org/groups/wg/webediting">Web 编辑工作组</a>发布为工作草案，使用了<a
                href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">推荐流程</a>。
        </p>
        <p>作为工作草案发布并不意味着 <abbr title="World Wide Web Consortium">W3C</abbr> 及其成员的认可。</p>
        <p>
            本文档是草案，可能会随时更新、替换或被其他文档取代。引用本文档作为工作进展之外的用途是不合适的。
        </p>
        <p>
            本文档由在 <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr
                    title="World Wide Web Consortium">W3C</abbr> 专利政策</a>下运作的小组生成。
            <abbr title="World Wide Web Consortium">W3C</abbr> 维护着与该小组交付成果相关的任何专利披露的<a rel="disclosure"
                href="https://www.w3.org/groups/wg/webediting/ipr">公开列表</a>；该页面还包括披露专利的说明。任何个人如果实际知晓其认为包含 <a
                href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">基本专利声明</a> 的专利，必须根据 <a
                href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C 专利政策第 6 节</a>披露相关信息。
        </p>
        <p>
            本文档受<a id="w3c_process_revision" href="https://www.w3.org/2021/Process-20211102/">2021年11月2日 <abbr
                    title="World Wide Web Consortium">W3C</abbr> 流程文档</a>管辖。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目录</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">摘要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">本文档状态</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>介绍</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>一致性</a></li>
            <li class="tocline"><a class="tocxref" href="#the-virtualkeyboard-interface"><bdi class="secno">3. </bdi>
                    <span data-export="" data-dfn-type="interface" data-idl="interface" data-title="VirtualKeyboard"
                        data-dfn-for=""><code>VirtualKeyboard</code></span> 接口</a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-elementcontenteditable-mixin"><bdi
                        class="secno">4. </bdi>扩展 <span data-idl="interface mixin" data-title="ElementContentEditable"
                        data-dfn-for=""><code>ElementContentEditable</code></span> 混入</a></li>
            <li class="tocline"><a class="tocxref"
                    href="#virtual-keyboard-visibility-change-css-environment-variables"><bdi class="secno">5. </bdi>
                    虚拟键盘可见性更改 CSS 环境变量
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#keyboard-inset-variables"><bdi class="secno">5.1
                            </bdi>键盘内边距变量</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#examples"><bdi class="secno">6. </bdi>示例</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#example-with-usage-of-vk-control-apis"><bdi
                                class="secno">6.1 </bdi>使用 VK 控制 API 的示例</a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#examples-with-usage-of-overlayscontent-and-geometry-event-as-a-result-of-vk-showing"><bdi
                                class="secno">6.2 </bdi>使用 overlaysContent 和几何事件的示例，因 VK 显示而触发</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#privacy-and-security-considerations"><bdi class="secno">7.
                    </bdi>隐私与安全注意事项</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#hide-and-show-methods"><bdi class="secno">7.1
                            </bdi><span data-link-type="idl" data-xref-type="method" data-link-for="VirtualKeyboard"
                                data-xref-for="VirtualKeyboard" data-lt="hide()"
                                class="formerLink"><code>hide</code></span><code>()</code> 和 <span data-link-type="idl"
                                data-xref-type="method" data-link-for="VirtualKeyboard" data-xref-for="VirtualKeyboard"
                                data-lt="show()" class="formerLink"><code>show</code></span><code>()</code> 方法</a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#boundingrect-overlayscontent-and-ongeometrychange-attributes"><bdi class="secno">7.2
                            </bdi><span data-link-type="idl" data-xref-type="attribute|dict-member|const"
                                data-link-for="VirtualKeyboard" data-xref-for="VirtualKeyboard"
                                class="formerLink"><code>boundingRect</code></span>, <span data-link-type="idl"
                                data-xref-type="attribute|dict-member|const" data-link-for="VirtualKeyboard"
                                data-xref-for="VirtualKeyboard" class="formerLink"><code>overlaysContent</code></span>
                            和 <span data-link-type="idl" data-xref-type="attribute|dict-member|const"
                                data-link-for="VirtualKeyboard" data-xref-for="VirtualKeyboard"
                                class="formerLink"><code>ongeometrychange</code></span> 属性</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#idl-index"><bdi class="secno">A. </bdi>IDL 索引</a></li>
            <li class="tocline"><a class="tocxref" href="#contributors"><bdi class="secno">B. </bdi>贡献者</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">C. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">C.1
                            </bdi>规范性引用</a></li>
                </ol>
            </li>
        </ol>
    </nav>

    <section id="introduction">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>介绍</h2><a class="self-link" href="#introduction"
                aria-label="第1节的永久链接"></a>
        </div>

        <p>本节是非规范性的。</p>
        <p>
            虚拟键盘 (VK) 是用于输入的屏幕键盘，适用于没有硬件键盘的场景。用户代理在以下情况下响应 VK 的存在，但不会将此信息暴露给 Web 开发者：
            1. 将用户代理重新定位到 VK 之上
            2. 减小布局视口的大小，以确保 VK 不会遮挡它
            3. 减小视觉视口的大小，并为布局视口增加内边距，以确保它可以移动到 VK 之上

            该 API 提供了第四个选项，允许用户代理保持其布局和视觉视口不变，而是提供 VK 和布局视口的交集信息，以便作者可以使用 JavaScript 或 CSS 环境变量调整其网页的布局。
        </p>
        <p>
            显示双屏设备上虚拟键盘的图像
            <img style="margin-left:auto; margin-right:auto; display: block;"
                src="https://www.w3.org/TR/virtual-keyboard/images/dual-screen-device.png" width="500" height="200"
                alt="显示双屏设备上虚拟键盘的图像">
        </p>

        <p>
            显示单触摸屏设备上虚拟键盘的图像
            <img style="margin-left:auto; margin-right:auto; display: block;"
                src="https://www.w3.org/TR/virtual-keyboard/images/single-touch-screen-device.png" width="500"
                height="200" alt="显示单触摸屏设备上虚拟键盘的图像">
        </p>
        <p></p>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x2-conformance"><bdi class="secno">2. </bdi>一致性</h2><a class="self-link" href="#conformance"
                aria-label="第2节的永久链接"></a>
        </div>
        <p>除了标记为非规范性的部分外，本规范中的所有创作指南、图表、示例和注释均为非规范性的。本规范中的其他所有内容均为规范性的。</p>
        <p>
            本文档中的关键字 <em class="rfc2119">必须</em> 和 <em class="rfc2119">不得</em> 应按照 <a
                href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119"
                    title="RFCs中用于指示要求级别的关键词">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio"
                    href="#bib-rfc8174" title="RFC 2119 关键词大小写模糊问题">RFC8174</a></cite>] 的描述进行解释，且仅在这些词汇以全大写形式出现时如此解释。
        </p>
        <p>
            本规范定义的合规性标准适用于单一产品：实现了其包含的接口的<dfn id="dfn-user-agent" tabindex="0" aria-haspopup="dialog"
                class="respec-offending-element" title="找到“用户代理”的定义，但没有链接到它。这通常是规范的错误！" data-dfn-type="dfn">用户代理</dfn>。
        </p>
        <p>
            以算法或特定步骤表述的合规性要求可以以任何方式实现，只要最终结果是等效的即可。（特别是，本规范中定义的算法旨在易于理解，而非为了高效运行。）
        </p>
    </section>
    <section data-dfn-for="VirtualKeyboard" id="the-virtualkeyboard-interface">
        <div class="header-wrapper">
            <h2 id="x3-the-virtualkeyboard-interface"><bdi class="secno">3. </bdi><dfn data-export=""
                    data-dfn-type="interface" id="dom-virtualkeyboard" data-idl="interface" data-title="VirtualKeyboard"
                    data-dfn-for="" tabindex="0" aria-haspopup="dialog"><code>VirtualKeyboard</code></dfn> 接口
            </h2><a class="self-link" href="#the-virtualkeyboard-interface" aria-label="第3节的永久链接"></a>
        </div>

        <pre class="idl def" id="webidl-65390189"><span class="idlHeader"><a class="self-link" href="#webidl-65390189">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-navigator-partial-1" data-title="Navigator">partial interface <a data-idl="partial" data-link-type="interface" data-title="Navigator" class="idlID" data-dfn-for="Navigator" data-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">Navigator</a> {<span data-idl="" class="idlAttribute" id="idl-def-navigator-virtualkeyboard" data-title="virtualKeyboard" data-dfn-for="Navigator">
        [<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject">SameObject</a></span>] readonly attribute<span class="idlType"> <a href="#dom-virtualkeyboard" class="internalDFN" data-link-type="idl" id="ref-for-dom-virtualkeyboard-2"><code>VirtualKeyboard</code></a></span> <dfn data-export="" data-dfn-type="attribute" id="dom-navigator-virtualkeyboard" data-idl="attribute" data-title="virtualKeyboard" data-dfn-for="Navigator" data-type="VirtualKeyboard" data-lt="virtualKeyboard" data-local-lt="Navigator.virtualKeyboard" class="idlName" tabindex="0" aria-haspopup="dialog"><code>virtualKeyboard</code></dfn>;</span>
    };</span><span data-idl="" class="idlInterface" id="idl-def-virtualkeyboard" data-title="VirtualKeyboard">
    
    [<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>]
    interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-virtualkeyboard" id="ref-for-dom-virtualkeyboard-3"><code>VirtualKeyboard</code></a> : <span class="idlSuperclass"><a data-type="interface" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a></span> {<span data-idl="" class="idlMethod" id="idl-def-virtualkeyboard-show" data-title="show" data-dfn-for="VirtualKeyboard"><span class="idlType">
        <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-virtualkeyboard-show" id="ref-for-dom-virtualkeyboard-show-1"><code>show</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-virtualkeyboard-hide" data-title="hide" data-dfn-for="VirtualKeyboard"><span class="idlType">
        <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-virtualkeyboard-hide" id="ref-for-dom-virtualkeyboard-hide-1"><code>hide</code></a>();</span><span data-idl="" class="idlAttribute" id="idl-def-virtualkeyboard-boundingrect" data-title="boundingRect" data-dfn-for="VirtualKeyboard">
        readonly attribute<span class="idlType"> <a data-type="interface" href="https://www.w3.org/TR/geometry-1/#domrect">DOMRect</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-boundingrect" id="ref-for-dom-virtualkeyboard-boundingrect-1"><code>boundingRect</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-virtualkeyboard-overlayscontent" data-title="overlaysContent" data-dfn-for="VirtualKeyboard">
        attribute<span class="idlType"> <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-overlayscontent" id="ref-for-dom-virtualkeyboard-overlayscontent-1"><code>overlaysContent</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-virtualkeyboard-ongeometrychange" data-title="ongeometrychange" data-dfn-for="VirtualKeyboard">
        attribute<span class="idlType"> <a data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-ongeometrychange" id="ref-for-dom-virtualkeyboard-ongeometrychange-1"><code>ongeometrychange</code></a>;</span>
    };</span></code></pre>
        <p>
            <a data-link-type="idl" data-lt="VirtualKeyboard" href="#dom-virtualkeyboard" class="internalDFN"
                id="ref-for-dom-virtualkeyboard-4"><code>VirtualKeyboard</code></a> 对象有以下关联属性：
        </p>
        <dfn data-export="" data-dfn-type="attribute" id="dom-virtualkeyboard-boundingrect" data-idl="attribute"
            data-title="boundingRect" data-dfn-for="VirtualKeyboard" data-type="DOMRect" data-lt="boundingRect"
            data-local-lt="VirtualKeyboard.boundingRect" tabindex="0"
            aria-haspopup="dialog"><code>boundingRect</code></dfn>
        <p>
            <a data-link-type="idl" data-lt="DOMRect" data-type="interface"
                href="https://www.w3.org/TR/geometry-1/#domrect"><code>DOMRect</code></a>，初始值为零。
        </p>
        <dfn data-export="" data-dfn-type="attribute" id="dom-virtualkeyboard-overlayscontent" data-idl="attribute"
            data-title="overlaysContent" data-dfn-for="VirtualKeyboard" data-type="boolean" data-lt="overlaysContent"
            data-local-lt="VirtualKeyboard.overlaysContent" tabindex="0"
            aria-haspopup="dialog"><code>overlaysContent</code></dfn>
        <p>
            一个布尔值，初始值为 <code>false</code>。当该属性设置为 <code>true</code> 时，用户代理<em class="rfc2119">不得</em>调整其<a
                data-link-type="dfn" data-type="dfn" href="https://dom.spec.whatwg.org/#concept-document">文档</a>的<a
                href="https://drafts.csswg.org/css2/#viewport">视口</a>或<a
                href="https://wicg.github.io/visual-viewport/#dom-visualviewport">视觉视口</a>的大小。
        </p>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-virtualkeyboard-show" data-idl="operation"
                    data-title="show()" data-dfn-for="VirtualKeyboard" data-type="undefined" data-lt="show()"
                    data-local-lt="VirtualKeyboard.show|VirtualKeyboard.show()|show" tabindex="0"
                    aria-haspopup="dialog"><code>show()</code></dfn> 方法
            </dt>
            <dd>
                <p>
                    该方法必须按照以下步骤执行：
                </p>
                <ol>
                    <li>
                        令 <var>window</var> 为 <a data-link-type="dfn" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> 的 <a data-link-type="dfn"
                            data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">相关全局对象</a>。断言
                        <var>window</var> 是 <a data-link-type="idl" data-lt="Window" data-type="interface"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        对象。
                    </li>
                    <li>
                        如果 <var>window</var> 没有 <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation">粘性激活</a>，则中止这些步骤。
                    </li>
                    <li>
                        如果焦点元素不是表单控件（例如 <a data-link-type="dfn" data-type="element"
                            href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a>
                        元素的值）或 <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#editing-host">编辑主机</a>（例如使用 <a
                            href="https://html.spec.whatwg.org/multipage/interaction.html#attr-contenteditable">contenteditable</a>）
                        ，则中止这些步骤。
                    </li>
                    <li>
                        如果 <a data-link-type="idl" href="#dom-elementcontenteditable-virtualkeyboardpolicy"
                            class="internalDFN"
                            id="ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-1"><code>virtualKeyboardPolicy</code></a>
                        不是 <a data-link-type="idl" data-lt="manual" href="#dfn-manual" class="internalDFN"
                            id="ref-for-dfn-manual-1"><code>manual</code></a> 或 <a
                            href="https://html.spec.whatwg.org/multipage/interaction.html#input-modalities:-the-inputmode-attribute">inputMode
                            的</a>
                        属性值为 <a
                            href="https://html.spec.whatwg.org/multipage/interaction.html#attr-inputmode-keyword-none">none</a>
                        ，则中止这些步骤。
                    </li>
                    <li>
                        调用系统 API 显示 VK。
                    </li>
                    <li>
                        <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">并行</a> 执行以下步骤：
                        <ol>
                            <li>等待系统显示虚拟键盘。</li>
                            <li>调用 <a data-link-type="idl" href="#dfn-set-the-virtual-keyboard-bounding-rect"
                                    class="internalDFN"
                                    id="ref-for-dfn-set-the-virtual-keyboard-bounding-rect-1"><code>设置虚拟键盘边界矩形</code></a>，
                                使用键盘的操作系统报告的边界矩形和<a data-link-type="dfn" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-document">文档</a>的
                                <a href="https://drafts.csswg.org/css2/#viewport">视口</a> 矩形。
                            </li>
                            <li><a data-link-type="dfn" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-event-fire">触发一个名为</a> "geometrychange"
                                的事件 <a data-link-type="dfn" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">在此</a>。
                            </li>
                        </ol>
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-virtualkeyboard-hide" data-idl="operation"
                    data-title="hide()" data-dfn-for="VirtualKeyboard" data-type="undefined" data-lt="hide()"
                    data-local-lt="VirtualKeyboard.hide|VirtualKeyboard.hide()|hide" tabindex="0"
                    aria-haspopup="dialog"><code>hide()</code></dfn> 方法
            </dt>
            <dd>
                <p>
                    该方法必须按照以下步骤执行：
                </p>
                <ol>
                    <li>
                        令 <var>window</var> 为 <a data-link-type="dfn" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> 的 <a data-link-type="dfn"
                            data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">相关全局对象</a>。断言
                        <var>window</var> 是 <a data-link-type="idl" data-lt="Window" data-type="interface"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        对象。
                    </li>
                    <li>
                        如果 <var>window</var> 没有 <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation">粘性激活</a>，则中止这些步骤。
                    </li>
                    <li>
                        如果焦点元素的 <a data-link-type="idl" href="#dom-elementcontenteditable-virtualkeyboardpolicy"
                            class="internalDFN"
                            id="ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-2"><code>virtualKeyboardPolicy</code></a>
                        不是 <a data-link-type="idl" data-lt="manual" href="#dfn-manual" class="internalDFN"
                            id="ref-for-dfn-manual-2"><code>manual</code></a> 或 <a
                            href="https://html.spec.whatwg.org/multipage/interaction.html#input-modalities:-the-inputmode-attribute">inputMode
                            的</a>
                        属性值为 <a
                            href="https://html.spec.whatwg.org/multipage/interaction.html#attr-inputmode-keyword-none">none</a>
                        ，则中止这些步骤。
                    </li>
                    <li>
                        调用系统 API 隐藏 VK。
                    </li>
                    <li>
                        <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">并行</a> 执行以下步骤：
                        <ol>
                            <li>等待系统隐藏虚拟键盘。</li>
                            <li>调用 <a data-link-type="idl" href="#dfn-set-the-virtual-keyboard-bounding-rect"
                                    class="internalDFN"
                                    id="ref-for-dfn-set-the-virtual-keyboard-bounding-rect-2"><code>设置虚拟键盘边界矩形</code></a>
                                ，使用键盘的操作系统报告的边界矩形（全为 0 值）和 <a data-link-type="dfn" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-document">文档</a> 的 <a
                                    href="https://drafts.csswg.org/css2/#viewport">视口</a> 矩形。
                            </li>
                            <li><a data-link-type="dfn" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-event-fire">触发一个名为</a> "geometrychange"
                                的事件 <a data-link-type="dfn" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">在此</a>。
                            </li>
                        </ol>
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID">
                    <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>注意</span></div>
                    <p class="">
                        平台启发式方法可能会对 VK 的<a data-link-type="idl" data-lt="show()" href="#dom-virtualkeyboard-show"
                            class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-show-2"><code>show</code></a><code>()</code> 和 <a
                            data-link-type="idl" data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-hide-2"><code>hide</code></a><code>()</code> 施加额外限制。例如，在
                        Windows 上，指针类型<em class="rfc2119">必须</em>为触摸或笔。
                    </p>
                </div>
                <div class="note" role="note" id="issue-container-generatedID-0">
                    <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>注意</span></div>
                    <p class="">
                        一些人对<a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/issues/415">显示担忧</a>，关于 <a
                            data-link-type="idl" data-lt="show()" href="#dom-virtualkeyboard-show" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-show-3"><code>show</code></a><code>()</code> 和 <a
                            data-link-type="idl" data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-hide-3"><code>hide</code></a><code>()</code> 方法不是基于 Promise
                        的，但我们认为 Web 开发者使用 <a data-link-type="idl" href="#dom-virtualkeyboard-ongeometrychange"
                            class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-ongeometrychange-2"><code>ongeometrychange</code></a>
                        事件的设计更好，因为它在 VK 可见性变化时触发，使返回值不必要。
                    </p>
                </div>
            </dd>
            <dt>
                <p><a data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-2"><code>overlaysContent</code></a></p>
            </dt>
            <dd>
                <p>
                    <a data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-3"><code>overlaysContent</code></a> getter 步骤为返回
                    <a data-link-type="dfn" data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> 的 <a
                        data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-4"><code>overlaysContent</code></a>。
                </p>
                <p>
                    <a data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-5"><code>overlaysContent</code></a> setter 步骤为将
                    <a data-link-type="dfn" data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> 的 <a
                        data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-6"><code>overlaysContent</code></a> 设置为给定值。
                </p>
            </dd>
            <dt>
                <p><a data-link-type="idl" href="#dom-virtualkeyboard-boundingrect" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-boundingrect-2"><code>boundingRect</code></a></p>
            </dt>
            <dd>
                <p>
                    该属性报告 VK 与<a data-link-type="dfn" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document">文档</a>的 <a
                        href="https://drafts.csswg.org/css2/#viewport">视口</a> 在客户端坐标中的交集。调用 <a data-link-type="idl"
                        href="#dfn-set-the-virtual-keyboard-bounding-rect" class="internalDFN"
                        id="ref-for-dfn-set-the-virtual-keyboard-bounding-rect-3"><code>设置虚拟键盘边界矩形</code></a>。
                </p>
                <p>
                </p>
                <p><dfn id="dfn-set-the-virtual-keyboard-bounding-rect" tabindex="0" aria-haspopup="dialog"
                        data-dfn-type="dfn">设置虚拟键盘边界矩形</dfn></p>
                设置虚拟键盘边界矩形，使用 <var>osk</var>（表示屏幕键盘矩形的 DOMRect）和 <var>lv</var>（表示 <a data-link-type="dfn"
                    data-type="dfn" href="https://dom.spec.whatwg.org/#concept-document">文档</a>的 <a
                    href="https://drafts.csswg.org/css2/#viewport">视口</a> 矩形的 DOMRect）作为输入，按以下步骤运行：
                <ol>
                    <li>
                        令 <var>osk</var> 为屏幕键盘矩形，运行算法后得到的结果是<a data-link-type="idl" data-lt="show()"
                            href="#dom-virtualkeyboard-show" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-show-4"><code>show</code></a><code>()</code> 或 <a
                            data-link-type="idl" data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-hide-4"><code>hide</code></a><code>()</code>。
                    </li>
                    <li>
                        令 <var>lv</var> 为运行算法后得到的<a data-link-type="dfn" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-document">文档</a>的 <a
                            href="https://drafts.csswg.org/css2/#viewport">视口</a>矩形<a data-link-type="idl"
                            data-lt="show()" href="#dom-virtualkeyboard-show" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-show-5"><code>show</code></a><code>()</code> 或 <a
                            data-link-type="idl" data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                            id="ref-for-dom-virtualkeyboard-hide-5"><code>hide</code></a><code>()</code>。
                    </li>
                    <li>
                        将 <var>osk</var> 映射到 <var>lv</var> 的坐标空间。
                    </li>
                    <li>
                        令 <var>bounds</var> 为 <a data-link-type="idl" data-lt="DOMRect" data-type="interface"
                            href="https://www.w3.org/TR/geometry-1/#domrect"><code>DOMRect</code></a> 对象。
                    </li>
                    <li>
                        通过将 <var>lv</var> 与 <var>osk</var> 相交来更新 <var>bounds</var>。
                    </li>
                    <li>
                        将 <var>bounds</var> 映射到 <var>lv</var> 的坐标空间。
                    </li>
                    <li>
                        返回 <var>bounds</var>。
                    </li>
                </ol>
                <p></p>
                <p></p>
                <p>
                    <a data-link-type="idl" href="#dom-virtualkeyboard-boundingrect" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-boundingrect-3"><code>boundingRect</code></a> getter 步骤为返回 <a
                        data-link-type="dfn" data-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> 的 <a
                        data-link-type="idl" href="#dom-virtualkeyboard-boundingrect" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-boundingrect-4"><code>boundingRect</code></a>。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-virtualkeyboard-ongeometrychange"
                    data-idl="attribute" data-title="ongeometrychange" data-dfn-for="VirtualKeyboard"
                    data-type="EventHandler" data-lt="ongeometrychange" data-local-lt="VirtualKeyboard.ongeometrychange"
                    tabindex="0" aria-haspopup="dialog"><code>ongeometrychange</code></dfn>
            </dt>
            <dd>
                <p>
                    当 VK 与<a data-link-type="dfn" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document">文档</a>的<a
                        href="https://drafts.csswg.org/css2/#viewport">视口</a>的交集发生变化时（例如，响应 VK 显示或隐藏或浏览器窗口重新定位），会调度该事件。
                </p>
            </dd>
        </dl>
    </section>

    <section data-dfn-for="ElementContentEditable" id="extensions-to-the-elementcontenteditable-mixin">
        <div class="header-wrapper">
            <h2 id="x4-extensions-to-the-elementcontenteditable-mixin"><bdi class="secno">4. </bdi>扩展 <dfn
                    id="dom-elementcontenteditable" data-idl="interface mixin" data-title="ElementContentEditable"
                    data-dfn-for="" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn"><code>ElementContentEditable</code></dfn> 混入
            </h2><a class="self-link" href="#extensions-to-the-elementcontenteditable-mixin" aria-label="第4节的永久链接"></a>
        </div>

        <pre class="idl def" id="webidl-958222361"><span class="idlHeader"><a class="self-link" href="#webidl-958222361">WebIDL</a></span><code><span data-idl="" class="idlInterface mixin" id="idl-def-elementcontenteditable-partial-1" data-title="ElementContentEditable"> partial interface mixin <a class="internalDFN idlID" data-link-type="interface" href="#dom-elementcontenteditable" id="ref-for-dom-elementcontenteditable-1"><code>ElementContentEditable</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-elementcontenteditable-virtualkeyboardpolicy" data-title="virtualKeyboardPolicy" data-dfn-for="ElementContentEditable">
         [<span class="extAttr"><a data-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">CEReactions</a></span>] attribute<span class="idlType"> <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-elementcontenteditable-virtualkeyboardpolicy" id="ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-3"><code>virtualKeyboardPolicy</code></a>;</span>
    };</span></code></pre>
        <div class="issue" id="issue-container-number-1">
            <div role="heading" class="issue-title marker" id="h-issue" aria-level="3"><span>问题 1</span></div>
            <p class="">
                添加 input 和 textarea 的处理。
            </p>
        </div>
        <p><dfn data-export="" data-dfn-type="attribute" id="dom-elementcontenteditable-virtualkeyboardpolicy"
                data-idl="attribute" data-title="virtualKeyboardPolicy" data-dfn-for="ElementContentEditable"
                data-type="DOMString" data-lt="virtualKeyboardPolicy"
                data-local-lt="ElementContentEditable.virtualKeyboardPolicy" tabindex="0"
                aria-haspopup="dialog"><code>virtualKeyboardPolicy</code></dfn> 是一个<a
                href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#enumerated-attribute">枚举属性</a>，其关键字包括
            <code>empty string</code>、<code>auto</code> 和
            <code>manual</code>。IDL 属性必须<a
                href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect">反映</a>同名的相应内容属性。
            当指定在内容可编辑的主机元素上时，<code>auto</code> 会使相应的可编辑元素在聚焦或点击时自动显示 VK，而 <code>manual</code>
            会将可编辑元素的焦点和点击与 VK 的当前状态分离——VK 保持原状。
            <br>
            除非从 <code>auto</code> 更改为 <code>empty string</code> 或反之，否则任何<a data-link-type="idl"
                href="#dom-elementcontenteditable-virtualkeyboardpolicy" class="internalDFN"
                id="ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-4"><code>virtualKeyboardPolicy</code></a>
            属性值的更改都会否定当前定义的行为。
        </p>
        <div class="issue" id="issue-container-number-2">
            <div role="heading" class="issue-title marker" id="h-issue-0" aria-level="3"><span>问题 2</span></div>
            <p class="">
                指定相对于事件（如焦点）的时序。
            </p>
        </div>
        <ul>
            <li>
                当设置 <dfn id="dfn-auto" tabindex="0" aria-haspopup="dialog" class="respec-offending-element"
                    title="找到了 &quot;auto&quot; 的定义，但没有链接到它。这通常是规范错误！" data-dfn-type="dfn">auto</dfn> 枚举属性时，VK 由浏览器处理。
            </li>
            <li>
                当设置 <dfn id="dfn-manual" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">manual</dfn>
                枚举属性时，它会阻止浏览器的默认 VK 处理，需要由脚本处理。
            </li>
            <li>
                当设置 <dfn id="dfn-empty-string" tabindex="0" aria-haspopup="dialog" class="respec-offending-element"
                    title="找到了 &quot;empty string&quot; 的定义，但没有链接到它。这通常是规范错误！" data-dfn-type="dfn">empty string</dfn>
                枚举属性时，VK 由浏览器处理。
            </li>
        </ul>
        <p></p>

    </section>
    <section id="virtual-keyboard-visibility-change-css-environment-variables">
        <div class="header-wrapper">
            <h2 id="x5-virtual-keyboard-visibility-change-css-environment-variables"><bdi class="secno">5. </bdi>
                虚拟键盘可见性变化的 CSS 环境变量
            </h2><a class="self-link" href="#virtual-keyboard-visibility-change-css-environment-variables"
                aria-label="第5节的永久链接"></a>
        </div>

        <p>
            <a data-link-type="idl" data-lt="VirtualKeyboard" href="#dom-virtualkeyboard" class="internalDFN"
                id="ref-for-dom-virtualkeyboard-5"><code>VirtualKeyboard</code></a> API 提议了六个新的 <a
                href="https://drafts.csswg.org/css-env-1/#environment">CSS 环境变量</a>，Web
            开发人员可以利用这些变量来计算虚拟键盘的大小，并以声明方式调整布局。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>注意</span></div>
            <p class="">
                这些 CSS 环境变量应添加到<a href="https://drafts.csswg.org/css-env-1/#env-function">CSS 环境变量规范</a>中。
            </p>
        </div>
        <section id="keyboard-inset-variables">
            <div class="header-wrapper">
                <h3 id="x5-1-keyboard-inset-variables"><bdi class="secno">5.1 </bdi>键盘内边距变量</h3><a class="self-link"
                    href="#keyboard-inset-variables" aria-label="第5.1节的永久链接"></a>
            </div>

            <table data-for="env()">
                <tbody>
                    <tr>
                        <th>名称
                        </th>
                        <th>值
                        </th>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-top" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-top&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-top</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-right" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-right&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-right</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-bottom" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-bottom&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-bottom</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-left" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-left&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-left</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-width" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-width&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-width</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                    <tr>
                        <td><dfn id="dfn-keyboard-inset-height" tabindex="0" aria-haspopup="dialog"
                                class="respec-offending-element"
                                title="找到了 &quot;keyboard-inset-height&quot; 的定义，但没有链接到它。这通常是规范错误！"
                                data-dfn-type="dfn">keyboard-inset-height</dfn>
                        </td>
                        <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> 长度</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <p>键盘内边距是六个<a
                    href="https://drafts.csswg.org/css-env-1/#environment">环境变量</a>，它们通过从视口边缘的顶部、右侧、底部和左侧定义一个矩形。如果未提供备用值，则键盘内边距的默认值为
                "0px"，否则会在<a data-link-type="idl" href="#dom-virtualkeyboard-boundingrect" class="internalDFN"
                    id="ref-for-dom-virtualkeyboard-boundingrect-5"><code>boundingRect</code></a> 值更改时更新。
                宽度和高度内边距是从剩余的内边距计算得出的，方便开发人员使用。
            </p>
        </section>
    </section>
    <section id="examples">
        <div class="header-wrapper">
            <h2 id="x6-examples"><bdi class="secno">6. </bdi>示例</h2><a class="self-link" href="#examples"
                aria-label="第6节的永久链接"></a>
        </div>

        <section id="example-with-usage-of-vk-control-apis">
            <div class="header-wrapper">
                <h3 id="x6-1-example-with-usage-of-vk-control-apis"><bdi class="secno">6.1 </bdi>使用 VK 控制 API 的示例</h3><a
                    class="self-link" href="#example-with-usage-of-vk-control-apis" aria-label="第6.1节的永久链接"></a>
            </div>

            <aside class="example" id="example-virtualkeyboardpolicy">
                <div class="marker">
                    <a class="self-link" href="#example-virtualkeyboardpolicy">示例<bdi> 1</bdi></a><span
                        class="example-title">: VirtualKeyboardPolicy</span>
                </div>
                <pre aria-busy="false"><code class="hljs xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">contenteditable</span> <span class="hljs-attr">virtualkeyboardpolicy</span>=<span class="hljs-string">"manual"</span> <span class="hljs-attr">inputmode</span>=<span class="hljs-string">"text"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"height:50px;width:300px;border:1px solid black;"</span><span class="hljs-attr">data-formula</span>=<span class="hljs-string">"12+30"</span>&gt;</span>42<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> div = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"div"</span>)
        div.addEventListener(<span class="hljs-string">"focusout"</span>, handleFocusOut)
        div.addEventListener(<span class="hljs-string">"dblclick"</span>, handleDblClick)
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleFocusOut</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">let</span> formula = parseIntoFormula(div.firstChild.data)
            div.setAttribute(<span class="hljs-string">"data-formula"</span>, formula)
            div.firstChild.data = evaluateFormula(formula)
        }
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleDblClick</span>(<span class="hljs-params">e</span>) </span>{
            div.firstChild.data = div.getAttribute(<span class="hljs-string">"data-formula"</span>)
    
            <span class="hljs-keyword">if</span> (e.pointerType == <span class="hljs-string">"touch"</span>) {
                navigator.virtualKeyboard.show()
            }
        }
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseIntoFormula</span>(<span class="hljs-params">text</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"12+30"</span>
        }
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evaluateFormula</span>(<span class="hljs-params">formula</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"42"</span>
        }
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleSuccessfulShow</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">// 处理 VK 显示成功</span>
        }
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleFailedShow</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">// 处理 VK 显示失败</span>
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    </code></pre>
            </aside>
        </section>
        <section id="examples-with-usage-of-overlayscontent-and-geometry-event-as-a-result-of-vk-showing">
            <div class="header-wrapper">
                <h3 id="x6-2-examples-with-usage-of-overlayscontent-and-geometry-event-as-a-result-of-vk-showing"><bdi
                        class="secno">6.2 </bdi>使用 overlaysContent 和 geometry 事件的示例</h3><a class="self-link"
                    href="#examples-with-usage-of-overlayscontent-and-geometry-event-as-a-result-of-vk-showing"
                    aria-label="第6.2节的永久链接"></a>
            </div>

            <aside class="example" id="example-repositioning-content-using-css-with-overlayscontent">
                <div class="marker">
                    <a class="self-link" href="#example-repositioning-content-using-css-with-overlayscontent">示例<bdi>
                            2</bdi></a><span class="example-title">: 使用 CSS 和 overlaysContent 重新定位内容</span>
                </div>
                <pre aria-busy="false"><code class="hljs xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-selector-tag">body</span> {
                <span class="hljs-attribute">display</span>: grid;
                <span class="hljs-attribute">margin</span>: <span class="hljs-number">8px</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vh</span> - <span class="hljs-number">16px</span>);
                grid-template:
                <span class="hljs-string">"messages"</span>  <span class="hljs-number">1</span>fr
                <span class="hljs-string">"input"</span>     auto
                <span class="hljs-string">"keyboard"</span>  <span class="hljs-built_in">env</span>(keyboard-inset-height, <span class="hljs-number">0px</span>);
            }
            <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=text]</span><span class="hljs-selector-pseudo">::placeholder</span> {
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
            }
            <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=text]</span> {
                <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
                <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid black;
                <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
                <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#86DBF6</span>;
                justify-self: center;
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messages"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"type..."</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"virtualKeyboard"</span> <span class="hljs-keyword">in</span> navigator) {
                navigator.virtualKeyboard.overlaysContent = <span class="hljs-literal">true</span>
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    </code></pre>
            </aside>
            <p>
                下图和标记表示基于画布的电子表格，当 VK 显示时重新定位活动单元格。<code>geometrychange</code> 事件会触发画布的重绘请求。然后绘制代码可以使用
                <code>boundingRect</code> 属性在正确的位置呈现活动单元格。
                <img style="margin-left:auto; margin-right:auto; display: block;"
                    src="https://www.w3.org/TR/virtual-keyboard/images/spreadsheet-example.svg" width="700" height="300"
                    alt="图示单触屏设备上的虚拟键盘">
            </p>
            <aside class="example" id="example-repositioning-content-using-javascript-geometrychange">
                <div class="marker">
                    <a class="self-link" href="#example-repositioning-content-using-javascript-geometrychange">示例<bdi>
                            3</bdi></a><span class="example-title">: 使用 JavaScript geometrychange 事件重新定位内容</span>
                </div>
                <pre aria-busy="false"><code class="hljs xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-selector-tag">body</span> {
                <span class="hljs-attribute">display</span>: grid;
                <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
                grid-template:
                <span class="hljs-string">"controls"</span> min-content
                <span class="hljs-string">"cells"</span>    <span class="hljs-number">1</span>fr;
            }
            <span class="hljs-selector-id">#controls</span> {
                <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
                <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#139CFF</span>;
            }
            <span class="hljs-selector-tag">canvas</span> {
                justify-self: stretch;
                <span class="hljs-attribute">align-self</span>: stretch;
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"controls"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
            navigator.virtualKeyboard.overlaysContent = <span class="hljs-literal">true</span>
    
            navigator.virtualKeyboard.addEventListener(<span class="hljs-string">"geometrychange"</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-comment">// 请求重绘画布，以便可以将活动单元格重新定位到虚拟键盘上方</span>
                requestAnimationFrame(paintCanvas)
            })
    
            <span class="hljs-function"><span class="hljs-title">paintCanvas</span>(<span class="hljs-params"></span>)</span> {
                <span class="hljs-keyword">let</span> keyboardRect = navigator.virtualKeyboard.boundingRect
                <span class="hljs-comment">// 在省略的代码中使用键盘矩形，以在适当的位置绘制单元格，同时考虑到键盘矩形以及用户可能执行的单元格区域的任何平移。</span>
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    </code></pre>
            </aside>
            下图表示一个地图应用程序，它在一个窗口区域显示地图，在另一个窗口区域显示搜索结果。
            使用有关<a
                href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Foldables/explainer.md">窗口分段</a>和媒体查询的提案，每当虚拟键盘出现在可折叠设备的左侧时，显示的搜索框将增加其下边距以保持可见。
            <img style="margin-left:auto; margin-right:auto; display: block;"
                src="https://www.w3.org/TR/virtual-keyboard/images/example.png" width="700" height="300"
                alt="图示单触屏设备上的虚拟键盘">
            <aside class="example" id="example-repositioning-content-on-foldable-devices-with-overlayscontent">
                <div class="marker">
                    <a class="self-link"
                        href="#example-repositioning-content-on-foldable-devices-with-overlayscontent">示例<bdi>
                            4</bdi></a><span class="example-title">: 在可折叠设备上使用 overlaysContent 重新定位内容</span>
                </div>
                <pre aria-busy="false"><code class="hljs xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">spanning</span>: single-fold-vertical) {
                <span class="hljs-selector-tag">body</span> {
                    <span class="hljs-attribute">display</span>: grid;
                    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
                    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
                    grid-template-<span class="hljs-attribute">columns</span>: <span class="hljs-built_in">env</span>(fold-left) <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vw</span> - <span class="hljs-built_in">env</span>(fold-right));
                    grid-<span class="hljs-attribute">column-gap</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">env</span>(fold-right) - <span class="hljs-built_in">env</span>(fold-left));
                }
                <span class="hljs-selector-class">.map</span> {
                    grid-column: <span class="hljs-number">1</span>;
                    grid-row: <span class="hljs-number">1</span>;
                }
                <span class="hljs-selector-class">.search-box</span> {
                <span class="hljs-comment">/* 与地图重叠到相同的网格列中 */</span>
                    grid-column: <span class="hljs-number">1</span>;
                    grid-row: <span class="hljs-number">1</span>;
    
                    <span class="hljs-comment">/* 将搜索框定位在单元格底部，居中 */</span>
                    <span class="hljs-attribute">align-self</span>: end;
    
                    <span class="hljs-comment">/* 键盘未在左屏显示时的边距 */</span>
                    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;
    
                    <span class="hljs-comment">/* 添加一些样式 */</span>
                    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
                    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
                    <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid black;
                    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
                    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#86DBF6</span>;
                }
                <span class="hljs-selector-class">.locations-list</span> {
                    grid-column: <span class="hljs-number">2</span>;
                    grid-row: <span class="hljs-number">1</span>;
                }
    
                <span class="hljs-keyword">@media</span> (env(keyboard-inset-right) &lt;= env(fold-left)) {
                <span class="hljs-comment">/* 键盘在左屏上，调整搜索框 */</span>
                    <span class="hljs-selector-class">.search-box</span> {
                        <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">20px</span> + <span class="hljs-built_in">env</span>(keyboard-inset-height));
                    }
                }
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-box"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"search"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"search..."</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"locations-list"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
            navigator.virtualKeyboard.overlaysContent = <span class="hljs-literal">true</span>
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    </code></pre>
            </aside>
        </section>
    </section>
    <section id="privacy-and-security-considerations">
        <div class="header-wrapper">
            <h2 id="x7-privacy-and-security-considerations"><bdi class="secno">7. </bdi>隐私和安全注意事项</h2><a
                class="self-link" href="#privacy-and-security-considerations" aria-label="第7节的永久链接"></a>
        </div>

        由于 VirtualKeyboard API 可能会泄露用户 VK 布局的某些方面，用户代理必须确保不向脚本暴露任何它尚未通过现有 API 获得的额外信息。

        为了减轻潜在的安全和隐私风险，浏览器应遵循以下最佳实践。
        <section id="hide-and-show-methods">
            <div class="header-wrapper">
                <h3 id="x7-1-hide-and-show-methods"><bdi class="secno">7.1 </bdi><a data-link-type="idl"
                        data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-hide-6"><code>hide</code></a><code>()</code> 和 <a
                        data-link-type="idl" data-lt="show()" href="#dom-virtualkeyboard-show" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-show-6"><code>show</code></a><code>()</code> 方法</h3><a
                    class="self-link" href="#hide-and-show-methods" aria-label="第7.1节的永久链接"></a>
            </div>


            <p>
            </p>
            <ul>
                <li>
                    用户代理<em class="rfc2119">必须</em>只允许在<a
                        href="https://w3c.github.io/webappsec-secure-contexts/">安全上下文</a>中调用<a data-link-type="idl"
                        data-lt="hide()" href="#dom-virtualkeyboard-hide" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-hide-7"><code>hide</code></a><code>()</code> 和 <a
                        data-link-type="idl" data-lt="show()" href="#dom-virtualkeyboard-show" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-show-7"><code>show</code></a><code>()</code> 方法。
                </li>
                <li>
                    用户代理<em class="rfc2119">必须</em>只允许在存在<a data-link-type="dfn" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation">粘性激活</a>时调用<a
                        data-link-type="idl" data-lt="show()" href="#dom-virtualkeyboard-show" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-show-8"><code>show</code></a><code>()</code>方法。
                </li>
            </ul>
            <p></p>
        </section>
        <section id="boundingrect-overlayscontent-and-ongeometrychange-attributes">
            <div class="header-wrapper">
                <h3 id="x7-2-boundingrect-overlayscontent-and-ongeometrychange-attributes"><bdi class="secno">7.2
                    </bdi><a data-link-type="idl" href="#dom-virtualkeyboard-boundingrect" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-boundingrect-6"><code>boundingRect</code></a>，<a
                        data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-overlayscontent-7"><code>overlaysContent</code></a> 和 <a
                        data-link-type="idl" href="#dom-virtualkeyboard-ongeometrychange" class="internalDFN"
                        id="ref-for-dom-virtualkeyboard-ongeometrychange-3"><code>ongeometrychange</code></a> 属性
                </h3><a class="self-link" href="#boundingrect-overlayscontent-and-ongeometrychange-attributes"
                    aria-label="第7.2节的永久链接"></a>
            </div>

            用户代理<em class="rfc2119">必须</em>仅允许在<a href="https://w3c.github.io/webappsec-secure-contexts/">安全</a>、<a
                data-link-type="dfn" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">顶级浏览上下文</a>中设置 <a
                data-link-type="idl" href="#dom-virtualkeyboard-overlayscontent" class="internalDFN"
                id="ref-for-dom-virtualkeyboard-overlayscontent-8"><code>overlaysContent</code></a>。
        </section>
    </section>

    <section id="idl-index" class="appendix">
        <div class="header-wrapper">
            <h2 id="a-idl-index"><bdi class="secno">A. </bdi>IDL 索引</h2><a class="self-link" href="#idl-index"
                aria-label="附录 A 的永久链接"></a>
        </div>

        <pre class="idl def" id="actual-idl-index"><span class="idlHeader"><a class="self-link" href="#actual-idl-index">WebIDL</a></span><code><span data-idl="" class="idlInterface" data-title="Navigator">partial interface <a data-idl="partial" data-link-type="interface" data-title="Navigator" class="idlID" data-dfn-for="Navigator" data-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">Navigator</a> {<span data-idl="" class="idlAttribute" data-title="virtualKeyboard" data-dfn-for="Navigator">
        [<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject">SameObject</a></span>] readonly attribute<span class="idlType"> <a href="#dom-virtualkeyboard" class="internalDFN" data-link-type="idl" id="ref-for-dom-virtualkeyboard-6"><code>VirtualKeyboard</code></a></span> <dfn data-export="" data-dfn-type="attribute" data-idl="attribute" data-title="virtualKeyboard" data-dfn-for="Navigator" data-type="VirtualKeyboard" data-lt="virtualKeyboard" data-local-lt="Navigator.virtualKeyboard" class="idlName"><code>virtualKeyboard</code></dfn>;</span>
    };</span><span data-idl="" class="idlInterface" data-title="VirtualKeyboard">
    
    [<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>]
    interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-virtualkeyboard" id="ref-for-dom-virtualkeyboard-7"><code>VirtualKeyboard</code></a> : <span class="idlSuperclass"><a data-type="interface" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a></span> {<span data-idl="" class="idlMethod" data-title="show" data-dfn-for="VirtualKeyboard"><span class="idlType">
        <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-virtualkeyboard-show" id="ref-for-dom-virtualkeyboard-show-9"><code>show</code></a>();</span><span data-idl="" class="idlMethod" data-title="hide" data-dfn-for="VirtualKeyboard"><span class="idlType">
        <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-virtualkeyboard-hide" id="ref-for-dom-virtualkeyboard-hide-8"><code>hide</code></a>();</span><span data-idl="" class="idlAttribute" data-title="boundingRect" data-dfn-for="VirtualKeyboard">
        readonly attribute<span class="idlType"> <a data-type="interface" href="https://www.w3.org/TR/geometry-1/#domrect">DOMRect</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-boundingrect" id="ref-for-dom-virtualkeyboard-boundingrect-7"><code>boundingRect</code></a>;</span><span data-idl="" class="idlAttribute" data-title="overlaysContent" data-dfn-for="VirtualKeyboard">
        attribute<span class="idlType"> <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-overlayscontent" id="ref-for-dom-virtualkeyboard-overlayscontent-9"><code>overlaysContent</code></a>;</span><span data-idl="" class="idlAttribute" data-title="ongeometrychange" data-dfn-for="VirtualKeyboard">
        attribute<span class="idlType"> <a data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-virtualkeyboard-ongeometrychange" id="ref-for-dom-virtualkeyboard-ongeometrychange-4"><code>ongeometrychange</code></a>;</span>
    };</span>
    
    <span data-idl="" class="idlInterface mixin" data-title="ElementContentEditable"> partial interface mixin <a class="internalDFN idlID" data-link-type="interface" href="#dom-elementcontenteditable" id="ref-for-dom-elementcontenteditable-2"><code>ElementContentEditable</code></a> {<span data-idl="" class="idlAttribute" data-title="virtualKeyboardPolicy" data-dfn-for="ElementContentEditable">
         [<span class="extAttr"><a data-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">CEReactions</a></span>] attribute<span class="idlType"> <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-elementcontenteditable-virtualkeyboardpolicy" id="ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-5"><code>virtualKeyboardPolicy</code></a>;</span>
    };</span></code></pre>
    </section>
    <section id="contributors">
        <div class="header-wrapper">
            <h2 id="b-contributors"><bdi class="secno">B. </bdi>贡献者</h2><a class="self-link" href="#contributors"
                aria-label="第 B 节的永久链接"></a>
        </div>

        <div class="note" id="issue-container-generatedID-2">
            <div role="heading" class="ednote-title marker" id="h-ednote" aria-level="3"><span>编辑者注</span>
            </div>
            <p class="">
                添加贡献者
            </p>
        </div>
    </section>




    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="c-references"><bdi class="secno">C. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="附录 C 的永久链接"></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="c-1-normative-references"><bdi class="secno">C.1 </bdi>规范性引用</h3><a class="self-link"
                    href="#normative-references" aria-label="附录 C.1 的永久链接"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. Anne van Kesteren. WHATWG.
                    现行标准. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-geometry-1">[geometry-1]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/geometry-1/"><cite>几何接口模块 第 1 级</cite></a>.
                    Simon Pieters; Chris Harrelson. W3C. 2018 年 12 月 4 日. W3C 候选推荐. URL: <a
                        href="https://www.w3.org/TR/geometry-1/">https://www.w3.org/TR/geometry-1/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. 现行标准. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-rfc2119">[RFC2119]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>在 RFC 中表示需求级别的关键词</cite></a>. S. Bradner.
                    IETF. 1997 年 3 月. 最佳当前实践. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
                </dd>
                <dt id="bib-rfc8174">[RFC8174]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>RFC 2119 关键字中大写与小写的歧义</cite></a>. B.
                    Leiba. IETF. 2017 年 5 月. 最佳当前实践. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
                </dd>
                <dt id="bib-webidl">[webidl]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. 现行标准. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="返回顶部">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-user-agent"
        aria-label="Links in this document to definition: user agent">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-user-agent"
                aria-label="Permalink for definition: user agent. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-virtualkeyboard"
        aria-label="Links in this document to definition: VirtualKeyboard">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard"
                aria-label="Permalink for definition: VirtualKeyboard. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-1" title="§ Abstract">§ Abstract</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-2" title="§ 3. The VirtualKeyboard Interface">§ 3. The
                    VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-3" title="Reference 2">(2)</a>
                <a href="#ref-for-dom-virtualkeyboard-4" title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-5"
                    title="§ 5. Virtual Keyboard Visibility Change CSS environment variables.">§ 5. Virtual Keyboard
                    Visibility Change CSS environment variables.</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-6" title="§ A. IDL Index">§ A. IDL Index</a> <a
                    href="#ref-for-dom-virtualkeyboard-7" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-navigator-virtualkeyboard"
        aria-label="Links in this document to definition: virtualKeyboard">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-navigator-virtualkeyboard"
                aria-label="Permalink for definition: virtualKeyboard. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-virtualkeyboard-boundingrect"
        aria-label="Links in this document to definition: boundingRect">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard-boundingrect"
                aria-label="Permalink for definition: boundingRect. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-boundingrect-1" title="§ 3. The VirtualKeyboard Interface">§
                    3.
                    The VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-boundingrect-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-virtualkeyboard-boundingrect-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-virtualkeyboard-boundingrect-4"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-boundingrect-5" title="§ 5.1 Keyboard inset variables">§ 5.1
                    Keyboard inset variables</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-boundingrect-6"
                    title="§ 7.2 boundingRect, overlaysContent and ongeometrychange attributes">§ 7.2 boundingRect,
                    overlaysContent and ongeometrychange attributes</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-boundingrect-7" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-virtualkeyboard-overlayscontent"
        aria-label="Links in this document to definition: overlaysContent">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard-overlayscontent"
                aria-label="Permalink for definition: overlaysContent. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-overlayscontent-1" title="§ 3. The VirtualKeyboard Interface">§ 3.
                    The VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-overlayscontent-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-virtualkeyboard-overlayscontent-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-virtualkeyboard-overlayscontent-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-virtualkeyboard-overlayscontent-5"
                    title="Reference 5">(5)</a> <a href="#ref-for-dom-virtualkeyboard-overlayscontent-6"
                    title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-overlayscontent-7"
                    title="§ 7.2 boundingRect, overlaysContent and ongeometrychange attributes">§ 7.2 boundingRect,
                    overlaysContent and ongeometrychange attributes</a> <a
                    href="#ref-for-dom-virtualkeyboard-overlayscontent-8" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-overlayscontent-9" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-virtualkeyboard-show"
        aria-label="Links in this document to definition: show()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard-show"
                aria-label="Permalink for definition: show(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-show-1" title="§ 3. The VirtualKeyboard Interface">§ 3. The
                    VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-show-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-virtualkeyboard-show-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-virtualkeyboard-show-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-virtualkeyboard-show-5"
                    title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-show-6" title="§ 7.1 hide() and show() methods">§ 7.1 hide()
                    and
                    show() methods</a> <a href="#ref-for-dom-virtualkeyboard-show-7" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-virtualkeyboard-show-8" title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-show-9" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-virtualkeyboard-hide"
        aria-label="Links in this document to definition: hide()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard-hide"
                aria-label="Permalink for definition: hide(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-hide-1" title="§ 3. The VirtualKeyboard Interface">§ 3. The
                    VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-hide-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-virtualkeyboard-hide-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-virtualkeyboard-hide-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-virtualkeyboard-hide-5"
                    title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-hide-6" title="§ 7.1 hide() and show() methods">§ 7.1 hide()
                    and
                    show() methods</a> <a href="#ref-for-dom-virtualkeyboard-hide-7" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-hide-8" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-set-the-virtual-keyboard-bounding-rect"
        aria-label="Links in this document to definition: set the virtual keyboard bounding rect">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-set-the-virtual-keyboard-bounding-rect"
                aria-label="Permalink for definition: set the virtual keyboard bounding rect. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-set-the-virtual-keyboard-bounding-rect-1"
                    title="§ 3. The VirtualKeyboard Interface">§ 3. The VirtualKeyboard Interface</a> <a
                    href="#ref-for-dfn-set-the-virtual-keyboard-bounding-rect-2" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-set-the-virtual-keyboard-bounding-rect-3" title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-virtualkeyboard-ongeometrychange"
        aria-label="Links in this document to definition: ongeometrychange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-virtualkeyboard-ongeometrychange"
                aria-label="Permalink for definition: ongeometrychange. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-65390189">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-ongeometrychange-1" title="§ 3. The VirtualKeyboard Interface">§
                    3. The VirtualKeyboard Interface</a> <a href="#ref-for-dom-virtualkeyboard-ongeometrychange-2"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-ongeometrychange-3"
                    title="§ 7.2 boundingRect, overlaysContent and ongeometrychange attributes">§ 7.2 boundingRect,
                    overlaysContent and ongeometrychange attributes</a>
            </li>
            <li>
                <a href="#ref-for-dom-virtualkeyboard-ongeometrychange-4" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-elementcontenteditable"
        aria-label="Links in this document to definition: ElementContentEditable">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-elementcontenteditable"
                aria-label="Permalink for definition: ElementContentEditable. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-elementcontenteditable-1"
                    title="§ 4. Extensions to the ElementContentEditable mixin">§ 4. Extensions to the
                    ElementContentEditable mixin</a>
            </li>
            <li>
                <a href="#ref-for-dom-elementcontenteditable-2" title="§ A. IDL Index">§ A. IDL Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-elementcontenteditable-virtualkeyboardpolicy"
        aria-label="Links in this document to definition: virtualKeyboardPolicy">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-elementcontenteditable-virtualkeyboardpolicy"
                aria-label="Permalink for definition: virtualKeyboardPolicy. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-958222361">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-1"
                    title="§ 3. The VirtualKeyboard Interface">§ 3. The VirtualKeyboard Interface</a> <a
                    href="#ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-3"
                    title="§ 4. Extensions to the ElementContentEditable mixin">§ 4. Extensions to the
                    ElementContentEditable mixin</a> <a
                    href="#ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-4" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-elementcontenteditable-virtualkeyboardpolicy-5" title="§ A. IDL Index">§ A.
                    IDL
                    Index</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-auto"
        aria-label="Links in this document to definition: auto">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-auto"
                aria-label="Permalink for definition: auto. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-manual"
        aria-label="Links in this document to definition: manual">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-manual"
                aria-label="Permalink for definition: manual. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-manual-1" title="§ 3. The VirtualKeyboard Interface">§ 3. The VirtualKeyboard
                    Interface</a> <a href="#ref-for-dfn-manual-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-empty-string"
        aria-label="Links in this document to definition: empty string">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-empty-string"
                aria-label="Permalink for definition: empty string. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-top"
        aria-label="Links in this document to definition: keyboard-inset-top">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-top"
                aria-label="Permalink for definition: keyboard-inset-top. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-right"
        aria-label="Links in this document to definition: keyboard-inset-right">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-right"
                aria-label="Permalink for definition: keyboard-inset-right. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-bottom"
        aria-label="Links in this document to definition: keyboard-inset-bottom">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-bottom"
                aria-label="Permalink for definition: keyboard-inset-bottom. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-left"
        aria-label="Links in this document to definition: keyboard-inset-left">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-left"
                aria-label="Permalink for definition: keyboard-inset-left. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-width"
        aria-label="Links in this document to definition: keyboard-inset-width">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-width"
                aria-label="Permalink for definition: keyboard-inset-width. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-keyboard-inset-height"
        aria-label="Links in this document to definition: keyboard-inset-height">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-keyboard-inset-height"
                aria-label="Permalink for definition: keyboard-inset-height. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="/dropdown.js"></script>
</body>

