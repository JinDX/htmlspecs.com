<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>页面生命周期</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
    <!-- <meta content="Bikeshed version 37b7e7e68, updated Fri May 27 15:08:11 2022 -0700" name="generator"> -->
    <link href="https://wicg.github.io/page-lifecycle/" rel="canonical">
    <!-- <meta content="5ea95470f9709bed5c01c91d1c5d4e03a40530e5" name="document-revision"> -->
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-colors */

        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <style>
        /* style-darkmode */

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
            }
        }

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">页面生命周期</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">社区组报告草案</a>，<time class="dt-updated"
                datetime="2022-06-09">2022年6月9日</time></p>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>此版本：
                <dd><a class="u-url"
                        href="https://wicg.github.io/page-lifecycle/">https://wicg.github.io/page-lifecycle/</a>
                <dt>议题跟踪：
                <dd><a href="https://github.com/wicg/page-lifecycle/issues/">GitHub</a>
                <dt class="editor">编辑：
                <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email"
                        href="mailto:shaseley@google.com">Scott Haseley</a> (<a class="p-org org"
                        href="https://google.com">Google</a>)
                <dt class="editor">前编辑：
                <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email"
                        href="mailto:panicker@google.com">Shubhie Panicker</a> (<a class="p-org org"
                        href="https://google.com">Google</a>)
                <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email"
                        href="mailto:d@domenic.me">Domenic Denicola</a> (<a class="p-org org"
                        href="https://google.com">Google</a>)
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 the Contributors to
            the Page Lifecycle Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform
                Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C
                Community Contributor License Agreement (CLA)</a>.
            A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>本文档定义了一个支持浏览器管理网页生命周期的 API。</p>
    </div>
    <div data-fill-with="at-risk"></div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文件状态</span>
    </h2>
    <div data-fill-with="status">
        <p> 本规范由 <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> 发布。
            它不是 W3C 标准，也不属于 W3C 标准轨道。

            请注意，根据 <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License
                Agreement (CLA)</a>
            有有限的选择退出权以及其它相关条件。

            了解更多 <a href="http://www.w3.org/community/">W3C Community and Business Groups</a> 信息。 </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#intro"><span class="secno">1</span> <span class="content">介绍</span></a>
            <li><a href="#sec-lifecycle-states"><span class="secno">2</span> <span class="content">页面生命周期状态</span></a>
            <li>
                <a href="#sec-api"><span class="secno">3</span> <span class="content">API</span></a>
                <ol class="toc">
                    <li><a href="#example"><span class="secno">3.1</span> <span class="content">用法示例</span></a>
                </ol>
            <li><a href="#feature-policies"><span class="secno">4</span> <span class="content">特性策略</span></a>
            <li>
                <a href="#sec-processing-model"><span class="secno">5</span> <span class="content">处理模型</span></a>
                <ol class="toc">
                    <li><a href="#worklets-workers"><span class="secno">5.1</span> <span class="content">对 worklet 和
                                worker 行为的修改</span></a>
                    <li>
                        <a href="#mod"><span class="secno">5.2</span> <span class="content">对 HTML 标准的修改</span></a>
                        <ol class="toc">
                            <li><a href="#html-bfcache-dfn"><span class="secno">5.2.1</span> <span
                                        class="content"><span>卸载文档</span>和<span>历史遍历</span></span></a>
                            <li><a href="#html-html-event-loop-definitions"><span class="secno">5.2.2</span> <span
                                        class="content"><span>事件循环：定义</span></span></a>
                            <li><a href="#html-event-loop"><span class="secno">5.2.3</span> <span
                                        class="content"><span>事件循环：处理模型</span></span></a>
                            <li><a href="#html-discarding"><span class="secno">5.2.4</span> <span
                                        class="content"><span>丢弃浏览上下文</span></span></a>
                            <li><a href="#html-initialize-doc"><span class="secno">5.2.5</span> <span
                                        class="content"><span>初始化文档</span></span></a>
                            <li><a href="#html-iframe-load"><span class="secno">5.2.6</span> <span
                                        class="content"><span>iframe 加载事件步骤</span></span></a>
                            <li><a href="#html-media-elements"><span class="secno">5.2.7</span> <span
                                        class="content"><code
                                            class="idl"><span>HTMLMediaElement</span></code></span></a>
                            <li><a href="#html-post-message"><span class="secno">5.2.8</span> <span
                                        class="content"><span>消息发送</span></span></a>
                        </ol>
                    <li>
                        <a href="#serviceworker-mod"><span class="secno">5.3</span> <span class="content">对 Service
                                Worker 标准的修改</span></a>
                        <ol class="toc">
                            <li>
                                <a href="#serviceworker-client-dfn"><span class="secno">5.3.1</span> <span
                                        class="content"><span><code>Client</code></span></span></a>
                                <ol class="toc">
                                    <li><a href="#service-worker-client-lifecycle-state"><span
                                                class="secno">5.3.1.1</span> <span class="content"><code
                                                    class="idl"><span>lifecycleState</span></code></span></a>
                                    <li><a href="#serviceworker-matchall-dfn"><span class="secno">5.3.1.2</span> <span
                                                class="content"><span><code>matchAll(options)</code></span></span></a>
                                    <li><a href="#serviceworker-openwindow-dfn"><span class="secno">5.3.1.3</span> <span
                                                class="content"><span><code>openWindow(url)</code></span></span></a>
                                </ol>
                            <li>
                                <a href="#serviceworker-algorithms-dfn"><span class="secno">5.3.2</span> <span
                                        class="content"><span>算法</span></span></a>
                                <ol class="toc">
                                    <li><a href="#get-client-lifecycle-state-algorithm"><span
                                                class="secno">5.3.2.1</span> <span class="content"><span>获取 Client
                                                    生命周期状态</span></span></a>
                                    <li><a href="#serviceworker-createclient-dfn"><span class="secno">5.3.2.2</span>
                                            <span class="content"><span>创建 Client</span></span></a>
                                    <li><a href="#serviceworker-createwindowclient-dfn"><span
                                                class="secno">5.3.2.3</span> <span class="content"><span>创建 Window
                                                    Client</span></span></a>
                                </ol>
                        </ol>
                    <li>
                        <a href="#page-lifecycle"><span class="secno">5.4</span> <span
                                class="content">页面生命周期处理模型</span></a>
                        <ol class="toc">
                            <li><a href="#frozenness-state"><span class="secno">5.4.1</span> <span
                                        class="content">冻结状态</span></a>
                            <li><a href="#changing-frozenness"><span class="secno">5.4.2</span> <span
                                        class="content">文档冻结性的变更</span></a>
                            <li><a href="#discarding"><span class="secno">5.4.3</span> <span
                                        class="content">丢弃</span></a>
                        </ol>
                </ol>
            <li><a href="#acknowledgements"><span class="secno">6</span> <span class="content">致谢</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档约定</span></a>
                    <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span
                                class="content">一致性算法</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">说明性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">介绍</span><a class="self-link" href="#intro"></a></h2>
        当有大量 Web 应用（以及标签页）运行时，关键资源如内存、CPU、电池、网络等很容易被过度占用，导致糟糕的终端用户体验。应用生命周期是现代操作系统管理资源的关键方式之一。
        <p>一个平台如要支持应用生命周期，需要：</p>
        <ul>
            <li data-md>
                <p>向开发者提供生命周期状态变更的信号</p>
            <li data-md>
                <p>提供兼容生命周期的 API，使关键能力在应用被后台运行或停止时仍能工作。</p>
        </ul>
        <p>本提案试图定义网页的生命周期，并增加必要的扩展，使 Web 应用能够响应用户代理常见的两个重要生命周期事件：</p>
        <ul>
            <li data-md>
                <p>标签页丢弃（节省内存）</p>
            <li data-md>
                <p>CPU 挂起（节省电池、数据、CPU）</p>
        </ul>
        <h2 class="heading settled" data-level="2" id="sec-lifecycle-states"><span class="secno">2. </span><span
                class="content">页面生命周期状态</span><a class="self-link" href="#sec-lifecycle-states"></a></h2>
        <p>本规范定义了网页生命周期，并增加扩展，使 Web 应用能够响应用户代理常见的两个重要生命周期事件：</p>
        <ul>
            <li data-md>
                <p>CPU 挂起（节省电池、数据、CPU）</p>
            <li data-md>
                <p>标签页丢弃（节省内存）</p>
        </ul>
        <p>本规范正式定义了两个新的生命周期状态以支持上述需求：</p>
        <ul>
            <li data-md>
                <p>冻结（Frozen）：用于 CPU 挂起的生命周期状态。表示已在 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>
                    的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
                        id="ref-for-concept-document-bc">浏览上下文</a>上调用了 <a data-link-type="dfn" href="#freeze-steps"
                        id="ref-for-freeze-steps">freeze steps</a> 算法。通常隐藏页面会被冻结以节约资源。</p>
            <li data-md>
                <p>丢弃（Discarded）：表示在 <code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>
                    的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
                        id="ref-for-concept-document-bc①">浏览上下文</a>上调用了 <a data-link-type="dfn" href="#discarded"
                        id="ref-for-discarded">discard</a> 算法。通常被冻结的 frame 会被移到丢弃状态以节约资源。</p>
        </ul>
        <p>TODO(panicker)：插入生命周期状态图</p>
        <h2 class="heading settled" data-level="3" id="sec-api"><span class="secno">3. </span><span
                class="content">API</span><a class="self-link" href="#sec-api"></a></h2>
        <p>页面生命周期涉及以下补充：</p>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②"><c- g>Document</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onfreeze" id="ref-for-dom-document-onfreeze"><c- g>onfreeze</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onresume" id="ref-for-dom-document-onresume"><c- g>onresume</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-document-wasdiscarded" id="ref-for-dom-document-wasdiscarded"><c- g>wasDiscarded</c-></a>;
};
</pre>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export
                id="dom-document-onfreeze"><code>onfreeze</code></dfn> 和 <dfn class="dfn-paneled idl-code"
                data-dfn-for="Document" data-dfn-type="attribute" data-export
                id="dom-document-onresume"><code>onresume</code></dfn> 属性是 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"
                id="ref-for-event-handler-idl-attributes">事件处理 IDL 属性</a>，分别用于 <code>freeze</code> 和 <code>resume</code>
            事件。</p>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export
                id="dom-document-wasdiscarded"><code>wasDiscarded</code></dfn> 属性的 getter 应返回该 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>
            的 <a data-link-type="dfn" href="#document-discarded" id="ref-for-document-discarded">discarded</a> 布尔值。</p>
        <p class="note" role="note"><span>注意：</span> 这些 API 添加在 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code>
            上，而不是 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code>，是为了与
            Page Visibility API 保持一致；我们预计这些 API 会与现有的 Page Visibility API 一起使用。<a data-link-type="biblio"
                href="#biblio-page-visibility">[PAGE-VISIBILITY]</a></p>
        <p class="note" role="note"><span>注意：</span> 此外 <a
                href="https://github.com/whatwg/html/issues/3378"><code>clientId</code> 和
                <code>discardedClientId</code></a> 将被添加到 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①">Window</a></code>，
            用于支持用户重新访问丢弃页面导致页面重新加载时恢复视图状态。我们预计这些属性会用于响应这些事件的代码。</p>
        <h3 class="heading settled" data-level="3.1" id="example"><span class="secno">3.1. </span><span
                class="content">用法示例</span><a class="self-link" href="#example"></a></h3>
        <p>冻结和恢复的处理示例：</p>
        <pre class="example highlight" id="example-edb6c132"><a class="self-link" href="#example-edb6c132"></a><c- a>const</c-> prepareForFreeze <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// 关闭所有打开的 IndexedDB 连接。</c->
  <c- c1>// 释放所有 Web 锁。</c->
  <c- c1>// 停止定时器或轮询。</c->
<c- p>};</c->

<c- a>const</c-> reInitializeApp <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// 恢复 IndexedDB 连接。</c->
  <c- c1>// 重新获取所需的 Web 锁。</c->
  <c- c1>// 重新启动定时器或轮询。</c->
<c- p>};</c->

document<c- p>.</c->addEventListener<c- p>(</c-><c- t>'freeze'</c-><c- p>,</c-> prepareForFreeze<c- p>);</c->
document<c- p>.</c->addEventListener<c- p>(</c-><c- t>'resume'</c-><c- p>,</c-> reInitializeApp<c- p>);</c->
</pre>
        <p>丢弃后恢复视图状态的示例：
            用户可能会为同一个应用和 URL 打开多个标签页。如果它们都在后台且都被丢弃，应用需要区分这两个标签页以恢复正确的状态。Window 上的 clientId 和 lastClientId 可用于此目的。</p>
        <pre class="example highlight" id="example-e35b9ec1"><a class="self-link" href="#example-e35b9ec1"></a><c- c1>// 将状态持久化到 IndexedDB，确保在记录中设置当前 self.clientId，</c->
<c- c1>// 这样如果标签页丢弃后需要重新加载，可以通过 getPersistedState() 检索。</c->
<c- a>const</c-> persistState <c- o>=</c-> <c- k>async</c-> <c- p>(</c->state<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> record <c- o>=</c-> <c- p>{...</c->state<c- p>,</c-> cliendId<c- o>:</c-> self<c- p>.</c->clientId<c- p>};</c->

  <c- c1>// 将 record 持久化到 IndexedDB 或 SessionStorage...</c->
<c- p>}</c->

<c- c1>// 根据传入的 clientId 从 IndexedDB 检索状态记录。</c->
<c- a>const</c-> getPersistedState <c- o>=</c-> <c- k>async</c-> <c- p>(</c->clientId<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// 在 IndexedDB 中查找记录...</c->
<c- p>};</c->

<c- c1>// 如果标签页之前被丢弃，通过 self.lastClientId 获取丢弃标签页的状态。</c->
<c- k>if</c-> <c- p>(</c->document<c- p>.</c->wasDiscarded<c- p>)</c-> <c- p>{</c->
  getPersistedState<c- p>(</c->self<c- p>.</c->lastClientId<c- p>);</c->
<c- p>}</c->
</pre>
        <h2 class="heading settled" data-level="4" id="feature-policies"><span class="secno">4. </span><span
                class="content">特性策略</span><a class="self-link" href="#feature-policies"></a></h2>
        控制<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context"
            id="ref-for-nested-browsing-context">嵌套浏览上下文</a>的执行状态对于<a data-link-type="dfn"
            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
            id="ref-for-concept-document-bc②">浏览上下文</a>来说有助于控制用户体验。应用可能希望当文档未<a data-link-type="dfn"
            href="https://html.spec.whatwg.org/multipage/rendering.html#being-rendered"
            id="ref-for-being-rendered">被渲染</a>或未与<a data-link-type="dfn"
            href="https://www.w3.org/TR/CSS2/visuren.html#viewport"
            id="ref-for-viewport">视口</a>相交时，所有嵌套浏览上下文（包括正在播放的视频、音频）都停止执行。停止所有执行可提升 CPU 利用率。为满足这些需求，定义了两个特性策略：
        <ul>
            <li data-md>
                <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                        id="execution-while-not-rendered"><code>execution-while-not-rendered</code></dfn>"，其<a
                        data-link-type="dfn"
                        href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist"
                        id="ref-for-default-allowlist">默认允许列表</a>为 <code>*</code>
                </p>
            <li data-md>
                <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                        id="execution-while-out-of-viewport"><code>execution-while-out-of-viewport</code></dfn>"，其<a
                        data-link-type="dfn"
                        href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist"
                        id="ref-for-default-allowlist①">默认允许列表</a>为 <code>*</code></p>
        </ul>
        <p>"<a data-link-type="dfn" href="#execution-while-not-rendered"
                id="ref-for-execution-while-not-rendered"><code>execution-while-not-rendered</code></a>" 策略控制对于 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context"
                id="ref-for-nested-browsing-context②">嵌套浏览上下文</a>，其 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container"
                id="ref-for-browsing-context-container">浏览上下文容器</a>未被 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/rendering.html#being-rendered"
                id="ref-for-being-rendered①">渲染</a>时是否应继续执行任务。</p>
        <p>"<a data-link-type="dfn" href="#execution-while-out-of-viewport"
                id="ref-for-execution-while-out-of-viewport"><code>execution-while-out-of-viewport</code></a>" 策略控制对于 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context"
                id="ref-for-nested-browsing-context③">嵌套浏览上下文</a>，其 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container"
                id="ref-for-browsing-context-container①">浏览上下文容器</a>未与 <a data-link-type="dfn"
                href="https://www.w3.org/TR/CSS2/visuren.html#viewport" id="ref-for-viewport①">视口</a>相交时是否应继续执行任务，根据 <a
                data-link-type="dfn" href="https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo"
                id="ref-for-calculate-intersection-rect-algo">计算目标元素与根的交集</a>。</p>
        <p><a href="#mod">§ 5.2 对 HTML 标准的修改</a>通过在满足如下条件时将文档（及其后代）置于 <a data-link-type="dfn" href="#frozen"
                id="ref-for-frozen②">冻结</a> 状态来实现上述功能：</p>
        <ul>
            <li data-md>
                <p>已运行 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#iframe-load-event-steps"
                        id="ref-for-iframe-load-event-steps">iframe 加载事件步骤</a>；</p>
            <li data-md>
                <p>该文档禁用了相关策略；</p>
            <li data-md>
                <p>满足相关策略条件（未渲染或滚动出视图）。</p>
        </ul>
        <p>如果不满足上述条件，则文档将处于 <a data-link-type="dfn" href="#unfrozen" id="ref-for-unfrozen">未冻结</a> 状态。</p>
        <pre class="example highlight" id="example-fa17f32b"><a class="self-link" href="#example-fa17f32b"></a><c- d>&lt;!-- iframe 在加载后会立即被冻结。 --></c->

<c- p>&lt;</c-><c- f>iframe</c-> <c- e>allow</c-><c- o>=</c-><c- s>"execution-while-not-rendered 'none'"</c->
  <c- e>src</c-><c- o>=</c-><c- s>"subframe.html"</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:none"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
</pre>
        <div class="algorithm" data-algorithm="update document frozenness steps">
            要为 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑤">Document</a></code>
            <var>document</var> 运行 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="update-document-frozenness-steps">更新文档冻结性步骤</dfn>：
            <ol>
                <li data-md>
                    <p>如果 <var>document</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
                            id="ref-for-concept-document-bc③">浏览上下文</a>不是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context"
                            id="ref-for-nested-browsing-context④">嵌套浏览上下文</a>，返回。</p>
                <li data-md>
                    <p>如果 <var>document</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/dom.html#current-document-readiness"
                            id="ref-for-current-document-readiness">readiness</a> 不为 "<code>complete</code>"，返回。</p>
                <li data-md>
                    <p>令 <var>element</var> 为 <var>document</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
                            id="ref-for-concept-document-bc④">浏览上下文</a>的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container"
                            id="ref-for-browsing-context-container②">浏览上下文容器</a>。</p>
                <li data-md>
                    <p>令 <var>frozenness</var> 为 false。</p>
                <li data-md>
                    <p>令 <var>auto resume media</var> 为 false。</p>
                <li data-md>
                    <p>如果 <var>document</var> 不被允许使用 "<a data-link-type="dfn" href="#execution-while-not-rendered"
                            id="ref-for-execution-while-not-rendered①"><code>execution-while-not-rendered</code></a>"
                        特性：</p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>element</var> 未被 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/rendering.html#being-rendered"
                                    id="ref-for-being-rendered②">渲染</a>，则设 <var>frozenness</var> 为 true。</p>
                    </ol>
                <li data-md>
                    <p>否则如果 <var>document</var> 不被允许使用 "<a data-link-type="dfn" href="#execution-while-out-of-viewport"
                            id="ref-for-execution-while-out-of-viewport①"><code>execution-while-out-of-viewport</code></a>"
                        特性：</p>
                    <ol>
                        <li data-md>
                            <p>如果 <var>element</var> 未与 <a data-link-type="dfn"
                                    href="https://www.w3.org/TR/CSS2/visuren.html#viewport"
                                    id="ref-for-viewport②">视口</a>相交（参见 <a data-link-type="dfn"
                                    href="https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo"
                                    id="ref-for-calculate-intersection-rect-algo①">计算目标元素与根的交集</a>），则设
                                <var>frozenness</var> 为 true，设 <var>auto resume media</var> 为 true。
                            </p>
                    </ol>
                <li data-md>
                    <p>如果 <var>frozenness</var> 不等于 <var>document</var> 的 <a data-link-type="dfn"
                            href="#document-frozenness" id="ref-for-document-frozenness">冻结性</a>状态，<a
                            data-link-type="dfn" href="#change-the-frozenness-of-a-document"
                            id="ref-for-change-the-frozenness-of-a-document">更改文档冻结性</a>，参数为
                        <var>document</var>、<var>frozenness</var> 和 <var>auto resume media</var>。
                    </p>
            </ol>
        </div>
        <h2 class="heading settled" data-level="5" id="sec-processing-model"><span class="secno">5. </span><span
                class="content">处理模型</span><a class="self-link" href="#sec-processing-model"></a></h2>
        <h3 class="heading settled" data-level="5.1" id="worklets-workers"><span class="secno">5.1. </span><span
                class="content">对 worklet 和 worker 行为的修改</span><a class="self-link" href="#worklets-workers"></a></h3>
        <p>任何 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#worklet-agent"
                id="ref-for-worklet-agent">worklet agent</a>，如果其唯一 <a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#sec-code-realms" id="ref-for-sec-code-realms">realm</a> 的 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global"
                id="ref-for-concept-realm-global">全局对象</a>的 <a data-link-type="dfn"
                href="https://drafts.css-houdini.org/worklets#workletglobalscope-owner-document"
                id="ref-for-workletglobalscope-owner-document">所属文档</a>被冻结，则该 agent 必须变为 <a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#sec-forward-progress" id="ref-for-sec-forward-progress">阻塞</a>状态。
            任何 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#dedicated-worker-agent"
                id="ref-for-dedicated-worker-agent">dedicated worker agent</a>，如果其唯一 <a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#sec-code-realms" id="ref-for-sec-code-realms①">realm</a> 的 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global"
                id="ref-for-concept-realm-global①">全局对象</a>的 <a data-link-type="dfn"
                href="#dedicatedworkerglobalscope-owning-document"
                id="ref-for-dedicatedworkerglobalscope-owning-document">所属文档</a>非空且被冻结，则该 agent 必须变为 <a
                data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-forward-progress"
                id="ref-for-sec-forward-progress①">阻塞</a>状态。</p>
        <div class="algorithm" data-algorithm="owning document" data-algorithm-for="DedicatedWorkerGlobalScope">
            要确定 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>
            <var>workerGlobalScope</var> 的 <dfn class="dfn-paneled" data-dfn-for="DedicatedWorkerGlobalScope"
                data-dfn-type="dfn" data-export id="dedicatedworkerglobalscope-owning-document">所属文档</dfn>：
            <ol>
                <li data-md>
                    <p>如果 <var>workerGlobalScope</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"
                            id="ref-for-concept-WorkerGlobalScope-owner-set">owner set</a> 仅包含一个 <code
                            class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑥">Document</a></code>
                        <var>document</var>，则返回 <var>document</var>。
                    </p>
                <li data-md>
                    <p>如果 <var>workerGlobalScope</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"
                            id="ref-for-concept-WorkerGlobalScope-owner-set①">owner set</a> 仅包含一个 <code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope①">DedicatedWorkerGlobalScope</a></code>
                        <var>parentWorkerGlobalScope</var>，则返回 <var>parentWorkerGlobalScope</var> 的 <a
                            data-link-type="dfn" href="#dedicatedworkerglobalscope-owning-document"
                            id="ref-for-dedicatedworkerglobalscope-owning-document①">所属文档</a>。
                    </p>
                <li data-md>
                    <p>返回 null。</p>
            </ol>
            <p class="note" role="note"><span>注意：</span> <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope②">DedicatedWorkerGlobalScope</a></code>
                的 <a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"
                    id="ref-for-concept-WorkerGlobalScope-owner-set②">owner set</a> 始终只有一个条目。
            </p>
        </div>
        <h3 class="heading settled" data-level="5.2" id="mod"><span class="secno">5.2. </span><span class="content">对
                HTML 标准的修改</span><a class="self-link" href="#mod"></a></h3>
        <h4 class="heading settled" data-level="5.2.1" id="html-bfcache-dfn"><span class="secno">5.2.1. </span><span
                class="content"><a
                    href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unloading-documents">卸载文档</a>和<a
                    href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-traversal">历史遍历</a></span><a
                class="self-link" href="#html-bfcache-dfn"></a></h4>
        <p>当文档进入或离开 <a href="https://webkit.org/blog/427/webkit-page-cache-i-the-basics/">bfcache（前进后退缓存）</a> 时，其 <a
                data-link-type="dfn" href="#document-frozenness" id="ref-for-document-frozenness①">冻结性</a>状态会分别变为 true 和
            false。</p>
        <ul>
            <li data-md>
                <p>在 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document"
                        id="ref-for-unload-a-document">卸载文档</a>算法中，Step #5 后，如果 <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#dom-pagetransitionevent-persisted" id="ref-for-dom-pagetransitionevent-persisted">persisted</a></code>
                    属性为 true（即进入 bfcache），则 <a data-link-type="dfn" href="#change-the-frozenness-of-a-document"
                        id="ref-for-change-the-frozenness-of-a-document①">更改文档冻结性</a>，参数为 <var>document</var> 和 true。
                </p>
            <li data-md>
                <p>在 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history"
                        id="ref-for-traverse-the-history">历史遍历</a>算法中，Step #4.6.4 前，如果 <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#dom-pagetransitionevent-persisted" id="ref-for-dom-pagetransitionevent-persisted①">persisted</a></code>
                    属性为 true（即离开 bfcache），则 <a data-link-type="dfn" href="#change-the-frozenness-of-a-document"
                        id="ref-for-change-the-frozenness-of-a-document②">更改文档冻结性</a>，参数为 <var>document</var> 和 false。
                </p>
        </ul>
        <h4 class="heading settled" data-level="5.2.2" id="html-html-event-loop-definitions"><span class="secno">5.2.2.
            </span><span class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">事件循环：定义</a></span><a
                class="self-link" href="#html-html-event-loop-definitions"></a></h4>
        <p>替换：任务（task）可运行条件为其文档为 null 或 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active"
                id="ref-for-fully-active">完全激活</a>。</p>
        <p>新条件：任务可运行条件为其文档为 null 或 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active"
                id="ref-for-fully-active①">完全激活</a>，并且 <a data-link-type="dfn" href="#unfrozen"
                id="ref-for-unfrozen①">未冻结</a>。</p>
        <h4 class="heading settled" data-level="5.2.3" id="html-event-loop"><span class="secno">5.2.3. </span><span
                class="content"><a
                    href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">事件循环：处理模型</a></span><a
                class="self-link" href="#html-event-loop"></a></h4>
        <p>在 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering"
                id="ref-for-update-the-rendering">更新渲染</a>步骤 #11 后，添加如下步骤：</p>
        <p>对 <var>docs</var> 中每个 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active"
                id="ref-for-fully-active②">完全激活</a>的 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑦">Document</a></code>
            <var>doc</var>，运行 <a data-link-type="dfn" href="#update-document-frozenness-steps"
                id="ref-for-update-document-frozenness-steps">更新文档冻结性步骤</a>，参数为 <var>doc</var>。
        </p>
        <h4 class="heading settled" data-level="5.2.4" id="html-discarding"><span class="secno">5.2.4. </span><span
                class="content"><a
                    href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">丢弃浏览上下文</a></span><a
                class="self-link" href="#html-discarding"></a></h4>
        <p>将“discard”（丢弃）概念（包括浏览上下文和文档）重命名为“destroy”（销毁）。这样可以将“discarded”（已丢弃）术语用于用户可见的 <code
                class="idl"><a data-link-type="idl" href="#dom-document-wasdiscarded" id="ref-for-dom-document-wasdiscarded①">wasDiscarded</a></code>
            属性。</p>
        <h4 class="heading settled" data-level="5.2.5" id="html-initialize-doc"><span class="secno">5.2.5. </span><span
                class="content"><a
                    href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object">初始化文档</a></span><a
                class="self-link" href="#html-initialize-doc"></a></h4>
        <p>在 Step #3 前添加：</p>
        <p>如果浏览上下文之前已<a data-link-type="dfn" href="#discarded" id="ref-for-discarded①">丢弃</a>，则将 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑧">Document</a></code>
            的 <a data-link-type="dfn" href="#document-discarded" id="ref-for-document-discarded①">discarded</a> 布尔值设为
            true。</p>
        <h4 class="heading settled" data-level="5.2.6" id="html-iframe-load"><span class="secno">5.2.6. </span><span
                class="content"><a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#iframe-load-event-steps"
                    id="ref-for-iframe-load-event-steps①">iframe 加载事件步骤</a></span><a class="self-link"
                href="#html-iframe-load"></a></h4>
        <p>在 Step #5 后添加：</p>
        <p>对 <var>child document</var> 运行 <a data-link-type="dfn" href="#update-document-frozenness-steps"
                id="ref-for-update-document-frozenness-steps①">更新文档冻结性步骤</a>。</p>
        <h4 class="heading settled" data-level="5.2.7" id="html-media-elements"><span class="secno">5.2.7. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement">HTMLMediaElement</a></code></span><a
                class="self-link" href="#html-media-elements"></a></h4>
        <p>每个 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement①">HTMLMediaElement</a></code>
            都有一个 <dfn class="dfn-paneled" data-dfn-for="HTMLMediaElement" data-dfn-type="dfn" data-noexport
                id="htmlmediaelement-resume-frozen-flag">resume frozen flag</dfn>，初始值为 false。</p>
        <h4 class="heading settled" data-level="5.2.8" id="html-post-message"><span class="secno">5.2.8. </span><span
                class="content"><a
                    href="https://html.spec.whatwg.org/multipage/web-messaging.html#posting-messages">消息发送</a></span><a
                class="self-link" href="#html-post-message"></a></h4>
        <p>添加备注：</p>
        <p class="note" role="note"><span>注意：</span> 当向被冻结的 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window②">Window</a></code>
            发送消息时，<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/web-messaging.html#posted-message-task-source"
                id="ref-for-posted-message-task-source">消息任务源</a>上排队的事件不会运行，直到该 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window③">Window</a></code>
            被<a data-link-type="dfn" href="#unfrozen" id="ref-for-unfrozen②">解冻</a>。如果事件队列过多，用户代理可能会 <a
                data-link-type="dfn" href="#discarded" id="ref-for-discarded②">丢弃</a>该 <code
                class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window④">Window</a></code>
            的 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc"
                id="ref-for-window-bc">浏览上下文</a>（作为资源压力下允许丢弃的一部分）。</p>
        <h3 class="heading settled" data-level="5.3" id="serviceworker-mod"><span class="secno">5.3. </span><span
                class="content">对 Service Worker 标准的修改</span><a class="self-link" href="#serviceworker-mod"></a></h3>
        <h4 class="heading settled" data-level="5.3.1" id="serviceworker-client-dfn"><span class="secno">5.3.1.
            </span><span class="content"><a
                    href="https://w3c.github.io/ServiceWorker/#client-interface"><code>Client</code></a></span><a
                class="self-link" href="#serviceworker-client-dfn"></a></h4>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/ServiceWorker/#client" id="ref-for-client"><c- g>Client</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-clientlifecyclestate" id="ref-for-enumdef-clientlifecyclestate"><c- n>ClientLifecycleState</c-></a> <dfn class="idl-code" data-dfn-for="Client" data-dfn-type="attribute" data-export data-readonly data-type="ClientLifecycleState" id="dom-client-lifecyclestate"><code><c- g>lifecycleState</c-></code><a class="self-link" href="#dom-client-lifecyclestate"></a></dfn>;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-clientlifecyclestate"><code><c- g>ClientLifecycleState</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="ClientLifecycleState" data-dfn-type="enum-value" data-export id="dom-clientlifecyclestate-active"><code><c- s>"active"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="ClientLifecycleState" data-dfn-type="enum-value" data-export id="dom-clientlifecyclestate-frozen"><code><c- s>"frozen"</c-></code></dfn>
};
</pre>
        <p><code
                class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#client" id="ref-for-client①">Client</a></code>
            对象有一个关联的 <dfn class="dfn-paneled" data-dfn-for="Client" data-dfn-type="dfn" data-noexport
                id="dfn-service-worker-client-lifecycle-state">生命周期状态</dfn>，该状态是 <code
                class="idl"><a data-link-type="idl" href="#enumdef-clientlifecyclestate" id="ref-for-enumdef-clientlifecyclestate①">ClientLifecycleState</a></code>
            枚举值之一。</p>
        <h5 class="heading settled" data-level="5.3.1.1" id="service-worker-client-lifecycle-state"><span
                class="secno">5.3.1.1. </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-serviceworkerclient-lifecyclestate" id="ref-for-dom-serviceworkerclient-lifecyclestate">lifecycleState</a></code></span><a
                class="self-link" href="#service-worker-client-lifecycle-state"></a></h5>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerClient" data-dfn-type="attribute" data-export
                id="dom-serviceworkerclient-lifecyclestate"><code>lifecycleState</code></dfn> 的 getter 步骤为返回 <a
                data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a> 的 <a
                data-link-type="dfn" href="#dfn-service-worker-client-lifecycle-state"
                id="ref-for-dfn-service-worker-client-lifecycle-state">生命周期状态</a>。</p>
        <h5 class="heading settled" data-level="5.3.1.2" id="serviceworker-matchall-dfn"><span class="secno">5.3.1.2.
            </span><span class="content"><a
                    href="https://w3c.github.io/ServiceWorker/#clients-matchall"><code>matchAll(options)</code></a></span><a
                class="self-link" href="#serviceworker-matchall-dfn"></a></h5>
        <p>重命名第4步中的变量。</p>
        <ol>
            <li data-md>
                <p>令 <var>matchedClientData</var> 为一个新的 <a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list" id="ref-for-list">列表</a>。</p>
        </ol>
        <p>在第2.5.1步之前插入</p>
        <ol>
            <li data-md>
                <p>令 <var>lifecycleState</var> 为用 <var>client</var> 运行 <a data-link-type="dfn"
                        href="#get-client-lifecycle-state" id="ref-for-get-client-lifecycle-state">获取 Client 生命周期状态</a>
                    的结果。</p>
        </ol>
        <p>在第5.3.1步将 lifecycleState 添加到列表</p>
        <ol>
            <li data-md>
                <p>令 <var>windowData</var> 为 «[ "client" → <var>client</var>, "ancestorOriginsList" → 新的 <a
                        data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">列表</a>,
                    "lifecycleState" → <var>lifecycleState</var> ]»。</p>
        </ol>
        <p>在第5.4步将 lifecycleState 添加到 matchedClientData</p>
        <ol>
            <li data-md>
                <p>将 «[ "client" → <var>client</var>, "lifecycleState" → <var>lifecycleState</var> ]» 添加到
                    <var>matchedClientData</var>。
                </p>
        </ol>
        <p>在第6.2步将 windowData 的 lifecycleState 传入 Create Window Client 算法</p>
        <ol>
            <li data-md>
                <p>令 <var>windowClient</var> 为用
                    <var>windowData</var>["<code>client</code>"]、<var>windowData</var>["<code>frameType</code>"]、<var>windowData</var>["<code>visibilityState</code>"]、<var>windowData</var>["<code>focusState</code>"]、<var>windowData</var>["<code>ancestorOriginsList</code>"]
                    和 <var>windowData</var>["<code>lifecycleState</code>"] 作为参数运行 <a data-link-type="dfn"
                        href="https://w3c.github.io/ServiceWorker/#create-windowclient-algorithm"
                        id="ref-for-create-windowclient-algorithm">Create Window Client</a> 算法的结果。
                </p>
        </ol>
        <p>调整第6.3步</p>
        <ol>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                        id="ref-for-list-iterate">遍历</a> <var>matchedClientData</var> 中的每个 <var>clientData</var>：</p>
                <ol>
                    <li data-md>
                        <p>令 <var>clientObject</var> 为用 <var>clientData</var>["<code>client</code>"] 和
                            <var>clientData</var>["<code>lifecycleState</code>"] 作为参数运行 <a data-link-type="dfn"
                                href="https://w3c.github.io/ServiceWorker/#create-client-algorithm"
                                id="ref-for-create-client-algorithm">Create Client</a> 算法的结果。
                        </p>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                id="ref-for-list-append">追加</a> <var>clientObject</var> 到 <var>clientObjects</var>。</p>
                </ol>
        </ol>
        <h5 class="heading settled" data-level="5.3.1.3" id="serviceworker-openwindow-dfn"><span class="secno">5.3.1.3.
            </span><span class="content"><a
                    href="https://w3c.github.io/ServiceWorker/#dom-clients-openwindow"><code>openWindow(url)</code></a></span><a
                class="self-link" href="#serviceworker-openwindow-dfn"></a></h5>
        <p>在第7.5步之前插入</p>
        <ol>
            <li data-md>
                <p>令 <var>lifecycleState</var> 为用 <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                        id="ref-for-this①">this</a> 的关联 <a data-link-type="dfn"
                        href="https://w3c.github.io/ServiceWorker/#dfn-service-worker-client"
                        id="ref-for-dfn-service-worker-client">service worker client</a> 运行 <a data-link-type="dfn"
                        href="#get-client-lifecycle-state" id="ref-for-get-client-lifecycle-state①">获取 Client 生命周期状态</a>
                    的结果。</p>
        </ol>
        <p>调整第7.8.2步以提供 lifecycleState</p>
        <ol>
            <li data-md>
                <p>令 <var>client</var> 为用 <var>newContext</var> 的 <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑤">Window</a></code>
                    对象的 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                        id="ref-for-environment-settings-object">环境设置对象</a>、<var>frameType</var>、<var>visibilityState</var>、<var>focusState</var>、<var>ancestorOriginsList</var>
                    和 <var>lifecycleState</var> 作为参数运行 <a data-link-type="dfn"
                        href="https://w3c.github.io/ServiceWorker/#create-windowclient-algorithm"
                        id="ref-for-create-windowclient-algorithm①">Create Window Client</a> 的结果。</p>
        </ol>
        <h4 class="heading settled" data-level="5.3.2" id="serviceworker-algorithms-dfn"><span class="secno">5.3.2.
            </span><span class="content"><a href="https://w3c.github.io/ServiceWorker/#algorithms">算法</a></span><a
                class="self-link" href="#serviceworker-algorithms-dfn"></a></h4>
        <section class="algorithm" data-algorithm="Get Client Lifecycle State">
            <h5 class="heading settled" data-level="5.3.2.1" id="get-client-lifecycle-state-algorithm"><span
                    class="secno">5.3.2.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn"
                        data-noexport id="get-client-lifecycle-state">获取 Client 生命周期状态</dfn></span><a class="self-link"
                    href="#get-client-lifecycle-state-algorithm"></a></h5>
            <p>附加如下算法：</p>
            <dl>
                <dt data-md>输入
                <dd data-md>
                    <p><var>client</var>，一个 <a data-link-type="dfn"
                            href="https://w3c.github.io/ServiceWorker/#dfn-service-worker-client"
                            id="ref-for-dfn-service-worker-client①">service worker client</a></p>
                <dt data-md>输出
                <dd data-md>
                    <p><var>state</var>，一个字符串</p>
            </dl>
            <ol>
                <li data-md>
                    <p>令 <var>state</var> 为 <code
                            class="idl"><a data-link-type="idl" href="#dom-clientlifecyclestate-active" id="ref-for-dom-clientlifecyclestate-active">"active"</a></code>。
                    </p>
                <li data-md>
                    <p>如果 <var>client</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"
                            id="ref-for-concept-settings-object-global">全局对象</a>的 <a data-link-type="dfn"
                            href="#dedicatedworkerglobalscope-owning-document"
                            id="ref-for-dedicatedworkerglobalscope-owning-document②">所属文档</a>被冻结，则将 <var>state</var> 设为
                        <code
                            class="idl"><a data-link-type="idl" href="#dom-clientlifecyclestate-frozen" id="ref-for-dom-clientlifecyclestate-frozen">"frozen"</a></code>。
                    </p>
                <li data-md>
                    <p>返回 <var>state</var>。</p>
            </ol>
        </section>
        <section class="algorithm" data-algorithm="create-client-monkeypatch">
            <h5 class="heading settled" data-level="5.3.2.2" id="serviceworker-createclient-dfn"><span
                    class="secno">5.3.2.2. </span><span class="content"><a
                        href="https://w3c.github.io/ServiceWorker/#create-client-algorithm"
                        id="termref-for-create-client-algorithm">创建 Client</a></span><a class="self-link"
                    href="#serviceworker-createclient-dfn"></a></h5>
            <p>在输入参数后追加 <var>lifecycleState</var>，一个字符串</p>
            <p>在输出第2步后追加：</p>
            <ol>
                <li data-md>
                    <p>将 <var>clientObject</var> 的 <a data-link-type="dfn"
                            href="#dfn-service-worker-client-lifecycle-state"
                            id="ref-for-dfn-service-worker-client-lifecycle-state①">生命周期状态</a>设为
                        <var>lifecycleState</var>。
                    </p>
            </ol>
        </section>
        <section class="algorithm" data-algorithm="create-window-client-monkeypatch">
            <h5 class="heading settled" data-level="5.3.2.3" id="serviceworker-createwindowclient-dfn"><span
                    class="secno">5.3.2.3. </span><span class="content"><a
                        href="https://w3c.github.io/ServiceWorker/#create-windowclient-algorithm"
                        id="termref-for-create-windowclient-algorithm">创建 Window Client</a></span><a class="self-link"
                    href="#serviceworker-createwindowclient-dfn"></a></h5>
            <p>在输入参数后追加 <var>lifecycleState</var>，一个字符串</p>
            <p>在输出第5步后追加：</p>
            <ol>
                <li data-md>
                    <p>将 <var>windowClient</var> 的 <a data-link-type="dfn"
                            href="#dfn-service-worker-client-lifecycle-state"
                            id="ref-for-dfn-service-worker-client-lifecycle-state②">生命周期状态</a>设为
                        <var>lifecycleState</var>。
                    </p>
            </ol>
        </section>
        <h3 class="heading settled" data-level="5.4" id="page-lifecycle"><span class="secno">5.4. </span><span
                class="content">页面生命周期处理模型</span><a class="self-link" href="#page-lifecycle"></a>
        </h3>
        <h4 class="heading settled" data-level="5.4.1" id="frozenness-state"><span class="secno">5.4.1. </span><span
                class="content">冻结状态（FROZENNESS）</span><a class="self-link" href="#frozenness-state"></a></h4>
        一个文档可以处于以下 <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport
            id="document-frozenness">冻结性（FROZENNESS）</dfn> 状态之一：
        <ul>
            <li data-md>
                <p>true：文档处于 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="frozen">冻结</dfn>
                    状态，与该文档关联的所有任务都不会运行</p>
            <li data-md>
                <p>false：文档处于 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="unfrozen">未冻结</dfn>
                    状态，与该文档关联的任务会正常运行</p>
                <p class="note" role="note"><span>注意：</span> 根据 <a data-link-type="dfn"
                        href="#change-the-frozenness-of-a-top-level-document"
                        id="ref-for-change-the-frozenness-of-a-top-level-document">更改顶级文档冻结性</a>算法，当顶级浏览上下文的 Document
                    更改其 <a data-link-type="dfn" href="#document-frozenness"
                        id="ref-for-document-frozenness②">冻结性</a>状态时，其所有子浏览上下文的文档也会更改冻结性（与顶级一致）。</p>
        </ul>
        <p>UA 在某些情况下可能会用 true 执行 <a data-link-type="dfn" href="#change-the-frozenness-of-a-top-level-document"
                id="ref-for-change-the-frozenness-of-a-top-level-document①">更改顶级文档冻结性</a>算法。例如，当顶级浏览上下文处于后台或隐藏状态且宽限期已过时，UA
            可用 true 执行该算法以节省资源并保证前台体验质量。具体例子：</p>
        <ul>
            <li data-md>
                <p>在移动端 Chrome 中，后台至少5分钟的标签页可能会被 <a data-link-type="dfn" href="#frozen"
                        id="ref-for-frozen⑦">冻结</a>，以节约电池和数据。</p>
            <li data-md>
                <p>在桌面端 Chrome 中，长时间未使用且对用户不重要的后台标签页可能会被 <a data-link-type="dfn" href="#discarded"
                        id="ref-for-discarded③">丢弃</a>，以节省内存</p>
                <p class="note" role="note"><span>注意：</span> 用户正在使用的后台标签页（如正在播放音频）通常不会被 <a data-link-type="dfn"
                        href="#frozen" id="ref-for-frozen⑧">冻结</a>或 <a data-link-type="dfn" href="#discarded"
                        id="ref-for-discarded④">丢弃</a>。</p>
                <p class="note" role="note"><span>注意：</span> Chrome 使用的具体启发式与排除列表详见 <a
                        href="https://docs.google.com/document/d/1QJpuBTdllLVflMJSov0tlFX3e3yfSfd_-al2IBavbQM/edit">此文档</a>。
                </p>
        </ul>
        <p>当用户重新访问该浏览上下文时，UA 通常会用 false 执行 <a data-link-type="dfn" href="#change-the-frozenness-of-a-top-level-document"
                id="ref-for-change-the-frozenness-of-a-top-level-document③">更改顶级文档冻结性</a>。此外，当资源充足时，UA 还可在后台周期性地用 false
            执行该算法。</p>
        <h4 class="heading settled" data-level="5.4.2" id="changing-frozenness"><span class="secno">5.4.2. </span><span
                class="content">文档冻结性的变更</span><a class="self-link" href="#changing-frozenness"></a></h4>
        <div class="algorithm" data-algorithm="change the frozenness of a top-level document">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="change-the-frozenness-of-a-top-level-document">更改顶级文档冻结性</dfn>，给定 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑨">Document</a></code>
            <var>topLevelDoc</var> 和布尔型 <a data-link-type="dfn" href="#document-frozenness"
                id="ref-for-document-frozenness④">冻结性</a>状态 <var>frozenness</var>：
            <ol>
                <li data-md>
                    <p class="assertion">断言：<var>doc</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc"
                            id="ref-for-concept-document-bc⑤">浏览上下文</a>是 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context"
                            id="ref-for-top-level-browsing-context">顶级浏览上下文</a>。</p>
                <li data-md>
                    <p>用 <var>topLevelDoc</var>、<var>frozenness</var> 和 false 执行 <a data-link-type="dfn"
                            href="#change-the-frozenness-of-a-document"
                            id="ref-for-change-the-frozenness-of-a-document③">更改文档冻结性</a>。</p>
                <li data-md>
                    <p>令 <var>descendants</var> 为 <var>doc</var> 的 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#list-of-the-descendant-browsing-contexts"
                            id="ref-for-list-of-the-descendant-browsing-contexts">所有子浏览上下文列表</a>。</p>
                <li data-md>
                    <p>遍历 <var>descendants</var> 中每个 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context"
                            id="ref-for-browsing-context">浏览上下文</a> <var>b</var>：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>descendantDocument</var> 为 <var>b</var> 的 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/browsers.html#active-document"
                                    id="ref-for-active-document">活动文档</a>。</p>
                        <li data-md>
                            <p>用 <var>descendantDocument</var>、<var>frozenness</var> 和 false 执行 <a data-link-type="dfn"
                                    href="#change-the-frozenness-of-a-document"
                                    id="ref-for-change-the-frozenness-of-a-document④">更改文档冻结性</a>。</p>
                    </ol>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="change the frozenness of a document">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="change-the-frozenness-of-a-document">更改文档冻结性</dfn>，给定 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①⓪">Document</a></code>
            <var>doc</var>，布尔型 <a data-link-type="dfn" href="#document-frozenness"
                id="ref-for-document-frozenness⑤">冻结性</a>状态 <var>frozenness</var>，以及布尔型 <var>auto resume frozen
                media</var>：
            <ol>
                <li data-md>
                    <p>若 <var>frozenness</var> 为 true，则用 <var>doc</var> 和 <var>auto resume frozen media</var> 执行 <a
                            data-link-type="dfn" href="#freeze-steps" id="ref-for-freeze-steps①">冻结步骤</a>。</p>
                <li data-md>
                    <p>否则，执行 <a data-link-type="dfn" href="#resume-steps" id="ref-for-resume-steps">恢复步骤</a>，参数为
                        <var>doc</var>。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="freeze steps">
            要为 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①①">Document</a></code>
            <var>doc</var> 执行 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="freeze-steps">冻结步骤</dfn>，布尔型参数 <var>auto resume frozen media</var>：
            <ol>
                <li data-md>
                    <p>设 <var>doc</var> 的 <a data-link-type="dfn" href="#document-frozenness"
                            id="ref-for-document-frozenness⑥">冻结性</a>状态为 true。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire">触发</a>名为 <code>freeze</code> 的事件，目标为 <var>doc</var>。</p>
                <li data-md>
                    <p>令 <var>elements</var> 为 <var>doc</var> 的所有 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/media.html#media-element"
                            id="ref-for-media-element">媒体元素</a>，这些元素为 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-descendant"
                            id="ref-for-concept-shadow-including-descendant">包含 shadow 的所有后代</a>，顺序为 <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-including-tree-order"
                            id="ref-for-concept-shadow-including-tree-order">包含 shadow 的树顺序</a>。</p>
                <li data-md>
                    <p>遍历 <var>elements</var> 中每个 <var>element</var>：</p>
                    <ol>
                        <li data-md>
                            <p>若 <var>element</var> 的 <code
                                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-paused" id="ref-for-dom-media-paused">paused</a></code>
                                属性为 false，则：</p>
                            <ol>
                                <li data-md>
                                    <p>设 <var>element</var> 的 <a data-link-type="dfn"
                                            href="#htmlmediaelement-resume-frozen-flag"
                                            id="ref-for-htmlmediaelement-resume-frozen-flag">resume frozen flag</a> 为
                                        <var>auto resume frozen media</var>。
                                    </p>
                                <li data-md>
                                    <p>对 <var>element</var> 执行 <a data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/media.html#internal-pause-steps"
                                            id="ref-for-internal-pause-steps">媒体暂停</a>。</p>
                            </ol>
                    </ol>
                    <p class="note" role="note"><span>注意：</span> 这里特意先赋值冻结性状态再触发事件。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="resume steps">
            要为 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①②">Document</a></code>
            <var>doc</var> 执行 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="resume-steps">恢复步骤</dfn>：
            <ol>
                <li data-md>
                    <p>令 <var>elements</var> 为 <var>doc</var> 的所有 <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/media.html#media-element"
                            id="ref-for-media-element①">媒体元素</a>，这些元素为 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-descendant"
                            id="ref-for-concept-shadow-including-descendant①">包含 shadow 的所有后代</a>，顺序为 <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-including-tree-order"
                            id="ref-for-concept-shadow-including-tree-order①">包含 shadow 的树顺序</a>。</p>
                    <ol>
                        <li data-md>
                            <p>遍历 <var>elements</var> 中每个 <var>element</var>：</p>
                            <ol>
                                <li data-md>
                                    <p>若 <var>elements</var> 的 <a data-link-type="dfn"
                                            href="#htmlmediaelement-resume-frozen-flag"
                                            id="ref-for-htmlmediaelement-resume-frozen-flag①">resume frozen flag</a> 为
                                        true：</p>
                                    <ol>
                                        <li data-md>
                                            <p>设 <var>elements</var> 的 <a data-link-type="dfn"
                                                    href="#htmlmediaelement-resume-frozen-flag"
                                                    id="ref-for-htmlmediaelement-resume-frozen-flag②">resume frozen
                                                    flag</a> 为 false。</p>
                                        <li data-md>
                                            <p>对 <var>element</var> 执行 <a data-link-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/media.html#internal-play-steps"
                                                    id="ref-for-internal-play-steps">媒体播放</a>。</p>
                                    </ol>
                            </ol>
                    </ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire"
                            id="ref-for-concept-event-fire①">触发</a>名为 <code>resume</code> 的事件，目标为 <var>doc</var>。</p>
                <li data-md>
                    <p>设 <var>doc</var> 的 <a data-link-type="dfn" href="#document-frozenness"
                            id="ref-for-document-frozenness⑦">冻结性</a>状态为 false。</p>
                    <p class="note" role="note"><span>注意：</span> 这里特意在触发事件后才赋值冻结性状态。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="5.4.3" id="discarding"><span class="secno">5.4.3. </span><span
                class="content">丢弃（Discarding）</span><a class="self-link" href="#discarding"></a></h4>
        每个 Document 都有一个 <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport
            id="document-discarded">discarded</dfn> 布尔值，初始为 false。
        <p>要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="discarded|discard"
                id="discarded">丢弃</dfn> 浏览上下文，<a
                href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">销毁浏览上下文</a>，并记录其及所有后代被销毁的原因是丢弃。
        </p>
        <p class="note" role="note"><span>注意：</span> <a data-link-type="dfn" href="#discarded"
                id="ref-for-discarded⑤">丢弃</a>通常用来回收系统内存，当内存等资源不足时使用。销毁浏览上下文则是用户离开页面等正常流程。</p>
        <p>浏览上下文在后台且文档处于 <a
                href="https://www.w3.org/TR/page-visibility-2/#visibility-states-and-the-visibilitystate-enum">VisibilityState
                hidden</a> 状态时，可在资源压力（如内存不足）下被 <a data-link-type="dfn" href="#discarded"
                id="ref-for-discarded⑥">丢弃</a>，具体例子：</p>
        <ul>
            <li data-md>
                <p>在桌面端 Chrome 中，长时间未使用且对用户不重要的后台标签页可能被 <a data-link-type="dfn" href="#discarded"
                        id="ref-for-discarded⑦">丢弃</a>，以节省内存</p>
                <p class="note" role="note"><span>注意：</span> 正在为用户执行任务的后台标签页（如播放音频）通常不会被 <a data-link-type="dfn"
                        href="#discarded" id="ref-for-discarded⑧">丢弃</a>。</p>
                <p class="note" role="note"><span>注意：</span> Chrome 使用的具体启发式与排除列表详见 <a
                        href="https://docs.google.com/document/d/1QJpuBTdllLVflMJSov0tlFX3e3yfSfd_-al2IBavbQM/edit">此文档</a>。
                </p>
        </ul>
        <p>当 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context"
                id="ref-for-top-level-browsing-context①">顶级浏览上下文</a>（浏览器标签页）由于资源压力（或如进程崩溃等异常）被 <a data-link-type="dfn"
                href="#discarded" id="ref-for-discarded⑨">丢弃</a>后，用户再次访问该标签页时，则该 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①③">Document</a></code>
            的 <a data-link-type="dfn" href="#document-discarded" id="ref-for-document-discarded②">discarded</a> 布尔值会为
            true（见 <a href="#html-initialize-doc">§ 5.2.5 初始化文档</a>）。</p>
        <h2 class="heading settled" data-level="6" id="acknowledgements"><span class="secno">6. </span><span
                class="content">致谢</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p>特别感谢
            Dave Tapuska、
            Fadi Meawad、
            Ojan Vafai、
            Olli Pettay、
            Philip Walton 以及
            Todd Reifsteck
            提供了技术建议和意见，促进了本规范的改进。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档约定</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求通过描述性断言和 RFC 2119 术语的组合进行表达。
            本规范正文中的关键词 “MUST”（必须）、“MUST NOT”（禁止）、“REQUIRED”（要求）、“SHALL”（应）、“SHALL NOT”（不得）、“SHOULD”（建议）、“SHOULD
            NOT”（不建议）、“RECOMMENDED”（推荐）、“MAY”（可以）、“OPTIONAL”（可选）
            均按 RFC 2119 的定义解释。
            为便于阅读，这些词在本规范中不会全部大写。</p>
        <p>除明确标为非规范性、示例和备注的部分外，本文档的所有文字均为规范性内容。<a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
        <p>规范中的示例会用 “for example”（例如）引入，或通过 <code>class="example"</code> 与规范性文本区分，如下所示：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个说明性示例。</p>
        </div>
        <p>说明性备注以 “Note”（注意）开头，并通过 <code>class="note"</code> 与规范性文本区分，如下所示：</p>
        <p class="note" role="note">注意，这是一个说明性备注。</p>
        <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">一致性算法</span><a
                class="self-link" href="#w3c-conformant-algorithms"></a></h3>
        <p>以祈使句表达的算法中的要求（如“去除所有前导空格字符”或“返回 false 并中止这些步骤”）
            应按引入算法时所用关键词（如“must”、“should”、“may”等）解释其含义。</p>
        <p>以算法或具体步骤表达的一致性要求可以用任何方式实现，只要最终结果等效即可。
            特别是，本规范定义的算法旨在易于理解，而非高性能。鼓励实现者进行优化。</p>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#dom-clientlifecyclestate-active">"active"</a><span>, 在 § 5.3.1</span>
        <li><a href="#change-the-frozenness-of-a-document">change the frozenness of a document</a><span>, 在
                § 5.4.2</span>
        <li><a href="#change-the-frozenness-of-a-top-level-document">change the frozenness of a top-level
                document</a><span>, 在 § 5.4.2</span>
        <li><a href="#enumdef-clientlifecyclestate">ClientLifecycleState</a><span>, 在 § 5.3.1</span>
        <li><a href="#discarded">discard</a><span>, 在 § 5.4.3</span>
        <li>
            discarded
            <ul>
                <li><a href="#discarded">definition of</a><span>, 在 § 5.4.3</span>
                <li><a href="#document-discarded">dfn for Document</a><span>, 在 § 5.4.3</span>
            </ul>
        <li><a href="#execution-while-not-rendered">execution-while-not-rendered</a><span>, 在 § 4</span>
        <li><a href="#execution-while-out-of-viewport">execution-while-out-of-viewport</a><span>, 在 § 4</span>
        <li><a href="#freeze-steps">freeze steps</a><span>, 在 § 5.4.2</span>
        <li><a href="#dom-clientlifecyclestate-frozen">"frozen"</a><span>, 在 § 5.3.1</span>
        <li><a href="#frozen">frozen</a><span>, 在 § 5.4.1</span>
        <li><a href="#document-frozenness">FROZENNESS</a><span>, 在 § 5.4.1</span>
        <li><a href="#get-client-lifecycle-state">Get Client Lifecycle State</a><span>, 在 § 5.3.2.1</span>
        <li><a href="#dfn-service-worker-client-lifecycle-state">lifecycle state</a><span>, 在 § 5.3.1</span>
        <li>
            lifecycleState
            <ul>
                <li><a href="#dom-client-lifecyclestate">attribute for Client</a><span>, 在 § 5.3.1</span>
                <li><a href="#dom-serviceworkerclient-lifecyclestate">attribute for ServiceWorkerClient</a><span>, 在
                        § 5.3.1.1</span>
            </ul>
        <li><a href="#dom-document-onfreeze">onfreeze</a><span>, 在 § 3</span>
        <li><a href="#dom-document-onresume">onresume</a><span>, 在 § 3</span>
        <li><a href="#dedicatedworkerglobalscope-owning-document">owning document</a><span>, 在 § 5.1</span>
        <li><a href="#htmlmediaelement-resume-frozen-flag">resume frozen flag</a><span>, 在 § 5.2.7</span>
        <li><a href="#resume-steps">resume steps</a><span>, 在 § 5.4.2</span>
        <li><a href="#unfrozen">unfrozen</a><span>, 在 § 5.4.1</span>
        <li><a href="#update-document-frozenness-steps">update document frozenness steps</a><span>, 在 § 4</span>
        <li><a href="#dom-document-wasdiscarded">wasDiscarded</a><span>, 在 § 3</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-workletglobalscope-owner-document">
        <a
            href="https://drafts.css-houdini.org/worklets#workletglobalscope-owner-document">https://drafts.css-houdini.org/worklets#workletglobalscope-owner-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-workletglobalscope-owner-document">5.1. Modifications to worklet and worker
                    behavior</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-viewport">
        <a
            href="https://www.w3.org/TR/CSS2/visuren.html#viewport">https://www.w3.org/TR/CSS2/visuren.html#viewport</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-viewport">4. Feature Policies</a> <a href="#ref-for-viewport①">(2)</a> <a
                    href="#ref-for-viewport②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-document">
        <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-document">2. Page Lifecycle States</a> <a href="#ref-for-document①">(2)</a>
            <li><a href="#ref-for-document②">3. API</a> <a href="#ref-for-document③">(2)</a> <a
                    href="#ref-for-document④">(3)</a>
            <li><a href="#ref-for-document⑤">4. Feature Policies</a>
            <li><a href="#ref-for-document⑥">5.1. Modifications to worklet and worker behavior</a>
            <li><a href="#ref-for-document⑦">5.2.3. Event loop: processing model</a>
            <li><a href="#ref-for-document⑧">5.2.5. Initialize the document</a>
            <li><a href="#ref-for-document⑨">5.4.2. Changing the frozenness of documents</a> <a
                    href="#ref-for-document①⓪">(2)</a> <a href="#ref-for-document①①">(3)</a> <a
                    href="#ref-for-document①②">(4)</a>
            <li><a href="#ref-for-document①③">5.4.3. Discarding</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document">
        <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document">5.2.2. Event loop: definitions</a> <a
                    href="#ref-for-concept-document①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-event-fire">
        <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-event-fire">5.4.2. Changing the frozenness of documents</a> <a
                    href="#ref-for-concept-event-fire①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-shadow-including-descendant">
        <a
            href="https://dom.spec.whatwg.org/#concept-shadow-including-descendant">https://dom.spec.whatwg.org/#concept-shadow-including-descendant</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-shadow-including-descendant">5.4.2. Changing the frozenness of documents</a>
                <a href="#ref-for-concept-shadow-including-descendant①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-shadow-including-tree-order">
        <a
            href="https://dom.spec.whatwg.org/#concept-shadow-including-tree-order">https://dom.spec.whatwg.org/#concept-shadow-including-tree-order</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-shadow-including-tree-order">5.4.2. Changing the frozenness of documents</a>
                <a href="#ref-for-concept-shadow-including-tree-order①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-sec-forward-progress">
        <a
            href="https://tc39.github.io/ecma262/#sec-forward-progress">https://tc39.github.io/ecma262/#sec-forward-progress</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-sec-forward-progress">5.1. Modifications to worklet and worker behavior</a> <a
                    href="#ref-for-sec-forward-progress①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-sec-code-realms">
        <a href="https://tc39.github.io/ecma262/#sec-code-realms">https://tc39.github.io/ecma262/#sec-code-realms</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-sec-code-realms">5.1. Modifications to worklet and worker behavior</a> <a
                    href="#ref-for-sec-code-realms①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dedicatedworkerglobalscope">
        <a
            href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dedicatedworkerglobalscope">5.1. Modifications to worklet and worker behavior</a> <a
                    href="#ref-for-dedicatedworkerglobalscope①">(2)</a> <a
                    href="#ref-for-dedicatedworkerglobalscope②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-eventhandler">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-eventhandler">3. API</a> <a href="#ref-for-eventhandler①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-htmlmediaelement">
        <a
            href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement">https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-htmlmediaelement">5.2.7. HTMLMediaElement</a> <a
                    href="#ref-for-htmlmediaelement①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-window">
        <a
            href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-window">3. API</a> <a href="#ref-for-window①">(2)</a>
            <li><a href="#ref-for-window②">5.2.8. Posting messages</a> <a href="#ref-for-window③">(2)</a> <a
                    href="#ref-for-window④">(3)</a>
            <li><a href="#ref-for-window⑤">5.3.1.3. openWindow(url)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-active-document">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">https://html.spec.whatwg.org/multipage/browsers.html#active-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-active-document">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-allowed-to-use">
        <a
            href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-allowed-to-use">4. Feature Policies</a> <a href="#ref-for-allowed-to-use①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-being-rendered">
        <a
            href="https://html.spec.whatwg.org/multipage/rendering.html#being-rendered">https://html.spec.whatwg.org/multipage/rendering.html#being-rendered</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-being-rendered">4. Feature Policies</a> <a href="#ref-for-being-rendered①">(2)</a> <a
                    href="#ref-for-being-rendered②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document-bc">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document-bc">2. Page Lifecycle States</a> <a
                    href="#ref-for-concept-document-bc①">(2)</a>
            <li><a href="#ref-for-concept-document-bc②">4. Feature Policies</a> <a
                    href="#ref-for-concept-document-bc③">(2)</a> <a href="#ref-for-concept-document-bc④">(3)</a>
            <li><a href="#ref-for-concept-document-bc⑤">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-browsing-context-container">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-browsing-context-container">4. Feature Policies</a> <a
                    href="#ref-for-browsing-context-container①">(2)</a> <a
                    href="#ref-for-browsing-context-container②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dedicated-worker-agent">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#dedicated-worker-agent">https://html.spec.whatwg.org/multipage/webappapis.html#dedicated-worker-agent</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dedicated-worker-agent">5.1. Modifications to worklet and worker behavior</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-environment-settings-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-environment-settings-object">5.3.1.3. openWindow(url)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-event-handler-idl-attributes">3. API</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-fully-active">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active">https://html.spec.whatwg.org/multipage/browsers.html#fully-active</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-fully-active">5.2.2. Event loop: definitions</a> <a
                    href="#ref-for-fully-active①">(2)</a>
            <li><a href="#ref-for-fully-active②">5.2.3. Event loop: processing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-settings-object-global">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-settings-object-global">5.3.2.1. Get Client Lifecycle State</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-iframe-load-event-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#iframe-load-event-steps">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#iframe-load-event-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-iframe-load-event-steps">4. Feature Policies</a>
            <li><a href="#ref-for-iframe-load-event-steps①">5.2.6. iframe load event steps</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-of-the-descendant-browsing-contexts">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#list-of-the-descendant-browsing-contexts">https://html.spec.whatwg.org/multipage/browsers.html#list-of-the-descendant-browsing-contexts</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-of-the-descendant-browsing-contexts">5.4.2. Changing the frozenness of
                    documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-media-element">
        <a
            href="https://html.spec.whatwg.org/multipage/media.html#media-element">https://html.spec.whatwg.org/multipage/media.html#media-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-media-element">5.4.2. Changing the frozenness of documents</a> <a
                    href="#ref-for-media-element①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-internal-pause-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/media.html#internal-pause-steps">https://html.spec.whatwg.org/multipage/media.html#internal-pause-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-internal-pause-steps">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-internal-play-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/media.html#internal-play-steps">https://html.spec.whatwg.org/multipage/media.html#internal-play-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-internal-play-steps">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-nested-browsing-context">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-nested-browsing-context">4. Feature Policies</a> <a
                    href="#ref-for-nested-browsing-context①">(2)</a> <a href="#ref-for-nested-browsing-context②">(3)</a>
                <a href="#ref-for-nested-browsing-context③">(4)</a> <a href="#ref-for-nested-browsing-context④">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-WorkerGlobalScope-owner-set">
        <a
            href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set">https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-WorkerGlobalScope-owner-set">5.1. Modifications to worklet and worker
                    behavior</a> <a href="#ref-for-concept-WorkerGlobalScope-owner-set①">(2)</a> <a
                    href="#ref-for-concept-WorkerGlobalScope-owner-set②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-media-paused">
        <a
            href="https://html.spec.whatwg.org/multipage/media.html#dom-media-paused">https://html.spec.whatwg.org/multipage/media.html#dom-media-paused</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-media-paused">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-pagetransitionevent-persisted">
        <a
            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#dom-pagetransitionevent-persisted">https://html.spec.whatwg.org/multipage/browsing-the-web.html#dom-pagetransitionevent-persisted</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-pagetransitionevent-persisted">5.2.1. Unloading documents and history
                    traversal</a> <a href="#ref-for-dom-pagetransitionevent-persisted①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-posted-message-task-source">
        <a
            href="https://html.spec.whatwg.org/multipage/web-messaging.html#posted-message-task-source">https://html.spec.whatwg.org/multipage/web-messaging.html#posted-message-task-source</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-posted-message-task-source">5.2.8. Posting messages</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-current-document-readiness">
        <a
            href="https://html.spec.whatwg.org/multipage/dom.html#current-document-readiness">https://html.spec.whatwg.org/multipage/dom.html#current-document-readiness</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-current-document-readiness">4. Feature Policies</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-task">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-task">5.2.2. Event loop: definitions</a> <a
                    href="#ref-for-concept-task①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-top-level-browsing-context">
        <a
            href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-top-level-browsing-context">5.4.2. Changing the frozenness of documents</a>
            <li><a href="#ref-for-top-level-browsing-context①">5.4.3. Discarding</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-traverse-the-history">
        <a
            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history">https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-traverse-the-history">5.2.1. Unloading documents and history traversal</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-unload-a-document">
        <a
            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document">https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-unload-a-document">5.2.1. Unloading documents and history traversal</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-update-the-rendering">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering">https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-update-the-rendering">5.2.3. Event loop: processing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-worklet-agent">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#worklet-agent">https://html.spec.whatwg.org/multipage/webappapis.html#worklet-agent</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-worklet-agent">5.1. Modifications to worklet and worker behavior</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-append">
        <a href="https://infra.spec.whatwg.org/#list-append">https://infra.spec.whatwg.org/#list-append</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-append">5.3.1.2. matchAll(options)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-iterate">
        <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-iterate">5.3.1.2. matchAll(options)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list">
        <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-list">5.3.1.2. matchAll(options)</a> <a href="#ref-for-list①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-calculate-intersection-rect-algo">
        <a
            href="https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo">https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-calculate-intersection-rect-algo">4. Feature Policies</a> <a
                    href="#ref-for-calculate-intersection-rect-algo①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-default-allowlist">
        <a
            href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist">https://w3c.github.io/webappsec-permissions-policy/#default-allowlist</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-default-allowlist">4. Feature Policies</a> <a
                    href="#ref-for-default-allowlist①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-client">
        <a href="https://w3c.github.io/ServiceWorker/#client">https://w3c.github.io/ServiceWorker/#client</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-client">5.3.1. Client</a> <a href="#ref-for-client①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-service-worker-client">
        <a
            href="https://w3c.github.io/ServiceWorker/#dfn-service-worker-client">https://w3c.github.io/ServiceWorker/#dfn-service-worker-client</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-service-worker-client">5.3.1.3. openWindow(url)</a>
            <li><a href="#ref-for-dfn-service-worker-client①">5.3.2.1. Get Client Lifecycle State</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-create-client-algorithm">
        <a
            href="https://w3c.github.io/ServiceWorker/#create-client-algorithm">https://w3c.github.io/ServiceWorker/#create-client-algorithm</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-create-client-algorithm">5.3.1.2. matchAll(options)</a>
            <li><a href="#termref-for-create-client-algorithm">5.3.2.2. Create Client</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-create-windowclient-algorithm">
        <a
            href="https://w3c.github.io/ServiceWorker/#create-windowclient-algorithm">https://w3c.github.io/ServiceWorker/#create-windowclient-algorithm</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-create-windowclient-algorithm">5.3.1.2. matchAll(options)</a>
            <li><a href="#ref-for-create-windowclient-algorithm①">5.3.1.3. openWindow(url)</a>
            <li><a href="#termref-for-create-windowclient-algorithm">5.3.2.3. Create Window Client</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-boolean">
        <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-boolean">3. API</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-this">
        <a href="https://webidl.spec.whatwg.org/#this">https://webidl.spec.whatwg.org/#this</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-this">5.3.1.1. lifecycleState</a>
            <li><a href="#ref-for-this①">5.3.1.3. openWindow(url)</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CSS-HOUDINI]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-workletglobalscope-owner-document">owning
                        document（所属文档）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS21]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-viewport">viewport（视口）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-document">Document（文档）</span>
                <li><span class="dfn-paneled" id="term-for-concept-document">document（文档）</span>
                <li><span class="dfn-paneled" id="term-for-concept-event-fire">fire an event（触发事件）</span>
                <li><span class="dfn-paneled" id="term-for-concept-shadow-including-descendant">shadow-including
                        descendant（包含 shadow 的后代）</span>
                <li><span class="dfn-paneled" id="term-for-concept-shadow-including-tree-order">shadow-including tree
                        order（包含 shadow 的树顺序）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ECMA262]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-sec-forward-progress">blocked（阻塞）</span>
                <li><span class="dfn-paneled" id="term-for-sec-code-realms">realm（运行域）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</span>
                <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler（事件处理器）</span>
                <li><span class="dfn-paneled" id="term-for-htmlmediaelement">HTMLMediaElement</span>
                <li><span class="dfn-paneled" id="term-for-window">Window</span>
                <li><span class="dfn-paneled" id="term-for-active-document">active document（活动文档）</span>
                <li><span class="dfn-paneled" id="term-for-allowed-to-use">allowed to use（允许使用）</span>
                <li><span class="dfn-paneled" id="term-for-being-rendered">being rendered（正在渲染）</span>
                <li><span class="dfn-paneled" id="term-for-concept-document-bc">browsing context <small>(for
                            document)</small>（浏览上下文）</span>
                <li><span class="dfn-paneled" id="term-for-browsing-context-container">browsing context
                        container（浏览上下文容器）</span>
                <li><span class="dfn-paneled" id="term-for-dedicated-worker-agent">dedicated worker agent（专用 worker
                        agent）</span>
                <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings
                        object（环境设置对象）</span>
                <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes">event handler idl
                        attribute（事件处理IDL属性）</span>
                <li><span class="dfn-paneled" id="term-for-fully-active">fully active（完全激活）</span>
                <li><span class="dfn-paneled" id="term-for-concept-settings-object-global">global object <small>(for
                            environment settings object)</small>（全局对象）</span>
                <li><span class="dfn-paneled" id="term-for-iframe-load-event-steps">iframe load event
                        steps（iframe加载事件步骤）</span>
                <li><span class="dfn-paneled" id="term-for-list-of-the-descendant-browsing-contexts">list of the
                        descendant browsing contexts（子浏览上下文列表）</span>
                <li><span class="dfn-paneled" id="term-for-media-element">media elements（媒体元素）</span>
                <li><span class="dfn-paneled" id="term-for-internal-pause-steps">media pause（媒体暂停）</span>
                <li><span class="dfn-paneled" id="term-for-internal-play-steps">media play（媒体播放）</span>
                <li><span class="dfn-paneled" id="term-for-nested-browsing-context">nested browsing
                        context（嵌套浏览上下文）</span>
                <li><span class="dfn-paneled" id="term-for-concept-WorkerGlobalScope-owner-set">owner set（拥有者集合）</span>
                <li><span class="dfn-paneled" id="term-for-dom-media-paused">paused（已暂停）</span>
                <li><span class="dfn-paneled" id="term-for-dom-pagetransitionevent-persisted">persisted（已持久化）</span>
                <li><span class="dfn-paneled" id="term-for-posted-message-task-source">posted message task
                        source（消息任务源）</span>
                <li><span class="dfn-paneled" id="term-for-current-document-readiness">readiness（就绪状态）</span>
                <li><span class="dfn-paneled" id="term-for-concept-task">task（任务）</span>
                <li><span class="dfn-paneled" id="term-for-top-level-browsing-context">top-level browsing
                        context（顶级浏览上下文）</span>
                <li><span class="dfn-paneled" id="term-for-traverse-the-history">traverse the history（遍历历史）</span>
                <li><span class="dfn-paneled" id="term-for-unload-a-document">unload a document（卸载文档）</span>
                <li><span class="dfn-paneled" id="term-for-update-the-rendering">update the rendering（更新渲染）</span>
                <li><span class="dfn-paneled" id="term-for-worklet-agent">worklet agent（worklet代理）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-list-append">append（追加）</span>
                <li><span class="dfn-paneled" id="term-for-list-iterate">for each（遍历）</span>
                <li><span class="dfn-paneled" id="term-for-list">list（列表）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INTERSECTIONOBSERVER]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-calculate-intersection-rect-algo">compute the intersection of
                        a target element and the root（计算目标元素与根的交集）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[permissions-policy-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-default-allowlist">default allowlist（默认允许列表）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[service-workers-1]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-client">Client（客户端）</span>
                <li><span class="dfn-paneled" id="term-for-dfn-service-worker-client">service worker client（service
                        worker 客户端）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[SERVICEWORKER]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-create-client-algorithm">create client（创建客户端）</span>
                <li><span class="dfn-paneled" id="term-for-create-windowclient-algorithm">create window
                        client（创建窗口客户端）</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了以下术语：
            <ul>
                <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean（布尔型）</span>
                <li><span class="dfn-paneled" id="term-for-this">this（当前对象）</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css21">[CSS21]
        <dd>Bert Bos 等. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 1
                    (CSS 2.1) Specification</cite></a>. 链接: <a
                href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. Living Standard.
            链接: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren 等. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>.
            Living Standard. 链接: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    标准</cite></a>. Living Standard. 链接: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
        <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions
                    Policy</cite></a>. 链接: <a
                href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>用于 RFC 中指示需求等级的关键词</cite></a>.
            1997年3月. 最佳当前实践. 链接: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-service-workers-1">[SERVICE-WORKERS-1]
        <dd>Alex Russell 等. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers 1</cite></a>. 链接:
            <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. Living
            Standard. 链接: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">说明性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-page-visibility">[PAGE-VISIBILITY]
        <dd>Jatinder Mann; Arvind Jain. <a href="https://www.w3.org/TR/page-visibility/"><cite>页面可见性（第二版）</cite></a>.
            2013年10月29日. REC. 链接: <a
                href="https://www.w3.org/TR/page-visibility/">https://www.w3.org/TR/page-visibility/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onfreeze"><c- g>onfreeze</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onresume"><c- g>onresume</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-document-wasdiscarded"><c- g>wasDiscarded</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/ServiceWorker/#client"><c- g>Client</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-clientlifecyclestate"><c- n>ClientLifecycleState</c-></a> <a data-readonly data-type="ClientLifecycleState" href="#dom-client-lifecyclestate"><code><c- g>lifecycleState</c-></code></a>;
};

<c- b>enum</c-> <a href="#enumdef-clientlifecyclestate"><code><c- g>ClientLifecycleState</c-></code></a> {
    <a href="#dom-clientlifecyclestate-active"><code><c- s>"active"</c-></code></a>,
    <a href="#dom-clientlifecyclestate-frozen"><code><c- s>"frozen"</c-></code></a>
};

</pre>
    <aside class="dfn-panel" data-for="dom-document-onfreeze">
        <b><a href="#dom-document-onfreeze">#dom-document-onfreeze</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-document-onfreeze">3. API</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-document-onresume">
        <b><a href="#dom-document-onresume">#dom-document-onresume</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-document-onresume">3. API</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-document-wasdiscarded">
        <b><a href="#dom-document-wasdiscarded">#dom-document-wasdiscarded</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-document-wasdiscarded">3. API</a>
            <li><a href="#ref-for-dom-document-wasdiscarded①">5.2.4. Discarding browsing contexts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="execution-while-not-rendered">
        <b><a href="#execution-while-not-rendered">#execution-while-not-rendered</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-execution-while-not-rendered">4. Feature Policies</a> <a
                    href="#ref-for-execution-while-not-rendered①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="execution-while-out-of-viewport">
        <b><a href="#execution-while-out-of-viewport">#execution-while-out-of-viewport</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-execution-while-out-of-viewport">4. Feature Policies</a> <a
                    href="#ref-for-execution-while-out-of-viewport①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="update-document-frozenness-steps">
        <b><a href="#update-document-frozenness-steps">#update-document-frozenness-steps</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-update-document-frozenness-steps">5.2.3. Event loop: processing model</a>
            <li><a href="#ref-for-update-document-frozenness-steps①">5.2.6. iframe load event steps</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dedicatedworkerglobalscope-owning-document">
        <b><a
                href="#dedicatedworkerglobalscope-owning-document">#dedicatedworkerglobalscope-owning-document</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dedicatedworkerglobalscope-owning-document">5.1. Modifications to worklet and worker
                    behavior</a> <a href="#ref-for-dedicatedworkerglobalscope-owning-document①">(2)</a>
            <li><a href="#ref-for-dedicatedworkerglobalscope-owning-document②">5.3.2.1. Get Client Lifecycle State</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="htmlmediaelement-resume-frozen-flag">
        <b><a href="#htmlmediaelement-resume-frozen-flag">#htmlmediaelement-resume-frozen-flag</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-htmlmediaelement-resume-frozen-flag">5.4.2. Changing the frozenness of documents</a>
                <a href="#ref-for-htmlmediaelement-resume-frozen-flag①">(2)</a> <a
                    href="#ref-for-htmlmediaelement-resume-frozen-flag②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="enumdef-clientlifecyclestate">
        <b><a href="#enumdef-clientlifecyclestate">#enumdef-clientlifecyclestate</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-enumdef-clientlifecyclestate">5.3.1. Client</a> <a
                    href="#ref-for-enumdef-clientlifecyclestate①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-clientlifecyclestate-active">
        <b><a href="#dom-clientlifecyclestate-active">#dom-clientlifecyclestate-active</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-clientlifecyclestate-active">5.3.2.1. Get Client Lifecycle State</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-clientlifecyclestate-frozen">
        <b><a href="#dom-clientlifecyclestate-frozen">#dom-clientlifecyclestate-frozen</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-clientlifecyclestate-frozen">5.3.2.1. Get Client Lifecycle State</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dfn-service-worker-client-lifecycle-state">
        <b><a
                href="#dfn-service-worker-client-lifecycle-state">#dfn-service-worker-client-lifecycle-state</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-service-worker-client-lifecycle-state">5.3.1.1. lifecycleState</a>
            <li><a href="#ref-for-dfn-service-worker-client-lifecycle-state①">5.3.2.2. Create Client</a>
            <li><a href="#ref-for-dfn-service-worker-client-lifecycle-state②">5.3.2.3. Create Window Client</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-serviceworkerclient-lifecyclestate">
        <b><a
                href="#dom-serviceworkerclient-lifecyclestate">#dom-serviceworkerclient-lifecyclestate</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-serviceworkerclient-lifecyclestate">5.3.1.1. lifecycleState</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="get-client-lifecycle-state">
        <b><a href="#get-client-lifecycle-state">#get-client-lifecycle-state</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-get-client-lifecycle-state">5.3.1.2. matchAll(options)</a>
            <li><a href="#ref-for-get-client-lifecycle-state①">5.3.1.3. openWindow(url)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="document-frozenness">
        <b><a href="#document-frozenness">#document-frozenness</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-document-frozenness">4. Feature Policies</a>
            <li><a href="#ref-for-document-frozenness①">5.2.1. Unloading documents and history traversal</a>
            <li><a href="#ref-for-document-frozenness②">5.4.1. FROZENNESS state</a> <a
                    href="#ref-for-document-frozenness③">(2)</a>
            <li><a href="#ref-for-document-frozenness④">5.4.2. Changing the frozenness of documents</a> <a
                    href="#ref-for-document-frozenness⑤">(2)</a> <a href="#ref-for-document-frozenness⑥">(3)</a> <a
                    href="#ref-for-document-frozenness⑦">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="frozen">
        <b><a href="#frozen">#frozen</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-frozen">2. Page Lifecycle States</a> <a href="#ref-for-frozen①">(2)</a>
            <li><a href="#ref-for-frozen②">4. Feature Policies</a>
            <li><a href="#ref-for-frozen③">5.1. Modifications to worklet and worker behavior</a> <a
                    href="#ref-for-frozen④">(2)</a>
            <li><a href="#ref-for-frozen⑤">5.2.8. Posting messages</a>
            <li><a href="#ref-for-frozen⑥">5.3.2.1. Get Client Lifecycle State</a>
            <li><a href="#ref-for-frozen⑦">5.4.1. FROZENNESS state</a> <a href="#ref-for-frozen⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="unfrozen">
        <b><a href="#unfrozen">#unfrozen</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-unfrozen">4. Feature Policies</a>
            <li><a href="#ref-for-unfrozen①">5.2.2. Event loop: definitions</a>
            <li><a href="#ref-for-unfrozen②">5.2.8. Posting messages</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="change-the-frozenness-of-a-top-level-document">
        <b><a
                href="#change-the-frozenness-of-a-top-level-document">#change-the-frozenness-of-a-top-level-document</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-change-the-frozenness-of-a-top-level-document">5.4.1. FROZENNESS state</a> <a
                    href="#ref-for-change-the-frozenness-of-a-top-level-document①">(2)</a> <a
                    href="#ref-for-change-the-frozenness-of-a-top-level-document②">(3)</a> <a
                    href="#ref-for-change-the-frozenness-of-a-top-level-document③">(4)</a> <a
                    href="#ref-for-change-the-frozenness-of-a-top-level-document④">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="change-the-frozenness-of-a-document">
        <b><a href="#change-the-frozenness-of-a-document">#change-the-frozenness-of-a-document</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-change-the-frozenness-of-a-document">4. Feature Policies</a>
            <li><a href="#ref-for-change-the-frozenness-of-a-document①">5.2.1. Unloading documents and history
                    traversal</a> <a href="#ref-for-change-the-frozenness-of-a-document②">(2)</a>
            <li><a href="#ref-for-change-the-frozenness-of-a-document③">5.4.2. Changing the frozenness of documents</a>
                <a href="#ref-for-change-the-frozenness-of-a-document④">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="freeze-steps">
        <b><a href="#freeze-steps">#freeze-steps</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-freeze-steps">2. Page Lifecycle States</a>
            <li><a href="#ref-for-freeze-steps①">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="resume-steps">
        <b><a href="#resume-steps">#resume-steps</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-resume-steps">5.4.2. Changing the frozenness of documents</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="document-discarded">
        <b><a href="#document-discarded">#document-discarded</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-document-discarded">3. API</a>
            <li><a href="#ref-for-document-discarded①">5.2.5. Initialize the document</a>
            <li><a href="#ref-for-document-discarded②">5.4.3. Discarding</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="discarded">
        <b><a href="#discarded">#discarded</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-discarded">2. Page Lifecycle States</a>
            <li><a href="#ref-for-discarded①">5.2.5. Initialize the document</a>
            <li><a href="#ref-for-discarded②">5.2.8. Posting messages</a>
            <li><a href="#ref-for-discarded③">5.4.1. FROZENNESS state</a> <a href="#ref-for-discarded④">(2)</a>
            <li><a href="#ref-for-discarded⑤">5.4.3. Discarding</a> <a href="#ref-for-discarded⑥">(2)</a> <a
                    href="#ref-for-discarded⑦">(3)</a> <a href="#ref-for-discarded⑧">(4)</a> <a
                    href="#ref-for-discarded⑨">(5)</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script>/* script-var-click-highlighting */

        document.addEventListener("click", e => {
            if (e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        {
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>