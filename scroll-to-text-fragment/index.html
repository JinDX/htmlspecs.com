<!doctype html>
<html lang="zh-hans">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>URL 片段文本指令</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
    <!-- <meta content="Bikeshed version 82ce88815, updated Thu Sep 7 16:33:55 2023 -0700" name="generator"> -->
    <link href="https://wicg.github.io/scroll-to-text-fragment/" rel="canonical">
    <style>
        .monkeypatch {
            color: grey;
        }

        .monkeypatch .diff {
            color: var(--text);
        }
    </style>
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */

        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            white-space: pre;
            display: inline-block;
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled[role="button"] {
            cursor: pointer;
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            white-space: pre;
            display: inline-block;
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled[role="button"] {
            cursor: pointer;
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */


        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-var-click-highlighting */
        /*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <style>
        /* Boilerplate: style-wpt */
        :root {
            --wpt-border: hsl(0, 0%, 60%);
            --wpt-bg: hsl(0, 0%, 95%);
            --wpt-text: var(--text);
            --wptheading-text: hsl(0, 0%, 30%);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --wpt-border: hsl(0, 0%, 30%);
                --wpt-bg: var(--borderedblock-bg);
                --wpt-text: var(--text);
                --wptheading-text: hsl(0, 0%, 60%);
            }
        }

        .wpt-tests-block {
            list-style: none;
            border-left: .5em solid var(--wpt-border);
            background: var(--wpt-bg);
            color: var(--wpt-text);
            margin: 1em auto;
            padding: .5em;
        }

        .wpt-tests-block summary {
            color: var(--wptheading-text);
            font-weight: normal;
            text-transform: uppercase;
        }

        .wpt-tests-block summary::marker {
            color: var(--wpt-border);
        }

        .wpt-tests-block summary:hover::marker {
            color: var(--wpt-text);
        }

        /*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
        .wpt-tests-block:not([open]) {
            padding: 0;
            border: none;
            background: none;
            font-size: 0.75em;
            line-height: 1;
            position: relative;
            margin: 1em 0 0;
        }

        .wpt-tests-block:not([open]) summary {
            position: absolute;
            right: 0;
            bottom: 0;
        }

        /*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
        .wpt-tests-block:not([open]):last-child {
            padding-bottom: 1px;
            margin-bottom: -1px;
        }

        /*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
        li:not(:last-child)>.wpt-tests-block:not([open]):last-child,
        dd:not(:last-child)>.wpt-tests-block:not([open]):last-child {
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .wpt-tests-block:not([open]):not(:hover) {
            opacity: 0.5;
        }

        .wpt-tests-list {
            list-style: none;
            display: grid;
            margin: 0;
            padding: 0;
            grid-template-columns: 1fr max-content auto auto;
            grid-column-gap: .5em;
        }

        .wpt-tests-block hr:last-child {
            display: none;
        }

        .wpt-test {
            display: contents;
        }

        .wpt-test>a {
            text-decoration: underline;
            border: none;
        }

        .wpt-test>.wpt-name {
            grid-column: 1;
        }

        .wpt-test>.wpt-results {
            grid-column: 2;
        }

        .wpt-test>.wpt-live {
            grid-column: 3;
        }

        .wpt-test>.wpt-source {
            grid-column: 4;
        }

        .wpt-test>.wpt-results {
            display: flex;
            gap: .1em;
        }

        .wpt-test .wpt-result {
            display: inline-block;
            height: 1em;
            width: 1em;
            border-radius: 50%;
            position: relative;
        }
    </style>

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">URL 片段文本指令</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">社区组草案报告</a>, <time class="dt-updated"
                datetime="2023-12-13">2023年12月13日</time></p>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>此版本:
                <dd><a class="u-url"
                        href="https://wicg.github.io/scroll-to-text-fragment/">https://wicg.github.io/scroll-to-text-fragment/</a>
                <dt>问题追踪:
                <dd><a href="https://github.com/wicg/scroll-to-text-fragment/issues/">GitHub</a>
                <dd><a href="#issues-index">规范内标注</a>
                <dt class="editor">编辑者:
                <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email"
                        href="mailto:nburris@chromium.org">Nick Burris</a> (<a class="p-org org"
                        href="https://www.google.com">Google</a>)
                <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email"
                        href="mailto:bokan@chromium.org">David Bokan</a> (<a class="p-org org"
                        href="https://www.google.com">Google</a>)
                <dt>测试套件:
                <dd class="wpt-overview"><a
                        href="https://wpt.fyi/results/scroll-to-text-fragment/">https://wpt.fyi/results/scroll-to-text-fragment/</a>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2023 the Contributors to the URL Fragment Text Directives Specification, published by the <a
                href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a
                href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement
                (CLA)</a>.
            A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">摘要</span></h2>
        <p>文本指令为 URL 片段增加了指定文本片段的支持。

            当导航到带有此类片段的 URL 时，用户代理可以快速突出显示并/或将其引起用户的注意。</p>
    </div>
    <div data-fill-with="at-risk"></div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">本文件状态</span>
    </h2>
    <div data-fill-with="status">
        <p> 本规范由<a href="https://www.w3.org/community/wicg/">Web 平台孵化社区组</a>发布。
            它不是 W3C 标准，也不在 W3C 标准轨道上。

            请注意，根据<a href="https://www.w3.org/community/about/agreements/cla/">W3C 社区贡献者许可协议（CLA）</a>，存在有限的选择退出权和其它适用条件。

            详细了解<a href="http://www.w3.org/community/">W3C 社区与业务组</a>。
        </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目录</h2>
        <ol class="toc" role="directory">
            <li><a href="#infrastructure"><span class="secno">1</span> <span class="content">基础结构</span></a>
            <li>
                <a href="#introduction"><span class="secno">2</span> <span class="content">简介</span></a>
                <ol class="toc">
                    <li>
                        <a href="#use-cases"><span class="secno">2.1</span> <span class="content">使用场景</span></a>
                        <ol class="toc">
                            <li><a href="#web-text-references"><span class="secno">2.1.1</span> <span
                                        class="content">网页文本引用</span></a>
                            <li><a href="#user-sharing"><span class="secno">2.1.2</span> <span
                                        class="content">用户分享</span></a>
                        </ol>
                    <li><a href="#link-lifetime"><span class="secno">2.2</span> <span class="content">链接生命周期</span></a>
                </ol>
            <li>
                <a href="#description"><span class="secno">3</span> <span class="content">描述</span></a>
                <ol class="toc">
                    <li><a href="#indication"><span class="secno">3.1</span> <span class="content">指示</span></a>
                    <li>
                        <a href="#syntax"><span class="secno">3.2</span> <span class="content">语法</span></a>
                        <ol class="toc">
                            <li><a href="#context-terms"><span class="secno">3.2.1</span> <span
                                        class="content">上下文术语</span></a>
                            <li><a href="#bidi-considerations"><span class="secno">3.2.2</span> <span
                                        class="content">双向文本注意事项</span></a>
                        </ol>
                    <li>
                        <a href="#the-fragment-directive"><span class="secno">3.3</span> <span
                                class="content">片段指令</span></a>
                        <ol class="toc">
                            <li><a href="#extracting-the-fragment-directive"><span class="secno">3.3.1</span> <span
                                        class="content">提取片段指令</span></a>
                            <li><a href="#applying-directives-to-a-document"><span class="secno">3.3.2</span> <span
                                        class="content">将指令应用于文档</span></a>
                            <li><a href="#fragment-directive-grammar"><span class="secno">3.3.3</span> <span
                                        class="content">片段指令语法</span></a>
                        </ol>
                    <li>
                        <a href="#text-directives"><span class="secno">3.4</span> <span class="content">文本指令</span></a>
                        <ol class="toc">
                            <li><a href="#invoking-text-directives"><span class="secno">3.4.1</span> <span
                                        class="content">调用文本指令</span></a>
                        </ol>
                    <li>
                        <a href="#security-and-privacy"><span class="secno">3.5</span> <span
                                class="content">安全与隐私</span></a>
                        <ol class="toc">
                            <li><a href="#motivation"><span class="secno">3.5.1</span> <span
                                        class="content">动机</span></a>
                            <li><a href="#scroll-on-navigation"><span class="secno">3.5.2</span> <span
                                        class="content">导航触发滚动</span></a>
                            <li><a href="#search-timing"><span class="secno">3.5.3</span> <span
                                        class="content">查找时机</span></a>
                            <li><a href="#restricting-the-text-fragment"><span class="secno">3.5.4</span> <span
                                        class="content">限制文本片段</span></a>
                            <li><a href="#restricting-scroll-on-load"><span class="secno">3.5.5</span> <span
                                        class="content">限制加载时滚动</span></a>
                        </ol>
                    <li>
                        <a href="#navigating-to-text-fragment"><span class="secno">3.6</span> <span
                                class="content">导航到文本片段</span></a>
                        <ol class="toc">
                            <li><a href="#finding-ranges-in-a-document"><span class="secno">3.6.1</span> <span
                                        class="content">在文档中查找范围</span></a>
                            <li><a href="#word-boundaries"><span class="secno">3.6.2</span> <span
                                        class="content">词边界</span></a>
                        </ol>
                    <li>
                        <a href="#indicating-the-text-match"><span class="secno">3.7</span> <span
                                class="content">指示文本匹配</span></a>
                        <ol class="toc">
                            <li>
                                <a href="#urls-in-ua-features"><span class="secno">3.7.1</span> <span
                                        class="content">用户代理功能中的 URL</span></a>
                                <ol class="toc">
                                    <li><a href="#urls-in-location-bar"><span class="secno">3.7.1.1</span> <span
                                                class="content">地址栏</span></a>
                                    <li><a href="#urls-in-bookmarks"><span class="secno">3.7.1.2</span> <span
                                                class="content">书签</span></a>
                                    <li><a href="#urls-in-sharing"><span class="secno">3.7.1.3</span> <span
                                                class="content">分享</span></a>
                                </ol>
                        </ol>
                    <li><a href="#document-policy-integration"><span class="secno">3.8</span> <span
                                class="content">文档策略集成</span></a>
                    <li><a href="#feature-detectability"><span class="secno">3.9</span> <span
                                class="content">特性可检测性</span></a>
                </ol>
            <li>
                <a href="#generating-text-fragment-directives"><span class="secno">4</span> <span
                        class="content">生成文本片段指令</span></a>
                <ol class="toc">
                    <li><a href="#prefer-exact-matching-to-range-based"><span class="secno">4.1</span> <span
                                class="content">优先精确匹配而非基于范围的匹配</span></a>
                    <li><a href="#use-context-only-when-necessary"><span class="secno">4.2</span> <span
                                class="content">仅在必要时使用上下文</span></a>
                    <li><a href="#determine-if-fragment-id-is-needed"><span class="secno">4.3</span> <span
                                class="content">确定是否需要片段 id</span></a>
                </ol>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">一致性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文档惯例</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本规范定义的术语</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">引用中定义的术语</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">规范性引用</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考性引用</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL 索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">问题索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="infrastructure"><span class="secno">1. </span><span
                class="content">基础结构</span><a class="self-link" href="#infrastructure"></a></h2>
        <p>本规范依赖于 Infra 标准。<a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a> </p>
        <h2 class="heading settled" data-level="2" id="introduction"><span class="secno">2. </span><span
                class="content">简介</span><a class="self-link" href="#introduction"></a></h2>
        <div class="note" role="note">本节为非规范性内容</div>
        <h3 class="heading settled" data-level="2.1" id="use-cases"><span class="secno">2.1. </span><span
                class="content">使用场景</span><a class="self-link" href="#use-cases"></a></h3>
        <h4 class="heading settled" data-level="2.1.1" id="web-text-references"><span class="secno">2.1.1. </span><span
                class="content">网页文本引用</span><a class="self-link" href="#web-text-references"></a></h4>
        文本片段的核心用例是允许 URL 作为跨网页的精确文本引用。例如，维基百科的引用可以链接到它们所引用页面上的确切文本。同样，搜索引擎可以提供 URL，将用户直接定位到页面中他们所寻找的答案，而不是链接到页面顶部。
        <h4 class="heading settled" data-level="2.1.2" id="user-sharing"><span class="secno">2.1.2. </span><span
                class="content">用户分享</span><a class="self-link" href="#user-sharing"></a></h4>
        借助文本指令，浏览器可以实现“复制到此处 URL”的选项，当用户在文本选区上打开上下文菜单时，浏览器即可生成带有适当文本选区指定的 URL，URL
        的接收者将方便地看到指定的文本被指示出来。如果没有文本片段，用户若想分享页面上一段文字，通常只是复制并粘贴该段文字，这样接收者就失去了页面的上下文。
        <h3 class="heading settled" data-level="2.2" id="link-lifetime"><span class="secno">2.2. </span><span
                class="content">链接生命周期</span><a class="self-link" href="#link-lifetime"></a></h3>
        <p>本规范力图最大化文本指令链接的有效期，例如，使用实际文本内容作为 URL 载荷，并允许使用元素 id
            片段作为备用。然而，网页经常会更新和变更其内容。因此，此类链接可能会“失效”，即它们指向的文本内容在目标页面上不再存在。</p>
        <p>尽管有这个问题，文本指令链接依然有用。在用户分享场景中，这类链接通常是临时的，仅用于发送后的短时间内。对于更长期的引用和网页链接等用例，文本指令依然有价值，因为它们能优雅降级为普通链接。此外，过期文本指令的存在也可以为用户展现有用的信息，以帮助用户理解原作者的用意，并提示页面内容自链接创建以来可能已发生更改。
        </p>
        <p>关于如何创建健壮的文本指令链接，请参见<a href="#generating-text-fragment-directives">§ 4 生成文本片段指令</a>中的最佳实践。</p>
        <h2 class="heading settled" data-level="3" id="description"><span class="secno">3. </span><span
                class="content">描述</span><a class="self-link" href="#description"></a></h2>
        <h3 class="heading settled" data-level="3.1" id="indication"><span class="secno">3.1. </span><span
                class="content">指示</span><a class="self-link" href="#indication"></a></h3>
        <div class="note" role="note">本节为非规范性内容</div>
        <p>本规范有意不定义用户代理如何“指示”文本匹配。有多种不同的体验和权衡，用户代理可以做出。可能的操作示例包括：</p>
        <ul>
            <li data-md>
                <p>对文本段落进行视觉强调或高亮显示</p>
            <li data-md>
                <p>在页面导航时自动滚动该段落至可见范围</p>
            <li data-md>
                <p>在该段文字上激活用户代理的页面内查找功能</p>
            <li data-md>
                <p>提供“点击以滚动至文本段落”的通知</p>
            <li data-md>
                <p>当未在页面中找到文本段落时提供通知</p>
        </ul>
        <div class="note" role="note"> 操作方式的选择可能对用户安全与隐私产生影响。详细内容见<a href="#security-and-privacy">§ 3.5 安全与隐私</a>。
        </div>
        <h3 class="heading settled" data-level="3.2" id="syntax"><span class="secno">3.2. </span><span
                class="content">语法</span><a class="self-link" href="#syntax"></a></h3>
        <div class="note" role="note">本节为非规范性内容</div>
        <p><a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive">文本指令</a>在<a data-link-type="dfn"
                href="#fragment-directive" id="ref-for-fragment-directive">片段指令</a>中指定（见<a
                href="#the-fragment-directive">§ 3.3 片段指令</a>），格式如下：</p>
        <pre>#:~:text=[prefix-,]start[,end][,-suffix]
          context  |--match--|  context
</pre>
        <p><em>（方括号表示可选参数）</em></p>
        <p>文本参数在匹配前会进行百分号解码。连字符（-）、和号（&amp;）以及逗号（,）等字符在文本参数中会被百分号转义，以避免被解析为文本指令语法的一部分。</p>
        <p>唯一必选的参数是<code>start</code>。如果只指定了<code>start</code>，则以该精确字符串首次出现处为目标文本。</p>
        <div class="example" id="example-4e85550d"><a class="self-link" href="#example-4e85550d"></a>
            <code>#:~:text=an%20example%20text%20fragment</code> 表明精确文本“an example text fragment”为目标文本。
        </div>
        <p>如果还指定了<code>end</code>参数，则文本指令指向页面中的一段文本范围。目标文本范围是从首次出现的<code>start</code>开始，到其后首次出现的<code>end</code>为止。这等价于在<code>start</code>参数中指定完整的文本范围，但可避免因过长的文本指令导致URL膨胀。
        </p>
        <div class="example" id="example-7df2027e"><a class="self-link" href="#example-7df2027e"></a>
            <code>#:~:text=an%20example,text%20fragment</code> 表示从首次出现的“an example”到接下来的首次出现的“text fragment”为目标文本。
        </div>
        <h4 class="heading settled" data-level="3.2.1" id="context-terms"><span class="secno">3.2.1. </span><span
                class="content">上下文术语</span><a class="self-link" href="#context-terms"></a></h4>
        <div class="note" role="note">本节为非规范性内容</div>
        <p>另外两个可选参数即为上下文术语。它们由连字符（-）连接在前缀和后缀处，以区别于<code>start</code>和<code>end</code>参数，可任意组合指定。</p>
        <p>上下文术语用于消歧目标文本片段。上下文术语可分别指定文本片段之前（前缀）和之后（后缀）紧邻的文本内容，允许存在空白字符。</p>
        <div class="note" role="note">
            只有在上下文术语包围目标文本片段时匹配才算成功，且上下文术语与文本片段之间可有任意数量空白字符。这允许上下文术语跨元素边界，比如当目标文本片段位于段落开头且需要以上一个元素的文本作为前缀消歧时。 </div>
        <p>上下文术语不是目标文本片段的一部分，也不会被视觉指示。</p>
        <div class="example" id="example-5c87b699"><a class="self-link" href="#example-5c87b699"></a>
            <code>#:~:text=this%20is-,an%20example,-text%20fragment</code> 可匹配“this is an example text fragment”中的“an
            example”，但不会匹配“here is an example text”中的“an example”。
        </div>
        <h4 class="heading settled" data-level="3.2.2" id="bidi-considerations"><span class="secno">3.2.2. </span><span
                class="content">双向文本注意事项</span><a class="self-link" href="#bidi-considerations"></a></h4>
        <div class="note" role="note">本节为非规范性内容</div>
        <div class="note" role="note"> 参见 <a
                href="https://www.w3.org/International/articles/inline-bidi-markup/uba-basics.en">Unicode
                双向算法基础</a>，了解双向文本的工作原理。 </div>
        <p>由于 URL 字符串为 ASCII 编码，其本身不支持双向文本。但我们想要在页面上定位的内容可能是 LTR（从左到右）、RTL（从右到左）或双向文本。本节直观描述了规范中进一步章节隐含的行为。</p>
        <p>文本片段中每个术语的字符都处于<em>逻辑顺序</em>，即母语读者阅读的顺序（也是内存中字符的存储顺序）。</p>
        <p>同样，<code>prefix</code>与<code>start</code>表示另一个术语前的内容，<code>suffix</code>与<code>end</code>表示后续内容，均为逻辑顺序。</p>
        <p class="note" role="note"><span class="marker">注意：</span>用户代理可将 URL 以更符合本地读者习惯的方式呈现，比如显示为 Unicode。但 URL
            的字符串表达始终是纯 ASCII 字符。</p>
        <div class="example" id="example-b17c0d6b">
            <a class="self-link" href="#example-b17c0d6b"></a> 假设我们要选择<code lang="ar">مِصر‎</code>（埃及，阿拉伯语），前面是<code
                lang="ar">البحرين‎</code>（巴林，阿拉伯语）。先对各个术语进行百分号编码：
            <p><code lang="ar">مِصر‎</code> 变为 "%D9%85%D8%B5%D8%B1"（注：UTF-8 字符 [0xD9,0x85] 为该阿拉伯词的第一个（最右）字符）。</p>
            <p><code lang="ar">البحرين‎</code> 变为 "%D8%A7%D9%84%D8%A8%D8%AD%D8%B1%D9%8A%D9%86"</p>
            <p>文本片段将如下：</p>
            <p><code> :~:text=%D8%A7%D9%84%D8%A8%D8%AD%D8%B1%D9%8A%D9%86-,%D9%85%D8%B5%D8%B1 </code></p>
            <p>浏览器地址栏可按自然 RTL 方向渲染文本，呈现如下：</p>
            <p><code> :~:text=<span lang="ar">البحرين</span>-,<span lang="ar">مِصر</span> </code></p>
        </div>
        <h3 class="heading settled" data-level="3.3" id="the-fragment-directive"><span class="secno">3.3. </span><span
                class="content">片段指令</span><a class="self-link" href="#the-fragment-directive"></a>
        </h3>
        <p>为避免与现有 URL 片段的使用发生兼容性问题，本规范引入了<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="fragment-directive">片段指令</dfn>的概念。它是 URL <a data-link-type="dfn"
                href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment">片段</a>中位于<a
                data-link-type="dfn" href="#fragment-directive-delimiter"
                id="ref-for-fragment-directive-delimiter">片段指令分隔符</a>之后的部分，也可能为 null（如果片段中未出现分隔符）。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="fragment-directive-delimiter">片段指令分隔符</dfn>为字符串 ":~:"，即连续三个码点 U+003A (:)、U+007E (~)、U+003A (:)。</p>
        <div class="note" role="note"> <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive①">片段指令</a>属于 URL 片段。这意味着它总是在 URL 中 U+0023 (#) 之后出现。 </div>
        <div class="example" id="example-6998d91f"><a class="self-link" href="#example-6998d91f"></a> 要为
            https://example.com 添加<a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive②">片段指令</a>，先加上片段：https://example.com#:~:text=foo。 </div>
        <p>片段指令会被解析并处理为单个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="directives">指令</dfn>，即指示用户代理执行某项操作的指令。片段指令中可出现多个指令。</p>
        <div class="note" role="note"> 本规范目前只引入了文本指令，未来可引入其他指令。 </div>
        <div class="example" id="example-9acce0ff">
            <a class="self-link" href="#example-9acce0ff"></a>
            <code>https://example.com#:~:text=foo&amp;text=bar&amp;unknownDirective</code>
            <p>包含 2 个文本指令和 1 个未知指令。</p>
        </div>
        <p>为防止影响页面运行，片段指令会从脚本可访问的 API 中剥离，防止与作者脚本交互。这也确保将来可安全添加更多指令，而不会有 web 兼容性风险。</p>
        <h4 class="heading settled" data-level="3.3.1" id="extracting-the-fragment-directive"><span class="secno">3.3.1.
            </span><span class="content">提取片段指令</span><a class="self-link"
                href="#extracting-the-fragment-directive"></a></h4>
        <p>本节描述了如何将片段指令从脚本中隐藏，以及它如何适配 <a
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-and-session-history"><cite>HTML</cite>
                § 7.4 导航和会话历史</a>。</p>
        <div class="note" role="note">
            本节变化汇总如下：
            <ul>
                <li data-md>
                    <p>会话历史条目现在包含一个新的“指令状态”属性</p>
                <li data-md>
                    <p>所有新条目创建时，指令状态初始为空值。如果新 URL 包含片段指令，该值将写入该状态（否则保持为 null）。</p>
                <li data-md>
                    <p>每当将可能包含片段指令的 URL 写入会话历史时，从 URL 中提取片段指令并存储到条目的指令状态属性。共有四处可能包含片段指令：</p>
                    <ul>
                        <li data-md>
                            <p>典型跨文档“navigate”步骤中</p>
                        <li data-md>
                            <p>基于片段、同文档导航的“navigate to a fragment”步骤中</p>
                        <li data-md>
                            <p>pushState/replaceState 等同步更新下的“URL 和历史更新步骤”中</p>
                        <li data-md>
                            <p>重定向所得 URL 的“create navigation params by fetching”步骤中</p>
                    </ul>
                <li data-md>
                    <p>仅更改片段的同文档导航，且新 URL 未指定指令时，新条目的指令状态指向前一个条目的指令状态。</p>
            </ul>
        </div>
        <p>在 <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#session-history-infrastructure"><cite>HTML</cite>
                § 7.4.1 会话历史</a>中，定义 <a data-link-type="dfn" href="#directive-state"
                id="ref-for-directive-state">指令状态</a>：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#session-history-infrastructure"><cite>HTML</cite>
                        § 7.4.1 会话历史</a>：</strong></p>
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="directive-state">指令状态</dfn>
                保存会创建会话历史条目时的<a data-link-type="dfn" href="#fragment-directive"
                    id="ref-for-fragment-directive③">片段指令</a>值，并用于每次遍历此条目时执行指令（如文本高亮）。其结构为：</p>
            <ul>
                <li data-md>
                    <p><dfn class="dfn-paneled" data-dfn-for="directive state" data-dfn-type="dfn" data-noexport
                            id="directive-state-value">值</dfn>，<a data-link-type="dfn" href="#fragment-directive"
                            id="ref-for-fragment-directive④">片段指令</a><a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string">ASCII 字符串</a>或
                        null，初值为 null。</p>
            </ul>
            <p>同一 <a data-link-type="dfn" href="#directive-state" id="ref-for-directive-state①">指令状态</a>可被多个会话历史条目共享。
            </p>
            <div class="note" role="note">
                <p>片段指令在 URL 设置到会话历史条目前会被移除，而存储于指令状态对象。这避免片段指令暴露给脚本 API，使其可独立指定、不干扰页面业务。</p>
                <p>指令状态是对象而非原始字符串，因为多个连续历史条目可共用同一状态。仅当遍历导致指令状态从一条切换到另一条时，指令（如查找/高亮）才会被处理。</p>
            </div>
        </blockquote>
        <p>在 <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#session-history-entry">会话历史条目</a>
            的定义处补充：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#session-history-entries"><cite>HTML</cite>
                        § 7.4.1.1 会话历史条目</a>：</strong></p>
            <div class="monkeypatch">
                会话历史条目是如下成员的结构体：
                <ul>
                    <li data-md>
                        <p>...</p>
                    <li data-md>
                        <p>持久化用户状态，实现细节定义，初值为 null</p>
                    <li data-md>
                        <p><span class="diff"><dfn class="dfn-paneled" data-dfn-for="she" data-dfn-type="dfn"
                                    data-noexport id="she-directive-state">指令状态</dfn>，一种<a data-link-type="dfn"
                                    href="#directive-state" id="ref-for-directive-state②">指令状态</a>，
                                初值为一个新的<a data-link-type="dfn" href="#directive-state"
                                    id="ref-for-directive-state③">指令状态</a></span></p>
                </ul>
            </div>
        </blockquote>
        <p>增加一个帮助算法，可从<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                id="ref-for-concept-url">URL</a>中移除并返回片段指令字符串：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="note" role="note"> 本算法让 URL 片段以<a data-link-type="dfn" href="#fragment-directive-delimiter"
                    id="ref-for-fragment-directive-delimiter①">片段指令分隔符</a>
                处截断。返回的<a data-link-type="dfn" href="#fragment-directive"
                    id="ref-for-fragment-directive⑤">片段指令</a>包含分隔符后的所有字符（不含分隔符本身）。 </div>
            <div class="issue" id="issue-f4a5d96b"><a class="self-link" href="#issue-f4a5d96b"></a> TODO: 若 URL 片段以
                ':~:' 结尾（即空指令），此时会返回 null，等同于未显式指定指令（且不会覆盖已有指令）。但或许此时应该返回空字符串？这样页面即可通过导航/pushState 到 '#:~:' 来显式清除指令/高亮。
            </div>
            <p>要从<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                    id="ref-for-concept-url①">URL</a>
                <var>url</var>中<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="remove-the-fragment-directive">移除片段指令</dfn>，执行：
            </p>
            <ol>
                <li data-md>
                    <p>令<var>raw fragment</var>为<var>url</var>的<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-fragment"
                            id="ref-for-concept-url-fragment①">fragment</a>。</p>
                <li data-md>
                    <p>令<var>fragment directive</var>为 null。</p>
                <li data-md>
                    <p>如<var>raw fragment</var>非空且包含<a data-link-type="dfn" href="#fragment-directive-delimiter"
                            id="ref-for-fragment-directive-delimiter②">片段指令分隔符</a>：</p>
                    <ol>
                        <li data-md>
                            <p>令<var>position</var>为字符串中首次出现<a data-link-type="dfn" href="#fragment-directive-delimiter"
                                    id="ref-for-fragment-directive-delimiter③">片段指令分隔符</a>第一个码点的位置变量；若无，则为尾部。</p>
                        <li data-md>
                            <p>令<var>new fragment</var>为<var>raw fragment</var>从头至<var>position</var>之间的字符串。</p>
                        <li data-md>
                            <p><var>position</var>增加<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#string-code-point-length"
                                    id="ref-for-string-code-point-length">分隔符码点长度</a>。</p>
                        <li data-md>
                            <p>如果<var>position</var>未越界：</p>
                            <ol>
                                <li data-md>
                                    <p>设<var>fragment directive</var>为<var>raw
                                            fragment</var>自<var>position</var>起至末尾的子串。</p>
                            </ol>
                        <li data-md>
                            <p>设<var>url</var>的<a data-link-type="dfn"
                                    href="https://url.spec.whatwg.org/#concept-url-fragment"
                                    id="ref-for-concept-url-fragment②">fragment</a>为<var>new fragment</var>。</p>
                    </ol>
                <li data-md>
                    <p>返回<var>fragment directive</var>。</p>
            </ol>
            <div class="example" id="example-775c8cc2"><a class="self-link" href="#example-775c8cc2"></a>
                <code>https://example.org/#test:~:text=foo</code> 会被解析为 fragment="test"，<a data-link-type="dfn"
                    href="#fragment-directive" id="ref-for-fragment-directive⑥">片段指令</a>="text=foo"。
            </div>
        </blockquote>
        <p>下述四个猴补丁修改了会话历史条目的创建。当 URL 可能包含片段指令时，将其移除并存于<a data-link-type="dfn" href="#directive-state"
                id="ref-for-directive-state④">指令状态</a>。</p>
        <p>在<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"
                id="ref-for-navigate">navigate</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#beginning-navigation"><cite>HTML</cite>
                        § 7.4.2.2 开始导航</a>：</strong></p>
            <div class="monkeypatch">
                导航 navigable 至 URL <var>url</var>...：
                <ol>
                    <li data-md>
                        <p>...</p>
                    <li value="14">将 navigable 的 ongoing navigation 设为 navigationId。
                    <li data-md>
                        <p>若 url 的 scheme 为 "javascript"，则...</p>
                    <li data-md>
                        <p>并行执行以下步骤：</p>
                        <ol>
                            <li data-md>
                                <p>...</p>
                            <li value="5">若 url 为 about:blank，则将 documentState 的 origin 设为 documentState 的 initiator
                                origin。
                            <li data-md>
                                <p>否则，如 url 为 about:srcdoc，则 documentState 的 origin 设为 navigable 的父文档 origin。</p>
                            <li data-md>
                                <strike>Let historyEntry be a new session history entry, with its URL set to url and
                                    its document state set to documentState.</strike>
                            <li value="7"><span class="diff">令<var>fragment directive</var>为对<var>url</var>执行<a
                                        data-link-type="dfn" href="#remove-the-fragment-directive"
                                        id="ref-for-remove-the-fragment-directive">移除片段指令</a>结果。</span>
                            <li data-md>
                                <p><span class="diff">令<var>directive state</var>为新的<a data-link-type="dfn"
                                            href="#directive-state" id="ref-for-directive-state⑤">指令状态</a>，其<a
                                            data-link-type="dfn" href="#directive-state-value"
                                            id="ref-for-directive-state-value">值</a>设为<var>fragment
                                            directive</var>。</span></p>
                            <li data-md>
                                <p><span class="diff">创建会话历史条目 historyEntry，URL 设为<var>url</var>，文档状态设为 documentState，<a
                                            data-link-type="dfn" href="#she-directive-state"
                                            id="ref-for-she-directive-state">指令状态</a>设为<var>directive
                                            state</var>。</span></p>
                            <li data-md>
                                <p>设 navigationParams 为 null。</p>
                            <li data-md>
                                <p>...</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid"
                id="319d7c290">navigate to a fragment</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-fragid"><cite>HTML</cite>
                        § 7.4.2.3.3 片段导航</a>：</strong></p>
            <div class="monkeypatch">
                导航至片段 navigable <var>navigable</var>，...：
                <ol>
                    <li data-md>
                        <p><span class="diff">令<var>directive state</var>为 navigable 当前活动会话历史条目的<a data-link-type="dfn"
                                    href="#she-directive-state" id="ref-for-she-directive-state①">指令状态</a>。</span></p>
                    <li data-md>
                        <p><span class="diff">令<var>fragment directive</var>为执行<a data-link-type="dfn"
                                    href="#remove-the-fragment-directive"
                                    id="ref-for-remove-the-fragment-directive①">移除片段指令</a>于<var>url</var>的结果。</span></p>
                    <li data-md>
                        <p><span class="diff">如<var>fragment directive</var>非空：</span></p>
                        <div class="note" role="note">否则，仅片段变化且未指定指令则重用活动条目的指令状态，可防止片段变化后高亮丢失。</div>
                        <ol>
                            <li data-md>
                                <p><span class="diff">令<var>directive state</var>为新的<a data-link-type="dfn"
                                            href="#directive-state" id="ref-for-directive-state⑥">指令状态</a>，<a
                                            data-link-type="dfn" href="#directive-state-value"
                                            id="ref-for-directive-state-value①">值</a>为<var>fragment
                                            directive</var>。</span></p>
                        </ol>
                    <li data-md>
                        <p>创建会话历史条目 historyEntry：</p>
                        <ul>
                            <li data-md>
                                <p>URL url</p>
                            <li data-md>
                                <p>文档状态为 navigable 当前活动会话历史条目的文档状态</p>
                            <li data-md>
                                <p>滚动恢复模式为 navigable 当前活动会话历史条目的滚动恢复模式</p>
                            <li data-md>
                                <p><span class="diff"><a data-link-type="dfn" href="#she-directive-state"
                                            id="ref-for-she-directive-state②">指令状态</a>为<var>directive state</var></span>
                                </p>
                        </ul>
                    <li data-md>
                        <p>如 historyHandling 为"replace"，则 entryToReplace 为 navigable 当前活动会话历史条目，否则为 null。</p>
                    <li data-md>
                        <p>...</p>
                </ol>
            </div>
        </blockquote>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#url-and-history-update-steps">URL 和
                历史更新步骤</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-non-frag-sync"><cite>HTML</cite>
                        § 7.4.4 非片段同步“导航”</a>：</strong></p>
            <div class="monkeypatch">
                “URL 和历史更新步骤”，入参 Document <var>document</var>，...：
                <ol>
                    <li data-md>
                        <p>令<var>navigable</var>为<var>document</var>的 node navigable。</p>
                    <li data-md>
                        <p>令<var>activeEntry</var>为<var>navigable</var>当前活动会话历史条目。</p>
                    <li data-md>
                        <p><span class="diff">令<var>fragment directive</var>为对<var>newUrl</var>执行<a data-link-type="dfn"
                                    href="#remove-the-fragment-directive"
                                    id="ref-for-remove-the-fragment-directive②">移除片段指令</a>得到的结果。</span></p>
                    <li data-md>
                        <p>新建会话历史条目<var>historyEntry</var>，其中</p>
                        <ul>
                            <li data-md>
                                <p>URL <var>newUrl</var></p>
                            <li data-md>
                                <p>...</p>
                            <li data-md>
                                <p><span class="diff"><a data-link-type="dfn" href="#she-directive-state"
                                            id="ref-for-she-directive-state③">指令状态</a>
                                        取自<var>activeEntry</var>的<a data-link-type="dfn" href="#she-directive-state"
                                            id="ref-for-she-directive-state④">指令状态</a></span></p>
                        </ul>
                    <li data-md>
                        <p>如 <var>document</var> 的 is initial about:blank 为 true，设 historyHandling 为"replace"。</p>
                    <li data-md>
                        <p>如 historyHandling 为"push"，则：</p>
                        <ol>
                            <li data-md>
                                <p>历史对象 index 加一。</p>
                            <li data-md>
                                <p>历史对象长度设置为 index+1。</p>
                            <li data-md>
                                <p><span class="diff">如<var>newUrl</var>不等于<var>activeEntry</var>的（排除 fragment
                                        后）URL，或<var>fragment directive</var>非空，则：</span>
                                </p>
                                <div class="note" role="note">否则仅片段变更且未指定指令，则重用激活条目的指令状态，防止片段变更后高亮丢失。</div>
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">将<var>historyEntry</var>的<a data-link-type="dfn"
                                                    href="#she-directive-state"
                                                    id="ref-for-she-directive-state⑤">指令状态</a>设为新的<a
                                                    data-link-type="dfn" href="#directive-state"
                                                    id="ref-for-directive-state⑦">指令状态</a>，
                                                其<a data-link-type="dfn" href="#directive-state-value"
                                                    id="ref-for-directive-state-value②">值</a>设为<var>fragment
                                                    directive</var>。</span></p>
                                </ol>
                        </ol>
                    <li data-md>
                        <p><span class="diff">否则如<var>fragment directive</var>非空，将<var>historyEntry</var>的<a
                                    data-link-type="dfn" href="#she-directive-state"
                                    id="ref-for-she-directive-state⑥">指令状态</a>的<a data-link-type="dfn"
                                    href="#directive-state-value"
                                    id="ref-for-directive-state-value③">值</a>设为<var>fragment directive</var>。</span></p>
                    <li data-md>
                        <p>如 serializedData 不为空，则恢复给定 document 和 newEntry 的历史对象状态。</p>
                </ol>
            </div>
        </blockquote>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"
                id="fc0e1ad00"> create navigation params by fetching</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#populating-a-session-history-entry"><cite>HTML</cite>
                        § 7.4.5 填充会话历史条目</a>：</strong></p>
            <div class="monkeypatch">
                “通过获取创建导航参数”，入参会话历史条目<var>entry</var>，...：
                <ol>
                    <li data-md>
                        <p class="assertion">断言：此步骤在并行执行。</p>
                    <li data-md>
                        <p>...</p>
                    <li value="17">令 currentURL 为请求的当前 URL。
                    <li data-md>
                        <p>令 commitEarlyHints 为 null。</p>
                    <li data-md>
                        <p>循环：</p>
                        <ol>
                            <li data-md>
                                <p>如请求的 reserved client 非空且 currentURL 的源与 reserved client 的创建 URL 源不同，则：</p>
                            <li data-md>
                                <p>...</p>
                            <li value="21">将 currentURL 设为 <var>locationURL</var>。
                            <li data-md>
                                <p><span class="diff">令<var>fragment directive</var>为对<var>locationURL</var>执行<a
                                            data-link-type="dfn" href="#remove-the-fragment-directive"
                                            id="ref-for-remove-the-fragment-directive③">移除片段指令</a>的结果。</span></p>
                            <li data-md>
                                <strike class="diff">将 <var>entry</var> 的 URL 设为 currentURL。</strike>
                            <li data-md>
                                <p><span class="diff">将 <var>entry</var> 的 URL 设为 <var>locationURL</var>。</span></p>
                            <li data-md>
                                <p><span class="diff">将 <var>entry</var> 的<a data-link-type="dfn"
                                            href="#she-directive-state" id="ref-for-she-directive-state⑦">指令状态</a>的<a
                                            data-link-type="dfn" href="#directive-state-value"
                                            id="ref-for-directive-state-value④">值</a>设为<var>fragment
                                            directive</var>。</span></p>
                            <li data-md>
                                <p>如 <var>locationURL</var> 的 scheme 不是 fetch scheme，则返回新的非 fetch scheme 导航参数，initiator
                                    origin 为请求的 current URL 源</p>
                            <li data-md>
                                <p>...</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <div class="note" role="note">
            <p> 由于文档由历史条目填充，其<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url"
                    id="ref-for-concept-document-url">URL</a>
                并不包含片段指令。同理，window 的 <code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#location" id="ref-for-location">Location</a></code>
                对象是<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url"
                    id="ref-for-concept-url②">URL</a>的显示（当前活动文档），其所有 getter 都返回去除片段指令的版本。 </p>
            <p> 同时，<code
                    class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#hashchangeevent" id="ref-for-hashchangeevent">HashChangeEvent</a></code>
                在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#updating-the-document">片段变化时</a>
                会触发，但如果导航或遍历仅更改了片段指令，则不会触发 <code>hashchange</code>。
            </p>
            <p> 下例用于说明各种边界情况。 </p>
        </div>
        <div class="example" id="example-c4fd5b50">
            <a class="self-link" href="#example-c4fd5b50"></a>
            <pre>window.location = "https://example.com#page1:~:hello";
console.log(window.location.href); // 'https://example.com#page1'
console.log(window.location.hash); // '#page1'
</pre>
            <p>首次导航创建了新的会话历史条目，该条目的 URL 已去除片段指令："https://example.com#page1"。条目的指令状态值为 "hello"。由于文档由条目填充，web API 返回的 URL
                不含片段指令。</p>
            <pre>location.hash = "page2";
console.log(location.href); // 'https://example.com#page2'
</pre>
            <p>同文档导航仅更改片段。这会在 <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid"
                    id="319d7c291">navigate to
                    a fragment</a> 步骤中新建一个历史条目。但因为只变更片段，新条目的指令状态仍引用首个条目的状态，值为 "bar"。</p>
            <pre>onhashchange = () => console.assert(false, "hashchange doesn’t fire.");
location.hash = "page2:~:world";
console.log(location.href); // 'https://example.com#page2'
onhashchange = null;
</pre>
            <p>同文档导航仅更改片段但包含片段指令。此时新条目含有自己的指令状态，值为 "fizz"。</p>
            <p>由于页面可见 fragment 未变，仅片段指令变化，因此不会触发 hashchange。原因在于 hashchange 比较会话历史条目的 URL，已移除片段指令。</p>
            <pre>history.pushState("", "", "page3");
console.log(location.href); // 'https://example.com/page3'
</pre>
            <p>pushState 为同一文档创建了新历史条目。由于非片段 URL 改变，该条目指令状态值初值为 null。</p>
        </div>
        <div class="example" id="example-f4d8b076">
            <a class="self-link" href="#example-f4d8b076"></a> 其他未设置到会话历史条目的 URL 不会移除片段指令。
            <p>对 URL 对象：</p>
            <pre>let url = new URL('https://example.com#foo:~:bar');
console.log(url.href); // 'https://example.com#foo:~:bar'
console.log(url.hash); // '#foo:~:bar'

document.url = url;
console.log(document.url.href); // 'https://example.com#foo:~:bar'
console.log(document.url.hash); // '#foo:~:bar'

</pre>
            <p><code>&lt;a></code> 或 <code>&lt;area></code> 元素：</p>
            <pre>&lt;a id='anchor' href="https://example.com#foo:~:bar">Anchor&lt;/a>
&lt;script>
  console.log(anchor.href); // 'https://example.com#foo:~:bar'
  console.log(anchor.hash); // '#foo:~:bar'
&lt;/script>
</pre>
        </div>
        <h4 class="heading settled" data-level="3.3.2" id="applying-directives-to-a-document"><span class="secno">3.3.2.
            </span><span class="content">将指令应用于文档</span><a class="self-link"
                href="#applying-directives-to-a-document"></a></h4>
        <p>上节介绍了如何将<a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive⑦">片段指令</a>从URL中分离出来，并存储在会话历史条目中。</p>
        <p>本节定义了导航和遍历时，历史条目中的<a data-link-type="dfn" href="#she-directive-state"
                id="ref-for-she-directive-state⑧">指令状态</a>如何及何时被用来将会话历史条目关联的指令应用到<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">文档</a>上。</p>
        <blockquote>
            <p><strong>猴补丁 <a href="https://dom.spec.whatwg.org/#interface-document"><cite>DOM</cite> § 4.5
                        文档接口</a>：</strong></p>
            <p>每个文档都有一个相关的<dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport
                    id="document-pending-text-directives">待处理文本指令</dfn>，它要么为null，要么为<a data-link-type="dfn"
                    href="https://infra.spec.whatwg.org/#list" id="ref-for-list">列表</a>
                （包含<a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①">文本指令</a>）。初始为null。</p>
        </blockquote>
        <p>在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#update-document-for-history-step-application"
                id="ref-for-update-document-for-history-step-application">历史步骤应用时更新文档</a>的定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#updating-the-document"><cite>HTML</cite>
                        § 7.4.6.2 更新文档</a>：</strong></p>
            <div class="monkeypatch">
                更新历史步骤应用时的文档，参数为 Document <var>document</var>，会话历史条目 <var>entry</var>，...
                <ol>
                    <li data-md>
                        <p>...</p>
                    <li value="4">将<var>document</var>的历史对象 length 设为 scriptHistoryLength
                    <li data-md>
                        <p>如果<var>documentsEntryChanged</var>为真，则：</p>
                        <ol>
                            <li data-md>
                                <p>令<var>oldURL</var>为<var>document</var>的最新条目的URL。</p>
                            <li data-md>
                                <div class="diff">
                                    若<var>document</var>的最新条目的<a data-link-type="dfn" href="#she-directive-state"
                                        id="ref-for-she-directive-state⑨">指令状态</a>与<var>entry</var>的<a
                                        data-link-type="dfn" href="#she-directive-state"
                                        id="ref-for-she-directive-state①⓪">指令状态</a>不同，则：
                                    <ol>
                                        <li data-md>
                                            <p>令<var>fragment directive</var>为<var>entry</var>的<a data-link-type="dfn"
                                                    href="#she-directive-state"
                                                    id="ref-for-she-directive-state①①">指令状态</a>的<a data-link-type="dfn"
                                                    href="#directive-state-value"
                                                    id="ref-for-directive-state-value⑤">值</a>。</p>
                                        <li data-md>
                                            <p>将<var>document</var>的<a data-link-type="dfn"
                                                    href="#document-pending-text-directives"
                                                    id="ref-for-document-pending-text-directives">待处理文本指令</a>设为<a
                                                    data-link-type="dfn" href="#parse-the-fragment-directive"
                                                    id="ref-for-parse-the-fragment-directive">解析</a><var>fragment
                                                    directive</var>的结果。</p>
                                    </ol>
                                </div>
                        </ol>
                    <li data-md>
                        <p>将<var>document</var>的最新条目设为<var>entry</var></p>
                    <li data-md>
                        <p>...</p>
                </ol>
            </div>
        </blockquote>
        <h4 class="heading settled" data-level="3.3.3" id="fragment-directive-grammar"><span class="secno">3.3.3.
            </span><span class="content">片段指令语法</span><a class="self-link" href="#fragment-directive-grammar"></a></h4>
        <p class="note" role="note"><span class="marker">注：</span>本节为非规范性内容。</p>
        <p class="note" role="note"><span class="marker">注：</span>本语法仅供参考，解析的规则和步骤将在<a href="#text-directives">§ 3.4
                文本指令</a>节以命令方式给出。若实际行为与本语法描述有出入，应以那一节具体步骤为准。</p>
        <p><a data-link-type="dfn" href="#fragmentdirectiveproduction"
                id="ref-for-fragmentdirectiveproduction">FragmentDirective</a> 可包含多个由 “&amp;”
            字符分隔的指令。目前允许页面存在多个文本指令以同时标示多段字符串，也为将来添加组合其它指令类型做扩展准备。为保持扩展性，遇到未知指令时不会导致整个解析失败。</p>
        <p>若一个<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string"
                id="ref-for-string">字符串</a>匹配下述EBNF（扩展巴科斯范式）产生式，则为合法片段指令：</p>
        <dl>
            <dt> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="fragmentdirectiveproduction"><code>FragmentDirective</code></dfn> <code>::=</code>
            <dd> <code>(<a data-link-type="dfn" href="#textdirective" id="ref-for-textdirective">TextDirective</a> | <a data-link-type="dfn" href="#unknowndirective" id="ref-for-unknowndirective">UnknownDirective</a>) ("&amp;" <a data-link-type="dfn" href="#fragmentdirectiveproduction" id="ref-for-fragmentdirectiveproduction①">FragmentDirective</a>)?</code>
            <dt> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirective"><code>TextDirective</code></dfn> <code>::=</code>
            <dd> <code>"text="<a data-link-type="dfn" href="#characterstring" id="ref-for-characterstring">CharacterString</a></code>
            <dt> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="unknowndirective"><code>UnknownDirective</code></dfn> <code>::=</code>
            <dd> <code><a data-link-type="dfn" href="#characterstring" id="ref-for-characterstring①">CharacterString</a> - <a data-link-type="dfn" href="#textdirective" id="ref-for-textdirective①">TextDirective</a></code>
            <dt> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="characterstring"><code>CharacterString</code></dfn> <code>::=</code>
            <dd> <code>(<a data-link-type="dfn" href="#explicitchar" id="ref-for-explicitchar">ExplicitChar</a> | <a data-link-type="dfn" href="#percentencodedbyte" id="ref-for-percentencodedbyte">PercentEncodedByte</a>)*</code>
            <dt> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="explicitchar"><code>ExplicitChar</code></dfn> <code>::=</code>
            <dd>
                <code>[a-zA-Z0-9] | "!" | "$" | "'" | "(" | ")" | "*" | "+" | "." | "/" | ":" |
    ";" | "=" | "?" | "@" | "_" | "~" | "," | "-"</code>
                <div class="note" role="note"> <a data-link-type="dfn" href="#explicitchar"
                        id="ref-for-explicitchar①">ExplicitChar</a> 可为任何<a data-link-type="dfn"
                        href="https://url.spec.whatwg.org/#url-code-points" id="ref-for-url-code-points">URL
                        码点</a>，除了“&amp;”。</div>
        </dl>
        <p>若一个<a data-link-type="dfn" href="#textdirective" id="ref-for-textdirective②">TextDirective</a>匹配下述产生式，则为合法：
        </p>
        <dl>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="validtextdirective"><code>ValidTextDirective</code></dfn> <code>::=</code>
            <dd><code>"text=" <a data-link-type="dfn" href="#textdirectiveparameters" id="ref-for-textdirectiveparameters">TextDirectiveParameters</a></code>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirectiveparameters"><code>TextDirectiveParameters</code></dfn> <code>::=</code>
            <dd> <code> (<a data-link-type="dfn" href="#textdirectiveprefix" id="ref-for-textdirectiveprefix">TextDirectivePrefix</a> ",")? <a data-link-type="dfn" href="#textdirectivestring" id="ref-for-textdirectivestring">TextDirectiveString</a> ("," <a data-link-type="dfn" href="#textdirectivestring" id="ref-for-textdirectivestring①">TextDirectiveString</a>)?  ("," <a data-link-type="dfn" href="#textdirectivesuffix" id="ref-for-textdirectivesuffix">TextDirectiveSuffix</a>)? </code>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirectiveprefix"><code>TextDirectivePrefix</code></dfn> <code>::=</code>
            <dd><code><a data-link-type="dfn" href="#textdirectivestring" id="ref-for-textdirectivestring②">TextDirectiveString</a>"-"</code>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirectivesuffix"><code>TextDirectiveSuffix</code></dfn> <code>::=</code>
            <dd><code>"-"<a data-link-type="dfn" href="#textdirectivestring" id="ref-for-textdirectivestring③">TextDirectiveString</a></code>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirectivestring"><code>TextDirectiveString</code></dfn> <code>::=</code>
            <dd><code>(<a data-link-type="dfn" href="#textdirectiveexplicitchar" id="ref-for-textdirectiveexplicitchar">TextDirectiveExplicitChar</a> | <a data-link-type="dfn" href="#percentencodedbyte" id="ref-for-percentencodedbyte①">PercentEncodedByte</a>)+</code>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="textdirectiveexplicitchar"><code>TextDirectiveExplicitChar</code></dfn> <code>::=</code>
            <dd>
                <code> [a-zA-Z0-9] | "!" | "$" | "'" | "(" | ")" | "*" | "+" | "." | "/" | ":" |
    ";" | "=" | "?" | "@" | "_" | "~" </code>
                <div class="note" role="note"> <a data-link-type="dfn" href="#textdirectiveexplicitchar"
                        id="ref-for-textdirectiveexplicitchar①">TextDirectiveExplicitChar</a>
                    为任何未在<a data-link-type="dfn" href="#fragmentdirectiveproduction"
                        id="ref-for-fragmentdirectiveproduction②">FragmentDirective</a>或<a data-link-type="dfn"
                        href="#validtextdirective" id="ref-for-validtextdirective">ValidTextDirective</a>语法中显式用到的
                    <a data-link-type="dfn" href="https://url.spec.whatwg.org/#url-code-points"
                        id="ref-for-url-code-points①">URL 码点</a>，即“&amp;”“-”“,”。文档中涉及“&amp;”“-”“,”时需百分号编码。
                </div>
            <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="percentencodedbyte"><code>PercentEncodedByte</code></dfn> <code>::=</code>
            <dd><code>"%" [a-zA-Z0-9][a-zA-Z0-9]</code>
        </dl>
        <h3 class="heading settled" data-level="3.4" id="text-directives"><span class="secno">3.4. </span><span
                class="content">文本指令</span><a class="self-link" href="#text-directives"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="text-directive">文本指令</dfn>是一种<a
                data-link-type="dfn" href="#directives" id="ref-for-directives">指令</a>，用于代表要向用户指示的文本范围。它是一个包含四个字符串的<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">结构体</a>：<dfn
                class="dfn-paneled" data-dfn-for="text directive" data-dfn-type="dfn" data-noexport
                id="text-directive-start">start</dfn>、<dfn class="dfn-paneled" data-dfn-for="text directive"
                data-dfn-type="dfn" data-noexport id="text-directive-end">end</dfn>、<dfn class="dfn-paneled"
                data-dfn-for="text directive" data-dfn-type="dfn" data-noexport id="text-directive-prefix">prefix</dfn>、
            <dfn class="dfn-paneled" data-dfn-for="text directive" data-dfn-type="dfn" data-noexport
                id="text-directive-suffix">suffix</dfn>。<a data-link-type="dfn" href="#text-directive-start"
                id="ref-for-text-directive-start">start</a>要求非null。其余三项可为null，表示未提供。空字符串在这四项中都是无效值。
        </p>
        <p>各部分含义和用法见<a href="#syntax">§ 3.2 语法</a>。</p>
        <div class="algorithm" data-algorithm="percent-decode a text directive term">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="percent-decode-a-text-directive-term">对文本指令项进行百分号解码</dfn>，输入 <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">字符串</a>
            <var>term</var>，执行步骤：
            <ol class="algorithm">
                <li data-md>
                    <p>如<var>term</var>为 null，则返回 null。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert">断言</a>：<var>term</var>是<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string①">ASCII 字符串</a>。
                    </p>
                <li data-md>
                    <p>令<var>decoded bytes</var>为对<var>term</var>执行<a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#string-percent-decode"
                            id="ref-for-string-percent-decode">百分号解码</a>的结果。</p>
                <li data-md>
                    <p>返回对<var>decoded bytes</var>执行<a data-link-type="dfn"
                            href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom"
                            id="ref-for-utf-8-decode-without-bom">不带 BOM 的 UTF-8 解码</a>结果。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="parse a text directive">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-a-text-directive">解析文本指令</dfn>，参数为 <a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">字符串</a> <var>text
                directive value</var> 时，执行如下步骤：
            <div class="note" role="note">
                <p>本算法以单一文本指令值字符串为输入（如 "prefix-,foo,bar"），尝试将其解析为指令组件（如 ("prefix", "foo", "bar", null)）。各部分含义和用法见<a
                        href="#syntax">§ 3.2 语法</a>。</p>
                <p>若输入无效则返回 null，否则返回<a data-link-type="dfn" href="#text-directive"
                        id="ref-for-text-directive②">文本指令</a>。</p>
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>令<var>prefix</var>、<var>suffix</var>、<var>start</var>、<var>end</var>均为null。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert①">断言</a>：<var>text directive value</var>是无 <a data-link-type="dfn"
                            href="https://url.spec.whatwg.org/#fragment-percent-encode-set"
                            id="ref-for-fragment-percent-encode-set">片段百分号编码集合</a>及U+0026（&amp;）的 <a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string"
                            id="ref-for-ascii-string②">ASCII字符串</a>。</p>
                <li data-md>
                    <p>令<var>tokens</var>为对<var>text directive value</var>以U+002C（,）<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#strictly-split" id="ref-for-strictly-split">严格分割</a>的<a
                            data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list①">字符串列表</a>。</p>
                <li data-md>
                    <p>如<var>tokens</var><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size"
                            id="ref-for-list-size">长度</a>小于1或大于4，则返回null。</p>
                <li data-md>
                    <p>如<var>tokens</var>首项<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#string-ends-with"
                            id="ref-for-string-ends-with">结尾为</a>U+002D（-）：</p>
                    <ol>
                        <li data-md>
                            <p>设<var>prefix</var>为<var>tokens</var>[0]的<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#code-point-substring"
                                    id="ref-for-code-point-substring">从头截取长度=本身长度-1的子串</a>。</p>
                        <li data-md>
                            <p>移除<var>tokens</var>首项。</p>
                        <li data-md>
                            <p>如<var>prefix</var>为空或包含U+002D（-），则返回null。</p>
                        <li data-md>
                            <p>如<var>tokens</var>已<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#list-empty"
                                    id="ref-for-list-empty">空</a>，则返回null。</p>
                    </ol>
                <li data-md>
                    <p>如<var>tokens</var>末项<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#string-starts-with"
                            id="ref-for-string-starts-with">起始为</a>U+002D（-）：</p>
                    <ol>
                        <li data-md>
                            <p>设<var>suffix</var>为<var>tokens</var>末项从第1位起至末尾的子串。</p>
                        <li data-md>
                            <p>移除<var>tokens</var>末项。</p>
                        <li data-md>
                            <p>如<var>suffix</var>为空或包含U+002D（-），则返回null。</p>
                        <li data-md>
                            <p>如<var>tokens</var>已<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#list-empty"
                                    id="ref-for-list-empty①">空</a>，则返回null。</p>
                    </ol>
                <li data-md>
                    <p>如<var>tokens</var><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size"
                            id="ref-for-list-size①">长度</a>>2，则返回null。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert②">断言</a>：<var>tokens</var><a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">长度</a>为1或2。</p>
                <li data-md>
                    <p>设<var>start</var>为<var>tokens</var>首项。</p>
                <li data-md>
                    <p>移除<var>tokens</var>首项。</p>
                <li data-md>
                    <p>如<var>start</var>为空，或包含U+002D（-），则返回null。</p>
                <li data-md>
                    <p>如<var>tokens</var>非<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty"
                            id="ref-for-list-empty②">空</a>：</p>
                    <ol>
                        <li data-md>
                            <p>设<var>end</var>为<var>tokens</var>首项。</p>
                        <li data-md>
                            <p>如<var>end</var>为空或含U+002D（-），则返回null。</p>
                    </ol>
                <li data-md>
                    <p>返回新<a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive③">文本指令</a>：</p>
                    <dl class="props">
                        <dt><a data-link-type="dfn" href="#text-directive-prefix"
                                id="ref-for-text-directive-prefix">prefix</a>
                        <dd>对<var>prefix</var>进行<a data-link-type="dfn" href="#percent-decode-a-text-directive-term"
                                id="ref-for-percent-decode-a-text-directive-term">百分号解码</a>
                        <dt><a data-link-type="dfn" href="#text-directive-start"
                                id="ref-for-text-directive-start①">start</a>
                        <dd>对<var>start</var>进行<a data-link-type="dfn" href="#percent-decode-a-text-directive-term"
                                id="ref-for-percent-decode-a-text-directive-term①">百分号解码</a>
                        <dt><a data-link-type="dfn" href="#text-directive-end" id="ref-for-text-directive-end">end</a>
                        <dd>对<var>end</var>进行<a data-link-type="dfn" href="#percent-decode-a-text-directive-term"
                                id="ref-for-percent-decode-a-text-directive-term②">百分号解码</a>
                        <dt><a data-link-type="dfn" href="#text-directive-suffix"
                                id="ref-for-text-directive-suffix">suffix</a>
                        <dd>对<var>suffix</var>进行<a data-link-type="dfn" href="#percent-decode-a-text-directive-term"
                                id="ref-for-percent-decode-a-text-directive-term③">百分号解码</a>
                    </dl>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="parse the fragment directive">
            <p>要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="parse-the-fragment-directive">解析片段指令</dfn>，参数为<a data-link-type="dfn"
                    href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string③">ASCII 字符串</a>
                <var>fragment
                    directive</var>，执行如下步骤：
            </p>
            <div class="note" role="note"> 本算法将片段指令字符串（即 “:~:” 后的部分）解析为<a data-link-type="dfn" href="#text-directive"
                    id="ref-for-text-directive④">文本指令</a>对象列表。可返回空列表。</div>
            <ol class="algorithm">
                <li data-md>
                    <p>令<var>directives</var>为<var>fragment directive</var>以U+0026（&amp;）<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#strictly-split"
                            id="ref-for-strictly-split①">严格分割</a>后的字符串数组。</p>
                <li data-md>
                    <p>令<var>output</var>为初始为空的<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list②">文本指令列表</a>。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate">对每个</a><a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">字符串</a>
                        <var>directive</var>：
                    </p>
                    <ol>
                        <li data-md>
                            <p>如<var>directive</var>未<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#string-starts-with"
                                    id="ref-for-string-starts-with①">以 “text=” 开头</a>，则<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#iteration-continue"
                                    id="ref-for-iteration-continue">跳过</a>。</p>
                        <li data-md>
                            <p>令<var>text directive value</var>为<var>directive</var>下标5起至末尾的子串。</p>
                            <div class="note" role="note">注：此处可能为空字符串。</div>
                        <li data-md>
                            <p>令<var>parsed text directive</var>为<a data-link-type="dfn" href="#parse-a-text-directive"
                                    id="ref-for-parse-a-text-directive">解析文本指令</a>所获。</p>
                        <li data-md>
                            <p>如<var>parsed text directive</var>非空，将其<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#list-append"
                                    id="ref-for-list-append">添加</a>到<var>output</var>。</p>
                    </ol>
                <li data-md>
                    <p>返回<var>output</var>。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.4.1" id="invoking-text-directives"><span class="secno">3.4.1.
            </span><span class="content">调用文本指令</span><a class="self-link" href="#invoking-text-directives"></a></h4>
        <p>本节描述如何处理和调用文档<a data-link-type="dfn" href="#document-pending-text-directives"
                id="ref-for-document-pending-text-directives①">待处理文本指令</a>，以指示相关的文本段落。</p>
        <div class="note" role="note">
            本节总结的变更：
            <ul>
                <li data-md>
                    <p>修改指示部分的处理模型，尝试将<a data-link-type="dfn" href="#document-pending-text-directives"
                            id="ref-for-document-pending-text-directives②">待处理文本指令</a>解析为<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range"
                            id="ref-for-concept-range">范围</a>，作为返回的指示部分。</p>
                <li data-md>
                    <p>修改“滚动到片段”以在指示部分为<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                            id="ref-for-concept-range①">范围</a>时正确滚动并设置Document的目标元素。</p>
                <li data-md>
                    <p>确保当用户代理完成当前导航/遍历的片段查找后，将<a data-link-type="dfn" href="#document-pending-text-directives"
                            id="ref-for-document-pending-text-directives③">待处理文本指令</a>重置为null。</p>
                <li data-md>
                    <p>如果用户代理完成文本指令的查找，确保继续尝试常规片段作为后备。</p>
            </ul>
        </div>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#the-indicated-part-of-the-document">
                指示部分</a>中，允许片段指示<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②">范围</a>。做如下修改：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scrolling-to-a-fragment"><cite>HTML</cite>
                        § 7.4.6.3 滚动到片段</a>：</strong></p>
            <div class="monkeypatch">
                对于HTML文档<var>document</var>，必须遵循如下处理模型，以确定其指示部分：
                <ol>
                    <li data-md>
                        <p><span class="diff">令<var>text directives</var>为文档的<a data-link-type="dfn"
                                    href="#document-pending-text-directives"
                                    id="ref-for-document-pending-text-directives④">待处理文本指令</a>。</span>
                        </p>
                    <li data-md>
                        <p><span class="diff">如<var>text directives</var>非null：</span></p>
                        <ol>
                            <li data-md>
                                <p><span class="diff">令<var>ranges</var>为对<var>text directives</var>及文档执行<a
                                            data-link-type="dfn" href="#invoke-text-directives"
                                            id="ref-for-invoke-text-directives">调用文本指令</a>步骤所得的<a data-link-type="dfn"
                                            href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">列表</a>。</span>
                                </p>
                            <li data-md>
                                <p><span class="diff">如<var>ranges</var>非空：</span></p>
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">令<var>firstRange</var>为<var>ranges</var>的首项。</span></p>
                                    <li data-md>
                                        <p><span class="diff">以<a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-range"
                                                    id="ref-for-concept-range③">range</a>方式，对<var>ranges</var>内每个范围进行实现自定义的视觉指示。该指示不得从作者脚本中观察到。见<a
                                                    href="#indicating-the-text-match">§ 3.7 指示文本匹配</a>。</span></p>
                                        <div class="note" role="note"> <var>ranges</var>中的第一个<a data-link-type="dfn"
                                                href="https://dom.spec.whatwg.org/#concept-range"
                                                id="ref-for-concept-range④">范围</a>会滚动至可视区，但所有范围都应高亮指示给用户。 </div>
                                    <li data-md>
                                        <p><span
                                                class="diff">将<var>firstRange</var>设为<var>document</var>的指示部分并返回。</span>
                                        </p>
                                </ol>
                        </ol>
                    <li data-md>
                        <p>令fragment为文档URL的片段。</p>
                    <li data-md>
                        <p>如fragment为空字符串，则返回特殊值“文档顶端”。</p>
                    <li data-md>
                        <p>令potentialIndicatedElement为给定文档和片段查找可能的指示元素结果。</p>
                    <li data-md>
                        <p>...</p>
                </ol>
            </div>
        </blockquote>
        <p>在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier"
                id="ref-for-scroll-to-the-fragment-identifier">滚动到片段</a>中，处理指示部分为<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range⑤">范围</a>的情形，并在启用强制顶部加载策略时阻止片段滚动。做如下修改：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scrolling-to-a-fragment"><cite>HTML</cite>
                        § 7.4.6.3 滚动到片段</a>：</strong></p>
            <div class="monkeypatch">
                <ol>
                    <li data-md>
                        <p>若document的指示部分为null，则将document的目标元素设为null。</p>
                    <li data-md>
                        <p>否则，如document的指示部分为文档顶端，则：</p>
                        <ol>
                            <li data-md>
                                <p>将document的目标元素设为null。</p>
                            <li data-md>
                                <p>将文档滚动至开头。</p>
                            <li data-md>
                                <p>返回。</p>
                        </ol>
                    <li data-md>
                        <p>否则：</p>
                        <ol>
                            <li data-md>
                                <p class="assertion">断言：document的指示部分为元素<span class="diff">或<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range"
                                            id="ref-for-concept-range⑥">范围</a></span>。</p>
                            <li data-md>
                                <p><span class="diff">令<var>scrollTarget</var>为<var>document</var>的指示部分。</span></p>
                            <li data-md>
                                <p><span class="diff">令<var>target</var>为<var>scrollTarget</var>。</span></p>
                            <li data-md>
                                <p><span class="diff">如<var>target</var>为<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range"
                                            id="ref-for-concept-range⑦">范围</a>：</span></p>
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">设<var>target</var>为该范围的<a data-link-type="dfn"
                                                    href="#first-common-ancestor"
                                                    id="ref-for-first-common-ancestor">首个公共祖先</a></span>，即<var>target</var>的<a
                                                data-link-type="dfn"
                                                href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                                id="ref-for-concept-range-start-node">起始节点</a>与<a data-link-type="dfn"
                                                href="https://dom.spec.whatwg.org/#concept-range-end-node"
                                                id="ref-for-concept-range-end-node">结束节点</a>的祖先。</p>
                                    <li data-md>
                                        <p><span class="diff">当<var>target</var>非null且不是<a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-element"
                                                    id="ref-for-concept-element">元素</a>时，循环将<var>target</var>设为其<a
                                                    data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-tree-parent"
                                                    id="ref-for-concept-tree-parent">父节点</a>。</span></p>
                                        <div class="issue" id="issue-424a4e25"><a class="self-link"
                                                href="#issue-424a4e25"></a> 若处于shadow tree内部目标应如何设？<a
                                                href="https://github.com/WICG/scroll-to-text-fragment/issues/190">#190</a>
                                        </div>
                                </ol>
                            <li data-md>
                                <p><span class="diff">断言：<var>target</var>为<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-element"
                                            id="ref-for-concept-element①">元素</a>。</span></p>
                            <li data-md>
                                <p>将<var>document</var>的目标元素设为<var>target</var>。</p>
                            <li data-md>
                                <p>对<var>target</var>运行祖先详情揭示算法。</p>
                            <li data-md>
                                <p>对<var>target</var>运行祖先hidden-until-found揭示算法。</p>
                                <div class="issue" id="issue-10739530"><a class="self-link" href="#issue-10739530"></a>
                                    这些揭示算法目前可能效果不好，因为<var>target</var>可能是祖先甚至根节点。<a
                                        href="https://github.com/WICG/scroll-to-text-fragment/issues/89">#89</a>
                                    建议只匹配 <code>contain:style layout</code> 区块即可解决该问题。 </div>
                            <li data-md>
                                <p><span class="diff">如<var>scrollTarget</var>为<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range"
                                            id="ref-for-concept-range⑧">范围</a>，<var>blockPosition</var>设为"center"，否则为"start"。</span>
                                </p>
                                <div class="note" role="note"> 滚动到文本指令时，在区块方向居中显示。 </div>
                            <li data-md>
                                <strike
                                    class="diff">将<var>target</var>滚动到视图，行为设为"auto"，block设为"start"，inline设为"nearest"。</strike>
                            <li value="10">
                                <span class="diff"><a data-link-type="dfn"
                                        href="https://drafts.csswg.org/cssom-view-1/#scroll-a-target-into-view"
                                        id="ref-for-scroll-a-target-into-view">滚动目标到视图</a>，
                                    参数<em>target</em>为<var>scrollTarget</var>，<em>behavior</em>为"auto"，<em>block</em>为<var>blockPosition</var>，<em>inline</em>为"nearest"。</span>
                                <p><span class="diff">实现 MAY（可选）避免对由<a data-link-type="dfn" href="#text-directive"
                                            id="ref-for-text-directive⑥">文本指令</a>产生的目标滚动。</span></p>
                                <p></p>
                            <li data-md>
                                <p>为target运行聚焦步骤，文档视口作为后备目标。</p>
                                <div class="issue" id="issue-e253a983"><a class="self-link"
                                        href="#issue-e253a983"></a>实现注：Blink当前不会为文本片段设置焦点，应当补充？TODO：提交crbug。</div>
                            <li data-md>
                                <p>将顺序焦点导航起点移至target。</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>接下来两个猴补丁确保用户代理在片段查找完成时清理<a data-link-type="dfn" href="#document-pending-text-directives"
                id="ref-for-document-pending-text-directives⑤">待处理文本指令</a>。如因解析停止而结束文本指令查找，则再次尝试非文本片段。</p>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#try-to-scroll-to-the-fragment"
                id="44bd3acf0">尝试滚动到片段</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scrolling-to-a-fragment"><cite>HTML</cite>
                        § 7.4.6.3 滚动到片段</a>：</strong></p>
            <div class="monkeypatch">
                要为文档<var>document</var>尝试滚动到片段，并行执行如下步骤：
                <ol>
                    <li data-md>
                        <p>等待一段实现自定义时间（用于优化用户体验和性能）。</p>
                    <li data-md>
                        <p>在导航和遍历任务源上为document的相关全局对象排队全局任务，执行如下步骤：</p>
                        <ol>
                            <li data-md>
                                <strike class="diff">如document没有解析器，或其解析器已停止解析，或用户代理认为用户不再关注片段滚动，则终止这些步骤。</strike>
                            <li class="diff" value="1">
                                如用户代理认为用户不再关注片段滚动，则：
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">将<a data-link-type="dfn"
                                                    href="#document-pending-text-directives"
                                                    id="ref-for-document-pending-text-directives⑥">待处理文本指令</a>设为null。</span>
                                        </p>
                                    <li data-md>
                                        <p><span class="diff">终止这些步骤。</span></p>
                                </ol>
                            <li data-md>
                                <p><span class="diff">如文档没有解析器或解析器已停止解析，则：</span></p>
                                <p></p>
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">如<a data-link-type="dfn"
                                                    href="#document-pending-text-directives"
                                                    id="ref-for-document-pending-text-directives⑦">待处理文本指令</a>非null，则：</span>
                                        </p>
                                        <ol>
                                            <li data-md>
                                                <p><span class="diff">将<a data-link-type="dfn"
                                                            href="#document-pending-text-directives"
                                                            id="ref-for-document-pending-text-directives⑧">待处理文本指令</a>设为null。</span>
                                                </p>
                                            <li data-md>
                                                <p><span class="diff"><a data-link-type="dfn"
                                                            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier"
                                                            id="ref-for-scroll-to-the-fragment-identifier①">滚动到片段</a>，参数为<var>document</var>。</span>
                                                </p>
                                        </ol>
                                    <li data-md>
                                        <p><span class="diff">终止这些步骤。</span></p>
                                </ol>
                            <li data-md>
                                <p>滚动到片段，参数为document。</p>
                            <li data-md>
                                <p>如document的指示部分仍为null，则为document再次尝试滚动到片段。<span class="diff">否则，将<a
                                            data-link-type="dfn" href="#document-pending-text-directives"
                                            id="ref-for-document-pending-text-directives⑨">待处理文本指令</a>设为null。</span></p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>在<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid"
                id="319d7c292">导航到片段</a>定义中：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-fragid"><cite>HTML</cite>
                        § 7.4.2.3.3 片段导航</a>：</strong></p>
            <div class="monkeypatch">
                导航到片段，入参navigable <var>navigable</var>，...：
                <ol>
                    <li data-md>
                        <p>...</p>
                    <li value="8">
                        以navigable的活动文档、historyEntry、true、scriptHistoryIndex和scriptHistoryLength调用“历史步骤应用时更新文档”。
                    <li data-md>
                        <p>为navigable的活动文档滚动到片段。</p>
                    <li class="diff">将<var>navigable</var>的活动文档的<a data-link-type="dfn"
                            href="#document-pending-text-directives"
                            id="ref-for-document-pending-text-directives①⓪">待处理文本指令</a>设为null。
                    <li data-md>
                        <p>令traversable为navigable的可遍历navigable。</p>
                    <li data-md>
                        <p>...</p>
                </ol>
            </div>
        </blockquote>
        <p>滚动到指示部分只是“滚动到片段”中的众多操作之一。需重命名该及相关定义：</p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-fragid"><cite>HTML</cite>
                        § 7.4.2.3.3 片段导航</a>：</strong></p>
            <p>将<a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-fragid"><cite>HTML</cite>
                    § 7.4.2.3.3 片段导航</a>及相关步骤重命名为“指示片段”，以反映其更广泛的效果。</p>
        </blockquote>
        <h3 class="heading settled" data-level="3.5" id="security-and-privacy"><span class="secno">3.5. </span><span
                class="content">安全与隐私</span><a class="self-link" href="#security-and-privacy"></a></h3>
        <h4 class="heading settled" data-level="3.5.1" id="motivation"><span class="secno">3.5.1. </span><span
                class="content">动机</span><a class="self-link" href="#motivation"></a></h4>
        <div class="note" role="note">本节为非规范性内容</div>
        <p>实现<a data-link-type="dfn" href="#text-directive"
                id="ref-for-text-directive⑦">文本指令</a>时必须确保无法被用于跨源窃取信息。脚本可以导航到带有<a data-link-type="dfn"
                href="#text-directive"
                id="ref-for-text-directive⑧">文本指令</a>的跨源URL。如果恶意行为者能判断导航导致目标页面上的文本片段被成功找到，则可推断出页面内容。</p>
        <p>下述各子节给出的处理模型限制了该功能，缓解了已知的攻击向量。简而言之，文本指令限制如下：</p>
        <ul>
            <li data-md>
                <p>仅适用于顶级可导航（即不用于iframe）。</p>
                <ul>
                    <li data-md>
                        <p class="issue" id="issue-35f490f0"><a class="self-link" href="#issue-35f490f0"></a>
                            这并非绝对，Chrome允许相同源发起的此用法。规范需进一步明确。<a
                                href="https://github.com/WICG/scroll-to-text-fragment/issues/240">[Issue
                                #WICG/scroll-to-text-fragment#240]</a></p>
                </ul>
            <li data-md>
                <p>由用户操作触发的导航</p>
            <li data-md>
                <p>若导航为跨源发起，则目标页面要求 opener 隔离（即其它文档不可持有其全局对象引用）</p>
        </ul>
        <h4 class="heading settled" data-level="3.5.2" id="scroll-on-navigation"><span class="secno">3.5.2. </span><span
                class="content">导航触发滚动</span><a class="self-link" href="#scroll-on-navigation"></a></h4>
        <p>UA可以选择在匹配文本片段后自动滚动到可见区域。这对用户便捷，但也带来一些实现风险。</p>
        <p>已知（或潜在未知）的方式可分辨导航触发滚动和用户自然滚动。</p>
        <div class="example" id="example-fe268bc5"><a class="self-link" href="#example-fe268bc5"></a>
            目标页iframe内嵌的其他源注册IntersectionObserver，检测前500ms内是否滚动发生。若有滚动，可能反映文本片段被成功命中。 </div>
        <div class="example" id="example-ce37442a"><a class="self-link" href="#example-ce37442a"></a>
            两名用户处于同一网络并可监听彼此流量。恶意用户向受害者发送带文本片段的目标链接，并根据关联唯一域名的资源请求顺序，间接获知文本片段是否命中。 </div>
        <div class="example" id="example-2e4f39df"><a class="self-link" href="#example-2e4f39df"></a>
            攻击者向受害者发送带有私密token的目标页面链接。通过文本片段让页面加载时将“请勿泄露该token”的警告滚动出可视区。 </div>
        <p>所有已知情景依赖于目标页的具体情况，因而并不普适。进一步对文本片段的调用条件加以限制，可进一步约束攻击者能力。但不同 UA 可根据自身判断风险是否可接受，确定是否在导航到文本片段时自动滚动。</p>
        <p>符合规范的UA可选择导航时不自动滚动。此时可提供“点击滚动”等UI，或完全不滚动。此时 UA 应向用户提示有片段存在于页面下方。</p>
        <p>上述例子展示在特殊情况下，攻击者可获取目标页面内容的1比特信息。但应防止可利用此途径持续攻击以获取任意内容。因此，基于用户激活与浏览上下文隔离的约束至关重要，必须严格实现。</p>
        <div class="note" role="note">
            浏览上下文隔离可确保其他页面无法通过脚本操作目标文档，降低攻击面。
            <p>但这同样确保恶意使用难以隐藏。一个组内唯一的浏览上下文将是顶级浏览上下文（即整个标签页/窗口）。</p>
        </div>
        <p>如UA选择自动滚动，必须确保文档在后台时（如处于非激活tab）不进行滚动，以防止攻击者在后台偷偷进行自动化搜索，确保恶意行为可见。</p>
        <p>如UA选择不自动滚动，则必须无条件滚动后备元素id到可视区（如有），不论文本片段是否匹配。否则可用是否滚动该元素来判断文本片段是否成功匹配。</p>
        <h4 class="heading settled" data-level="3.5.3" id="search-timing"><span class="secno">3.5.3. </span><span
                class="content">查找时机</span><a class="self-link" href="#search-timing"></a></h4>
        <p>文本搜索算法的天真实现，可能因匹配与否导致运行时长差异，继而泄漏信息。攻击者如可同步导航到<a data-link-type="dfn" href="#text-directive"
                id="ref-for-text-directive⑨">文本指令</a>URL，即可通过导航耗时推断文本片段是否存在。</p>
        <div class="note" role="note"> <a href="#restricting-the-text-fragment">§ 3.5.4
                限制文本片段</a>中的限制可避免上述问题，尤其是禁止同文档导航。但多个防御层是必要的。 </div>
        <p>因此，<em>实现必须确保<a href="#navigating-to-text-fragment">§ 3.6 导航到文本片段</a>步骤无论匹配与否运行时长无差异</em>。</p>
        <p>本规范不规定 UA 如何实现。可选做法如：即使已找到匹配，仍继续遍历树（见<a data-link-type="dfn" href="#find-a-range-from-a-text-directive"
                id="ref-for-find-a-range-from-a-text-directive">从文本指令查找范围</a>）；也可调度异步任务查找并设定<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">文档</a>的指示部分。</p>
        <h4 class="heading settled" data-level="3.5.4" id="restricting-the-text-fragment"><span class="secno">3.5.4.
            </span><span class="content">限制文本片段</span><a class="self-link" href="#restricting-the-text-fragment"></a>
        </h4>
        <div class="note" role="note">
            本节与 HTML 导航集成，用于限制何时允许指示性文本指令自动滚动。总结如下：
            <ul>
                <li data-md>
                    <p>为 Document 和 Request 均添加布尔值
                        <code>text directive user activation</code>。当文档由用户激活的导航创建时设置该标志，并在因文本指令触发滚动时消费。若未被消费，可以在下一次出站导航请求时转移。这样实现了下方说明的
                        user-activation-through-redirects 行为。
                    </p>
                <li data-md>
                    <p>定义一系列检查，针对文档、用户参与状态和导航的发起源，以确定是否应允许文本指令滚动。</p>
                <li data-md>
                    <p>在 "finalize a cross document navigation" 和 "navigate to a fragment steps" 计算滚动许可，并将其传递到 "scroll
                        to the fragment" 步骤中，在此用于中止文本指令滚动。</p>
            </ul>
        </div>
        <p>补充<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request">请求</a>和<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">文档</a>
            的定义，加入新的布尔值<a data-link-type="dfn" href="#document-text-directive-user-activation"
                id="ref-for-document-text-directive-user-activation">text directive user activation</a>字段：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[FETCH]</a>：</strong>
            </p>
            <p>一个<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                    id="ref-for-concept-request①">请求</a>关联一个布尔值<dfn class="dfn-paneled" data-dfn-for="request"
                    data-dfn-type="dfn" data-noexport id="request-text-directive-user-activation">text directive user
                    activation</dfn>，
                初始为 false。</p>
        </blockquote>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <p>每个<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                    id="ref-for-concept-document③">文档</a>有<dfn class="dfn-paneled" data-dfn-for="document"
                    data-dfn-type="dfn" data-noexport id="document-text-directive-user-activation">text directive user
                    activation</dfn>，为布尔型，初始为 false。</p>
            <div class="note" role="note">
                <a data-link-type="dfn" href="#document-text-directive-user-activation"
                    id="ref-for-document-text-directive-user-activation①">text directive user activation</a>
                提供了允许单次激活文本片段所需的用户手势信号。仅在导航因用户激活发生且跨客户端重定向时，于文档加载期间设为 true。
                <p>若<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                        id="ref-for-concept-document④">文档</a>的<a data-link-type="dfn"
                        href="#document-text-directive-user-activation"
                        id="ref-for-document-text-directive-user-activation②">text directive user
                        activation</a>未用于激活文本片段，则其用于将新导航<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">请求</a>的<a
                        data-link-type="dfn" href="#request-text-directive-user-activation"
                        id="ref-for-request-text-directive-user-activation">text directive user activation</a>设为
                    true。因此，<a data-link-type="dfn" href="#document-text-directive-user-activation"
                        id="ref-for-document-text-directive-user-activation③">text directive user activation</a>
                    可跨导航在文档间传递。</p>
                <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                        id="ref-for-concept-document⑥">文档</a>的<a data-link-type="dfn"
                        href="#document-text-directive-user-activation"
                        id="ref-for-document-text-directive-user-activation④">text directive user activation</a>和<a
                        data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                        id="ref-for-concept-request③">请求</a>的<a data-link-type="dfn"
                        href="#request-text-directive-user-activation"
                        id="ref-for-request-text-directive-user-activation①">text directive user activation</a>在被使用时总归为
                    false，因此一次用户激活不能多次激活文本片段。</p>
            </div>
        </blockquote>
        <div class="note" role="note">
            <p>
                此机制允许文本片段通过许多主流网站常用的重定向方式激活。这些站点通过 200 状态码响应脚本，设置
                <tt>window.location</tt>
                以重定向用户到期望目标。
            </p>
            <p>
                与真实 HTTP ( <tt>status 3xx</tt> ) 重定向不同，这些“客户端”
                重定向无法传递导航属于用户手势。<a data-link-type="dfn" href="#document-text-directive-user-activation"
                    id="ref-for-document-text-directive-user-activation⑤">text directive user activation</a>
                机制可穿越此次特定范围内的导航。因此页面可编程导航至文本片段一次，效果等同拥有用户操作。但此后会重置
                <code>text fragment user activation</code>，没人为操作则后续文本片段导航不会激活。
            </p>
            <p> 下图展示了这一标志如何支持通过客户端重定向服务激活文本片段： </p>
            <p><img alt="Diagram showing how a text fragment flag is set and used" height="671"
                    src="https://raw.githubusercontent.com/WICG/scroll-to-text-fragment/master/text_fragment_activation_flag.png"
                    style="margin-left:auto;margin-right:auto;display:block" width="745"></p>
            <p> 更详讨论见 <a href="redirects.md">redirects.md</a>。 </p>
        </div>
        <p>补充 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"
                id="ref-for-create-navigation-params-by-fetching">create navigation params by fetching</a> 步骤，将 <a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                id="ref-for-nav-document①">活动文档</a> 的 <a data-link-type="dfn"
                href="#document-text-directive-user-activation"
                id="ref-for-document-text-directive-user-activation⑥">text directive user activation</a> 赋值给
            <var>request</var> 的 <a data-link-type="dfn" href="#request-text-directive-user-activation"
                id="ref-for-request-text-directive-user-activation②">text directive user activation</a>.
        </p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <ol>
                    <li data-md>
                        <p class="assertion">断言：本步骤在并发执行。</p>
                    <li data-md>
                        <p>令 documentResource 为 entry 的 document state 的 resource。</p>
                    <li data-md>
                        <p>新建 <var>request</var>，其属性包括：</p>
                        <dl class="props">
                            <dt>url
                            <dd><var>entry</var> 的 URL
                            <dt>...
                            <dd>...
                            <dt>referrer policy
                            <dd><var>entry</var> 的 document state 的 request referrer policy
                            <dt><span class="diff"><a data-link-type="dfn"
                                        href="#request-text-directive-user-activation"
                                        id="ref-for-request-text-directive-user-activation③">text directive user
                                        activation</a></span>
                            <dd><span class="diff"><var>navigable</var> 的 <a data-link-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                                        id="ref-for-nav-document②">活动文档</a> 的 <a data-link-type="dfn"
                                        href="#document-text-directive-user-activation"
                                        id="ref-for-document-text-directive-user-activation⑦">text directive user
                                        activation</a></span>
                        </dl>
                    <li data-md>
                        <p><span class="diff">将 <var>navigable</var> 的 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                                    id="ref-for-nav-document③">活动文档</a> 的 <a data-link-type="dfn"
                                    href="#document-text-directive-user-activation"
                                    id="ref-for-document-text-directive-user-activation⑧">text directive
                                    user activation</a> 设为 false。</span></p>
                    <li data-md>
                        <p>如 documentResource 为 POST 资源，则：</p>
                        <ol>
                            <li data-md>
                                <p>...</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>补充 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params"
                id="ref-for-navigation-params">navigation params</a>，增加新字段：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <dl>
                <dt><dfn class="dfn-paneled" data-dfn-for="navigation params" data-dfn-type="dfn" data-noexport
                        id="navigation-params-user-involvement">user involvement</dfn>
                <dd>一个 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#user-navigation-involvement"
                        id="ref-for-user-navigation-involvement">用户导航介入</a> 值。
            </dl>
        </blockquote>
        <p>所有创建 navigation params 的地方均初始化 <a data-link-type="dfn" href="#navigation-params-user-involvement"
                id="ref-for-navigation-params-user-involvement">user involvement</a> 值。具体如 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching"
                id="ref-for-create-navigation-params-by-fetching①">create navigation params by
                fetching</a> 情况下初始化为 true：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                要 create navigation params by fetching，参数：session history entry entry，navigable，source snapshot params
                sourceSnapshotParams，target snapshot params targetSnapshotParams，string cspNavigationType，navigation
                ID-or-null navigationId，NavigationTimingType navTimingType，<span class="diff">和 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#user-navigation-involvement"
                        id="ref-for-user-navigation-involvement①">user navigation
                        involvement</a> <var>user involvement</var></span>，步骤如下。它们返回 navigation params、non-fetch scheme
                navigation params 或 null。
                <ol>
                    <li data-md>
                        <p class="assertion">断言：本步骤并发执行。</p>
                    <li data-md>
                        <p>...</p>
                    <li value="23">令 resultPolicyContainer 为 determine navigation params policy container 结果，其参数为
                        response 的 URL、entry 的 document state 的 history policy container、sourceSnapshotParams 的 source
                        policy container、null 和 responsePolicyContainer。
                    <li data-md>
                        <p>如 navigable 的 container 为 iframe，且 response 的 timing allow passed 标志置位，则将 container 的 pending
                            resource-timing start time 设为 null。</p>
                    <li data-md>
                        <p>返回新 navigation params，属性为：</p>
                        <dl>
                            <dt>id
                            <dd>navigationId
                            <dt>...
                            <dd>...
                            <dt>about base URL
                            <dd>entry 的 document state 的 about base URL
                            <dt class="diff"><a data-link-type="dfn" href="#navigation-params-user-involvement"
                                    id="ref-for-navigation-params-user-involvement①">user involvement</a>
                            <dd class="diff"><var>user involvement</var>
                        </dl>
                </ol>
            </div>
        </blockquote>
        <p>补充 <a href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#initialise-the-document-object">
                create and initialize a Document object</a> 步骤，计算并存储 <a data-link-type="dfn"
                href="#document-text-directive-user-activation"
                id="ref-for-document-text-directive-user-activation⑨">text directive
                user activation</a> 标志：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <ol start="18">
                    <li data-md>
                        <p>调用 process link headers。</p>
                    <li data-md>
                        <div class="diff">
                            若满足下列任一条件，则设 <var>document</var> 的 <a data-link-type="dfn"
                                href="#document-text-directive-user-activation"
                                id="ref-for-document-text-directive-user-activation①⓪">text directive user
                                activation</a> 为 true，否则为 false：
                            <ul>
                                <li data-md>
                                    <p><var>navigationParams</var> 的 <a data-link-type="dfn"
                                            href="#navigation-params-user-involvement"
                                            id="ref-for-navigation-params-user-involvement②">user involvement</a> 是
                                        "<code>activation</code>"；</p>
                                <li data-md>
                                    <p><var>navigationParams</var> 的 <a data-link-type="dfn"
                                            href="#navigation-params-user-involvement"
                                            id="ref-for-navigation-params-user-involvement③">user involvement</a> 是
                                        "<code>browser UI</code>"；或</p>
                                <li data-md>
                                    <p><var>navigationParams</var> 的 <a
                                            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request">request</a>
                                        属性中
                                        <a data-link-type="dfn" href="#request-text-directive-user-activation"
                                            id="ref-for-request-text-directive-user-activation④">text directive user
                                            activation</a> 为 true。
                                    </p>
                                    <div class="note" role="note"> <a data-link-type="dfn"
                                            href="#document-text-directive-user-activation"
                                            id="ref-for-document-text-directive-user-activation①①">text directive user
                                            activation</a> 不可被复制，仅有一次用户激活的文本片段可被激活。</div>
                            </ul>
                        </div>
                    <li data-md>
                        <p>返回 <var>document</var>。</p>
                </ol>
            </div>
        </blockquote>
        <p>一个<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="text-directive-allowing-mime-type">text
                directive allowing MIME type</dfn> 是 <a data-link-type="dfn"
                href="https://mimesniff.spec.whatwg.org/#mime-type" id="ref-for-mime-type">MIME 类型</a>，其<a
                data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type-essence"
                id="ref-for-mime-type-essence">本质</a>
            为 "<code>text/html</code>" 或 "<code>text/plain</code>"。</p>
        <p class="note" role="note"><span class="marker">注：</span>如<a
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scrolling-to-a-fragment">滚动到片段</a>所述，
            片段处理由各 MIME 类型单独定义。因此<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier"
                id="ref-for-scroll-to-the-fragment-identifier②">滚动到片段</a>中滚动文本指令只应应用于 text/html 类型的媒体。然而，实际上浏览器会对
            text/plain 等其它类型应用 HTML 片段处理（如为 text/plain 文档加 id 后导航片段能滚动）。因此在 text/plain 文档启用文本指令有用。其余类型显式禁止，防止对敏感应用数据（如
            text/css、application/json、application/javascript 等）发起 XS-Search 攻击。</p>
        <p class="issue" id="issue-0e1d8eda"><a class="self-link" href="#issue-0e1d8eda"></a> 这段内容是否适合写入 HTML 规范？</p>
        <div class="algorithm" data-algorithm="check if a text directive can be scrolled">
            要<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="check-if-a-text-directive-can-be-scrolled">检查文本指令是否可被滚动</dfn>；给定<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document⑦">文档</a>
            <var>document</var>，<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin">origin</a>-或-null <var>initiator origin</var>，和 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#user-navigation-involvement"
                id="ref-for-user-navigation-involvement②">用户导航介入</a>-或-null <var>user involvement</var>，执行如下步骤：
            <ol class="algorithm">
                <li data-md>
                    <p>如 <var>document</var> 的<a data-link-type="dfn" href="#document-pending-text-directives"
                            id="ref-for-document-pending-text-directives①①">待处理文本指令</a>为 null 或空，返回 false。</p>
                <li data-md>
                    <p>如 <var>document</var> 的<a data-link-type="dfn" href="#document-text-directive-user-activation"
                            id="ref-for-document-text-directive-user-activation①②">text directive user activation</a> 为
                        true，或
                        <var>user involvement</var> 为 "<code>activation</code>" 或 "<code>browser
UI</code>"，则 <var>is user involved</var> 为 true，否则为 false。
                    </p>
                <li data-md>
                    <p>将 <var>document</var> 的<a data-link-type="dfn" href="#document-text-directive-user-activation"
                            id="ref-for-document-text-directive-user-activation①③">text directive user activation</a> 设为
                        false。</p>
                <li data-md>
                    <p>如果<var>document</var>的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-document-content-type"
                            id="ref-for-concept-document-content-type">content type</a>非<a data-link-type="dfn"
                            href="#text-directive-allowing-mime-type"
                            id="ref-for-text-directive-allowing-mime-type">text directive allowing MIME type</a>，返回
                        false。</p>
                <li data-md>
                    <p>如 <var>user involvement</var> 为 "<code>browser UI</code>"，返回 true。</p>
                    <div class="note" role="note">
                        <p> 如导航始于浏览器UI，始终允许（因用户触发且页面/脚本未提供文本片段）。</p>
                        <p> 本项意在区分由应用/页面控制URL还是由用户完全控制。如前者，则仅当目标加载于独立浏览上下文组，否则禁用文本片段滚动（防止同时控制片段且可观测副作用）。但如右键“新窗口中打开”属于灰色地带。
                        </p>
                        <p> 相关讨论见 <a
                                href="https://w3c.github.io/webappsec-fetch-metadata/#directly-user-initiated">sec-fetch-site</a>
                            于 <a data-link-type="biblio" href="#biblio-fetch-metadata"
                                title="Fetch Metadata Request Headers">[FETCH-METADATA]</a>。</p>
                    </div>
                <li data-md>
                    <p>如 <var>is user involved</var> 为 false，返回 false。</p>
                <li data-md>
                    <p>如 <var>document</var> 的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"
                            id="ref-for-node-navigable">node navigable</a> 有<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent"
                            id="ref-for-nav-parent">父</a>，返回 false。</p>
                <li data-md>
                    <p>如 <var>initiator origin</var> 非 null 且 <var>document</var> 的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-document-origin"
                            id="ref-for-concept-document-origin">origin</a>与<var>initiator origin</var>同源，返回true。</p>
                <li data-md>
                    <p>如 <var>document</var> 的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"
                            id="ref-for-concept-document-bc">browsing context</a> 的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#tlbc-group"
                            id="ref-for-tlbc-group">group</a>的<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context-set"
                            id="ref-for-browsing-context-set">browsing context set</a>长度为1，返回true。</p>
                    <div class="note" role="note"> 即仅在跨 origin 元素/脚本导航目标文档于 noopener
                        上下文（即新顶级浏览上下文组）时允许滚动，确保发起方无法脚本控制目标文档（可多进程）。</div>
                <li data-md>
                    <p>否则返回 false。</p>
            </ol>
        </div>
        <p>补充（已在<a href="#invoking-text-directives">§ 3.4.1 调用文本指令</a>饱和修改）<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier"
                id="ref-for-scroll-to-the-fragment-identifier③">滚动到片段</a>，新增布尔参数 <var>allow text directive scroll</var>：
        </p>
        <blockquote>
            <p><strong>猴补丁 <a
                        href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scrolling-to-a-fragment"><cite>HTML</cite>
                        § 7.4.6.3 滚动到片段</a>：</strong></p>
            <div class="monkeypatch">
                要滚动到给定文档 <var>document</var> <span class="diff">和布尔变量 <var>allow text
                        directive scroll</var></span> 的片段：
                <ol>
                    <li data-md>
                        <p>若 document 的指示部分为 null，则目标元素设为 null。</p>
                    <li data-md>
                        <p>...</p>
                    <li data-md>
                        <p>否则：</p>
                        <ol>
                            <li data-md>
                                <p class="assertion">断言：document 的指示部分是元素或<a data-link-type="dfn"
                                        href="https://dom.spec.whatwg.org/#concept-range"
                                        id="ref-for-concept-range⑨">范围</a>。</p>
                            <li data-md>
                                <p>...</p>
                            <li value="4">如 <var>target</var> 为<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range"
                                    id="ref-for-concept-range①⓪">范围</a>，则：
                                <ol>
                                    <li data-md>
                                        <p><span class="diff">如 <var>allow text directive scroll</var> 为
                                                false，返回。</span></p>
                                    <li data-md>
                                        <p>将 <var>target</var> 设为<var>target</var>的<a data-link-type="dfn"
                                                href="#first-common-ancestor"
                                                id="ref-for-first-common-ancestor①">第一个共同祖先</a>。</p>
                                    <li data-md>
                                        <p>...</p>
                                </ol>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#try-to-scroll-to-the-fragment"
                id="ref-for-try-to-scroll-to-the-fragment">try to scroll to the fragment</a>，新增布尔标志 <var>allow text
                directive scroll</var>，替换第2步任务内容：
        </p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                要为文档 <var>document</var> <span class="diff">（及布尔变量 <var>allow text directive
                        scroll</var>）</span>尝试滚动到片段，并行执行如下步骤：
                <ol>
                    <li data-md>
                        <p>等待一段实现自定义时间。</p>
                    <li data-md>
                        <p>在 navigation and traversal task source 上为 document 的关联全局对象排队全局任务，执行如下：</p>
                        <ol>
                            <li data-md>
                                <p>如 document 无解析器、解析器已停止、或 UA 认为用户已不关心滚动，则中止步骤。</p>
                            <li data-md>
                                <p>按 <var>document</var> 和<var>allow text directive scroll</var>滚动到片段。</p>
                            <li data-md>
                                <p>如 document 的指示部分依然为 null，再次用同参数 try to scroll to the fragment。</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#update-document-for-history-step-application"
                id="ref-for-update-document-for-history-step-application①">update document for history step
                application</a>，新增布尔 <var>allow text directive scroll</var>，滚动时用之：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                To update document for history step application given a Document document, a session history
                entry entry, a boolean doNotReactivate, integers scriptHistoryLength and scriptHistoryIndex,
                an optional list of session history entries entriesForNavigationAPI, <span class="diff">and a
                    boolean <var>allow text directive scroll</var></span>:
                <ol>
                    <li data-md>
                        <p>Let documentIsNew be true if <var>document</var>’s latest entry is null; otherwise false.</p>
                    <li data-md>
                        <p>...</p>
                    <li value="5">
                        If documentsEntryChanged is true, then:
                        <ol>
                            <li data-md>
                                <p>Let oldURL be document’s latest entry’s URL.</p>
                            <li data-md>
                                <p>...</p>
                        </ol>
                    <li data-md>
                        <p>If documentIsNew is true, then:</p>
                        <ol>
                            <li data-md>
                                <p>Try to scroll to the fragment with <var>document</var> <span class="diff">and
                                        <var>allow text
                                            directive scroll</var>.</span></p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#apply-the-history-step"
                id="ref-for-apply-the-history-step">apply the history step</a> 算法，传递 <var>allow
                text directive
                scroll</var> 调用 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#update-document-for-history-step-application"
                id="ref-for-update-document-for-history-step-application②">update document for history step application
            </a>：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <p>apply the history
                    step，参数：step、traversable、checkForCancelation、sourceSnapshotParams、initiatorToCheck、userInvolvementForNavigateEvents，<span
                        class="diff">和 <var>allow text directive
                            scroll</var>（默认 false）</span>，步骤如下，返回
                    "initiator-disallowed"、"canceled-by-beforeunload"、"canceled-by-navigate" 或 "applied"。</p>
                <ol start="14">
                    <li data-md>
                        <p>While completedChangeJobs does not equal totalChangeJobs:</p>
                        <ol>
                            <li data-md>
                                <p>...</p>
                            <li value="11">
                                Queue a global task on navigation and traversal task source，入参：navigable 的 active
                                window，执行如下步骤：
                                <ol>
                                    <li data-md>
                                        <p>如 changingNavigableContinuation 的 update-only 为 false：</p>
                                        <ol>
                                            <li data-md>
                                                <p>...</p>
                                            <li data-md>
                                                <p>为 navigable 激活历史条目 <var>targetEntry</var>。</p>
                                        </ol>
                                    <li data-md>
                                        <p>定义 updateDocument：执 <var>targetEntry</var> 的
                                            document、<var>targetEntry</var>、changingNavigableContinuation 的
                                            update-only、scriptHistoryLength、scriptHistoryIndex、entriesForNavigationAPI、<span
                                                class="diff"><var>allow text
                                                    directive scroll</var></span>
                                        </p>
                                    <li data-md>
                                        <p>如 <var>targetEntry</var> 的 document 等于 displayedDocument，执 updateDocument。
                                        </p>
                                </ol>
                        </ol>
                    <li data-md>
                        <p>Let totalNonchangingJobs be the size of nonchangingNavigablesThatStillNeedUpdates.</p>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#apply-the-push%2Freplace-history-step"
                id="ref-for-apply-the-push%2Freplace-history-step">apply the push/replace history step</a>，传递 <var>allow
                text
                directive scrolling</var> 至 apply the history step：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                apply the push/replace history step，参数：step、traversable，<span class="diff">和布尔 <var>allow text directive
                        scroll</var>（默认false）</span>：
                <p>返回 apply the history step(stap, traversable, false, null, null, null, <span class="diff"><var>allow
                            text directive scroll</var></span>).</p>
            </div>
        </blockquote>
        <p class="note" role="note"><span class="marker">注：</span><var>allow text directive scroll</var>
            在遍历和重载时故意不设置。这样可避免大量传递和发起源、用户参与、历史滚动状态等检查。此时文本指令仍可作为文档指示部分（高亮可恢复）。</p>
        <p>补充 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#finalize-a-cross-document-navigation"
                id="ref-for-finalize-a-cross-document-navigation">finalize a cross-document navigation</a>，增加<var>user
                involvement</var>参数并计算及传递 <var>allow text directive scrolling</var>：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <p>finalize a cross-document navigation，参数：navigable、historyHandling、historyEntry、<span class="diff"><a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#user-navigation-involvement"
                            id="ref-for-user-navigation-involvement③">user navigation involvement</a> <var>user
                            involvement</var>（默认 "none"）</span>：</p>
                <ol>
                    <li data-md>
                        <p class="assertion">断言：执行于 navigable 的 traversable navigable 的会话历史遍历队列。</p>
                    <li data-md>
                        <p>...</p>
                    <li value="10"><span class="diff">令<var>allow text directive scroll</var>为<a data-link-type="dfn"
                                href="#check-if-a-text-directive-can-be-scrolled"
                                id="ref-for-check-if-a-text-directive-can-be-scrolled">检查文本指令是否可被滚动</a>的结果，参数为
                            historyEntry 的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document"
                                id="ref-for-she-document">document</a>、historyEntry 的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state"
                                id="ref-for-she-document-state">document state</a> 的<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-initiator-origin"
                                id="ref-for-document-state-initiator-origin">initiator origin</a>、<var>user
                                involvement</var></span>
                    <li data-md>
                        <p>apply the push/replace history step，参数 targetStep、traversable，<span class="diff"><var>allow
                                    text directive scroll</var></span>。</p>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"
                id="ref-for-navigate①">navigate</a>算法，传递 <var>user involvement</var> 至 finalize a
            cross-document navigation：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <ol>
                    <li data-md>
                        <p>...</p>
                    <li value="20">. 并发执行如下步骤：
                        <ol>
                            <li data-md>
                                <p>...</p>
                            <li value="9">.
                                努力用下述参数填充历史条目的文档：navigable、"navigate"、sourceSnapshotParams、targetSnapshotParams、navigationId、navigationParams、cspNavigationType，并在步骤完成后执行：
                                <ol>
                                    <li data-md>
                                        <p>为 navigable 的 traversable 附加会话历史遍历步骤，调用 finalize a cross-document
                                            navigation，参数：navigable、historyHandling、historyEntry、<span
                                                class="diff"><var>userInvolvement</var></span>。
                                        </p>
                                </ol>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid"
                id="ref-for-navigate-fragid">navigate to a fragment</a> 算法，添加 <var>initiator origin</var> 参数，且滚动时传递
            <var>allow text directive scroll</var>：
        </p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <p>navigate to a
                    fragment，参数：navigable、url、historyHandling、userInvolvement、navigationAPIState、navigationId，<span
                        class="diff"><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                            id="ref-for-concept-origin①">origin</a> <var>initiator
                            origin</var></span>：</p>
                <ol>
                    <li data-md>
                        <p>令 navigation 为 navigable 的 active window 的 navigation API。</p>
                    <li data-md>
                        <p>...</p>
                    <li value="14">用 navigable 的 active
                        document、historyEntry、true、scriptHistoryIndex、scriptHistoryLength 调用 update document for history
                        step application。
                    <li data-md>
                        <p>用 navigation、historyEntry、historyHandling，更新 navigation API 的 same-document navigation 条目。
                        </p>
                    <li data-md>
                        <p><span class="diff">令<var>allow text directive scroll</var>为调用<a data-link-type="dfn"
                                    href="#check-if-a-text-directive-can-be-scrolled"
                                    id="ref-for-check-if-a-text-directive-can-be-scrolled①">检查文本指令是否可被滚动</a>，参数为navigable
                                的<a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"
                                    id="ref-for-nav-document④">活动文档</a>、initiator
                                origin、<var>userInvolvement</var>。</span></p>
                    <li data-md>
                        <p>用 navigable 的活动文档，<span class="diff"><var>allow text directive scroll</var></span>，滚动到片段。</p>
                </ol>
            </div>
        </blockquote>
        <p>补充<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"
                id="ref-for-navigate②">navigate</a>算法，导航到片段时传递 initiator origin：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <ol start="10">
                    <li data-md>
                        <p>如导航须替换，historyHandling 设为 "replace"。</p>
                    <li data-md>
                        <p>如下列全为真：</p>
                        <ul>
                            <li data-md>
                                <p>documentResource 为 null；</p>
                            <li data-md>
                                <p>response 为 null；</p>
                            <li data-md>
                                <p>url 等于 navigable 活动会话历史条目（排除 fragment 版本）；</p>
                            <li data-md>
                                <p>url 的 fragment 非 null,</p>
                        </ul>
                        <p>则：</p>
                        <ol>
                            <li data-md>
                                <p>使用参数
                                    navigable、url、historyHandling、userInvolvement、navigationAPIState、navigationId、<span
                                        class="diff">initiatorOriginSnapshot</span>调用 navigate to a fragment。</p>
                            <li data-md>
                                <p>令 navigation 为 navigable 的活动 window 的 navigation API。</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <h4 class="heading settled" data-level="3.5.5" id="restricting-scroll-on-load"><span class="secno">3.5.5.
            </span><span class="content">限制加载时滚动</span><a class="self-link" href="#restricting-scroll-on-load"></a></h4>
        <p>本节定义如何使用 <code>force-load-at-top</code> 策略来阻止在加载新文档时发生所有类型的滚动，包括但不限于文本指令。</p>
        <p class="issue" id="issue-de0fed9d"><a class="self-link" href="#issue-de0fed9d"></a> 需要决定
            <code>force-load-at-top</code> 与 Navigation API 的交互方式。<a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/242">[Issue
                #WICG/scroll-to-text-fragment#242]</a>
        </p>
        <p>修订 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#restore-persisted-state"
                id="ref-for-restore-persisted-state">restore persisted state</a> 步骤，增加能抑制滚动恢复的新布尔参数：</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                要 restore persisted state from a session history entry <var>entry</var> <span class="diff">, and
                    boolean <var>suppressScrolling</var></span> 执行：
                <ol>
                    <li data-md>
                        <p>如果 entry 的 scroll restoration mode 为 "auto"，<span class="diff"><var>suppressScrolling</var>
                                为 false，</span>且 entry 的 document 的相关全局对象的导航 API 的 suppress
                            normal scroll restoration during ongoing navigation 为 false，则根据 entry 恢复滚动位置信息。</p>
                    <li data-md>
                        <p>...</p>
                </ol>
            </div>
        </blockquote>
        <p>修订 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#update-document-for-history-step-application"
                id="ref-for-update-document-for-history-step-application③">update document for history step
                application</a> 步骤，检查 <code>force-load-at-top</code> 策略，若被设置则避免在新文档中滚动。</p>
        <blockquote>
            <p><strong>猴补丁 <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>：</strong></p>
            <div class="monkeypatch">
                <ol>
                    <li data-md>
                        <p>...</p>
                    <li value="4">将 document 的历史对象长度设为 scriptHistoryLength。
                    <li data-md>
                        <p><span class="diff">令 <var>scrollingBlockedInNewDocument</var> 为对 <var>document</var> 获取 <a
                                    href="https://wicg.github.io/document-policy#algo-get-policy-value">force-load-at-top</a>
                                策略值的结果。</span></p>
                    <li data-md>
                        <p>如果 documentsEntryChanged 为 true，则：</p>
                        <ol>
                            <li data-md>
                                <p>设 oldURL 为 document 的最新 entry 的 URL。</p>
                            <li data-md>
                                <p>...</p>
                            <li value="5">
                                如果 documentIsNew 为 false，则：
                                <ol>
                                    <li data-md>
                                        <p>为同文档导航用 navigation、entry 和 "traverse" 更新导航 API 条目。</p>
                                    <li data-md>
                                        <p>派发名为 popstate 的事件...</p>
                                    <li data-md>
                                        <p>用 entry <span class="diff">和 <var>suppressScrolling</var> 设为
                                                false</span>恢复持久化状态。</p>
                                    <li data-md>
                                        <p>如果 oldURL 的 fragment 不等于...</p>
                                </ol>
                            <li data-md>
                                <p>否则，</p>
                                <ol>
                                    <li data-md>
                                        <p class="assertion">断言：entriesForNavigationAPI 被传入。</p>
                                    <li data-md>
                                        <p>用 entry <span class="diff">和
                                                <var>scrollingBlockedInNewDocument</var></span>恢复持久化状态。</p>
                                    <li data-md>
                                        <p>用 navigation、entriesForNavigationAPI 和 entry 初始化新文档的导航 API 条目。</p>
                                </ol>
                        </ol>
                    <li data-md>
                        <p>如果 documentIsNew 为 true，则：</p>
                        <ol>
                            <li data-md>
                                <p><span class="diff">如 <var>scrollingBlockedInNewDocument</var> 为 false</span>，为
                                    document 尝试滚动到片段。</p>
                            <li data-md>
                                <p>此时可为新建文档运行脚本。</p>
                        </ol>
                    <li data-md>
                        <p>否则，如果 documentsEntryChanged 为 false 且 doNotReactivate 为 false，则：</p>
                        <ol>
                            <li data-md>
                                <p>...</p>
                        </ol>
                </ol>
            </div>
        </blockquote>
        <h3 class="heading settled" data-level="3.6" id="navigating-to-text-fragment"><span class="secno">3.6.
            </span><span class="content">导航到文本片段</span><a class="self-link" href="#navigating-to-text-fragment"></a>
        </h3>
        <div class="note" role="note"> 文本片段规范建议修订 <a
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-fragid"><cite>HTML</cite>
                § 7.4.2.3.3 片段导航</a>。概要：若页面中出现 <a data-link-type="dfn" href="#text-directive"
                id="ref-for-text-directive①⓪">文本指令</a> 且命中，则文本片段优先作为指示部分而非元素片段。HTML Document 的
            指示部分处理模型被修订为返回将滚动到视图的 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range①①">范围</a>，而不是
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element"
                id="ref-for-concept-element②">元素</a>。
        </div>
        <div class="algorithm" data-algorithm="first common ancestor">
            寻找 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="first-common-ancestor">首个公共祖先</dfn>，输入两个节点
            <var>nodeA</var> 和 <var>nodeB</var>，执行：
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>commonAncestor</var> 为 <var>nodeA</var>。</p>
                <li data-md>
                    <p>当 <var>commonAncestor</var> 非 null 且不是 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor"
                            id="ref-for-concept-shadow-including-inclusive-ancestor">包含 shadow 的包容祖先</a>时，将
                        <var>commonAncestor</var> 设为
                        <var>commonAncestor</var> 的 <a data-link-type="dfn" href="#shadow-including-parent"
                            id="ref-for-shadow-including-parent">包含 shadow 的父节点</a>。
                    </p>
                <li data-md>
                    <p>返回 <var>commonAncestor</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="shadow-including parent">
            获取 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shadow-including-parent">包含 shadow
                的父节点</dfn>，输入 <var>node</var>，步骤如下：
            <ol class="algorithm">
                <li data-md>
                    <p>如 <var>node</var> 是 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-root"
                            id="ref-for-concept-shadow-root">shadow root</a>，返回 <var>node</var> 的 <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-documentfragment-host"
                            id="ref-for-concept-documentfragment-host">host</a>。</p>
                <li data-md>
                    <p>否则，返回 <var>node</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-parent"
                            id="ref-for-concept-tree-parent①">父节点</a>。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.6.1" id="finding-ranges-in-a-document"><span class="secno">3.6.1.
            </span><span class="content">在文档中查找范围</span><a class="self-link" href="#finding-ranges-in-a-document"></a>
        </h4>
        <div class="note" role="note">
            本节概述若干算法与定义，说明如何将片段指令字符串转换为文档中的 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range①②">Range</a> 列表。
            <p>高层来看，输入如：</p>
            <pre>text=prefix-,foo&amp;unknown&amp;text=bar,baz
</pre>
            <p>我们拆分得到单独每条文本指令：</p>
            <pre>text=prefix-,foo
text=bar,baz
</pre>
            <p>依次对每条文本指令，在文档内查找首次匹配其所有限制条件的渲染文本。每一次查找互不影响：即无论其他指令数量与匹配结果如何，结果都一致。</p>
            <p>若指令在文档中成功匹配某段文本，则返回一个 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range①③">范围</a> 指示该匹配。<a data-link-type="dfn" href="#invoke-text-directives"
                    id="ref-for-invoke-text-directives①">invoke text directives</a> 步骤是本节提供的高阶 API。返回由单条指令匹配出的 <a
                    data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">范围</a> 组成的 <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range①④">列表</a>，顺序与片段指令字符串一致。</p>
            <p>如某条指令未命中，则不会在返回列表中加入项。</p>
        </div>
        <div class="algorithm" data-algorithm="invoke text directives">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="invoke-text-directives">调用文本指令</dfn>，输入为 <a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">列表</a> <var>text
                directives</var>（由 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①①">文本指令</a>
            组成）和 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                id="ref-for-concept-document⑧">文档</a>
            <var>document</var>，步骤如下：
            <div class="note" role="note"> 本算法返回要用于视觉指示的 <a data-link-type="dfn"
                    href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">范围</a> 列表，第一个会自动滚动到视图（若UA支持自动滚动）。
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>ranges</var> 为 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list⑦">范围</a>的列表，初始为空。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate①">依次遍历</a> <var>text directives</var> 中每个 <a data-link-type="dfn"
                            href="#text-directive" id="ref-for-text-directive①②">文本指令</a> <var>directive</var>：</p>
                    <ol>
                        <li data-md>
                            <p>如<a data-link-type="dfn" href="#find-a-range-from-a-text-directive"
                                    id="ref-for-find-a-range-from-a-text-directive①">从文本指令查找范围</a>（参数：<var>directive</var>
                                和 <var>document</var>）结果非 null，则将其<a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">添加</a>到
                                <var>ranges</var>。
                            </p>
                    </ol>
                <li data-md>
                    <p>返回 <var>ranges</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="find a range from a text directive">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="find-a-range-from-a-text-directive">从文本指令查找范围</dfn>，输入 <a data-link-type="dfn"
                href="#text-directive" id="ref-for-text-directive①③">文本指令</a> <var>parsedValues</var> 和 <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                id="ref-for-concept-document⑨">文档</a>
            <var>document</var>，依次执行：
            <div class="note" role="note">
                该算法输入为成功解析的文本指令和被查文档。返回值是文档中首次与搜索文本及上下文匹配的 <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range①⑦">范围</a>。如无匹配返回null。
                <p><a data-link-type="dfn" href="#text-directive-end" id="ref-for-text-directive-end①">end</a> 可为
                    null。未指定时为“精确”查找，返回的 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range①⑧">范围</a>只包含和 <a data-link-type="dfn" href="#text-directive-start"
                        id="ref-for-text-directive-start②">start</a>
                    完全相等的字符串。如
                    <a data-link-type="dfn" href="#text-directive-end" id="ref-for-text-directive-end②">end</a>
                    指定，则是“范围”查找，返回
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range①⑨">范围</a>从
                    <a data-link-type="dfn" href="#text-directive-start" id="ref-for-text-directive-start③">start</a>
                    开始，以
                    <a data-link-type="dfn" href="#text-directive-end" id="ref-for-text-directive-end③">end</a>
                    结束。下文统称以 <a data-link-type="dfn" href="#text-directive-start"
                        id="ref-for-text-directive-start④">start</a>、<a data-link-type="dfn" href="#text-directive-end"
                        id="ref-for-text-directive-end④">end</a> 匹配到的片段为"matching text"。
                </p>
                <p><a data-link-type="dfn" href="#text-directive-prefix" id="ref-for-text-directive-prefix①">prefix</a>
                    和 <a data-link-type="dfn" href="#text-directive-suffix"
                        id="ref-for-text-directive-suffix①">suffix</a>
                    任一可为null。为null的方向无需额外上下文。例如 <a data-link-type="dfn" href="#text-directive-prefix"
                        id="ref-for-text-directive-prefix②">prefix</a> 为null时，不要求被匹配文本前方内容。</p>
            </div>
            <div class="note" role="note">
                匹配文本及其上下文可跨块，但算法各自单个参数不能跨块。即每个 <a data-link-type="dfn" href="#text-directive-prefix"
                    id="ref-for-text-directive-prefix③">prefix</a>、<a data-link-type="dfn" href="#text-directive-start"
                    id="ref-for-text-directive-start⑤">start</a>、<a data-link-type="dfn" href="#text-directive-end"
                    id="ref-for-text-directive-end⑤">end</a>、<a data-link-type="dfn" href="#text-directive-suffix"
                    id="ref-for-text-directive-suffix②">suffix</a> 只会匹配单一块里的文本。
                <div class="example" id="example-73638554">
                    <a class="self-link" href="#example-73638554"></a>
                    <pre>:~:text=The quick,lazy dog</pre>
                    在如下内容中无法匹配
                    <pre>&lt;div>The&lt;div> &lt;/div>quick brown fox&lt;/div>
&lt;div>jumped over the lazy dog&lt;/div>
</pre>
                    <p>因为 "The quick" 这段并未在一整块内连续出现，中间有块级元素。</p>
                    <p>但如下例可以匹配：</p>
                    <pre>&lt;div>The quick brown fox&lt;/div>
&lt;div>jumped over the lazy dog&lt;/div>
</pre>
                </div>
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>searchRange</var> 为范围 (<var>document</var>, 0) 到 (<var>document</var>, <var>document</var>
                        的 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-length"
                            id="ref-for-concept-node-length">长度</a>)</p>
                <li data-md>
                    <p>当 <var>searchRange</var> 未<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#range-collapsed" id="ref-for-range-collapsed">折叠</a>时：
                    </p>
                    <ol>
                        <li data-md>
                            <p>令 <var>potentialMatch</var> 为 null。</p>
                        <li data-md>
                            <p>如 <var>parsedValues</var> 的 <a data-link-type="dfn" href="#text-directive-prefix"
                                    id="ref-for-text-directive-prefix④">prefix</a> 非null：</p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>prefixMatch</var> 为 <a data-link-type="dfn" href="#find-a-string-in-range"
                                            id="ref-for-find-a-string-in-range">find a string
                                            in range</a>（参数：<var>query</var> = <var>parsedValues</var> 的<a
                                            data-link-type="dfn" href="#text-directive-prefix"
                                            id="ref-for-text-directive-prefix⑤">prefix</a>、<var>searchRange</var>、<var>wordStartBounded</var>
                                        = true、<var>wordEndBounded</var> = false）</p>
                                <li data-md>
                                    <p>如 <var>prefixMatch</var> 为 null，返回 null。</p>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start②">start</a> 指向 <var>prefixMatch</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                                            id="ref-for-concept-range-bp">边界点</a>（即 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-bp-after"
                                            id="ref-for-concept-range-bp-after">prefixMatch 结尾后</a>）。</p>
                                <li data-md>
                                    <p>令 <var>matchRange</var> 为范围：起点 <var>prefixMatch</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-end"
                                            id="ref-for-concept-range-end①">end</a>，终点 <var>searchRange</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                            id="ref-for-concept-range-end②">end</a>。</p>
                                <li data-md>
                                    <p>将 <var>matchRange</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start④">start</a> 向前推进到 <a data-link-type="dfn"
                                            href="#next-non-whitespace-position"
                                            id="ref-for-next-non-whitespace-position">下一个非空白位置</a>。</p>
                                <li data-md>
                                    <p>如 <var>matchRange</var> 已<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#range-collapsed"
                                            id="ref-for-range-collapsed①">折叠</a>，返回 null。</p>
                                    <div class="note" role="note"> 如果 prefixMatch 的结尾或其后第一个非空白字符已在文档末尾，会发生此情况。 </div>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                            id="ref-for-assert③">断言</a>：<var>matchRange</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                            id="ref-for-concept-range-start-node②">start node</a> 必为 <code
                                            class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#text" id="ref-for-text">Text</a></code>
                                        节点。</p>
                                    <div class="note" role="note"> <var>matchRange</var> 的起点现在就是 prefix 匹配后第一个非空白文本。
                                    </div>
                                <li data-md>
                                    <p>令 <var>mustEndAtWordBoundary</var> 为 true 当 <var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-end"
                                            id="ref-for-text-directive-end⑥">end</a> 非 null 或 <var>parsedValues</var> 的
                                        <a data-link-type="dfn" href="#text-directive-suffix"
                                            id="ref-for-text-directive-suffix③">suffix</a> 为 null，否则为 false。
                                    </p>
                                <li data-md>
                                    <p>设 <var>potentialMatch</var> 为 <a data-link-type="dfn"
                                            href="#find-a-string-in-range" id="ref-for-find-a-string-in-range①">find a
                                            string in
                                            range</a>（参数：<var>query</var> = <var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-start"
                                            id="ref-for-text-directive-start⑥">start</a>，<var>searchRange</var> =
                                        <var>matchRange</var>，<var>wordStartBounded</var> =
                                        false，<var>wordEndBounded</var> = <var>mustEndAtWordBoundary</var>）。
                                    </p>
                                <li data-md>
                                    <p>如 <var>potentialMatch</var> 为 null，返回 null。</p>
                                <li data-md>
                                    <p>如 <var>potentialMatch</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start⑥">start</a> 不等于 <var>matchRange</var> 的
                                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start⑦">start</a>，则 <a data-link-type="dfn"
                                            href="https://infra.spec.whatwg.org/#iteration-continue"
                                            id="ref-for-iteration-continue①">跳过本次</a> 继续查找下一个 <a data-link-type="dfn"
                                            href="#text-directive-prefix" id="ref-for-text-directive-prefix⑥">prefix</a>
                                        的实例。
                                    </p>
                                    <div class="note" role="note"> 此时虽找到前缀，但其后并非匹配文本，故继续查下次前缀。</div>
                            </ol>
                        <li data-md>
                            <p>否则：</p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>mustEndAtWordBoundary</var> 为 true 当 <var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-end"
                                            id="ref-for-text-directive-end⑦">end</a> 非 null 或 <var>parsedValues</var>
                                        的 <a data-link-type="dfn" href="#text-directive-suffix"
                                            id="ref-for-text-directive-suffix④">suffix</a> 为 null，否则为 false。
                                    </p>
                                <li data-md>
                                    <p>设 <var>potentialMatch</var> 为 <a data-link-type="dfn"
                                            href="#find-a-string-in-range" id="ref-for-find-a-string-in-range②">find a
                                            string in
                                            range</a>（参数：<var>query</var> = <var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-start"
                                            id="ref-for-text-directive-start⑦">start</a>，<var>searchRange</var>，<var>wordStartBounded</var>
                                        = true，<var>wordEndBounded</var> = <var>mustEndAtWordBoundary</var>）。
                                    </p>
                                <li data-md>
                                    <p>如 <var>potentialMatch</var> 为 null，返回 null。</p>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的起点设为 <var>potentialMatch</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start⑨">start</a> 之后的第一个边界点。</p>
                            </ol>
                        <li data-md>
                            <p>令 <var>rangeEndSearchRange</var> 为范围，从 <var>potentialMatch</var> 的 <a
                                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                    id="ref-for-concept-range-end⑤">end</a> 到 <var>searchRange</var> 的 <a
                                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                    id="ref-for-concept-range-end⑥">end</a>。</p>
                        <li data-md>
                            <p>当 <var>rangeEndSearchRange</var> 未<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#range-collapsed"
                                    id="ref-for-range-collapsed②">折叠</a>时：</p>
                            <ol>
                                <li data-md>
                                    <p>如 <var>parsedValues</var> 的 <a data-link-type="dfn" href="#text-directive-end"
                                            id="ref-for-text-directive-end⑧">end</a> 非 null：</p>
                                    <ol>
                                        <li data-md>
                                            <p>令 <var>mustEndAtWordBoundary</var> 为 true 当 <var>parsedValues</var> 的 <a
                                                    data-link-type="dfn" href="#text-directive-suffix"
                                                    id="ref-for-text-directive-suffix⑤">suffix</a> 为 null，否则为 false。
                                            </p>
                                        <li data-md>
                                            <p>设 <var>endMatch</var> 为 <a data-link-type="dfn"
                                                    href="#find-a-string-in-range"
                                                    id="ref-for-find-a-string-in-range③">find a string
                                                    in range</a>（参数：<var>query</var> = <var>parsedValues</var> 的 <a
                                                    data-link-type="dfn" href="#text-directive-end"
                                                    id="ref-for-text-directive-end⑨">end</a>，<var>searchRange</var> =
                                                <var>rangeEndSearchRange</var>，<var>wordStartBounded</var> =
                                                true，<var>wordEndBounded</var> = <var>mustEndAtWordBoundary</var>）。
                                            </p>
                                        <li data-md>
                                            <p>如 <var>endMatch</var> 为 null 则返回 null。</p>
                                        <li data-md>
                                            <p>将 <var>potentialMatch</var> 的 <a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-range-end"
                                                    id="ref-for-concept-range-end⑧">end</a> 设为 <var>endMatch</var> 的 <a
                                                    data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-range-end"
                                                    id="ref-for-concept-range-end⑨">end</a>。</p>
                                    </ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                            id="ref-for-assert④">断言</a>：<var>potentialMatch</var> 非null、且未<a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed"
                                            id="ref-for-range-collapsed③">折叠</a>，且正好包含一段匹配文本。
                                    </p>
                                <li data-md>
                                    <p>如 <var>parsedValues</var> 的 <a data-link-type="dfn" href="#text-directive-suffix"
                                            id="ref-for-text-directive-suffix⑥">suffix</a>
                                        为 null，返回 <var>potentialMatch</var>。</p>
                                <li data-md>
                                    <p>令 <var>suffixRange</var> 为 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range"
                                            id="ref-for-concept-range②③">范围</a>：起点等于 <var>potentialMatch</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                            id="ref-for-concept-range-end①⓪">end</a>，终点等于 <var>searchRange</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                            id="ref-for-concept-range-end①①">end</a>。
                                    </p>
                                <li data-md>
                                    <p>将 <var>suffixRange</var> 的起点推进到<a data-link-type="dfn"
                                            href="#next-non-whitespace-position"
                                            id="ref-for-next-non-whitespace-position①">下一个非空白位置</a>。</p>
                                <li data-md>
                                    <p>设 <var>suffixMatch</var> 为 <a data-link-type="dfn" href="#find-a-string-in-range"
                                            id="ref-for-find-a-string-in-range④">find a
                                            string in range</a>（参数：<var>query</var> = <var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-suffix"
                                            id="ref-for-text-directive-suffix⑦">suffix</a>，<var>searchRange</var> =
                                        <var>suffixRange</var>，<var>wordStartBounded</var> =
                                        false，<var>wordEndBounded</var> = true）。
                                    </p>
                                <li data-md>
                                    <p>如 <var>suffixMatch</var> 为 null，则返回 null。</p>
                                    <div class="note" role="note"> 如文档剩余文本中无 suffix，则无可能命中。 </div>
                                <li data-md>
                                    <p>如 <var>suffixMatch</var> 的 <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start①③">start</a> 等于 <var>suffixRange</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start"
                                            id="ref-for-concept-range-start①④">start</a>，返回 <var>potentialMatch</var>。
                                    </p>
                                <li data-md>
                                    <p>如 <var>parsedValues</var> 的 <a data-link-type="dfn" href="#text-directive-end"
                                            id="ref-for-text-directive-end①⓪">end</a> 为 null，则 <a data-link-type="dfn"
                                            href="https://infra.spec.whatwg.org/#iteration-break"
                                            id="ref-for-iteration-break">中断</a>；</p>
                                    <div class="note" role="note"> 对精确匹配如 suffix 不符，则跳出循环寻下个 start。对区间匹配则会继续尝试后续
                                        rangeEnd。 </div>
                                <li data-md>
                                    <p>将 <var>rangeEndSearchRange</var> 的起点设为 <var>potentialMatch</var> 的 <a
                                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end"
                                            id="ref-for-concept-range-end①③">end</a>。
                                    </p>
                                    <div class="note" role="note"> 否则，表明 start 选对但 end 错，继续尝试下次 rangeEnd。 </div>
                            </ol>
                        <li data-md>
                            <p>如 <var>rangeEndSearchRange</var> 已<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#range-collapsed"
                                    id="ref-for-range-collapsed④">折叠</a>，则：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                            id="ref-for-assert⑤">断言</a>：<var>parsedValues</var> 的 <a
                                            data-link-type="dfn" href="#text-directive-end"
                                            id="ref-for-text-directive-end①①">end</a> 非 null</p>
                                <li data-md>
                                    <p>返回 null</p>
                                    <div class="note" role="note"> 只会在区间匹配中发生。若全 doc 无合法 end+suffix，则无可能命中。 </div>
                            </ol>
                    </ol>
                <li data-md>
                    <p>返回 null</p>
            </ol>
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>测试</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/scroll-to-text-fragment/find-range-from-text-directive.html"
                        title="scroll-to-text-fragment/find-range-from-text-directive.html">find-range-from-text-directive.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/scroll-to-text-fragment/find-range-from-text-directive.html"><small>（实时测试）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/scroll-to-text-fragment/find-range-from-text-directive.html"><small>（源码）</small></a>
            </ul>
        </details>
        <div class="algorithm" data-algorithm="advance range start to next non-whitespace position">
            要将<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②④">range</a> <var>range</var> 的<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-start" id="ref-for-concept-range-start①⑥">start</a>推进到
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="next non-whitespace position" data-noexport
                id="next-non-whitespace-position">下一个非空白位置</dfn>，按如下步骤：
            <ol class="algorithm">
                <li data-md>
                    <p>当 <var>range</var> 未折叠时：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>node</var> 为 <var>range</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                    id="ref-for-concept-range-start-node③">start node</a>。</p>
                        <li data-md>
                            <p>令 <var>offset</var> 为 <var>range</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                    id="ref-for-concept-range-start-offset">start offset</a>。</p>
                        <li data-md>
                            <p>如果 <var>node</var> 是<a data-link-type="dfn" href="#non-searchable-subtree"
                                    id="ref-for-non-searchable-subtree">不可搜索子树</a>的一部分，或 <var>node</var>
                                不是<a data-link-type="dfn" href="#visible-text-node"
                                    id="ref-for-visible-text-node">可见文本节点</a>，或 <var>offset</var>
                                等于 <var>node</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-node-length"
                                    id="ref-for-concept-node-length①">长度</a>，则：</p>
                            <ol>
                                <li data-md>
                                    <p>将 <var>range</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                            id="ref-for-concept-range-start-node④">start node</a> 设为下一个节点（按
                                        <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-shadow-including-tree-order"
                                            id="ref-for-concept-shadow-including-tree-order">包含shadow的树顺序</a>）。
                                    </p>
                                <li data-md>
                                    <p>将 <var>range</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset①">start offset</a> 设为 0。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                            id="ref-for-iteration-continue②">继续</a></p>
                            </ol>
                        <li data-md>
                            <p>如果 <var>node</var> 在 <var>offset</var> 处 6 个字符的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-cd-substring"
                                    id="ref-for-concept-cd-substring">子串数据</a>为 "&amp;nbsp;"，则：
                            </p>
                            <ol>
                                <li data-md>
                                    <p><var>range</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset②">start offset</a>加 6。</p>
                            </ol>
                        <li data-md>
                            <p>否则，若 <var>node</var> 在 <var>offset</var> 处 5 个字符的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-cd-substring"
                                    id="ref-for-concept-cd-substring①">子串数据</a>为 "&amp;nbsp"，则：</p>
                            <ol>
                                <li data-md>
                                    <p><var>range</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset③">start offset</a>加 5。</p>
                            </ol>
                        <li data-md>
                            <p>否则：</p>
                            <ol>
                                <li data-md>
                                    <p>令 <var>cp</var> 为 <var>node</var> 数据 <a data-link-type="dfn"
                                            href="https://infra.spec.whatwg.org/#code-point"
                                            id="ref-for-code-point">码点</a>中下标 <var>offset</var> 处的码点。</p>
                                <li data-md>
                                    <p>如 <var>cp</var> 未设有 <a
                                            href="http://www.unicode.org/reports/tr44/#White_Space">White_Space</a>
                                        属性，则返回。</p>
                                <li data-md>
                                    <p><var>range</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset④">start offset</a>加 1。</p>
                            </ol>
                    </ol>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="find a string in a range">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="find-a-string-in-range">在范围内查找字符串</dfn>，给定
            <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑤">字符串</a>
            <var>query</var>、<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②⑤">range</a>
            <var>searchRange</var>，以及布尔 <var>wordStartBounded</var>、<var>wordEndBounded</var>，步骤如下：
            <div class="note" role="note"> 本算法返回表示 <var>query</var> 文本首次出现在 <var>searchRange</var> 内的 <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range②⑥">range</a>，可选地要求其起止为词边界（详见 <a href="#word-boundaries">§ 3.6.2
                    词边界</a>）。如未找到则返回 null。 </div>
            <div class="note" role="note">
                <p> 此算法基本思路是在块内遍历所有可搜索文本节点，将其收集为列表。将该列表拼为单一字符串，在其中搜索命中，并用节点列表确定与 DOM 的边界点，用于返回 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range②⑦">range</a>。</p>
                <p> 一旦遇到块节点即终止收集，例如如下结构：</p>
                <pre>&lt;div>
  a&lt;em>b&lt;/em>c&lt;div>d&lt;/div>e
&lt;/div>
</pre>
                <p></p>
                <p>会先在 "abc" 上查找，再查 "d"，再查 "e"。</p>
                <p>因此，<var>query</var> 只会命中同一块级容器内，未被其他块元素打断的连续文本。</p>
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>当 <var>searchRange</var> 未<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#range-collapsed" id="ref-for-range-collapsed⑤">折叠</a>时：
                    </p>
                    <ol>
                        <li data-md>
                            <p>令 <var>curNode</var> 为 <var>searchRange</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                    id="ref-for-concept-range-start-node⑤">start node</a>。</p>
                        <li data-md>
                            <p>若 <var>curNode</var> 是<a data-link-type="dfn" href="#non-searchable-subtree"
                                    id="ref-for-non-searchable-subtree①">不可搜索子树</a>：</p>
                            <ol>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                            id="ref-for-concept-range-start-node⑥">start node</a>
                                        设为下一个<strong>不是</strong>
                                        <a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-shadow-including-descendant"
                                            id="ref-for-concept-shadow-including-descendant">包含shadow的后代</a>
                                        的节点（按包含shadow的树顺序）。
                                    </p>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset⑤">start offset</a> 设为 0。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                            id="ref-for-iteration-continue③">继续</a></p>
                            </ol>
                        <li data-md>
                            <p>若 <var>curNode</var> 不是<a data-link-type="dfn" href="#visible-text-node"
                                    id="ref-for-visible-text-node①">可见文本节点</a>：</p>
                            <ol>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-node"
                                            id="ref-for-concept-range-start-node⑦">start node</a>
                                        设为下一个<strong>不是</strong>
                                        <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-doctype"
                                            id="ref-for-concept-doctype">doctype</a> 的节点（按包含shadow的树顺序）。
                                    </p>
                                <li data-md>
                                    <p>将 <var>searchRange</var> 的<a data-link-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                                            id="ref-for-concept-range-start-offset⑥">start offset</a> 设为 0。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                            id="ref-for-iteration-continue④">继续</a></p>
                            </ol>
                        <li data-md>
                            <p>令 <var>blockAncestor</var> 为 <var>curNode</var> 的<a data-link-type="dfn"
                                    href="#nearest-block-ancestor" id="ref-for-nearest-block-ancestor">最近块级祖先</a>。</p>
                        <li data-md>
                            <p>令 <var>textNodeList</var> 为 <a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">Text 节点列表</a>，
                                初始为空。</p>
                        <li data-md>
                            <p>当 <var>curNode</var> 是 <var>blockAncestor</var> 的包含shadow的后代且 (<var>curNode</var>, 0)
                                边界点<strong>不是</strong> <var>searchRange</var> 的 end 之后时：</p>
                            <ol>
                                <li data-md>
                                    <p>若 <var>curNode</var> <a data-link-type="dfn" href="#has-block-level-display"
                                            id="ref-for-has-block-level-display">块级显示</a>，则<a data-link-type="dfn"
                                            href="https://infra.spec.whatwg.org/#iteration-break"
                                            id="ref-for-iteration-break②">跳出</a>。</p>
                                <li data-md>
                                    <p>若 <var>curNode</var> 是<a data-link-type="dfn" href="#search-invisible"
                                            id="ref-for-search-invisible">搜索不可见</a>：</p>
                                    <ol>
                                        <li data-md>
                                            <p>将 <var>curNode</var>
                                                设为下一个<strong>不是</strong>其包含shadow的后代的节点（按包含shadow的树顺序）。</p>
                                        <li data-md>
                                            <p><a data-link-type="dfn"
                                                    href="https://infra.spec.whatwg.org/#iteration-continue"
                                                    id="ref-for-iteration-continue⑤">继续</a></p>
                                    </ol>
                                <li data-md>
                                    <p>若 <var>curNode</var> 是<a data-link-type="dfn" href="#visible-text-node"
                                            id="ref-for-visible-text-node②">可见文本节点</a>则加入 <var>textNodeList</var>。</p>
                                <li data-md>
                                    <p>将 <var>curNode</var> 设为下一个节点（包含shadow树顺序）。</p>
                            </ol>
                        <li data-md>
                            <p>运行 <a data-link-type="dfn" href="#find-a-range-from-a-node-list"
                                    id="ref-for-find-a-range-from-a-node-list">find a range from a node list</a> 步骤，
                                入参 <var>query</var>, <var>searchRange</var>, <var>textNodeList</var>，
                                <var>wordStartBounded</var>, <var>wordEndBounded</var>。如果结果 <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range"
                                    id="ref-for-concept-range②⑧">range</a> 非 null，则返回。
                            </p>
                        <li data-md>
                            <p>如 <var>curNode</var> 为 null，则 <a data-link-type="dfn"
                                    href="https://infra.spec.whatwg.org/#iteration-break"
                                    id="ref-for-iteration-break③">跳出</a>。</p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                                    id="ref-for-assert⑥">断言</a>：<var>curNode</var> <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-following"
                                    id="ref-for-concept-tree-following">紧跟在</a> <var>searchRange</var>
                                的<span>start node</span>之后。</p>
                        <li data-md>
                            <p>将 <var>searchRange</var> 的 <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-start"
                                    id="ref-for-concept-range-start①⑦">start</a> 设为 (<var>curNode</var>,
                                0)。</p>
                    </ol>
                <li data-md>
                    <p>返回 null。</p>
            </ol>
        </div>
        <p>如果一个节点是<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element"
                id="ref-for-concept-element③">元素</a>，属于<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace">HTML
                命名空间</a>，并且满足下列任一条件，则该节点为<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="search-invisible">搜索不可见</dfn>。</p>
        <ol>
            <li data-md>
                <p>其 <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value"
                        id="ref-for-computed-value">样式计算值</a> 的 <a class="property css" data-link-type="property"
                        href="https://drafts.csswg.org/css-display-4/#propdef-display"
                        id="ref-for-propdef-display">display</a> 属性为 <a class="css" data-link-type="maybe"
                        href="https://drafts.csswg.org/css-display-4/#valdef-display-none"
                        id="ref-for-valdef-display-none">none</a>。</p>
            <li data-md>
                <p>该节点<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/parsing.html#serializes-as-void"
                        id="ref-for-serializes-as-void">序列化后为空元素</a>。</p>
            <li data-md>
                <p>类型为下列之一：
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement">HTMLIFrameElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/embedded-content.html#htmlimageelement" id="ref-for-htmlimageelement">HTMLImageElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/form-elements.html#htmlmeterelement" id="ref-for-htmlmeterelement">HTMLMeterElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlobjectelement" id="ref-for-htmlobjectelement">HTMLObjectElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/form-elements.html#htmlprogresselement" id="ref-for-htmlprogresselement">HTMLProgressElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/semantics.html#htmlstyleelement" id="ref-for-htmlstyleelement">HTMLStyleElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement" id="ref-for-htmlscriptelement">HTMLScriptElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement" id="ref-for-htmlvideoelement">HTMLVideoElement</a></code>，
                    <code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlaudioelement" id="ref-for-htmlaudioelement">HTMLAudioElement</a></code>
                </p>
            <li data-md>
                <p>是
                    <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-select-element" id="ref-for-the-select-element">select</a></code>
                    元素，且其
                    <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/form-elements.html#attr-select-multiple" id="ref-for-attr-select-multiple">multiple</a></code>
                    属性不存在。
                </p>
        </ol>
        <p>如果节点本身或其任一<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-including-ancestor"
                id="ref-for-concept-shadow-including-ancestor">包含shadow的祖先</a>
            是<a data-link-type="dfn" href="#search-invisible" id="ref-for-search-invisible①">搜索不可见</a>，则为 <dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="non-searchable-subtree">不可搜索子树</dfn>。</p>
        <p>如果节点是 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#text" id="ref-for-text②">Text</a></code>
            节点，其父元素的<a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value"
                id="ref-for-computed-value①">样式计算值</a>的 <a class="property css" data-link-type="property"
                href="https://drafts.csswg.org/css-display-4/#propdef-visibility"
                id="ref-for-propdef-visibility">visibility</a> 属性为 <a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-4/#valdef-visibility-visible"
                id="ref-for-valdef-visibility-visible">visible</a>，且节点正在<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/rendering.html#being-rendered"
                id="ref-for-being-rendered">被渲染</a>，则为 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="visible-text-node">可见文本节点</dfn>。</p>
        <p>如果节点是 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element"
                id="ref-for-concept-element④">element</a>，且其
            <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value"
                id="ref-for-computed-value②">样式计算值</a>的 <a class="property css" data-link-type="property"
                href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①">display</a>
            属性为下述任意值：
            <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-4/#valdef-display-block"
                id="ref-for-valdef-display-block">block</a>、<a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-4/#valdef-display-table"
                id="ref-for-valdef-display-table">table</a>、<a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-4/#valdef-display-flow-root"
                id="ref-for-valdef-display-flow-root">flow-root</a>、<a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-3/#valdef-display-grid"
                id="ref-for-valdef-display-grid">grid</a>、<a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-3/#valdef-display-flex"
                id="ref-for-valdef-display-flex">flex</a>、<a class="css" data-link-type="maybe"
                href="https://drafts.csswg.org/css-display-4/#valdef-display-list-item"
                id="ref-for-valdef-display-list-item">list-item</a>，则有 <dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="has-block-level-display">块级显示</dfn>。
        </p>
        <div class="algorithm" data-algorithm="nearest block ancestor">
            要获取 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="nearest-block-ancestor">最近块级祖先</dfn>，输入
            <var>node</var> ，
            按如下步骤：
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>curNode</var> = <var>node</var>。</p>
                <li data-md>
                    <p>当 <var>curNode</var> 非 null 时</p>
                    <ol>
                        <li data-md>
                            <p>如 <var>curNode</var> 非 <code
                                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#text" id="ref-for-text③">Text</a></code>
                                节点，且 <var>curNode</var> <a data-link-type="dfn" href="#has-block-level-display"
                                    id="ref-for-has-block-level-display①">块级显示</a>，则返回 <var>curNode</var>。</p>
                        <li data-md>
                            <p>否则，<var>curNode</var> 设为其<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-parent"
                                    id="ref-for-concept-tree-parent②">父节点</a>。</p>
                    </ol>
                <li data-md>
                    <p>返回 <var>node</var> 的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-document"
                            id="ref-for-concept-node-document">所属文档</a>的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#document-element" id="ref-for-document-element">文档元素</a>。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="range from node list">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="find-a-range-from-a-node-list">从节点列表查找范围</dfn>，输入 search string <var>queryString</var>、
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②⑨">range</a> <var>searchRange</var>、<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">Text 节点列表</a> <var>nodes</var>、布尔
            <var>wordStartBounded</var> 和 <var>wordEndBounded</var>，如下：
            <div class="note" role="note">
                可选：仅当匹配文本在<a data-link-type="dfn" href="#word-boundary" id="ref-for-word-boundary">词边界</a>上起止时返回匹配。
                例如：
                <div class="example" id="example-27ab4025">
                    <a class="self-link" href="#example-27ab4025"></a> 查询字符串 “range” 总能在 “mountain range” 匹配，但
                    <ol>
                        <li data-md>
                            <p>如需起始词边界，则不会在 “color orange” 匹配。</p>
                        <li data-md>
                            <p>如需结束词边界，则不会在 “forest ranger” 匹配。</p>
                    </ol>
                </div>
                <p>见 <a href="#word-boundaries">§ 3.6.2 词边界</a> 了解详情与更多示例。</p>
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>searchBuffer</var> 为 <a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#string-concatenate"
                            id="ref-for-string-concatenate">拼接</a> <var>nodes</var> 内各节点的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-cd-data" id="ref-for-concept-cd-data">data</a>。
                    </p>
                    <p class="issue" id="issue-96fe4755"><a class="self-link" href="#issue-96fe4755"></a> <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-cd-data"
                            id="ref-for-concept-cd-data②">data</a> 不是所需的渲染文本。该算法需要针对渲染文本遍历（再映射回 DOM 范围）。<a
                            href="https://github.com/WICG/scroll-to-text-fragment/issues/98">[Issue
                            #WICG/scroll-to-text-fragment#98]</a></p>
                <li data-md>
                    <p>令 <var>searchStart</var> = 0。</p>
                <li data-md>
                    <p>如 <var>nodes</var> 首项是 <var>searchRange</var> 的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-node"
                            id="ref-for-concept-range-start-node⑨">start node</a> ，则
                        <var>searchStart</var> 设为 <var>searchRange</var> 的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-offset"
                            id="ref-for-concept-range-start-offset⑦">start offset</a>。
                    </p>
                <li data-md>
                    <p>令 <var>start</var> 和 <var>end</var> 均为<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp"
                            id="ref-for-concept-range-bp④">边界点</a>，初值为 null。</p>
                <li data-md>
                    <p>令 <var>matchIndex</var> 为 null。</p>
                <li data-md>
                    <p>当 <var>matchIndex</var> 为 null 时，循环：</p>
                    <ol>
                        <li data-md>
                            <p>从 <var>searchStart</var> 起，用基本字符对比（或 <a
                                    href="http://www.unicode.org/reports/tr10/#Multi_Level_Comparison">一级</a>，见 <a
                                    data-link-type="biblio" href="#biblio-uts10"
                                    title="Unicode Collation Algorithm">[UTS10]</a>）在 <var>searchBuffer</var> 首次查找
                                <var>queryString</var> 的索引。
                            </p>
                            <div class="note" role="note"> 即大小写不敏感且忽略重音、变音等的查找。 </div>
                        <li data-md>
                            <p>如 <var>matchIndex</var> 为 null，返回 null。</p>
                        <li data-md>
                            <p>令 <var>endIx</var> = <var>matchIndex</var> + <var>queryString</var> 的<a
                                    data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-length"
                                    id="ref-for-string-length">长度</a>。</p>
                            <div class="note" role="note"> <var>endIx</var> 即命中最后一字符的下标+1。 </div>
                        <li data-md>
                            <p>设置 <var>start</var> 为 <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-bp"
                                    id="ref-for-concept-range-bp⑤">边界点</a>，由 <a data-link-type="dfn"
                                    href="#get-boundary-point-at-index" id="ref-for-get-boundary-point-at-index">get
                                    boundary point at index</a>(<var>matchIndex</var>, <var>nodes</var>, false)。</p>
                        <li data-md>
                            <p>设置 <var>end</var> 为 <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-range-bp"
                                    id="ref-for-concept-range-bp⑥">边界点</a>，由 <a data-link-type="dfn"
                                    href="#get-boundary-point-at-index" id="ref-for-get-boundary-point-at-index①">get
                                    boundary point at index</a>(<var>endIx</var>, <var>nodes</var>, true)。</p>
                        <li data-md>
                            <p>如 <var>wordStartBounded</var> 为 true 且 <var>matchIndex</var> 在 <var>searchBuffer</var> 非
                                <a data-link-type="dfn" href="#is-at-a-word-boundary"
                                    id="ref-for-is-at-a-word-boundary">词边界</a>（使用 <var>start</var> 的<a
                                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node"
                                    id="ref-for-boundary-point-node">node</a> 的 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/dom.html#language"
                                    id="ref-for-language">语言</a>）；或 <var>wordEndBounded</var> 为 true 且
                                <var>matchIndex</var> + <var>queryString</var> 的
                                <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-length"
                                    id="ref-for-string-length①">长度</a> 在 <var>searchBuffer</var> 非 <a
                                    data-link-type="dfn" href="#is-at-a-word-boundary"
                                    id="ref-for-is-at-a-word-boundary①">词边界</a>（用 <var>end</var> 的<a
                                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node"
                                    id="ref-for-boundary-point-node①">node</a> 的 <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/dom.html#language"
                                    id="ref-for-language①">语言</a>）：
                            </p>
                            <ol>
                                <li data-md>
                                    <p><var>searchStart</var> = <var>matchIndex</var> + 1。</p>
                                <li data-md>
                                    <p><var>matchIndex</var> = null。</p>
                            </ol>
                    </ol>
                <li data-md>
                    <p>令 <var>endInset</var> = 0。</p>
                <li data-md>
                    <p>若 <var>nodes</var> 的最后一项为 <var>searchRange</var> 的<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-node"
                            id="ref-for-concept-range-end-node②">end node</a>，则 <var>endInset</var> =
                        <var>searchRange</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-node"
                            id="ref-for-concept-range-end-node③">end node</a> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length"
                            id="ref-for-concept-node-length②">长度</a> − <var>searchRange</var> 的 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-offset"
                            id="ref-for-concept-range-end-offset">end offset</a>。
                    </p>
                    <div class="note" role="note"> <var>endInset</var> 是最后一节点未被纳入范围的长度。 </div>
                <li data-md>
                    <p>如 <var>matchIndex</var> + <var>queryString</var> 的<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#string-length" id="ref-for-string-length②">长度</a>
                        大于 <var>searchBuffer</var> 的长度 − <var>endInset</var>，则返回 null。</p>
                    <div class="note" role="note"> 若匹配内容超出范围尾部则返回 null。</div>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert⑦">断言</a>：<var>start</var> 和 <var>end</var> 均为非 null 且为
                        <var>searchRange</var> 内有效<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp" id="ref-for-concept-range-bp⑦">边界点</a>。
                    </p>
                <li data-md>
                    <p>返回范围：<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                            id="ref-for-concept-range③⓪">range</a>，其 <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start"
                            id="ref-for-concept-range-start①⑧">start</a> = <var>start</var>，<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end"
                            id="ref-for-concept-range-end①⑤">end</a> = <var>end</var>。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="boundary point at index">
            要 <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="get-boundary-point-at-index">获取指定下标的边界点</dfn>，输入整数 <var>index</var>、<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⓪">Text 节点列表</a> <var>nodes</var> 和布尔
            <var>isEnd</var>：
            <div class="note" role="note">
                <p> 这是上文用到的小工具，用于推断拼接字符串中的下标属于哪个节点。</p>
                <p> <var>isEnd</var> 用于区分起止边界。终止边界指向匹配结果后一字符，如命中刚好在节点边界，则终止偏移也留在本节点末尾而不是下个节点头。</p>
            </div>
            <ol class="algorithm">
                <li data-md>
                    <p>令 <var>counted</var> = 0。</p>
                <li data-md>
                    <p>依次迭代 <var>nodes</var>：</p>
                    <ol>
                        <li data-md>
                            <p>令 <var>nodeEnd</var> = <var>counted</var> + <var>curNode</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-node-length"
                                    id="ref-for-concept-node-length③">长度</a>。</p>
                        <li data-md>
                            <p>如 <var>isEnd</var> 为 true，<var>nodeEnd</var> 加 1。</p>
                        <li data-md>
                            <p>如 <var>nodeEnd</var> 大于 <var>index</var>：</p>
                            <ol>
                                <li data-md>
                                    <p>返回 <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                                            id="ref-for-concept-range-bp⑧">边界点</a>（<var>curNode</var>, <var>index</var>
                                        − <var>counted</var>）。</p>
                            </ol>
                        <li data-md>
                            <p><var>counted</var> 加 <var>curNode</var> 的<a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-node-length"
                                    id="ref-for-concept-node-length④">长度</a>。</p>
                    </ol>
                <li data-md>
                    <p>返回 null。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.6.2" id="word-boundaries"><span class="secno">3.6.2. </span><span
                class="content">词边界</span><a class="self-link" href="#word-boundaries"></a></h4>
        <div class="note" role="note"> 将匹配限制在词边界是限制跨源信息泄露的缓解措施之一。 </div>
        <div class="note" role="note"> 参见 <a href="https://github.com/tc39/proposal-intl-segmenter">Intl.Segmenter</a>，
            一个用于指定 Unicode 分割（包括单词分割）的提案。一旦规范化，本算法可以通过使用 Intl.Segmenter API 来改进词边界匹配。 </div>
        <p> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="word-boundary">词边界</dfn> 在 <a
                data-link-type="biblio" href="#biblio-uax29" title="Unicode Text Segmentation">[UAX29]</a> 的 <a
                href="https://www.unicode.org/reports/tr29/tr29-43.html#Word_Boundaries">Unicode 文本分割
                § Word_Boundaries</a> 中定义。<a
                href="https://www.unicode.org/reports/tr29/tr29-43.html#Default_Word_Boundaries">Unicode 文本分割
                § 默认词边界</a> 定义了默认的词边界集合，但如规范所述，应根据区域设置使用更复杂的算法。
        </p>
        <p> 基于词典的词界定在没有单词分隔字符的语言区域设置中应特别注意。例如在英语中，单词由空格字符（' '）分隔；然而在日语中没有将单词彼此分隔的字符。在此类情况中，且当字母表字符少于 100
            个时，词典中被视为有效的一字词不得超过字母表的 20%。 </p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="locale">区域设置</dfn> 是一个<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑥">字符串</a>，包含一个有效的 <a
                data-link-type="biblio" href="#biblio-bcp47" title="Tags for Identifying Languages">[BCP47]</a>
            语言标签，或为空字符串。空字符串表示主要语言未知。</p>
        <p>在给定 <a data-link-type="dfn" href="#locale" id="ref-for-locale">区域设置</a> <var>startLocale</var> 和
            <var>endLocale</var> 的情况下，子字符串在 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string"
                id="ref-for-string⑦">字符串</a> <var>text</var> 中被称为 <dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="word-bounded">词界定</dfn>，当且仅当其首字符的位置在给定 <var>startLocale</var> 下 <a
                data-link-type="dfn" href="#is-at-a-word-boundary"
                id="ref-for-is-at-a-word-boundary②">处于词边界</a>，并且其末字符之后的位置在给定 <var>endLocale</var> 下 <a
                data-link-type="dfn" href="#is-at-a-word-boundary" id="ref-for-is-at-a-word-boundary③">处于词边界</a>。
        </p>
        <p>一个数字 <var>position</var> 在给定 <a data-link-type="dfn" href="#locale" id="ref-for-locale①">区域设置</a>
            <var>locale</var> 的情况下，若在 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string"
                id="ref-for-string⑧">字符串</a> <var>text</var> 中，按照 <var>locale</var> 的规则，要么在第 <var>position</var>
            个代码单元之前立即存在一个 <a data-link-type="dfn" href="#word-boundary" id="ref-for-word-boundary①">词边界</a>，要么
            <var>text</var> 的长度大于 0 且 <var>position</var> 等于 0 或等于 <var>text</var> 的长度，则称该 <var>position</var> <dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="is-at-a-word-boundary">处于词边界</dfn>。
        </p>
        <div class="note" role="note">
            直观上，若子字符串既不在单词中间开始也不在单词中间结束，则称其为<a data-link-type="dfn" href="#word-bounded"
                id="ref-for-word-bounded">词界定</a>。
            <p>对于有单词分隔符（例如空格）的语言，这（大多）是直接的；尽管还有诸如换行、连字符、引号等细节由上面的技术报告覆盖。</p>
            <p>有些语言没有这样的分隔符（尤其是中/日/韩）。此类语言需要词典来确定给定区域设置中什么才是有效单词。</p>
        </div>
        <div class="example" id="example-0a0acb46">
            <a class="self-link" href="#example-0a0acb46"></a>
            <p> 文本片段受限于匹配项在与其相邻的上下文项结合时为词界定。例如，在像 <code>prefix,start,suffix</code>
                的精确搜索中，只有当整个结果为词界定时，<code>"prefix+start+suffix"</code> 才会匹配。然而，在类似 <code>prefix,start,end,suffix</code>
                的范围搜索中，当且仅当 <code>"prefix+start"</code> 和 <code>"end+suffix"</code> 均为词界定时才会找到匹配。 </p>
            <p> 目标是第三方必须已经知道它们正在匹配的完整 token。像 <code>start,end</code> 的范围匹配必须在两术语内部为词界定；否则第三方可以重复使用此方法试图揭示一个
                token（例如在页面包含 <code>"Balance: 123,456 $"</code> 的情况下，第三方可以设置
                <code>prefix="Balance: "</code>、<code>end="$"</code> 并通过改变 <code>start</code> 来逐位猜测数字 token）。
            </p>
            <p> 更多细节见 <a
                    href="https://docs.google.com/document/d/1YHcl1-vE_ZnZ0kL2almeikAj2gkwCq8_5xwIae7PVik/edit#heading=h.78iny7nejmx2">安全评审文档</a>
            </p>
        </div>
        <div class="example" id="example-1b2a6f00"><a class="self-link" href="#example-1b2a6f00"></a> 子字符串 "mountain
            range" 在字符串 "An impressive
            mountain range" 中是词界定的，但在 "An impressive mountain ranger" 中则不是。 </div>
        <div class="example" id="example-c7882c95"><a class="self-link" href="#example-c7882c95"></a> 在日语字符串 "<span
                lang="ja">ウィキペディアへようこそ</span>" （欢迎来到维基百科）中，"<span lang="ja">ようこそ</span>"（欢迎）被视为词界定，但 "<span
                lang="ja">ようこ</span>" 则不是。 </div>
        <h3 class="heading settled" data-level="3.7" id="indicating-the-text-match"><span class="secno">3.7.
            </span><span class="content">指示文本匹配</span><a class="self-link" href="#indicating-the-text-match"></a></h3>
        <p>用户代理可以选择在 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#try-to-scroll-to-the-fragment"
                id="ref-for-try-to-scroll-to-the-fragment①">尝试滚动到片段</a> 步骤中或通过其他机制将文本片段滚动到可见区域；但并不要求必须将匹配滚动到视图中。</p>
        <p>用户代理应该以某种方式在视觉上指示被匹配的文本，使用户能够注意到该匹配，例如使用高对比度高亮。</p>
        <p>用户代理应向用户提供某种取消匹配指示的方法，使得被匹配的文本不再以视觉方式被指示。</p>
        <p>具体的指示外观和机制由用户代理定义。然而，用户代理不得使用任何作者脚本可观察的方式来指示匹配，例如使用文档的 <a
                href="https://w3c.github.io/selection-api/#dfn-selection">selection</a>。这样做可能允许内容外泄的攻击向量。</p>
        <p>用户代理不得以任何方式对提供的上下文项进行可视指示。</p>
        <p>由于指示器不是文档内容的一部分，用户代理应考虑将其与页面内容在用户感知上区分开来。</p>
        <div class="example" id="example-30d9320e"><a class="self-link" href="#example-30d9320e"></a>
            用户代理可以在指示器首次出现的前几次提供内置帮助提示，帮助训练用户识别该指示来自链接页面并由用户代理提供。 </div>
        <h4 class="heading settled" data-level="3.7.1" id="urls-in-ua-features"><span class="secno">3.7.1. </span><span
                class="content">用户代理功能中的 URL</span><a class="self-link" href="#urls-in-ua-features"></a></h4>
        <p>用户代理为文档的 URL 提供了若干使用场景（不包括像 <code>window.location</code> 这样的程序化 API）。示例包括显示当前可见文档 URL
            的地址栏，或当用户请求为当前页面创建书签时使用的 URL。</p>
        <p>为避免用户困惑，用户代理在是否在这些 URL 中包含 <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive⑧">片段指令</a> 一事上应保持一致。本节为用户代理如何处理这些情况提供一组默认建议。</p>
        <div class="note" role="note">
            <p> 我们将这些作为一致行为的基线；然而，由于这些功能不影响跨用户代理互操作性，它们并非严格的一致性要求。 </p>
            <p> 具体行为由实现的用户代理决定，用户代理可能有不同的约束或修改行为的理由。例如，用户代理可以允许用户配置默认值或在 UI 中提供选项，让用户选择是否希望在这些 URL 中包含片段指令。 </p>
            <p> 也有利于允许用户代理试验以提供更好的体验。例如：也许当用户滚动并将文本片段移出视图时，用户代理显示的 URL 可以省略文本片段？</p>
            <p></p>
        </div>
        <p>一般原则是：只有当视觉指示可见（即未被取消）时，URL 才应包含 <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive⑨">片段指令</a>。如果用户取消了指示，URL 应通过移除 <a data-link-type="dfn"
                href="#fragment-directive" id="ref-for-fragment-directive①⓪">片段指令</a> 来反映该操作。</p>
        <p>如果 URL 包含文本片段但在当前页面未找到匹配，用户代理可以选择在暴露的 URL 中省略它。</p>
        <div class="note" role="note">
            <p> 未在页面中找到的文本片段可以作为信息向用户展示，提示页面自链接创建以来已发生变化。 </p>
            <p> 然而，对于书签来说，它通常并不太有用。 </p>
        </div>
        <p>下面提供一些常见示例。</p>
        <div class="note" role="note"> 这里将“文本片段”和“片段指令”互换使用，因为假定文本片段是唯一的指令类型。若将来添加其它指令类型，则这些场景下的用户体验需针对新指令类型单独评估。 </div>
        <h5 class="heading settled" data-level="3.7.1.1" id="urls-in-location-bar"><span class="secno">3.7.1.1.
            </span><span class="content">地址栏</span><a class="self-link" href="#urls-in-location-bar"></a></h5>
        <p>地址栏的 URL 在被视觉指示时应包含文本片段。当用户取消该指示时，片段指令应从地址栏 URL 中剥离。</p>
        <p>建议即便在文档中未找到匹配，也在地址栏的 URL 中显示文本片段。</p>
        <h5 class="heading settled" data-level="3.7.1.2" id="urls-in-bookmarks"><span class="secno">3.7.1.2.
            </span><span class="content">书签</span><a class="self-link" href="#urls-in-bookmarks"></a></h5>
        <p>许多用户代理提供“书签”功能，允许用户在用户代理界面中存储指向当前页面的便捷链接。</p>
        <p>新创建的书签默认应当在 URL 中包含 <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive①②">片段指令</a> 当且仅当 已找到匹配并且视觉指示尚未取消。</p>
        <p>从书签导航到 URL 应按典型导航的方式处理 <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive①③">片段指令</a>。</p>
        <h5 class="heading settled" data-level="3.7.1.3" id="urls-in-sharing"><span class="secno">3.7.1.3. </span><span
                class="content">分享</span><a class="self-link" href="#urls-in-sharing"></a></h5>
        <p>一些用户代理提供将当前页面共享给他人的方法，通常是将 URL 提供给另一个应用或消息服务。</p>
        <p>在这些情况下提供 URL 时，只有当已找到匹配并且视觉指示尚未取消时，才应包含 <a data-link-type="dfn" href="#fragment-directive"
                id="ref-for-fragment-directive①④">片段指令</a>。</p>
        <h3 class="heading settled" data-level="3.8" id="document-policy-integration"><span class="secno">3.8.
            </span><span class="content">文档策略集成</span><a class="self-link" href="#document-policy-integration"></a></h3>
        <p>本规范在 <a href="https://wicg.github.io/document-policy#configuration-point">Document Policy</a> 中定义了名为
            "force-load-at-top" 的配置点。其类型为 <code>boolean</code>，<a
                href="https://wicg.github.io/document-policy#configuration-point-default-value">默认值</a> 为
            <code>false</code>。
        </p>
        <div class="note" role="note"> 当启用时，此策略将禁用所有自动加载时滚动功能：文本片段、元素片段、历史滚动恢复。 </div>
        <div class="example" id="example-a128f34b">
            <a class="self-link" href="#example-a128f34b"></a> 假设用户导航到
            <code>https://example.com#:~:text=foo</code>。example.com 服务器响应包含头：
            <pre>Document-Policy: force-load-at-top
</pre>
            <p>当页面加载时，包含 "foo" 的元素将被标记为指示部分并设为文档的目标元素。但是，"foo" 不会被滚动到可见区域。</p>
        </div>
        <p>该策略对基于片段的滚动阻止在对 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier"
                id="ref-for-scroll-to-the-fragment-identifier④">滚动到片段</a> 算法的修订中进行了规定，见本文件的 <a
                href="#navigating-to-text-fragment">§ 3.6 导航到文本片段</a> 部分。</p>
        <p>历史滚动恢复通过在 <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#restore-persisted-state"
                id="ref-for-restore-persisted-state①">恢复持久化状态</a> 步骤中插入新步骤（在步骤 2 之后）来被阻止：</p>
        <ol start="3">
            <li data-md>
                <p><a href="https://wicg.github.io/document-policy#algo-get-policy-value">获取文档策略值</a> 中
                    "force-load-at-top" 特性的值，针对该 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document"
                        id="ref-for-concept-document①⓪">Document</a>。如果结果为 true，则用户代理不应为该 <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document"
                        id="ref-for-concept-document①①">Document</a> 或其任何可滚动区域恢复滚动位置。</p>
        </ol>
        <h3 class="heading settled" data-level="3.9" id="feature-detectability"><span class="secno">3.9. </span><span
                class="content">特性可检测性</span><a class="self-link" href="#feature-detectability"></a></h3>
        <p>为特性可检测性，我们建议添加一个新的 FragmentDirective 接口，当用户代理支持该特性时，通过 <code>document.fragmentDirective</code> 暴露。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="fragmentdirective"><code><c- g>FragmentDirective</c-></code></dfn> {
};
</pre>
        <p>我们将 <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>
            接口补充为包含一个 <code>fragmentDirective</code> 属性：</p>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①"><c- g>Document</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#fragmentdirective" id="ref-for-fragmentdirective"><c- n>FragmentDirective</c-></a> <dfn class="idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export data-readonly data-type="FragmentDirective" id="dom-document-fragmentdirective"><code><c- g>fragmentDirective</c-></code><a class="self-link" href="#dom-document-fragmentdirective"></a></dfn>;
};
</pre>
        <p>该对象未来可用于暴露有关文本片段或其他片段指令的更多信息。</p>
        <h2 class="heading settled" data-level="4" id="generating-text-fragment-directives"><span class="secno">4.
            </span><span class="content">生成文本片段指令</span><a class="self-link"
                href="#generating-text-fragment-directives"></a></h2>
        <div class="note" role="note"> 本节为非规范性内容。 </div>
        <p>本节包含建议，供用户代理自动生成带有 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①④">文本指令</a> 的
            URL 时参考。这些建议并非规范性，但用于确保生成的 URL 在稳定性和可用性上尽可能良好。</p>
        <h3 class="heading settled" data-level="4.1" id="prefer-exact-matching-to-range-based"><span class="secno">4.1.
            </span><span class="content">优先精确匹配而非基于范围的匹配</span><a class="self-link"
                href="#prefer-exact-matching-to-range-based"></a></h3>
        <p>匹配文本可以作为精确字符串 "text=foo%20bar%20baz" 提供，或作为范围 "text=foo,bar" 提供。</p>
        <p>在可行情况下，优先指定整个字符串。这可以确保即使目标页面被删除或更改，预期的目标仍能从 URL 本身推断出来。</p>
        <div class="example" id="example-53e82e58">
            <a class="self-link" href="#example-53e82e58"></a> 假设我们希望为
            https://en.wikipedia.org/wiki/History_of_computing 构造引用句子：
            <pre>The first recorded idea of using digital electronics for computing was the
1931 paper "The Use of Thyratrons for High Speed Automatic Counting of
Physical Phenomena" by C. E. Wynn-Williams.
</pre>
            <p>我们可以创建一个基于范围的匹配，如下：</p>
            <p><a href="https://en.wikipedia.org/wiki/History_of_computing#:~:text=The%20first%20recorded,Williams">
                    https://en.wikipedia.org/wiki/History_of_computing#:~:text=The%20first%20recorded,Williams</a></p>
            <p>或者我们可以使用精确匹配对整句进行编码：</p>
            <p><a
                    href="https://en.wikipedia.org/wiki/History_of_computing#:~:text=The%20first%20recorded%20idea%20of%20using%20digital%20electronics%20for%20computing%20was%20the%201931%20paper%20%22The%20Use%20of%20Thyratrons%20for%20High%20Speed%20Automatic%20Counting%20of%20Physical%20Phenomena%22%20by%20C.%20E.%20Wynn-Williams">
                    https://en.wikipedia.org/wiki/History_of_computing#:~:text=The%20first%20recorded%20idea%20of%20using%20digital%20electronics%20for%20computing%20was%20the%201931%20paper%20%22The%20Use%20of%20Thyratrons%20for%20High%20Speed%20Automatic%20Counting%20of%20Physical%20Phenomena%22%20by%20C.%20E.%20Wynn-Williams</a>
            </p>
            <p>基于范围的匹配稳定性较差，意味着如果页面在更早处加入另一个 "The first recorded" 的实例，链接将定位到非预期的文本片段。</p>
            <p>基于范围的匹配在语义上也不够有用。如果页面被更改以删除该句子，用户将不知道原本想指向什么。在精确匹配情况下，用户可以读取或用户代理可以显示所搜索但未找到的文本。</p>
        </div>
        <p>当引用文本过长且对整个字符串编码会产生难以处理的 URL 时，基于范围的匹配可能有帮助。</p>
        <p>建议将短于 300 字符的文本片段使用精确匹配编码。超过该限值时，用户代理可以将字符串编码为基于范围的匹配。</p>
        <div class="note" role="note"> TODO: 是否能以不那么任意的方式确定上述限值？ </div>
        <h3 class="heading settled" data-level="4.2" id="use-context-only-when-necessary"><span class="secno">4.2.
            </span><span class="content">仅在必要时使用上下文</span><a class="self-link"
                href="#use-context-only-when-necessary"></a></h3>
        <p>上下文项允许 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①⑤">文本指令</a>
            对页面上的文本片段进行消歧。然而，它们的使用在某些情况下会使 URL 更脆弱。通常，所需的字符串会在元素边界开始或结束。上下文因此可能存在于相邻元素中。页面结构的变化可能会使上下文与匹配文本不再相邻，从而使 <a
                data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①⑥">文本指令</a> 失效。</p>
        <div class="example" id="example-7a86f6f5">
            <a class="self-link" href="#example-7a86f6f5"></a> 假设我们希望为以下文本构造 URL：
            <pre>&lt;div class="section">HEADER&lt;/div>
&lt;div class="content">Text to quote&lt;/div>
</pre>
            <p>我们可以这样构造 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①⑦">文本指令</a>：</p>
            <pre>text=HEADER-,Text%20to%20quote
</pre>
            <p>但是，假设页面更改，在所有章节标题旁增加了一个 "[edit]" 链接。此时该 URL 将被破坏。</p>
        </div>
        <p>当文本片段足够长且唯一时，鼓励用户代理避免添加多余的上下文项。</p>
        <p>仅在下列任一情况为真时使用上下文：</p>
        <ul>
            <li>用户代理判断所引用文本存在歧义
            <li>所引用文本包含 3 个或更少的单词
        </ul>
        <div class="note" role="note"> TODO: 以不那么任意的方式确定上述数字限制。 </div>
        <h3 class="heading settled" data-level="4.3" id="determine-if-fragment-id-is-needed"><span class="secno">4.3.
            </span><span class="content">确定是否需要片段 id</span><a class="self-link"
                href="#determine-if-fragment-id-is-needed"></a></h3>
        <p>当用户代理导航到包含 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①⑧">文本指令</a> 的 URL
            时，如果存在基于元素 id 的常规片段且未找到文本片段，将回退为滚动该元素 id 到视图中。</p>
        <p>在文档中更改文本使 <a data-link-type="dfn" href="#text-directive" id="ref-for-text-directive①⑨">文本指令</a>
            失效的情况下，这可以作为一种有用的后备。</p>
        <div class="example" id="example-5990805b">
            <a class="self-link" href="#example-5990805b"></a> 假设我们希望为
            https://en.wikipedia.org/wiki/History_of_computing 构造引用句子：
            <pre>The earliest known tool for use in computation is the Sumerian abacus
</pre>
            <p>通过指定文本出现的章节，我们确保如果文本被更改或删除，用户仍会被指向相关章节：</p>
            <p><a
                    href="https://en.wikipedia.org/wiki/History_of_computing#Early_computation:~:text=The%20earliest%20known%20tool%20for%20use%20in%20computation%20is%20the%20Sumerian%20abacus">
                    https://en.wikipedia.org/wiki/History_of_computing#Early_computation:~:text=The%20earliest%20known%20tool%20for%20use%20in%20computation%20is%20the%20Sumerian%20abacus</a>
            </p>
        </div>
        <p>然而，用户代理应当确保回退的元素 id 片段是合适的：</p>
        <div class="example" id="example-3c4e565c">
            <a class="self-link" href="#example-3c4e565c"></a> 假设用户导航到
            https://en.wikipedia.org/wiki/History_of_computing#Early_computation。之后他们滚动到 Symbolic Computations
            小节，并在该处选择了一段文本，选择为其创建 URL：
            <pre>By the late 1960s, computer systems could perform symbolic algebraic
manipulations
</pre>
            <p>尽管页面当前的 URL 为：
                https://en.wikipedia.org/wiki/History_of_computing#Early_computation，但使用 #Early_computation
                作为回退并不合适。如果上面那句话被更改或删除，页面将加载到 #Early_computation 小节，可能会令用户感到困惑。</p>
            <p>如果用户代理无法可靠地确定适当的回退片段，应该从 URL 中移除片段 id：</p>
            <p><a
                    href="https://en.wikipedia.org/wiki/History_of_computing#:~:text=By%20the%20late%201960s,%20computer%20systems%20could%20perform%20symbolic%20algebraic%20manipulations">
                    https://en.wikipedia.org/wiki/History_of_computing#:~:text=By%20the%20late%201960s,%20computer%20systems%20could%20perform%20symbolic%20algebraic%20manipulations</a>
            </p>
        </div>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">一致性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文档惯例</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>一致性要求以描述性断言和 RFC 2119 术语的组合来表达。规范性的部分中关键词 “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
            “SHOULD NOT”, “RECOMMENDED”, “MAY”, 和 “OPTIONAL” 按照 RFC 2119 中的描述来解释。然而为提高可读性，这些词在本规范中并不全部以大写字母形式出现。 </p>
        <p>本规范的全部文本均为规范性，除非明确标注为非规范性的部分、示例和注释。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>本规范中的示例以“例如”引入或用 <code>class="example"</code> 与规范性文本区分开来，如下： </p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>这是一个说明性示例。 </p>
        </div>
        <p>说明性注释以 “Note” 开头，并用 <code>class="note"</code> 与规范性文本区分，如下： </p>
        <p class="note" role="note">注：这是一个说明性注释。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>Tests</summary>
            <p>与本规范内容相关的测试可能记录在类似的“Tests”块中。任何此类块均为非规范性。</p>
            <ul class="wpt-tests-list"></ul>
            <hr>
        </details>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本规范定义的术语</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#characterstring">CharacterString 字符串</a><span>，见 § 3.3.3</span>
        <li><a href="#check-if-a-text-directive-can-be-scrolled">检查文本指令是否可被滚动</a><span>，见 § 3.5.4</span>
        <li><a href="#directives">指令</a><span>，见 § 3.3</span>
        <li>
            指令状态
            <ul>
                <li><a href="#directive-state">定义</a><span>，见 § 3.3.1</span>
                <li><a href="#she-directive-state">she 的定义</a><span>，见 § 3.3.1</span>
            </ul>
        <li><a href="#text-directive-end">end 终止</a><span>，见 § 3.4</span>
        <li><a href="#explicitchar">ExplicitChar 显式字符</a><span>，见 § 3.3.3</span>
        <li><a href="#find-a-range-from-a-node-list">从节点列表查找范围</a><span>，见 § 3.6.1</span>
        <li><a href="#find-a-range-from-a-text-directive">从文本指令查找范围</a><span>，见 § 3.6.1</span>
        <li><a href="#find-a-string-in-range">在范围内查找字符串</a><span>，见 § 3.6.1</span>
        <li><a href="#first-common-ancestor">首个公共祖先</a><span>，见 § 3.6</span>
        <li><a href="#fragment-directive">片段指令</a><span>，见 § 3.3</span>
        <li>
            FragmentDirective
            <ul>
                <li><a href="#fragmentdirective">(接口)</a><span>，见 § 3.9</span>
                <li><a href="#fragmentdirectiveproduction">定义</a><span>，见 § 3.3.3</span>
            </ul>
        <li><a href="#dom-document-fragmentdirective">fragmentDirective 属性</a><span>，见 § 3.9</span>
        <li><a href="#fragment-directive-delimiter">片段指令分隔符</a><span>，见 § 3.3</span>
        <li><a href="#get-boundary-point-at-index">获取指定下标的边界点</a><span>，见 § 3.6.1</span>
        <li><a href="#has-block-level-display">块级显示</a><span>，见 § 3.6.1</span>
        <li><a href="#invoke-text-directives">调用文本指令</a><span>，见 § 3.6.1</span>
        <li><a href="#is-at-a-word-boundary">处于词边界</a><span>，见 § 3.6.2</span>
        <li><a href="#locale">区域设置</a><span>，见 § 3.6.2</span>
        <li><a href="#nearest-block-ancestor">最近块级祖先</a><span>，见 § 3.6.1</span>
        <li><a href="#next-non-whitespace-position">下一个非空白位置</a><span>，见 § 3.6.1</span>
        <li><a href="#non-searchable-subtree">不可搜索子树</a><span>，见 § 3.6.1</span>
        <li><a href="#parse-a-text-directive">解析文本指令</a><span>，见 § 3.4</span>
        <li><a href="#parse-the-fragment-directive">解析片段指令</a><span>，见 § 3.4</span>
        <li><a href="#document-pending-text-directives">待处理文本指令</a><span>，见 § 3.3.2</span>
        <li><a href="#percent-decode-a-text-directive-term">对文本指令项进行百分号解码</a><span>，见 § 3.4</span>
        <li><a href="#percentencodedbyte">PercentEncodedByte 百分号编码字节</a><span>，见 § 3.3.3</span>
        <li><a href="#text-directive-prefix">prefix 前缀</a><span>，见 § 3.4</span>
        <li><a href="#remove-the-fragment-directive">移除片段指令</a><span>，见 § 3.3.1</span>
        <li><a href="#search-invisible">搜索不可见</a><span>，见 § 3.6.1</span>
        <li><a href="#shadow-including-parent">包含 shadow 的父节点</a><span>，见 § 3.6</span>
        <li><a href="#text-directive-start">start 起始</a><span>，见 § 3.4</span>
        <li><a href="#text-directive-suffix">suffix 后缀</a><span>，见 § 3.4</span>
        <li><a href="#text-directive">文本指令</a><span>，见 § 3.4</span>
        <li><a href="#textdirective">TextDirective 文本指令</a><span>，见 § 3.3.3</span>
        <li><a href="#text-directive-allowing-mime-type">允许文本指令的 MIME 类型</a><span>，见 § 3.5.4</span>
        <li><a href="#textdirectiveexplicitchar">TextDirectiveExplicitChar 显式字符</a><span>，见 § 3.3.3</span>
        <li><a href="#textdirectiveparameters">TextDirectiveParameters 文本指令参数</a><span>，见 § 3.3.3</span>
        <li><a href="#textdirectiveprefix">TextDirectivePrefix 前缀</a><span>，见 § 3.3.3</span>
        <li><a href="#textdirectivestring">TextDirectiveString 字符串</a><span>，见 § 3.3.3</span>
        <li><a href="#textdirectivesuffix">TextDirectiveSuffix 后缀</a><span>，见 § 3.3.3</span>
        <li>
            text directive user activation
            <ul>
                <li><a href="#document-text-directive-user-activation">文档内定义</a><span>，见 § 3.5.4</span>
                <li><a href="#request-text-directive-user-activation">请求内定义</a><span>，见 § 3.5.4</span>
            </ul>
        <li><a href="#unknowndirective">UnknownDirective 未知指令</a><span>，见 § 3.3.3</span>
        <li><a href="#navigation-params-user-involvement">用户介入</a><span>，见 § 3.5.4</span>
        <li><a href="#validtextdirective">ValidTextDirective 合法文本指令</a><span>，见 § 3.3.3</span>
        <li><a href="#directive-state-value">值</a><span>，见 § 3.3.1</span>
        <li><a href="#visible-text-node">可见文本节点</a><span>，见 § 3.6.1</span>
        <li><a href="#word-boundary">词边界</a><span>，见 § 3.6.2</span>
        <li><a href="#word-bounded">词界定</a><span>，见 § 3.6.2</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">引用中定义的术语</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CSS-CASCADE-5]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="9cd25054">计算值</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-DISPLAY-3]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="66498315">flex</span>
                <li><span class="dfn-paneled" id="a555386f">grid</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-DISPLAY-4]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="bb886fc6">block</span>
                <li><span class="dfn-paneled" id="e7f0dd6c">display</span>
                <li><span class="dfn-paneled" id="607244fc">flow-root</span>
                <li><span class="dfn-paneled" id="96626f55">list-item</span>
                <li><span class="dfn-paneled" id="55e8f5de">none</span>
                <li><span class="dfn-paneled" id="abb2bed7">table</span>
                <li><span class="dfn-paneled" id="12f8fb07">visibility</span>
                <li><span class="dfn-paneled" id="6420cb11">visible</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSSOM-VIEW-1]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="2cbb079e">滚动目标到视图</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="85394472">Document 文档</span>
                <li><span class="dfn-paneled" id="597088f0">Text 文本</span>
                <li><span class="dfn-paneled" id="4fef809c">after 之后</span>
                <li><span class="dfn-paneled" id="8a3e6de2">边界点</span>
                <li><span class="dfn-paneled" id="8aac8409">折叠</span>
                <li><span class="dfn-paneled" id="3f23ec71">内容类型</span>
                <li><span class="dfn-paneled" id="212ee1f7">数据</span>
                <li><span class="dfn-paneled" id="cefd9ec1">doctype</span>
                <li><span class="dfn-paneled" id="a973e0fe">document 文档</span>
                <li><span class="dfn-paneled" id="2f0ba72c">文档元素</span>
                <li><span class="dfn-paneled" id="27d9b7ea">元素</span>
                <li><span class="dfn-paneled" id="5bbf7dec">end 终止</span>
                <li><span class="dfn-paneled" id="3edd98b4">end node 结束节点</span>
                <li><span class="dfn-paneled" id="203b148b">end offset 结束偏移量</span>
                <li><span class="dfn-paneled" id="6fba6744">following 紧随</span>
                <li><span class="dfn-paneled" id="5d233601">host 宿主</span>
                <li><span class="dfn-paneled" id="5e8d5f81">长度</span>
                <li><span class="dfn-paneled" id="d462b34f">节点</span>
                <li><span class="dfn-paneled" id="5216e1a0">节点文档</span>
                <li><span class="dfn-paneled" id="c62cd7cf">源</span>
                <li><span class="dfn-paneled" id="d729a9ff">父节点</span>
                <li><span class="dfn-paneled" id="5afeceea">父元素</span>
                <li><span class="dfn-paneled" id="8044ee41">范围</span>
                <li><span class="dfn-paneled" id="3fcc582f">shadow root</span>
                <li><span class="dfn-paneled" id="8f378588">包含shadow的祖先</span>
                <li><span class="dfn-paneled" id="fd32e3c9">包含shadow的后代</span>
                <li><span class="dfn-paneled" id="3d6a3d36">包含shadow的包容祖先</span>
                <li><span class="dfn-paneled" id="fefa5851">包含shadow的树顺序</span>
                <li><span class="dfn-paneled" id="936c50ab">start 起始</span>
                <li><span class="dfn-paneled" id="6c88f67e">start node 起始节点</span>
                <li><span class="dfn-paneled" id="683b1507">start offset 起始偏移量</span>
                <li><span class="dfn-paneled" id="c9f15d91">数据子串</span>
                <li><span class="dfn-paneled" id="347e8fe9">url</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ENCODING]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="a3033be5">utf-8 无 BOM 解码</span>
            </ul>
        <li>
            <a data-link-type="biblio">[FETCH]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="55213b5b">request 请求</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="fe2a6718">HTMLAudioElement</span>
                <li><span class="dfn-paneled" id="10e25f42">HTMLIFrameElement</span>
                <li><span class="dfn-paneled" id="c5891539">HTMLImageElement</span>
                <li><span class="dfn-paneled" id="cc59b66b">HTMLMeterElement</span>
                <li><span class="dfn-paneled" id="59ce5887">HTMLObjectElement</span>
                <li><span class="dfn-paneled" id="fcadc50c">HTMLProgressElement</span>
                <li><span class="dfn-paneled" id="ec4838d8">HTMLScriptElement</span>
                <li><span class="dfn-paneled" id="aa8746c3">HTMLStyleElement</span>
                <li><span class="dfn-paneled" id="f57f330b">HTMLVideoElement</span>
                <li><span class="dfn-paneled" id="78492a07">HashChangeEvent</span>
                <li><span class="dfn-paneled" id="cc549724">Location</span>
                <li><span class="dfn-paneled" id="35972864">活动文档</span>
                <li><span class="dfn-paneled" id="3c75104d">应用历史步骤</span>
                <li><span class="dfn-paneled" id="1c1db69e">应用 push/replace 历史步骤</span>
                <li><span class="dfn-paneled" id="f8434dee">被渲染</span>
                <li><span class="dfn-paneled" id="3b2ff63e">浏览上下文</span>
                <li><span class="dfn-paneled" id="b0b49d3c">浏览上下文集合</span>
                <li><span class="dfn-paneled" id="07ad3048">通过抓取创建导航参数</span>
                <li><span class="dfn-paneled" id="65393af9">document 文档</span>
                <li><span class="dfn-paneled" id="092de955">文档状态</span>
                <li><span class="dfn-paneled" id="7f118064">完成跨文档导航</span>
                <li><span class="dfn-paneled" id="40a1c717">组</span>
                <li><span class="dfn-paneled" id="2895d75d">发起源</span>
                <li><span class="dfn-paneled" id="d4dbbbf0">语言</span>
                <li><span class="dfn-paneled" id="b07164ad">multiple 多选</span>
                <li><span class="dfn-paneled" id="2594e562">导航</span>
                <li><span class="dfn-paneled" id="fffd9ca9">导航到片段</span>
                <li><span class="dfn-paneled" id="4437edc6">导航参数</span>
                <li><span class="dfn-paneled" id="13dd6cae">node navigable</span>
                <li><span class="dfn-paneled" id="086e3aff">origin 源</span>
                <li><span class="dfn-paneled" id="1bba3db7">父节点</span>
                <li><span class="dfn-paneled" id="8b87b428">恢复持久化状态</span>
                <li><span class="dfn-paneled" id="7393da89">同源</span>
                <li><span class="dfn-paneled" id="3f2e859c">滚动到片段</span>
                <li><span class="dfn-paneled" id="85188fb3">select 选择</span>
                <li><span class="dfn-paneled" id="c3ae9e6a">序列化为空元素</span>
                <li><span class="dfn-paneled" id="8a051c9f">尝试滚动到片段</span>
                <li><span class="dfn-paneled" id="5c1d019b">历史步骤应用时更新文档</span>
                <li><span class="dfn-paneled" id="34d2343e">用户导航介入</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="53275e46">追加</span>
                <li><span class="dfn-paneled" id="2d5a2765">ASCII 字符串</span>
                <li><span class="dfn-paneled" id="77b4c09a">断言</span>
                <li><span class="dfn-paneled" id="7b0d918d">跳出</span>
                <li><span class="dfn-paneled" id="915aff5e">码点</span>
                <li><span class="dfn-paneled" id="4ef39030">码点长度</span>
                <li><span class="dfn-paneled" id="bb1f9628">码点子串</span>
                <li><span class="dfn-paneled" id="cfd05055">按位置截取码点子串</span>
                <li><span class="dfn-paneled" id="b8906bbb">截取到字符串末尾的码点子串</span>
                <li><span class="dfn-paneled" id="4a3bf5fb">拼接</span>
                <li><span class="dfn-paneled" id="f937b7b6">继续</span>
                <li><span class="dfn-paneled" id="03afaf9c">空</span>
                <li><span class="dfn-paneled" id="9c05f1bf">结尾为</span>
                <li><span class="dfn-paneled" id="16d07e10">依次遍历</span>
                <li><span class="dfn-paneled" id="f052b1ea">HTML 命名空间</span>
                <li><span class="dfn-paneled" id="860300d4">实现自定义</span>
                <li><span class="dfn-paneled" id="0fa357c3">长度</span>
                <li><span class="dfn-paneled" id="649608b9">列表</span>
                <li><span class="dfn-paneled" id="75bee4d5">位置变量</span>
                <li><span class="dfn-paneled" id="0204d188">大小</span>
                <li><span class="dfn-paneled" id="54627f47">起始为</span>
                <li><span class="dfn-paneled" id="7a3dbdb1">严格分割字符串</span>
                <li><span class="dfn-paneled" id="0698d556">字符串</span>
                <li><span class="dfn-paneled" id="984221ca">结构体</span>
            </ul>
        <li>
            <a data-link-type="biblio">[MIMESNIFF]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="7c195f8b">本质</span>
                <li><span class="dfn-paneled" id="16785ec4">mime 类型</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="ed948033">fragment 片段</span>
                <li><span class="dfn-paneled" id="79fa146b">片段百分号编码集合</span>
                <li><span class="dfn-paneled" id="8f69ce41">百分号解码</span>
                <li><span class="dfn-paneled" id="dcffbccd">url</span>
                <li><span class="dfn-paneled" id="4bb788fe">url 码点</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> 定义了下列术语：
            <ul>
                <li><span class="dfn-paneled" id="889e932f">Exposed 暴露</span>
                <li><span class="dfn-paneled" id="a5c91173">SameObject 同一对象</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">规范性引用</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-5/"><cite>CSS
                    层叠与继承第5级</cite></a>. 链接: <a
                href="https://drafts.csswg.org/css-cascade-5/">https://drafts.csswg.org/css-cascade-5/</a>
        <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
        <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-display/"><cite>CSS Display
                    模块第3级</cite></a>. 链接: <a
                href="https://drafts.csswg.org/css-display/">https://drafts.csswg.org/css-display/</a>
        <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
        <dd><a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display 模块第4级</cite></a>. 编辑草案. 链接: <a
                href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
        <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
        <dd>Simon Pieters. <a href="https://drafts.csswg.org/cssom-view/"><cite>CSSOM 视图模块</cite></a>. 链接: <a
                href="https://drafts.csswg.org/cssom-view/">https://drafts.csswg.org/cssom-view/</a>
        <dt id="biblio-document-policy">[DOCUMENT-POLICY]
        <dd>Ian Clelland. <a href="https://wicg.github.io/document-policy"><cite>文档策略</cite></a>. 编辑草案. 链接: <a
                href="https://wicg.github.io/document-policy">https://wicg.github.io/document-policy</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. 实时标准.
            链接: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-encoding">[ENCODING]
        <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/"><cite>编码标准</cite></a>. 实时标准. 链接: <a
                href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
        <dt id="biblio-fetch">[FETCH]
        <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch 标准</cite></a>. 实时标准. 链接: <a
                href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 等. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>.
            实时标准. 链接: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    标准</cite></a>. 实时标准. 链接: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-mimesniff">[MIMESNIFF]
        <dd>Gordon P. Hemsley. <a href="https://mimesniff.spec.whatwg.org/"><cite>MIME 嗅探标准</cite></a>.
            实时标准. 链接: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>RFC中用于表示需求等级的关键词</cite></a>.
            1997年3月. 最佳当前实践. 链接: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-uax29">[UAX29]
        <dd>Josh Hadley. <a href="https://www.unicode.org/reports/tr29/tr29-43.html"><cite>Unicode 文本分割</cite></a>.
            2023年8月16日. Unicode 标准附件#29. 链接: <a
                href="https://www.unicode.org/reports/tr29/tr29-43.html">https://www.unicode.org/reports/tr29/tr29-43.html</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL 标准</cite></a>. 实时标准.
            链接: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
        <dt id="biblio-uts10">[UTS10]
        <dd>Ken Whistler; Markus Scherer. <a href="https://www.unicode.org/reports/tr10/tr10-49.html"><cite>Unicode
                    排序算法</cite></a>. 2023年9月5日. Unicode 技术标准#10. 链接: <a
                href="https://www.unicode.org/reports/tr10/tr10-49.html">https://www.unicode.org/reports/tr10/tr10-49.html</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. 实时
            标准. 链接: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考性引用</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-bcp47">[BCP47]
        <dd>A. Phillips, Ed.; M. Davis, Ed.. <a
                href="https://www.rfc-editor.org/rfc/rfc5646"><cite>用于语言标识的标签</cite></a>. 2009年9月. 最佳当前实践. 链接: <a
                href="https://www.rfc-editor.org/rfc/rfc5646">https://www.rfc-editor.org/rfc/rfc5646</a>
        <dt id="biblio-fetch-metadata">[FETCH-METADATA]
        <dd>Mike West. <a href="https://w3c.github.io/webappsec-fetch-metadata/"><cite>Fetch Metadata 请求头</cite></a>.
            WD. 链接: <a
                href="https://w3c.github.io/webappsec-fetch-metadata/">https://w3c.github.io/webappsec-fetch-metadata/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#fragmentdirective"><code><c- g>FragmentDirective</c-></code></a> {
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#fragmentdirective"><c- n>FragmentDirective</c-></a> <a data-readonly data-type="FragmentDirective" href="#dom-document-fragmentdirective"><code><c- g>fragmentDirective</c-></code></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">问题索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> TODO: 如果 URL 的片段以':~:'结尾（即空指令），则会返回 null，视为该 URL
            未显式指定指令（避免覆盖）。但或许此时应返回空字符串？这样页面可通过导航/pushState 到 '#:~:' 显式清除指令/高亮。 <a class="issue-return"
                href="#issue-f4a5d96b" title="Jump to section">↵</a></div>
        <div class="issue"> 若在 shadow tree 中，应设置哪个为 target? <a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/190">#190</a> <a class="issue-return"
                href="#issue-424a4e25" title="Jump to section">↵</a></div>
        <div class="issue"> 目前的揭示算法对于 target 是祖先或根节点等情形处理不好。<a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/89">#89</a> 建议限制仅匹配
            <code>contain:style layout</code> 区块可解决。 <a class="issue-return" href="#issue-10739530"
                title="Jump to section">↵</a>
        </div>
        <div class="issue">实现注：Blink 当前不会为文本片段设置焦点，或许应该？TODO: 提 crbug。 <a class="issue-return" href="#issue-e253a983"
                title="Jump to section">↵</a></div>
        <div class="issue"> 这并非绝对，Chrome 对同源发起者允许此操作。规范需更新。<a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/240">[Issue
                #WICG/scroll-to-text-fragment#240]</a> <a class="issue-return" href="#issue-35f490f0"
                title="Jump to section">↵</a></div>
        <div class="issue"> 这一条能否写在 HTML 规范里？ <a class="issue-return" href="#issue-0e1d8eda"
                title="Jump to section">↵</a></div>
        <div class="issue"> 需要决定 <code>force-load-at-top</code> 与 Navigation API 的交互方式。<a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/242">[Issue
                #WICG/scroll-to-text-fragment#242]</a> <a class="issue-return" href="#issue-de0fed9d"
                title="Jump to section">↵</a></div>
        <div class="issue"><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-cd-data">data</a>
            此处不正确，因为那是 DOM 里的文本数据。本算法意在用于渲染后的文本（再还原回 DOM 范围）。<a
                href="https://github.com/WICG/scroll-to-text-fragment/issues/98">[Issue
                #WICG/scroll-to-text-fragment#98]</a> <a class="issue-return" href="#issue-96fe4755"
                title="Jump to section">↵</a></div>
    </div>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            const dfnsJson = window.dfnsJson || {};

            function genDfnPanel({ dfnID, url, dfnText, refSections, external }) {
                return mk.aside({
                    class: "dfn-panel",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url }, url),
                    mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({
                                            href: `#${ref.id}`
                                        },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                );
            }

            function genAllDfnPanels() {
                for (const panelData of Object.values(window.dfnpanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                    } else {
                        const panel = genDfnPanel(panelData);
                        append(document.body, panel);
                        insertDfnPopupAction(dfn, panel)
                    }
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                // Add popup behavior to all dfns to show the corresponding dfn-panel.
                var dfns = queryAll('.dfn-paneled');
                for (let dfn of dfns) { ; }

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            })


            function hideAllDfnPanels() {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => hideDfnPanel(el));
            }

            function showDfnPanel(dfnPanel, dfn) {
                hideAllDfnPanels(); // Only display one at this time.
                dfn.setAttribute("aria-expanded", "true");
                dfnPanel.classList.add("on");
                dfnPanel.style.left = "5px";
                dfnPanel.style.top = "0px";
                const panelRect = dfnPanel.getBoundingClientRect();
                const panelWidth = panelRect.right - panelRect.left;
                if (panelRect.right > document.body.scrollWidth) {
                    // Panel's overflowing the screen.
                    // Just drop it below the dfn and flip it rightward instead.
                    // This still wont' fix things if the screen is *really* wide,
                    // but fixing that's a lot harder without 'anchor()'.
                    dfnPanel.style.top = "1.5em";
                    dfnPanel.style.left = "auto";
                    dfnPanel.style.right = "0px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel(dfnPanel, dfn) {
                if (!dfn) {
                    dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
                }
                dfn.setAttribute("aria-expanded", "false")
                dfnPanel.classList.remove("on");
                dfnPanel.classList.remove("activated");
            }

            function toggleDfnPanel(dfnPanel, dfn) {
                if (dfnPanel.classList.contains("on")) {
                    hideDfnPanel(dfnPanel, dfn);
                } else {
                    showDfnPanel(dfnPanel, dfn);
                }
            }

            function insertDfnPopupAction(dfn, dfnPanel) {
                // Find dfn panel
                const panelWrapper = document.createElement('span');
                panelWrapper.appendChild(dfnPanel);
                panelWrapper.style.position = "relative";
                panelWrapper.style.height = "0px";
                dfn.insertAdjacentElement("afterend", panelWrapper);
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    showDfnPanel(dfnPanel, dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfnPanel, dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                });

                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel(dfnPanel, dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                })
            }
        }
    </script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            const dfnsJson = window.dfnsJson || {};

            function genDfnPanel({ dfnID, url, dfnText, refSections, external }) {
                return mk.aside({
                    class: "dfn-panel",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url }, url),
                    mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({
                                            href: `#${ref.id}`
                                        },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                );
            }

            function genAllDfnPanels() {
                for (const panelData of Object.values(window.dfnpanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                    } else {
                        const panel = genDfnPanel(panelData);
                        append(document.body, panel);
                        insertDfnPopupAction(dfn, panel)
                    }
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                // Add popup behavior to all dfns to show the corresponding dfn-panel.
                var dfns = queryAll('.dfn-paneled');
                for (let dfn of dfns) { ; }

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            })


            function hideAllDfnPanels() {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => hideDfnPanel(el));
            }

            function showDfnPanel(dfnPanel, dfn) {
                hideAllDfnPanels(); // Only display one at this time.
                dfn.setAttribute("aria-expanded", "true");
                dfnPanel.classList.add("on");
                dfnPanel.style.left = "5px";
                dfnPanel.style.top = "0px";
                const panelRect = dfnPanel.getBoundingClientRect();
                const panelWidth = panelRect.right - panelRect.left;
                if (panelRect.right > document.body.scrollWidth) {
                    // Panel's overflowing the screen.
                    // Just drop it below the dfn and flip it rightward instead.
                    // This still wont' fix things if the screen is *really* wide,
                    // but fixing that's a lot harder without 'anchor()'.
                    dfnPanel.style.top = "1.5em";
                    dfnPanel.style.left = "auto";
                    dfnPanel.style.right = "0px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel(dfnPanel, dfn) {
                if (!dfn) {
                    dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
                }
                dfn.setAttribute("aria-expanded", "false")
                dfnPanel.classList.remove("on");
                dfnPanel.classList.remove("activated");
            }

            function toggleDfnPanel(dfnPanel, dfn) {
                if (dfnPanel.classList.contains("on")) {
                    hideDfnPanel(dfnPanel, dfn);
                } else {
                    showDfnPanel(dfnPanel, dfn);
                }
            }

            function insertDfnPopupAction(dfn, dfnPanel) {
                // Find dfn panel
                const panelWrapper = document.createElement('span');
                panelWrapper.appendChild(dfnPanel);
                panelWrapper.style.position = "relative";
                panelWrapper.style.height = "0px";
                dfn.insertAdjacentElement("afterend", panelWrapper);
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    showDfnPanel(dfnPanel, dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfnPanel, dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                });

                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel(dfnPanel, dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                })
            }
        }
    </script>
    <script>/* Boilerplate: script-dfn-panel-json */
        window.dfnpanelData = {};
        window.dfnpanelData['9cd25054'] = { "dfnID": "9cd25054", "url": "https://drafts.csswg.org/css-cascade-5/#computed-value", "dfnText": "computed value", "refSections": [{ "refs": [{ "id": "ref-for-computed-value" }, { "id": "ref-for-computed-value\u2460" }, { "id": "ref-for-computed-value\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['66498315'] = { "dfnID": "66498315", "url": "https://drafts.csswg.org/css-display-3/#valdef-display-flex", "dfnText": "flex", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-flex" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['a555386f'] = { "dfnID": "a555386f", "url": "https://drafts.csswg.org/css-display-3/#valdef-display-grid", "dfnText": "grid", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-grid" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['bb886fc6'] = { "dfnID": "bb886fc6", "url": "https://drafts.csswg.org/css-display-4/#valdef-display-block", "dfnText": "block", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-block" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['e7f0dd6c'] = { "dfnID": "e7f0dd6c", "url": "https://drafts.csswg.org/css-display-4/#propdef-display", "dfnText": "display", "refSections": [{ "refs": [{ "id": "ref-for-propdef-display" }, { "id": "ref-for-propdef-display\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['607244fc'] = { "dfnID": "607244fc", "url": "https://drafts.csswg.org/css-display-4/#valdef-display-flow-root", "dfnText": "flow-root", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-flow-root" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['96626f55'] = { "dfnID": "96626f55", "url": "https://drafts.csswg.org/css-display-4/#valdef-display-list-item", "dfnText": "list-item", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-list-item" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['55e8f5de'] = { "dfnID": "55e8f5de", "url": "https://drafts.csswg.org/css-display-4/#valdef-display-none", "dfnText": "none", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-none" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['abb2bed7'] = { "dfnID": "abb2bed7", "url": "https://drafts.csswg.org/css-display-4/#valdef-display-table", "dfnText": "table", "refSections": [{ "refs": [{ "id": "ref-for-valdef-display-table" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['12f8fb07'] = { "dfnID": "12f8fb07", "url": "https://drafts.csswg.org/css-display-4/#propdef-visibility", "dfnText": "visibility", "refSections": [{ "refs": [{ "id": "ref-for-propdef-visibility" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['6420cb11'] = { "dfnID": "6420cb11", "url": "https://drafts.csswg.org/css-display-4/#valdef-visibility-visible", "dfnText": "visible", "refSections": [{ "refs": [{ "id": "ref-for-valdef-visibility-visible" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['2cbb079e'] = { "dfnID": "2cbb079e", "url": "https://drafts.csswg.org/cssom-view-1/#scroll-a-target-into-view", "dfnText": "scroll a target into view", "refSections": [{ "refs": [{ "id": "ref-for-scroll-a-target-into-view" }], "title": "3.4.1. Invoking Text Directives" }], "external": true };
        window.dfnpanelData['85394472'] = { "dfnID": "85394472", "url": "https://dom.spec.whatwg.org/#document", "dfnText": "Document", "refSections": [{ "refs": [{ "id": "ref-for-document" }, { "id": "ref-for-document\u2460" }], "title": "3.9. Feature Detectability" }], "external": true };
        window.dfnpanelData['597088f0'] = { "dfnID": "597088f0", "url": "https://dom.spec.whatwg.org/#text", "dfnText": "Text", "refSections": [{ "refs": [{ "id": "ref-for-text" }, { "id": "ref-for-text\u2460" }, { "id": "ref-for-text\u2461" }, { "id": "ref-for-text\u2462" }, { "id": "ref-for-text\u2463" }, { "id": "ref-for-text\u2464" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['4fef809c'] = { "dfnID": "4fef809c", "url": "https://dom.spec.whatwg.org/#concept-range-bp-after", "dfnText": "after", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-bp-after" }, { "id": "ref-for-concept-range-bp-after\u2460" }, { "id": "ref-for-concept-range-bp-after\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['8a3e6de2'] = { "dfnID": "8a3e6de2", "url": "https://dom.spec.whatwg.org/#concept-range-bp", "dfnText": "boundary point", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-bp" }, { "id": "ref-for-concept-range-bp\u2460" }, { "id": "ref-for-concept-range-bp\u2461" }, { "id": "ref-for-concept-range-bp\u2462" }, { "id": "ref-for-concept-range-bp\u2463" }, { "id": "ref-for-concept-range-bp\u2464" }, { "id": "ref-for-concept-range-bp\u2465" }, { "id": "ref-for-concept-range-bp\u2466" }, { "id": "ref-for-concept-range-bp\u2467" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['8aac8409'] = { "dfnID": "8aac8409", "url": "https://dom.spec.whatwg.org/#range-collapsed", "dfnText": "collapsed", "refSections": [{ "refs": [{ "id": "ref-for-range-collapsed" }, { "id": "ref-for-range-collapsed\u2460" }, { "id": "ref-for-range-collapsed\u2461" }, { "id": "ref-for-range-collapsed\u2462" }, { "id": "ref-for-range-collapsed\u2463" }, { "id": "ref-for-range-collapsed\u2464" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['3f23ec71'] = { "dfnID": "3f23ec71", "url": "https://dom.spec.whatwg.org/#concept-document-content-type", "dfnText": "content type", "refSections": [{ "refs": [{ "id": "ref-for-concept-document-content-type" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['212ee1f7'] = { "dfnID": "212ee1f7", "url": "https://dom.spec.whatwg.org/#concept-cd-data", "dfnText": "data", "refSections": [{ "refs": [{ "id": "ref-for-concept-cd-data" }, { "id": "ref-for-concept-cd-data\u2460" }, { "id": "ref-for-concept-cd-data\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['cefd9ec1'] = { "dfnID": "cefd9ec1", "url": "https://dom.spec.whatwg.org/#concept-doctype", "dfnText": "doctype", "refSections": [{ "refs": [{ "id": "ref-for-concept-doctype" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['a973e0fe'] = { "dfnID": "a973e0fe", "url": "https://dom.spec.whatwg.org/#concept-document", "dfnText": "document", "refSections": [{ "refs": [{ "id": "ref-for-concept-document" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-concept-document\u2460" }], "title": "3.5.3. Search Timing" }, { "refs": [{ "id": "ref-for-concept-document\u2461" }, { "id": "ref-for-concept-document\u2462" }, { "id": "ref-for-concept-document\u2463" }, { "id": "ref-for-concept-document\u2464" }, { "id": "ref-for-concept-document\u2465" }, { "id": "ref-for-concept-document\u2466" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-concept-document\u2467" }, { "id": "ref-for-concept-document\u2468" }], "title": "3.6.1. Finding Ranges in a Document" }, { "refs": [{ "id": "ref-for-concept-document\u2460\u24ea" }, { "id": "ref-for-concept-document\u2460\u2460" }], "title": "3.8. Document Policy Integration" }], "external": true };
        window.dfnpanelData['2f0ba72c'] = { "dfnID": "2f0ba72c", "url": "https://dom.spec.whatwg.org/#document-element", "dfnText": "document element", "refSections": [{ "refs": [{ "id": "ref-for-document-element" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['27d9b7ea'] = { "dfnID": "27d9b7ea", "url": "https://dom.spec.whatwg.org/#concept-element", "dfnText": "element", "refSections": [{ "refs": [{ "id": "ref-for-concept-element" }, { "id": "ref-for-concept-element\u2460" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-concept-element\u2461" }], "title": "3.6. Navigating to a Text Fragment" }, { "refs": [{ "id": "ref-for-concept-element\u2462" }, { "id": "ref-for-concept-element\u2463" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['5bbf7dec'] = { "dfnID": "5bbf7dec", "url": "https://dom.spec.whatwg.org/#concept-range-end", "dfnText": "end", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-end" }, { "id": "ref-for-concept-range-end\u2460" }, { "id": "ref-for-concept-range-end\u2461" }, { "id": "ref-for-concept-range-end\u2462" }, { "id": "ref-for-concept-range-end\u2463" }, { "id": "ref-for-concept-range-end\u2464" }, { "id": "ref-for-concept-range-end\u2465" }, { "id": "ref-for-concept-range-end\u2466" }, { "id": "ref-for-concept-range-end\u2467" }, { "id": "ref-for-concept-range-end\u2468" }, { "id": "ref-for-concept-range-end\u2460\u24ea" }, { "id": "ref-for-concept-range-end\u2460\u2460" }, { "id": "ref-for-concept-range-end\u2460\u2461" }, { "id": "ref-for-concept-range-end\u2460\u2462" }, { "id": "ref-for-concept-range-end\u2460\u2463" }, { "id": "ref-for-concept-range-end\u2460\u2464" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['3edd98b4'] = { "dfnID": "3edd98b4", "url": "https://dom.spec.whatwg.org/#concept-range-end-node", "dfnText": "end node", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-end-node" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-concept-range-end-node\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-concept-range-end-node\u2461" }, { "id": "ref-for-concept-range-end-node\u2462" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['203b148b'] = { "dfnID": "203b148b", "url": "https://dom.spec.whatwg.org/#concept-range-end-offset", "dfnText": "end offset", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-end-offset" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['6fba6744'] = { "dfnID": "6fba6744", "url": "https://dom.spec.whatwg.org/#concept-tree-following", "dfnText": "following", "refSections": [{ "refs": [{ "id": "ref-for-concept-tree-following" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['5d233601'] = { "dfnID": "5d233601", "url": "https://dom.spec.whatwg.org/#concept-documentfragment-host", "dfnText": "host", "refSections": [{ "refs": [{ "id": "ref-for-concept-documentfragment-host" }], "title": "3.6. Navigating to a Text Fragment" }], "external": true };
        window.dfnpanelData['5e8d5f81'] = { "dfnID": "5e8d5f81", "url": "https://dom.spec.whatwg.org/#concept-node-length", "dfnText": "length", "refSections": [{ "refs": [{ "id": "ref-for-concept-node-length" }, { "id": "ref-for-concept-node-length\u2460" }, { "id": "ref-for-concept-node-length\u2461" }, { "id": "ref-for-concept-node-length\u2462" }, { "id": "ref-for-concept-node-length\u2463" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['d462b34f'] = { "dfnID": "d462b34f", "url": "https://dom.spec.whatwg.org/#boundary-point-node", "dfnText": "node", "refSections": [{ "refs": [{ "id": "ref-for-boundary-point-node" }, { "id": "ref-for-boundary-point-node\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['5216e1a0'] = { "dfnID": "5216e1a0", "url": "https://dom.spec.whatwg.org/#concept-node-document", "dfnText": "node document", "refSections": [{ "refs": [{ "id": "ref-for-concept-node-document" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['c62cd7cf'] = { "dfnID": "c62cd7cf", "url": "https://dom.spec.whatwg.org/#concept-document-origin", "dfnText": "origin", "refSections": [{ "refs": [{ "id": "ref-for-concept-document-origin" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['d729a9ff'] = { "dfnID": "d729a9ff", "url": "https://dom.spec.whatwg.org/#concept-tree-parent", "dfnText": "parent", "refSections": [{ "refs": [{ "id": "ref-for-concept-tree-parent" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-concept-tree-parent\u2460" }], "title": "3.6. Navigating to a Text Fragment" }, { "refs": [{ "id": "ref-for-concept-tree-parent\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['5afeceea'] = { "dfnID": "5afeceea", "url": "https://dom.spec.whatwg.org/#parent-element", "dfnText": "parent element", "refSections": [{ "refs": [{ "id": "ref-for-parent-element" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['8044ee41'] = { "dfnID": "8044ee41", "url": "https://dom.spec.whatwg.org/#concept-range", "dfnText": "range", "refSections": [{ "refs": [{ "id": "ref-for-concept-range" }, { "id": "ref-for-concept-range\u2460" }, { "id": "ref-for-concept-range\u2461" }, { "id": "ref-for-concept-range\u2462" }, { "id": "ref-for-concept-range\u2463" }, { "id": "ref-for-concept-range\u2464" }, { "id": "ref-for-concept-range\u2465" }, { "id": "ref-for-concept-range\u2466" }, { "id": "ref-for-concept-range\u2467" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-concept-range\u2468" }, { "id": "ref-for-concept-range\u2460\u24ea" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-concept-range\u2460\u2460" }], "title": "3.6. Navigating to a Text Fragment" }, { "refs": [{ "id": "ref-for-concept-range\u2460\u2461" }, { "id": "ref-for-concept-range\u2460\u2462" }, { "id": "ref-for-concept-range\u2460\u2463" }, { "id": "ref-for-concept-range\u2460\u2464" }, { "id": "ref-for-concept-range\u2460\u2465" }, { "id": "ref-for-concept-range\u2460\u2466" }, { "id": "ref-for-concept-range\u2460\u2467" }, { "id": "ref-for-concept-range\u2460\u2468" }, { "id": "ref-for-concept-range\u2461\u24ea" }, { "id": "ref-for-concept-range\u2461\u2460" }, { "id": "ref-for-concept-range\u2461\u2461" }, { "id": "ref-for-concept-range\u2461\u2462" }, { "id": "ref-for-concept-range\u2461\u2463" }, { "id": "ref-for-concept-range\u2461\u2464" }, { "id": "ref-for-concept-range\u2461\u2465" }, { "id": "ref-for-concept-range\u2461\u2466" }, { "id": "ref-for-concept-range\u2461\u2467" }, { "id": "ref-for-concept-range\u2461\u2468" }, { "id": "ref-for-concept-range\u2462\u24ea" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['3fcc582f'] = { "dfnID": "3fcc582f", "url": "https://dom.spec.whatwg.org/#concept-shadow-root", "dfnText": "shadow root", "refSections": [{ "refs": [{ "id": "ref-for-concept-shadow-root" }], "title": "3.6. Navigating to a Text Fragment" }], "external": true };
        window.dfnpanelData['8f378588'] = { "dfnID": "8f378588", "url": "https://dom.spec.whatwg.org/#concept-shadow-including-ancestor", "dfnText": "shadow-including ancestor", "refSections": [{ "refs": [{ "id": "ref-for-concept-shadow-including-ancestor" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['fd32e3c9'] = { "dfnID": "fd32e3c9", "url": "https://dom.spec.whatwg.org/#concept-shadow-including-descendant", "dfnText": "shadow-including descendant", "refSections": [{ "refs": [{ "id": "ref-for-concept-shadow-including-descendant" }, { "id": "ref-for-concept-shadow-including-descendant\u2460" }, { "id": "ref-for-concept-shadow-including-descendant\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['3d6a3d36'] = { "dfnID": "3d6a3d36", "url": "https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor", "dfnText": "shadow-including inclusive ancestor", "refSections": [{ "refs": [{ "id": "ref-for-concept-shadow-including-inclusive-ancestor" }], "title": "3.6. Navigating to a Text Fragment" }], "external": true };
        window.dfnpanelData['fefa5851'] = { "dfnID": "fefa5851", "url": "https://dom.spec.whatwg.org/#concept-shadow-including-tree-order", "dfnText": "shadow-including tree order", "refSections": [{ "refs": [{ "id": "ref-for-concept-shadow-including-tree-order" }, { "id": "ref-for-concept-shadow-including-tree-order\u2460" }, { "id": "ref-for-concept-shadow-including-tree-order\u2461" }, { "id": "ref-for-concept-shadow-including-tree-order\u2462" }, { "id": "ref-for-concept-shadow-including-tree-order\u2463" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['936c50ab'] = { "dfnID": "936c50ab", "url": "https://dom.spec.whatwg.org/#concept-range-start", "dfnText": "start", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-start" }, { "id": "ref-for-concept-range-start\u2460" }, { "id": "ref-for-concept-range-start\u2461" }, { "id": "ref-for-concept-range-start\u2462" }, { "id": "ref-for-concept-range-start\u2463" }, { "id": "ref-for-concept-range-start\u2464" }, { "id": "ref-for-concept-range-start\u2465" }, { "id": "ref-for-concept-range-start\u2466" }, { "id": "ref-for-concept-range-start\u2467" }, { "id": "ref-for-concept-range-start\u2468" }, { "id": "ref-for-concept-range-start\u2460\u24ea" }, { "id": "ref-for-concept-range-start\u2460\u2460" }, { "id": "ref-for-concept-range-start\u2460\u2461" }, { "id": "ref-for-concept-range-start\u2460\u2462" }, { "id": "ref-for-concept-range-start\u2460\u2463" }, { "id": "ref-for-concept-range-start\u2460\u2464" }, { "id": "ref-for-concept-range-start\u2460\u2465" }, { "id": "ref-for-concept-range-start\u2460\u2466" }, { "id": "ref-for-concept-range-start\u2460\u2467" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['6c88f67e'] = { "dfnID": "6c88f67e", "url": "https://dom.spec.whatwg.org/#concept-range-start-node", "dfnText": "start node", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-start-node" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-concept-range-start-node\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-concept-range-start-node\u2461" }, { "id": "ref-for-concept-range-start-node\u2462" }, { "id": "ref-for-concept-range-start-node\u2463" }, { "id": "ref-for-concept-range-start-node\u2464" }, { "id": "ref-for-concept-range-start-node\u2465" }, { "id": "ref-for-concept-range-start-node\u2466" }, { "id": "ref-for-concept-range-start-node\u2467" }, { "id": "ref-for-concept-range-start-node\u2468" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['683b1507'] = { "dfnID": "683b1507", "url": "https://dom.spec.whatwg.org/#concept-range-start-offset", "dfnText": "start offset", "refSections": [{ "refs": [{ "id": "ref-for-concept-range-start-offset" }, { "id": "ref-for-concept-range-start-offset\u2460" }, { "id": "ref-for-concept-range-start-offset\u2461" }, { "id": "ref-for-concept-range-start-offset\u2462" }, { "id": "ref-for-concept-range-start-offset\u2463" }, { "id": "ref-for-concept-range-start-offset\u2464" }, { "id": "ref-for-concept-range-start-offset\u2465" }, { "id": "ref-for-concept-range-start-offset\u2466" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['c9f15d91'] = { "dfnID": "c9f15d91", "url": "https://dom.spec.whatwg.org/#concept-cd-substring", "dfnText": "substring data", "refSections": [{ "refs": [{ "id": "ref-for-concept-cd-substring" }, { "id": "ref-for-concept-cd-substring\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['347e8fe9'] = { "dfnID": "347e8fe9", "url": "https://dom.spec.whatwg.org/#concept-document-url", "dfnText": "url", "refSections": [{ "refs": [{ "id": "ref-for-concept-document-url" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['a3033be5'] = { "dfnID": "a3033be5", "url": "https://encoding.spec.whatwg.org/#utf-8-decode-without-bom", "dfnText": "utf-8 decode without bom", "refSections": [{ "refs": [{ "id": "ref-for-utf-8-decode-without-bom" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['55213b5b'] = { "dfnID": "55213b5b", "url": "https://fetch.spec.whatwg.org/#concept-request", "dfnText": "request", "refSections": [{ "refs": [{ "id": "ref-for-concept-request" }, { "id": "ref-for-concept-request\u2460" }, { "id": "ref-for-concept-request\u2461" }, { "id": "ref-for-concept-request\u2462" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['fe2a6718'] = { "dfnID": "fe2a6718", "url": "https://html.spec.whatwg.org/multipage/media.html#htmlaudioelement", "dfnText": "HTMLAudioElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlaudioelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['10e25f42'] = { "dfnID": "10e25f42", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement", "dfnText": "HTMLIFrameElement", "refSections": [{ "refs": [{ "id": "ref-for-htmliframeelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['c5891539'] = { "dfnID": "c5891539", "url": "https://html.spec.whatwg.org/multipage/embedded-content.html#htmlimageelement", "dfnText": "HTMLImageElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlimageelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['cc59b66b'] = { "dfnID": "cc59b66b", "url": "https://html.spec.whatwg.org/multipage/form-elements.html#htmlmeterelement", "dfnText": "HTMLMeterElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlmeterelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['59ce5887'] = { "dfnID": "59ce5887", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlobjectelement", "dfnText": "HTMLObjectElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlobjectelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['fcadc50c'] = { "dfnID": "fcadc50c", "url": "https://html.spec.whatwg.org/multipage/form-elements.html#htmlprogresselement", "dfnText": "HTMLProgressElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlprogresselement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['ec4838d8'] = { "dfnID": "ec4838d8", "url": "https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement", "dfnText": "HTMLScriptElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlscriptelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['aa8746c3'] = { "dfnID": "aa8746c3", "url": "https://html.spec.whatwg.org/multipage/semantics.html#htmlstyleelement", "dfnText": "HTMLStyleElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlstyleelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['f57f330b'] = { "dfnID": "f57f330b", "url": "https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement", "dfnText": "HTMLVideoElement", "refSections": [{ "refs": [{ "id": "ref-for-htmlvideoelement" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['78492a07'] = { "dfnID": "78492a07", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#hashchangeevent", "dfnText": "HashChangeEvent", "refSections": [{ "refs": [{ "id": "ref-for-hashchangeevent" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['cc549724'] = { "dfnID": "cc549724", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#location", "dfnText": "Location", "refSections": [{ "refs": [{ "id": "ref-for-location" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['35972864'] = { "dfnID": "35972864", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document", "dfnText": "active document", "refSections": [{ "refs": [{ "id": "ref-for-nav-document" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-nav-document\u2460" }, { "id": "ref-for-nav-document\u2461" }, { "id": "ref-for-nav-document\u2462" }, { "id": "ref-for-nav-document\u2463" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['3c75104d'] = { "dfnID": "3c75104d", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#apply-the-history-step", "dfnText": "apply the history step", "refSections": [{ "refs": [{ "id": "ref-for-apply-the-history-step" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['1c1db69e'] = { "dfnID": "1c1db69e", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#apply-the-push%2Freplace-history-step", "dfnText": "apply the push/replace history step", "refSections": [{ "refs": [{ "id": "ref-for-apply-the-push%2Freplace-history-step" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['f8434dee'] = { "dfnID": "f8434dee", "url": "https://html.spec.whatwg.org/multipage/rendering.html#being-rendered", "dfnText": "being rendered", "refSections": [{ "refs": [{ "id": "ref-for-being-rendered" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['3b2ff63e'] = { "dfnID": "3b2ff63e", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc", "dfnText": "browsing context", "refSections": [{ "refs": [{ "id": "ref-for-concept-document-bc" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['b0b49d3c'] = { "dfnID": "b0b49d3c", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context-set", "dfnText": "browsing context set", "refSections": [{ "refs": [{ "id": "ref-for-browsing-context-set" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['07ad3048'] = { "dfnID": "07ad3048", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching", "dfnText": "create navigation params by fetching", "refSections": [{ "refs": [{ "id": "fc0e1ad00" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-create-navigation-params-by-fetching" }, { "id": "ref-for-create-navigation-params-by-fetching\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['65393af9'] = { "dfnID": "65393af9", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document", "dfnText": "document", "refSections": [{ "refs": [{ "id": "ref-for-she-document" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['092de955'] = { "dfnID": "092de955", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state", "dfnText": "document state", "refSections": [{ "refs": [{ "id": "ref-for-she-document-state" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['7f118064'] = { "dfnID": "7f118064", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#finalize-a-cross-document-navigation", "dfnText": "finalize a cross-document navigation", "refSections": [{ "refs": [{ "id": "ref-for-finalize-a-cross-document-navigation" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['40a1c717'] = { "dfnID": "40a1c717", "url": "https://html.spec.whatwg.org/multipage/browsers.html#tlbc-group", "dfnText": "group", "refSections": [{ "refs": [{ "id": "ref-for-tlbc-group" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['2895d75d'] = { "dfnID": "2895d75d", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-initiator-origin", "dfnText": "initiator origin", "refSections": [{ "refs": [{ "id": "ref-for-document-state-initiator-origin" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['d4dbbbf0'] = { "dfnID": "d4dbbbf0", "url": "https://html.spec.whatwg.org/multipage/dom.html#language", "dfnText": "language", "refSections": [{ "refs": [{ "id": "ref-for-language" }, { "id": "ref-for-language\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['b07164ad'] = { "dfnID": "b07164ad", "url": "https://html.spec.whatwg.org/multipage/form-elements.html#attr-select-multiple", "dfnText": "multiple", "refSections": [{ "refs": [{ "id": "ref-for-attr-select-multiple" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['2594e562'] = { "dfnID": "2594e562", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate", "dfnText": "navigate", "refSections": [{ "refs": [{ "id": "ref-for-navigate" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-navigate\u2460" }, { "id": "ref-for-navigate\u2461" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['fffd9ca9'] = { "dfnID": "fffd9ca9", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate-fragid", "dfnText": "navigate to a fragment", "refSections": [{ "refs": [{ "id": "319d7c290" }, { "id": "319d7c291" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "319d7c292" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-navigate-fragid" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['4437edc6'] = { "dfnID": "4437edc6", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params", "dfnText": "navigation params", "refSections": [{ "refs": [{ "id": "ref-for-navigation-params" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['13dd6cae'] = { "dfnID": "13dd6cae", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable", "dfnText": "node navigable", "refSections": [{ "refs": [{ "id": "ref-for-node-navigable" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['086e3aff'] = { "dfnID": "086e3aff", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "dfnText": "origin", "refSections": [{ "refs": [{ "id": "ref-for-concept-origin" }, { "id": "ref-for-concept-origin\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['1bba3db7'] = { "dfnID": "1bba3db7", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent", "dfnText": "parent", "refSections": [{ "refs": [{ "id": "ref-for-nav-parent" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['8b87b428'] = { "dfnID": "8b87b428", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#restore-persisted-state", "dfnText": "restore persisted state", "refSections": [{ "refs": [{ "id": "ref-for-restore-persisted-state" }], "title": "3.5.5. Restricting Scroll on Load" }, { "refs": [{ "id": "ref-for-restore-persisted-state\u2460" }], "title": "3.8. Document Policy Integration" }], "external": true };
        window.dfnpanelData['7393da89'] = { "dfnID": "7393da89", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin", "dfnText": "same origin", "refSections": [{ "refs": [{ "id": "ref-for-same-origin" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['3f2e859c'] = { "dfnID": "3f2e859c", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#scroll-to-the-fragment-identifier", "dfnText": "scroll to the fragment", "refSections": [{ "refs": [{ "id": "ref-for-scroll-to-the-fragment-identifier" }, { "id": "ref-for-scroll-to-the-fragment-identifier\u2460" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-scroll-to-the-fragment-identifier\u2461" }, { "id": "ref-for-scroll-to-the-fragment-identifier\u2462" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-scroll-to-the-fragment-identifier\u2463" }], "title": "3.8. Document Policy Integration" }], "external": true };
        window.dfnpanelData['85188fb3'] = { "dfnID": "85188fb3", "url": "https://html.spec.whatwg.org/multipage/form-elements.html#the-select-element", "dfnText": "select", "refSections": [{ "refs": [{ "id": "ref-for-the-select-element" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['c3ae9e6a'] = { "dfnID": "c3ae9e6a", "url": "https://html.spec.whatwg.org/multipage/parsing.html#serializes-as-void", "dfnText": "serializes as void", "refSections": [{ "refs": [{ "id": "ref-for-serializes-as-void" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['8a051c9f'] = { "dfnID": "8a051c9f", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#try-to-scroll-to-the-fragment", "dfnText": "try to scroll to the fragment", "refSections": [{ "refs": [{ "id": "44bd3acf0" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-try-to-scroll-to-the-fragment" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-try-to-scroll-to-the-fragment\u2460" }], "title": "3.7. Indicating The Text Match" }], "external": true };
        window.dfnpanelData['5c1d019b'] = { "dfnID": "5c1d019b", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#update-document-for-history-step-application", "dfnText": "update document for history step application", "refSections": [{ "refs": [{ "id": "ref-for-update-document-for-history-step-application" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-update-document-for-history-step-application\u2460" }, { "id": "ref-for-update-document-for-history-step-application\u2461" }], "title": "3.5.4. Restricting the Text Fragment" }, { "refs": [{ "id": "ref-for-update-document-for-history-step-application\u2462" }], "title": "3.5.5. Restricting Scroll on Load" }], "external": true };
        window.dfnpanelData['34d2343e'] = { "dfnID": "34d2343e", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#user-navigation-involvement", "dfnText": "user navigation involvement", "refSections": [{ "refs": [{ "id": "ref-for-user-navigation-involvement" }, { "id": "ref-for-user-navigation-involvement\u2460" }, { "id": "ref-for-user-navigation-involvement\u2461" }, { "id": "ref-for-user-navigation-involvement\u2462" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['53275e46'] = { "dfnID": "53275e46", "url": "https://infra.spec.whatwg.org/#list-append", "dfnText": "append", "refSections": [{ "refs": [{ "id": "ref-for-list-append" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-list-append\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['2d5a2765'] = { "dfnID": "2d5a2765", "url": "https://infra.spec.whatwg.org/#ascii-string", "dfnText": "ascii string", "refSections": [{ "refs": [{ "id": "ref-for-ascii-string" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-ascii-string\u2460" }, { "id": "ref-for-ascii-string\u2461" }, { "id": "ref-for-ascii-string\u2462" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['77b4c09a'] = { "dfnID": "77b4c09a", "url": "https://infra.spec.whatwg.org/#assert", "dfnText": "assert", "refSections": [{ "refs": [{ "id": "ref-for-assert" }, { "id": "ref-for-assert\u2460" }, { "id": "ref-for-assert\u2461" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-assert\u2462" }, { "id": "ref-for-assert\u2463" }, { "id": "ref-for-assert\u2464" }, { "id": "ref-for-assert\u2465" }, { "id": "ref-for-assert\u2466" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['7b0d918d'] = { "dfnID": "7b0d918d", "url": "https://infra.spec.whatwg.org/#iteration-break", "dfnText": "break", "refSections": [{ "refs": [{ "id": "ref-for-iteration-break" }, { "id": "ref-for-iteration-break\u2460" }, { "id": "ref-for-iteration-break\u2461" }, { "id": "ref-for-iteration-break\u2462" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['915aff5e'] = { "dfnID": "915aff5e", "url": "https://infra.spec.whatwg.org/#code-point", "dfnText": "code point", "refSections": [{ "refs": [{ "id": "ref-for-code-point" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['4ef39030'] = { "dfnID": "4ef39030", "url": "https://infra.spec.whatwg.org/#string-code-point-length", "dfnText": "code point length", "refSections": [{ "refs": [{ "id": "ref-for-string-code-point-length" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-string-code-point-length\u2460" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['bb1f9628'] = { "dfnID": "bb1f9628", "url": "https://infra.spec.whatwg.org/#code-point-substring", "dfnText": "code point substring", "refSections": [{ "refs": [{ "id": "ref-for-code-point-substring" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['cfd05055'] = { "dfnID": "cfd05055", "url": "https://infra.spec.whatwg.org/#code-point-substring-by-positions", "dfnText": "code point substring by positions", "refSections": [{ "refs": [{ "id": "ref-for-code-point-substring-by-positions" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['b8906bbb'] = { "dfnID": "b8906bbb", "url": "https://infra.spec.whatwg.org/#code-point-substring-to-the-end-of-the-string", "dfnText": "code point substring to the end of the string", "refSections": [{ "refs": [{ "id": "ref-for-code-point-substring-to-the-end-of-the-string" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-code-point-substring-to-the-end-of-the-string\u2460" }, { "id": "ref-for-code-point-substring-to-the-end-of-the-string\u2461" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['4a3bf5fb'] = { "dfnID": "4a3bf5fb", "url": "https://infra.spec.whatwg.org/#string-concatenate", "dfnText": "concatenate", "refSections": [{ "refs": [{ "id": "ref-for-string-concatenate" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['f937b7b6'] = { "dfnID": "f937b7b6", "url": "https://infra.spec.whatwg.org/#iteration-continue", "dfnText": "continue", "refSections": [{ "refs": [{ "id": "ref-for-iteration-continue" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-iteration-continue\u2460" }, { "id": "ref-for-iteration-continue\u2461" }, { "id": "ref-for-iteration-continue\u2462" }, { "id": "ref-for-iteration-continue\u2463" }, { "id": "ref-for-iteration-continue\u2464" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['03afaf9c'] = { "dfnID": "03afaf9c", "url": "https://infra.spec.whatwg.org/#list-empty", "dfnText": "empty", "refSections": [{ "refs": [{ "id": "ref-for-list-empty" }, { "id": "ref-for-list-empty\u2460" }, { "id": "ref-for-list-empty\u2461" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['9c05f1bf'] = { "dfnID": "9c05f1bf", "url": "https://infra.spec.whatwg.org/#string-ends-with", "dfnText": "ends with", "refSections": [{ "refs": [{ "id": "ref-for-string-ends-with" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['16d07e10'] = { "dfnID": "16d07e10", "url": "https://infra.spec.whatwg.org/#list-iterate", "dfnText": "for each", "refSections": [{ "refs": [{ "id": "ref-for-list-iterate" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-list-iterate\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['f052b1ea'] = { "dfnID": "f052b1ea", "url": "https://infra.spec.whatwg.org/#html-namespace", "dfnText": "html namespace", "refSections": [{ "refs": [{ "id": "ref-for-html-namespace" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['860300d4'] = { "dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{ "refs": [{ "id": "ref-for-implementation-defined" }], "title": "3.4.1. Invoking Text Directives" }], "external": true };
        window.dfnpanelData['0fa357c3'] = { "dfnID": "0fa357c3", "url": "https://infra.spec.whatwg.org/#string-length", "dfnText": "length", "refSections": [{ "refs": [{ "id": "ref-for-string-length" }, { "id": "ref-for-string-length\u2460" }, { "id": "ref-for-string-length\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['649608b9'] = { "dfnID": "649608b9", "url": "https://infra.spec.whatwg.org/#list", "dfnText": "list", "refSections": [{ "refs": [{ "id": "ref-for-list" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-list\u2460" }, { "id": "ref-for-list\u2461" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-list\u2462" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-list\u2463" }, { "id": "ref-for-list\u2464" }, { "id": "ref-for-list\u2465" }, { "id": "ref-for-list\u2466" }, { "id": "ref-for-list\u2467" }, { "id": "ref-for-list\u2468" }, { "id": "ref-for-list\u2460\u24ea" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": true };
        window.dfnpanelData['75bee4d5'] = { "dfnID": "75bee4d5", "url": "https://infra.spec.whatwg.org/#string-position-variable", "dfnText": "position variable", "refSections": [{ "refs": [{ "id": "ref-for-string-position-variable" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['0204d188'] = { "dfnID": "0204d188", "url": "https://infra.spec.whatwg.org/#list-size", "dfnText": "size", "refSections": [{ "refs": [{ "id": "ref-for-list-size" }, { "id": "ref-for-list-size\u2460" }, { "id": "ref-for-list-size\u2461" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['54627f47'] = { "dfnID": "54627f47", "url": "https://infra.spec.whatwg.org/#string-starts-with", "dfnText": "starts with", "refSections": [{ "refs": [{ "id": "ref-for-string-starts-with" }, { "id": "ref-for-string-starts-with\u2460" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['7a3dbdb1'] = { "dfnID": "7a3dbdb1", "url": "https://infra.spec.whatwg.org/#strictly-split", "dfnText": "strictly split a string", "refSections": [{ "refs": [{ "id": "ref-for-strictly-split" }, { "id": "ref-for-strictly-split\u2460" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['0698d556'] = { "dfnID": "0698d556", "url": "https://infra.spec.whatwg.org/#string", "dfnText": "string", "refSections": [{ "refs": [{ "id": "ref-for-string" }], "title": "3.3.3. Fragment directive grammar" }, { "refs": [{ "id": "ref-for-string\u2460" }, { "id": "ref-for-string\u2461" }, { "id": "ref-for-string\u2462" }, { "id": "ref-for-string\u2463" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-string\u2464" }], "title": "3.6.1. Finding Ranges in a Document" }, { "refs": [{ "id": "ref-for-string\u2465" }, { "id": "ref-for-string\u2466" }, { "id": "ref-for-string\u2467" }], "title": "3.6.2. Word Boundaries" }], "external": true };
        window.dfnpanelData['984221ca'] = { "dfnID": "984221ca", "url": "https://infra.spec.whatwg.org/#struct", "dfnText": "struct", "refSections": [{ "refs": [{ "id": "ref-for-struct" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['7c195f8b'] = { "dfnID": "7c195f8b", "url": "https://mimesniff.spec.whatwg.org/#mime-type-essence", "dfnText": "essence", "refSections": [{ "refs": [{ "id": "ref-for-mime-type-essence" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['16785ec4'] = { "dfnID": "16785ec4", "url": "https://mimesniff.spec.whatwg.org/#mime-type", "dfnText": "mime type", "refSections": [{ "refs": [{ "id": "ref-for-mime-type" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": true };
        window.dfnpanelData['ed948033'] = { "dfnID": "ed948033", "url": "https://url.spec.whatwg.org/#concept-url-fragment", "dfnText": "fragment", "refSections": [{ "refs": [{ "id": "ref-for-concept-url-fragment" }], "title": "3.3. The Fragment Directive" }, { "refs": [{ "id": "ref-for-concept-url-fragment\u2460" }, { "id": "ref-for-concept-url-fragment\u2461" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['79fa146b'] = { "dfnID": "79fa146b", "url": "https://url.spec.whatwg.org/#fragment-percent-encode-set", "dfnText": "fragment percent-encode set", "refSections": [{ "refs": [{ "id": "ref-for-fragment-percent-encode-set" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['8f69ce41'] = { "dfnID": "8f69ce41", "url": "https://url.spec.whatwg.org/#string-percent-decode", "dfnText": "percent-decode", "refSections": [{ "refs": [{ "id": "ref-for-string-percent-decode" }], "title": "3.4. Text Directives" }], "external": true };
        window.dfnpanelData['dcffbccd'] = { "dfnID": "dcffbccd", "url": "https://url.spec.whatwg.org/#concept-url", "dfnText": "url", "refSections": [{ "refs": [{ "id": "ref-for-concept-url" }, { "id": "ref-for-concept-url\u2460" }, { "id": "ref-for-concept-url\u2461" }], "title": "3.3.1. Extracting the fragment directive" }], "external": true };
        window.dfnpanelData['4bb788fe'] = { "dfnID": "4bb788fe", "url": "https://url.spec.whatwg.org/#url-code-points", "dfnText": "url code point", "refSections": [{ "refs": [{ "id": "ref-for-url-code-points" }, { "id": "ref-for-url-code-points\u2460" }], "title": "3.3.3. Fragment directive grammar" }], "external": true };
        window.dfnpanelData['889e932f'] = { "dfnID": "889e932f", "url": "https://webidl.spec.whatwg.org/#Exposed", "dfnText": "Exposed", "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }], "title": "3.9. Feature Detectability" }], "external": true };
        window.dfnpanelData['a5c91173'] = { "dfnID": "a5c91173", "url": "https://webidl.spec.whatwg.org/#SameObject", "dfnText": "SameObject", "refSections": [{ "refs": [{ "id": "ref-for-SameObject" }], "title": "3.9. Feature Detectability" }], "external": true };
        window.dfnpanelData['fragment-directive'] = { "dfnID": "fragment-directive", "url": "#fragment-directive", "dfnText": "fragment directive", "refSections": [{ "refs": [{ "id": "ref-for-fragment-directive" }], "title": "3.2. Syntax" }, { "refs": [{ "id": "ref-for-fragment-directive\u2460" }, { "id": "ref-for-fragment-directive\u2461" }], "title": "3.3. The Fragment Directive" }, { "refs": [{ "id": "ref-for-fragment-directive\u2462" }, { "id": "ref-for-fragment-directive\u2463" }, { "id": "ref-for-fragment-directive\u2464" }, { "id": "ref-for-fragment-directive\u2465" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-fragment-directive\u2466" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-fragment-directive\u2467" }, { "id": "ref-for-fragment-directive\u2468" }, { "id": "ref-for-fragment-directive\u2460\u24ea" }], "title": "3.7.1. URLs in UA features" }, { "refs": [{ "id": "ref-for-fragment-directive\u2460\u2460" }], "title": "3.7.1.1. Location Bar" }, { "refs": [{ "id": "ref-for-fragment-directive\u2460\u2461" }, { "id": "ref-for-fragment-directive\u2460\u2462" }], "title": "3.7.1.2. Bookmarks" }, { "refs": [{ "id": "ref-for-fragment-directive\u2460\u2463" }], "title": "3.7.1.3. Sharing" }], "external": false };
        window.dfnpanelData['fragment-directive-delimiter'] = { "dfnID": "fragment-directive-delimiter", "url": "#fragment-directive-delimiter", "dfnText": "fragment directive delimiter", "refSections": [{ "refs": [{ "id": "ref-for-fragment-directive-delimiter" }], "title": "3.3. The Fragment Directive" }, { "refs": [{ "id": "ref-for-fragment-directive-delimiter\u2460" }, { "id": "ref-for-fragment-directive-delimiter\u2461" }, { "id": "ref-for-fragment-directive-delimiter\u2462" }, { "id": "ref-for-fragment-directive-delimiter\u2463" }], "title": "3.3.1. Extracting the fragment directive" }], "external": false };
        window.dfnpanelData['directives'] = { "dfnID": "directives", "url": "#directives", "dfnText": "directives", "refSections": [{ "refs": [{ "id": "ref-for-directives" }], "title": "3.4. Text Directives" }], "external": false };
        window.dfnpanelData['directive-state'] = { "dfnID": "directive-state", "url": "#directive-state", "dfnText": "directive state", "refSections": [{ "refs": [{ "id": "ref-for-directive-state" }, { "id": "ref-for-directive-state\u2460" }, { "id": "ref-for-directive-state\u2461" }, { "id": "ref-for-directive-state\u2462" }, { "id": "ref-for-directive-state\u2463" }, { "id": "ref-for-directive-state\u2464" }, { "id": "ref-for-directive-state\u2465" }, { "id": "ref-for-directive-state\u2466" }], "title": "3.3.1. Extracting the fragment directive" }], "external": false };
        window.dfnpanelData['directive-state-value'] = { "dfnID": "directive-state-value", "url": "#directive-state-value", "dfnText": "value", "refSections": [{ "refs": [{ "id": "ref-for-directive-state-value" }, { "id": "ref-for-directive-state-value\u2460" }, { "id": "ref-for-directive-state-value\u2461" }, { "id": "ref-for-directive-state-value\u2462" }, { "id": "ref-for-directive-state-value\u2463" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-directive-state-value\u2464" }], "title": "3.3.2. Applying directives to a document" }], "external": false };
        window.dfnpanelData['she-directive-state'] = { "dfnID": "she-directive-state", "url": "#she-directive-state", "dfnText": "directive state", "refSections": [{ "refs": [{ "id": "ref-for-she-directive-state" }, { "id": "ref-for-she-directive-state\u2460" }, { "id": "ref-for-she-directive-state\u2461" }, { "id": "ref-for-she-directive-state\u2462" }, { "id": "ref-for-she-directive-state\u2463" }, { "id": "ref-for-she-directive-state\u2464" }, { "id": "ref-for-she-directive-state\u2465" }, { "id": "ref-for-she-directive-state\u2466" }], "title": "3.3.1. Extracting the fragment directive" }, { "refs": [{ "id": "ref-for-she-directive-state\u2467" }, { "id": "ref-for-she-directive-state\u2468" }, { "id": "ref-for-she-directive-state\u2460\u24ea" }, { "id": "ref-for-she-directive-state\u2460\u2460" }], "title": "3.3.2. Applying directives to a document" }], "external": false };
        window.dfnpanelData['remove-the-fragment-directive'] = { "dfnID": "remove-the-fragment-directive", "url": "#remove-the-fragment-directive", "dfnText": "remove the fragment directive", "refSections": [{ "refs": [{ "id": "ref-for-remove-the-fragment-directive" }, { "id": "ref-for-remove-the-fragment-directive\u2460" }, { "id": "ref-for-remove-the-fragment-directive\u2461" }, { "id": "ref-for-remove-the-fragment-directive\u2462" }], "title": "3.3.1. Extracting the fragment directive" }], "external": false };
        window.dfnpanelData['document-pending-text-directives'] = { "dfnID": "document-pending-text-directives", "url": "#document-pending-text-directives", "dfnText": "pending text directives", "refSections": [{ "refs": [{ "id": "ref-for-document-pending-text-directives" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-document-pending-text-directives\u2460" }, { "id": "ref-for-document-pending-text-directives\u2461" }, { "id": "ref-for-document-pending-text-directives\u2462" }, { "id": "ref-for-document-pending-text-directives\u2463" }, { "id": "ref-for-document-pending-text-directives\u2464" }, { "id": "ref-for-document-pending-text-directives\u2465" }, { "id": "ref-for-document-pending-text-directives\u2466" }, { "id": "ref-for-document-pending-text-directives\u2467" }, { "id": "ref-for-document-pending-text-directives\u2468" }, { "id": "ref-for-document-pending-text-directives\u2460\u24ea" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-document-pending-text-directives\u2460\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['fragmentdirectiveproduction'] = { "dfnID": "fragmentdirectiveproduction", "url": "#fragmentdirectiveproduction", "dfnText": "FragmentDirective", "refSections": [{ "refs": [{ "id": "ref-for-fragmentdirectiveproduction" }, { "id": "ref-for-fragmentdirectiveproduction\u2460" }, { "id": "ref-for-fragmentdirectiveproduction\u2461" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirective'] = { "dfnID": "textdirective", "url": "#textdirective", "dfnText": "TextDirective", "refSections": [{ "refs": [{ "id": "ref-for-textdirective" }, { "id": "ref-for-textdirective\u2460" }, { "id": "ref-for-textdirective\u2461" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['unknowndirective'] = { "dfnID": "unknowndirective", "url": "#unknowndirective", "dfnText": "UnknownDirective", "refSections": [{ "refs": [{ "id": "ref-for-unknowndirective" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['characterstring'] = { "dfnID": "characterstring", "url": "#characterstring", "dfnText": "CharacterString", "refSections": [{ "refs": [{ "id": "ref-for-characterstring" }, { "id": "ref-for-characterstring\u2460" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['explicitchar'] = { "dfnID": "explicitchar", "url": "#explicitchar", "dfnText": "ExplicitChar", "refSections": [{ "refs": [{ "id": "ref-for-explicitchar" }, { "id": "ref-for-explicitchar\u2460" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['validtextdirective'] = { "dfnID": "validtextdirective", "url": "#validtextdirective", "dfnText": "ValidTextDirective", "refSections": [{ "refs": [{ "id": "ref-for-validtextdirective" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirectiveparameters'] = { "dfnID": "textdirectiveparameters", "url": "#textdirectiveparameters", "dfnText": "TextDirectiveParameters", "refSections": [{ "refs": [{ "id": "ref-for-textdirectiveparameters" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirectiveprefix'] = { "dfnID": "textdirectiveprefix", "url": "#textdirectiveprefix", "dfnText": "TextDirectivePrefix", "refSections": [{ "refs": [{ "id": "ref-for-textdirectiveprefix" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirectivesuffix'] = { "dfnID": "textdirectivesuffix", "url": "#textdirectivesuffix", "dfnText": "TextDirectiveSuffix", "refSections": [{ "refs": [{ "id": "ref-for-textdirectivesuffix" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirectivestring'] = { "dfnID": "textdirectivestring", "url": "#textdirectivestring", "dfnText": "TextDirectiveString", "refSections": [{ "refs": [{ "id": "ref-for-textdirectivestring" }, { "id": "ref-for-textdirectivestring\u2460" }, { "id": "ref-for-textdirectivestring\u2461" }, { "id": "ref-for-textdirectivestring\u2462" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['textdirectiveexplicitchar'] = { "dfnID": "textdirectiveexplicitchar", "url": "#textdirectiveexplicitchar", "dfnText": "TextDirectiveExplicitChar", "refSections": [{ "refs": [{ "id": "ref-for-textdirectiveexplicitchar" }, { "id": "ref-for-textdirectiveexplicitchar\u2460" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['percentencodedbyte'] = { "dfnID": "percentencodedbyte", "url": "#percentencodedbyte", "dfnText": "PercentEncodedByte", "refSections": [{ "refs": [{ "id": "ref-for-percentencodedbyte" }, { "id": "ref-for-percentencodedbyte\u2460" }], "title": "3.3.3. Fragment directive grammar" }], "external": false };
        window.dfnpanelData['text-directive'] = { "dfnID": "text-directive", "url": "#text-directive", "dfnText": "text directive", "refSections": [{ "refs": [{ "id": "ref-for-text-directive" }], "title": "3.2. Syntax" }, { "refs": [{ "id": "ref-for-text-directive\u2460" }], "title": "3.3.2. Applying directives to a document" }, { "refs": [{ "id": "ref-for-text-directive\u2461" }, { "id": "ref-for-text-directive\u2462" }, { "id": "ref-for-text-directive\u2463" }, { "id": "ref-for-text-directive\u2464" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-text-directive\u2465" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-text-directive\u2466" }, { "id": "ref-for-text-directive\u2467" }], "title": "3.5.1. Motivation" }, { "refs": [{ "id": "ref-for-text-directive\u2468" }], "title": "3.5.3. Search Timing" }, { "refs": [{ "id": "ref-for-text-directive\u2460\u24ea" }], "title": "3.6. Navigating to a Text Fragment" }, { "refs": [{ "id": "ref-for-text-directive\u2460\u2460" }, { "id": "ref-for-text-directive\u2460\u2461" }, { "id": "ref-for-text-directive\u2460\u2462" }], "title": "3.6.1. Finding Ranges in a Document" }, { "refs": [{ "id": "ref-for-text-directive\u2460\u2463" }], "title": "4. Generating Text Fragment Directives" }, { "refs": [{ "id": "ref-for-text-directive\u2460\u2464" }, { "id": "ref-for-text-directive\u2460\u2465" }, { "id": "ref-for-text-directive\u2460\u2466" }], "title": "4.2. Use Context Only When Necessary" }, { "refs": [{ "id": "ref-for-text-directive\u2460\u2467" }, { "id": "ref-for-text-directive\u2460\u2468" }], "title": "4.3. Determine If Fragment Id Is Needed" }], "external": false };
        window.dfnpanelData['text-directive-start'] = { "dfnID": "text-directive-start", "url": "#text-directive-start", "dfnText": "start", "refSections": [{ "refs": [{ "id": "ref-for-text-directive-start" }, { "id": "ref-for-text-directive-start\u2460" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-text-directive-start\u2461" }, { "id": "ref-for-text-directive-start\u2462" }, { "id": "ref-for-text-directive-start\u2463" }, { "id": "ref-for-text-directive-start\u2464" }, { "id": "ref-for-text-directive-start\u2465" }, { "id": "ref-for-text-directive-start\u2466" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['text-directive-end'] = { "dfnID": "text-directive-end", "url": "#text-directive-end", "dfnText": "end", "refSections": [{ "refs": [{ "id": "ref-for-text-directive-end" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-text-directive-end\u2460" }, { "id": "ref-for-text-directive-end\u2461" }, { "id": "ref-for-text-directive-end\u2462" }, { "id": "ref-for-text-directive-end\u2463" }, { "id": "ref-for-text-directive-end\u2464" }, { "id": "ref-for-text-directive-end\u2465" }, { "id": "ref-for-text-directive-end\u2466" }, { "id": "ref-for-text-directive-end\u2467" }, { "id": "ref-for-text-directive-end\u2468" }, { "id": "ref-for-text-directive-end\u2460\u24ea" }, { "id": "ref-for-text-directive-end\u2460\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['text-directive-prefix'] = { "dfnID": "text-directive-prefix", "url": "#text-directive-prefix", "dfnText": "prefix", "refSections": [{ "refs": [{ "id": "ref-for-text-directive-prefix" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-text-directive-prefix\u2460" }, { "id": "ref-for-text-directive-prefix\u2461" }, { "id": "ref-for-text-directive-prefix\u2462" }, { "id": "ref-for-text-directive-prefix\u2463" }, { "id": "ref-for-text-directive-prefix\u2464" }, { "id": "ref-for-text-directive-prefix\u2465" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['text-directive-suffix'] = { "dfnID": "text-directive-suffix", "url": "#text-directive-suffix", "dfnText": "suffix", "refSections": [{ "refs": [{ "id": "ref-for-text-directive-suffix" }], "title": "3.4. Text Directives" }, { "refs": [{ "id": "ref-for-text-directive-suffix\u2460" }, { "id": "ref-for-text-directive-suffix\u2461" }, { "id": "ref-for-text-directive-suffix\u2462" }, { "id": "ref-for-text-directive-suffix\u2463" }, { "id": "ref-for-text-directive-suffix\u2464" }, { "id": "ref-for-text-directive-suffix\u2465" }, { "id": "ref-for-text-directive-suffix\u2466" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['percent-decode-a-text-directive-term'] = { "dfnID": "percent-decode-a-text-directive-term", "url": "#percent-decode-a-text-directive-term", "dfnText": "percent-decode a text directive term", "refSections": [{ "refs": [{ "id": "ref-for-percent-decode-a-text-directive-term" }, { "id": "ref-for-percent-decode-a-text-directive-term\u2460" }, { "id": "ref-for-percent-decode-a-text-directive-term\u2461" }, { "id": "ref-for-percent-decode-a-text-directive-term\u2462" }], "title": "3.4. Text Directives" }], "external": false };
        window.dfnpanelData['parse-a-text-directive'] = { "dfnID": "parse-a-text-directive", "url": "#parse-a-text-directive", "dfnText": "parse a text directive", "refSections": [{ "refs": [{ "id": "ref-for-parse-a-text-directive" }], "title": "3.4. Text Directives" }], "external": false };
        window.dfnpanelData['parse-the-fragment-directive'] = { "dfnID": "parse-the-fragment-directive", "url": "#parse-the-fragment-directive", "dfnText": "parse the fragment directive", "refSections": [{ "refs": [{ "id": "ref-for-parse-the-fragment-directive" }], "title": "3.3.2. Applying directives to a document" }], "external": false };
        window.dfnpanelData['request-text-directive-user-activation'] = { "dfnID": "request-text-directive-user-activation", "url": "#request-text-directive-user-activation", "dfnText": "text directive user activation", "refSections": [{ "refs": [{ "id": "ref-for-request-text-directive-user-activation" }, { "id": "ref-for-request-text-directive-user-activation\u2460" }, { "id": "ref-for-request-text-directive-user-activation\u2461" }, { "id": "ref-for-request-text-directive-user-activation\u2462" }, { "id": "ref-for-request-text-directive-user-activation\u2463" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['document-text-directive-user-activation'] = { "dfnID": "document-text-directive-user-activation", "url": "#document-text-directive-user-activation", "dfnText": "text directive user activation", "refSections": [{ "refs": [{ "id": "ref-for-document-text-directive-user-activation" }, { "id": "ref-for-document-text-directive-user-activation\u2460" }, { "id": "ref-for-document-text-directive-user-activation\u2461" }, { "id": "ref-for-document-text-directive-user-activation\u2462" }, { "id": "ref-for-document-text-directive-user-activation\u2463" }, { "id": "ref-for-document-text-directive-user-activation\u2464" }, { "id": "ref-for-document-text-directive-user-activation\u2465" }, { "id": "ref-for-document-text-directive-user-activation\u2466" }, { "id": "ref-for-document-text-directive-user-activation\u2467" }, { "id": "ref-for-document-text-directive-user-activation\u2468" }, { "id": "ref-for-document-text-directive-user-activation\u2460\u24ea" }, { "id": "ref-for-document-text-directive-user-activation\u2460\u2460" }, { "id": "ref-for-document-text-directive-user-activation\u2460\u2461" }, { "id": "ref-for-document-text-directive-user-activation\u2460\u2462" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['navigation-params-user-involvement'] = { "dfnID": "navigation-params-user-involvement", "url": "#navigation-params-user-involvement", "dfnText": "user involvement", "refSections": [{ "refs": [{ "id": "ref-for-navigation-params-user-involvement" }, { "id": "ref-for-navigation-params-user-involvement\u2460" }, { "id": "ref-for-navigation-params-user-involvement\u2461" }, { "id": "ref-for-navigation-params-user-involvement\u2462" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['text-directive-allowing-mime-type'] = { "dfnID": "text-directive-allowing-mime-type", "url": "#text-directive-allowing-mime-type", "dfnText": "text directive allowing MIME type", "refSections": [{ "refs": [{ "id": "ref-for-text-directive-allowing-mime-type" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['check-if-a-text-directive-can-be-scrolled'] = { "dfnID": "check-if-a-text-directive-can-be-scrolled", "url": "#check-if-a-text-directive-can-be-scrolled", "dfnText": "check if a text directive can be scrolled", "refSections": [{ "refs": [{ "id": "ref-for-check-if-a-text-directive-can-be-scrolled" }, { "id": "ref-for-check-if-a-text-directive-can-be-scrolled\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['first-common-ancestor'] = { "dfnID": "first-common-ancestor", "url": "#first-common-ancestor", "dfnText": "first common ancestor", "refSections": [{ "refs": [{ "id": "ref-for-first-common-ancestor" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-first-common-ancestor\u2460" }], "title": "3.5.4. Restricting the Text Fragment" }], "external": false };
        window.dfnpanelData['shadow-including-parent'] = { "dfnID": "shadow-including-parent", "url": "#shadow-including-parent", "dfnText": "shadow-including parent", "refSections": [{ "refs": [{ "id": "ref-for-shadow-including-parent" }], "title": "3.6. Navigating to a Text Fragment" }], "external": false };
        window.dfnpanelData['invoke-text-directives'] = { "dfnID": "invoke-text-directives", "url": "#invoke-text-directives", "dfnText": "invoke text directives", "refSections": [{ "refs": [{ "id": "ref-for-invoke-text-directives" }], "title": "3.4.1. Invoking Text Directives" }, { "refs": [{ "id": "ref-for-invoke-text-directives\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['find-a-range-from-a-text-directive'] = { "dfnID": "find-a-range-from-a-text-directive", "url": "#find-a-range-from-a-text-directive", "dfnText": "find a range from a text directive", "refSections": [{ "refs": [{ "id": "ref-for-find-a-range-from-a-text-directive" }], "title": "3.5.3. Search Timing" }, { "refs": [{ "id": "ref-for-find-a-range-from-a-text-directive\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['next-non-whitespace-position'] = { "dfnID": "next-non-whitespace-position", "url": "#next-non-whitespace-position", "dfnText": "next\nnon-whitespace position", "refSections": [{ "refs": [{ "id": "ref-for-next-non-whitespace-position" }, { "id": "ref-for-next-non-whitespace-position\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['find-a-string-in-range'] = { "dfnID": "find-a-string-in-range", "url": "#find-a-string-in-range", "dfnText": "find a string in range", "refSections": [{ "refs": [{ "id": "ref-for-find-a-string-in-range" }, { "id": "ref-for-find-a-string-in-range\u2460" }, { "id": "ref-for-find-a-string-in-range\u2461" }, { "id": "ref-for-find-a-string-in-range\u2462" }, { "id": "ref-for-find-a-string-in-range\u2463" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['search-invisible'] = { "dfnID": "search-invisible", "url": "#search-invisible", "dfnText": "search invisible", "refSections": [{ "refs": [{ "id": "ref-for-search-invisible" }, { "id": "ref-for-search-invisible\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['non-searchable-subtree'] = { "dfnID": "non-searchable-subtree", "url": "#non-searchable-subtree", "dfnText": "non-searchable subtree", "refSections": [{ "refs": [{ "id": "ref-for-non-searchable-subtree" }, { "id": "ref-for-non-searchable-subtree\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['visible-text-node'] = { "dfnID": "visible-text-node", "url": "#visible-text-node", "dfnText": "visible text node", "refSections": [{ "refs": [{ "id": "ref-for-visible-text-node" }, { "id": "ref-for-visible-text-node\u2460" }, { "id": "ref-for-visible-text-node\u2461" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['has-block-level-display'] = { "dfnID": "has-block-level-display", "url": "#has-block-level-display", "dfnText": "has block-level display", "refSections": [{ "refs": [{ "id": "ref-for-has-block-level-display" }, { "id": "ref-for-has-block-level-display\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['nearest-block-ancestor'] = { "dfnID": "nearest-block-ancestor", "url": "#nearest-block-ancestor", "dfnText": "nearest block ancestor", "refSections": [{ "refs": [{ "id": "ref-for-nearest-block-ancestor" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['find-a-range-from-a-node-list'] = { "dfnID": "find-a-range-from-a-node-list", "url": "#find-a-range-from-a-node-list", "dfnText": "find a range from a node list", "refSections": [{ "refs": [{ "id": "ref-for-find-a-range-from-a-node-list" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['get-boundary-point-at-index'] = { "dfnID": "get-boundary-point-at-index", "url": "#get-boundary-point-at-index", "dfnText": "get boundary point at index", "refSections": [{ "refs": [{ "id": "ref-for-get-boundary-point-at-index" }, { "id": "ref-for-get-boundary-point-at-index\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }], "external": false };
        window.dfnpanelData['word-boundary'] = { "dfnID": "word-boundary", "url": "#word-boundary", "dfnText": "word boundary", "refSections": [{ "refs": [{ "id": "ref-for-word-boundary" }], "title": "3.6.1. Finding Ranges in a Document" }, { "refs": [{ "id": "ref-for-word-boundary\u2460" }], "title": "3.6.2. Word Boundaries" }], "external": false };
        window.dfnpanelData['locale'] = { "dfnID": "locale", "url": "#locale", "dfnText": "locale", "refSections": [{ "refs": [{ "id": "ref-for-locale" }, { "id": "ref-for-locale\u2460" }], "title": "3.6.2. Word Boundaries" }], "external": false };
        window.dfnpanelData['word-bounded'] = { "dfnID": "word-bounded", "url": "#word-bounded", "dfnText": "word bounded", "refSections": [{ "refs": [{ "id": "ref-for-word-bounded" }], "title": "3.6.2. Word Boundaries" }], "external": false };
        window.dfnpanelData['is-at-a-word-boundary'] = { "dfnID": "is-at-a-word-boundary", "url": "#is-at-a-word-boundary", "dfnText": "is at a word boundary", "refSections": [{ "refs": [{ "id": "ref-for-is-at-a-word-boundary" }, { "id": "ref-for-is-at-a-word-boundary\u2460" }], "title": "3.6.1. Finding Ranges in a Document" }, { "refs": [{ "id": "ref-for-is-at-a-word-boundary\u2461" }, { "id": "ref-for-is-at-a-word-boundary\u2462" }], "title": "3.6.2. Word Boundaries" }], "external": false };
        window.dfnpanelData['fragmentdirective'] = { "dfnID": "fragmentdirective", "url": "#fragmentdirective", "dfnText": "FragmentDirective", "refSections": [{ "refs": [{ "id": "ref-for-fragmentdirective" }], "title": "3.9. Feature Detectability" }], "external": false };
    </script>
    <script>/* Boilerplate: script-dom-helper */
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }
    </script>
    <script>/* Boilerplate: script-var-click-highlighting */
        /*
        Color-choosing design:
        
        Colors are ordered by goodness.
        Each color has a usage count (initially zero).
        Each variable has a last-used color.
        
        * If the var has a last-used color, and that color's usage is 0,
            return that color.
        * Otherwise, return the lowest-indexed color with the lowest usage.
            Increment the color's usage and set it as the last-used color
            for that var.
        * On unclicking, decrement usage of the color.
        */
        "use strict";
        {
            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script>/* Boilerplate: script-wpt */
        let wptPath = "/scroll-to-text-fragment/";
        "use strict";

        document.addEventListener("DOMContentLoaded", async () => {
            if (wptPath == "/") return;

            const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
            const runs = await (await fetch(runsUrl)).json();

            const testResults = await (await fetch("https://wpt.fyi/api/search", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    "run_ids": runs.map(x => x.id),
                    "query": { "path": wptPath },
                })
            })).json();

            const browsers = runs.map(x => ({ name: x.browser_name, version: x.browser_version, passes: 0, total: 0 }));
            const resultsFromPath = new Map(testResults.results.map(result => {
                const testPath = result.test;
                const passes = result.legacy_status.map(x => [x.passes, x.total]);
                return [testPath, passes];
            }));
            const seenTests = new Set();
            document.querySelectorAll(".wpt-name").forEach(nameEl => {
                const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
                if (!passData) {
                    console.log("Couldn't find test in results:", nameEl);
                    return
                }
                const numTests = passData[0][1];
                if (numTests > 1) {
                    nameEl.insertAdjacentElement("beforeend",
                        el("small", {}, ` (${numTests} tests)`));
                }
                if (passData == undefined) return;
                const resultsEl = el("span", { "class": "wpt-results" },
                    ...passData.map((p, i) => el("span",
                        {
                            "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                            "class": "wpt-result",
                            "style": `background: conic-gradient(forestgreen ${p[0] / p[1] * 360}deg, darkred 0deg);`,
                        })),
                );
                nameEl.insertAdjacentElement("afterend", resultsEl);

                // Only update the summary pass/total count if we haven't seen this
                // test before, to support authors listing the same test multiple times
                // in a spec.
                if (!seenTests.has(nameEl.getAttribute("title"))) {
                    seenTests.add(nameEl.getAttribute("title"));
                    passData.forEach((p, i) => {
                        browsers[i].passes += p[0];
                        browsers[i].total += p[1];
                    });
                }
            });
            const overview = document.querySelector(".wpt-overview");
            if (overview) {
                overview.appendChild(el('ul', {}, ...browsers.map(formatWptResult)));
                document.head.appendChild(el('style', {},
                    `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
            }
        });
        function el(name, attrs, ...content) {
            const x = document.createElement(name);
            for (const [k, v] of Object.entries(attrs)) {
                x.setAttribute(k, v);
            }
            for (let child of content) {
                if (typeof child == "string") child = document.createTextNode(child);
                try {
                    x.appendChild(child);
                } catch (e) { console.log({ x, child }); }
            }
            return x;
        }
        function formatWptResult({ name, version, passes, total }) {
            const passRate = passes / total;
            let passClass = "";
            if (passRate == 0) passClass = "passes-none";
            else if (passRate < .2) passClass = "passes-hardly";
            else if (passRate < .4) passClass = "passes-a-few";
            else if (passRate < .6) passClass = "passes-half";
            else if (passRate < .8) passClass = "passes-lots";
            else if (passRate < 1) passClass = "passes-most";
            else passClass = "passes-all";

            name = name[0].toUpperCase() + name.slice(1);
            const shortVersion = /^\d+/.exec(version);
            const icon = []

            if (name == "Chrome") icon.push(el('img', { alt: "", src: "https://wpt.fyi/static/chrome_64x64.png" }));
            if (name == "Edge") icon.push(el('img', { alt: "", src: "https://wpt.fyi/static/edge_64x64.png" }));
            if (name == "Safari") icon.push(el('img', { alt: "", src: "https://wpt.fyi/static/safari_64x64.png" }));
            if (name == "Firefox") icon.push(el('img', { alt: "", src: "https://wpt.fyi/static/firefox_64x64.png" }));

            return el('li', { "class": passClass },
                el('nobr', { 'class': 'browser' }, ...icon, ` ${name} ${shortVersion}`),
                el('br', {}),
                el('nobr', { 'class': 'pass-rate' }, `${passes}/${total}`)
            );
        }
    </script>
    <script src="/dropdown.js"></script>