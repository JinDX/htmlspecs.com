<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 35.4.0">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>requestIdleCallback()</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: italic
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="color-scheme" content="light">
    <meta name="revision" content="c4604781337b7bbfad37802a95f23907fca50e9e">
    <meta name="description" content="This document defines an API that web page authors can use to
    cooperatively schedule background tasks such that they do not introduce
    delays to other high priority tasks that share the same event loop, such as
    input processing, animations and frame compositing. The user agent is in a
    better position to determine when background tasks can be run without
    introducing user-perceptible delays or jank in animations and input
    response, based on its knowledge of currently scheduled tasks, vsync
    deadlines, user-interaction and so on. Using this API should therefore
    result in more appropriate scheduling of background tasks during times when
    the browser would otherwise be idle.">
    <link rel="canonical" href="https://www.w3.org/TR/requestidlecallback/">
    <style>
        .hljs {
            --base: #fafafa;
            --mono-1: #383a42;
            --mono-2: #686b77;
            --mono-3: #717277;
            --hue-1: #0b76c5;
            --hue-2: #336ae3;
            --hue-3: #a626a4;
            --hue-4: #42803c;
            --hue-5: #ca4706;
            --hue-5-2: #c91243;
            --hue-6: #986801;
            --hue-6-2: #9a6a01
        }

        @media (prefers-color-scheme:dark) {
            .hljs {
                --base: #282c34;
                --mono-1: #abb2bf;
                --mono-2: #818896;
                --mono-3: #5c6370;
                --hue-1: #56b6c2;
                --hue-2: #61aeee;
                --hue-3: #c678dd;
                --hue-4: #98c379;
                --hue-5: #e06c75;
                --hue-5-2: #be5046;
                --hue-6: #d19a66;
                --hue-6-2: #e6c07b
            }
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            color: var(--mono-1, #383a42);
            background: #fafafa;
            background: var(--base, #fafafa)
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            color: var(--mono-3, #717277);
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4;
            color: var(--hue-3, #a626a4)
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            color: var(--hue-5, #ca4706);
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5;
            color: var(--hue-1, #0b76c5)
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c;
            color: var(--hue-4, #42803c)
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01;
            color: var(--hue-6-2, #9a6a01)
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801;
            color: var(--hue-6, #986801)
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3;
            color: var(--hue-2, #336ae3)
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var:hover {
            text-decoration: underline;
            cursor: pointer
        }

        var.respec-hl {
            color: var(--color, #000);
            background-color: var(--bg-color);
            box-shadow: 0 0 0 2px var(--bg-color)
        }

        @media (prefers-color-scheme:dark) {
            var.respec-hl {
                filter: saturate(.9) brightness(.9)
            }
        }

        var.respec-hl-c1 {
            --bg-color: #f4d200
        }

        var.respec-hl-c2 {
            --bg-color: #ff87a2
        }

        var.respec-hl-c3 {
            --bg-color: #96e885
        }

        var.respec-hl-c4 {
            --bg-color: #3eeed2
        }

        var.respec-hl-c5 {
            --bg-color: #eacfb6
        }

        var.respec-hl-c6 {
            --bg-color: #82ddff
        }

        var.respec-hl-c7 {
            --bg-color: #ffbcf2
        }

        @media print {
            var.respec-hl {
                background: 0 0;
                color: #000;
                box-shadow: unset
            }
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "editors": [
    {
      "name": "Scott Haseley",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "122093"
    }
  ],
  "formerEditors": [
    {
      "name": "Ross McIlroy",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "80940"
    },
    {
      "name": "Ilya Grigorik",
      "url": "https://www.igvita.com/",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "56102"
    }
  ],
  "group": "webperf",
  "github": "w3c/requestidlecallback",
  "localBiblio": {
    "RESPONSETIME": {
      "title": "Response time in man-computer conversational transactions",
      "href": "http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf",
      "authors": [
        "Robert B. Miller"
      ],
      "status": "Fall Joint Computer Conference",
      "date": "December 1968",
      "id": "responsetime"
    }
  },
  "implementationReportURI": "https://wpt.fyi/requestidlecallback",
  "xref": "web-platform",
  "shortName": "requestidlecallback",
  "gitRevision": "c4604781337b7bbfad37802a95f23907fca50e9e",
  "publishDate": "2025-05-21",
  "previousMaturity": "WD",
  "previousPublishDate": "2024-12-17",
  "publishISODate": "2025-05-21T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 21 May 2025"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title"><code>requestIdleCallback()</code></h1>
        <h2 id="subtitle" class="subtitle">Cooperative Scheduling of Background Tasks</h2>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C Working Draft</a> <time
                class="dt-published" datetime="2025-05-21">21 May 2025</time></p>
        <details open="">
            <summary>More details about this document</summary>
            <dl>
                <dt>This version:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/">https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/</a>
                </dd>
                <dt>Latest published version:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/requestidlecallback/">https://www.w3.org/TR/requestidlecallback/</a>
                </dd>
                <dt>Latest editor's draft:</dt>
                <dd><a href="https://w3c.github.io/requestidlecallback/">https://w3c.github.io/requestidlecallback/</a>
                </dd>
                <dt>History:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/requestidlecallback/">https://www.w3.org/standards/history/requestidlecallback/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/commits/">Commit history</a>
                </dd>

                <dt>Implementation report:</dt>
                <dd>
                    <a href="https://wpt.fyi/requestidlecallback">https://wpt.fyi/requestidlecallback</a>
                </dd>



                <dt>Editor:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="122093">
                    <span class="p-name fn">Scott Haseley</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dt>
                    Former editors:
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="80940">
                    <span class="p-name fn">Ross McIlroy</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="56102">
                    <a class="u-url url p-name fn" href="https://www.igvita.com/">Ilya Grigorik</a> (<a
                        class="p-org org h-org" href="https://google.com/">Google Inc.</a>)
                </dd>

                <dt>Feedback:</dt>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/">GitHub w3c/requestidlecallback</a>
                    (<a href="https://github.com/w3c/requestidlecallback/pulls/">pull requests</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/new/choose">new issue</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/">open issues</a>)
                </dd>


            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2025

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>


    <section id="abstract" class="introductory">
        <h2>Abstract</h2>
        <p>This document defines an API that web page authors can use to
            cooperatively schedule background tasks such that they do not introduce
            delays to other high priority tasks that share the same event loop, such as
            input processing, animations and frame compositing. The user agent is in a
            better position to determine when background tasks can be run without
            introducing user-perceptible delays or jank in animations and input
            response, based on its knowledge of currently scheduled tasks, vsync
            deadlines, user-interaction and so on. Using this API should therefore
            result in more appropriate scheduling of background tasks during times when
            the browser would otherwise be idle.</p>
    </section>
    <section id="sotd" class="introductory">
        <h2>Status of This Document</h2>
        <p><em>This section describes the status of this
                document at the time of its publication. A list of current <abbr
                    title="World Wide Web Consortium">W3C</abbr>
                publications and the latest revision of this technical report can be found
                in the
                <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> standards and drafts
                    index</a> at
                https://www.w3.org/TR/.</em></p>
        <p>The Web Performance Working Group maintains a <a href="https://w3c-test.org/requestidlecallback/">test
                suite</a> for the specification. Please see the Working Group's <a
                href="http://wpt.fyi/requestidlecallback">implementation report</a>. Vendors interested in implementing
            this document <em class="rfc2119">SHOULD</em> join the mailing lists below and take part in the discussions.
        </p>
        <p>
            This document was published by the <a href="https://www.w3.org/groups/wg/webperf">Web Performance Working
                Group</a> as
            a Working Draft using the
            <a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">Recommendation track</a>.
        </p>
        <p>Publication as a Working Draft does not
            imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. </p>
        <p>
            This is a draft document and may be updated, replaced, or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other
            than work in progress.

        </p>
        <p>

            This document was produced by a group
            operating under the
            <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                Patent
                Policy</a>.


            <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webperf/ipr">public list of any patent
                disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the <abbr
                    title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.

        </p>
        <p>
            This document is governed by the
            <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">03 November 2023 <abbr
                    title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">Table of Contents</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#idle-periods"><bdi class="secno">2. </bdi>Idle Periods</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">3. </bdi>Conformance</a></li>
            <li class="tocline"><a class="tocxref" href="#window_extensions"><bdi class="secno">4. </bdi><span
                        data-xref-type="_IDL_" data-link-type="interface" data-lt="Window" data-cite="html"
                        data-cite-path="/nav-history-apis.html" data-cite-frag="window"
                        class="formerLink"><code>Window</code></span> interface extensions</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#the-requestidlecallback-method"><bdi class="secno">4.1
                            </bdi>The <span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                                data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                                data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"><code>requestIdleCallback()</code></span>
                            method</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-cancelidlecallback-method"><bdi class="secno">4.2
                            </bdi>The <span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                                data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                                data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"><code>cancelIdleCallback()</code></span>
                            method</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-idledeadline-interface"><bdi class="secno">4.3
                            </bdi>The <span data-export="" data-dfn-type="interface" data-idl="interface"
                                data-title="IdleDeadline" data-dfn-for=""><code>IdleDeadline</code></span> interface</a>
                    </li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#processing"><bdi class="secno">5. </bdi>Processing</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#start-an-idle-period-algorithm"><bdi class="secno">5.1
                            </bdi>Start an idle period algorithm</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callbacks-algorithm"><bdi
                                class="secno">5.2 </bdi>Invoke idle callbacks algorithm</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callback-timeout-algorithm"><bdi
                                class="secno">5.3 </bdi>Invoke idle callback timeout algorithm</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#privacy-considerations"><bdi class="secno">6. </bdi>Privacy
                    Considerations</a></li>
            <li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">7. </bdi>Security
                    Considerations</a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A.
                    </bdi>Acknowledgments</a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>Normative references</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>Informative references</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section class="informative" id="introduction">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link"
                href="#introduction" aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>Web pages often want to execute computation tasks on the browser's event
            loop which are not time-critical, but might take a significant portion of
            time to perform. Examples of such background tasks include recording
            analytics data, long running data processing operations, client-side
            templating and pre-rendering of content likely to become visible in the
            near future. These tasks must share the event loop with other time-critical
            operations, such as reacting to input and performing script-based
            animations using <a data-link-type="method" data-lt="requestAnimationFrame()"
                href="https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#dom-animationframeprovider-requestanimationframe"><code>requestAnimationFrame</code></a><code>()</code>.
            These
            background tasks are typically performed by scheduling a callback using
            <a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            and running the background task during that
            callback.
        </p>
        <p>A disadvantage of this approach is that the author of the script has no
            way to inform the user-agent as to whether a given <a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            callback is
            time-critical or could be delayed until the browser is otherwise idle. In
            addition, the user agent isn't able to provide the callback with any
            information about how long it can continue to execute without delaying
            time-critical operations and causing jank or other user-perceptible delays.
            As a result, the easiest way forward is for the author is to simply call
            <a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            with a very small value, and then execute the minimum possible
            chunk of work in the resulting callback and reschedule additional work with
            another call to <a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>.
            This is less than optimal because there is
            extra overhead from having to post many small tasks on the user agent's
            event loop and schedule their execution. It also relies on the user-agent
            interleaving other time-critical work between each of these callbacks
            appropriately, which is difficult since the user-agent can't make accurate
            assumptions on how long each of these callbacks are likely to take.
        </p>
        <p>The API described in this document allows script authors to request the
            user-agent to schedule a callback when it would otherwise be idle. The user
            agent provides an estimation of how long it expects to remain idle as a
            deadline passed to the callback. The page author can use the deadline to
            ensure that these background tasks don't impact latency-critical events
            such as animation and input response.</p>
        <p>Here is an example of using the API to write a background task.</p>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">Example<bdi> 1</bdi></a>
            </div>
            <pre class="highlight"
                aria-busy="false"><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Scheduling background tasks using requestIdleCallback<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
<span class="hljs-keyword">var</span> requestId = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsTotal = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsInside = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">piStep</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">var</span> r = <span class="hljs-number">10</span>;
  <span class="hljs-keyword">var</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">var</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(x, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(y, <span class="hljs-number">2</span>) &lt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(r, <span class="hljs-number">2</span>))
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">refinePi</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">piStep</span>())
      pointsInside++;
    pointsTotal++;
  }
  currentEstimate = (<span class="hljs-number">4</span> <span class="hljs-string">`*`</span> pointsInside / pointsTotal);
  textElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"piEstimate"</span>);
  textElement.<span class="hljs-property">innerHTML</span>=<span class="hljs-string">"Pi Estimate: "</span> + currentEstimate;
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (requestId)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">cancelIdleCallback</span>(requestId);
  requestId = <span class="hljs-number">0</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"start()"</span>&gt;</span>Click me to start!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stop()"</span>&gt;</span>Click me to stop!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"piEstimate"</span>&gt;</span>Not started<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
        </div>
    </section>
    <section class="informative" id="idle-periods">
        <div class="header-wrapper">
            <h2 id="x2-idle-periods"><bdi class="secno">2. </bdi>Idle Periods</h2><a class="self-link"
                href="#idle-periods" aria-label="Permalink for Section 2."></a>
        </div>
        <p><em>This section is non-normative.</em></p>

        <p>After input processing, rendering and compositing for a given frame has
            been completed, the user agent's main thread often becomes idle until
            either: the next frame begins; another pending task becomes eligible to
            run; or user input is received. This specification provides a means to
            schedule execution of callbacks during this otherwise idle time via a
            <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-1"><code>requestIdleCallback</code></a><code>()</code> API.
        </p>
        <p>Callbacks posted via the <a data-link-type="idl" data-lt="requestIdleCallback()"
                href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-2"><code>requestIdleCallback</code></a><code>()</code> API
            become eligible to
            run during user agent defined idle periods. When an idle callback is run it
            will be given a deadline which corresponds to the end of the current idle
            period. The decision as to what constitutes an idle period is user agent
            defined, however the expectation is that they occur in periods of
            quiescence where the browser expects to be idle.</p>
        <p>One example of an idle period is the time between committing a given
            frame to the screen and starting processing on the next frame during active
            animations, as shown in <a href="#figure1" class="fig-ref"
                title="Example of an inter-frame idle period">Figure <bdi class="">1</bdi></a>. Such idle periods will
            occur frequently during active animations and screen updates, but will
            typically be very short (i.e., less than 16ms for devices with a 60Hz vsync
            cycle).</p>

        <figure id="figure1">
            <img alt="Example of an inter-frame idle period." src="images/image01.png">
            <figcaption><a class="self-link" href="#figure1">Figure <bdi class="figno">1</bdi></a> <span
                    class="fig-title">
                    Example of an inter-frame idle period
                </span></figcaption>
        </figure>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div>
            <p class="">The web-developer should be careful to account for all work
                performed by operations during an idle callback. Some operations, such as
                resolving a promise or triggering a page layout, may cause subsequent tasks
                to be scheduled to run after the idle callback has finished. In such cases,
                the application should account for this additional work by yielding before
                the deadline expires to allow these operations to be performed before the
                next frame deadline.</p>
        </div>
        <p>Another example of an idle period is when the user agent is idle with no
            screen updates occurring. In such a situation the user agent may have no
            upcoming tasks with which it can bound the end of the idle period. In order
            to avoid causing user-perceptible delays in unpredictable tasks, such as
            processing of user input, the length of these idle periods should be capped
            to a maximum value of <a href="#why50">50ms</a>. Once an idle period is
            finished the user agent can schedule another idle period if it remains
            idle, as shown in <a href="#figure2" class="fig-ref"
                title="Example of an idle period when there are no pending frame updates">Figure <bdi
                    class="">2</bdi></a>, to enable background work to
            continue to occur over longer idle time periods.</p>


        <figure id="figure2">
            <img alt="Example of an idle period when there are no pending frame updates." src="images/image00.png">
            <figcaption><a class="self-link" href="#figure2">Figure <bdi class="figno">2</bdi></a> <span
                    class="fig-title">
                    Example of an idle period when there are no pending frame updates
                </span></figcaption>
        </figure>
        <p>During an idle period the user agent will run idle callbacks in FIFO
            order until either the idle period ends or there are no more idle callbacks
            eligible to be run. As such, the user agent will not necessarily run all
            currently posted idle callbacks within a single idle period. Any remaining
            idle tasks are eligible to run during the next idle period.</p>
        <div class="note" role="note" id="issue-container-generatedID-0">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div>
            <p class="">To deliver the best performance developers are encouraged
                to eliminate unnecessary callbacks (e.g. requestAnimationFrame, setTimeout,
                and so on) that do not perform meaningful work; do not keep such callbacks
                firing and waiting for events to react, instead schedule them as necessary
                to react to events once they become available. Such pattern improves
                overall efficiency, and enables the user agent to schedule long idle
                callbacks (up to 50ms) that can be used to efficiently perform large blocks
                of background work.</p>
        </div>
        <p>Only idle tasks which posted before the start of the current idle period
            are eligible to be run during the current idle period. As a result, if an
            idle callback posts another callback using <a data-link-type="idl" data-lt="requestIdleCallback()"
                href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-3"><code>requestIdleCallback</code></a><code>()</code>, this
            subsequent callback won't be run during the current idle period. This
            enables idle callbacks to re-post themselves to be run in a future idle
            period if they cannot complete their work by a given deadline - i.e.,
            allowing code patterns like the following example, without causing the
            callback to be repeatedly executed during a too-short idle period:</p>
        <div class="example" id="example-2">
            <div class="marker">
                <a class="self-link" href="#example-2">Example<bdi> 2</bdi></a>
            </div>
            <pre class="highlight" aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">doWork</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">if</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &lt;= <span class="hljs-number">5</span>) {
    <span class="hljs-comment">// This will take more than 5ms so wait until we</span>
    <span class="hljs-comment">// get called back with a long enough deadline.</span>
    <span class="hljs-title function_">requestIdleCallback</span>(doWork);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// do work...</span>
}</code></pre>
        </div>
        <p>At the start of the next idle period newly posted idle callbacks are
            appended to the end of the runnable idle callback list, thus ensuring that
            reposting callbacks will be run round-robin style, with each callback
            getting a chance to be run before that of an earlier task's reposted
            callback.</p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>Note</span></div>
            <p class="">Future versions of this specification could allow other
                scheduling strategies. For example, schedule idle callback within the same
                idle period, a period that has at least <var>X</var> milliseconds of idle
                time, and so on. Current specification only supports the case for
                scheduling into the next idle period, at which time the callback can
                execute its logic, or repost itself into the next idle period.</p>
        </div>
        <p>When the user agent determines that the web page is not user visible it
            can throttle idle periods to reduce the power usage of the device, for
            example, only triggering an idle period every 10 seconds rather than
            continuously.</p>
        <p>A final subtlety to note is that there is no guarantee that a user agent
            will have any idle CPU time available during heavy page load. As such, it
            is entirely acceptable that the user agent does not schedule any idle
            period, which would result in the idle callbacks posted via the
            <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-4"><code>requestIdleCallback</code></a><code>()</code> API
            being postponed for a potentially unbounded
            amount of time. For cases where the author prefers to execute the callback
            within an idle period, but requires a time bound within which it can be
            executed, the author can provide the <code>timeout</code> property in the <code>options</code>
            argument to <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-5"><code>requestIdleCallback</code></a><code>()</code>: if
            the specified timeout is reached
            before the callback is executed within an idle period, a task is queued to
            execute it.
        </p>
        <div class="note" role="note" id="why50">
            <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>Note</span></div>
            <p class="">The maximum deadline of 50ms is derived from
                studies [<cite><a class="bibref" data-link-type="biblio" href="#bib-responsetime"
                        title="Response time in man-computer conversational transactions">RESPONSETIME</a></cite>] which
                show that that a response to user input
                within 100ms is generally perceived as instantaneous to humans. Capping
                idle deadlines to 50ms means that even if the user input occurs immediately
                after the idle task has begun, the user agent still has a remaining 50ms in
                which to respond to the user input without producing user perceptible
                lag.</p>
        </div>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x3-conformance"><bdi class="secno">3. </bdi>Conformance</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 3."></a>
        </div>
        <p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this
            specification are non-normative. Everything else in this specification is normative.</p>
        <p>
            The key words <em class="rfc2119">MUST</em>, <em class="rfc2119">REQUIRED</em>, <em
                class="rfc2119">SHALL</em>, and <em class="rfc2119">SHOULD</em> in this document
            are to be interpreted as described in
            <a href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119"
                    title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a
                    class="bibref" data-link-type="biblio" href="#bib-rfc8174"
                    title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
            when, and only when, they appear in all
            capitals, as shown here.
        </p>
        <p>The IDL fragments in this specification <em class="rfc2119">MUST</em> be interpreted as required
            for conforming IDL fragments.</p>
        <p>This specification defines a single conformance class:</p>
        <dl>
            <dt>conforming user agent</dt>
            <dd>
                A user agent is considered to be a conforming user agent if it
                satisfies all of the <em class="rfc2119">MUST</em>-, <em class="rfc2119">REQUIRED</em>- and <em
                    class="rfc2119">SHALL</em>-level criteria in this
                specification. A conforming user agent must also be a <a data-link-type="dfn"
                    href="https://webidl.spec.whatwg.org/#dfn-conforming-implementation">conforming
                    implementation</a> of the IDL fragment in section <a href="#window_extensions" class="sec-ref"><bdi
                        class="secno">4. </bdi><span><code>Window</code></span> interface extensions</a>.
            </dd>
        </dl>
    </section>
    <section id="window_extensions">
        <div class="header-wrapper">
            <h2 id="x4-window-interface-extensions"><bdi class="secno">4. </bdi><a data-link-type="interface"
                    data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                interface extensions</h2><a class="self-link" href="#window_extensions"
                aria-label="Permalink for Section 4."></a>
        </div>

        <p>The partial interface in the IDL fragment below is used to expose the
            <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-6"><code>requestIdleCallback</code></a><code>()</code>
            operation on the
            <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
            object.
        </p>
        <pre class="idl def"
            id="webidl-1323139649"><span class="idlHeader"><a class="self-link" href="#webidl-1323139649">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-window-partial-1" data-title="Window">partial interface <a data-idl="partial" data-link-type="interface" data-title="Window" class="idlID" data-dfn-for="Window" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">Window</a> {<span data-idl="" class="idlMethod" id="idl-def-window-requestidlecallback-callback-options" data-title="requestIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback-7"><code>requestIdleCallback</code></a>(<span class="idlType"><a data-link-type="idl" href="#dom-idlerequestcallback" class="internalDFN" id="ref-for-dom-idlerequestcallback-1"><code>IdleRequestCallback</code></a></span> <span class="idlParamName">callback</span>, optional<span class="idlType"> <a data-link-type="idl" href="#dom-idlerequestoptions" class="internalDFN" id="ref-for-dom-idlerequestoptions-1"><code>IdleRequestOptions</code></a></span> <span class="idlParamName">options</span> = {});</span><span data-idl="" class="idlMethod" id="idl-def-window-cancelidlecallback-handle" data-title="cancelIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-cancelidlecallback" id="ref-for-dom-window-cancelidlecallback-1"><code>cancelIdleCallback</code></a>(<span class="idlType"><a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">handle</span>);</span>
};</span><span data-idl="" class="idlDictionary" id="idl-def-idlerequestoptions" data-title="IdleRequestOptions">

dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-idlerequestoptions" id="ref-for-dom-idlerequestoptions-2"><code>IdleRequestOptions</code></a> {<span data-idl="" class="idlMember" id="idl-def-idlerequestoptions-timeout" data-title="timeout" data-dfn-for="IdleRequestOptions"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-idlerequestoptions-timeout" id="ref-for-dom-idlerequestoptions-timeout-1"><code>timeout</code></a>;</span>
};</span><span data-idl="" class="idlInterface" id="idl-def-idledeadline" data-title="IdleDeadline">

[<span class="extAttr"><a data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>] interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-idledeadline" id="ref-for-dom-idledeadline-1"><code>IdleDeadline</code></a> {<span data-idl="" class="idlMethod" id="idl-def-idledeadline-timeremaining" data-title="timeRemaining" data-dfn-for="IdleDeadline"><span class="idlType">
  <a data-link-type="typedef" href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp">DOMHighResTimeStamp</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-idledeadline-timeremaining" id="ref-for-dom-idledeadline-timeremaining-1"><code>timeRemaining</code></a>();</span><span data-idl="" class="idlAttribute" id="idl-def-idledeadline-didtimeout" data-title="didTimeout" data-dfn-for="IdleDeadline">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-idledeadline-didtimeout" id="ref-for-dom-idledeadline-didtimeout-1"><code>didTimeout</code></a>;</span>
};</span><span data-idl="" class="idlCallback" id="idl-def-idlerequestcallback" data-title="IdleRequestCallback">

callback <a class="internalDFN idlID" data-link-type="callback" href="#dom-idlerequestcallback" id="ref-for-dom-idlerequestcallback-2"><code>IdleRequestCallback</code></a> =<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> (<span class="idlType"><a data-link-type="idl" href="#dom-idledeadline" class="internalDFN" id="ref-for-dom-idledeadline-2"><code>IdleDeadline</code></a></span> <span class="idlParamName">deadline</span>);</span></code></pre>
        <p>Each <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a> has:
        </p>
        <ul>
            <li>A <dfn id="dfn-list-of-idle-request-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">list of idle request callbacks</dfn>. The list <em class="rfc2119">MUST</em> be
                initially empty and each entry in this list is identified by a number,
                which <em class="rfc2119">MUST</em> be unique within the list for the lifetime of the <a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                object.</li>
            <li>A <dfn id="dfn-list-of-runnable-idle-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">list of runnable idle callbacks</dfn>. The list <em class="rfc2119">MUST</em> be
                initially empty and each entry in this list is identified by a number,
                which <em class="rfc2119">MUST</em> be unique within the list of the lifetime of the <a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                object.</li>
            <li>An <dfn id="dfn-idle-callback-identifier" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">idle
                    callback identifier</dfn>, which is a number which <em class="rfc2119">MUST</em>
                initially be zero.</li>
        </ul>
        <section data-dfn-for="Window" id="the-requestidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-1-the-requestidlecallback-method"><bdi class="secno">4.1 </bdi>The <dfn data-export=""
                        data-dfn-type="method" id="dom-window-requestidlecallback" data-idl="operation"
                        data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                        data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                        data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>requestIdleCallback()</code></dfn> method</h3><a
                    class="self-link" href="#the-requestidlecallback-method" aria-label="Permalink for Section 4.1"></a>
            </div>

            <p>When <a data-link-type="idl" href="#dom-window-requestidlecallback" class="internalDFN"
                    id="ref-for-dom-window-requestidlecallback-8"><code>requestIdleCallback</code></a><code>(<var>callback</var>, <var>options</var>)</code>
                is
                invoked with a given <dfn data-export="" data-dfn-type="callback" id="dom-idlerequestcallback"
                    data-idl="callback" data-title="IdleRequestCallback" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestCallback</code></dfn>
                and optional <dfn data-export="" data-dfn-type="dictionary" id="dom-idlerequestoptions"
                    data-idl="dictionary" data-title="IdleRequestOptions" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestOptions</code></dfn>, the user agent
                <em class="rfc2119">MUST</em> run the following steps:
            </p>
            <ol>
                <li>Let <var>window</var> be this <a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    object.</li>
                <li>Increment the <var>window</var>'s <a href="#dfn-idle-callback-identifier" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-idle-callback-identifier-1">idle callback identifier</a>
                    by one.</li>
                <li>Let <var>handle</var> be the current value of <var>window</var>'s
                    <a href="#dfn-idle-callback-identifier" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-callback-identifier-2">idle callback identifier</a>.
                </li>
                <li>Push <var>callback</var> to the end of <var>window</var>'s <a
                        href="#dfn-list-of-idle-request-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-1">list
                        of idle request callbacks</a>, associated with <var>handle</var>.</li>
                <li>Return <var>handle</var> and then continue running this algorithm
                    asynchronously.
                    <div class="note" role="note" id="issue-container-generatedID-2">
                        <div role="heading" class="note-title marker" id="h-note-3" aria-level="4"><span>Note</span>
                        </div>
                        <p class="">The following steps run in parallel and queue a timer
                            similar to <code>setTimeout()</code> if the optional <code>timeout</code> property is
                            provided. From here, the idle and timeout callbacks are raced and
                            cancel each other—e.g. if the idle callback is scheduled first, then
                            it cancels the timeout callback, and vice versa.</p>
                    </div>
                </li>
                <li>If the <code><dfn data-dfn-for="IdleRequestOptions" data-export="" data-dfn-type="dict-member" id="dom-idlerequestoptions-timeout" data-idl="field" data-title="timeout" data-type="unsigned long" tabindex="0" aria-haspopup="dialog">timeout</dfn>
        </code> property is present in <var>options</var> and has a positive
                    value:
                    <ol>
                        <li>Wait for <var>timeout</var> milliseconds.</li>
                        <li>Wait until all invocations of this algorithm, whose
                            <var>timeout</var> added to their posted time occurred before this
                            one's, have completed.
                        </li>
                        <li>Optionally, wait a further user-agent defined length of time.
                            <div class="note" role="note" id="issue-container-generatedID-3">
                                <div role="heading" class="note-title marker" id="h-note-4" aria-level="4">
                                    <span>Note</span>
                                </div>
                                <p class="">This is intended to allow user agents to pad
                                    timeouts as needed to optimise the power usage of the device. For
                                    example, some processors have a low-power mode where the
                                    granularity of timers is reduced; on such platforms, user agents
                                    can slow timers down to fit this schedule instead of requiring
                                    the processor to use the more accurate mode with its associated
                                    higher power usage.</p>
                            </div>
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a
                                task</a> on the queue associated with the idle-task
                            <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">task
                                source</a>, which performs the <a href="#dfn-invoke-idle-callback-timeout-algorithm"
                                class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-1">invoke idle callback
                                timeout algorithm</a>, passing <var>handle</var> and
                            <var>window</var> as arguments.
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-4">
                <div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>Note</span></div>
                <p class=""><a data-link-type="idl" data-lt="requestIdleCallback()"
                        href="#dom-window-requestidlecallback" class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-9"><code>requestIdleCallback</code></a><code>()</code>
                    only schedules a single callback, which will be executed during a
                    single <a href="#dfn-idle-period" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-period-1">idle period</a>. If the callback cannot complete its work before
                    the given <var>deadline</var> then it should call
                    <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-10"><code>requestIdleCallback</code></a><code>()</code>
                    again
                    (which may be done from within the callback) to schedule a future callback
                    for the continuation of its task, and exit immediately to return control
                    back to the <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">event loop</a>.
                </p>
            </div>
        </section>
        <section data-dfn-for="Window" id="the-cancelidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-2-the-cancelidlecallback-method"><bdi class="secno">4.2 </bdi>The <dfn data-export=""
                        data-dfn-type="method" id="dom-window-cancelidlecallback" data-idl="operation"
                        data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                        data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                        data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>cancelIdleCallback()</code></dfn> method</h3><a
                    class="self-link" href="#the-cancelidlecallback-method" aria-label="Permalink for Section 4.2"></a>
            </div>

            <p>The <a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                    class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-2"><code>cancelIdleCallback</code></a><code>()</code>
                method is used to cancel a
                previously made request to schedule an idle callback. When
                <a data-link-type="idl" href="#dom-window-cancelidlecallback" class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-3"><code>cancelIdleCallback</code></a><code>(<var>handle</var>)</code>
                is invoked, the user agent
                <em class="rfc2119">MUST</em> run the following steps:
            </p>
            <ol>
                <li>Let <var>window</var> be this <a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    object.</li>
                <li>Find the entry in either the <var>window</var>'s <a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-2">list
                        of idle
                        request callbacks</a> or <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-1">list of runnable idle
                        callbacks</a> that is
                    associated with the value <var>handle</var>.
                </li>
                <li>If there is such an entry, remove it from both <var>window</var>'s
                    <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-3">list of idle request callbacks</a> and the <a
                        href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-2">list of runnable idle
                        callbacks</a>.
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-5">
                <div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>Note</span></div>
                <p class=""><a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-cancelidlecallback-4"><code>cancelIdleCallback</code></a><code>()</code>
                    might be invoked for an entry in <var>window</var>'s <a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-4">list
                        of
                        idle request callbacks</a> or the <a href="#dfn-list-of-runnable-idle-callbacks"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-3">list
                        of runnable idle callbacks</a>.
                    In either case the entry should be removed from the list so that the
                    callback does not run.</p>
            </div>
        </section>
        <section data-dfn-for="IdleDeadline" id="the-idledeadline-interface">
            <div class="header-wrapper">
                <h3 id="x4-3-the-idledeadline-interface"><bdi class="secno">4.3 </bdi>The <dfn data-export=""
                        data-dfn-type="interface" id="dom-idledeadline" data-idl="interface" data-title="IdleDeadline"
                        data-dfn-for="" tabindex="0" aria-haspopup="dialog"><code>IdleDeadline</code></dfn> interface
                </h3><a class="self-link" href="#the-idledeadline-interface" aria-label="Permalink for Section 4.3"></a>
            </div>

            <p>Each <a data-link-type="idl" data-lt="IdleDeadline" href="#dom-idledeadline" class="internalDFN"
                    id="ref-for-dom-idledeadline-3"><code>IdleDeadline</code></a> has an associated <dfn
                    id="dfn-get-deadline-time" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">get deadline
                    time</dfn> algorithm, which
                returns a <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                representing the absolute time in
                milliseconds of the deadline. The deadline is initially set to return zero.
            </p>
            <p>When the <dfn data-export="" data-dfn-type="method" id="dom-idledeadline-timeremaining"
                    data-idl="operation" data-title="timeRemaining()" data-dfn-for="IdleDeadline"
                    data-type="DOMHighResTimeStamp" data-lt="timeRemaining()"
                    data-local-lt="IdleDeadline.timeRemaining|IdleDeadline.timeRemaining()|timeRemaining" tabindex="0"
                    aria-haspopup="dialog"><code>timeRemaining()</code></dfn> method is invoked on
                an <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-idledeadline-4"><code>IdleDeadline</code></a> object it <em
                    class="rfc2119">MUST</em> return the remaining duration before
                the deadline expires as a <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>,
                which <em class="rfc2119">SHOULD</em> be
                enough to allow measurement while preventing timing attack - see
                "Privacy and Security" section of [<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                        title="High Resolution Time">HR-TIME</a></cite>]. This value is calculated
                by performing the following steps:</p>
            <ol>
                <li>Let <var>now</var> be a <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                        href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                    representing
                    <a data-link-type="dfn"
                        href="https://www.w3.org/TR/hr-time-3/#dfn-current-high-resolution-time">current high resolution
                        time</a> in milliseconds.
                </li>
                <li>Let <var>deadline</var> be the result of calling <a data-link-type="idl" data-lt="IdleDeadline"
                        href="#dom-idledeadline" class="internalDFN"
                        id="ref-for-dom-idledeadline-5"><code>IdleDeadline</code></a>'s <a href="#dfn-get-deadline-time"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-get-deadline-time-1">get deadline
                        time</a> algorithm.</li>
                <li>Let <var>timeRemaining</var> be <var>deadline</var> -
                    <var>now</var>.
                </li>
                <li>If <var>timeRemaining</var> is negative, set it to 0.</li>
                <li>Return <var>timeRemaining</var>.</li>
            </ol>
            <p>Each <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-idledeadline-6"><code>IdleDeadline</code></a> has an associated <dfn
                    id="dfn-timeout" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">timeout</dfn>, which is
                initially false. The
                <code><dfn data-export="" data-dfn-type="attribute" id="dom-idledeadline-didtimeout" data-idl="attribute" data-title="didTimeout" data-dfn-for="IdleDeadline" data-type="boolean" data-lt="didTimeout" data-local-lt="IdleDeadline.didTimeout" tabindex="0" aria-haspopup="dialog">didTimeout</dfn></code>
                getter <em class="rfc2119">MUST</em>
                return <a href="#dfn-timeout" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-timeout-1">timeout</a>.
            </p>
            <div class="note" role="note" id="issue-container-generatedID-6">
                <div role="heading" class="note-title marker" id="h-note-7" aria-level="4"><span>Note</span></div>
                <p class="">The <a href="#dfn-invoke-idle-callback-timeout-algorithm" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-2">invoke idle
                        callback timeout algorithm</a> sets
                    <a href="#dfn-timeout" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-timeout-2">timeout</a> to true to specify that the callback is being executed
                    outside an idle period, due to it having exceeded the value of the
                    <a href="#dom-idlerequestoptions" class="internalDFN" data-link-type="idl"
                        id="ref-for-dom-idlerequestoptions-3"><code>IdleRequestOptions</code></a>'s timeout property
                    which was passed when the
                    callback was registered.
                </p>
            </div>
        </section>
    </section>
    <section id="processing">
        <div class="header-wrapper">
            <h2 id="x5-processing"><bdi class="secno">5. </bdi>Processing</h2><a class="self-link" href="#processing"
                aria-label="Permalink for Section 5."></a>
        </div>

        <section id="start-an-idle-period-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-1-start-an-idle-period-algorithm"><bdi class="secno">5.1 </bdi>Start an idle period algorithm
                </h3><a class="self-link" href="#start-an-idle-period-algorithm"
                    aria-label="Permalink for Section 5.1"></a>
            </div>

            <p>To <dfn class="export" data-export="" id="dfn-start-an-idle-period" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">start an idle period</dfn> given <a data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> and
                <var>getDeadline</var>, an algorithm that returns a <a data-link-type="typedef"
                    data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>:
                [<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                        title="High Resolution Time">HR-TIME</a></cite>]

            </p>
            <div class="note" role="note" id="issue-container-generatedID-7">
                <div role="heading" class="note-title marker" id="h-note-8" aria-level="4"><span>Note</span></div>
                <p class="">The algorithm is called
                    by the <a href="https://html.spec.whatwg.org/multipage/#event-loop-processing-model">event loop
                        processing model</a>
                    when it determines that the <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">event loop</a> is
                    otherwise idle.</p>
            </div>

            <ol>
                <li>Optionally, if the user agent determines the idle period should
                    be delayed, return from this algorithm.
                    <div class="note" role="note" id="issue-container-generatedID-8">
                        <div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>Note</span>
                        </div>
                        <p class="" data-cite="page-visibility-2">This is intended to allow user agents to delay the
                            start of idle periods as needed to optimise the power usage of the
                            device. For example, if the <a data-link-type="interface" data-lt="Document"
                                href="https://dom.spec.whatwg.org/#document"><code>Document</code></a>'s <a
                                data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/interaction.html#visibility-state">visibility
                                state</a> is "hidden" then the user agent can
                            throttle idle period generation, for example limiting the Document to
                            one idle period every 10 seconds to optimize for power usage.</p>
                    </div>
                </li>
                <li>Let <var>pending_list</var> be <var>window</var>'s <a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-5">list
                        of idle
                        request callbacks</a>.
                </li>
                <li>Let <var>run_list</var> be <var>window</var>'s <a href="#dfn-list-of-runnable-idle-callbacks"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-4">list
                        of runnable
                        idle callbacks</a>.
                </li>
                <li>Append all entries from <var>pending_list</var> into
                    <var>run_list</var> preserving order.
                </li>
                <li>Clear <var>pending_list</var>.</li>
                <li><a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> on
                    the queue associated with the idle-task
                    <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">task source</a>, which
                    performs the steps defined in the <a href="#dfn-invoke-idle-callbacks-algorithm" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-invoke-idle-callbacks-algorithm-1">invoke
                        idle callbacks algorithm</a> with <var>window</var> and <var>getDeadline</var> as
                    parameters.
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-9">
                <div role="heading" class="note-title marker" id="h-note-10" aria-level="4"><span>Note</span></div>
                <div class="">
                    <p>The time between now and the deadline is referred
                        to as the <dfn id="dfn-idle-period" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">idle
                            period</dfn>. There can only be one idle period
                        active at a given time for any given <a data-link-type="interface" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>.
                        The idle period can end
                        early if the user agent determines that it is no longer idle. If so,
                        the next idle period cannot start until after <var>deadline</var>.</p>
                </div>
            </div>
        </section>
        <section id="invoke-idle-callbacks-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-2-invoke-idle-callbacks-algorithm"><bdi class="secno">5.2 </bdi>Invoke idle callbacks
                    algorithm</h3><a class="self-link" href="#invoke-idle-callbacks-algorithm"
                    aria-label="Permalink for Section 5.2"></a>
            </div>

            <p>To <dfn id="dfn-invoke-idle-callbacks-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">invoke idle callbacks algorithm</dfn> given <a data-link-type="interface"
                    data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> and
                <var>getDeadline</var>, an algorithm returning a <a data-link-type="typedef"
                    data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>:
                [<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                        title="High Resolution Time">HR-TIME</a></cite>].
            </p>
            <ol>
                <li>If the user-agent believes it should end the idle period early due
                    to newly scheduled high-priority work, return from the algorithm.
                </li>
                <li>Let <var>now</var> be the current time.</li>
                <li>If <var>now</var> is less than the result of calling <var>getDeadline</var> and the
                    <var>window</var>'s <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-5">list of runnable idle
                        callbacks</a> is not empty:
                    <ol>
                        <li>Pop the top <var>callback</var> from <var>window</var>'s
                            <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-6">list of runnable idle callbacks</a>.
                        </li>
                        <li>Let <var>deadlineArg</var> be a new <a href="#dom-idledeadline" class="internalDFN"
                                data-link-type="idl" id="ref-for-dom-idledeadline-7"><code>IdleDeadline</code></a> whose
                            <a href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-2">get deadline time</a> algorithm is
                            <var>getDeadline</var>.
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">Invoke</a>
                            <var>callback</var> with « <var>deadlineArg</var> » and "<code>report</code>".
                        </li>
                        <li>If <var>window</var>'s <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                                data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-7">list of runnable
                                idle callbacks</a>
                            is not empty, <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a
                                task</a> which performs the steps in the
                            <a href="#dfn-invoke-idle-callbacks-algorithm" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-invoke-idle-callbacks-algorithm-2">invoke idle callbacks algorithm</a>
                            with <var>getDeadline</var>
                            and <var>window</var> as a parameters and return from this
                            algorithm
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-10">
                <div role="heading" class="note-title marker" id="h-note-11" aria-level="4"><span>Note</span></div>
                <p class="">The user agent is free to end an idle period early, even
                    if <var>deadline</var> has not yet occurred, by deciding return from the
                    algorithm in step 1. For example, the user agent may decide to do this
                    if it determines that higher priority work has become runnable.</p>
            </div>
        </section>
        <section id="invoke-idle-callback-timeout-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-3-invoke-idle-callback-timeout-algorithm"><bdi class="secno">5.3 </bdi>Invoke idle callback
                    timeout algorithm</h3><a class="self-link" href="#invoke-idle-callback-timeout-algorithm"
                    aria-label="Permalink for Section 5.3"></a>
            </div>

            <p>The <dfn id="dfn-invoke-idle-callback-timeout-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">invoke idle callback timeout algorithm</dfn>:</p>
            <ol>
                <li>Let <var>callback</var> be the result of finding the entry in <var>
                        window</var>'s <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-6">list of idle request
                        callbacks</a> or the <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-8">list
                        of runnable idle callbacks</a> that is associated with the value
                    given by the <var>handle</var> argument passed to the algorithm.
                </li>
                <li>If <var>callback</var> is not undefined:
                    <ol>
                        <li>Remove <var>callback</var> from both <var>window</var>'s <a
                                href="#dfn-list-of-idle-request-callbacks" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-idle-request-callbacks-7">list
                                of idle request callbacks</a> and the <a href="#dfn-list-of-runnable-idle-callbacks"
                                class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-9">list of runnable idle
                                callbacks</a>.</li>
                        <li>Let <var>now</var> be the current time.</li>
                        <li>Let <var>deadlineArg</var> be a new <a href="#dom-idledeadline" class="internalDFN"
                                data-link-type="idl" id="ref-for-dom-idledeadline-8"><code>IdleDeadline</code></a>.
                            Set the <a href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-3">get deadline time</a> algorithm associated with
                            <var>deadlineArg</var> to
                            an algorithm returning <var>now</var> and set the <a href="#dfn-timeout" class="internalDFN"
                                data-link-type="dfn" id="ref-for-dfn-timeout-3">timeout</a> associated with
                            <var>deadlineArg</var> to <code>true</code>.
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">Invoke</a>
                            <var>callback</var> with « <var>deadlineArg</var> » and "<code>report</code>".
                        </li>
                    </ol>
                </li>
            </ol>
        </section>
    </section>
    <section id="privacy-considerations">
        <div class="header-wrapper">
            <h2 id="x6-privacy-considerations"><bdi class="secno">6. </bdi>Privacy Considerations</h2><a
                class="self-link" href="#privacy-considerations" aria-label="Permalink for Section 6."></a>
        </div>

        <p>When an idle callback is scheduled the user agent provides an estimate
            of how long it expects to remain idle. This information can be used to
            estimate the time taken by other application tasks and related browser work
            within that frame. However, developers can already access this information
            via other means - e.g. mark beginning of the frame via
            <code>requestAnimationFrame</code>, estimate the time of the next frame, and use that
            information to compute "remaining time" within any callback.
        </p>
        <p>To mitigate cache and statistical fingerprinting attacks, the resolution
            of the time estimates returned by the <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-idledeadline-9"><code>IdleDeadline</code></a> interface should
            be <a data-link-type="dfn" data-lt="coarsen time"
                href="https://www.w3.org/TR/hr-time-3/#dfn-coarsen-time">coarsened</a> based on
            <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability">cross-origin
                isolated capability</a> to ensure this API is not
            exposing more information than what's exposed by other web-exposed timers. [<cite><a class="bibref"
                    data-link-type="biblio" href="#bib-hr-time" title="High Resolution Time">HR-TIME</a></cite>]
        </p>
    </section>
    <section id="security-considerations">
        <div class="header-wrapper">
            <h2 id="x7-security-considerations"><bdi class="secno">7. </bdi>Security Considerations</h2><a
                class="self-link" href="#security-considerations" aria-label="Permalink for Section 7."></a>
        </div>

        <p>TBD
        </p>
    </section>
    <section id="acknowledgements" class="appendix">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>Acknowledgments</h2><a class="self-link"
                href="#acknowledgements" aria-label="Permalink for Appendix A."></a>
        </div>

        <p>The editors would like to thank the following people for contributing to
            this specification: Sami Kyostila, Alex Clarke, Boris Zbarsky, Marcos
            Caceres, Jonas Sicking, Robert O'Callahan, David Baron, Todd Reifsteck,
            Tobin Titus, Elliott Sprehn, Tetsuharu OHZEKI, Lon Ingram, Domenic Denicola,
            Philippe Le Hegaret and Anne van Kesteren. </p>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>References</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>Normative references</h3><a
                    class="self-link" href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-hr-time">[HR-TIME]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/hr-time-3/"><cite>High Resolution Time</cite></a>. Yoav Weiss. W3C. 7
                    November 2024. W3C Working Draft. URL: <a
                        href="https://www.w3.org/TR/hr-time-3/">https://www.w3.org/TR/hr-time-3/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Dominic Farolino; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. Living
                    Standard. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-rfc2119">[RFC2119]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate
                            Requirement Levels</cite></a>. S. Bradner. IETF. March 1997. Best Current Practice. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
                </dd>
                <dt id="bib-rfc8174">[RFC8174]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC
                            2119 Key Words</cite></a>. B. Leiba. IETF. May 2017. Best Current Practice. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
                </dd>
                <dt id="bib-webidl">[webidl]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. Living Standard. URL: <a
                        href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>Informative references</h3><a
                    class="self-link" href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-responsetime">[RESPONSETIME]</dt>
                <dd>
                    <a href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf"><cite>Response
                            time in man-computer conversational transactions</cite></a>. Robert B. Miller. December
                    1968. Fall Joint Computer Conference. URL: <a
                        href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf">http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-idle-request-callbacks"
        aria-label="Links in this document to definition: list of idle request callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-idle-request-callbacks"
                aria-label="Permalink for definition: list of idle request callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-1" title="§ 4.1 The requestIdleCallback() method">§
                    4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-2" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-4"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-5" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-6"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-7" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-runnable-idle-callbacks"
        aria-label="Links in this document to definition: list of runnable idle callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-runnable-idle-callbacks"
                aria-label="Permalink for definition: list of runnable idle callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-1" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-3"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-4" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-5" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-6"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-7"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-8"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-9" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-callback-identifier"
        aria-label="Links in this document to definition: idle callback identifier">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-callback-identifier"
                aria-label="Permalink for definition: idle callback identifier. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-callback-identifier-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dfn-idle-callback-identifier-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-requestidlecallback"
        aria-label="Links in this document to definition: requestIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-requestidlecallback"
                aria-label="Permalink for definition: requestIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-1" title="§ 2. Idle Periods">§ 2. Idle Periods</a> <a
                    href="#ref-for-dom-window-requestidlecallback-2" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-5" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-6" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-window-requestidlecallback-7"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-8" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dom-window-requestidlecallback-9"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-requestidlecallback-10"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestcallback"
        aria-label="Links in this document to definition: IdleRequestCallback">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestcallback"
                aria-label="Permalink for definition: IdleRequestCallback. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestcallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestcallback-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions"
        aria-label="Links in this document to definition: IdleRequestOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions"
                aria-label="Permalink for definition: IdleRequestOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestoptions-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-timeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-cancelidlecallback"
        aria-label="Links in this document to definition: cancelIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-cancelidlecallback"
                aria-label="Permalink for definition: cancelIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-2" title="§ 4.2 The cancelIdleCallback() method">§ 4.2
                    The cancelIdleCallback() method</a> <a href="#ref-for-dom-window-cancelidlecallback-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-cancelidlecallback-4"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline"
        aria-label="Links in this document to definition: IdleDeadline">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline"
                aria-label="Permalink for definition: IdleDeadline. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-1" title="§ 4. Window interface extensions">§ 4. Window interface
                    extensions</a> <a href="#ref-for-dom-idledeadline-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dom-idledeadline-4" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-idledeadline-5" title="Reference 3">(3)</a> <a href="#ref-for-dom-idledeadline-6"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-7" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke idle
                    callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-8" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke
                    idle callback timeout algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-9" title="§ 6. Privacy Considerations">§ 6. Privacy
                    Considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-get-deadline-time"
        aria-label="Links in this document to definition: get deadline time">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-get-deadline-time"
                aria-label="Permalink for definition: get deadline time. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-2" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke
                    idle callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3
                    Invoke idle callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-timeremaining"
        aria-label="Links in this document to definition: timeRemaining()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-timeremaining"
                aria-label="Permalink for definition: timeRemaining(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-timeremaining-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-timeout-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dfn-timeout-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-timeout-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle
                    callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-didtimeout"
        aria-label="Links in this document to definition: didTimeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-didtimeout"
                aria-label="Permalink for definition: didTimeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-didtimeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-start-an-idle-period"
        aria-label="Links in this document to definition: start an idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-start-an-idle-period"
                aria-label="Permalink for definition: start an idle period. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-period"
        aria-label="Links in this document to definition: idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-period"
                aria-label="Permalink for definition: idle period. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-period-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1 The
                    requestIdleCallback() method</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callbacks-algorithm"
        aria-label="Links in this document to definition: invoke idle callbacks algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callbacks-algorithm"
                aria-label="Permalink for definition: invoke idle callbacks algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-1" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-2" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callback-timeout-algorithm"
        aria-label="Links in this document to definition: invoke idle callback timeout algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callback-timeout-algorithm"
                aria-label="Permalink for definition: invoke idle callback timeout algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-1"
                    title="§ 4.1 The requestIdleCallback() method">§ 4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-2"
                    title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <script id="respec-highlight-vars">(() => {
            // @ts-check

            if (document.respec) {
                document.respec.ready.then(setupVarHighlighter);
            } else {
                setupVarHighlighter();
            }

            function setupVarHighlighter() {
                document
                    .querySelectorAll("var")
                    .forEach(varElem => varElem.addEventListener("click", highlightListener));
            }

            function highlightListener(ev) {
                ev.stopPropagation();
                const { target: varElem } = ev;
                const hightligtedElems = highlightVars(varElem);
                const resetListener = () => {
                    const hlColor = getHighlightColor(varElem);
                    hightligtedElems.forEach(el => removeHighlight(el, hlColor));
                    [...HL_COLORS.keys()].forEach(key => HL_COLORS.set(key, true));
                };
                if (hightligtedElems.length) {
                    document.body.addEventListener("click", resetListener, { once: true });
                }
            }

            // availability of highlight colors. colors from var.css
            const HL_COLORS = new Map([
                ["respec-hl-c1", true],
                ["respec-hl-c2", true],
                ["respec-hl-c3", true],
                ["respec-hl-c4", true],
                ["respec-hl-c5", true],
                ["respec-hl-c6", true],
                ["respec-hl-c7", true],
            ]);

            function getHighlightColor(target) {
                // return current colors if applicable
                const { value } = target.classList;
                const re = /respec-hl-\w+/;
                const activeClass = re.test(value) && value.match(re);
                if (activeClass) return activeClass[0];

                // first color preference
                if (HL_COLORS.get("respec-hl-c1") === true) return "respec-hl-c1";

                // otherwise get some other available color
                return [...HL_COLORS.keys()].find(c => HL_COLORS.get(c)) || "respec-hl-c1";
            }

            function highlightVars(varElem) {
                const textContent = norm(varElem.textContent);
                const parent = varElem.closest(".algorithm, section");
                const highlightColor = getHighlightColor(varElem);

                const varsToHighlight = [...parent.querySelectorAll("var")].filter(
                    el =>
                        norm(el.textContent) === textContent &&
                        el.closest(".algorithm, section") === parent
                );

                // update availability of highlight color
                const colorStatus = varsToHighlight[0].classList.contains("respec-hl");
                HL_COLORS.set(highlightColor, colorStatus);

                // highlight vars
                if (colorStatus) {
                    varsToHighlight.forEach(el => removeHighlight(el, highlightColor));
                    return [];
                } else {
                    varsToHighlight.forEach(el => addHighlight(el, highlightColor));
                }
                return varsToHighlight;
            }

            function removeHighlight(el, highlightColor) {
                el.classList.remove("respec-hl", highlightColor);
                // clean up empty class attributes so they don't come in export
                if (!el.classList.length) el.removeAttribute("class");
            }

            function addHighlight(elem, highlightColor) {
                elem.classList.add("respec-hl", highlightColor);
            }

            /**
             * Same as `norm` from src/core/utils, but our build process doesn't allow
             * imports in runtime scripts, so duplicated here.
             * @param {string} str
             */
            function norm(str) {
                return str.trim().replace(/\s+/g, " ");
            }
        })()</script>
    <script id="respec-dfn-panel">(() => {
                                               // @ts-check
                                               if (document.respec) {
                                                   document.respec.ready.then(setupPanel);
                                               } else {
                                                   setupPanel();
                                               }

                                               function setupPanel() {
                                                   const listener = panelListener();
                                                   document.body.addEventListener("keydown", listener);
                                                   document.body.addEventListener("click", listener);
                                               }

                                               function panelListener() {
                                                   /** @type {HTMLElement} */
                                                   let panel = null;
                                                   return event => {
                                                       const { target, type } = event;

                                                       if (!(target instanceof HTMLElement)) return;

                                                       // For keys, we only care about Enter key to activate the panel
                                                       // otherwise it's activated via a click.
                                                       if (type === "keydown" && event.key !== "Enter") return;

                                                       const action = deriveAction(event);

                                                       switch (action) {
                                                           case "show": {
                                                               hidePanel(panel);
                                                               /** @type {HTMLElement} */
                                                               const dfn = target.closest("dfn, .index-term");
                                                               panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                                                               const coords = deriveCoordinates(event);
                                                               displayPanel(dfn, panel, coords);
                                                               break;
                                                           }
                                                           case "dock": {
                                                               panel.style.left = null;
                                                               panel.style.top = null;
                                                               panel.classList.add("docked");
                                                               break;
                                                           }
                                                           case "hide": {
                                                               hidePanel(panel);
                                                               panel = null;
                                                               break;
                                                           }
                                                       }
                                                   };
                                               }

                                               /**
                                                * @param {MouseEvent|KeyboardEvent} event
                                                */
                                               function deriveCoordinates(event) {
                                                   const target = /** @type HTMLElement */ (event.target);

                                                   // We prevent synthetic AT clicks from putting
                                                   // the dialog in a weird place. The AT events sometimes
                                                   // lack coordinates, so they have clientX/Y = 0
                                                   const rect = target.getBoundingClientRect();
                                                   if (
                                                       event instanceof MouseEvent &&
                                                       event.clientX >= rect.left &&
                                                       event.clientY >= rect.top
                                                   ) {
                                                       // The event probably happened inside the bounding rect...
                                                       return { x: event.clientX, y: event.clientY };
                                                   }

                                                   // Offset to the middle of the element
                                                   const x = rect.x + rect.width / 2;
                                                   // Placed at the bottom of the element
                                                   const y = rect.y + rect.height;
                                                   return { x, y };
                                               }

                                               /**
                                                * @param {Event} event
                                                */
                                               function deriveAction(event) {
                                                   const target = /** @type {HTMLElement} */ (event.target);
                                                   const hitALink = !!target.closest("a");
                                                   if (target.closest("dfn:not([data-cite]), .index-term")) {
                                                       return hitALink ? "none" : "show";
                                                   }
                                                   if (target.closest(".dfn-panel")) {
                                                       if (hitALink) {
                                                           return target.classList.contains("self-link") ? "hide" : "dock";
                                                       }
                                                       const panel = target.closest(".dfn-panel");
                                                       return panel.classList.contains("docked") ? "hide" : "none";
                                                   }
                                                   if (document.querySelector(".dfn-panel:not([hidden])")) {
                                                       return "hide";
                                                   }
                                                   return "none";
                                               }

                                               /**
                                                * @param {HTMLElement} dfn
                                                * @param {HTMLElement} panel
                                                * @param {{ x: number, y: number }} clickPosition
                                                */
                                               function displayPanel(dfn, panel, { x, y }) {
                                                   panel.hidden = false;
                                                   // distance (px) between edge of panel and the pointing triangle (caret)
                                                   const MARGIN = 20;

                                                   const dfnRects = dfn.getClientRects();
                                                   // Find the `top` offset when the `dfn` can be spread across multiple lines
                                                   let closestTop = 0;
                                                   let minDiff = Infinity;
                                                   for (const rect of dfnRects) {
                                                       const { top, bottom } = rect;
                                                       const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                                                       if (diffFromClickY < minDiff) {
                                                           minDiff = diffFromClickY;
                                                           closestTop = top;
                                                       }
                                                   }

                                                   const top = window.scrollY + closestTop + dfnRects[0].height;
                                                   const left = x - MARGIN;
                                                   panel.style.left = `${left}px`;
                                                   panel.style.top = `${top}px`;

                                                   // Find if the panel is flowing out of the window
                                                   const panelRect = panel.getBoundingClientRect();
                                                   const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                                                   if (panelRect.right > SCREEN_WIDTH) {
                                                       const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                                                       const newCaretOffset = left - newLeft;
                                                       panel.style.left = `${newLeft}px`;
                                                       /** @type {HTMLElement} */
                                                       const caret = panel.querySelector(".caret");
                                                       caret.style.left = `${newCaretOffset}px`;
                                                   }

                                                   // As it's a dialog, we trap focus.
                                                   // TODO: when <dialog> becomes a implemented, we should really
                                                   // use that.
                                                   trapFocus(panel, dfn);
                                               }

                                               /**
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function trapFocus(panel, dfn) {
                                                   /** @type NodeListOf<HTMLAnchorElement> elements */
                                                   const anchors = panel.querySelectorAll("a[href]");
                                                   // No need to trap focus
                                                   if (!anchors.length) return;

                                                   // Move focus to first anchor element
                                                   const first = anchors.item(0);
                                                   first.focus();

                                                   const trapListener = createTrapListener(anchors, panel, dfn);
                                                   panel.addEventListener("keydown", trapListener);

                                                   // Hiding the panel releases the trap
                                                   const mo = new MutationObserver(records => {
                                                       const [record] = records;
                                                       const target = /** @type HTMLElement */ (record.target);
                                                       if (target.hidden) {
                                                           panel.removeEventListener("keydown", trapListener);
                                                           mo.disconnect();
                                                       }
                                                   });
                                                   mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
                                               }

                                               /**
                                                *
                                                * @param {NodeListOf<HTMLAnchorElement>} anchors
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function createTrapListener(anchors, panel, dfn) {
                                                   const lastIndex = anchors.length - 1;
                                                   let currentIndex = 0;
                                                   return event => {
                                                       switch (event.key) {
                                                           // Hitting "Tab" traps us in a nice loop around elements.
                                                           case "Tab": {
                                                               event.preventDefault();
                                                               currentIndex += event.shiftKey ? -1 : +1;
                                                               if (currentIndex < 0) {
                                                                   currentIndex = lastIndex;
                                                               } else if (currentIndex > lastIndex) {
                                                                   currentIndex = 0;
                                                               }
                                                               anchors.item(currentIndex).focus();
                                                               break;
                                                           }

                                                           // Hitting "Enter" on an anchor releases the trap.
                                                           case "Enter":
                                                               hidePanel(panel);
                                                               break;

                                                           // Hitting "Escape" returns focus to dfn.
                                                           case "Escape":
                                                               hidePanel(panel);
                                                               dfn.focus();
                                                               return;
                                                       }
                                                   };
                                               }

                                               /** @param {HTMLElement} panel */
                                               function hidePanel(panel) {
                                                   if (!panel) return;
                                                   panel.hidden = true;
                                                   panel.classList.remove("docked");
                                               }
                                           })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
</body>

</html>