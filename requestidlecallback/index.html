<!DOCTYPE html>
<html lang="zh-hans">

<head>
    <meta charset="utf-8">
    <!-- <meta name="generator" content="ReSpec 35.4.0"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>requestIdleCallback()</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: italic
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="color-scheme" content="light">
    <!-- <meta name="revision" content="c4604781337b7bbfad37802a95f23907fca50e9e"> -->
    <meta name="description"
        content="本文档定义了一个 API，允许网页开发者协同调度后台任务，从而不会对同一事件循环中的高优先级任务（如输入处理、动画和帧合成）造成延迟。用户代理能够根据其对当前已调度任务、垂直同步截止时间（vsync deadlines）、用户交互等的了解，更好地判断何时可以执行后台任务，而不会造成用户可感知的延迟或动画/输入卡顿。因此，使用此 API 可以使后台任务更合理地安排在浏览器本应处于空闲的时机进行。">
    <link rel="canonical" href="https://www.w3.org/TR/requestidlecallback/">
    <style>
        .hljs {
            --base: #fafafa;
            --mono-1: #383a42;
            --mono-2: #686b77;
            --mono-3: #717277;
            --hue-1: #0b76c5;
            --hue-2: #336ae3;
            --hue-3: #a626a4;
            --hue-4: #42803c;
            --hue-5: #ca4706;
            --hue-5-2: #c91243;
            --hue-6: #986801;
            --hue-6-2: #9a6a01
        }

        @media (prefers-color-scheme:dark) {
            .hljs {
                --base: #282c34;
                --mono-1: #abb2bf;
                --mono-2: #818896;
                --mono-3: #5c6370;
                --hue-1: #56b6c2;
                --hue-2: #61aeee;
                --hue-3: #c678dd;
                --hue-4: #98c379;
                --hue-5: #e06c75;
                --hue-5-2: #be5046;
                --hue-6: #d19a66;
                --hue-6-2: #e6c07b
            }
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            color: var(--mono-1, #383a42);
            background: #fafafa;
            background: var(--base, #fafafa)
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            color: var(--mono-3, #717277);
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4;
            color: var(--hue-3, #a626a4)
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            color: var(--hue-5, #ca4706);
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5;
            color: var(--hue-1, #0b76c5)
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c;
            color: var(--hue-4, #42803c)
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01;
            color: var(--hue-6-2, #9a6a01)
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801;
            color: var(--hue-6, #986801)
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3;
            color: var(--hue-2, #336ae3)
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var:hover {
            text-decoration: underline;
            cursor: pointer
        }

        var.respec-hl {
            color: var(--color, #000);
            background-color: var(--bg-color);
            box-shadow: 0 0 0 2px var(--bg-color)
        }

        @media (prefers-color-scheme:dark) {
            var.respec-hl {
                filter: saturate(.9) brightness(.9)
            }
        }

        var.respec-hl-c1 {
            --bg-color: #f4d200
        }

        var.respec-hl-c2 {
            --bg-color: #ff87a2
        }

        var.respec-hl-c3 {
            --bg-color: #96e885
        }

        var.respec-hl-c4 {
            --bg-color: #3eeed2
        }

        var.respec-hl-c5 {
            --bg-color: #eacfb6
        }

        var.respec-hl-c6 {
            --bg-color: #82ddff
        }

        var.respec-hl-c7 {
            --bg-color: #ffbcf2
        }

        @media print {
            var.respec-hl {
                background: 0 0;
                color: #000;
                box-shadow: unset
            }
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "editors": [
    {
      "name": "Scott Haseley",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "122093"
    }
  ],
  "formerEditors": [
    {
      "name": "Ross McIlroy",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "80940"
    },
    {
      "name": "Ilya Grigorik",
      "url": "https://www.igvita.com/",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "56102"
    }
  ],
  "group": "webperf",
  "github": "w3c/requestidlecallback",
  "localBiblio": {
    "RESPONSETIME": {
      "title": "Response time in man-computer conversational transactions",
      "href": "http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf",
      "authors": [
        "Robert B. Miller"
      ],
      "status": "Fall Joint Computer Conference",
      "date": "December 1968",
      "id": "responsetime"
    }
  },
  "implementationReportURI": "https://wpt.fyi/requestidlecallback",
  "xref": "web-platform",
  "shortName": "requestidlecallback",
  "gitRevision": "c4604781337b7bbfad37802a95f23907fca50e9e",
  "publishDate": "2025-05-21",
  "previousMaturity": "WD",
  "previousPublishDate": "2024-12-17",
  "publishISODate": "2025-05-21T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 21 May 2025"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title"><code>requestIdleCallback()</code></h1>
        <h2 id="subtitle" class="subtitle">后台任务的协作式调度</h2>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C 工作草案</a> <time class="dt-published"
                datetime="2025-05-21">2025年5月21日</time></p>
        <details open="">
            <summary>关于本文件的更多信息</summary>
            <dl>
                <dt>本版本：</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/">https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/</a>
                </dd>
                <dt>最新发布版本：</dt>
                <dd>
                    <a href="https://www.w3.org/TR/requestidlecallback/">https://www.w3.org/TR/requestidlecallback/</a>
                </dd>
                <dt>最新编辑草稿：</dt>
                <dd><a href="https://w3c.github.io/requestidlecallback/">https://w3c.github.io/requestidlecallback/</a>
                </dd>
                <dt>历史记录：</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/requestidlecallback/">https://www.w3.org/standards/history/requestidlecallback/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/commits/">提交历史</a>
                </dd>

                <dt>实现报告：</dt>
                <dd>
                    <a href="https://wpt.fyi/requestidlecallback">https://wpt.fyi/requestidlecallback</a>
                </dd>



                <dt>编辑：</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="122093">
                    <span class="p-name fn">Scott Haseley</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dt>
                    前任编辑：
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="80940">
                    <span class="p-name fn">Ross McIlroy</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="56102">
                    <a class="u-url url p-name fn" href="https://www.igvita.com/">Ilya Grigorik</a> (<a
                        class="p-org org h-org" href="https://google.com/">Google Inc.</a>)
                </dd>

                <dt>反馈：</dt>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/">GitHub w3c/requestidlecallback</a>
                    (<a href="https://github.com/w3c/requestidlecallback/pulls/">拉取请求</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/new/choose">新建议题</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/">打开的议题</a>)
                </dd>


            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2025

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>


    <section id="abstract" class="introductory">
        <h2>摘要</h2>
        <p>本文档定义了一个 API，网页作者可用来协作调度后台任务，从而不会对同一事件循环中的其他高优先级任务（如输入处理、动画和帧合成）造成延迟。用户代理基于其对当前已调度任务、vsync
            截止时间、用户交互等信息的了解，能够更好地判断何时可以运行后台任务而不引入用户可感知的延迟或动画/输入卡顿。因此，使用该 API 应能实现更合理的后台任务调度，使其在浏览器本应处于空闲的时机进行。</p>
    </section>
    <section id="sotd" class="introductory">
        <h2>本文档状态</h2>
        <p><em>本节介绍本文档在发布时的状态。当前 <abbr title="World Wide Web Consortium">W3C</abbr>
                公开的文档及本技术报告的最新版本，可在
                <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> 标准与草案索引</a>
                查阅，网址为 https://www.w3.org/TR/。</em></p>
        <p>Web 性能工作组为本规范维护了一套 <a href="https://w3c-test.org/requestidlecallback/">测试套件</a>。详情见工作组的 <a
                href="http://wpt.fyi/requestidlecallback">实现报告</a>。有意实现本规范的厂商 <em class="rfc2119">应</em> 加入以下邮件列表并参与讨论。
        </p>
        <p>
            本文档由 <a href="https://www.w3.org/groups/wg/webperf">Web 性能工作组</a> 作为工作草案，采用
            <a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">推荐规范流程</a> 发布。
        </p>
        <p>作为工作草案发布并不代表 <abbr title="World Wide Web Consortium">W3C</abbr> 及其成员的背书。</p>
        <p>
            本文件为草案，可能随时被更新、替换或废弃。除了作为在研工作外，不应引用本文档。

        </p>
        <p>

            本文档由遵循
            <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                专利政策</a>的
            团队制定。

            <abbr title="World Wide Web Consortium">W3C</abbr> 维护了
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webperf/ipr">公开专利披露列表</a>
            ，涵盖本工作组相关成果；该页面也包含专利披露说明。任何知悉自身拥有的专利包含
            <a href="https://www.w3.org/policies/patent-policy/#def-essential">必要权利要求</a>
            的个人，必须依据
            <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">《<abbr
                    title="World Wide Web Consortium">W3C</abbr> 专利政策》第6节</a>
            披露相关信息。

        </p>
        <p>
            本文件受
            <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">2023年11月3日版《<abbr
                    title="World Wide Web Consortium">W3C</abbr> 流程文件》</a> 管辖。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目录</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">摘要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">本文档状态</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>简介</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#idle-periods"><bdi class="secno">2. </bdi>空闲期</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">3. </bdi>一致性</a></li>
            <li class="tocline"><a class="tocxref" href="#window_extensions"><bdi class="secno">4. </bdi><span
                        data-xref-type="_IDL_" data-link-type="interface" data-lt="Window" data-cite="html"
                        data-cite-path="/nav-history-apis.html" data-cite-frag="window"
                        class="formerLink"><code>Window</code></span> 接口扩展</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#the-requestidlecallback-method"><bdi class="secno">4.1
                            </bdi><span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                                data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                                data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"><code>requestIdleCallback()</code></span>
                            方法</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-cancelidlecallback-method"><bdi class="secno">4.2
                            </bdi><span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                                data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                                data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"><code>cancelIdleCallback()</code></span>
                            方法</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-idledeadline-interface"><bdi class="secno">4.3
                            </bdi><span data-export="" data-dfn-type="interface" data-idl="interface"
                                data-title="IdleDeadline" data-dfn-for=""><code>IdleDeadline</code></span> 接口</a>
                    </li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#processing"><bdi class="secno">5. </bdi>处理过程</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#start-an-idle-period-algorithm"><bdi class="secno">5.1
                            </bdi>启动空闲期算法</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callbacks-algorithm"><bdi
                                class="secno">5.2 </bdi>调用空闲回调算法</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callback-timeout-algorithm"><bdi
                                class="secno">5.3 </bdi>调用空闲回调超时算法</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#privacy-considerations"><bdi class="secno">6. </bdi>隐私注意事项</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">7.
                    </bdi>安全性注意事项</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A.
                    </bdi>致谢</a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>规范性参考文献</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>资料性参考文献</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section class="informative" id="introduction">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>介绍</h2><a class="self-link" href="#introduction"
                aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>本节为非规范性内容。</em></p>

        <p>网页通常希望在浏览器的事件循环中执行一些非关键的计算任务，但这些任务可能会占用较多时间。此类后台任务的例子包括记录分析数据、长时间的数据处理操作、客户端模板渲染以及对即将可见内容的预渲染。这些任务必须与其他时效性要求高的操作（如对输入的响应和基于脚本的动画）共享事件循环，例如通过<a
                data-link-type="method" data-lt="requestAnimationFrame()"
                href="https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#dom-animationframeprovider-requestanimationframe"><code>requestAnimationFrame</code></a><code>()</code>实现的动画。这些后台任务通常通过<a
                data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>来调度回调，在该时机内执行后台任务。
        </p>
        <p>这种做法的一个缺点是，脚本作者无法告知用户代理某个<a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>回调是否为关键任务，还是可以推迟到浏览器空闲时执行。此外，用户代理也无法向回调提供关于它可以执行多长时间而不会延迟关键操作或造成动画、输入卡顿等用户可感知延迟的信息。因此，开发者通常的做法只是用一个很小的值调用<a
                data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>，并在回调中执行最少的工作量，然后再次用<a
                data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>调度后续工作。这种方法效率不高，因为为用户代理的事件循环频繁添加小任务会产生额外开销，并且依赖于用户代理在这些回调间穿插时效性工作，但由于用户代理无法准确预估每个回调的耗时，因此协调的难度较大。
        </p>
        <p>本文档描述的 API 允许脚本作者请求用户代理在空闲时调度回调。用户代理会为回调传递一个截止时间，指示其预计还能保持空闲状态多久。页面作者可以利用截止时间确保这些后台任务不会影响对动画和输入等时延敏感事件的响应。
        </p>
        <p>下面是使用该 API 实现后台任务的示例。</p>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">示例<bdi> 1</bdi></a>
            </div>
            <pre class="highlight"
                aria-busy="false"><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>使用 requestIdleCallback 调度后台任务<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
<span class="hljs-keyword">var</span> requestId = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsTotal = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsInside = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">piStep</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">var</span> r = <span class="hljs-number">10</span>;
  <span class="hljs-keyword">var</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">var</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(x, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(y, <span class="hljs-number">2</span>) &lt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(r, <span class="hljs-number">2</span>))
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">refinePi</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">piStep</span>())
      pointsInside++;
    pointsTotal++;
  }
  currentEstimate = (<span class="hljs-number">4</span> <span class="hljs-string">`*`</span> pointsInside / pointsTotal);
  textElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"piEstimate"</span>);
  textElement.<span class="hljs-property">innerHTML</span>=<span class="hljs-string">"圆周率估算: "</span> + currentEstimate;
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (requestId)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">cancelIdleCallback</span>(requestId);
  requestId = <span class="hljs-number">0</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"start()"</span>&gt;</span>点击我开始！<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stop()"</span>&gt;</span>点击我停止！<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"piEstimate"</span>&gt;</span>未开始<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
        </div>
    </section>
    <section class="informative" id="idle-periods">
        <div class="header-wrapper">
            <h2 id="x2-idle-periods"><bdi class="secno">2. </bdi>空闲期</h2><a class="self-link" href="#idle-periods"
                aria-label="Permalink for Section 2."></a>
        </div>
        <p><em>本节为非规范性内容。</em></p>

        <p>在某一帧的输入处理、渲染和合成完成后，用户代理的主线程通常会处于空闲状态，直到下一个帧开始、其他待执行任务达到可运行状态或收到用户输入。该规范提供了一种方式，可通过<a data-link-type="idl"
                data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-1"><code>requestIdleCallback</code></a><code>()</code> API
            在这些本应空闲的时间段调度回调执行。
        </p>
        <p>通过<a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-2"><code>requestIdleCallback</code></a><code>()</code> API
            注册的回调，将在用户代理定义的空闲期内变为可运行状态。运行空闲回调时会传递一个对应当前空闲周期结束时间的截止时间。什么构成空闲期由用户代理定义，但预期这些时间段是浏览器判断为将保持空闲的期间。</p>
        <p>空闲期的一个例子是活跃动画期间将某一帧提交到屏幕后到下一个帧开始处理之间的间隔，如<a href="#figure1" class="fig-ref"
                title="Example of an inter-frame idle period">图 <bdi
                    class="">1</bdi></a>所示。活跃动画和屏幕刷新期间，这样的空闲期会频繁出现，但通常非常短（例如在 60Hz vsync 设备上小于 16 毫秒）。</p>

        <figure id="figure1">
            <img alt="Example of an inter-frame idle period."
                src="https://www.w3.org/TR/requestidlecallback/images/image01.png">
            <figcaption><a class="self-link" href="#figure1">图 <bdi class="figno">1</bdi></a> <span class="fig-title">
                    帧间空闲期示例
                </span></figcaption>
        </figure>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>注意</span></div>
            <p class="">Web 开发者应注意统计空闲回调期间所有操作的整体工作量。一些操作（如解析 promise
                或触发页面布局）可能会导致回调结束后调度后续任务。在这种情况下，应用应在截止前主动让出，确保这些额外操作可在下一个帧截止前被执行。</p>
        </div>
        <p>另一种空闲期的例子是当用户代理处于空闲且没有屏幕刷新时。在这种情况下，用户代理可能没有即将到来的任务可以界定空闲周期的终止。为了避免在处理用户输入等不可预测任务时造成可感知的延迟，该类空闲周期的时长应被上限限制为<a
                href="#why50">50毫秒</a>。一旦空闲期结束，在用户代理继续空闲时，可以再次安排新的空闲期，如<a href="#figure2" class="fig-ref"
                title="Example of an idle period when there are no pending frame updates">图 <bdi
                    class="">2</bdi></a>所示，使后台工作能在较长空闲阶段持续进行。</p>


        <figure id="figure2">
            <img alt="Example of an idle period when there are no pending frame updates."
                src="https://www.w3.org/TR/requestidlecallback/images/image00.png">
            <figcaption><a class="self-link" href="#figure2">图 <bdi class="figno">2</bdi></a> <span class="fig-title">
                    没有待处理帧更新时的空闲期示例
                </span></figcaption>
        </figure>
        <p>在一个空闲周期内，用户代理会以FIFO顺序执行空闲回调，直到空闲期结束或没有剩余可运行回调为止。因此，用户代理并不保证在单个空闲周期内会全部执行当前已登记的空闲回调。剩余的空闲任务将在下一个空闲周期变为可运行状态。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-0">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>注意</span></div>
            <p class="">为获得最佳性能，建议开发者移除无意义的回调（如 requestAnimationFrame、setTimeout
                等），不要让这类回调持续触发并等待事件响应，而是在事件实际到来时再调度。这种模式能提升整体效率，同时让用户代理有机会安排最长达50毫秒的长空闲回调，从而高效地执行大块后台任务。</p>
        </div>
        <p>仅在当前空闲周期开始前登记的空闲任务，才有资格在该周期内运行。因此，如果空闲回调期间又注册了另一个<a data-link-type="idl" data-lt="requestIdleCallback()"
                href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-3"><code>requestIdleCallback</code></a><code>()</code>回调，这个后注册的回调不会在当前空闲周期被执行。这样，空闲回调可在无法在截止前完成任务时，重新登记自身以便在下一个空闲周期继续运行——即便于实现如下示例中的代码模式，而不会因为空闲周期太短导致多次重复执行：
        </p>
        <div class="example" id="example-2">
            <div class="marker">
                <a class="self-link" href="#example-2">示例<bdi> 2</bdi></a>
            </div>
            <pre class="highlight" aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">doWork</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">if</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &lt;= <span class="hljs-number">5</span>) {
    <span class="hljs-comment">// 这个任务超过5ms，所以等待我们</span>
    <span class="hljs-comment">// 被分配到足够长的空闲周期时再执行。</span>
    <span class="hljs-title function_">requestIdleCallback</span>(doWork);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// 执行工作……</span>
}</code></pre>
        </div>
        <p>下一个空闲周期开始时，新登记的空闲回调会被追加到可运行回调队列末尾，从而确保重新登记的回调以轮询形式被执行——先前任务的回调重新登记前，其他回调也能获得运行机会。</p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>注意</span></div>
            <p class="">
                本规范的未来版本可能允许其它调度策略。例如，在同一空闲周期内调度回调、调度到存在至少<var>X</var>毫秒空闲时间的周期等等。目前规范仅支持调度到下一个空闲周期，届时回调可执行逻辑或再次重新登记到下一空闲周期。
            </p>
        </div>
        <p>当用户代理判断网页处于非用户可见状态时，可以限制空闲周期以降低设备能耗，例如只每10秒触发一次空闲周期而非持续触发。</p>
        <p>需要注意的是，在页面负载较高时用户代理未必能分配任何空闲CPU时间。因此，用户代理不调度任何空闲期完全是合理的，结果是通过<a data-link-type="idl"
                data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-4"><code>requestIdleCallback</code></a><code>()</code>API登记的回调可能会无限期延后。对于希望优先使用空闲期、但又希望限定最长等待时间的开发者，可以在<a
                data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-5"><code>requestIdleCallback</code></a><code>()</code>的<code>options</code>参数提供<code>timeout</code>属性；如果在指定超时前没运行回调，则会将其入队执行。
        </p>
        <div class="note" role="note" id="why50">
            <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>注意</span></div>
            <p class="">50毫秒的最大截止时间来源于相关研究 [<cite><a class="bibref" data-link-type="biblio" href="#bib-responsetime"
                        title="Response time in man-computer conversational transactions">RESPONSETIME</a></cite>]，结果显示人类大多会认为100毫秒内响应为瞬时反馈。将空闲回调截止时间限制为50毫秒，即使用户输入刚好在空闲任务开始后发生，用户代理仍有50毫秒响应时间，不会让用户感觉到滞后。
            </p>
        </div>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x3-conformance"><bdi class="secno">3. </bdi>一致性</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 3."></a>
        </div>
        <p>如同标注为“非规范性”的段落，本规范中的所有作者指引、图示、示例和注释均为非规范性内容。规范中的其他内容为规范性条款。</p>
        <p>
            本文档中的关键词 <em class="rfc2119">MUST</em>、<em class="rfc2119">REQUIRED</em>、<em class="rfc2119">SHALL</em>、及
            <em class="rfc2119">SHOULD</em>
            应按<a href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119"
                    title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a
                    class="bibref" data-link-type="biblio" href="#bib-rfc8174"
                    title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
            中说明解释，仅在以本样式全大写出现时，按上述定义解释。
        </p>
        <p>本规范中的 IDL 片段<em class="rfc2119">MUST</em>被解释为符合规范的IDL片段所要求的内容。</p>
        <p>本规范定义了单一一致性类别：</p>
        <dl>
            <dt>一致性用户代理</dt>
            <dd>
                只要用户代理满足本规范所有<em class="rfc2119">MUST</em>、<em class="rfc2119">REQUIRED</em>、<em
                    class="rfc2119">SHALL</em>级别的标准，即被视为一致性用户代理。一致性用户代理还必须是<a data-link-type="dfn"
                    href="https://webidl.spec.whatwg.org/#dfn-conforming-implementation">一致性实现</a>，即第<a
                    href="#window_extensions" class="sec-ref"><bdi class="secno">4.
                    </bdi><span><code>Window</code></span>接口扩展</a>节中的IDL片段。
            </dd>
        </dl>
    </section>
    <section id="window_extensions">
        <div class="header-wrapper">
            <h2 id="x4-window-interface-extensions"><bdi class="secno">4. </bdi><a data-link-type="interface"
                    data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                接口扩展</h2><a class="self-link" href="#window_extensions" aria-label="Permalink for Section 4."></a>
        </div>

        <p>下方 IDL 片段中的 partial interface 用于在
            <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
            对象上暴露
            <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-6"><code>requestIdleCallback</code></a><code>()</code> 操作。
        </p>
        <pre class="idl def"
            id="webidl-1323139649"><span class="idlHeader"><a class="self-link" href="#webidl-1323139649">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-window-partial-1" data-title="Window">partial interface <a data-idl="partial" data-link-type="interface" data-title="Window" class="idlID" data-dfn-for="Window" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">Window</a> {<span data-idl="" class="idlMethod" id="idl-def-window-requestidlecallback-callback-options" data-title="requestIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback-7"><code>requestIdleCallback</code></a>(<span class="idlType"><a data-link-type="idl" href="#dom-idlerequestcallback" class="internalDFN" id="ref-for-dom-idlerequestcallback-1"><code>IdleRequestCallback</code></a></span> <span class="idlParamName">callback</span>, optional<span class="idlType"> <a data-link-type="idl" href="#dom-idlerequestoptions" class="internalDFN" id="ref-for-dom-idlerequestoptions-1"><code>IdleRequestOptions</code></a></span> <span class="idlParamName">options</span> = {});</span><span data-idl="" class="idlMethod" id="idl-def-window-cancelidlecallback-handle" data-title="cancelIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-cancelidlecallback" id="ref-for-dom-window-cancelidlecallback-1"><code>cancelIdleCallback</code></a>(<span class="idlType"><a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">handle</span>);</span>
};</span><span data-idl="" class="idlDictionary" id="idl-def-idlerequestoptions" data-title="IdleRequestOptions">

dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-idlerequestoptions" id="ref-for-dom-idlerequestoptions-2"><code>IdleRequestOptions</code></a> {<span data-idl="" class="idlMember" id="idl-def-idlerequestoptions-timeout" data-title="timeout" data-dfn-for="IdleRequestOptions"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-idlerequestoptions-timeout" id="ref-for-dom-idlerequestoptions-timeout-1"><code>timeout</code></a>;</span>
};</span><span data-idl="" class="idlInterface" id="idl-def-idledeadline" data-title="IdleDeadline">

[<span class="extAttr"><a data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>] interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-idledeadline" id="ref-for-dom-idledeadline-1"><code>IdleDeadline</code></a> {<span data-idl="" class="idlMethod" id="idl-def-idledeadline-timeremaining" data-title="timeRemaining" data-dfn-for="IdleDeadline"><span class="idlType">
  <a data-link-type="typedef" href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp">DOMHighResTimeStamp</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-idledeadline-timeremaining" id="ref-for-dom-idledeadline-timeremaining-1"><code>timeRemaining</code></a>();</span><span data-idl="" class="idlAttribute" id="idl-def-idledeadline-didtimeout" data-title="didTimeout" data-dfn-for="IdleDeadline">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-idledeadline-didtimeout" id="ref-for-dom-idledeadline-didtimeout-1"><code>didTimeout</code></a>;</span>
};</span><span data-idl="" class="idlCallback" id="idl-def-idlerequestcallback" data-title="IdleRequestCallback">

callback <a class="internalDFN idlID" data-link-type="callback" href="#dom-idlerequestcallback" id="ref-for-dom-idlerequestcallback-2"><code>IdleRequestCallback</code></a> =<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> (<span class="idlType"><a data-link-type="idl" href="#dom-idledeadline" class="internalDFN" id="ref-for-dom-idledeadline-2"><code>IdleDeadline</code></a></span> <span class="idlParamName">deadline</span>);</span></code></pre>
        <p>每个 <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a> 都有：
        </p>
        <ul>
            <li>一个<dfn id="dfn-list-of-idle-request-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">空闲请求回调列表</dfn>。该列表<em class="rfc2119">必须</em>初始为空，且其中每个条目都通过一个编号标识，该编号在该<a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>对象的生命周期内<em
                    class="rfc2119">必须</em>唯一。
            </li>
            <li>一个<dfn id="dfn-list-of-runnable-idle-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">可运行空闲回调列表</dfn>。该列表<em class="rfc2119">必须</em>初始为空，且其中每个条目都通过一个编号标识，该编号在该<a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>对象的生命周期内<em
                    class="rfc2119">必须</em>唯一。
            </li>
            <li>一个<dfn id="dfn-idle-callback-identifier" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">空闲回调标识符</dfn>，其为数字，<em class="rfc2119">必须</em>初始为零。
            </li>
        </ul>
        <section data-dfn-for="Window" id="the-requestidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-1-the-requestidlecallback-method"><bdi class="secno">4.1 </bdi><dfn data-export=""
                        data-dfn-type="method" id="dom-window-requestidlecallback" data-idl="operation"
                        data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                        data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                        data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>requestIdleCallback()</code></dfn> 方法</h3><a
                    class="self-link" href="#the-requestidlecallback-method" aria-label="Permalink for Section 4.1"></a>
            </div>

            <p>当以指定的<dfn data-export="" data-dfn-type="callback" id="dom-idlerequestcallback" data-idl="callback"
                    data-title="IdleRequestCallback" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestCallback</code></dfn>
                及可选<dfn data-export="" data-dfn-type="dictionary" id="dom-idlerequestoptions" data-idl="dictionary"
                    data-title="IdleRequestOptions" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestOptions</code></dfn> 调用
                <a data-link-type="idl" href="#dom-window-requestidlecallback" class="internalDFN"
                    id="ref-for-dom-window-requestidlecallback-8"><code>requestIdleCallback</code></a><code>(<var>callback</var>, <var>options</var>)</code>
                时，用户代理<em class="rfc2119">必须</em>执行如下步骤：
            </p>
            <ol>
                <li>令<var>window</var>为当前的<a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    对象。</li>
                <li>将<var>window</var>的<a href="#dfn-idle-callback-identifier" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-callback-identifier-1">空闲回调标识符</a>加一。
                </li>
                <li>令<var>handle</var>为<var>window</var>当前的<a href="#dfn-idle-callback-identifier" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-idle-callback-identifier-2">空闲回调标识符</a>值。
                </li>
                <li>将<var>callback</var>以<var>handle</var>进行关联，并推送到<var>window</var>的<a
                        href="#dfn-list-of-idle-request-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-1">空闲请求回调列表</a>末尾。
                </li>
                <li>返回<var>handle</var>，然后异步继续运行本算法。
                    <div class="note" role="note" id="issue-container-generatedID-2">
                        <div role="heading" class="note-title marker" id="h-note-3" aria-level="4"><span>注意</span>
                        </div>
                        <p class="">
                            下述步骤会并行运行，并在指定<code>timeout</code>属性时，排队一个类似<code>setTimeout()</code>的定时器。从此，空闲回调与超时回调将互相竞争并彼此取消——例如若空闲回调先被调度，则取消超时，反之亦然。
                        </p>
                    </div>
                </li>
                <li>若<var>options</var>中存在<code><dfn data-dfn-for="IdleRequestOptions" data-export="" data-dfn-type="dict-member" id="dom-idlerequestoptions-timeout" data-idl="field" data-title="timeout" data-type="unsigned long" tabindex="0" aria-haspopup="dialog">timeout</dfn>
        </code>属性且为正值：
                    <ol>
                        <li>等待<var>timeout</var>毫秒。</li>
                        <li>等待本算法所有<var>timeout</var>加上其发起时间先于当前请求的实例均已完成。</li>
                        <li>可选：再等待一段用户代理自定义的时长。
                            <div class="note" role="note" id="issue-container-generatedID-3">
                                <div role="heading" class="note-title marker" id="h-note-4" aria-level="4">
                                    <span>注意</span>
                                </div>
                                <p class="">
                                    此举意在允许用户代理按需对超时进行填充，以优化设备的功耗。例如某些处理器存在低功耗模式，定时器粒度降低；在此类平台上，用户代理可以降低定时器速率，无须一直维持高精度，从而节省耗电。
                                </p>
                            </div>
                        </li>
                        <li>在与 idle-task 任务源关联的队列中
                            <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">排队一个任务</a>，该任务执行<a
                                href="#dfn-invoke-idle-callback-timeout-algorithm" class="internalDFN"
                                data-link-type="dfn"
                                id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-1">调用空闲回调超时算法</a>，传递<var>handle</var>和<var>window</var>为参数。
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-4">
                <div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>注意</span></div>
                <p class=""><a data-link-type="idl" data-lt="requestIdleCallback()"
                        href="#dom-window-requestidlecallback" class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-9"><code>requestIdleCallback</code></a><code>()</code>
                    仅调度单个回调，并在单个<a href="#dfn-idle-period" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-period-1">空闲周期</a>执行。如果回调未能在指定<var>deadline</var>前完成其工作，则应再次调用<a
                        data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-10"><code>requestIdleCallback</code></a><code>()</code>（可在回调中发起），以调度新的后续回调，并立即退出以将控制权归还<a
                        data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">事件循环</a>。
                </p>
            </div>
        </section>
        <section data-dfn-for="Window" id="the-cancelidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-2-the-cancelidlecallback-method"><bdi class="secno">4.2 </bdi><dfn data-export=""
                        data-dfn-type="method" id="dom-window-cancelidlecallback" data-idl="operation"
                        data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                        data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                        data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>cancelIdleCallback()</code></dfn> 方法</h3><a
                    class="self-link" href="#the-cancelidlecallback-method" aria-label="Permalink for Section 4.2"></a>
            </div>

            <p><a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                    class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-2"><code>cancelIdleCallback</code></a><code>()</code>
                方法用于取消此前登记的空闲回调。当调用
                <a data-link-type="idl" href="#dom-window-cancelidlecallback" class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-3"><code>cancelIdleCallback</code></a><code>(<var>handle</var>)</code>
                时，用户代理<em class="rfc2119">必须</em>执行如下步骤：
            </p>
            <ol>
                <li>令<var>window</var>为当前<a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    对象。</li>
                <li>在<var>window</var>的<a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-2">空闲请求回调列表</a>
                    或<a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-1">可运行空闲回调列表</a>
                    中查找与<var>handle</var>相关联的条目。
                </li>
                <li>若存在该条目，则从<var>window</var>的<a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-3">空闲请求回调列表</a>和<a
                        href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-2">可运行空闲回调列表</a>中均移除此条目。
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-5">
                <div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>注意</span></div>
                <p class=""><a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-cancelidlecallback-4"><code>cancelIdleCallback</code></a><code>()</code>
                    可能针对<var>window</var>的<a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-4">空闲请求回调列表</a>
                    或<a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-3">可运行空闲回调列表</a>中的一个条目被调用。无论哪种情况，该条目都应被移除，使回调不会被执行。
                </p>
            </div>
        </section>
        <section data-dfn-for="IdleDeadline" id="the-idledeadline-interface">
            <div class="header-wrapper">
                <h3 id="x4-3-the-idledeadline-interface"><bdi class="secno">4.3 </bdi><dfn data-export=""
                        data-dfn-type="interface" id="dom-idledeadline" data-idl="interface" data-title="IdleDeadline"
                        data-dfn-for="" tabindex="0" aria-haspopup="dialog"><code>IdleDeadline</code></dfn> 接口
                </h3><a class="self-link" href="#the-idledeadline-interface" aria-label="Permalink for Section 4.3"></a>
            </div>

            <p>每个<a data-link-type="idl" data-lt="IdleDeadline" href="#dom-idledeadline" class="internalDFN"
                    id="ref-for-dom-idledeadline-3"><code>IdleDeadline</code></a>都有一个关联的<dfn id="dfn-get-deadline-time"
                    tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">获取截止时间</dfn>
                算法，返回<a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                ，表示该截止时间的绝对毫秒时间。截止时间初始为零。
            </p>
            <p>在<a href="#dom-idledeadline" class="internalDFN" data-link-type="idl" id="ref-for-dom-idledeadline-4">
                    <code>IdleDeadline</code></a>对象上调用<dfn data-export="" data-dfn-type="method"
                    id="dom-idledeadline-timeremaining" data-idl="operation" data-title="timeRemaining()"
                    data-dfn-for="IdleDeadline" data-type="DOMHighResTimeStamp" data-lt="timeRemaining()"
                    data-local-lt="IdleDeadline.timeRemaining|IdleDeadline.timeRemaining()|timeRemaining" tabindex="0"
                    aria-haspopup="dialog"><code>timeRemaining()</code></dfn> 方法时，<em
                    class="rfc2119">必须</em>返回截止前剩余时长，类型为<a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>；该值<em
                    class="rfc2119">应</em>能满足测量需求同时避免计时攻击——详见 [<cite><a class="bibref" data-link-type="biblio"
                        href="#bib-hr-time" title="High Resolution Time">HR-TIME</a></cite>] 的“隐私与安全”章节。其值按以下步骤计算：
            </p>
            <ol>
                <li>令<var>now</var>为<a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                        href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>，表示当前高精度时间（毫秒）。
                </li>
                <li>令<var>deadline</var>为调用<a data-link-type="idl" data-lt="IdleDeadline" href="#dom-idledeadline"
                        class="internalDFN" id="ref-for-dom-idledeadline-5"><code>IdleDeadline</code></a>的<a
                        href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-get-deadline-time-1">获取截止时间</a>算法的结果。</li>
                <li>令<var>timeRemaining</var>为<var>deadline</var>减<var>now</var>。</li>
                <li>如<var>timeRemaining</var>为负，则置为0。</li>
                <li>返回<var>timeRemaining</var>。</li>
            </ol>
            <p>每个<a href="#dom-idledeadline" class="internalDFN" data-link-type="idl" id="ref-for-dom-idledeadline-6">
                    <code>IdleDeadline</code></a>都有关联的<dfn id="dfn-timeout" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">超时标记</dfn>，其初始值为 false。
                <code><dfn data-export="" data-dfn-type="attribute" id="dom-idledeadline-didtimeout" data-idl="attribute" data-title="didTimeout" data-dfn-for="IdleDeadline" data-type="boolean" data-lt="didTimeout" data-local-lt="IdleDeadline.didTimeout" tabindex="0" aria-haspopup="dialog">didTimeout</dfn></code>
                getter <em class="rfc2119">必须</em>
                返回<a href="#dfn-timeout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-timeout-1">
                    超时标记</a>的值。
            </p>
            <div class="note" role="note" id="issue-container-generatedID-6">
                <div role="heading" class="note-title marker" id="h-note-7" aria-level="4"><span>注意</span></div>
                <p class=""> <a href="#dfn-invoke-idle-callback-timeout-algorithm" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-2">调用空闲回调超时算法</a>
                    将<a href="#dfn-timeout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-timeout-2">
                        超时标记</a>设为 true，以表明该回调因超过登记时提供的
                    <a href="#dom-idlerequestoptions" class="internalDFN" data-link-type="idl"
                        id="ref-for-dom-idlerequestoptions-3"><code>IdleRequestOptions</code></a>的 timeout
                    属性而在非空闲周期执行。
                </p>
            </div>
        </section>
    </section>
    <section id="processing">
        <div class="header-wrapper">
            <h2 id="x5-processing"><bdi class="secno">5. </bdi>处理过程</h2><a class="self-link" href="#processing"
                aria-label="Permalink for Section 5."></a>
        </div>

        <section id="start-an-idle-period-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-1-start-an-idle-period-algorithm"><bdi class="secno">5.1 </bdi>启动空闲期算法
                </h3><a class="self-link" href="#start-an-idle-period-algorithm"
                    aria-label="Permalink for Section 5.1"></a>
            </div>

            <p>为 <a data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> 和
                <var>getDeadline</var>（一个返回 <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                的算法）<dfn class="export" data-export="" id="dfn-start-an-idle-period" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">启动空闲期</dfn>：

            </p>
            <div class="note" role="note" id="issue-container-generatedID-7">
                <div role="heading" class="note-title marker" id="h-note-8" aria-level="4"><span>注意</span></div>
                <p class="">该算法由 <a
                        href="https://html.spec.whatwg.org/multipage/#event-loop-processing-model">事件循环处理模型</a>
                    判断 <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">事件循环</a> 处于空闲时调用。</p>
            </div>

            <ol>
                <li>用户代理可选地认为空闲期应当延迟时，直接返回本算法。
                    <div class="note" role="note" id="issue-container-generatedID-8">
                        <div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>注意</span>
                        </div>
                        <p class="" data-cite="page-visibility-2">为允许用户代理根据需要延迟空闲期的启动以优化设备电源。例如，若 <a
                                data-link-type="interface" data-lt="Document"
                                href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> 的 <a
                                data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/interaction.html#visibility-state">visibility
                                state</a> 为 "hidden" ，则用户代理可限制空闲期的生成，例如每 10 秒 1 次以优化电源消耗。</p>
                    </div>
                </li>
                <li>令 <var>pending_list</var> 为 <var>window</var> 的 <a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-5">空闲请求回调列表</a>。
                </li>
                <li>令 <var>run_list</var> 为 <var>window</var> 的 <a href="#dfn-list-of-runnable-idle-callbacks"
                        class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-4">可运行空闲回调列表</a>。
                </li>
                <li>将 <var>pending_list</var> 中所有条目按顺序追加到 <var>run_list</var> 末尾。
                </li>
                <li>清空 <var>pending_list</var>。</li>
                <li>在与 idle-task
                    <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">任务源</a> 关联的队列中
                    <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">排队一个任务</a>，该任务执行
                    <a href="#dfn-invoke-idle-callbacks-algorithm" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-invoke-idle-callbacks-algorithm-1">调用空闲回调算法</a>，参数为 <var>window</var> 和
                    <var>getDeadline</var>。
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-9">
                <div role="heading" class="note-title marker" id="h-note-10" aria-level="4"><span>注意</span></div>
                <div class="">
                    <p>当���时刻到截止时间的这段时间称为 <dfn id="dfn-idle-period" tabindex="0" aria-haspopup="dialog"
                            data-dfn-type="dfn">空闲期</dfn>。对于任意 <a data-link-type="interface" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>，同一时刻仅有一个空闲期处于激活状态。若用户代理判断不再空闲则空闲期可提前结束，此时新空闲期需等待到达
                        <var>deadline</var> 后才能重新开始。
                    </p>
                </div>
            </div>
        </section>
        <section id="invoke-idle-callbacks-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-2-invoke-idle-callbacks-algorithm"><bdi class="secno">5.2 </bdi>调用空闲回调算法</h3><a
                    class="self-link" href="#invoke-idle-callbacks-algorithm"
                    aria-label="Permalink for Section 5.2"></a>
            </div>

            <p>为 <a data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> 和
                <var>getDeadline</var>（返回 <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                的算法），<dfn id="dfn-invoke-idle-callbacks-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">调用空闲回调算法</dfn>：
            </p>
            <ol>
                <li>若用户代理因新调度的高优先级工作判断应提前结束空闲期，则直接返回本算法。
                </li>
                <li>令 <var>now</var> 为当前时间。</li>
                <li>若 <var>now</var> 小于 <var>getDeadline</var> 的结果，且 <var>window</var> 的 <a
                        href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-5">可运行空闲回调列表</a> 非空：
                    <ol>
                        <li>从 <var>window</var> 的 <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                                data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-6">可运行空闲回调列表</a>
                            弹出最上方的 <var>callback</var>。
                        </li>
                        <li>令 <var>deadlineArg</var> 为新建 <a href="#dom-idledeadline" class="internalDFN"
                                data-link-type="idl" id="ref-for-dom-idledeadline-7"><code>IdleDeadline</code></a>，其 <a
                                href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-2">获取截止时间</a>算法为 <var>getDeadline</var>。
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">调用</a>
                            <var>callback</var>，传递 « <var>deadlineArg</var> » 和 "<code>report</code>"。
                        </li>
                        <li>若 <var>window</var> 的 <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                                data-link-type="dfn" id="ref-for-dfn-list-of-runnable-idle-callbacks-7">可运行空闲回调列表</a>
                            非空，则 <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">排队一个任务</a>，执行本
                            <a href="#dfn-invoke-idle-callbacks-algorithm" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-invoke-idle-callbacks-algorithm-2">调用空闲回调算法</a>，参数为
                            <var>getDeadline</var> 和 <var>window</var>，并返回本算法
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-10">
                <div role="heading" class="note-title marker" id="h-note-11" aria-level="4"><span>注意</span></div>
                <p class="">即使 <var>deadline</var> 未到，用户代理也可在第 1 步直接返回以提前终止空闲期。例如判断更高优先级的任务已可运行时。</p>
            </div>
        </section>
        <section id="invoke-idle-callback-timeout-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-3-invoke-idle-callback-timeout-algorithm"><bdi class="secno">5.3 </bdi>调用空闲回调超时算法</h3><a
                    class="self-link" href="#invoke-idle-callback-timeout-algorithm"
                    aria-label="Permalink for Section 5.3"></a>
            </div>

            <p><dfn id="dfn-invoke-idle-callback-timeout-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">调用空闲回调超时算法</dfn>：</p>
            <ol>
                <li>令 <var>callback</var> 为在 <var>
                        window</var> 的 <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-6">空闲请求回调列表</a> 或 <a
                        href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-8">可运行空闲回调列表</a> 中与传递进来的 <var>handle</var>
                    相关联的条目。
                </li>
                <li>若 <var>callback</var> 不为 undefined：
                    <ol>
                        <li>从 <var>window</var> 的 <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                                data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-7">空闲请求回调列表</a> 和 <a
                                href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-9">可运行空闲回调列表</a> 中移除
                            <var>callback</var>。
                        </li>
                        <li>令 <var>now</var> 为当前时间。</li>
                        <li>令 <var>deadlineArg</var> 为新建 <a href="#dom-idledeadline" class="internalDFN"
                                data-link-type="idl" id="ref-for-dom-idledeadline-8"><code>IdleDeadline</code></a>。
                            将 <a href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-3">获取截止时间</a> 算法设为返回 <var>now</var>，并将 <a
                                href="#dfn-timeout" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-timeout-3">超时标记</a> 设为 <code>true</code>。
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">调用</a>
                            <var>callback</var>，传递 « <var>deadlineArg</var> » 和 "<code>report</code>"。
                        </li>
                    </ol>
                </li>
            </ol>
        </section>
    </section>
    <section id="privacy-considerations">
        <div class="header-wrapper">
            <h2 id="x6-privacy-considerations"><bdi class="secno">6. </bdi>隐私注意事项</h2><a class="self-link"
                href="#privacy-considerations" aria-label="Permalink for Section 6."></a>
        </div>

        <p>当调度空闲回调时，用户代理会提供其预期仍将保持空闲的估算时长。该信息可用于估算同一帧内其他应用任务及相关浏览器工作耗时。不过，开发者已可通过其他方式访问此信息——如用
            <code>requestAnimationFrame</code> 标记帧起点，估算下一个帧的时间，并配合该信息计算任意回调内的“剩余时长”。
        </p>
        <p>为减少缓存与统计指纹攻击，通过 <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-idledeadline-9"><code>IdleDeadline</code></a> 接口返回的时间估算分辨率应根据 <a data-link-type="dfn"
                data-lt="coarsen time" href="https://www.w3.org/TR/hr-time-3/#dfn-coarsen-time">时间粗化</a>与 <a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability">跨源隔离能力</a>调整，以确保该
            API 不暴露超出其它 Web 计时器的信息。[<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                    title="High Resolution Time">HR-TIME</a></cite>]
        </p>
    </section>
    <section id="security-considerations">
        <div class="header-wrapper">
            <h2 id="x7-security-considerations"><bdi class="secno">7. </bdi>安全性注意事项</h2><a class="self-link"
                href="#security-considerations" aria-label="Permalink for Section 7."></a>
        </div>

        <p>待补充
        </p>
    </section>
    <section id="acknowledgements" class="appendix">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>致谢</h2><a class="self-link" href="#acknowledgements"
                aria-label="Permalink for Appendix A."></a>
        </div>

        <p>编辑感谢以下人员对本规范的贡献：Sami Kyostila、Alex Clarke、Boris Zbarsky、Marcos Caceres、Jonas Sicking、Robert O'Callahan、David
            Baron、Todd Reifsteck、Tobin Titus、Elliott Sprehn、Tetsuharu OHZEKI、Lon Ingram、Domenic Denicola、Philippe Le
            Hegaret 和 Anne van Kesteren。</p>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>规范性参考文献</h3><a class="self-link"
                    href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-hr-time">[HR-TIME]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/hr-time-3/"><cite>高分辨率时间</cite></a>. Yoav Weiss. W3C. 7
                    November 2024. W3C 工作草案. 网址: <a
                        href="https://www.w3.org/TR/hr-time-3/">https://www.w3.org/TR/hr-time-3/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 标准</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Dominic Farolino; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. 持续更新的标准.
                    网址: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-rfc2119">[RFC2119]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>在 RFC 中用于指示要求级别的关键词</cite></a>. S. Bradner.
                    IETF. March 1997. 最佳当前实践. 网址: <a
                        href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
                </dd>
                <dt id="bib-rfc8174">[RFC8174]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>RFC 2119 关键词中大写与小写的歧义</cite></a>. B. Leiba.
                    IETF. May 2017. 最佳当前实践. 网址: <a
                        href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
                </dd>
                <dt id="bib-webidl">[webidl]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 标准</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. 持续更新的标准. 网址: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>资料性参考文献</h3><a class="self-link"
                    href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM 标准</cite></a>. Anne van Kesteren. WHATWG.
                    持续更新的标准. 网址: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-responsetime">[RESPONSETIME]</dt>
                <dd>
                    <a
                        href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf"><cite>人机对话事务中的响应时间</cite></a>.
                    Robert B. Miller. December
                    1968. Fall Joint Computer Conference. 网址: <a
                        href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf">http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-idle-request-callbacks"
        aria-label="Links in this document to definition: list of idle request callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-idle-request-callbacks"
                aria-label="Permalink for definition: list of idle request callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-1" title="§ 4.1 The requestIdleCallback() method">§
                    4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-2" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-4"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-5" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-6"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-7" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-runnable-idle-callbacks"
        aria-label="Links in this document to definition: list of runnable idle callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-runnable-idle-callbacks"
                aria-label="Permalink for definition: list of runnable idle callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-1" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-3"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-4" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-5" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-6"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-7"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-8"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-9" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-callback-identifier"
        aria-label="Links in this document to definition: idle callback identifier">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-callback-identifier"
                aria-label="Permalink for definition: idle callback identifier. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-callback-identifier-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dfn-idle-callback-identifier-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-requestidlecallback"
        aria-label="Links in this document to definition: requestIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-requestidlecallback"
                aria-label="Permalink for definition: requestIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-1" title="§ 2. Idle Periods">§ 2. Idle Periods</a> <a
                    href="#ref-for-dom-window-requestidlecallback-2" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-5" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-6" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-window-requestidlecallback-7"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-8" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dom-window-requestidlecallback-9"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-requestidlecallback-10"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestcallback"
        aria-label="Links in this document to definition: IdleRequestCallback">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestcallback"
                aria-label="Permalink for definition: IdleRequestCallback. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestcallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestcallback-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions"
        aria-label="Links in this document to definition: IdleRequestOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions"
                aria-label="Permalink for definition: IdleRequestOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestoptions-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-timeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-cancelidlecallback"
        aria-label="Links in this document to definition: cancelIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-cancelidlecallback"
                aria-label="Permalink for definition: cancelIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-2" title="§ 4.2 The cancelIdleCallback() method">§ 4.2
                    The cancelIdleCallback() method</a> <a href="#ref-for-dom-window-cancelidlecallback-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-cancelidlecallback-4"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline"
        aria-label="Links in this document to definition: IdleDeadline">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline"
                aria-label="Permalink for definition: IdleDeadline. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-1" title="§ 4. Window interface extensions">§ 4. Window interface
                    extensions</a> <a href="#ref-for-dom-idledeadline-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dom-idledeadline-4" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-idledeadline-5" title="Reference 3">(3)</a> <a href="#ref-for-dom-idledeadline-6"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-7" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke idle
                    callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-8" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke
                    idle callback timeout algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-9" title="§ 6. Privacy Considerations">§ 6. Privacy
                    Considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-get-deadline-time"
        aria-label="Links in this document to definition: get deadline time">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-get-deadline-time"
                aria-label="Permalink for definition: get deadline time. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-2" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke
                    idle callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3
                    Invoke idle callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-timeremaining"
        aria-label="Links in this document to definition: timeRemaining()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-timeremaining"
                aria-label="Permalink for definition: timeRemaining(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-timeremaining-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-timeout-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dfn-timeout-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-timeout-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle
                    callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-didtimeout"
        aria-label="Links in this document to definition: didTimeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-didtimeout"
                aria-label="Permalink for definition: didTimeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-didtimeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-start-an-idle-period"
        aria-label="Links in this document to definition: start an idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-start-an-idle-period"
                aria-label="Permalink for definition: start an idle period. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-period"
        aria-label="Links in this document to definition: idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-period"
                aria-label="Permalink for definition: idle period. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-period-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1 The
                    requestIdleCallback() method</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callbacks-algorithm"
        aria-label="Links in this document to definition: invoke idle callbacks algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callbacks-algorithm"
                aria-label="Permalink for definition: invoke idle callbacks algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-1" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-2" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callback-timeout-algorithm"
        aria-label="Links in this document to definition: invoke idle callback timeout algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callback-timeout-algorithm"
                aria-label="Permalink for definition: invoke idle callback timeout algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-1"
                    title="§ 4.1 The requestIdleCallback() method">§ 4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-2"
                    title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <script id="respec-highlight-vars">(() => {
            // @ts-check

            if (document.respec) {
                document.respec.ready.then(setupVarHighlighter);
            } else {
                setupVarHighlighter();
            }

            function setupVarHighlighter() {
                document
                    .querySelectorAll("var")
                    .forEach(varElem => varElem.addEventListener("click", highlightListener));
            }

            function highlightListener(ev) {
                ev.stopPropagation();
                const { target: varElem } = ev;
                const hightligtedElems = highlightVars(varElem);
                const resetListener = () => {
                    const hlColor = getHighlightColor(varElem);
                    hightligtedElems.forEach(el => removeHighlight(el, hlColor));
                    [...HL_COLORS.keys()].forEach(key => HL_COLORS.set(key, true));
                };
                if (hightligtedElems.length) {
                    document.body.addEventListener("click", resetListener, { once: true });
                }
            }

            // availability of highlight colors. colors from var.css
            const HL_COLORS = new Map([
                ["respec-hl-c1", true],
                ["respec-hl-c2", true],
                ["respec-hl-c3", true],
                ["respec-hl-c4", true],
                ["respec-hl-c5", true],
                ["respec-hl-c6", true],
                ["respec-hl-c7", true],
            ]);

            function getHighlightColor(target) {
                // return current colors if applicable
                const { value } = target.classList;
                const re = /respec-hl-\w+/;
                const activeClass = re.test(value) && value.match(re);
                if (activeClass) return activeClass[0];

                // first color preference
                if (HL_COLORS.get("respec-hl-c1") === true) return "respec-hl-c1";

                // otherwise get some other available color
                return [...HL_COLORS.keys()].find(c => HL_COLORS.get(c)) || "respec-hl-c1";
            }

            function highlightVars(varElem) {
                const textContent = norm(varElem.textContent);
                const parent = varElem.closest(".algorithm, section");
                const highlightColor = getHighlightColor(varElem);

                const varsToHighlight = [...parent.querySelectorAll("var")].filter(
                    el =>
                        norm(el.textContent) === textContent &&
                        el.closest(".algorithm, section") === parent
                );

                // update availability of highlight color
                const colorStatus = varsToHighlight[0].classList.contains("respec-hl");
                HL_COLORS.set(highlightColor, colorStatus);

                // highlight vars
                if (colorStatus) {
                    varsToHighlight.forEach(el => removeHighlight(el, highlightColor));
                    return [];
                } else {
                    varsToHighlight.forEach(el => addHighlight(el, highlightColor));
                }
                return varsToHighlight;
            }

            function removeHighlight(el, highlightColor) {
                el.classList.remove("respec-hl", highlightColor);
                // clean up empty class attributes so they don't come in export
                if (!el.classList.length) el.removeAttribute("class");
            }

            function addHighlight(elem, highlightColor) {
                elem.classList.add("respec-hl", highlightColor);
            }

            /**
             * Same as `norm` from src/core/utils, but our build process doesn't allow
             * imports in runtime scripts, so duplicated here.
             * @param {string} str
             */
            function norm(str) {
                return str.trim().replace(/\s+/g, " ");
            }
        })()</script>
    <script id="respec-dfn-panel">(() => {
                                               // @ts-check
                                               if (document.respec) {
                                                   document.respec.ready.then(setupPanel);
                                               } else {
                                                   setupPanel();
                                               }

                                               function setupPanel() {
                                                   const listener = panelListener();
                                                   document.body.addEventListener("keydown", listener);
                                                   document.body.addEventListener("click", listener);
                                               }

                                               function panelListener() {
                                                   /** @type {HTMLElement} */
                                                   let panel = null;
                                                   return event => {
                                                       const { target, type } = event;

                                                       if (!(target instanceof HTMLElement)) return;

                                                       // For keys, we only care about Enter key to activate the panel
                                                       // otherwise it's activated via a click.
                                                       if (type === "keydown" && event.key !== "Enter") return;

                                                       const action = deriveAction(event);

                                                       switch (action) {
                                                           case "show": {
                                                               hidePanel(panel);
                                                               /** @type {HTMLElement} */
                                                               const dfn = target.closest("dfn, .index-term");
                                                               panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                                                               const coords = deriveCoordinates(event);
                                                               displayPanel(dfn, panel, coords);
                                                               break;
                                                           }
                                                           case "dock": {
                                                               panel.style.left = null;
                                                               panel.style.top = null;
                                                               panel.classList.add("docked");
                                                               break;
                                                           }
                                                           case "hide": {
                                                               hidePanel(panel);
                                                               panel = null;
                                                               break;
                                                           }
                                                       }
                                                   };
                                               }

                                               /**
                                                * @param {MouseEvent|KeyboardEvent} event
                                                */
                                               function deriveCoordinates(event) {
                                                   const target = /** @type HTMLElement */ (event.target);

                                                   // We prevent synthetic AT clicks from putting
                                                   // the dialog in a weird place. The AT events sometimes
                                                   // lack coordinates, so they have clientX/Y = 0
                                                   const rect = target.getBoundingClientRect();
                                                   if (
                                                       event instanceof MouseEvent &&
                                                       event.clientX >= rect.left &&
                                                       event.clientY >= rect.top
                                                   ) {
                                                       // The event probably happened inside the bounding rect...
                                                       return { x: event.clientX, y: event.clientY };
                                                   }

                                                   // Offset to the middle of the element
                                                   const x = rect.x + rect.width / 2;
                                                   // Placed at the bottom of the element
                                                   const y = rect.y + rect.height;
                                                   return { x, y };
                                               }

                                               /**
                                                * @param {Event} event
                                                */
                                               function deriveAction(event) {
                                                   const target = /** @type {HTMLElement} */ (event.target);
                                                   const hitALink = !!target.closest("a");
                                                   if (target.closest("dfn:not([data-cite]), .index-term")) {
                                                       return hitALink ? "none" : "show";
                                                   }
                                                   if (target.closest(".dfn-panel")) {
                                                       if (hitALink) {
                                                           return target.classList.contains("self-link") ? "hide" : "dock";
                                                       }
                                                       const panel = target.closest(".dfn-panel");
                                                       return panel.classList.contains("docked") ? "hide" : "none";
                                                   }
                                                   if (document.querySelector(".dfn-panel:not([hidden])")) {
                                                       return "hide";
                                                   }
                                                   return "none";
                                               }

                                               /**
                                                * @param {HTMLElement} dfn
                                                * @param {HTMLElement} panel
                                                * @param {{ x: number, y: number }} clickPosition
                                                */
                                               function displayPanel(dfn, panel, { x, y }) {
                                                   panel.hidden = false;
                                                   // distance (px) between edge of panel and the pointing triangle (caret)
                                                   const MARGIN = 20;

                                                   const dfnRects = dfn.getClientRects();
                                                   // Find the `top` offset when the `dfn` can be spread across multiple lines
                                                   let closestTop = 0;
                                                   let minDiff = Infinity;
                                                   for (const rect of dfnRects) {
                                                       const { top, bottom } = rect;
                                                       const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                                                       if (diffFromClickY < minDiff) {
                                                           minDiff = diffFromClickY;
                                                           closestTop = top;
                                                       }
                                                   }

                                                   const top = window.scrollY + closestTop + dfnRects[0].height;
                                                   const left = x - MARGIN;
                                                   panel.style.left = `${left}px`;
                                                   panel.style.top = `${top}px`;

                                                   // Find if the panel is flowing out of the window
                                                   const panelRect = panel.getBoundingClientRect();
                                                   const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                                                   if (panelRect.right > SCREEN_WIDTH) {
                                                       const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                                                       const newCaretOffset = left - newLeft;
                                                       panel.style.left = `${newLeft}px`;
                                                       /** @type {HTMLElement} */
                                                       const caret = panel.querySelector(".caret");
                                                       caret.style.left = `${newCaretOffset}px`;
                                                   }

                                                   // As it's a dialog, we trap focus.
                                                   // TODO: when <dialog> becomes a implemented, we should really
                                                   // use that.
                                                   trapFocus(panel, dfn);
                                               }

                                               /**
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function trapFocus(panel, dfn) {
                                                   /** @type NodeListOf<HTMLAnchorElement> elements */
                                                   const anchors = panel.querySelectorAll("a[href]");
                                                   // No need to trap focus
                                                   if (!anchors.length) return;

                                                   // Move focus to first anchor element
                                                   const first = anchors.item(0);
                                                   first.focus();

                                                   const trapListener = createTrapListener(anchors, panel, dfn);
                                                   panel.addEventListener("keydown", trapListener);

                                                   // Hiding the panel releases the trap
                                                   const mo = new MutationObserver(records => {
                                                       const [record] = records;
                                                       const target = /** @type HTMLElement */ (record.target);
                                                       if (target.hidden) {
                                                           panel.removeEventListener("keydown", trapListener);
                                                           mo.disconnect();
                                                       }
                                                   });
                                                   mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
                                               }

                                               /**
                                                *
                                                * @param {NodeListOf<HTMLAnchorElement>} anchors
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function createTrapListener(anchors, panel, dfn) {
                                                   const lastIndex = anchors.length - 1;
                                                   let currentIndex = 0;
                                                   return event => {
                                                       switch (event.key) {
                                                           // Hitting "Tab" traps us in a nice loop around elements.
                                                           case "Tab": {
                                                               event.preventDefault();
                                                               currentIndex += event.shiftKey ? -1 : +1;
                                                               if (currentIndex < 0) {
                                                                   currentIndex = lastIndex;
                                                               } else if (currentIndex > lastIndex) {
                                                                   currentIndex = 0;
                                                               }
                                                               anchors.item(currentIndex).focus();
                                                               break;
                                                           }

                                                           // Hitting "Enter" on an anchor releases the trap.
                                                           case "Enter":
                                                               hidePanel(panel);
                                                               break;

                                                           // Hitting "Escape" returns focus to dfn.
                                                           case "Escape":
                                                               hidePanel(panel);
                                                               dfn.focus();
                                                               return;
                                                       }
                                                   };
                                               }

                                               /** @param {HTMLElement} panel */
                                               function hidePanel(panel) {
                                                   if (!panel) return;
                                                   panel.hidden = true;
                                                   panel.classList.remove("docked");
                                               }
                                           })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="/dropdown.js"></script>
</body>

</html>